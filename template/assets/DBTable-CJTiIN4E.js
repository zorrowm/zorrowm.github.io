import{bu as ce,bc as me,c8 as fe,ci as S,bU as Y,bI as pe,bw as d,c4 as ge,bA as O,bB as F,bC as k,cj as be,c3 as ve,ck as I,bv as T,bz as we,bV as B,bD as _e,cl as ye,c2 as ke,cm as Be,bQ as Fe,c6 as Ce,cr as H}from"./vendor-B1f7FUIB.js";import{B as De}from"./BaseContent-YPVzmYb3.js";import{B as G,p as xe}from"./xframelib-exp-B9KgMBHw.js";import{b as Ee,_ as Qe}from"./index-CvUQtR9N.js";import{B as Ue}from"./BtnDel-Uh29rNph.js";import{D as g}from"./DBService-CNScdGN7.js";import{d as W,c as J,r as u,w as he,b as s,f as v,a3 as a,j as l,l as r,k as m,v as Q,e as U,V as Ae,aa as Ve,ab as c,a6 as K,a0 as Pe}from"./@vue-exp-DMKPrOh0.js";import"./@hprose-exp-BEudjurc.js";import"./pdfjs-dist-exp-C7mOU4gj.js";import"./vue-router-exp-DWvvxSx9.js";import"./axios-exp-B_zfNCMU.js";import"./@iconify/vue-exp-5llPk3YT.js";const qe=W({name:"DBTable"}),Se=W({...qe,setup(X,{expose:o}){o();const h=ce(),e=Ee(),M=J(()=>e.showTabMenu?"padding-bottom: 30px;":""),C=u(null),n=u(null),i=u({sortBy:"id",descending:!1,page:1,rowsPerPage:10}),w=u(1);let f;const A=u(0),Z=J(()=>Math.ceil(A.value/i.value.rowsPerPage)),$=u(""),j=u([]),z=u([{name:"id",align:"center",label:"索引",field:"id",sortable:!0},{name:"name",align:"center",label:"姓名",field:"name"},{name:"age",align:"center",label:"年龄",field:"age",sortable:!0},{name:"picture",required:!0,label:"照片",align:"center",field:"picture"},{name:"profile",required:!0,label:"档案",align:"center",field:"pid"},{name:"modifytime",required:!0,label:"更新时间",align:"center",field:"lastModified",format:t=>t?me.formatDate(t,"YYYY-MM-DD HH:mm:ss"):"无",sortable:!0},{name:"opt",align:"center",label:"操作",field:"opt"}]),V=u([]);he(()=>w.value,t=>{_()});function _(){g.getPageList(void 0,w.value,i.value.rowsPerPage).then(t=>{V.value=t})}function L(){g.getCount().then(t=>{A.value=t}),g.getPageList(void 0,w.value,i.value.rowsPerPage).then(t=>{V.value=t})}L();const N=u([]),D=u("新建"),b=u({}),y=u(void 0);z.value.forEach(({name:t})=>{N.value.push(t)});function ee(){const t=`确认删除这 ${j.value.length} 条记录吗？`;h.dialog({title:"批量删除",message:t,cancel:!0,persistent:!0}).onOk(()=>{}).onOk(()=>{}).onCancel(()=>{}).onDismiss(()=>{})}function le(){D.value="新建",b.value={name:"",age:10},y.value&&y.value.show()}function oe(t){g.deleteItem(t.id).then(p=>{_(),G.Message.info("删除成功")})}function ae(t){D.value="编辑",b.value={...t},y.value&&y.value.show()}function te(t){}async function ne(){D.value==="新建"?g.addItem(b.value).then(t=>{t&&f&&g.saveProfile(t,f[0]).then(()=>{f=void 0}),_()}):g.updateItem(b.value.id,b.value).then(()=>{f?g.saveProfile(b.value.id,f).then(()=>{f=void 0,_()}):_()}),y.value.hide(),G.Message.info("提交更改成功！")}function ie(){n.value?.pickFiles()}function re(t){const p=t[0],x=new FileReader;x.onload=function(E){b.value.picture=E.target.result},x.readAsDataURL(p)}function ue(t){const p=t[0],x=p.name,E=new FileReader;E.onload=function(P){let q=null;typeof P.target.result=="object"?q=new Blob([P.target.result]):q=P.target.result,f={name:x,content:q}},E.readAsArrayBuffer(p)}function de(){C.value&&C.value.pickFiles()}async function se(t){const p=await g.getProfile(t);p&&xe(p.file,p.name)}const R={$q:h,appState:e,sizeStyle:M,profileUploader:C,imgUploader:n,pagination:i,currentPage:w,get uploadFiles(){return f},set uploadFiles(t){f=t},rowSum:A,pagesNumber:Z,filter:$,selected:j,columns:z,rows:V,query:_,init:L,group:N,editType:D,form:b,dialogRef:y,showConfirm:ee,add:le,del:oe,edit:ae,design:te,submit:ne,doImageUpload:ie,pictureUpload:re,fileUpload:ue,doUpload:de,doDowload:se,BaseContent:De,BtnDel:Ue};return Object.defineProperty(R,"__isScriptSetup",{enumerable:!1,value:!0}),R}}),Ie={class:"row no-wrap full-width"},Te={class:"q-gutter-xs"},Me=["src"],je={key:1},ze={key:1},Le={class:"full-width row justify-center"},Ne={class:"view_title justify-between q-px-md"},Re={class:"row q-col-gutter-x-md dialog_form q-pa-md"},Ye={class:"col-6"},Oe={class:"col-6"},He={class:"col-12"},Ge={class:"col-12"},Je={class:"row justify-center q-pa-md"};function Ke(X,o,h,e,M,C){return s(),v(e.BaseContent,{class:"q-pa-sm",style:Pe(e.sizeStyle)},{default:a(()=>[l(fe,{class:"fit sticky-header-table",selection:"multiple",selected:e.selected,"onUpdate:selected":o[4]||(o[4]=n=>e.selected=n),dense:e.$q.screen.lt.md,separator:"cell",flat:"",bordered:"",rows:e.rows,filter:e.filter,columns:e.columns,"row-key":"name","visible-columns":e.group,pagination:e.pagination,"onUpdate:pagination":o[5]||(o[5]=n=>e.pagination=n)},{top:a(n=>[r("div",Ie,[l(S,{clearable:"",outlined:"",dense:"",placeholder:"请输入关键字搜索",class:"on-left",debounce:"300",modelValue:e.filter,"onUpdate:modelValue":o[0]||(o[0]=i=>e.filter=i)},{append:a(()=>[l(Y,{name:"search"})]),_:1},8,["modelValue"]),l(pe),r("div",Te,[l(d,{icon:"add","no-wrap":"",color:"primary",label:"新建",onClick:e.add}),m(l(d,{disable:e.selected.length===0,"no-wrap":"",color:"negative",label:"批量删除",onClick:o[1]||(o[1]=i=>e.showConfirm()),icon:"delete_outline"},null,8,["disable"]),[[Q,e.$q.screen.gt.sm]]),m(l(d,{color:"primary",label:"切换全屏","no-wrap":"",onClick:n.toggleFullscreen,icon:n.inFullscreen?"fullscreen_exit":"fullscreen"},null,8,["onClick","icon"]),[[Q,e.$q.screen.gt.sm]]),m(l(ge,{color:"primary",label:"自选列",icon:"view_list","no-wrap":""},{default:a(()=>[l(O,null,{default:a(()=>[(s(!0),U(Ae,null,Ve(e.columns,i=>(s(),v(F,{tag:"label",key:i.name},{default:a(()=>[l(k,{avatar:""},{default:a(()=>[l(be,{modelValue:e.group,"onUpdate:modelValue":o[2]||(o[2]=w=>e.group=w),val:i.name},null,8,["modelValue","val"])]),_:2},1024),l(k,null,{default:a(()=>[l(ve,null,{default:a(()=>[c(K(i.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},512),[[Q,e.$q.screen.gt.sm]])])])]),"body-cell-picture":a(n=>[l(I,{props:n},{default:a(()=>[n.row.picture?(s(),U("img",{key:0,src:n.row.picture,width:"80",height:"80"},null,8,Me)):(s(),U("span",je,"暂无"))]),_:2},1032,["props"])]),"body-cell-profile":a(n=>[l(I,{props:n},{default:a(()=>[n.row.pid?(s(),v(d,{key:0,label:"下载档案",color:"primary",onClick:i=>e.doDowload(n.row.pid)},null,8,["onClick"])):(s(),U("span",ze,"暂无"))]),_:2},1032,["props"])]),"body-cell-opt":a(n=>[l(I,{props:n,"auto-width":!0},{default:a(()=>[l(d,{flat:"",round:"",dense:"",color:"primary",icon:"edit",onClick:i=>e.edit(n.row)},{default:a(()=>[l(T,null,{default:a(()=>o[8]||(o[8]=[c("编辑")])),_:1})]),_:2},1032,["onClick"]),l(d,{flat:"",round:"",dense:"",color:"primary",icon:"mdi-image-edit-outline",onClick:i=>e.design(n.row)},{default:a(()=>[l(T,null,{default:a(()=>o[9]||(o[9]=[c("视图设计")])),_:1})]),_:2},1032,["onClick"]),l(e.BtnDel,{label:"视图",onConfirm:i=>e.del(n.row)},null,8,["onConfirm"]),l(d,{flat:"",round:"",dense:"",color:"primary",icon:"mdi-more"},{default:a(()=>[l(T,null,{default:a(()=>o[10]||(o[10]=[c("更多")])),_:1}),l(we,null,{default:a(()=>[l(O,{style:{"min-width":"100px"}},{default:a(()=>[m((s(),v(F,{clickable:""},{default:a(()=>[l(k,null,{default:a(()=>o[11]||(o[11]=[c("发布服务")])),_:1})]),_:1})),[[B]]),m((s(),v(F,{clickable:""},{default:a(()=>[l(k,null,{default:a(()=>o[12]||(o[12]=[c("新建索引")])),_:1})]),_:1})),[[B]]),l(_e),m((s(),v(F,{clickable:""},{default:a(()=>[l(k,null,{default:a(()=>o[13]||(o[13]=[c("清理缓存")])),_:1})]),_:1})),[[B]]),m((s(),v(F,{clickable:""},{default:a(()=>[l(k,null,{default:a(()=>o[14]||(o[14]=[c("新增数据")])),_:1})]),_:1})),[[B]])]),_:1})]),_:1})]),_:1})]),_:2},1032,["props"])]),bottom:a(()=>[r("div",Le,[l(ye,{modelValue:e.currentPage,"onUpdate:modelValue":o[3]||(o[3]=n=>e.currentPage=n),max:e.pagesNumber},null,8,["modelValue","max"])])]),_:1},8,["selected","dense","rows","filter","columns","visible-columns","pagination"]),l(ke,{maximized:"",flat:"",persistent:"",ref:"dialogRef"},{default:a(()=>[l(Be,{onSubmit:e.submit,class:"dialog_card column"},{default:a(()=>[r("h5",Ne,[c(K(e.editType)+"视图 ",1),m(l(d,{dense:"",outline:"",round:"",icon:"clear",size:"sm"},null,512),[[B]])]),l(Fe,{class:"col"},{default:a(()=>[r("div",Re,[r("div",Ye,[r("h5",null,[l(Y,{name:"star",color:"red"}),o[15]||(o[15]=c("姓名： "))]),l(S,{outlined:"",dense:"",modelValue:e.form.name,"onUpdate:modelValue":o[6]||(o[6]=n=>e.form.name=n),type:"text"},null,8,["modelValue"])]),r("div",Oe,[o[16]||(o[16]=r("h5",null,"年龄：",-1)),l(S,{outlined:"",dense:"",modelValue:e.form.age,"onUpdate:modelValue":o[7]||(o[7]=n=>e.form.age=n),type:"text"},null,8,["modelValue"])]),r("div",He,[o[17]||(o[17]=r("h5",null,"个人照片",-1)),l(Ce,{src:e.form.picture??"img/noimage.gif","spinner-color":"white",style:{height:"80px","max-width":"80px"},onClick:e.doImageUpload},null,8,["src"]),o[18]||(o[18]=c()),l(H,{ref:"imgUploader","max-files":1,class:"hidden",accept:"image/*","field-name":"file",onAdded:e.pictureUpload},null,512)]),r("div",Ge,[o[19]||(o[19]=r("h5",null,"上传简历",-1)),m(l(d,{"no-wrap":"",label:"上传",icon:"mdi-cloud-upload-outline",color:"primary",onClick:e.doUpload},{default:a(()=>[l(H,{ref:"profileUploader","max-files":1,class:"hidden",accept:".doc, .docx, .pdf","field-name":"file",onAdded:e.fileUpload},null,512)]),_:1},512),[[Q,e.$q.screen.gt.sm]])])])]),_:1}),r("div",Je,[m(l(d,{outline:"",color:"primary",icon:"mdi-close-thick",label:"关闭"},null,512),[[B]]),l(d,{class:"q-mx-sm",color:"primary",icon:"mdi-check-bold",label:"提交",type:"submit"})])]),_:1})]),_:1},512)]),_:1},8,["style"])}const ul=Qe(Se,[["render",Ke],["__scopeId","data-v-f2417570"],["__file","DBTable.vue"]]);export{ul as default};
