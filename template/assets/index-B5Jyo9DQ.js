import{d as Y,U as G,O,i as W,j as J,k as B,a1 as K,M as X,a2 as M,e as Z,aa as ee}from"./quasar-exp-B7YDMHDE.js";import{r as i,d as ae,c as I,w as te,o as ne,a as le,b as c,f as _,a3 as n,i as l,I as w,j as oe,e as b,F as re,a9 as se,n as ie,aa as ue,a6 as ce,v as de,k as fe,a0 as me}from"./@vue-exp-CzdoyapG.js";import{T as pe,A as ge,P as ve}from"./TopFunBar-uic0jLak.js";import{_ as we}from"./BaseContent.vue_vue_type_script_setup_true_lang-CHGumBnk.js";import{b as be,i as ye,j as he}from"./index-DylLUN-r.js";import{x as ke,c as Pe,W as s,H as Me}from"./xframelib-exp-uSJ3EBow.js";import{T as Q}from"./TableEvent-Bxu_GHGl.js";import{d as _e}from"./WidgetsTool-D0-2VvAI.js";import{S as x}from"./StudentService-Bf1JJ8qu.js";import{G as xe}from"./ApiExampleDemo-RYYSybrp.js";import"./vendor-CSzZZ-de.js";import"./lottie-web-exp-CIY4INm7.js";import"./monaco-editor-exp-BNK_u0iZ.js";import"./vue-router-exp-B23Vo4Jw.js";import"./xgis-cesium-exp-Cbv1lISI.js";import"./axios-exp-C7rfqWEd.js";import"./@iconify/vue-exp-BLEeEXwl.js";const Se=[{value:"preview",name:"查看",icon:"ant-design:eye-outlined"},{value:"upload",name:"上传档案",icon:"ant-design:upload-outlined"},{value:"edit",name:"编辑",icon:"ant-design:form-outlined"},{value:"delete",name:"删除",icon:"ant-design:delete-outlined",isdelete:!0}],De=[{name:"查看关联对象",icon:"ant-design:apartment-outlined",value:"relateView"},{name:"发布服务",icon:"ant-design:aim-outlined",value:"publishService"},{name:"附件清理",icon:"ant-design:clear-outlined",value:"clearProfile"}];function Ce(){return Se}function Ae(){return De}const S=[{name:"id",align:"center",label:"索引",field:"id",sortable:!0},{name:"name",align:"center",label:"姓名",field:"name"},{name:"age",align:"center",label:"年龄",field:"age",sortable:!0},{name:"picture",required:!0,label:"照片",align:"center",field:"picture"},{name:"profile",required:!0,label:"档案",align:"center",field:"pid"},{name:"modifytime",required:!0,label:"更新时间",align:"center",field:"lastModified",format:d=>d?Y.formatDate(d,"YYYY-MM-DD"):"无",sortable:!0},{name:"opt",align:"center",label:"操作",field:"opt"}],g=i([]);S.forEach(({name:d})=>{g.value.push(d)});class Te{hproseProxyClient;constructor(u){u===void 0?this.hproseProxyClient=ke.getDefaultClient():this.hproseProxyClient=u}async SaveProfileInfoAsync(u){return await(await this.hproseProxyClient.getHproseProxy())?.SaveProfileInfoAsync(u)}async DeleteProfilesAsync(u){return await(await this.hproseProxyClient.getHproseProxy())?.DeleteProfilesAsync(u)}}const F=new Te,Be=["src"],Ie={key:1},Qe={key:1},Fe={class:"full-width row justify-end"},Xe=ae({name:"StandardTable",__name:"index",setup(d){const u=be(),y=I(()=>u.showTabMenu?"padding-bottom: 30px;":""),f=i({sortBy:"id",descending:!1,page:1,rowsPerPage:10}),m=i(1),h=i(0),k=I(()=>Math.ceil(h.value/f.value.rowsPerPage)),U=i(""),p=i([]),D=i("");te(()=>m.value,a=>{o()});let C="";const P=i(null);async function R(a){const t=a[0],e=t.name,r=await Pe.readFileBytes(t),v=await F.SaveProfileInfoAsync({id:"",file:r,name:e,studentid:C});if(P.value?.reset(),v){s.Message.info("档案上传成功！"),o();return}s.Message.info("档案上传失败！")}async function q(a){if(!a){s.Message.info("不存在附件文件");return}await F.DeleteProfilesAsync([a])?(s.Message.info("清理成功！"),o()):s.Message.info("清理失败！")}function A(a,t){let e="",r;switch(a){case"add":e="addEditForm3",r={title:"新建",footer:"true"};break;case"edit":e="addEditForm3",r={title:"编辑",footer:"true"};break}e&&_e({modalID:e,extraData:r,rowData:t,width:700})}function E(a){return[...Ce()]}function L(a){return Ae()}const V=(a,t)=>{switch(s.Logger().trace("表格菜单点击",a,t),a){case"preview":break;case"upload":C=t.id,P.value?.pickFiles();break;case"edit":j(t);break;case"delete":x.DeleteStudentsAsync([t.id]).then(e=>{o(),s.Message.info("删除成功")}).catch(e=>{s.Message.info("删除出现异常")});break;case"clearProfile":q(t.pid);break}},H=(a,t)=>{switch(a){case"searchWord":D.value=t,o();break;case"creatNew":$();break;case"batchDelete":N();break;case"refresh":o();break}},T=i([]);async function o(a=void 0){a&&(a.page&&(m.value=a.page),a.pageSize&&(f.value.rowsPerPage=a.pageSize));const t=await x.GetStudentListAsync("",D.value,m.value,f.value.rowsPerPage).catch(e=>{});t&&(h.value=t.totalCount,T.value=t.datas),m.value>k.value&&(m.value=k.value)}async function N(){if(p.value.length>0){const a=p.value.map(e=>e.id);await x.DeleteStudentsAsync(a).catch(e=>(s.Message.info("删除出现异常"),!1))&&(o(),s.Message.info("删除成功"))}}function $(){A("add",{name:"",age:10})}function j(a){A("edit",a)}async function z(a,t){const e=await xe(a);e&&e.response?.status==200&&e.data&&Me(e.data,t)}return ne(()=>{ye(Q.RefeshTable,o),o()}),le(()=>{he(Q.RefeshTable,o)}),(a,t)=>(c(),_(we,{class:"q-pa-sm",style:me(y.value)},{default:n(()=>[l(G,{class:"fit sticky-header-table",selection:"multiple",selected:p.value,"onUpdate:selected":t[1]||(t[1]=e=>p.value=e),dense:a.$q.screen.lt.md,separator:"cell",flat:"",bordered:"",rows:T.value,filter:U.value,columns:w(S),"row-key":"name","visible-columns":w(g),pagination:f.value,"onUpdate:pagination":t[2]||(t[2]=e=>f.value=e)},{top:n(e=>[l(pe,{target:e,batch:p.value.length===0,title:"服务列表",onTopBarClick:H},{rightAppend:n(()=>[oe(l(O,{outlined:"",label:"自选列",icon:"view_list","no-wrap":""},{default:n(()=>[l(W,null,{default:n(()=>[(c(!0),b(re,null,se(w(S),r=>(c(),_(J,{tag:"label",key:r.name},{default:n(()=>[l(B,{avatar:""},{default:n(()=>[l(K,{modelValue:w(g),"onUpdate:modelValue":t[0]||(t[0]=v=>ie(g)?g.value=v:null),val:r.name},null,8,["modelValue","val"])]),_:2},1024),l(B,null,{default:n(()=>[l(X,null,{default:n(()=>[ue(ce(r.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},512),[[de,a.$q.screen.gt.sm]])]),_:2},1032,["target","batch"])]),"body-cell-picture":n(e=>[l(M,{props:e},{default:n(()=>[e.row.picture?(c(),b("img",{key:0,src:e.row.picture,width:"80",height:"80"},null,8,Be)):(c(),b("span",Ie,"暂无"))]),_:2},1032,["props"])]),"body-cell-profile":n(e=>[l(M,{props:e},{default:n(()=>[e.row.pid?(c(),_(Z,{key:0,label:"下载档案",color:"primary",onClick:r=>z(e.row.id,e.row.pname)},null,8,["onClick"])):(c(),b("span",Qe,"暂无"))]),_:2},1032,["props"])]),"body-cell-opt":n(e=>[l(M,{props:e,"auto-width":!0},{default:n(()=>[l(ge,{currentRow:e.row,onDoActionClick:V,"default-menus":E(e.row),"append-menus":L(e.row)},null,8,["currentRow","default-menus","append-menus"])]),_:2},1032,["props"])]),bottom:n(()=>[fe("div",Fe,[l(ve,{"rows-number":h.value,"rows-per-page":f.value.rowsPerPage,max:k.value},null,8,["rows-number","rows-per-page","max"])])]),_:1},8,["selected","dense","rows","filter","columns","visible-columns","pagination"]),l(ee,{ref_key:"profileUploader2",ref:P,"max-files":1,class:"hidden",accept:".doc, .docx, .pdf","field-name":"file",onAdded:R},null,512)]),_:1},8,["style"]))}});export{Xe as default};
