import{e as de,n as ie,a0 as ge,a8 as Wn,f as Z,L as Co,a3 as we,a9 as Kr,l as J,V as Ie,aa as $e,g as ne,r as G,d as Pe,b as X,k as Eo,v as ko,ab as Yt,a6 as an,ac as Gr,j as ut,S as Io,ad as ye,w as Te,p as Yr,c as ze,o as cn,H as Jr,a1 as xe,O as Qr,a as Zr,C as Mt,I as ei,$ as vt,q as ti,G as xo,K as ni}from"./@vue-exp-DMKPrOh0.js";import{a as oi}from"./axios-exp-B_zfNCMU.js";import{ba as ri}from"./vendor-B1f7FUIB.js";import{B as Ee,W as Jt,R as Qt,V as ii,C as Dt,H as si,b as ai}from"./@hprose-exp-BEudjurc.js";import{I as Pt}from"./@iconify/vue-exp-5llPk3YT.js";function Bt(n){return window.TouchEvent&&n instanceof TouchEvent}class le{e;constructor(e){this.e=e}stopPropagation(){this.e.stopPropagation()}preventDefault(){this.e.preventDefault()}get clientX(){return Bt(this.e)?(this.e.type==="touchend"?this.e.changedTouches:this.e.touches).item(0).clientX:this.e.clientX}get clientY(){return Bt(this.e)?(this.e.type==="touchend"?this.e.changedTouches:this.e.touches).item(0).clientY:this.e.clientY}get clientCoord(){return new ln(this.clientX,this.clientY)}static bindDown(e,t,o,r=!1){const i=c=>{t(new le(c))},s=c=>{c.touches.length===1&&t(new le(c)),c.touches.length>1&&o&&o(new le(c))};return e.addEventListener("mousedown",i,r),e.addEventListener("touchstart",s,r),()=>{e.removeEventListener("mousedown",i,r),e.removeEventListener("touchstart",s,r)}}static bindMove(e,t,o=!1){const r=s=>{t(new le(s))},i=s=>{s.touches.length===1&&t(new le(s))};return e.addEventListener("mousemove",r,o),e.addEventListener("touchmove",i,o),()=>{e.removeEventListener("mousemove",r,o),e.removeEventListener("touchmove",i,o)}}static bindUp(e,t,o=!1){const r=s=>{t(new le(s))},i=s=>{s.touches.length===0&&t(new le(s))};return e.addEventListener("mouseup",r,o),e.addEventListener("touchend",i,o),()=>{e.removeEventListener("mouseup",r,o),e.removeEventListener("touchend",i,o)}}originalEvent({mouse:e,touch:t}){Bt(this.e)?t&&t(this.e):e&&e(this.e)}}class ln{x;y;constructor(e,t){this.x=e,this.y=t}clone(){return new ln(this.x,this.y)}}class ci{handle;container;options;unbindDown;unbindMove;unbindUp;constructor(e,t,o={}){this.handle=e,this.container=t,this.options=o,e&&(this.unbindDown=le.bindDown(e,this.mousedown),e.classList.add("draggable-handle"))}teardown(){this.handle?.classList.remove("draggable-handle"),this.unbindDown&&this.unbindDown(),this.unbindUp&&this.unbindUp(),this.unbindMove&&this.unbindMove()}offsetX;offsetY;mousedown=e=>{e.preventDefault(),this.handle&&(this.offsetX=e.clientX,this.offsetY=e.clientY),this.options.onMoveStart&&this.options.onMoveStart(),this.unbindMove=le.bindMove(document,this.mousemove),this.unbindUp=le.bindUp(document,this.mouseup)};mousemove=e=>{this.container&&(this.container.style.left=`calc(${e.clientX-this.offsetX}px + ${this.container.style.left})`,this.container.style.top=`calc(${e.clientY-this.offsetY}px + ${this.container.style.top})`,this.offsetX=e.clientX,this.offsetY=e.clientY),this.options.onMove&&this.options.onMove()};mouseup=e=>{this.options.onMoveEnd&&this.options.onMoveEnd(),this.unbindUp(),this.unbindMove(),this.unbindUp=this.unbindMove=void 0}}class li{_group;onChange;zIndex;constructor(e,t){this._group=e,this.onChange=t,this.a(o=>o.push(this))}set group(e){this._group=e;const t=st(this._group),o=st(e);t.splice(t.indexOf(this),1),o.push(this),On()}get group(){return this._group}unregister(){this.a(e=>e.splice(e.indexOf(this),1))}raise(){this.a(e=>{e.splice(e.indexOf(this),1),e.push(this)})}a(e){e(st(this._group)),On()}}const it=new Map;function st(n){return it.has(n)||it.set(n,[]),it.get(n)}function To(n,e){return n>e?-To(e,n):n<0&&e>=0?1:n-e}function On(){let n=0;for(const e of function(t){const o=[];return t.forEach((r,i)=>o.push(i)),o}(it).sort(To))for(const t of st(e))n!=t.zIndex&&(t.zIndex=n,t.onChange(n)),n++}function Zt(n){if(n){const{width:e,height:t}=n.style;n.style.width="auto",n.style.height="auto";const o=at(n);return n.style.width=e,n.style.height=t,o}return{width:0,height:0,top:0,left:0,bottom:0,right:0}}function at(n){const e=n.getBoundingClientRect(),t=e.width,o=e.height,r=e.top,i=e.left;return{width:t,height:o,top:r,left:i,bottom:r+o,right:i+t}}class ui{container;options;handles;constructor(e,t){if(this.container=e,this.options=t,e&&t){this.handles=Ro.map(p=>new p(e,this));const{width:o,height:r}=Zt(e),i=t.maxWidth||window.innerWidth,s=t.maxHeight||window.innerHeight;let c=!1;(o<t.minWidth||o>i)&&(e.style.width=`${jn(o,t.minWidth,i)}px`,c=!0),(r<t.minHeight||r>s)&&(e.style.height=`${jn(r,t.minHeight,s)}px`,c=!0),c&&t.onResize&&t.onResize()}}teardown(){this.handles?.forEach(e=>e.teardown())}}const Ro=[];class Ce{container;helper;handle;handleSize=8;unbindDown;unbindMove;unbindUp;constructor(e,t){this.container=e,this.helper=t,this.handle=this.createHandleElement(),this.unbindDown=le.bindDown(this.handle,this.mousedown)}teardown(){this.unbindDown(),this.unbindUp&&this.unbindUp(),this.unbindMove&&this.unbindMove(),this.handle.parentElement.removeChild(this.handle)}x0;y0;left0;top0;width0;height0;mousedown=e=>{e.preventDefault(),e.stopPropagation();const{left:t,top:o,width:r,height:i}=at(this.container);this.x0=e.clientX,this.y0=e.clientY,this.left0=t,this.top0=o,this.width0=r,this.height0=i,this.calcSafeBoundaries(),this.helper.options&&this.helper.options.onResizeStart&&this.helper.options.onResizeStart(),this.unbindMove=le.bindMove(document,this.mousemove),this.unbindUp=le.bindUp(document,this.mouseup)};minLeft;maxLeft;minRight;maxRight;minTop;maxTop;minBottom;maxBottom;calcSafeBoundaries(){if(!this.helper.options)return;const{left:e,top:t,right:o,bottom:r}=at(this.container),i=this.helper.options,s=i.maxWidth||window.innerWidth,c=i.maxHeight||window.innerHeight;this.minLeft=Math.max(o-s,0),this.maxLeft=o-i.minWidth,this.minRight=e+i.minWidth,this.maxRight=Math.min(e+s,window.innerWidth),this.minTop=Math.max(r-c,0),this.maxTop=r-i.minHeight,this.minBottom=t+i.minHeight,this.maxBottom=Math.min(t+c,window.innerHeight)}mousemove=e=>{e.preventDefault(),e.stopPropagation(),this.setPosition(e),this.fixPosition(),this.helper.options&&this.helper.options.onResize&&this.helper.options.onResize()};fixPosition(){const{width:e,height:t,left:o,top:r,right:i,bottom:s}=at(this.container),c=this.helper.options;c&&(o<this.minLeft?(this.container.style.width=e+o-this.minLeft+"px",this.container.style.left=`${this.minLeft}px`):o>this.maxLeft?(this.container.style.width=`${c.minWidth}px`,this.container.style.left=`${this.maxLeft}px`):i<this.minRight?this.container.style.width=`${c.minWidth}px`:i>this.maxRight&&(this.container.style.width=this.maxRight-o+"px"),r<this.minTop?(this.container.style.height=t+r-this.minTop+"px",this.container.style.top=`${this.minTop}px`):r>this.maxTop?(this.container.style.height=`${c.minHeight}px`,this.container.style.top=`${this.maxTop}px`):s<this.minBottom?this.container.style.height=`${c.minHeight}px`:s>this.maxBottom&&(this.container.style.height=this.maxBottom-r+"px"))}mouseup=e=>{e.preventDefault(),e.stopPropagation(),this.helper.options&&this.helper.options.onResizeEnd&&this.helper.options.onResizeEnd(),this.unbindUp(),this.unbindMove(),this.unbindUp=this.unbindMove=void 0};createHandleElement(){const e=document.createElement("div"),t=e.style;return t.position="absolute",this.applyStyle(t),this.container.appendChild(e),e}}function jn(n,e,t){return n<e?e:n>t?t:n}Ro.push(class extends Ce{setPosition(n){this.container.style.width=this.width0+n.clientX-this.x0+"px",this.container.style.height=this.height0+n.clientY-this.y0+"px"}applyStyle(n){n.width=2*this.handleSize+"px",n.height=2*this.handleSize+"px",n.right=-this.handleSize+"px",n.bottom=-this.handleSize+"px",n.cursor="nwse-resize"}},class extends Ce{setPosition(n){this.container.style.height=this.height0+n.clientY-this.y0+"px"}applyStyle(n){n.right=`${this.handleSize}px`,n.left=`${this.handleSize}px`,n.height=2*this.handleSize+"px",n.bottom=-this.handleSize+"px",n.cursor="ns-resize"}},class extends Ce{setPosition(n){this.container.style.left=this.left0+n.clientX-this.x0+"px",this.container.style.width=this.width0-(n.clientX-this.x0)+"px",this.container.style.height=this.height0+n.clientY-this.y0+"px"}applyStyle(n){n.left=-this.handleSize+"px",n.bottom=-this.handleSize+"px",n.width=2*this.handleSize+"px",n.height=2*this.handleSize+"px",n.cursor="nesw-resize"}},class extends Ce{setPosition(n){this.container.style.left=this.left0+n.clientX-this.x0+"px",this.container.style.width=this.width0-(n.clientX-this.x0)+"px"}applyStyle(n){n.left=-this.handleSize+"px",n.bottom=`${this.handleSize}px`,n.width=2*this.handleSize+"px",n.top=`${this.handleSize}px`,n.cursor="ew-resize"}},class extends Ce{setPosition(n){this.container.style.left=this.left0+n.clientX-this.x0+"px",this.container.style.width=this.width0-(n.clientX-this.x0)+"px",this.container.style.top=this.top0+n.clientY-this.y0+"px",this.container.style.height=this.height0-(n.clientY-this.y0)+"px"}applyStyle(n){n.left=-this.handleSize+"px",n.top=-this.handleSize+"px",n.width=2*this.handleSize+"px",n.height=2*this.handleSize+"px",n.cursor="nwse-resize"}},class extends Ce{setPosition(n){this.container.style.top=this.top0+n.clientY-this.y0+"px",this.container.style.height=this.height0-(n.clientY-this.y0)+"px"}applyStyle(n){n.left=`${this.handleSize}px`,n.right=`${this.handleSize}px`,n.height=2*this.handleSize+"px",n.top=-this.handleSize+"px",n.cursor="ns-resize"}},class extends Ce{setPosition(n){this.container.style.top=this.top0+n.clientY-this.y0+"px",this.container.style.height=this.height0-(n.clientY-this.y0)+"px",this.container.style.width=this.width0+n.clientX-this.x0+"px"}applyStyle(n){n.right=-this.handleSize+"px",n.top=-this.handleSize+"px",n.height=2*this.handleSize+"px",n.width=2*this.handleSize+"px",n.cursor="nesw-resize"}},class extends Ce{setPosition(n){this.container.style.width=this.width0+n.clientX-this.x0+"px"}applyStyle(n){n.right=-this.handleSize+"px",n.top=`${this.handleSize}px`,n.bottom=`${this.handleSize}px`,n.width=2*this.handleSize+"px",n.cursor="ew-resize"}});var ct=Pe({name:"",props:{disabled:{type:Boolean,default:!1},windowStyle:{type:Object,required:!0}},components:{},setup(n){const e=G(!1),t=G(!1);return{hover:e,active:t,style:function(){let o=n.windowStyle.button;return e.value&&(o={...o,...this.windowStyle.buttonHover}),t.value&&(o={...o,...this.windowStyle.buttonActive}),o},mouseup:function(o){this.active&&this.$emit("click")},mousedown:function(o){o.preventDefault(),t.value=!0;const r=le.bindUp(document,()=>{t.value=!1,r()})}}}});const hi=["disabled"];ct.render=function(n,e,t,o,r,i){return X(),de("div",{class:"btn",style:ge(n.style()),onMouseenter:e[0]||(e[0]=s=>n.hover=!0),onMouseleave:e[1]||(e[1]=s=>n.hover=!1),onMousedown:e[2]||(e[2]=Wn((...s)=>n.mousedown&&n.mousedown(...s),["stop"])),onTouchstart:e[3]||(e[3]=Wn((...s)=>n.mousedown&&n.mousedown(...s),["stop"])),onMouseup:e[4]||(e[4]=(...s)=>n.mouseup&&n.mouseup(...s)),onTouchend:e[5]||(e[5]=(...s)=>n.mouseup&&n.mouseup(...s)),disabled:n.disabled},[ie(n.$slots,"default")],44,hi)},ct.__scopeId="data-v-71662210",ct.__file="src/controls/vuewindow/window/Button.vue";const di=Object.prototype.toString;function yt(n,e){return di.call(n)===`[object ${e}]`}function fi(n){return yt(n,"Function")}const un=n=>n!=null&&n!==null&&yt(n,"Object");function Un(n){return yt(n,"Number")}function Lo(n){return yt(n,"String")}function pi(n){return n&&Array.isArray(n)}const Bs=n=>/^(https?|ftp):\/\/([a-zA-Z0-9.-]+(:[a-zA-Z0-9.&%$-]+)*@)*((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])){3}|([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+\.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{2}))(:[0-9]+)*(\/($|[a-zA-Z0-9.,?'\\+&%$#=~_-]+))*$/.test(n);var Ne=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function wt(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Hn,qn={exports:{}},gi=Hn?qn.exports:(Hn=1,qn.exports=function(n){var e=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function t(f,l){var y=f[0],v=f[1],h=f[2],m=f[3];v=((v+=((h=((h+=((m=((m+=((y=((y+=(v&h|~v&m)+l[0]-680876936|0)<<7|y>>>25)+v|0)&v|~y&h)+l[1]-389564586|0)<<12|m>>>20)+y|0)&y|~m&v)+l[2]+606105819|0)<<17|h>>>15)+m|0)&m|~h&y)+l[3]-1044525330|0)<<22|v>>>10)+h|0,v=((v+=((h=((h+=((m=((m+=((y=((y+=(v&h|~v&m)+l[4]-176418897|0)<<7|y>>>25)+v|0)&v|~y&h)+l[5]+1200080426|0)<<12|m>>>20)+y|0)&y|~m&v)+l[6]-1473231341|0)<<17|h>>>15)+m|0)&m|~h&y)+l[7]-45705983|0)<<22|v>>>10)+h|0,v=((v+=((h=((h+=((m=((m+=((y=((y+=(v&h|~v&m)+l[8]+1770035416|0)<<7|y>>>25)+v|0)&v|~y&h)+l[9]-1958414417|0)<<12|m>>>20)+y|0)&y|~m&v)+l[10]-42063|0)<<17|h>>>15)+m|0)&m|~h&y)+l[11]-1990404162|0)<<22|v>>>10)+h|0,v=((v+=((h=((h+=((m=((m+=((y=((y+=(v&h|~v&m)+l[12]+1804603682|0)<<7|y>>>25)+v|0)&v|~y&h)+l[13]-40341101|0)<<12|m>>>20)+y|0)&y|~m&v)+l[14]-1502002290|0)<<17|h>>>15)+m|0)&m|~h&y)+l[15]+1236535329|0)<<22|v>>>10)+h|0,v=((v+=((h=((h+=((m=((m+=((y=((y+=(v&m|h&~m)+l[1]-165796510|0)<<5|y>>>27)+v|0)&h|v&~h)+l[6]-1069501632|0)<<9|m>>>23)+y|0)&v|y&~v)+l[11]+643717713|0)<<14|h>>>18)+m|0)&y|m&~y)+l[0]-373897302|0)<<20|v>>>12)+h|0,v=((v+=((h=((h+=((m=((m+=((y=((y+=(v&m|h&~m)+l[5]-701558691|0)<<5|y>>>27)+v|0)&h|v&~h)+l[10]+38016083|0)<<9|m>>>23)+y|0)&v|y&~v)+l[15]-660478335|0)<<14|h>>>18)+m|0)&y|m&~y)+l[4]-405537848|0)<<20|v>>>12)+h|0,v=((v+=((h=((h+=((m=((m+=((y=((y+=(v&m|h&~m)+l[9]+568446438|0)<<5|y>>>27)+v|0)&h|v&~h)+l[14]-1019803690|0)<<9|m>>>23)+y|0)&v|y&~v)+l[3]-187363961|0)<<14|h>>>18)+m|0)&y|m&~y)+l[8]+1163531501|0)<<20|v>>>12)+h|0,v=((v+=((h=((h+=((m=((m+=((y=((y+=(v&m|h&~m)+l[13]-1444681467|0)<<5|y>>>27)+v|0)&h|v&~h)+l[2]-51403784|0)<<9|m>>>23)+y|0)&v|y&~v)+l[7]+1735328473|0)<<14|h>>>18)+m|0)&y|m&~y)+l[12]-1926607734|0)<<20|v>>>12)+h|0,v=((v+=((h=((h+=((m=((m+=((y=((y+=(v^h^m)+l[5]-378558|0)<<4|y>>>28)+v|0)^v^h)+l[8]-2022574463|0)<<11|m>>>21)+y|0)^y^v)+l[11]+1839030562|0)<<16|h>>>16)+m|0)^m^y)+l[14]-35309556|0)<<23|v>>>9)+h|0,v=((v+=((h=((h+=((m=((m+=((y=((y+=(v^h^m)+l[1]-1530992060|0)<<4|y>>>28)+v|0)^v^h)+l[4]+1272893353|0)<<11|m>>>21)+y|0)^y^v)+l[7]-155497632|0)<<16|h>>>16)+m|0)^m^y)+l[10]-1094730640|0)<<23|v>>>9)+h|0,v=((v+=((h=((h+=((m=((m+=((y=((y+=(v^h^m)+l[13]+681279174|0)<<4|y>>>28)+v|0)^v^h)+l[0]-358537222|0)<<11|m>>>21)+y|0)^y^v)+l[3]-722521979|0)<<16|h>>>16)+m|0)^m^y)+l[6]+76029189|0)<<23|v>>>9)+h|0,v=((v+=((h=((h+=((m=((m+=((y=((y+=(v^h^m)+l[9]-640364487|0)<<4|y>>>28)+v|0)^v^h)+l[12]-421815835|0)<<11|m>>>21)+y|0)^y^v)+l[15]+530742520|0)<<16|h>>>16)+m|0)^m^y)+l[2]-995338651|0)<<23|v>>>9)+h|0,v=((v+=((m=((m+=(v^((y=((y+=(h^(v|~m))+l[0]-198630844|0)<<6|y>>>26)+v|0)|~h))+l[7]+1126891415|0)<<10|m>>>22)+y|0)^((h=((h+=(y^(m|~v))+l[14]-1416354905|0)<<15|h>>>17)+m|0)|~y))+l[5]-57434055|0)<<21|v>>>11)+h|0,v=((v+=((m=((m+=(v^((y=((y+=(h^(v|~m))+l[12]+1700485571|0)<<6|y>>>26)+v|0)|~h))+l[3]-1894986606|0)<<10|m>>>22)+y|0)^((h=((h+=(y^(m|~v))+l[10]-1051523|0)<<15|h>>>17)+m|0)|~y))+l[1]-2054922799|0)<<21|v>>>11)+h|0,v=((v+=((m=((m+=(v^((y=((y+=(h^(v|~m))+l[8]+1873313359|0)<<6|y>>>26)+v|0)|~h))+l[15]-30611744|0)<<10|m>>>22)+y|0)^((h=((h+=(y^(m|~v))+l[6]-1560198380|0)<<15|h>>>17)+m|0)|~y))+l[13]+1309151649|0)<<21|v>>>11)+h|0,v=((v+=((m=((m+=(v^((y=((y+=(h^(v|~m))+l[4]-145523070|0)<<6|y>>>26)+v|0)|~h))+l[11]-1120210379|0)<<10|m>>>22)+y|0)^((h=((h+=(y^(m|~v))+l[2]+718787259|0)<<15|h>>>17)+m|0)|~y))+l[9]-343485551|0)<<21|v>>>11)+h|0,f[0]=y+f[0]|0,f[1]=v+f[1]|0,f[2]=h+f[2]|0,f[3]=m+f[3]|0}function o(f){var l,y=[];for(l=0;l<64;l+=4)y[l>>2]=f.charCodeAt(l)+(f.charCodeAt(l+1)<<8)+(f.charCodeAt(l+2)<<16)+(f.charCodeAt(l+3)<<24);return y}function r(f){var l,y=[];for(l=0;l<64;l+=4)y[l>>2]=f[l]+(f[l+1]<<8)+(f[l+2]<<16)+(f[l+3]<<24);return y}function i(f){var l,y,v,h,m,$,M=f.length,D=[1732584193,-271733879,-1732584194,271733878];for(l=64;l<=M;l+=64)t(D,o(f.substring(l-64,l)));for(y=(f=f.substring(l-64)).length,v=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l=0;l<y;l+=1)v[l>>2]|=f.charCodeAt(l)<<(l%4<<3);if(v[l>>2]|=128<<(l%4<<3),l>55)for(t(D,v),l=0;l<16;l+=1)v[l]=0;return h=(h=8*M).toString(16).match(/(.*?)(.{0,8})$/),m=parseInt(h[2],16),$=parseInt(h[1],16)||0,v[14]=m,v[15]=$,t(D,v),D}function s(f){var l,y,v,h,m,$,M=f.length,D=[1732584193,-271733879,-1732584194,271733878];for(l=64;l<=M;l+=64)t(D,r(f.subarray(l-64,l)));for(y=(f=l-64<M?f.subarray(l-64):new Uint8Array(0)).length,v=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l=0;l<y;l+=1)v[l>>2]|=f[l]<<(l%4<<3);if(v[l>>2]|=128<<(l%4<<3),l>55)for(t(D,v),l=0;l<16;l+=1)v[l]=0;return h=(h=8*M).toString(16).match(/(.*?)(.{0,8})$/),m=parseInt(h[2],16),$=parseInt(h[1],16)||0,v[14]=m,v[15]=$,t(D,v),D}function c(f){var l,y="";for(l=0;l<4;l+=1)y+=e[f>>8*l+4&15]+e[f>>8*l&15];return y}function p(f){var l;for(l=0;l<f.length;l+=1)f[l]=c(f[l]);return f.join("")}function g(f){return/[\u0080-\uFFFF]/.test(f)&&(f=unescape(encodeURIComponent(f))),f}function S(f,l){var y,v=f.length,h=new ArrayBuffer(v),m=new Uint8Array(h);for(y=0;y<v;y+=1)m[y]=f.charCodeAt(y);return l?m:h}function k(f){return String.fromCharCode.apply(null,new Uint8Array(f))}function B(f,l,y){var v=new Uint8Array(f.byteLength+l.byteLength);return v.set(new Uint8Array(f)),v.set(new Uint8Array(l),f.byteLength),v}function O(f){var l,y=[],v=f.length;for(l=0;l<v-1;l+=2)y.push(parseInt(f.substr(l,2),16));return String.fromCharCode.apply(String,y)}function x(){this.reset()}return p(i("hello")),typeof ArrayBuffer>"u"||ArrayBuffer.prototype.slice||function(){function f(l,y){return(l=0|l||0)<0?Math.max(l+y,0):Math.min(l,y)}ArrayBuffer.prototype.slice=function(l,y){var v,h,m,$,M=this.byteLength,D=f(l,M),A=M;return y!==n&&(A=f(y,M)),D>A?new ArrayBuffer(0):(v=A-D,h=new ArrayBuffer(v),m=new Uint8Array(h),$=new Uint8Array(this,D,v),m.set($),h)}}(),x.prototype.append=function(f){return this.appendBinary(g(f)),this},x.prototype.appendBinary=function(f){this._buff+=f,this._length+=f.length;var l,y=this._buff.length;for(l=64;l<=y;l+=64)t(this._hash,o(this._buff.substring(l-64,l)));return this._buff=this._buff.substring(l-64),this},x.prototype.end=function(f){var l,y,v=this._buff,h=v.length,m=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(l=0;l<h;l+=1)m[l>>2]|=v.charCodeAt(l)<<(l%4<<3);return this._finish(m,h),y=p(this._hash),f&&(y=O(y)),this.reset(),y},x.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},x.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},x.prototype.setState=function(f){return this._buff=f.buff,this._length=f.length,this._hash=f.hash,this},x.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},x.prototype._finish=function(f,l){var y,v,h,m=l;if(f[m>>2]|=128<<(m%4<<3),m>55)for(t(this._hash,f),m=0;m<16;m+=1)f[m]=0;y=(y=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),v=parseInt(y[2],16),h=parseInt(y[1],16)||0,f[14]=v,f[15]=h,t(this._hash,f)},x.hash=function(f,l){return x.hashBinary(g(f),l)},x.hashBinary=function(f,l){var y=p(i(f));return l?O(y):y},x.ArrayBuffer=function(){this.reset()},x.ArrayBuffer.prototype.append=function(f){var l,y=B(this._buff.buffer,f),v=y.length;for(this._length+=f.byteLength,l=64;l<=v;l+=64)t(this._hash,r(y.subarray(l-64,l)));return this._buff=l-64<v?new Uint8Array(y.buffer.slice(l-64)):new Uint8Array(0),this},x.ArrayBuffer.prototype.end=function(f){var l,y,v=this._buff,h=v.length,m=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(l=0;l<h;l+=1)m[l>>2]|=v[l]<<(l%4<<3);return this._finish(m,h),y=p(this._hash),f&&(y=O(y)),this.reset(),y},x.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},x.ArrayBuffer.prototype.getState=function(){var f=x.prototype.getState.call(this);return f.buff=k(f.buff),f},x.ArrayBuffer.prototype.setState=function(f){return f.buff=S(f.buff,!0),x.prototype.setState.call(this,f)},x.ArrayBuffer.prototype.destroy=x.prototype.destroy,x.ArrayBuffer.prototype._finish=x.prototype._finish,x.ArrayBuffer.hash=function(f,l){var y=p(s(new Uint8Array(f)));return l?O(y):y},x}()),$t=wt(gi);const Nt=[];class he{static addHandler(e,t,o){e.addEventListener?e.addEventListener(t,o,!1):e.attachEvent?e.attachEvent("on"+t,o):e["on"+t]=o}static removeHandler(e,t,o){e.removeEventListener?e.removeEventListener(t,o,!1):e.detachEvent?e.detachEvent("on"+t,o):delete e["on"+t]}static windowResizeHandler(e){he.addHandler(window,"resize",e)}static offWindowResizeHandler(e){he.removeHandler(window,"resize",e)}static fullscreenEnabled(){const e=window.document;return document.fullscreenEnabled||window.fullScreen||e.mozFullscreenEnabled||e.webkitIsFullScreen}static fullScreen(e,t){if(t){const o=window.document;let r=window.document.exitFullscreen||o.msExitFullscreen||o.mozCancelFullScreen||o.webkitCancelFullScreen;typeof r<"u"&&r?r.call(window.document):typeof window.ActiveXObject<"u"&&new window.ActiveXObject("WScript.Shell")?.SendKeys("{F11}")}else{let o=e;o||(o=window.document.documentElement);let r=o.requestFullScreen||o.webkitRequestFullScreen||o.mozRequestFullScreen||o.msRequestFullScreen;typeof r<"u"&&r?r.call(o):typeof window.ActiveXObject<"u"&&new window.ActiveXObject("WScript.Shell")?.SendKeys("{F11}")}}static requestFullScreen(e=window.document.documentElement){let t=e;var o=t.requestFullScreen||t.webkitRequestFullScreen||t.mozRequestFullScreen||t.msRequestFullScreen;if(o)o.call(t);else if(typeof window.ActiveXObject<"u"){var r=new window.ActiveXObject("WScript.Shell");r!==null&&r.SendKeys("{F11}")}}static exitFullScreen(){const e=window.document;var t=document.exitFullscreen||e.mozCancelFullScreen||e.webkitExitFullscreen||e.webkitExitFullscreen;if(t)t.call(document);else if(typeof window.ActiveXObject<"u"){var o=new window.ActiveXObject("WScript.Shell");o!==null&&o.SendKeys("{F11}")}}static fullScreenElement(){return window.document.fullscreenElement||window.document.webkitFullscreenElement||window.document.mozFullscreenElement||window.document.msFullscreenElement}static isFullScreen(){return!!he.fullScreenElement()}static onFullScreenChanged(e){let t;"onfullscreenchange"in window.document?t="fullscreenchange":"onwebkitfullscreenchange"in window.document?t="webkitfullscreenchange":"onmozfullscreenchange"in window.document&&(t="mozfullscreenchange"),t?document.addEventListener(t,function(){const o=he.isFullScreen();e(o)}):document.addEventListener("MSFullscreenChange",function(){const o=he.isFullScreen();e(o)})}static stringifyCircularHandler(e,t){if(typeof t=="object"&&t!==null){if(Nt.indexOf(t)!==-1)return;Nt.push(t)}return t}static jsonStringify(e){if(!e)return"";const t=JSON.stringify(e,he.stringifyCircularHandler);return Nt.length=0,t}static jsonParse(e){const t=he.jsonStringify(e);if(t.length>1)return JSON.parse(t)}static getObjectURL(e){let t;const o=window;return o.createObjcectURL!=null?t=o.createOjcectURL(e):window.URL!=null?t=window.URL.createObjectURL(e):window.webkitURL!=null&&(t=window.webkitURL.createObjectURL(e)),t}static getFileShortMD5(e,t){const o=File.prototype,r=o.slice||o.mozSlice||o.webkitSlice,i=e,s=2097152,c=new $t.ArrayBuffer,p=new FileReader;p.onload=function(g){c.append(g.target?.result);const S=c.end();t({isOK:!0,data:S})},p.onerror=function(){t({isOK:!1,data:"计算文件简单摘要错误！"})},function(){const g=0+s>=i.size?i.size:0+s;p.readAsArrayBuffer(r.call(i,0,g))}()}static getFileMD5(e,t){const o=File.prototype,r=o.slice||o.mozSlice||o.webkitSlice,i=e,s=2097152,c=Math.ceil(i.size/s);let p=0;const g=new $t.ArrayBuffer,S=new FileReader;function k(){const B=p*s,O=B+s>=i.size?i.size:B+s;S.readAsArrayBuffer(r.call(i,B,O))}S.onload=function(B){if(g.append(B.target?.result),p++,p<c)k();else{const O=g.end();t({isOK:!0,data:O})}},S.onerror=function(){const B=`${i.name}:计算文件简单摘要错误！`;t({isOK:!1,data:B})},k()}static MD5(e,t=!1){return $t.hash(e,t)}static copyTextByCommand(e){return new Promise((t,o)=>{const r=document.createElement("input");r.value=e,document.body.appendChild(r),r.select(),document.execCommand("copy"),r.remove(),t(!0)})}static copyText=e=>navigator.clipboard?navigator.clipboard.writeText(e).then(function(){return!0},function(t){return!1}):he.copyTextByCommand(e);static copyElementTextByCommand(e){const t=document.createRange();t.selectNode(document.getElementById(e));const o=window.getSelection();o.rangeCount>0&&o.removeAllRanges(),o.addRange(t);try{return document.execCommand("copy"),o.removeRange(t),!0}catch{return o.removeRange(t),!1}}static copyElementText(e){if(!navigator.clipboard)return he.copyElementTextByCommand(e);const t=document.createRange();t.selectNode(document.getElementById(e));const o=window.getSelection();return o.rangeCount>0&&o.removeAllRanges(),o.addRange(t),navigator.clipboard.writeText(o).then(function(){return o.removeRange(t),!0},function(r){return o.removeRange(t),!1})}static setGrayMode(e){he.toggleClass(e,"grayMode",document.documentElement)}static toggleClass(e,t,o){const r=o||document.body;let{className:i}=r;i=i.replace(t,""),r.className=e?`${i} ${t} `:i}static setCssVar(e,t,o=document.documentElement){o.style.setProperty(e,t)}static dispatchWindowResize(){const e=new Event("resize");window.dispatchEvent(e)}static dispatchElementEvent(e,t="click",o){let r;if(r=Lo(e)?document.getElementById(e):e,r){const i=new Event(t,{bubbles:!0,cancelable:!0});o&&r.addEventListener("ev",s=>{o(s)},!1),r.dispatchEvent(i)}}static getRandomNum(e,t){var o=t-e,r=Math.random();return e+Math.round(r*o)}static merge(e={},t={}){let o,r,i,s;for(e||(e={}),r=0,i=t.length;r<i;r++)for(o in s=t[r],s)e[o]=s[o];return e}static setOptions(e,t){e.hasOwnProperty("options")||(e.options=e.options?Object.create(e.options):{});for(let o in t)e.options[o]=t[o];return e.options}static formatNum(e,t){let o=Math.pow(10,t===void 0?6:t);return Math.round(e*o)/o}static trim(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}static splitWords(e){return this.trim(e).split(/\s+/)}static emptyImageUrl(){return"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="}static debounce(e,t){let o=null;return function(){o&&clearTimeout(o),o=setTimeout(e,t)}}static throttle(e,t){let o=!0;return function(){if(!o)return!1;o=!1,setTimeout(()=>{e(),o=!0},t)}}static dataURLtoBlob(e){let t=e.split(",");if(!t||t.length===0)return;let o=t[0].match(/:(.*?);/)[1],r=atob(t[1]),i=r.length,s=new Uint8Array(i);for(;i--;)s[i]=r.charCodeAt(i);return new Blob([s],{type:o})}static getElement(e){return typeof e=="string"?document.getElementById(e):e}static getStyle(e,t){let o=e.style[t]||e.currentStyle&&e.currentStyle[t];if((!o||o==="auto")&&document.defaultView){let r=document.defaultView.getComputedStyle(e,null);o=r?r[t]:null}return o==="auto"?null:o}static create(e,t,o){let r=document.createElement(e);return r.className=t||"",o&&o.appendChild(r),r}static removeElement(e){let t=e.parentNode;t&&t.removeChild(e)}static emptyElement(e){for(;e.firstChild;)e.removeChild(e.firstChild)}static hasClass(e,t){if(e.classList!==void 0)return e.classList.contains(t);let o=this.getClass(e);return o.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(o)}static addClass(e,t){if(e.classList!==void 0){let o=this.splitWords(t);for(let r=0,i=o.length;r<i;r++)e.classList.add(o[r])}else if(!this.hasClass(e,t)){let o=this.getClass(e);this.setClass(e,(o?o+" ":"")+t)}}static removeClass(e,t){e.classList!==void 0?e.classList.remove(t):this.setClass(e,this.trim((" "+this.getClass(e)+" ").replace(" "+t+" "," ")))}static setClass(e,t){e.className.baseVal===void 0?e.className=t:e.className.baseVal=t}static getClass(e){return e.correspondingElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}static createSvgElement(e,t,o,r){let i=document.createElementNS("http://www.w3.org/2000/svg","svg:svg");i.setAttribute("class","svg-path"),i.setAttribute("width",e),i.setAttribute("height",t),i.setAttribute("viewBox",`0 0 ${e} ${t}`);let s=document.createElementNS("http://www.w3.org/2000/svg","path");return s.setAttribute("d",o),i.appendChild(s),r&&r.appendChild(i),i}static parseDom(e,t=!0,o=""){t=t??!1;let r=document.createElement("div");return r.className=o||"",r.innerHTML=e,t?r:r.childNodes}static createVideoHTML(e,t,o){let r=this.create("video",t,o),i=this.create("source","",r);i.setAttribute("src",e),i.setAttribute("type","video/map4");let s=this.create("source","",r);return s.setAttribute("src",e),s.setAttribute("type","video/quicktime"),r}}class Ao{static isNullOrEmpty=e=>e===null||e===""||e===void 0||e.length===0;static isNotEmpty=e=>!(e===null||e===""||e===void 0||e.length===0);static toHump(e){return e.replace(/[\-\/\_](\w)/g,(t,o)=>o.toUpperCase()).replace("views","")}}class Mo{prefixKey;storage;constructor(e="",t=localStorage){this.prefixKey=e,this.storage=t}getKey(e){return`${this.prefixKey}${e}`.toUpperCase()}set(e,t,o=604800){const r=JSON.stringify({value:t,expire:o!==null?new Date().getTime()+1e3*o:null});this.storage.setItem(this.getKey(e),r)}get(e,t=null){const o=this.storage.getItem(this.getKey(e));if(o)try{const r=JSON.parse(o),{value:i,expire:s}=r;if(s===null||s>=Date.now())return i;this.remove(this.getKey(e))}catch{return t}return t}getJsonObject(e){const t=this.storage.getItem(this.getKey(e));if(t)try{const o=JSON.parse(t);if(o.expire===null||o.expire>=Date.now())return o;this.remove(this.getKey(e))}catch{return}}remove(e){this.storage.removeItem(this.getKey(e))}clear(){this.storage.clear()}setCookie(e,t,o=604800){document.cookie=`${this.getKey(e)}=${t}; Max-Age=${o}`}getCookie(e){const t=document.cookie.split("; ");for(let o=0,r=t.length;o<r;o++){const i=t[o].split("=");if(i[0]===this.getKey(e))return i[1]}return""}removeCookie(e){this.setCookie(e,1,-1)}clearCookie(){const e=document.cookie.match(/[^ =;]+(?==)/g);if(e)for(let t=e.length;t--;)document.cookie=e[t]+"=0;expire="+new Date(0).toUTCString()}}function mi(){let n=[];const e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";for(var t=0;t<36;t++){const r=Math.floor(16*Math.random());n[t]=e.substring(r,r+1)}n[14]="4";const o=3&Number(n[19])|8;return n[19]=e.substring(o,o+1),n[8]=n[13]=n[18]=n[23]="-",n.join("")}var Fn;function hn(n){return{all:n=n||new Map,on(e,t){const o=n?.get(e);o&&o.push(t)||n?.set(e,[t])},off(e,t){const o=n?.get(e);o&&o.splice(o.indexOf(t)>>>0,1)},emit(e,t){(n?.get(e)||[]).slice().map(o=>{o(t)}),(n?.get("*")||[]).slice().map(o=>{o(e,t)})}}}(function(n){n[n.RGBA=0]="RGBA",n[n.Hex=1]="Hex",n[n.Hsla=2]="Hsla"})(Fn||(Fn={}));const We=hn(),ae={HproseServiceErrorEvent:"HproseServiceError",WebAPIErrorEvent:"WebAPIError",AlertInfoEvent:"AlertInfoEvent",CommonWarnEvent:"CommonWarnEvent",WidgetLoadedEvent:"WidgetLoaded",WidgetLoaded:"WidgetLoaded",WidgetUnLoadedEvent:"WidgetUnLoaded",WidgetLoadedErrorEvent:"WidgetLoadedError",WidgetVisibleChanged:"WidgetVisibleChanged",AxiosRequestErrorEvent:"AxiosRequestErrorEvent",LayoutContainerLoaded:"LayoutContainerLoaded"},Do=(n,e)=>{const t=document.createElement("a");t.download=e,t.style.display="none";const o=new Blob([n],{type:"application/octet-stream"});t.href=URL.createObjectURL(o),document.body.appendChild(t),t.click(),document.body.removeChild(t)};function $s(n,e){const t=window.URL||window.webkitURL||window,o=new Blob([n]),r=document.createElement("a");r.href=t.createObjectURL(o),r.download=e,r.click(),t.revokeObjectURL(r.href)}const vi=(n,e)=>{const t=JSON.stringify(n,null,2);e?Do(t,e+".json"):We.emit(ae.CommonWarnEvent,"参数JsonID不能为空！")},Ns=(n,e,t)=>{n.get(e,{responseType:"blob"}).then(function(o){Do(o.data,t)}).catch(o=>{We.emit(ae.CommonWarnEvent,"下载文件报错！")})};var Xn,zt={exports:{}},Vn,Kn,Wt,Ot=(Xn||(Xn=1,Kn=zt.exports,Wt=function(){var n=function(){},e="undefined",t=typeof window!==e&&typeof window.navigator!==e&&/Trident\/|MSIE /.test(window.navigator.userAgent),o=["trace","debug","info","warn","error"],r={},i=null;function s(x,f){var l=x[f];if(typeof l.bind=="function")return l.bind(x);try{return Function.prototype.bind.call(l,x)}catch{return function(){return Function.prototype.apply.apply(l,[x,arguments])}}}function c(){console.log&&(console.log.apply||Function.prototype.apply.apply(console.log,[console,arguments]))}function p(x){return x==="debug"&&(x="log"),typeof console!==e&&(x==="trace"&&t?c:console[x]!==void 0?s(console,x):console.log!==void 0?s(console,"log"):n)}function g(){for(var x=this.getLevel(),f=0;f<o.length;f++){var l=o[f];this[l]=f<x?n:this.methodFactory(l,x,this.name)}if(this.log=this.debug,typeof console===e&&x<this.levels.SILENT)return"No console available for logging"}function S(x){return function(){typeof console!==e&&(g.call(this),this[x].apply(this,arguments))}}function k(x,f,l){return p(x)||S.apply(this,arguments)}function B(x,f){var l,y,v,h=this,m="loglevel";function $(){var A;if(typeof window!==e&&m){try{A=window.localStorage[m]}catch{}if(typeof A===e)try{var N=window.document.cookie,j=encodeURIComponent(m),R=N.indexOf(j+"=");R!==-1&&(A=/^([^;]+)/.exec(N.slice(R+j.length+1))[1])}catch{}return h.levels[A]===void 0&&(A=void 0),A}}function M(A){var N=A;if(typeof N=="string"&&h.levels[N.toUpperCase()]!==void 0&&(N=h.levels[N.toUpperCase()]),typeof N=="number"&&N>=0&&N<=h.levels.SILENT)return N;throw new TypeError("log.setLevel() called with invalid level: "+A)}typeof x=="string"?m+=":"+x:typeof x=="symbol"&&(m=void 0),h.name=x,h.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},h.methodFactory=f||k,h.getLevel=function(){return v??y??l},h.setLevel=function(A,N){return v=M(A),N!==!1&&function(j){var R=(o[j]||"silent").toUpperCase();if(typeof window!==e&&m){try{return void(window.localStorage[m]=R)}catch{}try{window.document.cookie=encodeURIComponent(m)+"="+R+";"}catch{}}}(v),g.call(h)},h.setDefaultLevel=function(A){y=M(A),$()||h.setLevel(A,!1)},h.resetLevel=function(){v=null,function(){if(typeof window!==e&&m){try{window.localStorage.removeItem(m)}catch{}try{window.document.cookie=encodeURIComponent(m)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}(),g.call(h)},h.enableAll=function(A){h.setLevel(h.levels.TRACE,A)},h.disableAll=function(A){h.setLevel(h.levels.SILENT,A)},h.rebuild=function(){if(i!==h&&(l=M(i.getLevel())),g.call(h),i===h)for(var A in r)r[A].rebuild()},l=M(i?i.getLevel():"WARN");var D=$();D!=null&&(v=M(D)),g.call(h)}(i=new B).getLogger=function(x){if(typeof x!="symbol"&&typeof x!="string"||x==="")throw new TypeError("You must supply a name when creating a logger.");var f=r[x];return f||(f=r[x]=new B(x,i.methodFactory)),f};var O=typeof window!==e?window.log:void 0;return i.noConflict=function(){return typeof window!==e&&window.log===i&&(window.log=O),i},i.getLoggers=function(){return r},i.default=i,i},(Vn=zt).exports?Vn.exports=Wt():Kn.log=Wt()),zt.exports);class Po{message;eventBus;constructor(e,t){e&&(this.message=e),t&&(this.eventBus=t)}msg(e,t=3,o="success"){if(this.message)if(typeof this.message=="function")this.message({type:o,message:e,duration:t});else switch(o){case"info":this.message.info(e,t);break;case"success":this.message.success(e,t);break;case"warning":this.message.warn?this.message.warn(e,t):this.message.warning&&this.message.warning(e,t);break;case"error":this.message.error(e,t)}else{switch(o){case"info":case"success":break;case"warning":break;case"error":o="dark"}this.eventBus&&this.eventBus.emit(ae.AlertInfoEvent,{type:o,info:e})}}info(e,t=3){this.msg(e,t,"info")}warn(e,t=3){this.msg(e,t,"warning")}err(e,t=3){this.msg(e,t,"error")}success(e,t=3){this.msg(e,t,"success")}}let Gn=!1;const z={Config:SysConfig,EventBus:We,DefaultProxyClient:null,Axios:oi,Message:new Po(void 0,We),LayoutMap:new Map,getLayoutManager:n=>{if(!z.WidgetConfigList||z.WidgetConfigList.length===0)return;const e=z.WidgetConfigList.find(t=>t.id===n);if(e){const t=e.layoutID;if(t&&z.LayoutMap.has(t))return z.LayoutMap.get(t)}},Logger:n=>{Gn||(SysConfig.UI.ProductLog?Ot.enableAll():Ot.setDefaultLevel("warn"),Gn=!0);const e=n||"default";return Ot.getLogger(e)}},Bo="access_token",Me=new Mo("user",localStorage);function Oe(){return Me.get(Bo)}function $o(){Me.remove(Bo)}function yi(){return Oe()?.refresh}function dn(n,e,t,o="json",r){const i={baseURL:z.Config.ServiceURL.DefaultWebAPI,timeout:6e4,params:n,paramsSerializer:{serialize:function(s){return ri.stringify(s,{indices:!1,arrayFormat:"repeat"})}},headers:{"Content-Type":"application/json",Authorization:"bearer "+Oe()?.token},responseType:o,cancelToken:r};if(t)for(let s in t)i.headers[s]=t[s];return z.SystemID&&(i.headers.sysid=z.SystemID,z.SystemGroup&&(i.headers.sysgroup=z.SystemGroup)),e&&(i.baseURL=e),i}function ke(n,e,t,o,r="json",i,s){const c=dn(t,e,o,r,i);return s&&s>=2e4&&(c.timeout=s),z.Axios?.get(n,c).catch(function(p){fn(p,e,n,"Get")})}function fn(n,e,t,o="Get"){const r=`${e}${t}`;if(n&&n.response){let i=!1;const s=n.response.status;switch(s){case 400:n.message="错误请求";break;case 401:n.message="未授权，请重新登录";break;case 403:n.message="拒绝访问";break;case 404:n.message="请求错误,未找到该资源";break;case 405:n.message="请求方法未允许";break;case 408:n.message="请求超时";break;case 500:const p=n.response.data;if(p){const g=p.indexOf(":"),S=p.indexOf(`
`);if(g>0&&S-g>2){const k=p.substring(g+2,S);k.indexOf("System.Exception")>0?n.message="后台服务内部出错！":(i=!0,n.message=k)}else i=!0,n.message=p}else n.message="服务器端出错";break;case 501:n.message="网络未实现";break;case 502:n.message="网络错误";break;case 503:n.message="服务不可用";break;case 504:n.message="网络超时";break;case 505:n.message="http版本不支持该请求";break;default:n.message=`连接错误${n.response.status}`}let c={address:r,code:s,isExceptionInfo:i,message:n.message,result:n.response.data};if(z.EventBus.emit(ae.AxiosRequestErrorEvent,c),i)throw new Error(n.message)}else if(n?.message)throw new Error(n.message)}function zs(n,e,t,o,r,i="json",s){const c=dn(o,e,r,i);c.headers["Content-Type"]="multipart/form-data";const p=function(g){let S=new FormData;return g&&Object.keys(g).forEach(k=>{if(!g)return;let B=g[k];B!=null&&(pi(B)?B.forEach(O=>{S.append(k,Yn(O))}):S.append(k,Yn(B)))}),S}(t);return z.Axios?.post(n,p,c).catch(function(g){fn(g,e,n,"Post")})}function wi(n,e,t,o,r,i="json",s){const c=dn(o,e,r,i);return z.Axios?.post(n,t,c).catch(function(p){fn(p,e,n,"Post")})}function Ws(n,e){return ke(n,void 0,e)}function Yn(n){return n instanceof Blob?n:n.toString()}var Jn,Qn,jt,Zn,Ut,eo,Ht,to,no,Qe={exports:{}};function bi(){return Qn?Jn:(Qn=1,n=typeof window<"u"?window:Ne!==void 0?Ne:typeof self<"u"?self:{},Jn=n);var n}function _i(){if(Zn)return jt;Zn=1,jt=function(e){if(!e)return!1;var t=n.call(e);return t==="[object Function]"||typeof e=="function"&&t!=="[object RegExp]"||typeof window<"u"&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)};var n=Object.prototype.toString;return jt}function Si(){if(eo)return Ut;eo=1;var n=function(e){return e.replace(/^\s+|\s+$/g,"")};return Ut=function(e){if(!e)return{};for(var t,o={},r=n(e).split(`
`),i=0;i<r.length;i++){var s=r[i],c=s.indexOf(":"),p=n(s.slice(0,c)).toLowerCase(),g=n(s.slice(c+1));o[p]===void 0?o[p]=g:(t=o[p],Object.prototype.toString.call(t)==="[object Array]"?o[p].push(g):o[p]=[o[p],g])}return o},Ut}var Ci=function(){if(no)return Qe.exports;no=1;var n=bi(),e=_i(),t=Si(),o=function(){if(to)return Ht;to=1,Ht=function(){for(var p={},g=0;g<arguments.length;g++){var S=arguments[g];for(var k in S)c.call(S,k)&&(p[k]=S[k])}return p};var c=Object.prototype.hasOwnProperty;return Ht}();function r(c,p,g){var S=c;return e(p)?(g=p,typeof c=="string"&&(S={uri:c})):S=o(p,{uri:c}),S.callback=g,S}function i(c,p,g){return s(p=r(c,p,g))}function s(c){if(c.callback===void 0)throw new Error("callback argument missing");var p=!1,g=function(A,N,j){p||(p=!0,c.callback(A,N,j))};function S(){var A=void 0;if(A=f.response?f.response:f.responseText||function(N){try{if(N.responseType==="document")return N.responseXML;var j=N.responseXML&&N.responseXML.documentElement.nodeName==="parsererror";if(N.responseType===""&&!j)return N.responseXML}catch{}return null}(f),M)try{A=JSON.parse(A)}catch{}return A}function k(A){return clearTimeout(l),A instanceof Error||(A=new Error(""+(A||"Unknown XMLHttpRequest Error"))),A.statusCode=0,g(A,D)}function B(){if(!x){var A;clearTimeout(l),A=c.useXDR&&f.status===void 0?200:f.status===1223?204:f.status;var N=D,j=null;return A!==0?(N={body:S(),statusCode:A,method:v,headers:{},url:y,rawRequest:f},f.getAllResponseHeaders&&(N.headers=t(f.getAllResponseHeaders()))):j=new Error("Internal XMLHttpRequest Error"),g(j,N,N.body)}}var O,x,f=c.xhr||null;f||(f=c.cors||c.useXDR?new i.XDomainRequest:new i.XMLHttpRequest);var l,y=f.url=c.uri||c.url,v=f.method=c.method||"GET",h=c.body||c.data,m=f.headers=c.headers||{},$=!!c.sync,M=!1,D={body:void 0,headers:{},statusCode:0,method:v,url:y,rawRequest:f};if("json"in c&&c.json!==!1&&(M=!0,m.accept||m.Accept||(m.Accept="application/json"),v!=="GET"&&v!=="HEAD"&&(m["content-type"]||m["Content-Type"]||(m["Content-Type"]="application/json"),h=JSON.stringify(c.json===!0?h:c.json))),f.onreadystatechange=function(){f.readyState===4&&setTimeout(B,0)},f.onload=B,f.onerror=k,f.onprogress=function(){},f.onabort=function(){x=!0},f.ontimeout=k,f.open(v,y,!$,c.username,c.password),$||(f.withCredentials=!!c.withCredentials),!$&&c.timeout>0&&(l=setTimeout(function(){if(!x){x=!0,f.abort("timeout");var A=new Error("XMLHttpRequest timeout");A.code="ETIMEDOUT",k(A)}},c.timeout)),f.setRequestHeader)for(O in m)m.hasOwnProperty(O)&&f.setRequestHeader(O,m[O]);else if(c.headers&&!function(A){for(var N in A)if(A.hasOwnProperty(N))return!1;return!0}(c.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in c&&(f.responseType=c.responseType),"beforeSend"in c&&typeof c.beforeSend=="function"&&c.beforeSend(f),f.send(h||null),f}return Qe.exports=i,Qe.exports.default=i,i.XMLHttpRequest=n.XMLHttpRequest||function(){},i.XDomainRequest="withCredentials"in new i.XMLHttpRequest?i.XMLHttpRequest:n.XDomainRequest,function(c,p){for(var g=0;g<c.length;g++)p(c[g])}(["get","put","post","patch","head","delete"],function(c){i[c==="delete"?"del":c]=function(p,g,S){return(g=r(p,g,S)).method=c.toUpperCase(),s(g)}}),Qe.exports}(),Ei=wt(Ci);const ki=[200,201,202,204,308],Ii=[408,502,503,504];class xi{endpoint;file;headers;method;chunkSize;attempts;delayBeforeAttempt;md5;chunk;chunkCount;chunkByteSize;maxFileBytes;endpointValue;totalChunks;attemptCount;offline;paused;success;currentXhr;reader;eventTarget;fileName;constructor(e){this.endpoint=e.endpoint,this.file=e.file,this.fileName=encodeURI(this.file.name),this.headers=e.headers||{},this.method=e.method||"PUT",this.chunkSize=e.chunkSize||5120,this.attempts=e.attempts||5,this.delayBeforeAttempt=e.delayBeforeAttempt||1,this.md5=e.md5||"",this.maxFileBytes=1024*(e.maxFileSize||0),this.chunkCount=0,this.chunkByteSize=1024*this.chunkSize,this.totalChunks=Math.ceil(this.file.size/this.chunkByteSize),this.attemptCount=0,this.offline=!1,this.paused=!1,this.success=!1,this.reader=new FileReader,this.eventTarget=hn(),this.validateOptions(),this.getEndpoint().then(()=>this.sendChunks()),typeof window<"u"&&(window.addEventListener("online",()=>{this.offline&&(this.offline=!1,this.dispatch("online"),this.sendChunks())}),window.addEventListener("offline",()=>{this.offline=!0,this.dispatch("offline")}))}on(e,t){this.eventTarget.on(e,t)}abort(){this.pause(),this.currentXhr?.abort()}pause(){this.paused=!0}resume(){this.paused&&(this.paused=!1,this.sendChunks())}dispatch(e,t){this.eventTarget.emit(e,t)}validateOptions(){if(!this.endpoint||typeof this.endpoint!="function"&&typeof this.endpoint!="string")throw new TypeError("endpoint必须为：文件上传URL字符串，或返回地址的函数！");if(!(this.file instanceof File))throw new TypeError("file必须为文件对象");if(this.headers&&typeof this.headers!="object")throw new TypeError("文件头必须为对象或空！");if(this.chunkSize&&(typeof this.chunkSize!="number"||this.chunkSize<=0||this.chunkSize%256!=0))throw new TypeError("chunkSize必须大于0,并是256的整数倍");if(this.maxFileBytes>0&&this.maxFileBytes<this.file.size)throw new Error(`文件大小超过最大允许值：(${this.file.size} > ${this.maxFileBytes})`);if(this.attempts&&(typeof this.attempts!="number"||this.attempts<=0))throw new TypeError("重试次数必须为正数！");if(this.delayBeforeAttempt&&(typeof this.delayBeforeAttempt!="number"||this.delayBeforeAttempt<0))throw new TypeError("延时重试时间必须为正数！默认为1")}getEndpoint(){return typeof this.endpoint=="string"?(this.endpointValue=this.endpoint,Promise.resolve(this.endpoint)):this.endpoint(this.file).then(e=>(this.endpointValue=e,this.endpointValue))}getChunk(){return new Promise(e=>{const t=this.totalChunks===1?this.file.size:this.chunkByteSize,o=t*this.chunkCount;this.reader.onload=()=>{this.reader.result!==null&&(this.chunk=new Blob([this.reader.result],{type:"application/octet-stream"})),e(()=>{})},this.reader.readAsArrayBuffer(this.file.slice(o,o+t))})}xhrPromise(e){const t=o=>{o.upload.onprogress=r=>{const i=100/this.totalChunks,s=i*this.file.size,c=i*this.chunkCount,p=r.loaded/(r.total??s)*i;this.dispatch("progress",Math.min(c+p,100))}};return new Promise((o,r)=>{this.currentXhr=Ei({...e,beforeSend:t},(i,s)=>(this.currentXhr=void 0,i?r(i):o(s)))})}sendChunk(){if(!this.chunk)return;const e=this.chunkCount*this.chunkByteSize,t=e+this.chunk.size-1,o={...this.headers,FileName:this.fileName,FileMD5:this.md5,"Content-Type":this.file.type,"Content-Range":`bytes ${e}-${t}/${this.file.size}`};if(this.dispatch("attempt",{chunkNumber:this.chunkCount,chunkSize:this.chunk.size}),this.endpointValue)return this.xhrPromise({headers:o,url:this.endpointValue,method:this.method,body:this.chunk});this.dispatch("error",{message:"文件上传endpointValue不能为空！取消上传！",chunk:this.chunkCount,attempts:this.attemptCount})}manageRetries(){if(this.attemptCount<this.attempts)return setTimeout(()=>this.sendChunks(),1e3*this.delayBeforeAttempt),void this.dispatch("attemptFailure",{message:`上传分片：${this.chunkCount}失败。还会再尝试 ${this.attempts-this.attemptCount}次！`,chunkNumber:this.chunkCount,attemptsLeft:this.attempts-this.attemptCount});this.dispatch("error",{message:`上传分片错误： ${this.chunkCount}。停止尝试，取消上传！`,chunk:this.chunkCount,attempts:this.attemptCount})}sendChunks(){!(this.paused||this.offline||this.success)&&this.getChunk().then(()=>this.sendChunk()).then(e=>{if(this.attemptCount=this.attemptCount+1,e!=null&&ki.includes(e.statusCode)){this.dispatch("chunkSuccess",{chunk:this.chunkCount,attempts:this.attemptCount,response:e}),this.attemptCount=0,this.chunkCount=this.chunkCount+1,this.chunkCount<this.totalChunks?this.sendChunks():(this.success=!0,this.dispatch("success"));const t=this.chunkCount/this.totalChunks*this.file.size*100/this.file.size;this.dispatch("progress",t)}else if(e!=null&&Ii.includes(e.statusCode)){if(this.paused||this.offline)return;this.manageRetries()}else{if(this.paused||this.offline)return;this.dispatch("error",{message:`服务器错误:${e?.statusCode}，停止上传。`,chunkNumber:this.chunkCount,attempts:this.attemptCount})}}).catch(e=>{this.paused||this.offline||this.manageRetries()})}}const Os=n=>new xi(n);class ht{hproseURL;client;hproseProxy;static httpTransport;constructor(e){if(e&&!Ao.isNullOrEmpty(e)){if(ht.httpTransport||(ht.httpTransport=new si),this.client=new ai(e),!this.client)throw Error("Hprose Client初始化错误");this.hproseURL=e,this.init()}}init(){this.client&&this.client.useServiceAsync().then(e=>{this.hproseProxy=e}).catch(e=>{String(e).indexOf("find this method ~")>0?this.hproseProxy=this.client?.useService():We.emit(ae.HproseServiceErrorEvent,"初始化默认Hprose!")})}async getProxy(){if(!this.hproseProxy)try{this.client&&(this.hproseProxy=await this.client.useServiceAsync())}catch{this.hproseProxy=this.client?.useService()}return this.hproseProxy}async invoke(e,t,o){if(this.client)return await this.client.invoke(e,t,o)}encode(e,t,o){if(this.client)return this.client.codec.encode(e,t,o)}decode(e,t){if(this.client)return this.client.codec.decode(e,t)}}class Ti{hproseClient;hpProxyObj;defaultContext=new Dt;constructor(e){this.hproseClient=new ht(e),this.hpProxyObj=null}getClientContext(e,t){const o={};t&&(o.requestHeaders=t);const r=Oe();o.httpRequestHeaders=e||{};const i=o.httpRequestHeaders;return r&&(i.token=r.token),z.SystemID&&(i.sysid=z.SystemID,z.SystemGroup&&(i.sysgroup=z.SystemGroup)),new Dt(o)}async getHproseProxy(){if(!this.hproseClient)throw new Error("HproseClient对象为构建，无法调用Hprose方法");if(!this.hpProxyObj){const e=await this.hproseClient.getProxy();this.hpProxyObj=e}return this.hpProxyObj||We.emit(ae.HproseServiceErrorEvent,"HproseProxy对象为空，无法调用Hprose方法！"),this.hpProxyObj}async hproseInvoke(e,t,o){if(!this.hproseClient)throw new Error("HproseClient对象为构建，无法调用Hprose方法");return await this.hproseClient.invoke(e,t,o)}async hproseInvokeContext(e,t,...o){if(!this.hproseClient)throw new Error("HproseClient对象为构建，无法调用Hprose方法");const r=Oe();return r&&(t||(t=new Dt({httpRequestHeaders:{token:r.token}}))),await this.hproseClient.invoke(e,o,t)}async hproseInvokeEncode(e){const t=new Ee(e).toBytes(),o=await this.hproseClient.client?.request(t,this.defaultContext);return o&&this.hproseClient.client?.codec.decode(o,this.defaultContext)}encodeRequest(e,...t){const o=this.hproseClient.client?.codec?.encode(e,t,this.defaultContext);return Ee.toString(o)}}const js=function(n,e,t){!z.Config.DefaultHproseAPI&&z.Config.ServiceURL&&(z.Config.DefaultHproseAPI=z.Config.ServiceURL.DefaultHproseAPI),z.Config.DefaultHproseAPI&&Ao.isNotEmpty(z.Config.DefaultHproseAPI)&&(z.DefaultProxyClient=new Ti(z.Config.DefaultHproseAPI));const o=z.Config.UI.GrayMode;o&&he.setGrayMode(o);const r=new Po(n,z.EventBus);z.Message=r,z.SystemID=e,z.SystemGroup=t,z.EventBus.on(ae.HproseServiceErrorEvent,i=>{const s=`当前后台业务服务不可用!${i}`}),z.EventBus.on(ae.WebAPIErrorEvent,i=>{const s=`WebAPI后台服务不可用!${i}`}),z.EventBus.on(ae.AxiosRequestErrorEvent,i=>{const s=`Http请求'${i.code}'错误: ${i.message}`}),z.EventBus.on(ae.CommonWarnEvent,i=>{r.warn(i)})},No="is_LockScreen",oo=Me.get(No,!1),Fe={isLock:oo,lockTime:oo=="true"?zo():0};function ro(n){Fe.isLock=n,Me.set(No,n,10),n&&$o()}function zo(){let n=3600;return z.Config.UI?.LockTime&&z.Config.UI?.LockTime>=10&&(n=z.Config.UI.LockTime),n}let qt;function en(){clearInterval(qt),!(window.location.href.indexOf("/login")>0||Fe.isLock)&&(ro(!1),Fe.lockTime=zo(),qt=setInterval(()=>{if(Fe.lockTime--,Fe.lockTime<=0)return ro(!0),clearInterval(qt)},1e3))}function Us(){en(),document.addEventListener("mousedown",en)}function Hs(){document.removeEventListener("mousedown",en)}function Ft(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var io,so={exports:{}};/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/var ao,Ri=io?so.exports:(io=1,so.exports=function n(e,t,o){function r(c,p){if(!t[c]){if(!e[c]){if(!p&&Ft)return Ft(c);if(i)return i(c,!0);var g=new Error("Cannot find module '"+c+"'");throw g.code="MODULE_NOT_FOUND",g}var S=t[c]={exports:{}};e[c][0].call(S.exports,function(k){var B=e[c][1][k];return r(B||k)},S,S.exports,n,e,t,o)}return t[c].exports}for(var i=Ft,s=0;s<o.length;s++)r(o[s]);return r}({1:[function(n,e,t){(function(o){var r,i,s=o.MutationObserver||o.WebKitMutationObserver;if(s){var c=0,p=new s(B),g=o.document.createTextNode("");p.observe(g,{characterData:!0}),r=function(){g.data=c=++c%2}}else if(o.setImmediate||o.MessageChannel===void 0)r="document"in o&&"onreadystatechange"in o.document.createElement("script")?function(){var x=o.document.createElement("script");x.onreadystatechange=function(){B(),x.onreadystatechange=null,x.parentNode.removeChild(x),x=null},o.document.documentElement.appendChild(x)}:function(){setTimeout(B,0)};else{var S=new o.MessageChannel;S.port1.onmessage=B,r=function(){S.port2.postMessage(0)}}var k=[];function B(){var x,f;i=!0;for(var l=k.length;l;){for(f=k,k=[],x=-1;++x<l;)f[x]();l=k.length}i=!1}function O(x){k.push(x)!==1||i||r()}e.exports=O}).call(this,Ne!==void 0?Ne:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(n,e,t){var o=n(1);function r(){}var i={},s=["REJECTED"],c=["FULFILLED"],p=["PENDING"];function g(h){if(typeof h!="function")throw new TypeError("resolver must be a function");this.state=p,this.queue=[],this.outcome=void 0,h!==r&&O(this,h)}function S(h,m,$){this.promise=h,typeof m=="function"&&(this.onFulfilled=m,this.callFulfilled=this.otherCallFulfilled),typeof $=="function"&&(this.onRejected=$,this.callRejected=this.otherCallRejected)}function k(h,m,$){o(function(){var M;try{M=m($)}catch(D){return i.reject(h,D)}M===h?i.reject(h,new TypeError("Cannot resolve promise with itself")):i.resolve(h,M)})}function B(h){var m=h&&h.then;if(h&&(typeof h=="object"||typeof h=="function")&&typeof m=="function")return function(){m.apply(h,arguments)}}function O(h,m){var $=!1;function M(j){$||($=!0,i.reject(h,j))}function D(j){$||($=!0,i.resolve(h,j))}function A(){m(D,M)}var N=x(A);N.status==="error"&&M(N.value)}function x(h,m){var $={};try{$.value=h(m),$.status="success"}catch(M){$.status="error",$.value=M}return $}function f(h){return h instanceof this?h:i.resolve(new this(r),h)}function l(h){var m=new this(r);return i.reject(m,h)}function y(h){var m=this;if(Object.prototype.toString.call(h)!=="[object Array]")return this.reject(new TypeError("must be an array"));var $=h.length,M=!1;if(!$)return this.resolve([]);for(var D=new Array($),A=0,N=-1,j=new this(r);++N<$;)R(h[N],N);return j;function R(H,F){function ce(oe){D[F]=oe,++A!==$||M||(M=!0,i.resolve(j,D))}m.resolve(H).then(ce,function(oe){M||(M=!0,i.reject(j,oe))})}}function v(h){var m=this;if(Object.prototype.toString.call(h)!=="[object Array]")return this.reject(new TypeError("must be an array"));var $=h.length,M=!1;if(!$)return this.resolve([]);for(var D=-1,A=new this(r);++D<$;)N(h[D]);return A;function N(j){m.resolve(j).then(function(R){M||(M=!0,i.resolve(A,R))},function(R){M||(M=!0,i.reject(A,R))})}}e.exports=g,g.prototype.catch=function(h){return this.then(null,h)},g.prototype.then=function(h,m){if(typeof h!="function"&&this.state===c||typeof m!="function"&&this.state===s)return this;var $=new this.constructor(r);return this.state!==p?k($,this.state===c?h:m,this.outcome):this.queue.push(new S($,h,m)),$},S.prototype.callFulfilled=function(h){i.resolve(this.promise,h)},S.prototype.otherCallFulfilled=function(h){k(this.promise,this.onFulfilled,h)},S.prototype.callRejected=function(h){i.reject(this.promise,h)},S.prototype.otherCallRejected=function(h){k(this.promise,this.onRejected,h)},i.resolve=function(h,m){var $=x(B,m);if($.status==="error")return i.reject(h,$.value);var M=$.value;if(M)O(h,M);else{h.state=c,h.outcome=m;for(var D=-1,A=h.queue.length;++D<A;)h.queue[D].callFulfilled(m)}return h},i.reject=function(h,m){h.state=s,h.outcome=m;for(var $=-1,M=h.queue.length;++$<M;)h.queue[$].callRejected(m);return h},g.resolve=f,g.reject=l,g.all=y,g.race=v},{1:1}],3:[function(n,e,t){(function(o){typeof o.Promise!="function"&&(o.Promise=n(2))}).call(this,Ne!==void 0?Ne:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(n,e,t){var o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};function r(a,u){if(!(a instanceof u))throw new TypeError("Cannot call a class as a function")}function i(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var s=i();function c(){try{if(!s||!s.open)return!1;var a=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),u=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!a||u)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function p(a,u){a=a||[],u=u||{};try{return new Blob(a,u)}catch(w){if(w.name!=="TypeError")throw w;for(var d=new(typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder),b=0;b<a.length;b+=1)d.append(a[b]);return d.getBlob(u.type)}}typeof Promise>"u"&&n(3);var g=Promise;function S(a,u){u&&a.then(function(d){u(null,d)},function(d){u(d)})}function k(a,u,d){typeof u=="function"&&a.then(u),typeof d=="function"&&a.catch(d)}function B(a){return typeof a!="string"&&(a=String(a)),a}function O(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var x="local-forage-detect-blob-support",f=void 0,l={},y=Object.prototype.toString,v="readonly",h="readwrite";function m(a){for(var u=a.length,d=new ArrayBuffer(u),b=new Uint8Array(d),w=0;w<u;w++)b[w]=a.charCodeAt(w);return d}function $(a){return new g(function(u){var d=a.transaction(x,h),b=p([""]);d.objectStore(x).put(b,"key"),d.onabort=function(w){w.preventDefault(),w.stopPropagation(),u(!1)},d.oncomplete=function(){var w=navigator.userAgent.match(/Chrome\/(\d+)/),_=navigator.userAgent.match(/Edge\//);u(_||!w||parseInt(w[1],10)>=43)}}).catch(function(){return!1})}function M(a){return typeof f=="boolean"?g.resolve(f):$(a).then(function(u){return f=u})}function D(a){var u=l[a.name],d={};d.promise=new g(function(b,w){d.resolve=b,d.reject=w}),u.deferredOperations.push(d),u.dbReady?u.dbReady=u.dbReady.then(function(){return d.promise}):u.dbReady=d.promise}function A(a){var u=l[a.name].deferredOperations.pop();if(u)return u.resolve(),u.promise}function N(a,u){var d=l[a.name].deferredOperations.pop();if(d)return d.reject(u),d.promise}function j(a,u){return new g(function(d,b){if(l[a.name]=l[a.name]||wn(),a.db){if(!u)return d(a.db);D(a),a.db.close()}var w=[a.name];u&&w.push(a.version);var _=s.open.apply(s,w);u&&(_.onupgradeneeded=function(C){var I=_.result;try{I.createObjectStore(a.storeName),C.oldVersion<=1&&I.createObjectStore(x)}catch(T){if(T.name!=="ConstraintError")throw T}}),_.onerror=function(C){C.preventDefault(),b(_.error)},_.onsuccess=function(){var C=_.result;C.onversionchange=function(I){I.target.close()},d(C),A(a)}})}function R(a){return j(a,!1)}function H(a){return j(a,!0)}function F(a,u){if(!a.db)return!0;var d=!a.db.objectStoreNames.contains(a.storeName),b=a.version<a.db.version,w=a.version>a.db.version;if(b&&(a.version,a.version=a.db.version),w||d){if(d){var _=a.db.version+1;_>a.version&&(a.version=_)}return!0}return!1}function ce(a){return new g(function(u,d){var b=new FileReader;b.onerror=d,b.onloadend=function(w){var _=btoa(w.target.result||"");u({__local_forage_encoded_blob:!0,data:_,type:a.type})},b.readAsBinaryString(a)})}function oe(a){return p([m(atob(a.data))],{type:a.type})}function ve(a){return a&&a.__local_forage_encoded_blob}function Ge(a){var u=this,d=u._initReady().then(function(){var b=l[u._dbInfo.name];if(b&&b.dbReady)return b.dbReady});return k(d,a,a),d}function St(a){D(a);for(var u=l[a.name],d=u.forages,b=0;b<d.length;b++){var w=d[b];w._dbInfo.db&&(w._dbInfo.db.close(),w._dbInfo.db=null)}return a.db=null,R(a).then(function(_){return a.db=_,F(a)?H(a):_}).then(function(_){a.db=u.db=_;for(var C=0;C<d.length;C++)d[C]._dbInfo.db=_}).catch(function(_){throw N(a,_),_})}function pe(a,u,d,b){b===void 0&&(b=1);try{var w=a.db.transaction(a.storeName,u);d(null,w)}catch(_){if(b>0&&(!a.db||_.name==="InvalidStateError"||_.name==="NotFoundError"))return g.resolve().then(function(){if(!a.db||_.name==="NotFoundError"&&!a.db.objectStoreNames.contains(a.storeName)&&a.version<=a.db.version)return a.db&&(a.version=a.db.version+1),H(a)}).then(function(){return St(a).then(function(){pe(a,u,d,b-1)})}).catch(d);d(_)}}function wn(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function Qo(a){var u=this,d={db:null};if(a)for(var b in a)d[b]=a[b];var w=l[d.name];w||(w=wn(),l[d.name]=w),w.forages.push(u),u._initReady||(u._initReady=u.ready,u.ready=Ge);var _=[];function C(){return g.resolve()}for(var I=0;I<w.forages.length;I++){var T=w.forages[I];T!==u&&_.push(T._initReady().catch(C))}var L=w.forages.slice(0);return g.all(_).then(function(){return d.db=w.db,R(d)}).then(function(P){return d.db=P,F(d,u._defaultConfig.version)?H(d):P}).then(function(P){d.db=w.db=P,u._dbInfo=d;for(var W=0;W<L.length;W++){var q=L[W];q!==u&&(q._dbInfo.db=d.db,q._dbInfo.version=d.version)}})}function Zo(a,u){var d=this;a=B(a);var b=new g(function(w,_){d.ready().then(function(){pe(d._dbInfo,v,function(C,I){if(C)return _(C);try{var T=I.objectStore(d._dbInfo.storeName).get(a);T.onsuccess=function(){var L=T.result;L===void 0&&(L=null),ve(L)&&(L=oe(L)),w(L)},T.onerror=function(){_(T.error)}}catch(L){_(L)}})}).catch(_)});return S(b,u),b}function er(a,u){var d=this,b=new g(function(w,_){d.ready().then(function(){pe(d._dbInfo,v,function(C,I){if(C)return _(C);try{var T=I.objectStore(d._dbInfo.storeName).openCursor(),L=1;T.onsuccess=function(){var P=T.result;if(P){var W=P.value;ve(W)&&(W=oe(W));var q=a(W,P.key,L++);q!==void 0?w(q):P.continue()}else w()},T.onerror=function(){_(T.error)}}catch(P){_(P)}})}).catch(_)});return S(b,u),b}function tr(a,u,d){var b=this;a=B(a);var w=new g(function(_,C){var I;b.ready().then(function(){return I=b._dbInfo,y.call(u)==="[object Blob]"?M(I.db).then(function(T){return T?u:ce(u)}):u}).then(function(T){pe(b._dbInfo,h,function(L,P){if(L)return C(L);try{var W=P.objectStore(b._dbInfo.storeName);T===null&&(T=void 0);var q=W.put(T,a);P.oncomplete=function(){T===void 0&&(T=null),_(T)},P.onabort=P.onerror=function(){var V=q.error?q.error:q.transaction.error;C(V)}}catch(V){C(V)}})}).catch(C)});return S(w,d),w}function nr(a,u){var d=this;a=B(a);var b=new g(function(w,_){d.ready().then(function(){pe(d._dbInfo,h,function(C,I){if(C)return _(C);try{var T=I.objectStore(d._dbInfo.storeName).delete(a);I.oncomplete=function(){w()},I.onerror=function(){_(T.error)},I.onabort=function(){var L=T.error?T.error:T.transaction.error;_(L)}}catch(L){_(L)}})}).catch(_)});return S(b,u),b}function or(a){var u=this,d=new g(function(b,w){u.ready().then(function(){pe(u._dbInfo,h,function(_,C){if(_)return w(_);try{var I=C.objectStore(u._dbInfo.storeName).clear();C.oncomplete=function(){b()},C.onabort=C.onerror=function(){var T=I.error?I.error:I.transaction.error;w(T)}}catch(T){w(T)}})}).catch(w)});return S(d,a),d}function rr(a){var u=this,d=new g(function(b,w){u.ready().then(function(){pe(u._dbInfo,v,function(_,C){if(_)return w(_);try{var I=C.objectStore(u._dbInfo.storeName).count();I.onsuccess=function(){b(I.result)},I.onerror=function(){w(I.error)}}catch(T){w(T)}})}).catch(w)});return S(d,a),d}function ir(a,u){var d=this,b=new g(function(w,_){a<0?w(null):d.ready().then(function(){pe(d._dbInfo,v,function(C,I){if(C)return _(C);try{var T=I.objectStore(d._dbInfo.storeName),L=!1,P=T.openKeyCursor();P.onsuccess=function(){var W=P.result;W?a===0||L?w(W.key):(L=!0,W.advance(a)):w(null)},P.onerror=function(){_(P.error)}}catch(W){_(W)}})}).catch(_)});return S(b,u),b}function sr(a){var u=this,d=new g(function(b,w){u.ready().then(function(){pe(u._dbInfo,v,function(_,C){if(_)return w(_);try{var I=C.objectStore(u._dbInfo.storeName).openKeyCursor(),T=[];I.onsuccess=function(){var L=I.result;L?(T.push(L.key),L.continue()):b(T)},I.onerror=function(){w(I.error)}}catch(L){w(L)}})}).catch(w)});return S(d,a),d}function ar(a,u){u=O.apply(this,arguments);var d=this.config();(a=typeof a!="function"&&a||{}).name||(a.name=a.name||d.name,a.storeName=a.storeName||d.storeName);var b,w=this;if(a.name){var _=a.name===d.name&&w._dbInfo.db?g.resolve(w._dbInfo.db):R(a).then(function(C){var I=l[a.name],T=I.forages;I.db=C;for(var L=0;L<T.length;L++)T[L]._dbInfo.db=C;return C});b=a.storeName?_.then(function(C){if(C.objectStoreNames.contains(a.storeName)){var I=C.version+1;D(a);var T=l[a.name],L=T.forages;C.close();for(var P=0;P<L.length;P++){var W=L[P];W._dbInfo.db=null,W._dbInfo.version=I}var q=new g(function(V,K){var re=s.open(a.name,I);re.onerror=function(be){re.result.close(),K(be)},re.onupgradeneeded=function(){re.result.deleteObjectStore(a.storeName)},re.onsuccess=function(){var be=re.result;be.close(),V(be)}});return q.then(function(V){T.db=V;for(var K=0;K<L.length;K++){var re=L[K];re._dbInfo.db=V,A(re._dbInfo)}}).catch(function(V){throw(N(a,V)||g.resolve()).catch(function(){}),V})}}):_.then(function(C){D(a);var I=l[a.name],T=I.forages;C.close();for(var L=0;L<T.length;L++)T[L]._dbInfo.db=null;var P=new g(function(W,q){var V=s.deleteDatabase(a.name);V.onerror=function(){var K=V.result;K&&K.close(),q(V.error)},V.onblocked=function(){},V.onsuccess=function(){var K=V.result;K&&K.close(),W(K)}});return P.then(function(W){I.db=W;for(var q=0;q<T.length;q++)A(T[q]._dbInfo)}).catch(function(W){throw(N(a,W)||g.resolve()).catch(function(){}),W})})}else b=g.reject("Invalid arguments");return S(b,u),b}var cr={_driver:"asyncStorage",_initStorage:Qo,_support:c(),iterate:er,getItem:Zo,setItem:tr,removeItem:nr,clear:or,length:rr,key:ir,keys:sr,dropInstance:ar};function lr(){return typeof openDatabase=="function"}var _e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ur="~~local_forage_type~",bn=/^~~local_forage_type~([^~]+)~/,Ye="__lfsc__:",Ct=Ye.length,Et="arbf",kt="blob",_n="si08",Sn="ui08",Cn="uic8",En="si16",kn="si32",In="ur16",xn="ui32",Tn="fl32",Rn="fl64",Ln=Ct+Et.length,An=Object.prototype.toString;function Mn(a){var u,d,b,w,_,C=.75*a.length,I=a.length,T=0;a[a.length-1]==="="&&(C--,a[a.length-2]==="="&&C--);var L=new ArrayBuffer(C),P=new Uint8Array(L);for(u=0;u<I;u+=4)d=_e.indexOf(a[u]),b=_e.indexOf(a[u+1]),w=_e.indexOf(a[u+2]),_=_e.indexOf(a[u+3]),P[T++]=d<<2|b>>4,P[T++]=(15&b)<<4|w>>2,P[T++]=(3&w)<<6|63&_;return L}function It(a){var u,d=new Uint8Array(a),b="";for(u=0;u<d.length;u+=3)b+=_e[d[u]>>2],b+=_e[(3&d[u])<<4|d[u+1]>>4],b+=_e[(15&d[u+1])<<2|d[u+2]>>6],b+=_e[63&d[u+2]];return d.length%3==2?b=b.substring(0,b.length-1)+"=":d.length%3==1&&(b=b.substring(0,b.length-2)+"=="),b}function hr(a,u){var d="";if(a&&(d=An.call(a)),a&&(d==="[object ArrayBuffer]"||a.buffer&&An.call(a.buffer)==="[object ArrayBuffer]")){var b,w=Ye;a instanceof ArrayBuffer?(b=a,w+=Et):(b=a.buffer,d==="[object Int8Array]"?w+=_n:d==="[object Uint8Array]"?w+=Sn:d==="[object Uint8ClampedArray]"?w+=Cn:d==="[object Int16Array]"?w+=En:d==="[object Uint16Array]"?w+=In:d==="[object Int32Array]"?w+=kn:d==="[object Uint32Array]"?w+=xn:d==="[object Float32Array]"?w+=Tn:d==="[object Float64Array]"?w+=Rn:u(new Error("Failed to get type for BinaryArray"))),u(w+It(b))}else if(d==="[object Blob]"){var _=new FileReader;_.onload=function(){var C=ur+a.type+"~"+It(this.result);u(Ye+kt+C)},_.readAsArrayBuffer(a)}else try{u(JSON.stringify(a))}catch(C){u(null,C)}}function dr(a){if(a.substring(0,Ct)!==Ye)return JSON.parse(a);var u,d=a.substring(Ln),b=a.substring(Ct,Ln);if(b===kt&&bn.test(d)){var w=d.match(bn);u=w[1],d=d.substring(w[0].length)}var _=Mn(d);switch(b){case Et:return _;case kt:return p([_],{type:u});case _n:return new Int8Array(_);case Sn:return new Uint8Array(_);case Cn:return new Uint8ClampedArray(_);case En:return new Int16Array(_);case In:return new Uint16Array(_);case kn:return new Int32Array(_);case xn:return new Uint32Array(_);case Tn:return new Float32Array(_);case Rn:return new Float64Array(_);default:throw new Error("Unkown type: "+b)}}var xt={serialize:hr,deserialize:dr,stringToBuffer:Mn,bufferToString:It};function Dn(a,u,d,b){a.executeSql("CREATE TABLE IF NOT EXISTS "+u.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],d,b)}function fr(a){var u=this,d={db:null};if(a)for(var b in a)d[b]=typeof a[b]!="string"?a[b].toString():a[b];var w=new g(function(_,C){try{d.db=openDatabase(d.name,String(d.version),d.description,d.size)}catch(I){return C(I)}d.db.transaction(function(I){Dn(I,d,function(){u._dbInfo=d,_()},function(T,L){C(L)})},C)});return d.serializer=xt,w}function Se(a,u,d,b,w,_){a.executeSql(d,b,w,function(C,I){I.code===I.SYNTAX_ERR?C.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[u.storeName],function(T,L){L.rows.length?_(T,I):Dn(T,u,function(){T.executeSql(d,b,w,_)},_)},_):_(C,I)},_)}function pr(a,u){var d=this;a=B(a);var b=new g(function(w,_){d.ready().then(function(){var C=d._dbInfo;C.db.transaction(function(I){Se(I,C,"SELECT * FROM "+C.storeName+" WHERE key = ? LIMIT 1",[a],function(T,L){var P=L.rows.length?L.rows.item(0).value:null;P&&(P=C.serializer.deserialize(P)),w(P)},function(T,L){_(L)})})}).catch(_)});return S(b,u),b}function gr(a,u){var d=this,b=new g(function(w,_){d.ready().then(function(){var C=d._dbInfo;C.db.transaction(function(I){Se(I,C,"SELECT * FROM "+C.storeName,[],function(T,L){for(var P=L.rows,W=P.length,q=0;q<W;q++){var V=P.item(q),K=V.value;if(K&&(K=C.serializer.deserialize(K)),(K=a(K,V.key,q+1))!==void 0)return void w(K)}w()},function(T,L){_(L)})})}).catch(_)});return S(b,u),b}function Pn(a,u,d,b){var w=this;a=B(a);var _=new g(function(C,I){w.ready().then(function(){u===void 0&&(u=null);var T=u,L=w._dbInfo;L.serializer.serialize(u,function(P,W){W?I(W):L.db.transaction(function(q){Se(q,L,"INSERT OR REPLACE INTO "+L.storeName+" (key, value) VALUES (?, ?)",[a,P],function(){C(T)},function(V,K){I(K)})},function(q){if(q.code===q.QUOTA_ERR){if(b>0)return void C(Pn.apply(w,[a,T,d,b-1]));I(q)}})})}).catch(I)});return S(_,d),_}function mr(a,u,d){return Pn.apply(this,[a,u,d,1])}function vr(a,u){var d=this;a=B(a);var b=new g(function(w,_){d.ready().then(function(){var C=d._dbInfo;C.db.transaction(function(I){Se(I,C,"DELETE FROM "+C.storeName+" WHERE key = ?",[a],function(){w()},function(T,L){_(L)})})}).catch(_)});return S(b,u),b}function yr(a){var u=this,d=new g(function(b,w){u.ready().then(function(){var _=u._dbInfo;_.db.transaction(function(C){Se(C,_,"DELETE FROM "+_.storeName,[],function(){b()},function(I,T){w(T)})})}).catch(w)});return S(d,a),d}function wr(a){var u=this,d=new g(function(b,w){u.ready().then(function(){var _=u._dbInfo;_.db.transaction(function(C){Se(C,_,"SELECT COUNT(key) as c FROM "+_.storeName,[],function(I,T){var L=T.rows.item(0).c;b(L)},function(I,T){w(T)})})}).catch(w)});return S(d,a),d}function br(a,u){var d=this,b=new g(function(w,_){d.ready().then(function(){var C=d._dbInfo;C.db.transaction(function(I){Se(I,C,"SELECT key FROM "+C.storeName+" WHERE id = ? LIMIT 1",[a+1],function(T,L){var P=L.rows.length?L.rows.item(0).key:null;w(P)},function(T,L){_(L)})})}).catch(_)});return S(b,u),b}function _r(a){var u=this,d=new g(function(b,w){u.ready().then(function(){var _=u._dbInfo;_.db.transaction(function(C){Se(C,_,"SELECT key FROM "+_.storeName,[],function(I,T){for(var L=[],P=0;P<T.rows.length;P++)L.push(T.rows.item(P).key);b(L)},function(I,T){w(T)})})}).catch(w)});return S(d,a),d}function Sr(a){return new g(function(u,d){a.transaction(function(b){b.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(w,_){for(var C=[],I=0;I<_.rows.length;I++)C.push(_.rows.item(I).name);u({db:a,storeNames:C})},function(w,_){d(_)})},function(b){d(b)})})}function Cr(a,u){u=O.apply(this,arguments);var d=this.config();(a=typeof a!="function"&&a||{}).name||(a.name=a.name||d.name,a.storeName=a.storeName||d.storeName);var b,w=this;return b=a.name?new g(function(_){var C;C=a.name===d.name?w._dbInfo.db:openDatabase(a.name,"","",0),a.storeName?_({db:C,storeNames:[a.storeName]}):_(Sr(C))}).then(function(_){return new g(function(C,I){_.db.transaction(function(T){function L(V){return new g(function(K,re){T.executeSql("DROP TABLE IF EXISTS "+V,[],function(){K()},function(be,Lt){re(Lt)})})}for(var P=[],W=0,q=_.storeNames.length;W<q;W++)P.push(L(_.storeNames[W]));g.all(P).then(function(){C()}).catch(function(V){I(V)})},function(T){I(T)})})}):g.reject("Invalid arguments"),S(b,u),b}var Er={_driver:"webSQLStorage",_initStorage:fr,_support:lr(),iterate:gr,getItem:pr,setItem:mr,removeItem:vr,clear:yr,length:wr,key:br,keys:_r,dropInstance:Cr};function kr(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function Bn(a,u){var d=a.name+"/";return a.storeName!==u.storeName&&(d+=a.storeName+"/"),d}function Ir(){var a="_localforage_support_test";try{return localStorage.setItem(a,!0),localStorage.removeItem(a),!1}catch{return!0}}function xr(){return!Ir()||localStorage.length>0}function Tr(a){var u=this,d={};if(a)for(var b in a)d[b]=a[b];return d.keyPrefix=Bn(a,u._defaultConfig),xr()?(u._dbInfo=d,d.serializer=xt,g.resolve()):g.reject()}function Rr(a){var u=this,d=u.ready().then(function(){for(var b=u._dbInfo.keyPrefix,w=localStorage.length-1;w>=0;w--){var _=localStorage.key(w);_.indexOf(b)===0&&localStorage.removeItem(_)}});return S(d,a),d}function Lr(a,u){var d=this;a=B(a);var b=d.ready().then(function(){var w=d._dbInfo,_=localStorage.getItem(w.keyPrefix+a);return _&&(_=w.serializer.deserialize(_)),_});return S(b,u),b}function Ar(a,u){var d=this,b=d.ready().then(function(){for(var w=d._dbInfo,_=w.keyPrefix,C=_.length,I=localStorage.length,T=1,L=0;L<I;L++){var P=localStorage.key(L);if(P.indexOf(_)===0){var W=localStorage.getItem(P);if(W&&(W=w.serializer.deserialize(W)),(W=a(W,P.substring(C),T++))!==void 0)return W}}});return S(b,u),b}function Mr(a,u){var d=this,b=d.ready().then(function(){var w,_=d._dbInfo;try{w=localStorage.key(a)}catch{w=null}return w&&(w=w.substring(_.keyPrefix.length)),w});return S(b,u),b}function Dr(a){var u=this,d=u.ready().then(function(){for(var b=u._dbInfo,w=localStorage.length,_=[],C=0;C<w;C++){var I=localStorage.key(C);I.indexOf(b.keyPrefix)===0&&_.push(I.substring(b.keyPrefix.length))}return _});return S(d,a),d}function Pr(a){var u=this.keys().then(function(d){return d.length});return S(u,a),u}function Br(a,u){var d=this;a=B(a);var b=d.ready().then(function(){var w=d._dbInfo;localStorage.removeItem(w.keyPrefix+a)});return S(b,u),b}function $r(a,u,d){var b=this;a=B(a);var w=b.ready().then(function(){u===void 0&&(u=null);var _=u;return new g(function(C,I){var T=b._dbInfo;T.serializer.serialize(u,function(L,P){if(P)I(P);else try{localStorage.setItem(T.keyPrefix+a,L),C(_)}catch(W){W.name!=="QuotaExceededError"&&W.name!=="NS_ERROR_DOM_QUOTA_REACHED"||I(W),I(W)}})})});return S(w,d),w}function Nr(a,u){if(u=O.apply(this,arguments),!(a=typeof a!="function"&&a||{}).name){var d=this.config();a.name=a.name||d.name,a.storeName=a.storeName||d.storeName}var b,w=this;return b=a.name?new g(function(_){a.storeName?_(Bn(a,w._defaultConfig)):_(a.name+"/")}).then(function(_){for(var C=localStorage.length-1;C>=0;C--){var I=localStorage.key(C);I.indexOf(_)===0&&localStorage.removeItem(I)}}):g.reject("Invalid arguments"),S(b,u),b}var zr={_driver:"localStorageWrapper",_initStorage:Tr,_support:kr(),iterate:Ar,getItem:Lr,setItem:$r,removeItem:Br,clear:Rr,length:Pr,key:Mr,keys:Dr,dropInstance:Nr},Wr=function(a,u){return a===u||typeof a=="number"&&typeof u=="number"&&isNaN(a)&&isNaN(u)},Or=function(a,u){for(var d=a.length,b=0;b<d;){if(Wr(a[b],u))return!0;b++}return!1},$n=Array.isArray||function(a){return Object.prototype.toString.call(a)==="[object Array]"},He={},Nn={},Be={INDEXEDDB:cr,WEBSQL:Er,LOCALSTORAGE:zr},jr=[Be.INDEXEDDB._driver,Be.WEBSQL._driver,Be.LOCALSTORAGE._driver],Je=["dropInstance"],Tt=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(Je),Ur={description:"",driver:jr.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function Hr(a,u){a[u]=function(){var d=arguments;return a.ready().then(function(){return a[u].apply(a,d)})}}function Rt(){for(var a=1;a<arguments.length;a++){var u=arguments[a];if(u)for(var d in u)u.hasOwnProperty(d)&&($n(u[d])?arguments[0][d]=u[d].slice():arguments[0][d]=u[d])}return arguments[0]}var qr=function(){function a(u){for(var d in r(this,a),Be)if(Be.hasOwnProperty(d)){var b=Be[d],w=b._driver;this[d]=w,He[w]||this.defineDriver(b)}this._defaultConfig=Rt({},Ur),this._config=Rt({},this._defaultConfig,u),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return a.prototype.config=function(u){if((u===void 0?"undefined":o(u))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var d in u){if(d==="storeName"&&(u[d]=u[d].replace(/\W/g,"_")),d==="version"&&typeof u[d]!="number")return new Error("Database version must be a number.");this._config[d]=u[d]}return!("driver"in u)||!u.driver||this.setDriver(this._config.driver)}return typeof u=="string"?this._config[u]:this._config},a.prototype.defineDriver=function(u,d,b){var w=new g(function(_,C){try{var I=u._driver,T=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!u._driver)return void C(T);for(var L=Tt.concat("_initStorage"),P=0,W=L.length;P<W;P++){var q=L[P];if((!Or(Je,q)||u[q])&&typeof u[q]!="function")return void C(T)}var V=function(){for(var re=function(Xr){return function(){var Vr=new Error("Method "+Xr+" is not implemented by the current driver"),zn=g.reject(Vr);return S(zn,arguments[arguments.length-1]),zn}},be=0,Lt=Je.length;be<Lt;be++){var At=Je[be];u[At]||(u[At]=re(At))}};V();var K=function(re){He[I],He[I]=u,Nn[I]=re,_()};"_support"in u?u._support&&typeof u._support=="function"?u._support().then(K,C):K(!!u._support):K(!0)}catch(re){C(re)}});return k(w,d,b),w},a.prototype.driver=function(){return this._driver||null},a.prototype.getDriver=function(u,d,b){var w=He[u]?g.resolve(He[u]):g.reject(new Error("Driver not found."));return k(w,d,b),w},a.prototype.getSerializer=function(u){var d=g.resolve(xt);return k(d,u),d},a.prototype.ready=function(u){var d=this,b=d._driverSet.then(function(){return d._ready===null&&(d._ready=d._initDriver()),d._ready});return k(b,u,u),b},a.prototype.setDriver=function(u,d,b){var w=this;$n(u)||(u=[u]);var _=this._getSupportedDrivers(u);function C(){w._config.driver=w.driver()}function I(P){return w._extend(P),C(),w._ready=w._initStorage(w._config),w._ready}function T(P){return function(){var W=0;function q(){for(;W<P.length;){var V=P[W];return W++,w._dbInfo=null,w._ready=null,w.getDriver(V).then(I).catch(q)}C();var K=new Error("No available storage method found.");return w._driverSet=g.reject(K),w._driverSet}return q()}}var L=this._driverSet!==null?this._driverSet.catch(function(){return g.resolve()}):g.resolve();return this._driverSet=L.then(function(){var P=_[0];return w._dbInfo=null,w._ready=null,w.getDriver(P).then(function(W){w._driver=W._driver,C(),w._wrapLibraryMethodsWithReady(),w._initDriver=T(_)})}).catch(function(){C();var P=new Error("No available storage method found.");return w._driverSet=g.reject(P),w._driverSet}),k(this._driverSet,d,b),this._driverSet},a.prototype.supports=function(u){return!!Nn[u]},a.prototype._extend=function(u){Rt(this,u)},a.prototype._getSupportedDrivers=function(u){for(var d=[],b=0,w=u.length;b<w;b++){var _=u[b];this.supports(_)&&d.push(_)}return d},a.prototype._wrapLibraryMethodsWithReady=function(){for(var u=0,d=Tt.length;u<d;u++)Hr(this,Tt[u])},a.prototype.createInstance=function(u){return new a(u)},a}(),Fr=new qr;e.exports=Fr},{3:3}]},{},[4])(4)),Ze=wt(Ri),co={exports:{}},Li=(ao||(ao=1,function(n){((e,t)=>{n.exports=t()})(0,()=>{const e=typeof window=="object"?window:this;e.HTMLElement;let t=null,o=!1;const r=e.WebStreamsPolyfill||{},i=e.isSecureContext;let s=/constructor/i.test(e.HTMLElement)||!!e.safari||!!e.WebKitPoint;const c=i||"MozAppearance"in document.documentElement.style?"iframe":"navigate",p={createWriteStream:function(S,k,B){let O={size:null,pathname:null,writableStrategy:void 0,readableStrategy:void 0},x=0,f=null,l=null,y=null;if(Number.isFinite(k)?([B,k]=[k,B],O.size=B,O.writableStrategy=k):k&&k.highWaterMark?(O.size=B,O.writableStrategy=k):O=k||{},!s){t||(t=i?g(p.mitm):function($){const M="width=200,height=100",D=document.createDocumentFragment(),A={frame:e.open($,"popup",M),loaded:!1,isIframe:!1,isPopup:!0,remove(){A.frame.close()},addEventListener(...j){D.addEventListener(...j)},dispatchEvent(...j){D.dispatchEvent(...j)},removeEventListener(...j){D.removeEventListener(...j)},postMessage(...j){A.frame.postMessage(...j)}},N=j=>{j.source===A.frame&&(A.loaded=!0,e.removeEventListener("message",N),A.dispatchEvent(new Event("load")))};return e.addEventListener("message",N),A}(p.mitm)),l=new MessageChannel,S=encodeURIComponent(S.replace(/\//g,":")).replace(/['()]/g,escape).replace(/\*/g,"%2A");const h={transferringReadable:o,pathname:O.pathname||Math.random().toString().slice(-6)+"/"+S,headers:{"Content-Type":"application/octet-stream; charset=utf-8","Content-Disposition":"attachment; filename*=UTF-8''"+S}};O.size&&(h.headers["Content-Length"]=O.size);const m=[h,"*",[l.port2]];if(o){const $=c==="iframe"?void 0:{transform(D,A){if(!(D instanceof Uint8Array))throw new TypeError("Can only write Uint8Arrays");x+=D.length,A.enqueue(D),f&&(location.href=f,f=null)},flush(){f&&(location.href=f)}};y=new p.TransformStream($,O.writableStrategy,O.readableStrategy);const M=y.readable;l.port1.postMessage({readableStream:M},[M])}l.port1.onmessage=$=>{$.data.download?c==="navigate"?(t.remove(),t=null,x?location.href=$.data.download:f=$.data.download):(t.isPopup&&(t.remove(),t=null,c==="iframe"&&g(p.mitm)),g($.data.download)):$.data.abort&&(v=[],l.port1.postMessage("abort"),l.port1.onmessage=null,l.port1.close(),l.port2.close(),l=null)},t.loaded?t.postMessage(...m):t.addEventListener("load",()=>{t.postMessage(...m)},{once:!0})}let v=[];return!s&&y&&y.writable||new p.WritableStream({write(h){if(!(h instanceof Uint8Array))throw new TypeError("Can only write Uint8Arrays");s?v.push(h):(l.port1.postMessage(h),x+=h.length,f&&(location.href=f,f=null))},close(){if(s){const h=new Blob(v,{type:"application/octet-stream; charset=utf-8"}),m=document.createElement("a");m.href=URL.createObjectURL(h),m.download=S,m.click()}else l.port1.postMessage("end")},abort(){v=[],l.port1.postMessage("abort"),l.port1.onmessage=null,l.port1.close(),l.port2.close(),l=null}},O.writableStrategy)},WritableStream:e.WritableStream||r.WritableStream,supported:!0,version:{full:"2.0.5",major:2,minor:0,dot:5},mitm:"https://jimmywarting.github.io/StreamSaver.js/mitm.html?version=2.0.0"};function g(S){if(!S)throw new Error("meh");const k=document.createElement("iframe");return k.hidden=!0,k.src=S,k.loaded=!1,k.name="iframe",k.isIframe=!0,k.postMessage=(...B)=>k.contentWindow.postMessage(...B),k.addEventListener("load",()=>{k.loaded=!0},{once:!0}),document.body.appendChild(k),k}try{new Response(new ReadableStream),i&&!("serviceWorker"in navigator)&&(s=!0)}catch{s=!0}return(S=>{try{S()}catch{}})(()=>{const{readable:S}=new TransformStream,k=new MessageChannel;k.port1.postMessage(S,[S]),k.port1.close(),k.port2.close(),o=!0,Object.defineProperty(p,"TransformStream",{configurable:!1,writable:!1,value:TransformStream})}),p})}(co)),co.exports),Ai=wt(Li);class qs{fileID;downloadURL;ChunkUnitM=1048576;chunkByteSize;totalChunks=1;currentDB;keys;fileMetaData=null;finishNum=0;eventTarget;cancelSource;isStarting=!1;fileName;cacheSize=6;requestTimeout=6e4;constructor(e,t,o=3,r=6,i=6e4){this.fileID=e,this.downloadURL=t,this.chunkByteSize=o*this.ChunkUnitM,this.eventTarget=hn(),this.initIndexDB(),r>=3&&(this.cacheSize=r),i>this.requestTimeout&&(this.requestTimeout=i)}on(e,t){this.eventTarget.on(e,t)}dispatch(e,t){this.eventTarget.emit(e,t)}dispatchError(e){this.eventTarget.emit("error",e)}dispatchInfo(e){this.eventTarget.emit("info",e)}async queryDownloadFileMeta(e,t="",o){this.dispatchInfo("开始获取文件信息");const r=await ke(t,e,o);let i=null;return r&&r.status===200&&(i=r.data),i}async getIFileMeta(){if(this.fileMetaData===null){const e=await this.currentDB?.getItem("fileinfo");this.fileMetaData=e||null}return this.fileMetaData}initIndexDB(){this.currentDB=Ze.createInstance({name:this.fileID,driver:Ze.INDEXEDDB})}async init(e){if(this.finishNum=0,e){const t="fileinfo";this.fileMetaData={id:e.id,name:e.name,length:e.length,downloadID:e.downloadID,chunkSize:this.chunkByteSize},this.fileName=e.name,this.currentDB?.setItem(t,this.fileMetaData)}if(this.fileMetaData!=null){const t=this.fileMetaData.chunkSize;t!=null&&t>0&&(this.chunkByteSize=t)}this.fileMetaData&&(this.totalChunks=Math.ceil(this.fileMetaData.length/this.chunkByteSize)),this.dispatchInfo("完成初始化文件信息，总分片："+this.totalChunks),this.currentDB&&(this.keys=await this.currentDB.keys())}getTotalChunks(){return this.totalChunks}pause(){this.cancelSource&&this.isStarting&&(this.cancelSource.cancel(),this.isStarting=!1),this.dispatchInfo("已暂停下载任务")}restart(){this.dispatchInfo("正在重启下载任务"),this.download()}delete(){this.cancelSource&&this.cancelSource.cancel(),Ze.dropInstance({name:this.fileID}),this.currentDB=void 0,this.keys&&(this.keys.length=0,this.keys=void 0),this.finishNum=0,this.downloadProgress(),this.outputProgress(0),this.dispatchInfo("已删除下载任务")}sleep(e){return new Promise(t=>setTimeout(t,e))}async download(e,t){let o=e;if(!o&&this.downloadURL&&(o=this.downloadURL),!o)throw Error("下载URL不能为空!");this.currentDB||this.initIndexDB();const r=z.Axios.CancelToken;this.cancelSource=r.source(),this.isStarting=!0;const i={key:this.fileMetaData?.downloadID};let s=0;const c=this.cacheSize;let p=0;for(let g=0;g<this.totalChunks;g++){if(this.keys&&this.keys?.indexOf(g.toString())>=0){s++,s>this.finishNum&&(this.finishNum=s,this.downloadProgress());continue}const S=g*this.chunkByteSize;let k=S+this.chunkByteSize-1;this.fileMetaData&&k>this.fileMetaData.length&&(k=this.fileMetaData.length-1);const B={range:`bytes=${S}-${k}`};for(;p>=c;)await this.sleep(200);const O=g.toString();this.dispatchInfo(`开始下载分片${g+1}/${this.totalChunks}`),p++,ke(o,t,i,B,"arraybuffer",this.cancelSource?.token,this.requestTimeout).then(async x=>{const f=x.data;p--,await this.currentDB?.setItem(O,f),s++,s>this.finishNum&&(this.finishNum=s,this.downloadProgress());const l=parseInt(O)+1;this.dispatchInfo(`完成下载分片${l}/${this.totalChunks}`),this.savefile()}).catch(x=>{p--;const f=parseInt(O)+1;this.dispatchError(`下载第${f}）个分片内容失败！`)})}this.finishNum===this.totalChunks&&this.savefile()}downloadProgress(){const e=100*this.finishNum/this.totalChunks;this.dispatch("downloadProgress",e)}outputProgress(e){const t=100*e/this.totalChunks;this.dispatch("saveProgress",t)}async savefile(){if(this.finishNum===this.totalChunks){if(!this.fileName)return void this.dispatchError("下载错误：文件名为空!");this.dispatchInfo("开始保存下载文件:"+this.fileName);const e=Ai.createWriteStream(this.fileName).getWriter();let t=0;for(let o=0;o<this.totalChunks;o++){const r=o.toString();let i=await this.currentDB?.getItem(r);if(i||(i=await this.currentDB?.getItem(r)),!i)return void this.dispatchError(`输出分片第${o+1}）个内容为空，错误退出！`);let s=new Response(i).body;if(s===null)return void this.dispatchError(`输出分片第${o+1}）个内容为空，错误退出！`);const c=s.getReader();for(;;){const{done:p,value:g}=await c.read();if(p)break;await e.write(g)}t++,this.outputProgress(t),this.dispatchInfo(`完成第${o+1}个分片输出`)}e.close(),Ze.dropInstance({name:this.fileID}),this.dispatch("success"),this.isStarting=!1,this.dispatchInfo("完成文件下载")}}}function Mi(n={},e={}){let t;for(t in e)un(e[t])?n[t]=Mi(n[t],e[t]):n[t]=e[t];return n}function Di(n,e){const t=`${n}_${e}`;return he.MD5(t)}function Pi(n){const e=function(c){if(!c)return;const p=c,g=[];if(p)for(let S of p){const k=Wo(S);k&&g.push(k)}return g}(n.bussinessRoutes),t=function(c){if(!c)return;const p=c;if(p&&p.length>0){const g=[];return p.forEach(S=>{const k=Oo(S);k&&g.push(k)}),g}}(n.widgetMenuConfig),o=function(c){if(c&&c.length>0){const p=[];return c.forEach(g=>{const S=function(k){return k?{id:k.id,label:k.label,container:k.container,preload:k.preload,afterid:k.afterid,bindid:k.bindid,group:k.group}:void 0}(g);S&&p.push(S)}),p}}(n.widgetConfig),r=function(c){if(c&&c.length>0)return c}(n.functionList),i=n.pkgObject.version,s=n.pkgObject.name;return{id:Di(s,i),name:z.Config.UI.SiteTitle,group:z.Config.UI.Group,product:s,version:i,routes:e,widgetMenu:t,widgets:o,functions:r}}function Wo(n){if(n){let e=0;n.meta?.hidden&&(e=1);let t={path:n.path,name:n.name,title:n.meta?.title,type:e,index:n.meta?.index};if(n.children){const o=[];for(let r of n.children){const i=Wo(r);i&&o.push(i)}o.length>0&&(t.children=o)}return t}}function Oo(n){if(!n)return;const e={name:n.name,index:n.index,path:n.path,type:n.type};return n.children&&n.children.length>0&&(e.children=[],n.children.forEach(t=>{const o=Oo(t);o&&e.children?.push(o)})),e}function Fs(n,e){const t=Pi(n);vi(t,e),z.Message?.msg("导出系统功能权限文件成功！")}let jo=!0;try{String.fromCharCode.apply(String,[1,2])}catch{jo=!1,Object.defineProperty(Array.prototype,"subarray",{value:Array.prototype.slice})}var tn=2654435769;function Uo(n,e){var t=n.length,o=t<<2;if(e){var r=n[t-1];if(r<(o-=4)-3||r>o)return null;o=r}for(var i=new Uint8Array(o),s=0;s<o;++s)i[s]=n[s>>2]>>((3&s)<<3);return i}function dt(n,e){var t,o=n.length,r=o>>2;3&o&&++r,e?(t=new Uint32Array(r+1))[r]=o:t=new Uint32Array(r);for(var i=0;i<o;++i)t[i>>2]|=n[i]<<((3&i)<<3);return t}function Re(n){return 4294967295&n}function ft(n,e,t,o,r,i){return(t>>>5^e<<2)+(e>>>3^t<<4)^(n^e)+(i[3&o^r]^t)}function Ho(n){if(n.length<16){var e=new Uint8Array(16);e.set(n),n=e}return n}function pt(n){for(var e=n.length,t=new Uint8Array(3*e),o=0,r=0;r<e;r++){var i=n.charCodeAt(r);if(i<128)t[o++]=i;else if(i<2048)t[o++]=192|i>>6,t[o++]=128|63&i;else{if(!(i<55296||i>57343)){if(r+1<e){var s=n.charCodeAt(r+1);if(i<56320&&56320<=s&&s<=57343){var c=65536+((1023&i)<<10|1023&s);t[o++]=240|c>>18,t[o++]=128|c>>12&63,t[o++]=128|c>>6&63,t[o++]=128|63&c,r++;continue}}throw new Error("Malformed string")}t[o++]=224|i>>12,t[o++]=128|i>>6&63,t[o++]=128|63&i}}return t.subarray(0,o)}function lo(n){var e=n.length;return e===0?"":e<32767?function(t,o){for(var r=new Array(o),i=0,s=0,c=t.length;i<o&&s<c;i++){var p=t[s++];switch(p>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:r[i]=p;break;case 12:case 13:if(!(s<c))throw new Error("Unfinished UTF-8 octet sequence");r[i]=(31&p)<<6|63&t[s++];break;case 14:if(!(s+1<c))throw new Error("Unfinished UTF-8 octet sequence");r[i]=(15&p)<<12|(63&t[s++])<<6|63&t[s++];break;case 15:if(!(s+2<c))throw new Error("Unfinished UTF-8 octet sequence");var g=((7&p)<<18|(63&t[s++])<<12|(63&t[s++])<<6|63&t[s++])-65536;if(!(0<=g&&g<=1048575))throw new Error("Character outside valid Unicode range: 0x"+g.toString(16));r[i++]=g>>10&1023|55296,r[i]=1023&g|56320;break;default:throw new Error("Bad UTF-8 encoding 0x"+p.toString(16))}}return i<o&&(r.length=i),String.fromCharCode.apply(String,r)}(n,e):function(t,o){for(var r=[],i=new Array(32768),s=0,c=0,p=t.length;s<o&&c<p;s++){var g=t[c++];switch(g>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:i[s]=g;break;case 12:case 13:if(!(c<p))throw new Error("Unfinished UTF-8 octet sequence");i[s]=(31&g)<<6|63&t[c++];break;case 14:if(!(c+1<p))throw new Error("Unfinished UTF-8 octet sequence");i[s]=(15&g)<<12|(63&t[c++])<<6|63&t[c++];break;case 15:if(!(c+2<p))throw new Error("Unfinished UTF-8 octet sequence");var S=((7&g)<<18|(63&t[c++])<<12|(63&t[c++])<<6|63&t[c++])-65536;if(!(0<=S&&S<=1048575))throw new Error("Character outside valid Unicode range: 0x"+S.toString(16));i[s++]=S>>10&1023|55296,i[s]=1023&S|56320;break;default:throw new Error("Bad UTF-8 encoding 0x"+g.toString(16))}if(s>=32766){var k=s+1;i.length=k,r.push(String.fromCharCode.apply(String,i)),o-=k,s=-1}}return s>0&&(i.length=s,r.push(String.fromCharCode.apply(String,i))),r.join("")}(n,e)}function Bi(n){var e=n.length;if(e===0)return"";var t=jo?n:function(c){for(var p=c.length,g=new Array(c.length),S=0;S<p;++S)g[S]=c[S];return g}(n);if(e<65535)return String.fromCharCode.apply(String,t);for(var o=32767&e,r=e>>15,i=new Array(o?r+1:r),s=0;s<r;++s)i[s]=String.fromCharCode.apply(String,t.subarray(s<<15,s+1<<15));return o&&(i[r]=String.fromCharCode.apply(String,t.subarray(r<<15,e))),i.join("")}function uo(n,e){return typeof n=="string"&&(n=pt(n)),typeof e=="string"&&(e=pt(e)),n==null||n.length===0?n:Uo(function(t,o){var r,i,s,c,p,g,S=t.length,k=S-1;for(i=t[k],s=0,g=0|Math.floor(6+52/S);g>0;--g){for(c=(s=Re(s+tn))>>>2&3,p=0;p<k;++p)r=t[p+1],i=t[p]=Re(t[p]+ft(s,r,i,p,c,o));r=t[0],i=t[k]=Re(t[k]+ft(s,r,i,k,c,o))}return t}(dt(n,!0),dt(Ho(e),!1)),!1)}function ho(n,e){return typeof n=="string"&&(n=function(t){for(var o=window.atob(t),r=o.length,i=new Uint8Array(r),s=0;s<r;s++)i[s]=o.charCodeAt(s);return i}(n)),typeof e=="string"&&(e=pt(e)),n==null||n.length===0?n:Uo(function(t,o){var r,i,s,c,p,g=t.length,S=g-1;for(r=t[0],s=Re(Math.floor(6+52/g)*tn);s!==0;s=Re(s-tn)){for(c=s>>>2&3,p=S;p>0;--p)i=t[p-1],r=t[p]=Re(t[p]-ft(s,r,i,p,c,o));i=t[S],r=t[0]=Re(t[0]-ft(s,r,i,0,c,o))}return t}(dt(n,!1),dt(Ho(e),!1)),!0)}const nn={toBytes:pt,toString:lo,encrypt:uo,encryptToString:function(n,e){return window.btoa(Bi(uo(n,e)))},decrypt:ho,decryptToString:function(n,e){return lo(ho(n,e))}};class Le extends Error{constructor(e,t){const o=new.target.prototype;super(`${e}: Status code '${t}'`),this.statusCode=t,this.__proto__=o}}class pn extends Error{constructor(e="A timeout occurred."){const t=new.target.prototype;super(e),this.__proto__=t}}class me extends Error{constructor(e="An abort occurred."){const t=new.target.prototype;super(e),this.__proto__=t}}class $i extends Error{constructor(e,t){const o=new.target.prototype;super(e),this.transport=t,this.errorType="UnsupportedTransportError",this.__proto__=o}}class Ni extends Error{constructor(e,t){const o=new.target.prototype;super(e),this.transport=t,this.errorType="DisabledTransportError",this.__proto__=o}}class zi extends Error{constructor(e,t){const o=new.target.prototype;super(e),this.transport=t,this.errorType="FailedToStartTransportError",this.__proto__=o}}class fo extends Error{constructor(e){const t=new.target.prototype;super(e),this.errorType="FailedToNegotiateWithServerError",this.__proto__=t}}class Wi extends Error{constructor(e,t){const o=new.target.prototype;super(e),this.innerErrors=t,this.__proto__=o}}class qo{constructor(e,t,o){this.statusCode=e,this.statusText=t,this.content=o}}class bt{get(e,t){return this.send({...t,method:"GET",url:e})}post(e,t){return this.send({...t,method:"POST",url:e})}delete(e,t){return this.send({...t,method:"DELETE",url:e})}getCookieString(e){return""}}var E;(function(n){n[n.Trace=0]="Trace",n[n.Debug=1]="Debug",n[n.Information=2]="Information",n[n.Warning=3]="Warning",n[n.Error=4]="Error",n[n.Critical=5]="Critical",n[n.None=6]="None"})(E||(E={}));class Ve{constructor(){}log(e,t){}}Ve.instance=new Ve;class ee{static isRequired(e,t){if(e==null)throw new Error(`The '${t}' argument is required.`)}static isNotEmpty(e,t){if(!e||e.match(/^\s*$/))throw new Error(`The '${t}' argument should not be empty.`)}static isIn(e,t,o){if(!(e in t))throw new Error(`Unknown ${o} value: ${e}.`)}}class Q{static get isBrowser(){return!Q.isNode&&typeof window=="object"&&typeof window.document=="object"}static get isWebWorker(){return!Q.isNode&&typeof self=="object"&&"importScripts"in self}static get isReactNative(){return!Q.isNode&&typeof window=="object"&&window.document===void 0}static get isNode(){return typeof process<"u"&&process.release&&process.release.name==="node"}}function Ke(n,e){let t="";return De(n)?(t=`Binary data of length ${n.byteLength}`,e&&(t+=`. Content: '${function(o){const r=new Uint8Array(o);let i="";return r.forEach(s=>{i+=`0x${s<16?"0":""}${s.toString(16)} `}),i.substr(0,i.length-1)}(n)}'`)):typeof n=="string"&&(t=`String data of length ${n.length}`,e&&(t+=`. Content: '${n}'`)),t}function De(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}async function Fo(n,e,t,o,r,i){const s={},[c,p]=je();s[c]=p,n.log(E.Trace,`(${e} transport) sending data. ${Ke(r,i.logMessageContent)}.`);const g=De(r)?"arraybuffer":"text",S=await t.post(o,{content:r,headers:{...s,...i.headers},responseType:g,timeout:i.timeout,withCredentials:i.withCredentials});n.log(E.Trace,`(${e} transport) request complete. Response status: ${S.statusCode}.`)}class Oi{constructor(e,t){this._subject=e,this._observer=t}dispose(){const e=this._subject.observers.indexOf(this._observer);e>-1&&this._subject.observers.splice(e,1),this._subject.observers.length===0&&this._subject.cancelCallback&&this._subject.cancelCallback().catch(t=>{})}}class gt{constructor(e){this._minLevel=e,this.out=console}log(e,t){if(e>=this._minLevel){const o=`[${new Date().toISOString()}] ${E[e]}: ${t}`;switch(e){case E.Critical:case E.Error:this.out.error(o);break;case E.Warning:this.out.warn(o);break;case E.Information:this.out.info(o);break;default:this.out.log(o)}}}}function je(){let n="X-SignalR-User-Agent";return Q.isNode&&(n="User-Agent"),[n,ji("8.0.7",Ui(),qi(),Hi())]}function ji(n,e,t,o){let r="Microsoft SignalR/";const i=n.split(".");return r+=`${i[0]}.${i[1]}`,r+=` (${n}; `,r+=e&&e!==""?`${e}; `:"Unknown OS; ",r+=`${t}`,r+=o?`; ${o}`:"; Unknown Runtime Version",r+=")",r}function Ui(){if(!Q.isNode)return"";switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}}function Hi(){if(Q.isNode)return process.versions.node}function qi(){return Q.isNode?"NodeJS":"Browser"}function Xt(n){return n.stack?n.stack:n.message?n.message:`${n}`}class Fi extends bt{constructor(e){if(super(),this._logger=e,typeof fetch>"u"||Q.isNode){const t=typeof __webpack_require__=="function"?__non_webpack_require__:require;this._jar=new(t("tough-cookie")).CookieJar,typeof fetch>"u"?this._fetchType=t("node-fetch"):this._fetchType=fetch,this._fetchType=t("fetch-cookie")(this._fetchType,this._jar)}else this._fetchType=fetch.bind(function(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("could not find global")}());if(typeof AbortController>"u"){const t=typeof __webpack_require__=="function"?__non_webpack_require__:require;this._abortControllerType=t("abort-controller")}else this._abortControllerType=AbortController}async send(e){if(e.abortSignal&&e.abortSignal.aborted)throw new me;if(!e.method)throw new Error("No method defined.");if(!e.url)throw new Error("No url defined.");const t=new this._abortControllerType;let o;e.abortSignal&&(e.abortSignal.onabort=()=>{t.abort(),o=new me});let r,i=null;if(e.timeout){const p=e.timeout;i=setTimeout(()=>{t.abort(),this._logger.log(E.Warning,"Timeout from HTTP request."),o=new pn},p)}e.content===""&&(e.content=void 0),e.content&&(e.headers=e.headers||{},De(e.content)?e.headers["Content-Type"]="application/octet-stream":e.headers["Content-Type"]="text/plain;charset=UTF-8");try{r=await this._fetchType(e.url,{body:e.content,cache:"no-cache",credentials:e.withCredentials===!0?"include":"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",...e.headers},method:e.method,mode:"cors",redirect:"follow",signal:t.signal})}catch(p){throw o||(this._logger.log(E.Warning,`Error from HTTP request. ${p}.`),p)}finally{i&&clearTimeout(i),e.abortSignal&&(e.abortSignal.onabort=null)}if(!r.ok){const p=await po(r,"text");throw new Le(p||r.statusText,r.status)}const s=po(r,e.responseType),c=await s;return new qo(r.status,r.statusText,c)}getCookieString(e){let t="";return Q.isNode&&this._jar&&this._jar.getCookies(e,(o,r)=>t=r.join("; ")),t}}function po(n,e){let t;switch(e){case"arraybuffer":t=n.arrayBuffer();break;case"text":default:t=n.text();break;case"blob":case"document":case"json":throw new Error(`${e} is not supported.`)}return t}class Xi extends bt{constructor(e){super(),this._logger=e}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new me):e.method?e.url?new Promise((t,o)=>{const r=new XMLHttpRequest;r.open(e.method,e.url,!0),r.withCredentials=e.withCredentials===void 0||e.withCredentials,r.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.content===""&&(e.content=void 0),e.content&&(De(e.content)?r.setRequestHeader("Content-Type","application/octet-stream"):r.setRequestHeader("Content-Type","text/plain;charset=UTF-8"));const i=e.headers;i&&Object.keys(i).forEach(s=>{r.setRequestHeader(s,i[s])}),e.responseType&&(r.responseType=e.responseType),e.abortSignal&&(e.abortSignal.onabort=()=>{r.abort(),o(new me)}),e.timeout&&(r.timeout=e.timeout),r.onload=()=>{e.abortSignal&&(e.abortSignal.onabort=null),r.status>=200&&r.status<300?t(new qo(r.status,r.statusText,r.response||r.responseText)):o(new Le(r.response||r.responseText||r.statusText,r.status))},r.onerror=()=>{this._logger.log(E.Warning,`Error from HTTP request. ${r.status}: ${r.statusText}.`),o(new Le(r.statusText,r.status))},r.ontimeout=()=>{this._logger.log(E.Warning,"Timeout from HTTP request."),o(new pn)},r.send(e.content)}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}}class Vi extends bt{constructor(e){if(super(),typeof fetch<"u"||Q.isNode)this._httpClient=new Fi(e);else{if(typeof XMLHttpRequest>"u")throw new Error("No usable HttpClient found.");this._httpClient=new Xi(e)}}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new me):e.method?e.url?this._httpClient.send(e):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(e){return this._httpClient.getCookieString(e)}}class fe{static write(e){return`${e}${fe.RecordSeparator}`}static parse(e){if(e[e.length-1]!==fe.RecordSeparator)throw new Error("Message is incomplete.");const t=e.split(fe.RecordSeparator);return t.pop(),t}}fe.RecordSeparatorCode=30,fe.RecordSeparator=String.fromCharCode(fe.RecordSeparatorCode);class Ki{writeHandshakeRequest(e){return fe.write(JSON.stringify(e))}parseHandshakeResponse(e){let t,o;if(De(e)){const s=new Uint8Array(e),c=s.indexOf(fe.RecordSeparatorCode);if(c===-1)throw new Error("Message is incomplete.");const p=c+1;t=String.fromCharCode.apply(null,Array.prototype.slice.call(s.slice(0,p))),o=s.byteLength>p?s.slice(p).buffer:null}else{const s=e,c=s.indexOf(fe.RecordSeparator);if(c===-1)throw new Error("Message is incomplete.");const p=c+1;t=s.substring(0,p),o=s.length>p?s.substring(p):null}const r=fe.parse(t),i=JSON.parse(r[0]);if(i.type)throw new Error("Expected a handshake response from the server.");return[o,i]}}var U;(function(n){n[n.Invocation=1]="Invocation",n[n.StreamItem=2]="StreamItem",n[n.Completion=3]="Completion",n[n.StreamInvocation=4]="StreamInvocation",n[n.CancelInvocation=5]="CancelInvocation",n[n.Ping=6]="Ping",n[n.Close=7]="Close",n[n.Ack=8]="Ack",n[n.Sequence=9]="Sequence"})(U||(U={}));class Gi{constructor(){this.observers=[]}next(e){for(const t of this.observers)t.next(e)}error(e){for(const t of this.observers)t.error&&t.error(e)}complete(){for(const e of this.observers)e.complete&&e.complete()}subscribe(e){return this.observers.push(e),new Oi(this,e)}}class Yi{constructor(e,t,o){this._bufferSize=1e5,this._messages=[],this._totalMessageCount=0,this._waitForSequenceMessage=!1,this._nextReceivingSequenceId=1,this._latestReceivedSequenceId=0,this._bufferedByteCount=0,this._reconnectInProgress=!1,this._protocol=e,this._connection=t,this._bufferSize=o}async _send(e){const t=this._protocol.writeMessage(e);let o=Promise.resolve();if(this._isInvocationMessage(e)){this._totalMessageCount++;let r=()=>{},i=()=>{};De(t)?this._bufferedByteCount+=t.byteLength:this._bufferedByteCount+=t.length,this._bufferedByteCount>=this._bufferSize&&(o=new Promise((s,c)=>{r=s,i=c})),this._messages.push(new Ji(t,this._totalMessageCount,r,i))}try{this._reconnectInProgress||await this._connection.send(t)}catch{this._disconnected()}await o}_ack(e){let t=-1;for(let o=0;o<this._messages.length;o++){const r=this._messages[o];if(r._id<=e.sequenceId)t=o,De(r._message)?this._bufferedByteCount-=r._message.byteLength:this._bufferedByteCount-=r._message.length,r._resolver();else{if(!(this._bufferedByteCount<this._bufferSize))break;r._resolver()}}t!==-1&&(this._messages=this._messages.slice(t+1))}_shouldProcessMessage(e){if(this._waitForSequenceMessage)return e.type===U.Sequence&&(this._waitForSequenceMessage=!1,!0);if(!this._isInvocationMessage(e))return!0;const t=this._nextReceivingSequenceId;return this._nextReceivingSequenceId++,t<=this._latestReceivedSequenceId?(t===this._latestReceivedSequenceId&&this._ackTimer(),!1):(this._latestReceivedSequenceId=t,this._ackTimer(),!0)}_resetSequence(e){e.sequenceId>this._nextReceivingSequenceId?this._connection.stop(new Error("Sequence ID greater than amount of messages we've received.")):this._nextReceivingSequenceId=e.sequenceId}_disconnected(){this._reconnectInProgress=!0,this._waitForSequenceMessage=!0}async _resend(){const e=this._messages.length!==0?this._messages[0]._id:this._totalMessageCount+1;await this._connection.send(this._protocol.writeMessage({type:U.Sequence,sequenceId:e}));const t=this._messages;for(const o of t)await this._connection.send(o._message);this._reconnectInProgress=!1}_dispose(e){e!=null||(e=new Error("Unable to reconnect to server."));for(const t of this._messages)t._rejector(e)}_isInvocationMessage(e){switch(e.type){case U.Invocation:case U.StreamItem:case U.Completion:case U.StreamInvocation:case U.CancelInvocation:return!0;case U.Close:case U.Sequence:case U.Ping:case U.Ack:return!1}}_ackTimer(){this._ackTimerHandle===void 0&&(this._ackTimerHandle=setTimeout(async()=>{try{this._reconnectInProgress||await this._connection.send(this._protocol.writeMessage({type:U.Ack,sequenceId:this._latestReceivedSequenceId}))}catch{}clearTimeout(this._ackTimerHandle),this._ackTimerHandle=void 0},1e3))}}class Ji{constructor(e,t,o,r){this._message=e,this._id=t,this._resolver=o,this._rejector=r}}var Y;(function(n){n.Disconnected="Disconnected",n.Connecting="Connecting",n.Connected="Connected",n.Disconnecting="Disconnecting",n.Reconnecting="Reconnecting"})(Y||(Y={}));class gn{static create(e,t,o,r,i,s,c){return new gn(e,t,o,r,i,s,c)}constructor(e,t,o,r,i,s,c){this._nextKeepAlive=0,this._freezeEventListener=()=>{this._logger.log(E.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://learn.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},ee.isRequired(e,"connection"),ee.isRequired(t,"logger"),ee.isRequired(o,"protocol"),this.serverTimeoutInMilliseconds=i??3e4,this.keepAliveIntervalInMilliseconds=s??15e3,this._statefulReconnectBufferSize=c??1e5,this._logger=t,this._protocol=o,this.connection=e,this._reconnectPolicy=r,this._handshakeProtocol=new Ki,this.connection.onreceive=p=>this._processIncomingData(p),this.connection.onclose=p=>this._connectionClosed(p),this._callbacks={},this._methods={},this._closedCallbacks=[],this._reconnectingCallbacks=[],this._reconnectedCallbacks=[],this._invocationId=0,this._receivedHandshakeResponse=!1,this._connectionState=Y.Disconnected,this._connectionStarted=!1,this._cachedPingMessage=this._protocol.writeMessage({type:U.Ping})}get state(){return this._connectionState}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(e){if(this._connectionState!==Y.Disconnected&&this._connectionState!==Y.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!e)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=e}start(){return this._startPromise=this._startWithStateTransitions(),this._startPromise}async _startWithStateTransitions(){if(this._connectionState!==Y.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));this._connectionState=Y.Connecting,this._logger.log(E.Debug,"Starting HubConnection.");try{await this._startInternal(),Q.isBrowser&&window.document.addEventListener("freeze",this._freezeEventListener),this._connectionState=Y.Connected,this._connectionStarted=!0,this._logger.log(E.Debug,"HubConnection connected successfully.")}catch(e){return this._connectionState=Y.Disconnected,this._logger.log(E.Debug,`HubConnection failed to start successfully because of error '${e}'.`),Promise.reject(e)}}async _startInternal(){this._stopDuringStartError=void 0,this._receivedHandshakeResponse=!1;const e=new Promise((t,o)=>{this._handshakeResolver=t,this._handshakeRejecter=o});await this.connection.start(this._protocol.transferFormat);try{let t=this._protocol.version;this.connection.features.reconnect||(t=1);const o={protocol:this._protocol.name,version:t};if(this._logger.log(E.Debug,"Sending handshake request."),await this._sendMessage(this._handshakeProtocol.writeHandshakeRequest(o)),this._logger.log(E.Information,`Using HubProtocol '${this._protocol.name}'.`),this._cleanupTimeout(),this._resetTimeoutPeriod(),this._resetKeepAliveInterval(),await e,this._stopDuringStartError)throw this._stopDuringStartError;this.connection.features.reconnect&&(this._messageBuffer=new Yi(this._protocol,this.connection,this._statefulReconnectBufferSize),this.connection.features.disconnected=this._messageBuffer._disconnected.bind(this._messageBuffer),this.connection.features.resend=()=>{if(this._messageBuffer)return this._messageBuffer._resend()}),this.connection.features.inherentKeepAlive||await this._sendMessage(this._cachedPingMessage)}catch(t){throw this._logger.log(E.Debug,`Hub handshake failed with error '${t}' during start(). Stopping HubConnection.`),this._cleanupTimeout(),this._cleanupPingTimer(),await this.connection.stop(t),t}}async stop(){const e=this._startPromise;this.connection.features.reconnect=!1,this._stopPromise=this._stopInternal(),await this._stopPromise;try{await e}catch{}}_stopInternal(e){if(this._connectionState===Y.Disconnected)return this._logger.log(E.Debug,`Call to HubConnection.stop(${e}) ignored because it is already in the disconnected state.`),Promise.resolve();if(this._connectionState===Y.Disconnecting)return this._logger.log(E.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;const t=this._connectionState;return this._connectionState=Y.Disconnecting,this._logger.log(E.Debug,"Stopping HubConnection."),this._reconnectDelayHandle?(this._logger.log(E.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this._reconnectDelayHandle),this._reconnectDelayHandle=void 0,this._completeClose(),Promise.resolve()):(t===Y.Connected&&this._sendCloseMessage(),this._cleanupTimeout(),this._cleanupPingTimer(),this._stopDuringStartError=e||new me("The connection was stopped before the hub handshake could complete."),this.connection.stop(e))}async _sendCloseMessage(){try{await this._sendWithProtocol(this._createCloseMessage())}catch{}}stream(e,...t){const[o,r]=this._replaceStreamingParams(t),i=this._createStreamInvocation(e,t,r);let s;const c=new Gi;return c.cancelCallback=()=>{const p=this._createCancelInvocation(i.invocationId);return delete this._callbacks[i.invocationId],s.then(()=>this._sendWithProtocol(p))},this._callbacks[i.invocationId]=(p,g)=>{g?c.error(g):p&&(p.type===U.Completion?p.error?c.error(new Error(p.error)):c.complete():c.next(p.item))},s=this._sendWithProtocol(i).catch(p=>{c.error(p),delete this._callbacks[i.invocationId]}),this._launchStreams(o,s),c}_sendMessage(e){return this._resetKeepAliveInterval(),this.connection.send(e)}_sendWithProtocol(e){return this._messageBuffer?this._messageBuffer._send(e):this._sendMessage(this._protocol.writeMessage(e))}send(e,...t){const[o,r]=this._replaceStreamingParams(t),i=this._sendWithProtocol(this._createInvocation(e,t,!0,r));return this._launchStreams(o,i),i}invoke(e,...t){const[o,r]=this._replaceStreamingParams(t),i=this._createInvocation(e,t,!1,r);return new Promise((s,c)=>{this._callbacks[i.invocationId]=(g,S)=>{S?c(S):g&&(g.type===U.Completion?g.error?c(new Error(g.error)):s(g.result):c(new Error(`Unexpected message type: ${g.type}`)))};const p=this._sendWithProtocol(i).catch(g=>{c(g),delete this._callbacks[i.invocationId]});this._launchStreams(o,p)})}on(e,t){e&&t&&(e=e.toLowerCase(),this._methods[e]||(this._methods[e]=[]),this._methods[e].indexOf(t)===-1&&this._methods[e].push(t))}off(e,t){if(!e)return;e=e.toLowerCase();const o=this._methods[e];if(o)if(t){const r=o.indexOf(t);r!==-1&&(o.splice(r,1),o.length===0&&delete this._methods[e])}else delete this._methods[e]}onclose(e){e&&this._closedCallbacks.push(e)}onreconnecting(e){e&&this._reconnectingCallbacks.push(e)}onreconnected(e){e&&this._reconnectedCallbacks.push(e)}_processIncomingData(e){if(this._cleanupTimeout(),this._receivedHandshakeResponse||(e=this._processHandshakeResponse(e),this._receivedHandshakeResponse=!0),e){const t=this._protocol.parseMessages(e,this._logger);for(const o of t)if(!this._messageBuffer||this._messageBuffer._shouldProcessMessage(o))switch(o.type){case U.Invocation:this._invokeClientMethod(o).catch(r=>{this._logger.log(E.Error,`Invoke client method threw error: ${Xt(r)}`)});break;case U.StreamItem:case U.Completion:{const r=this._callbacks[o.invocationId];if(r){o.type===U.Completion&&delete this._callbacks[o.invocationId];try{r(o)}catch(i){this._logger.log(E.Error,`Stream callback threw error: ${Xt(i)}`)}}break}case U.Ping:break;case U.Close:{this._logger.log(E.Information,"Close message received from server.");const r=o.error?new Error("Server returned an error on close: "+o.error):void 0;o.allowReconnect===!0?this.connection.stop(r):this._stopPromise=this._stopInternal(r);break}case U.Ack:this._messageBuffer&&this._messageBuffer._ack(o);break;case U.Sequence:this._messageBuffer&&this._messageBuffer._resetSequence(o);break;default:this._logger.log(E.Warning,`Invalid message type: ${o.type}.`)}}this._resetTimeoutPeriod()}_processHandshakeResponse(e){let t,o;try{[o,t]=this._handshakeProtocol.parseHandshakeResponse(e)}catch(r){const i="Error parsing handshake response: "+r;this._logger.log(E.Error,i);const s=new Error(i);throw this._handshakeRejecter(s),s}if(t.error){const r="Server returned handshake error: "+t.error;this._logger.log(E.Error,r);const i=new Error(r);throw this._handshakeRejecter(i),i}return this._logger.log(E.Debug,"Server handshake complete."),this._handshakeResolver(),o}_resetKeepAliveInterval(){this.connection.features.inherentKeepAlive||(this._nextKeepAlive=new Date().getTime()+this.keepAliveIntervalInMilliseconds,this._cleanupPingTimer())}_resetTimeoutPeriod(){if(!(this.connection.features&&this.connection.features.inherentKeepAlive||(this._timeoutHandle=setTimeout(()=>this.serverTimeout(),this.serverTimeoutInMilliseconds),this._pingServerHandle!==void 0))){let e=this._nextKeepAlive-new Date().getTime();e<0&&(e=0),this._pingServerHandle=setTimeout(async()=>{if(this._connectionState===Y.Connected)try{await this._sendMessage(this._cachedPingMessage)}catch{this._cleanupPingTimer()}},e)}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}async _invokeClientMethod(e){const t=e.target.toLowerCase(),o=this._methods[t];if(!o)return this._logger.log(E.Warning,`No client method with the name '${t}' found.`),void(e.invocationId&&(this._logger.log(E.Warning,`No result given for '${t}' method and invocation ID '${e.invocationId}'.`),await this._sendWithProtocol(this._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null))));const r=o.slice(),i=!!e.invocationId;let s,c,p;for(const g of r)try{const S=s;s=await g.apply(this,e.arguments),i&&s&&S&&(this._logger.log(E.Error,`Multiple results provided for '${t}'. Sending error to server.`),p=this._createCompletionMessage(e.invocationId,"Client provided multiple results.",null)),c=void 0}catch(S){c=S,this._logger.log(E.Error,`A callback for the method '${t}' threw error '${S}'.`)}p?await this._sendWithProtocol(p):i?(c?p=this._createCompletionMessage(e.invocationId,`${c}`,null):s!==void 0?p=this._createCompletionMessage(e.invocationId,null,s):(this._logger.log(E.Warning,`No result given for '${t}' method and invocation ID '${e.invocationId}'.`),p=this._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null)),await this._sendWithProtocol(p)):s&&this._logger.log(E.Error,`Result given for '${t}' method but server is not expecting a result.`)}_connectionClosed(e){this._logger.log(E.Debug,`HubConnection.connectionClosed(${e}) called while in state ${this._connectionState}.`),this._stopDuringStartError=this._stopDuringStartError||e||new me("The underlying connection was closed before the hub handshake could complete."),this._handshakeResolver&&this._handshakeResolver(),this._cancelCallbacksWithError(e||new Error("Invocation canceled due to the underlying connection being closed.")),this._cleanupTimeout(),this._cleanupPingTimer(),this._connectionState===Y.Disconnecting?this._completeClose(e):this._connectionState===Y.Connected&&this._reconnectPolicy?this._reconnect(e):this._connectionState===Y.Connected&&this._completeClose(e)}_completeClose(e){if(this._connectionStarted){this._connectionState=Y.Disconnected,this._connectionStarted=!1,this._messageBuffer&&(this._messageBuffer._dispose(e??new Error("Connection closed.")),this._messageBuffer=void 0),Q.isBrowser&&window.document.removeEventListener("freeze",this._freezeEventListener);try{this._closedCallbacks.forEach(t=>t.apply(this,[e]))}catch(t){this._logger.log(E.Error,`An onclose callback called with error '${e}' threw error '${t}'.`)}}}async _reconnect(e){const t=Date.now();let o=0,r=e!==void 0?e:new Error("Attempting to reconnect due to a unknown error."),i=this._getNextRetryDelay(o++,0,r);if(i===null)return this._logger.log(E.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),void this._completeClose(e);if(this._connectionState=Y.Reconnecting,e?this._logger.log(E.Information,`Connection reconnecting because of error '${e}'.`):this._logger.log(E.Information,"Connection reconnecting."),this._reconnectingCallbacks.length!==0){try{this._reconnectingCallbacks.forEach(s=>s.apply(this,[e]))}catch(s){this._logger.log(E.Error,`An onreconnecting callback called with error '${e}' threw error '${s}'.`)}if(this._connectionState!==Y.Reconnecting)return void this._logger.log(E.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.")}for(;i!==null;){if(this._logger.log(E.Information,`Reconnect attempt number ${o} will start in ${i} ms.`),await new Promise(s=>{this._reconnectDelayHandle=setTimeout(s,i)}),this._reconnectDelayHandle=void 0,this._connectionState!==Y.Reconnecting)return void this._logger.log(E.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");try{if(await this._startInternal(),this._connectionState=Y.Connected,this._logger.log(E.Information,"HubConnection reconnected successfully."),this._reconnectedCallbacks.length!==0)try{this._reconnectedCallbacks.forEach(s=>s.apply(this,[this.connection.connectionId]))}catch(s){this._logger.log(E.Error,`An onreconnected callback called with connectionId '${this.connection.connectionId}; threw error '${s}'.`)}return}catch(s){if(this._logger.log(E.Information,`Reconnect attempt failed because of error '${s}'.`),this._connectionState!==Y.Reconnecting)return this._logger.log(E.Debug,`Connection moved to the '${this._connectionState}' from the reconnecting state during reconnect attempt. Done reconnecting.`),void(this._connectionState===Y.Disconnecting&&this._completeClose());r=s instanceof Error?s:new Error(s.toString()),i=this._getNextRetryDelay(o++,Date.now()-t,r)}}this._logger.log(E.Information,`Reconnect retries have been exhausted after ${Date.now()-t} ms and ${o} failed attempts. Connection disconnecting.`),this._completeClose()}_getNextRetryDelay(e,t,o){try{return this._reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:t,previousRetryCount:e,retryReason:o})}catch(r){return this._logger.log(E.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${e}, ${t}) threw error '${r}'.`),null}}_cancelCallbacksWithError(e){const t=this._callbacks;this._callbacks={},Object.keys(t).forEach(o=>{const r=t[o];try{r(null,e)}catch(i){this._logger.log(E.Error,`Stream 'error' callback called with '${e}' threw error: ${Xt(i)}`)}})}_cleanupPingTimer(){this._pingServerHandle&&(clearTimeout(this._pingServerHandle),this._pingServerHandle=void 0)}_cleanupTimeout(){this._timeoutHandle&&clearTimeout(this._timeoutHandle)}_createInvocation(e,t,o,r){if(o)return r.length!==0?{arguments:t,streamIds:r,target:e,type:U.Invocation}:{arguments:t,target:e,type:U.Invocation};{const i=this._invocationId;return this._invocationId++,r.length!==0?{arguments:t,invocationId:i.toString(),streamIds:r,target:e,type:U.Invocation}:{arguments:t,invocationId:i.toString(),target:e,type:U.Invocation}}}_launchStreams(e,t){if(e.length!==0){t||(t=Promise.resolve());for(const o in e)e[o].subscribe({complete:()=>{t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(o)))},error:r=>{let i;i=r instanceof Error?r.message:r&&r.toString?r.toString():"Unknown error",t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(o,i)))},next:r=>{t=t.then(()=>this._sendWithProtocol(this._createStreamItemMessage(o,r)))}})}}_replaceStreamingParams(e){const t=[],o=[];for(let r=0;r<e.length;r++){const i=e[r];if(this._isObservable(i)){const s=this._invocationId;this._invocationId++,t[s]=i,o.push(s.toString()),e.splice(r,1)}}return[t,o]}_isObservable(e){return e&&e.subscribe&&typeof e.subscribe=="function"}_createStreamInvocation(e,t,o){const r=this._invocationId;return this._invocationId++,o.length!==0?{arguments:t,invocationId:r.toString(),streamIds:o,target:e,type:U.StreamInvocation}:{arguments:t,invocationId:r.toString(),target:e,type:U.StreamInvocation}}_createCancelInvocation(e){return{invocationId:e,type:U.CancelInvocation}}_createStreamItemMessage(e,t){return{invocationId:e,item:t,type:U.StreamItem}}_createCompletionMessage(e,t,o){return t?{error:t,invocationId:e,type:U.Completion}:{invocationId:e,result:o,type:U.Completion}}_createCloseMessage(){return{type:U.Close}}}const Qi=[0,2e3,1e4,3e4,null];class go{constructor(e){this._retryDelays=e!==void 0?[...e,null]:Qi}nextRetryDelayInMilliseconds(e){return this._retryDelays[e.previousRetryCount]}}class Ae{}Ae.Authorization="Authorization",Ae.Cookie="Cookie";class Zi extends bt{constructor(e,t){super(),this._innerClient=e,this._accessTokenFactory=t}async send(e){let t=!0;this._accessTokenFactory&&(!this._accessToken||e.url&&e.url.indexOf("/negotiate?")>0)&&(t=!1,this._accessToken=await this._accessTokenFactory()),this._setAuthorizationHeader(e);const o=await this._innerClient.send(e);return t&&o.statusCode===401&&this._accessTokenFactory?(this._accessToken=await this._accessTokenFactory(),this._setAuthorizationHeader(e),await this._innerClient.send(e)):o}_setAuthorizationHeader(e){e.headers||(e.headers={}),this._accessToken?e.headers[Ae.Authorization]=`Bearer ${this._accessToken}`:this._accessTokenFactory&&e.headers[Ae.Authorization]&&delete e.headers[Ae.Authorization]}getCookieString(e){return this._innerClient.getCookieString(e)}}var te,se;(function(n){n[n.None=0]="None",n[n.WebSockets=1]="WebSockets",n[n.ServerSentEvents=2]="ServerSentEvents",n[n.LongPolling=4]="LongPolling"})(te||(te={})),function(n){n[n.Text=1]="Text",n[n.Binary=2]="Binary"}(se||(se={}));class es{constructor(){this._isAborted=!1,this.onabort=null}abort(){this._isAborted||(this._isAborted=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this._isAborted}}class mo{get pollAborted(){return this._pollAbort.aborted}constructor(e,t,o){this._httpClient=e,this._logger=t,this._pollAbort=new es,this._options=o,this._running=!1,this.onreceive=null,this.onclose=null}async connect(e,t){if(ee.isRequired(e,"url"),ee.isRequired(t,"transferFormat"),ee.isIn(t,se,"transferFormat"),this._url=e,this._logger.log(E.Trace,"(LongPolling transport) Connecting."),t===se.Binary&&typeof XMLHttpRequest<"u"&&typeof new XMLHttpRequest().responseType!="string")throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");const[o,r]=je(),i={[o]:r,...this._options.headers},s={abortSignal:this._pollAbort.signal,headers:i,timeout:1e5,withCredentials:this._options.withCredentials};t===se.Binary&&(s.responseType="arraybuffer");const c=`${e}&_=${Date.now()}`;this._logger.log(E.Trace,`(LongPolling transport) polling: ${c}.`);const p=await this._httpClient.get(c,s);p.statusCode!==200?(this._logger.log(E.Error,`(LongPolling transport) Unexpected response code: ${p.statusCode}.`),this._closeError=new Le(p.statusText||"",p.statusCode),this._running=!1):this._running=!0,this._receiving=this._poll(this._url,s)}async _poll(e,t){try{for(;this._running;)try{const o=`${e}&_=${Date.now()}`;this._logger.log(E.Trace,`(LongPolling transport) polling: ${o}.`);const r=await this._httpClient.get(o,t);r.statusCode===204?(this._logger.log(E.Information,"(LongPolling transport) Poll terminated by server."),this._running=!1):r.statusCode!==200?(this._logger.log(E.Error,`(LongPolling transport) Unexpected response code: ${r.statusCode}.`),this._closeError=new Le(r.statusText||"",r.statusCode),this._running=!1):r.content?(this._logger.log(E.Trace,`(LongPolling transport) data received. ${Ke(r.content,this._options.logMessageContent)}.`),this.onreceive&&this.onreceive(r.content)):this._logger.log(E.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(o){this._running?o instanceof pn?this._logger.log(E.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this._closeError=o,this._running=!1):this._logger.log(E.Trace,`(LongPolling transport) Poll errored after shutdown: ${o.message}`)}}finally{this._logger.log(E.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this._raiseOnClose()}}async send(e){return this._running?Fo(this._logger,"LongPolling",this._httpClient,this._url,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}async stop(){this._logger.log(E.Trace,"(LongPolling transport) Stopping polling."),this._running=!1,this._pollAbort.abort();try{await this._receiving,this._logger.log(E.Trace,`(LongPolling transport) sending DELETE request to ${this._url}.`);const e={},[t,o]=je();e[t]=o;const r={headers:{...e,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials};let i;try{await this._httpClient.delete(this._url,r)}catch(s){i=s}i?i instanceof Le&&(i.statusCode===404?this._logger.log(E.Trace,"(LongPolling transport) A 404 response was returned from sending a DELETE request."):this._logger.log(E.Trace,`(LongPolling transport) Error sending a DELETE request: ${i}`)):this._logger.log(E.Trace,"(LongPolling transport) DELETE request accepted.")}finally{this._logger.log(E.Trace,"(LongPolling transport) Stop finished."),this._raiseOnClose()}}_raiseOnClose(){if(this.onclose){let e="(LongPolling transport) Firing onclose event.";this._closeError&&(e+=" Error: "+this._closeError),this._logger.log(E.Trace,e),this.onclose(this._closeError)}}}class ts{constructor(e,t,o,r){this._httpClient=e,this._accessToken=t,this._logger=o,this._options=r,this.onreceive=null,this.onclose=null}async connect(e,t){return ee.isRequired(e,"url"),ee.isRequired(t,"transferFormat"),ee.isIn(t,se,"transferFormat"),this._logger.log(E.Trace,"(SSE transport) Connecting."),this._url=e,this._accessToken&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(this._accessToken)}`),new Promise((o,r)=>{let i,s=!1;if(t===se.Text){if(Q.isBrowser||Q.isWebWorker)i=new this._options.EventSource(e,{withCredentials:this._options.withCredentials});else{const c=this._httpClient.getCookieString(e),p={};p.Cookie=c;const[g,S]=je();p[g]=S,i=new this._options.EventSource(e,{withCredentials:this._options.withCredentials,headers:{...p,...this._options.headers}})}try{i.onmessage=c=>{if(this.onreceive)try{this._logger.log(E.Trace,`(SSE transport) data received. ${Ke(c.data,this._options.logMessageContent)}.`),this.onreceive(c.data)}catch(p){return void this._close(p)}},i.onerror=c=>{s?this._close():r(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},i.onopen=()=>{this._logger.log(E.Information,`SSE connected to ${this._url}`),this._eventSource=i,s=!0,o()}}catch(c){return void r(c)}}else r(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"))})}async send(e){return this._eventSource?Fo(this._logger,"SSE",this._httpClient,this._url,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}stop(){return this._close(),Promise.resolve()}_close(e){this._eventSource&&(this._eventSource.close(),this._eventSource=void 0,this.onclose&&this.onclose(e))}}class ns{constructor(e,t,o,r,i,s){this._logger=o,this._accessTokenFactory=t,this._logMessageContent=r,this._webSocketConstructor=i,this._httpClient=e,this.onreceive=null,this.onclose=null,this._headers=s}async connect(e,t){let o;return ee.isRequired(e,"url"),ee.isRequired(t,"transferFormat"),ee.isIn(t,se,"transferFormat"),this._logger.log(E.Trace,"(WebSockets transport) Connecting."),this._accessTokenFactory&&(o=await this._accessTokenFactory()),new Promise((r,i)=>{let s;e=e.replace(/^http/,"ws");const c=this._httpClient.getCookieString(e);let p=!1;if(Q.isNode||Q.isReactNative){const g={},[S,k]=je();g[S]=k,o&&(g[Ae.Authorization]=`Bearer ${o}`),c&&(g[Ae.Cookie]=c),s=new this._webSocketConstructor(e,void 0,{headers:{...g,...this._headers}})}else o&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(o)}`);s||(s=new this._webSocketConstructor(e)),t===se.Binary&&(s.binaryType="arraybuffer"),s.onopen=g=>{this._logger.log(E.Information,`WebSocket connected to ${e}.`),this._webSocket=s,p=!0,r()},s.onerror=g=>{let S=null;S=typeof ErrorEvent<"u"&&g instanceof ErrorEvent?g.error:"There was an error with the transport",this._logger.log(E.Information,`(WebSockets transport) ${S}.`)},s.onmessage=g=>{if(this._logger.log(E.Trace,`(WebSockets transport) data received. ${Ke(g.data,this._logMessageContent)}.`),this.onreceive)try{this.onreceive(g.data)}catch(S){return void this._close(S)}},s.onclose=g=>{if(p)this._close(g);else{let S=null;S=typeof ErrorEvent<"u"&&g instanceof ErrorEvent?g.error:"WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",i(new Error(S))}}})}send(e){return this._webSocket&&this._webSocket.readyState===this._webSocketConstructor.OPEN?(this._logger.log(E.Trace,`(WebSockets transport) sending data. ${Ke(e,this._logMessageContent)}.`),this._webSocket.send(e),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this._webSocket&&this._close(void 0),Promise.resolve()}_close(e){this._webSocket&&(this._webSocket.onclose=()=>{},this._webSocket.onmessage=()=>{},this._webSocket.onerror=()=>{},this._webSocket.close(),this._webSocket=void 0),this._logger.log(E.Trace,"(WebSockets transport) socket closed."),this.onclose&&(!this._isCloseEvent(e)||e.wasClean!==!1&&e.code===1e3?e instanceof Error?this.onclose(e):this.onclose():this.onclose(new Error(`WebSocket closed with status code: ${e.code} (${e.reason||"no reason given"}).`)))}_isCloseEvent(e){return e&&typeof e.wasClean=="boolean"&&typeof e.code=="number"}}class os{constructor(e,t={}){var o;if(this._stopPromiseResolver=()=>{},this.features={},this._negotiateVersion=1,ee.isRequired(e,"url"),this._logger=(o=t.logger)===void 0?new gt(E.Information):o===null?Ve.instance:o.log!==void 0?o:new gt(o),this.baseUrl=this._resolveUrl(e),(t=t||{}).logMessageContent=t.logMessageContent!==void 0&&t.logMessageContent,typeof t.withCredentials!="boolean"&&t.withCredentials!==void 0)throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");t.withCredentials=t.withCredentials===void 0||t.withCredentials,t.timeout=t.timeout===void 0?1e5:t.timeout;let r=null,i=null;if(Q.isNode&&typeof require<"u"){const s=typeof __webpack_require__=="function"?__non_webpack_require__:require;r=s("ws"),i=s("eventsource")}Q.isNode||typeof WebSocket>"u"||t.WebSocket?Q.isNode&&!t.WebSocket&&r&&(t.WebSocket=r):t.WebSocket=WebSocket,Q.isNode||typeof EventSource>"u"||t.EventSource?Q.isNode&&!t.EventSource&&i!==void 0&&(t.EventSource=i):t.EventSource=EventSource,this._httpClient=new Zi(t.httpClient||new Vi(this._logger),t.accessTokenFactory),this._connectionState="Disconnected",this._connectionStarted=!1,this._options=t,this.onreceive=null,this.onclose=null}async start(e){if(e=e||se.Binary,ee.isIn(e,se,"transferFormat"),this._logger.log(E.Debug,`Starting connection with transfer format '${se[e]}'.`),this._connectionState!=="Disconnected")return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(this._connectionState="Connecting",this._startInternalPromise=this._startInternal(e),await this._startInternalPromise,this._connectionState==="Disconnecting"){const t="Failed to start the HttpConnection before stop() was called.";return this._logger.log(E.Error,t),await this._stopPromise,Promise.reject(new me(t))}if(this._connectionState!=="Connected"){const t="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return this._logger.log(E.Error,t),Promise.reject(new me(t))}this._connectionStarted=!0}send(e){return this._connectionState!=="Connected"?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this._sendQueue||(this._sendQueue=new mn(this.transport)),this._sendQueue.send(e))}async stop(e){return this._connectionState==="Disconnected"?(this._logger.log(E.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnected state.`),Promise.resolve()):this._connectionState==="Disconnecting"?(this._logger.log(E.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise):(this._connectionState="Disconnecting",this._stopPromise=new Promise(t=>{this._stopPromiseResolver=t}),await this._stopInternal(e),void await this._stopPromise)}async _stopInternal(e){this._stopError=e;try{await this._startInternalPromise}catch{}if(this.transport){try{await this.transport.stop()}catch(t){this._logger.log(E.Error,`HttpConnection.transport.stop() threw error '${t}'.`),this._stopConnection()}this.transport=void 0}else this._logger.log(E.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")}async _startInternal(e){let t=this.baseUrl;this._accessTokenFactory=this._options.accessTokenFactory,this._httpClient._accessTokenFactory=this._accessTokenFactory;try{if(this._options.skipNegotiation){if(this._options.transport!==te.WebSockets)throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");this.transport=this._constructTransport(te.WebSockets),await this._startTransport(t,e)}else{let o=null,r=0;do{if(o=await this._getNegotiationResponse(t),this._connectionState==="Disconnecting"||this._connectionState==="Disconnected")throw new me("The connection was stopped during negotiation.");if(o.error)throw new Error(o.error);if(o.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(o.url&&(t=o.url),o.accessToken){const i=o.accessToken;this._accessTokenFactory=()=>i,this._httpClient._accessToken=i,this._httpClient._accessTokenFactory=void 0}r++}while(o.url&&r<100);if(r===100&&o.url)throw new Error("Negotiate redirection limit exceeded.");await this._createTransport(t,this._options.transport,o,e)}this.transport instanceof mo&&(this.features.inherentKeepAlive=!0),this._connectionState==="Connecting"&&(this._logger.log(E.Debug,"The HttpConnection connected successfully."),this._connectionState="Connected")}catch(o){return this._logger.log(E.Error,"Failed to start the connection: "+o),this._connectionState="Disconnected",this.transport=void 0,this._stopPromiseResolver(),Promise.reject(o)}}async _getNegotiationResponse(e){const t={},[o,r]=je();t[o]=r;const i=this._resolveNegotiateUrl(e);this._logger.log(E.Debug,`Sending negotiation request: ${i}.`);try{const s=await this._httpClient.post(i,{content:"",headers:{...t,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials});if(s.statusCode!==200)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${s.statusCode}'`));const c=JSON.parse(s.content);return(!c.negotiateVersion||c.negotiateVersion<1)&&(c.connectionToken=c.connectionId),c.useStatefulReconnect&&this._options._useStatefulReconnect!==!0?Promise.reject(new fo("Client didn't negotiate Stateful Reconnect but the server did.")):c}catch(s){let c="Failed to complete negotiation with the server: "+s;return s instanceof Le&&s.statusCode===404&&(c+=" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),this._logger.log(E.Error,c),Promise.reject(new fo(c))}}_createConnectUrl(e,t){return t?e+(e.indexOf("?")===-1?"?":"&")+`id=${t}`:e}async _createTransport(e,t,o,r){let i=this._createConnectUrl(e,o.connectionToken);if(this._isITransport(t))return this._logger.log(E.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=t,await this._startTransport(i,r),void(this.connectionId=o.connectionId);const s=[],c=o.availableTransports||[];let p=o;for(const g of c){const S=this._resolveTransportOrError(g,t,r,p?.useStatefulReconnect===!0);if(S instanceof Error)s.push(`${g.transport} failed:`),s.push(S);else if(this._isITransport(S)){if(this.transport=S,!p){try{p=await this._getNegotiationResponse(e)}catch(k){return Promise.reject(k)}i=this._createConnectUrl(e,p.connectionToken)}try{return await this._startTransport(i,r),void(this.connectionId=p.connectionId)}catch(k){if(this._logger.log(E.Error,`Failed to start the transport '${g.transport}': ${k}`),p=void 0,s.push(new zi(`${g.transport} failed: ${k}`,te[g.transport])),this._connectionState!=="Connecting"){const B="Failed to select transport before stop() was called.";return this._logger.log(E.Debug,B),Promise.reject(new me(B))}}}}return s.length>0?Promise.reject(new Wi(`Unable to connect to the server with any of the available transports. ${s.join(" ")}`,s)):Promise.reject(new Error("None of the transports supported by the client are supported by the server."))}_constructTransport(e){switch(e){case te.WebSockets:if(!this._options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new ns(this._httpClient,this._accessTokenFactory,this._logger,this._options.logMessageContent,this._options.WebSocket,this._options.headers||{});case te.ServerSentEvents:if(!this._options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new ts(this._httpClient,this._httpClient._accessToken,this._logger,this._options);case te.LongPolling:return new mo(this._httpClient,this._logger,this._options);default:throw new Error(`Unknown transport: ${e}.`)}}_startTransport(e,t){return this.transport.onreceive=this.onreceive,this.features.reconnect?this.transport.onclose=async o=>{let r=!1;if(this.features.reconnect){try{this.features.disconnected(),await this.transport.connect(e,t),await this.features.resend()}catch{r=!0}r&&this._stopConnection(o)}else this._stopConnection(o)}:this.transport.onclose=o=>this._stopConnection(o),this.transport.connect(e,t)}_resolveTransportOrError(e,t,o,r){const i=te[e.transport];if(i==null)return this._logger.log(E.Debug,`Skipping transport '${e.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${e.transport}' because it is not supported by this client.`);if(!function(s,c){return!s||(c&s)!=0}(t,i))return this._logger.log(E.Debug,`Skipping transport '${te[i]}' because it was disabled by the client.`),new Ni(`'${te[i]}' is disabled by the client.`,i);{if(!(e.transferFormats.map(s=>se[s]).indexOf(o)>=0))return this._logger.log(E.Debug,`Skipping transport '${te[i]}' because it does not support the requested transfer format '${se[o]}'.`),new Error(`'${te[i]}' does not support ${se[o]}.`);if(i===te.WebSockets&&!this._options.WebSocket||i===te.ServerSentEvents&&!this._options.EventSource)return this._logger.log(E.Debug,`Skipping transport '${te[i]}' because it is not supported in your environment.'`),new $i(`'${te[i]}' is not supported in your environment.`,i);this._logger.log(E.Debug,`Selecting transport '${te[i]}'.`);try{return this.features.reconnect=i===te.WebSockets?r:void 0,this._constructTransport(i)}catch(s){return s}}}_isITransport(e){return e&&typeof e=="object"&&"connect"in e}_stopConnection(e){if(this._logger.log(E.Debug,`HttpConnection.stopConnection(${e}) called while in state ${this._connectionState}.`),this.transport=void 0,e=this._stopError||e,this._stopError=void 0,this._connectionState!=="Disconnected"){if(this._connectionState==="Connecting")throw this._logger.log(E.Warning,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${e}) was called while the connection is still in the connecting state.`);if(this._connectionState==="Disconnecting"&&this._stopPromiseResolver(),e?this._logger.log(E.Error,`Connection disconnected with error '${e}'.`):this._logger.log(E.Information,"Connection disconnected."),this._sendQueue&&(this._sendQueue.stop().catch(t=>{this._logger.log(E.Error,`TransportSendQueue.stop() threw error '${t}'.`)}),this._sendQueue=void 0),this.connectionId=void 0,this._connectionState="Disconnected",this._connectionStarted){this._connectionStarted=!1;try{this.onclose&&this.onclose(e)}catch(t){this._logger.log(E.Error,`HttpConnection.onclose(${e}) threw error '${t}'.`)}}}else this._logger.log(E.Debug,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is already in the disconnected state.`)}_resolveUrl(e){if(e.lastIndexOf("https://",0)===0||e.lastIndexOf("http://",0)===0)return e;if(!Q.isBrowser)throw new Error(`Cannot resolve '${e}'.`);const t=window.document.createElement("a");return t.href=e,this._logger.log(E.Information,`Normalizing '${e}' to '${t.href}'.`),t.href}_resolveNegotiateUrl(e){const t=new URL(e);t.pathname.endsWith("/")?t.pathname+="negotiate":t.pathname+="/negotiate";const o=new URLSearchParams(t.searchParams);return o.has("negotiateVersion")||o.append("negotiateVersion",this._negotiateVersion.toString()),o.has("useStatefulReconnect")?o.get("useStatefulReconnect")==="true"&&(this._options._useStatefulReconnect=!0):this._options._useStatefulReconnect===!0&&o.append("useStatefulReconnect","true"),t.search=o.toString(),t.toString()}}class mn{constructor(e){this._transport=e,this._buffer=[],this._executing=!0,this._sendBufferedData=new et,this._transportResult=new et,this._sendLoopPromise=this._sendLoop()}send(e){return this._bufferData(e),this._transportResult||(this._transportResult=new et),this._transportResult.promise}stop(){return this._executing=!1,this._sendBufferedData.resolve(),this._sendLoopPromise}_bufferData(e){if(this._buffer.length&&typeof this._buffer[0]!=typeof e)throw new Error(`Expected data to be of type ${typeof this._buffer} but was of type ${typeof e}`);this._buffer.push(e),this._sendBufferedData.resolve()}async _sendLoop(){for(;;){if(await this._sendBufferedData.promise,!this._executing){this._transportResult&&this._transportResult.reject("Connection stopped.");break}this._sendBufferedData=new et;const e=this._transportResult;this._transportResult=void 0;const t=typeof this._buffer[0]=="string"?this._buffer.join(""):mn._concatBuffers(this._buffer);this._buffer.length=0;try{await this._transport.send(t),e.resolve()}catch(o){e.reject(o)}}}static _concatBuffers(e){const t=e.map(i=>i.byteLength).reduce((i,s)=>i+s),o=new Uint8Array(t);let r=0;for(const i of e)o.set(new Uint8Array(i),r),r+=i.byteLength;return o.buffer}}class et{constructor(){this.promise=new Promise((e,t)=>[this._resolver,this._rejecter]=[e,t])}resolve(){this._resolver()}reject(e){this._rejecter(e)}}class rs{constructor(){this.name="json",this.version=2,this.transferFormat=se.Text}parseMessages(e,t){if(typeof e!="string")throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!e)return[];t===null&&(t=Ve.instance);const o=fe.parse(e),r=[];for(const i of o){const s=JSON.parse(i);if(typeof s.type!="number")throw new Error("Invalid payload.");switch(s.type){case U.Invocation:this._isInvocationMessage(s);break;case U.StreamItem:this._isStreamItemMessage(s);break;case U.Completion:this._isCompletionMessage(s);break;case U.Ping:case U.Close:break;case U.Ack:this._isAckMessage(s);break;case U.Sequence:this._isSequenceMessage(s);break;default:t.log(E.Information,"Unknown message type '"+s.type+"' ignored.");continue}r.push(s)}return r}writeMessage(e){return fe.write(JSON.stringify(e))}_isInvocationMessage(e){this._assertNotEmptyString(e.target,"Invalid payload for Invocation message."),e.invocationId!==void 0&&this._assertNotEmptyString(e.invocationId,"Invalid payload for Invocation message.")}_isStreamItemMessage(e){if(this._assertNotEmptyString(e.invocationId,"Invalid payload for StreamItem message."),e.item===void 0)throw new Error("Invalid payload for StreamItem message.")}_isCompletionMessage(e){if(e.result&&e.error)throw new Error("Invalid payload for Completion message.");!e.result&&e.error&&this._assertNotEmptyString(e.error,"Invalid payload for Completion message."),this._assertNotEmptyString(e.invocationId,"Invalid payload for Completion message.")}_isAckMessage(e){if(typeof e.sequenceId!="number")throw new Error("Invalid SequenceId for Ack message.")}_isSequenceMessage(e){if(typeof e.sequenceId!="number")throw new Error("Invalid SequenceId for Sequence message.")}_assertNotEmptyString(e,t){if(typeof e!="string"||e==="")throw new Error(t)}}const is={trace:E.Trace,debug:E.Debug,info:E.Information,information:E.Information,warn:E.Warning,warning:E.Warning,error:E.Error,critical:E.Critical,none:E.None};class ss{configureLogging(e){if(ee.isRequired(e,"logging"),e.log!==void 0)this.logger=e;else if(typeof e=="string"){const t=function(o){const r=is[o.toLowerCase()];if(r!==void 0)return r;throw new Error(`Unknown log level: ${o}`)}(e);this.logger=new gt(t)}else this.logger=new gt(e);return this}withUrl(e,t){return ee.isRequired(e,"url"),ee.isNotEmpty(e,"url"),this.url=e,this.httpConnectionOptions=typeof t=="object"?{...this.httpConnectionOptions,...t}:{...this.httpConnectionOptions,transport:t},this}withHubProtocol(e){return ee.isRequired(e,"protocol"),this.protocol=e,this}withAutomaticReconnect(e){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return e?Array.isArray(e)?this.reconnectPolicy=new go(e):this.reconnectPolicy=e:this.reconnectPolicy=new go,this}withServerTimeout(e){return ee.isRequired(e,"milliseconds"),this._serverTimeoutInMilliseconds=e,this}withKeepAliveInterval(e){return ee.isRequired(e,"milliseconds"),this._keepAliveIntervalInMilliseconds=e,this}withStatefulReconnect(e){return this.httpConnectionOptions===void 0&&(this.httpConnectionOptions={}),this.httpConnectionOptions._useStatefulReconnect=!0,this._statefulReconnectBufferSize=e?.bufferSize,this}build(){const e=this.httpConnectionOptions||{};if(e.logger===void 0&&(e.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");const t=new os(this.url,e);return gn.create(t,this.logger||Ve.instance,this.protocol||new rs,this.reconnectPolicy,this._serverTimeoutInMilliseconds,this._keepAliveIntervalInMilliseconds,this._statefulReconnectBufferSize)}}function Xs(n){const e=new ss().configureLogging(E.Information).withUrl(n).withAutomaticReconnect({nextRetryDelayInMilliseconds:()=>5e3}).build();return e.keepAliveIntervalInMilliseconds=15e3,e.serverTimeoutInMilliseconds=18e5,e.start().then(()=>{z.Logger().info("启动SignalR连接！")}),e.onclose(async()=>{z.Logger().info("断开SignalR连接!")}),e.onreconnecting(()=>{z.Logger().warn("SignalR服务已断线，重连中...！")}),e.onreconnected(()=>{z.Logger().warn("SignalR重连成功!")}),e}const on=new Set;function vo(n){return n!==null?parseFloat(n):0}function tt(n){const e=window.getComputedStyle(n),t=Math.ceil([e.paddingLeft,e.width,e.paddingRight].map(vo).reduce((r,i)=>r+i)),o=Math.ceil([e.paddingTop,e.height,e.paddingBottom].map(vo).reduce((r,i)=>r+i));return{width:t,height:o}}class as{width;height;constructor(e,t){this.width=e,this.height=t}}function cs(n){const e=n.windowEl;if(e){const t=parseFloat(e.style.left||"NaN"),o=parseFloat(e.style.top||"NaN");if(!isNaN(t)&&!isNaN(o))return{left:t,top:o}}return null}function ls(n,e,t,o){const r=n-t,i=e-o;return r*r+i*i}window.addEventListener("resize",n=>{on.forEach(e=>{e&&fi(e.fixPosition)&&e.fixPosition()})});const nt=[];var yo=Pe({name:"VWindow",props:{windowStyle:{type:Object,required:!0},isOpen:{type:Boolean,required:!1,default:!0},title:{type:String,required:!0,default:""},closeButton:{type:Boolean,required:!1,default:!0},resizable:{type:Boolean,required:!1,default:!1},isScrollable:{type:Boolean,required:!1,default:!1},padding:{type:Number,required:!1,default:8},activateWhenOpen:{type:Boolean,required:!1,default:!0},positionHint:{type:String,required:!1,default:""},zGroup:{type:Number,required:!1,default:1},overflow:{type:String,required:!1,default:"visible"},minWidth:{type:Number,required:!1,default:1},minHeight:{type:Number,required:!1,default:0},maxWidth:{type:Number,required:!1,default:0},maxHeight:{type:Number,required:!1,default:0},height:{type:Number,required:!1},width:{type:Number,required:!1},top:{type:Number,required:!1},left:{type:Number,required:!1}},components:{myButton:ct},setup(n,{emit:e}){const t=ni();if(!t)return;const{proxy:o}=t;let r=0,i,s,c;const p=G(n.isOpen),g=()=>{nt.push(o),c=new li(n.zGroup,S),n.isOpen&&function(M){xo(()=>{r++==0&&(v(o),function(){const D=k.value,{width:A,height:N}=Zt(D);let j,R;if(n.left!==void 0!=(n.top!==void 0))throw new Error("Either of left or top is specified. Both must be set or not set.");if(typeof n.left=="number")j=n.left,R=n.top;else{const H=n.positionHint||"auto";switch(H){case"auto":{let F=20,ce=50,oe=0;do{if(nt.every(ve=>{if(!ve.isOpen||o==ve)return!0;const Ge=cs(ve);if(Ge==null)return!0;const{left:St,top:pe}=Ge;return ls(St,pe,F,ce)>16}))break;F=(F+40)%(window.innerWidth-200),ce=(ce+40)%(window.innerHeight-200)}while(++oe<100);j=F,R=ce}break;case"center":j=(window.innerWidth-A)/2,R=(window.innerHeight-N)/2;break;default:try{const F=H.split("/").map(Number);if(F.length!=2)throw null;const[ce,oe]=F;if(!isFinite(ce)||!isFinite(oe))throw null;j=ce>=0?ce:window.innerWidth-A+ce,R=oe>=0?oe:window.innerHeight-N+oe}catch{throw new Error(`invalid position string: ${H}`)}}}D&&(D.style.left=`${j}px`,D.style.top=`${R}px`)}()),n.resizable&&h(),$(),i=new ci(B.value,k.value,{onMove:()=>$(),onMoveStart:()=>e("move-start"),onMoveEnd:()=>e("move-end")}),n.resizable&&function(){const{height:D}=Zt(B.value);s=new ui(k.value,{onResize:()=>h(),onResizeStart:()=>e("resize-start"),onResizeEnd:()=>e("resize-end"),minWidth:n.minWidth,minHeight:n.minHeight+D,maxWidth:n.maxWidth,maxHeight:n.maxHeight?n.maxHeight+D:void 0})}()}),n.activateWhenOpen&&x()}(),on.add(o)};function S(M){f.value.zIndex=`${M}`}const k=G(null),B=G(null),O=G(null);function x(){c.raise(),e("activate")}const f=G({...n.windowStyle.window,zIndex:"auto",overflow:n.overflow}),l=ze(()=>n.windowStyle.titlebar),y=ze(()=>{const M={...n.windowStyle.content};return n.resizable?M.padding="0":n.padding!=null&&(M.padding=`${n.padding}px`),n.isScrollable&&(M.overflow="auto"),M});function v(M){const{width:D,height:A,top:N,left:j}=M,R=k;if(R&&D!=null&&(R.value.style.width=`${D}px`),A!=null){const H=B.value;if(H){const F=tt(H).height;R.value.style.height=`${A+F}px`}}R&&j!=null&&(R.value.style.left=`${j}px`),R&&N!=null&&(R.value.style.top=`${N}px`)}function h(M=!0){const D=k.value,A=B.value,N=O.value;if(N&&D&&A){const{width:j,height:R}=tt(N),{width:H,height:F}=tt(D),ce=tt(A).height,oe=H-(N.offsetWidth-j),ve=F-ce-(N.offsetHeight-R);N.style.width=`${oe}px`,N.style.height=`${ve}px`,m(),e("resize",new as(oe,ve)),M&&(e("update:width",oe),e("update:height",ve))}}function m(){const M=k.value;if(M){const D=M.getBoundingClientRect();D.left<0&&(f.value.left="0px"),D.top<0&&(f.value.top="0px"),D.right>window.innerWidth&&(f.value.left=window.innerWidth-D.width+"px"),D.bottom>window.innerHeight&&(f.value.top=window.innerHeight-D.height+"px")}}function $(M=!0){m();const D=k.value;if(D){const{left:A,top:N}=D.getBoundingClientRect();M&&(e("update:left",A),e("update:top",N))}}return Te(()=>n.isOpen,M=>{p.value=M}),Te(()=>n.zGroup,M=>{c.group=M}),Te(()=>n.width,M=>{v({width:M}),h(!1)}),Te(()=>n.height,M=>{v({height:M}),h(!1)}),cn(()=>{g()}),ei(()=>{on.delete(this),c.unregister(),s&&s.teardown(),i&&i.teardown(),nt.splice(nt.indexOf(o),1)}),{isOpen:p,windowEl:k,titlebar:B,content:O,activate:x,styleWindow:f,styleTitlebar:l,styleContent:y,closeButtonClick:function(){p.value=!1,e("closebuttonclick")},fixPosition:m}}});const us={class:"title"};var wo;yo.render=function(n,e,t,o,r,i){const s=vt("myButton");return X(),Z(Co,{name:"fade",onAfterLeave:e[2]||(e[2]=c=>n.$emit("close")),onAfterEnter:e[3]||(e[3]=c=>n.$emit("open")),persisted:""},{default:we(()=>[Eo(J("div",{class:"window",style:ge(n.styleWindow),ref:"windowEl",onMousedown:e[0]||(e[0]=(...c)=>n.activate&&n.activate(...c)),onTouchstart:e[1]||(e[1]=(...c)=>n.activate&&n.activate(...c))},[J("div",{class:"titlebar",style:ge(n.styleTitlebar),ref:"titlebar"},[J("div",us,[n.$slots.title?ie(n.$slots,"title",{key:0}):(X(),de(Ie,{key:1},[Yt(an(n.title),1)],64))]),n.closeButton?(X(),Z(s,{key:0,windowStyle:n.windowStyle,onClick:n.closeButtonClick},{default:we(()=>e[4]||(e[4]=[Yt("×")])),_:1},8,["windowStyle","onClick"])):ne("v-if",!0)],4),J("div",{class:"content",style:ge(n.styleContent),ref:"content"},[ie(n.$slots,"default")],4)],36),[[ko,n.isOpen]])]),_:3})},yo.__file="src/controls/vuewindow/window/index.vue",function(n){n[n.StyleBlack=0]="StyleBlack",n[n.StyleWhite=1]="StyleWhite",n[n.StyleMetal=2]="StyleMetal",n[n.StyleGrayblue=3]="StyleGrayblue"}(wo||(wo={}));const Vs={window:{color:"#fff",boxShadow:"0 0 6pt rgba(255, 255, 255, 0.75)",backgroundColor:"rgba(31, 31, 31, 0.9)"},titlebar:{backgroundColor:"rgba(63, 63, 63, 0.9)"},content:{},button:{color:"white"},buttonHover:{backgroundColor:"rgba(255, 255, 255, 0.25)"},buttonActive:{color:"black",backgroundColor:"rgba(255, 255, 255, 0.5)"}},Ks={window:{color:"#000",boxShadow:"0 4pt 8pt rgba(0, 0, 0, 0.5)",background:"linear-gradient(to bottom, rgb(215, 215, 215), rgb(191, 191, 191))"},titlebar:{background:"linear-gradient(to bottom, rgb(215, 215, 215), rgb(191, 191, 191))"},content:{},button:{color:"#000"},buttonHover:{backgroundColor:"rgba(0, 0, 0, 0.25)"},buttonActive:{color:"#fff",backgroundColor:"rgba(0, 0, 0, 0.5)"}};var ue;(function(n){n[n.top=0]="top",n[n.bottom=1]="bottom",n[n.centerBack=2]="centerBack",n[n.centerMain=3]="centerMain",n[n.centerFront=4]="centerFront",n[n.left=5]="left",n[n.right=6]="right"})(ue||(ue={}));class hs{layoutState;layoutMap=new Map;preConditionMap=new Map;widgetsLoadedSet=new Set;widgetConfig=new Array;_LayoutID;_mapItemRefs;constructor(e,t,o,r){this.layoutState=e,this._LayoutID=o,this._mapItemRefs=r,t.forEach(i=>{if(i.layoutID===o&&(this.widgetConfig.push(i),i.afterid))if(this.preConditionMap.has(i.afterid))this.preConditionMap.get(i.afterid)?.add(i);else{const s=new Set;s.add(i),this.preConditionMap.set(i.afterid,s)}})}getLayoutID(){return this._LayoutID}getWidgetConfig(){return this.widgetConfig}preloadWidgets(){this.widgetConfig.filter(e=>e.preload&&!e.afterid).forEach(e=>{this._loadWidget(e)})}async loadWidget(e){if(!e)return;let t;if(un(e)?t=e:Lo(e)&&(t=this.widgetConfig.find(o=>o.id===e)),t){if(t.afterid){if(this.isWidgetLoaded(t.afterid))return this._loadWidget(t);{let o=function(c){c.layoutID===r._LayoutID&&c.widgetID===i&&(r._loadWidget(s),z.EventBus.off(ae.WidgetLoadedEvent,o))};const r=this,i=t.afterid,s=t;return z.EventBus.on(ae.WidgetLoadedEvent,o),this.loadWidget(t.afterid)}}return this._loadWidget(t)}}loadOtherDependenceWidgets(e){this.preConditionMap.has(e)&&this.preConditionMap.get(e)?.forEach(t=>{t.preload&&this._loadWidget(t)})}_loadWidget(e){if(!this.widgetsLoadedSet.has(e.id))return e.component?e.component().then(t=>{if(t.default){const o=ti(t.default);e.layout&&(o.style=e.layout),e.cssClass&&(o.cssClass=e.cssClass),this.getContainerComponents(e.container).value.set(e.id,o),this.widgetsLoadedSet.add(e.id),xo().then(()=>{z.EventBus.emit(ae.WidgetLoadedEvent,{layoutID:this._LayoutID,widgetID:e.id}),this.loadOtherDependenceWidgets(e.id)})}}).catch(t=>{z.Logger().error("加载Widget失败！",e),z.EventBus.emit(ae.WidgetLoadedErrorEvent,e)}):void 0;this.changeWidgetVisible(e.id,!0)}hasDependentWidgets(e){let t=!1;if(this.preConditionMap.has(e)){const o=this.preConditionMap.get(e);if(o){for(const r of o)if(this.isWidgetLoaded(r.id)){t=!0;break}}}return t}unloadWidget(e){if(!e||!this.isWidgetLoaded(e))return;const t=this.widgetConfig.find(o=>o.id===e);if(t){if(this.preConditionMap.has(e)){const o=this.preConditionMap.get(e);if(o)for(const r of o)this.unloadWidget(r.id)}this.getContainerComponents(t.container).value.delete(e),this.widgetsLoadedSet.delete(e),this._mapItemRefs&&this._mapItemRefs.delete(e),z.EventBus.emit(ae.WidgetUnLoadedEvent,{layoutID:this._LayoutID,widgetID:e})}}isWidgetLoaded(e){return this.widgetsLoadedSet.has(e)}splitTwoContainer(e=!1){const t=this.layoutState.centerMainContainer,o=this.layoutState.centerBackContainer;e?(t&&(t.style.left="0",t.style.width="100%"),o&&(o.style.width="100%")):(t&&(t.style.left="50%",t.style.width="50%"),o&&(o.style.width="50%"))}getLayoutContainer(e){switch(e){case ue.top:return this.layoutState.topContainer;case ue.bottom:return this.layoutState.bottomContainer;case ue.left:return this.layoutState.leftContainer;case ue.right:return this.layoutState.rightContainer;case ue.centerBack:return this.layoutState.centerBackContainer;case ue.centerMain:return this.layoutState.centerMainContainer;case ue.centerFront:return this.layoutState.centerFrontContainer}}changeContainerVisible(e,t=!1){const o=this.getLayoutContainer(e);o&&(o.style.visibility=t?"visible":"hidden")}changeWidgetVisible(e,t=!1){const o=this.getWidgetComponent(e);o&&o.changeVisible&&o.changeVisible(t)}isWidgetVisible(e){const t=this.getWidgetComponent(e);return!!t&&(!t.isShow||t.isShow.value)}getWidgetComponent(e){if(this.widgetsLoadedSet.has(e)&&this._mapItemRefs)return this._mapItemRefs.get(e)}getWigetItem(e){return this.widgetConfig.find(t=>t.id===e)}getGroupWigetItems(e){return this.widgetConfig.filter(t=>t.group===e)}getContainerComponents(e){if(this.layoutMap.has(e))return this.layoutMap.get(e);{const t=G(new Map);return this.layoutMap.set(e,t),t}}getWidgetLoadedIDList(){const e=[];return this.widgetsLoadedSet.forEach(t=>{e.push(t)}),e}unloadAllWidgets(e){const t=[];this.widgetsLoadedSet.forEach(o=>{e&&e.length>0?e.findIndex(r=>r===o)<0&&t.push(o):t.push(o)}),t.forEach(o=>this.unloadWidget(o))}unloadWidgets(e){e&&e.length>0&&e.forEach(t=>{this.unloadWidget(t)})}static getLayoutManager(e,t){if(t){const o=t.find(r=>r.id===e);if(o&&o.layoutID)return z.LayoutMap.get(o.layoutID)}}}var mt=Pe({name:"SuspenseWithError",setup(){const n=G(null);return Gr(e=>(n.value="当前页面存在问题，无法渲染……",!0)),{error:n}}});mt.render=function(n,e,t,o,r,i){return n.error?ie(n.$slots,"error",{key:0},()=>[Yt(an(n.error),1)]):(X(),Z(Kr,{key:1},{default:we(()=>[ie(n.$slots,"default")]),fallback:we(()=>[ie(n.$slots,"fallback")]),_:3}))},mt.__file="src/controls/routertransition/SuspenseWithError.vue";var Xo=Pe({name:"RouterTransition",__name:"RouterTransition",setup:n=>(e,t)=>{const o=vt("router-view");return X(),Z(mt,null,{default:we(()=>[ut(o,null,{default:we(({Component:r,route:i})=>[ne(" <transition> "),(X(),Z(Io,null,[i.meta.keepAlive?(X(),Z(ye(r),{key:i.name})):ne("v-if",!0)],1024)),i.meta.keepAlive?ne("v-if",!0):(X(),Z(ye(r),{key:i.name})),ne(" </transition> ")]),_:1})]),_:1})}});Xo.__file="src/controls/routertransition/RouterTransition.vue";var Vt=Pe({name:"LayoutContainer",props:{widgetConfig:{type:Array,required:!0,default:()=>[]},layoutID:{type:String,default:void 0},layoutStyle:{type:Object},enableRouterView:{type:Boolean,default:!0}},emits:["containerLoaded"],components:{RouterTransition:Xo},setup(n,{attrs:e,slots:t,emit:o}){const r=n.layoutID,i=G(n.enableRouterView);Te(()=>n.enableRouterView,()=>{i.value=n.enableRouterView});const s=Yr({topContainer:void 0,centerBackContainer:void 0,centerMainContainer:void 0,centerFrontContainer:void 0,bottomContainer:void 0,leftContainer:void 0,rightContainer:void 0}),c=new Map,p=new hs(s,n.widgetConfig,r,c),g=f(ue.top),S=f(ue.centerBack),k=f(ue.centerFront),B=f(ue.left),O=f(ue.right),x=f(ue.bottom);function f(y){return p?.getContainerComponents(y)}const l=ze(()=>n.layoutStyle);return cn(()=>{p&&(r?z.LayoutMap.set(r,p):(z.LayoutManager=p,z.LayoutMap.set("",p)),p.preloadWidgets(),o("containerLoaded",{layoutID:r,layoutManager:p}),z.EventBus.emit(ae.LayoutContainerLoaded,{layoutID:r,layoutManager:p}))}),{...Jr(s),topContainerComponents:g,centerbackComponents:S,centerfrontComponents:k,leftContainerComponents:B,rightContainerComponents:O,bottomContainerComponents:x,containerStyle:l,isEnableRouterView:i,setItemRef:(y,v)=>{y&&c.set(v,y)}}}});const ds={ref:"topContainer",class:"topContainer"},fs={key:0,ref:"centerMainContainer",class:"centerdiv mainContainer"},ps={ref:"centerBackContainer",class:"centerdiv backContainer"},gs={ref:"centerFrontContainer",class:"centerdiv centerFrontContainer"},ms={ref:"leftContainer",class:"leftContainer"},vs={ref:"rightContainer",class:"rightContainer"},ys={ref:"bottomContainer",class:"bottomContainer"};Vt.render=function(n,e,t,o,r,i){const s=vt("router-transition");return X(),de("div",{class:"layoutContainer",style:ge(n.containerStyle)},[J("div",ds,[ie(n.$slots,"top"),(X(!0),de(Ie,null,$e(n.topContainerComponents,([c,p])=>(X(),Z(ye(p),{ref_for:!0,ref:g=>n.setItemRef(g,c),key:c,style:ge(p.style),class:xe(p.cssClass)},null,8,["style","class"]))),128))],512),J("div",null,[ne(" 主要容器-底部 "),n.isEnableRouterView?(X(),de("div",fs,[ie(n.$slots,"main",{},()=>[ut(s)])],512)):ne("v-if",!0),ne(" 上一层-主容器 "),J("div",ps,[ie(n.$slots,"back"),(X(!0),de(Ie,null,$e(n.centerbackComponents,([c,p])=>(X(),Z(ye(p),{ref_for:!0,ref:g=>n.setItemRef(g,c),key:c,style:ge(p.style),class:xe(p.cssClass)},null,8,["style","class"]))),128))],512),ne(" 最上浮动-主容器 "),J("div",gs,[ie(n.$slots,"front"),(X(!0),de(Ie,null,$e(n.centerfrontComponents,([c,p])=>(X(),Z(ye(p),{ref_for:!0,ref:g=>n.setItemRef(g,c),key:c,style:ge(p.style),class:xe(p.cssClass)},null,8,["style","class"]))),128))],512),J("div",ms,[ie(n.$slots,"left"),(X(!0),de(Ie,null,$e(n.leftContainerComponents,([c,p])=>(X(),Z(ye(p),{ref_for:!0,ref:g=>n.setItemRef(g,c),key:c,style:ge(p.style),class:xe(p.cssClass)},null,8,["style","class"]))),128))],512),J("div",vs,[ie(n.$slots,"right"),(X(!0),de(Ie,null,$e(n.rightContainerComponents,([c,p])=>(X(),Z(ye(p),{ref_for:!0,ref:g=>n.setItemRef(g,c),key:c,style:ge(p.style),class:xe(p.cssClass)},null,8,["style","class"]))),128))],512)]),J("div",ys,[ie(n.$slots,"bottom"),(X(!0),de(Ie,null,$e(n.bottomContainerComponents,([c,p])=>(X(),Z(ye(p),{ref_for:!0,ref:g=>n.setItemRef(g,c),key:c,style:ge(p.style),class:xe(p.cssClass)},null,8,["style","class"]))),128))],512),ne(" 增加默认插槽 "),ie(n.$slots,"default")],4)},Vt.__scopeId="data-v-4d081e5c",Vt.__file="src/controls/layoutcontainer/layout.vue";var ws=Pe({name:"RouterTransition",__name:"RouterTransitionAnimate",props:{enterActive:{type:String,required:!1,default:"animated fadeIn"},leaveActive:{type:String,required:!1,default:"animated fadeOut"}},setup:n=>(e,t)=>{const o=vt("router-view");return X(),Z(mt,null,{default:we(()=>[ut(o,null,{default:we(({Component:r,route:i})=>[ut(Qr,{appear:"","enter-active-class":e.enterActive,"leave-active-class":e.leaveActive},{default:we(()=>[(X(),Z(Io,null,[i.meta.keepAlive?(X(),Z(ye(r),{key:i.name})):ne("v-if",!0)],1024)),i.meta.keepAlive?ne("v-if",!0):(X(),Z(ye(r),{key:i.name}))]),_:2},1032,["enter-active-class","leave-active-class"])]),_:1})]),_:1})}});ws.__file="src/controls/routertransition/RouterTransitionAnimate.vue";const qe=new Map,lt=G(new Map);class ot{static addWindowPanel(e){qe.set(e.id,e)}static removeWindowPanel(e){qe.has(e)&&(qe.delete(e),lt.value.delete(e))}static minimizeWindowPanel(e){qe.has(e)&&lt.value.set(e,-1)}static openWindowPanel(e){qe.has(e)&&lt.value.set(e,1)}}const bs=["src"],_s={key:1,class:"paneltitle"},Ss={class:"dragPanelBar"},Cs={class:"dragPanelContent"},Es={class:"drag-pointer-group"};var bo=Pe({__name:"XWindow",props:{top:{type:[String,Number],default:0},left:{type:[String,Number],default:0},nWidth:{type:[String,Number],default:"300px"},nHeight:{type:[String,Number],default:"400px"},icon:{type:String,default:"img/logo.png"},title:{type:String,default:""},titleHeight:{type:[String,Number],default:"40px"},hasMin:{type:Boolean,default:!0},hasMax:{type:Boolean,default:!1},hasClose:{type:Boolean,default:!0},isDark:{type:Boolean,default:!1},pid:{type:String,default:""},tag:{type:[String,Array,Object,Number],default:""}},emits:["close","open","loaded","minimize"],setup(n,{expose:e,emit:t}){const o=mi(),r=n,i=t,s=G(),c=G(),p=ze(()=>r.isDark),g=G({x:0,y:0}),S=250,k=100,B=G({width:0,height:0}),O=R=>{s.value&&(s.value.style.left=`${R.x}px`,s.value.style.top=`${R.y}px`)};Te(()=>g.value,R=>{O(R)});const x=R=>{s.value&&(s.value.style.width=`${R.width}px`,s.value.style.height=`${R.height}px`)};Te(()=>B.value,R=>{x(R)});const f={eventListenerController:null,startingEdges:null,newEdges:null,clickStart:null,mount:()=>{Object.entries(f.refs).forEach(([R,H])=>{H.value&&H.value.addEventListener("mousedown",F=>{f.mouseDown(F,R)})})},mouseDown:(R,H)=>{R.button==0&&(R.preventDefault(),f.startingEdges={left:g.value.x,top:g.value.y,right:g.value.x+B.value.width,bottom:g.value.y+B.value.height},f.newEdges={...f.startingEdges},f.clickStart={x:R.clientX,y:R.clientY},f.eventListenerController=new AbortController,document.addEventListener("mousemove",F=>{f.mouseMove(F,H)},{signal:f.eventListenerController.signal}),document.addEventListener("mouseup",F=>{f.mouseUp(F,H)},{signal:f.eventListenerController.signal}))},mouseMove:(R,H)=>{if(f.startingEdges!=null&&f.newEdges!=null&&f.clickStart!=null&&f.refs[H].value){if(R.preventDefault(),H.toLowerCase().includes("north")){f.newEdges.top=Math.max(f.startingEdges.top+R.clientY-f.clickStart.y,0);const F=f.newEdges.bottom-f.newEdges.top-k;F<0&&(f.newEdges.top+=F)}else H.toLowerCase().includes("south")&&(f.newEdges.bottom=Math.min(f.startingEdges.bottom+R.clientY-f.clickStart.y,document.body.clientHeight));if(H.toLowerCase().includes("west")){f.newEdges.left=Math.max(f.startingEdges.left+R.clientX-f.clickStart.x,0);const F=f.newEdges.right-f.newEdges.left-S;F<0&&(f.newEdges.left+=F)}else H.toLowerCase().includes("east")&&(f.newEdges.right=Math.min(f.startingEdges.right+R.clientX-f.clickStart.x,document.body.clientWidth));f.update()}},update:()=>{f.newEdges==null||f.startingEdges==null||(g.value={x:Math.max(f.newEdges.left,0),y:Math.max(f.newEdges.top,0)},B.value={width:Math.min(Math.max(f.newEdges.right-f.newEdges.left,S),document.body.clientWidth),height:Math.min(Math.max(f.newEdges.bottom-f.newEdges.top,k),document.body.clientHeight)})},mouseUp:(R,H)=>{R.button!=0||f.startingEdges==null||(R.preventDefault(),f.startingEdges=null,f.newEdges=null,f.clickStart=null,f.eventListenerController&&(f.eventListenerController.abort(),f.eventListenerController=null))},refs:{northWest:G(null),north:G(null),northEast:G(null),west:G(null),east:G(null),southWest:G(null),south:G(null),southEast:G(null)}},l={startingMouse:null,startingPosition:null,mouseDown:R=>{R.button==0&&(R.preventDefault(),l.startingMouse={x:R.clientX,y:R.clientY},l.startingPosition=g.value,document.addEventListener("mousemove",l.mouseMove),document.addEventListener("mouseup",l.mouseUp))},mouseMove:R=>{!l.startingMouse||!l.startingPosition||(R.preventDefault(),g.value={x:Math.min(Math.max(l.startingPosition.x+R.clientX-l.startingMouse.x,0),document.body.clientWidth-B.value.width),y:Math.min(Math.max(l.startingPosition.y+R.clientY-l.startingMouse.y,0),document.body.clientHeight-B.value.height)})},mouseUp:R=>{R.button!=0||!l.startingMouse||!l.startingPosition||(R.preventDefault(),l.startingMouse=null,l.startingPosition=null,document.removeEventListener("mousemove",l.mouseMove),document.removeEventListener("mouseup",l.mouseUp))}};function y(R){return{id:o,icon:r.icon,title:r.title,pid:r.pid,data:R??r.tag}}const v=ze(()=>lt.value.get(o)!==-1),h=G(!1),m=G(!0);function $(){i("minimize",y()),ot.minimizeWindowPanel(o)}function M(){h.value=!h.value}function D(){i("close",y(!1)),ot.removeWindowPanel(o),m.value=!1}const A=ze(()=>h.value?"heroicons-outline:square-2-stack":"ant-design:border-outlined"),N={id:o,isShow:v,close:D,open:function(){i("open",y(!0)),m.value=!0},showHidePanel:$};function j(R){if(Un(R))return R;{const H=Number(R);if(H==H)return H;if(R.endsWith("px")){const F=R.substring(0,R.length-2);return Number(F)}if(R.endsWith("%")){const F=R.substring(0,R.length-1);return Number(F)/100*document.body.clientWidth}return 300}}return e(N),cn(()=>{(function(){let R=90;if(r.hasMin||(R-=30),r.hasMax||(R-=30),r.hasClose||(R-=30),he.setCssVar("--right-bar-width",R+"px",c.value),!c.value)return;const H=Un(r.titleHeight)?r.titleHeight+"px":r.titleHeight;c.value.style.height=H,c.value.style.lineHeight=H})(),function(){const R=y(N);ot.addWindowPanel(R),i("loaded",R)}(),g.value.x=j(r.left),g.value.y=j(r.top),O(g.value),B.value={width:j(r.nWidth),height:j(r.nHeight)},x(B.value),f.mount()}),Zr(()=>{ot.removeWindowPanel(o)}),(R,H)=>(X(),Z(Co,{appear:"","enter-active-class":"animated zoomIn","leave-active-class":"animated zoomOut"},{default:we(()=>[m.value?Eo((X(),de("div",{key:0,ref_key:"dragPanelRef",ref:s,class:xe(["dragWindowPanel",{maxPanel:h.value,dragWindowPanel_dark:p.value}])},[J("div",{class:"dragPanelTitle",ref_key:"dragPanelTitleRef",ref:c,onMousedown:H[0]||(H[0]=(...F)=>l.mouseDown&&l.mouseDown(...F))},[ie(R.$slots,"title",{},()=>[r.icon?(X(),de("img",{key:0,src:r.icon,width:"24",height:"24"},null,8,bs)):ne("v-if",!0),r.title?(X(),de("span",_s,an(r.title),1)):ne("v-if",!0)]),J("div",Ss,[n.hasMin?(X(),Z(Mt(Pt),{key:0,icon:"ant-design:minus-outlined",onClick:$})):ne("v-if",!0),n.hasMax?(X(),Z(Mt(Pt),{key:1,icon:A.value,onClick:M},null,8,["icon"])):ne("v-if",!0),n.hasClose?(X(),Z(Mt(Pt),{key:2,icon:"ant-design:close-outlined",onClick:D})):ne("v-if",!0)])],544),J("div",Cs,[ie(R.$slots,"default")]),J("div",Es,[J("div",{class:"cursor-nw-resize",ref:f.refs.northWest},null,512),J("div",{class:"cursor-n-resize",ref:f.refs.north},null,512),J("div",{class:"cursor-ne-resize",ref:f.refs.northEast},null,512),J("div",{class:"cursor-w-resize",ref:f.refs.west},null,512),H[1]||(H[1]=J("span",{style:{"pointer-events":"all",visibility:"hidden"}},null,-1)),J("div",{class:"cursor-e-resize",ref:f.refs.east},null,512),J("div",{class:"cursor-sw-resize",ref:f.refs.southWest},null,512),J("div",{class:"cursor-s-resize",ref:f.refs.south},null,512),J("div",{class:"cursor-se-resize",ref:f.refs.southEast},null,512)])],2)),[[ko,v.value]]):ne("v-if",!0)]),_:3}))}});function Gs(n){const e=new Jt(new Ee);return e.serialize(n),e.stream.toString()}function Ys(n){return n==null||n===""?n:new Qt(new Ee(n)).deserialize()}bo.__scopeId="data-v-39ea9741",bo.__file="src/controls/xwindow/XWindow.vue";class Vo{debug=!1;simple=!1;utc=!1;longType="number";dictType="object";nullType=void 0;static Instance=new Vo;textEncoder=new TextEncoder;textDecoder=new TextDecoder;constructor(){}encodeResponse(e,t={}){var o=new Ee,r=new Jt(o,this.simple,this.utc),i=t;this.simple;var s=0;for(var c in i)s++;s>0&&(o.writeByte(72),r.serialize(i),r.reset()),e instanceof Error?(o.writeByte(69),r.serialize(this.debug&&e.stack?e.stack:e.message)):(o.writeByte(82),r.serialize(e)),o.writeByte(122);const p=o.takeBytes();return this.textDecoder.decode(p)}decodeRequest(e,t={}){const o=this.textEncoder.encode(e);if(o.length===0)return["~",[]];var r=new Ee(o),i=new Qt(r,!1);i.longType=this.longType,i.dictType=this.dictType;var s=r.readByte();if(s===72){var c=i.deserialize(this.nullType);for(var p in c)t[p]=c[p];i.reset(),s=r.readByte()}switch(s){case 67:return[i.deserialize(String),this.decodeArguments(i)];case 122:return["~",[]];default:throw new Error(`Invalid request:\r
`+r.toString())}}decodeArguments(e){var t=e.stream;let o=[];if(t.readByte()===97){e.reset();var r=ii.readCount(t);const s=new Array(r).fill(this.nullType);o=new Array(r),e.addReference(o);for(var i=0;i<r;++i)o[i]=e.deserialize(s[i]);t.readByte()}return o}encodeRequest(e,t,o={}){var r=new Ee,i=new Jt(r,this.simple,this.utc),s=o;this.simple&&(s.simple=!0);var c=0;for(var p in s)c++;c>0&&(r.writeByte(72),i.serialize(s),i.reset()),r.writeByte(67),i.serialize(e),t.length>0&&(i.reset(),i.serialize(t)),r.writeByte(122);const g=r.takeBytes();return this.textDecoder.decode(g)}decodeResponse(e,t={}){const o=this.textEncoder.encode(e);var r=new Ee(o),i=new Qt(r,!1);i.longType=this.longType,i.dictType=this.dictType;var s=r.readByte();if(s===72){var c=i.deserialize();for(var p in c)t[p]=c[p];i.reset(),s=r.readByte()}switch(s){case 82:return t.simple&&(i.simple=!0),i.deserialize();case 69:throw new Error(i.deserialize(String));case 122:return;default:throw new Error(`Invalid response:\r
`+r.toString())}}}const Ue={Login:"/api/User/Login",ChangeMyPwd:"/api/User/ChangeMyPwd",Logout:"/api/Check/ExitLogin",RefreshToken:"/api/Check/RefreshToken",CheckToken:"/api/Check/CheckToken",GetSystemRights:"/api/System/GetSystem"},rn="access_token",ks=z.Config.ServiceURL.LoginAuthURL;function _o(){const n=yi();n&&ke(Ue.RefreshToken,ks,{refreshToken:n}).then(e=>{Ko(e.data)})}function Is(){const n=Me.getJsonObject(rn);if(!n)return;const e=new Date().getTime(),t=new Date(n.expire).getTime()-e;t>0&&(t<=5e3?_o():setTimeout(_o,t-5e3))}function Ko(n){const e=new Date().getTime();let t=new Date(n.accessToken.expires).getTime()-e;if((t>=36e5||t<-6e5)&&(t=18e5),t>0){let o=Oe();o?(o.token=n.accessToken.tokenContent,o.expire=n.accessToken.expires,o.refresh=n.refreshToken.tokenContent):o={token:n.accessToken.tokenContent,expire:n.accessToken.expires,refresh:n.refreshToken.tokenContent},Me.set(rn,o,t/1e3),Is()}else Me.remove(rn)}const sn="Wm314243",_t=z.Config.ServiceURL.LoginAuthURL;async function Js(n){const e={username:n.username,pwd:nn.encryptToString(n.pwd,sn)},t=(await ke(Ue.Login,_t,e))?.data;return t&&Ko(t.doubletoken),t}function Qs(n){const e={oldpwd:nn.encryptToString(n.oldpwd,sn),newpwd:nn.encryptToString(n.newpwd,sn)};return ke(Ue.ChangeMyPwd,_t,e)}function Zs(){const n=Oe();n&&(wi(Ue.Logout,_t,{token:n.token,reftoken:n.refresh}),$o())}function ea(n){return ke(Ue.CheckToken,_t,{token:n})}const vn="ROLE_SYSTEM_RIGHT",yn=new Mo("",sessionStorage);function xs(){return yn.get(vn)}function So(n){yn.set(vn,n)}function Ts(){yn.remove(vn)}function Xe(n){if(n)for(let e=0;e<n.length;e++){const t=n[e];t.children&&t.children.length>0?(Xe(t.children),t.children.length===0&&(n.splice(e,1),e--)):t.selected||(n.splice(e,1),e--)}}function Go(n,e,t="name"){n&&e&&n.forEach(o=>{const r=e.find(i=>i[t]===o[t]);r&&(o.children?r.children&&Go(o.children,r.children,t):(!r.children||r.children.length===0)&&r.selected&&(o.selected=r.selected))})}function rt(n,e,t,o="name"){const r=n[t],i=e[t];r?i&&Go(r,i,o):i&&(n[t]=i)}function Rs(n){if(n&&n.length>0){const e=n.length;let t,o=!1;if(e>0){o=un(n[0]);const r=o?n[0]:JSON.parse(n[0]);if(e>1)for(let i=1;i<n.length;i++){const s=n[i],c=o?s:JSON.parse(s);rt(r,c,"routes","name"),rt(r,c,"widgetMenu","name"),rt(r,c,"widgets","id"),rt(r,c,"functions","id")}t=r}return t&&(Xe(t.routes),Xe(t.widgetMenu),Xe(t.widgets),Xe(t.functions)),t}}const Kt=[],Gt=[];function Yo(){return xs()}async function ta(n,e=!1){Ts();const t=Ue.GetSystemRights,o=z.Config.ServiceURL.LoginAuthURL,r=await ke(t,o,{systemid:n});if(!r||!r.data)return void z.Message?.warn("无法获取功能授权列表！");const i=r.data;if(i&&i.length>0){if(e){const s=JSON.parse(i[0]);return So(s),s}{const s=Rs(i);return So(s),s}}}function Jo(n,e){const t={...n};return t.meta||(t.meta={}),e.index!=null&&(t.meta.index=e.index),e.title!=null&&(t.meta.title=e.title),n.children&&(t.children=[],e.children&&e.children.forEach(o=>{const r=n.children?.find(i=>i.path===o.path);if(r){const i=Jo(r,o);i&&t.children?.push(i)}})),t}function na(n,e=2){if(e===0)return n;const t=Yo();return t&&t.routes?(Gt.length>0||n.forEach(o=>{const r=t.routes?.find(i=>i.name===o.name);if(r){const i=Jo(o,r);i&&Gt.push(i)}}),Gt):void 0}function oa(n,e=2){if(e===0)return n;const t=Yo();return t&&t.widgets?(Kt.length>0||n?.forEach(o=>{t.widgets?.find(r=>r.id===o.id)&&Kt.push(o)}),Kt):void 0}export{na as $,Zs as A,z as B,ke as C,ea as D,Gs as E,zs as F,js as G,vi as H,Un as I,Qs as J,Oe as L,Is as M,Xo as N,Js as P,Hs as Q,Os as V,Us as Z,Do as _,Ts as a,ta as b,ue as c,oa as d,Vt as e,bo as f,Ws as g,he as h,Bs as i,Ko as j,Fs as k,Mi as l,Lo as m,ot as n,Xs as o,$s as p,Ys as q,Yo as r,ae as s,Vo as t,Ks as u,Vs as v,Mo as w,yo as x,qs as y,Ns as z};
