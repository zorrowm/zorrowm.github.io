/*! *****************************************************************************
Copyright (c) Microsoft Corporation.
Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.
THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var zn=function(e,n){return zn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])},zn(e,n)};function pr(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");zn(e,n);function t(){this.constructor=e}e.prototype=n===null?Object.create(n):(t.prototype=n.prototype,new t)}var T=function(){return T=Object.assign||function(n){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(n[a]=t[a])}return n},T.apply(this,arguments)};function vn(e,n,t){for(var r=0,i=n.length,a;r<i;r++)(a||!(r in n))&&(a||(a=Array.prototype.slice.call(n,0,r)),a[r]=n[r]);return e.concat(a||Array.prototype.slice.call(n))}var Y=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,W=Object.keys,N=Array.isArray;typeof Promise<"u"&&!Y.Promise&&(Y.Promise=Promise);function J(e,n){return typeof n!="object"||W(n).forEach(function(t){e[t]=n[t]}),e}var Ie=Object.getPrototypeOf,yr={}.hasOwnProperty;function Q(e,n){return yr.call(e,n)}function Re(e,n){typeof n=="function"&&(n=n(Ie(e))),(typeof Reflect>"u"?W:Reflect.ownKeys)(n).forEach(function(t){he(e,t,n[t])})}var Lt=Object.defineProperty;function he(e,n,t,r){Lt(e,n,J(t&&Q(t,"get")&&typeof t.get=="function"?{get:t.get,set:t.set,configurable:!0}:{value:t,configurable:!0,writable:!0},r))}function Be(e){return{from:function(n){return e.prototype=Object.create(n.prototype),he(e.prototype,"constructor",e),{extend:Re.bind(null,e.prototype)}}}}var mr=Object.getOwnPropertyDescriptor;function Vt(e,n){var t=mr(e,n),r;return t||(r=Ie(e))&&Vt(r,n)}var gr=[].slice;function An(e,n,t){return gr.call(e,n,t)}function zt(e,n){return n(e)}function Ve(e){if(!e)throw new Error("Assertion Failed")}function Wt(e){Y.setImmediate?setImmediate(e):setTimeout(e,0)}function br(e,n){return e.reduce(function(t,r,i){var a=n(r,i);return a&&(t[a[0]]=a[1]),t},{})}function ue(e,n){if(typeof n=="string"&&Q(e,n))return e[n];if(!n)return e;if(typeof n!="string"){for(var t=[],r=0,i=n.length;r<i;++r){var a=ue(e,n[r]);t.push(a)}return t}var u=n.indexOf(".");if(u!==-1){var o=e[n.substr(0,u)];return o==null?void 0:ue(o,n.substr(u+1))}}function G(e,n,t){if(!(!e||n===void 0)&&!("isFrozen"in Object&&Object.isFrozen(e)))if(typeof n!="string"&&"length"in n){Ve(typeof t!="string"&&"length"in t);for(var r=0,i=n.length;r<i;++r)G(e,n[r],t[r])}else{var a=n.indexOf(".");if(a!==-1){var u=n.substr(0,a),o=n.substr(a+1);if(o==="")t===void 0?N(e)&&!isNaN(parseInt(u))?e.splice(u,1):delete e[u]:e[u]=t;else{var s=e[u];(!s||!Q(e,u))&&(s=e[u]={}),G(s,o,t)}}else t===void 0?N(e)&&!isNaN(parseInt(n))?e.splice(n,1):delete e[n]:e[n]=t}}function wr(e,n){typeof n=="string"?G(e,n,void 0):"length"in n&&[].map.call(n,function(t){G(e,t,void 0)})}function Yt(e){var n={};for(var t in e)Q(e,t)&&(n[t]=e[t]);return n}var _r=[].concat;function Ut(e){return _r.apply([],e)}var xr="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Ut([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(n){return n+e+"Array"})}))).filter(function(e){return Y[e]}),$t=new Set(xr.map(function(e){return Y[e]}));function Ht(e){var n={};for(var t in e)if(Q(e,t)){var r=e[t];n[t]=!r||typeof r!="object"||$t.has(r.constructor)?r:Ht(r)}return n}function Er(e){for(var n in e)if(Q(e,n))return!1;return!0}var We=null;function Ke(e){We=new WeakMap;var n=Wn(e);return We=null,n}function Wn(e){if(!e||typeof e!="object")return e;var n=We.get(e);if(n)return n;if(N(e)){n=[],We.set(e,n);for(var t=0,r=e.length;t<r;++t)n.push(Wn(e[t]))}else if($t.has(e.constructor))n=e;else{var i=Ie(e);n=i===Object.prototype?{}:Object.create(i),We.set(e,n);for(var a in e)Q(e,a)&&(n[a]=Wn(e[a]))}return n}var Kr={}.toString;function Yn(e){return Kr.call(e).slice(8,-1)}var Un=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Sr=typeof Un=="symbol"?function(e){var n;return e!=null&&(n=e[Un])&&n.apply(e)}:function(){return null};function me(e,n){var t=e.indexOf(n);return t>=0&&e.splice(t,1),t>=0}var De={};function ae(e){var n,t,r,i;if(arguments.length===1){if(N(e))return e.slice();if(this===De&&typeof e=="string")return[e];if(i=Sr(e)){for(t=[];r=i.next(),!r.done;)t.push(r.value);return t}if(e==null)return[e];if(n=e.length,typeof n=="number"){for(t=new Array(n);n--;)t[n]=e[n];return t}return[e]}for(n=arguments.length,t=new Array(n);n--;)t[n]=arguments[n];return t}var at=typeof Symbol<"u"?function(e){return e[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},kr=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"],Qt=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],ut=kr.concat(Qt),Ar={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Me(e,n){this.name=e,this.message=n}Be(Me).from(Error).extend({toString:function(){return this.name+": "+this.message}});function Xt(e,n){return e+". Errors: "+Object.keys(n).map(function(t){return n[t].toString()}).filter(function(t,r,i){return i.indexOf(t)===r}).join(`
`)}function pn(e,n,t,r){this.failures=n,this.failedKeys=r,this.successCount=t,this.message=Xt(e,n)}Be(pn).from(Me);function Pe(e,n){this.name="BulkError",this.failures=Object.keys(n).map(function(t){return n[t]}),this.failuresByPos=n,this.message=Xt(e,this.failures)}Be(Pe).from(Me);var ot=ut.reduce(function(e,n){return e[n]=n+"Error",e},{}),Or=Me,D=ut.reduce(function(e,n){var t=n+"Error";function r(i,a){this.name=t,i?typeof i=="string"?(this.message="".concat(i).concat(a?`
 `+a:""),this.inner=a||null):typeof i=="object"&&(this.message="".concat(i.name," ").concat(i.message),this.inner=i):(this.message=Ar[n]||t,this.inner=null)}return Be(r).from(Or),e[n]=r,e},{});D.Syntax=SyntaxError;D.Type=TypeError;D.Range=RangeError;var Kt=Qt.reduce(function(e,n){return e[n+"Error"]=D[n],e},{});function Cr(e,n){if(!e||e instanceof Me||e instanceof TypeError||e instanceof SyntaxError||!e.name||!Kt[e.name])return e;var t=new Kt[e.name](n||e.message,e);return"stack"in e&&he(t,"stack",{get:function(){return this.inner.stack}}),t}var On=ut.reduce(function(e,n){return["Syntax","Type","Range"].indexOf(n)===-1&&(e[n+"Error"]=D[n]),e},{});On.ModifyError=pn;On.DexieError=Me;On.BulkError=Pe;function F(){}function Ge(e){return e}function Dr(e,n){return e==null||e===Ge?n:function(t){return n(e(t))}}function Se(e,n){return function(){e.apply(this,arguments),n.apply(this,arguments)}}function Pr(e,n){return e===F?n:function(){var t=e.apply(this,arguments);t!==void 0&&(arguments[0]=t);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var a=n.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?Se(r,this.onsuccess):r),i&&(this.onerror=this.onerror?Se(i,this.onerror):i),a!==void 0?a:t}}function Tr(e,n){return e===F?n:function(){e.apply(this,arguments);var t=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,n.apply(this,arguments),t&&(this.onsuccess=this.onsuccess?Se(t,this.onsuccess):t),r&&(this.onerror=this.onerror?Se(r,this.onerror):r)}}function Ir(e,n){return e===F?n:function(t){var r=e.apply(this,arguments);J(t,r);var i=this.onsuccess,a=this.onerror;this.onsuccess=null,this.onerror=null;var u=n.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?Se(i,this.onsuccess):i),a&&(this.onerror=this.onerror?Se(a,this.onerror):a),r===void 0?u===void 0?void 0:u:J(r,u)}}function Rr(e,n){return e===F?n:function(){return n.apply(this,arguments)===!1?!1:e.apply(this,arguments)}}function st(e,n){return e===F?n:function(){var t=e.apply(this,arguments);if(t&&typeof t.then=="function"){for(var r=this,i=arguments.length,a=new Array(i);i--;)a[i]=arguments[i];return t.then(function(){return n.apply(r,a)})}return n.apply(this,arguments)}}var re=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Gt(e,n){re=e}var Ue={},Jt=100,ct=typeof Promise>"u"?[]:function(){var e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,Ie(e),e];var n=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[n,Ie(n),e]}(),St=ct[0],kt=ct[1],Br=ct[2],Mr=kt&&kt.then,ge=St&&St.constructor,lt=!!Br;function Fr(){queueMicrotask(Nr)}var $e=function(e,n){ze.push([e,n]),yn&&(Fr(),yn=!1)},$n=!0,yn=!0,_e=[],sn=[],Hn=Ge,fe={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:F,pgp:!1,env:{},finalize:F},A=fe,ze=[],xe=0,cn=[];function S(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var n=this._PSD=A;if(typeof e!="function"){if(e!==Ue)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&Xn(this,this._value);return}this._state=null,this._value=null,++n.ref,qt(this,e)}var Qn={get:function(){var e=A,n=mn;function t(r,i){var a=this,u=!e.global&&(e!==A||n!==mn),o=u&&!ve(),s=new S(function(c,h){ft(a,new Zt(At(r,e,u,o),At(i,e,u,o),c,h,e))});return this._consoleTask&&(s._consoleTask=this._consoleTask),s}return t.prototype=Ue,t},set:function(e){he(this,"then",e&&e.prototype===Ue?Qn:{get:function(){return e},set:Qn.set})}};Re(S.prototype,{then:Qn,_then:function(e,n){ft(this,new Zt(null,null,e,n,A))},catch:function(e){if(arguments.length===1)return this.then(null,e);var n=arguments[0],t=arguments[1];return typeof n=="function"?this.then(null,function(r){return r instanceof n?t(r):ln(r)}):this.then(null,function(r){return r&&r.name===n?t(r):ln(r)})},finally:function(e){return this.then(function(n){return S.resolve(e()).then(function(){return n})},function(n){return S.resolve(e()).then(function(){return ln(n)})})},timeout:function(e,n){var t=this;return e<1/0?new S(function(r,i){var a=setTimeout(function(){return i(new D.Timeout(n))},e);t.then(r,i).finally(clearTimeout.bind(null,a))}):this}});typeof Symbol<"u"&&Symbol.toStringTag&&he(S.prototype,Symbol.toStringTag,"Dexie.Promise");fe.env=nr();function Zt(e,n,t,r,i){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof n=="function"?n:null,this.resolve=t,this.reject=r,this.psd=i}Re(S,{all:function(){var e=ae.apply(null,arguments).map(gn);return new S(function(n,t){e.length===0&&n([]);var r=e.length;e.forEach(function(i,a){return S.resolve(i).then(function(u){e[a]=u,--r||n(e)},t)})})},resolve:function(e){if(e instanceof S)return e;if(e&&typeof e.then=="function")return new S(function(t,r){e.then(t,r)});var n=new S(Ue,!0,e);return n},reject:ln,race:function(){var e=ae.apply(null,arguments).map(gn);return new S(function(n,t){e.map(function(r){return S.resolve(r).then(n,t)})})},PSD:{get:function(){return A},set:function(e){return A=e}},totalEchoes:{get:function(){return mn}},newPSD:de,usePSD:ke,scheduler:{get:function(){return $e},set:function(e){$e=e}},rejectionMapper:{get:function(){return Hn},set:function(e){Hn=e}},follow:function(e,n){return new S(function(t,r){return de(function(i,a){var u=A;u.unhandleds=[],u.onunhandled=a,u.finalize=Se(function(){var o=this;Lr(function(){o.unhandleds.length===0?i():a(o.unhandleds[0])})},u.finalize),e()},n,t,r)})}});ge&&(ge.allSettled&&he(S,"allSettled",function(){var e=ae.apply(null,arguments).map(gn);return new S(function(n){e.length===0&&n([]);var t=e.length,r=new Array(t);e.forEach(function(i,a){return S.resolve(i).then(function(u){return r[a]={status:"fulfilled",value:u}},function(u){return r[a]={status:"rejected",reason:u}}).then(function(){return--t||n(r)})})})}),ge.any&&typeof AggregateError<"u"&&he(S,"any",function(){var e=ae.apply(null,arguments).map(gn);return new S(function(n,t){e.length===0&&t(new AggregateError([]));var r=e.length,i=new Array(r);e.forEach(function(a,u){return S.resolve(a).then(function(o){return n(o)},function(o){i[u]=o,--r||t(new AggregateError(i))})})})}),ge.withResolvers&&(S.withResolvers=ge.withResolvers));function qt(e,n){try{n(function(t){if(e._state===null){if(t===e)throw new TypeError("A promise cannot be resolved with itself.");var r=e._lib&&Fe();t&&typeof t.then=="function"?qt(e,function(i,a){t instanceof S?t._then(i,a):t.then(i,a)}):(e._state=!0,e._value=t,er(e)),r&&je()}},Xn.bind(null,e))}catch(t){Xn(e,t)}}function Xn(e,n){if(sn.push(n),e._state===null){var t=e._lib&&Fe();n=Hn(n),e._state=!1,e._value=n,Vr(e),er(e),t&&je()}}function er(e){var n=e._listeners;e._listeners=[];for(var t=0,r=n.length;t<r;++t)ft(e,n[t]);var i=e._PSD;--i.ref||i.finalize(),xe===0&&(++xe,$e(function(){--xe===0&&ht()},[]))}function ft(e,n){if(e._state===null){e._listeners.push(n);return}var t=e._state?n.onFulfilled:n.onRejected;if(t===null)return(e._state?n.resolve:n.reject)(e._value);++n.psd.ref,++xe,$e(jr,[t,e,n])}function jr(e,n,t){try{var r,i=n._value;!n._state&&sn.length&&(sn=[]),r=re&&n._consoleTask?n._consoleTask.run(function(){return e(i)}):e(i),!n._state&&sn.indexOf(i)===-1&&zr(n),t.resolve(r)}catch(a){t.reject(a)}finally{--xe===0&&ht(),--t.psd.ref||t.psd.finalize()}}function Nr(){ke(fe,function(){Fe()&&je()})}function Fe(){var e=$n;return $n=!1,yn=!1,e}function je(){var e,n,t;do for(;ze.length>0;)for(e=ze,ze=[],t=e.length,n=0;n<t;++n){var r=e[n];r[0].apply(null,r[1])}while(ze.length>0);$n=!0,yn=!0}function ht(){var e=_e;_e=[],e.forEach(function(r){r._PSD.onunhandled.call(null,r._value,r)});for(var n=cn.slice(0),t=n.length;t;)n[--t]()}function Lr(e){function n(){e(),cn.splice(cn.indexOf(n),1)}cn.push(n),++xe,$e(function(){--xe===0&&ht()},[])}function Vr(e){_e.some(function(n){return n._value===e._value})||_e.push(e)}function zr(e){for(var n=_e.length;n;)if(_e[--n]._value===e._value){_e.splice(n,1);return}}function ln(e){return new S(Ue,!1,e)}function j(e,n){var t=A;return function(){var r=Fe(),i=A;try{return pe(t,!0),e.apply(this,arguments)}catch(a){n&&n(a)}finally{pe(i,!1),r&&je()}}}var z={awaits:0,echoes:0,id:0},Wr=0,fn=[],hn=0,mn=0,Yr=0;function de(e,n,t,r){var i=A,a=Object.create(i);a.parent=i,a.ref=0,a.global=!1,a.id=++Yr,fe.env,a.env=lt?{Promise:S,PromiseProp:{value:S,configurable:!0,writable:!0},all:S.all,race:S.race,allSettled:S.allSettled,any:S.any,resolve:S.resolve,reject:S.reject}:{},n&&J(a,n),++i.ref,a.finalize=function(){--this.parent.ref||this.parent.finalize()};var u=ke(a,e,t,r);return a.ref===0&&a.finalize(),u}function Ne(){return z.id||(z.id=++Wr),++z.awaits,z.echoes+=Jt,z.id}function ve(){return z.awaits?(--z.awaits===0&&(z.id=0),z.echoes=z.awaits*Jt,!0):!1}(""+Mr).indexOf("[native code]")===-1&&(Ne=ve=F);function gn(e){return z.echoes&&e&&e.constructor===ge?(Ne(),e.then(function(n){return ve(),n},function(n){return ve(),V(n)})):e}function Ur(e){++mn,(!z.echoes||--z.echoes===0)&&(z.echoes=z.awaits=z.id=0),fn.push(A),pe(e,!0)}function $r(){var e=fn[fn.length-1];fn.pop(),pe(e,!1)}function pe(e,n){var t=A;if((n?z.echoes&&(!hn++||e!==A):hn&&(!--hn||e!==A))&&queueMicrotask(n?Ur.bind(null,e):$r),e!==A&&(A=e,t===fe&&(fe.env=nr()),lt)){var r=fe.env.Promise,i=e.env;(t.global||e.global)&&(Object.defineProperty(Y,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function nr(){var e=Y.Promise;return lt?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(Y,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function ke(e,n,t,r,i){var a=A;try{return pe(e,!0),n(t,r,i)}finally{pe(a,!1)}}function At(e,n,t,r){return typeof e!="function"?e:function(){var i=A;t&&Ne(),pe(n,!0);try{return e.apply(this,arguments)}finally{pe(i,!1),r&&queueMicrotask(ve)}}}function Tn(e){Promise===ge&&z.echoes===0?hn===0?e():enqueueNativeMicroTask(e):setTimeout(e,0)}var V=S.reject;function Gn(e,n,t,r){if(!e.idbdb||!e._state.openComplete&&!A.letThrough&&!e._vip){if(e._state.openComplete)return V(new D.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._state.autoOpen)return V(new D.DatabaseClosed);e.open().catch(F)}return e._state.dbReadyPromise.then(function(){return Gn(e,n,t,r)})}else{var i=e._createTransaction(n,t,e._dbSchema);try{i.create(),e._state.PR1398_maxLoop=3}catch(a){return a.name===ot.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(e.close({disableAutoOpen:!1}),e.open().then(function(){return Gn(e,n,t,r)})):V(a)}return i._promise(n,function(a,u){return de(function(){return A.trans=i,r(a,u,i)})}).then(function(a){if(n==="readwrite")try{i.idbtrans.commit()}catch{}return n==="readonly"?a:i._completion.then(function(){return a})})}}var Ot="4.0.10",we="ï¿¿",Jn=-1/0,ie="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",tr="String expected.",Te=[],Cn="__dbnames",In="readonly",Rn="readwrite";function Ae(e,n){return e?n?function(){return e.apply(this,arguments)&&n.apply(this,arguments)}:e:n}var rr={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function nn(e){return typeof e=="string"&&!/\./.test(e)?function(n){return n[e]===void 0&&e in n&&(n=Ke(n),delete n[e]),n}:function(n){return n}}function Hr(){throw D.Type()}function M(e,n){try{var t=Ct(e),r=Ct(n);if(t!==r)return t==="Array"?1:r==="Array"?-1:t==="binary"?1:r==="binary"?-1:t==="string"?1:r==="string"?-1:t==="Date"?1:r!=="Date"?NaN:-1;switch(t){case"number":case"Date":case"string":return e>n?1:e<n?-1:0;case"binary":return Xr(Dt(e),Dt(n));case"Array":return Qr(e,n)}}catch{}return NaN}function Qr(e,n){for(var t=e.length,r=n.length,i=t<r?t:r,a=0;a<i;++a){var u=M(e[a],n[a]);if(u!==0)return u}return t===r?0:t<r?-1:1}function Xr(e,n){for(var t=e.length,r=n.length,i=t<r?t:r,a=0;a<i;++a)if(e[a]!==n[a])return e[a]<n[a]?-1:1;return t===r?0:t<r?-1:1}function Ct(e){var n=typeof e;if(n!=="object")return n;if(ArrayBuffer.isView(e))return"binary";var t=Yn(e);return t==="ArrayBuffer"?"binary":t}function Dt(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}var ir=function(){function e(){}return e.prototype._trans=function(n,t,r){var i=this._tx||A.trans,a=this.name,u=re&&typeof console<"u"&&console.createTask&&void 0;function o(h,l,p){if(!p.schema[a])throw new D.NotFound("Table "+a+" not part of transaction");return t(p.idbtrans,p)}var s=Fe();try{var c=i&&i.db._novip===this.db._novip?i===A.trans?i._promise(n,o,r):de(function(){return i._promise(n,o,r)},{trans:i,transless:A.transless||A}):Gn(this.db,n,[this.name],o);return u&&(c._consoleTask=u,c=c.catch(function(h){return V(h)})),c}finally{s&&je()}},e.prototype.get=function(n,t){var r=this;return n&&n.constructor===Object?this.where(n).first(t):n==null?V(new D.Type("Invalid argument to Table.get()")):this._trans("readonly",function(i){return r.core.get({trans:i,key:n}).then(function(a){return r.hook.reading.fire(a)})}).then(t)},e.prototype.where=function(n){if(typeof n=="string")return new this.db.WhereClause(this,n);if(N(n))return new this.db.WhereClause(this,"[".concat(n.join("+"),"]"));var t=W(n);if(t.length===1)return this.where(t[0]).equals(n[t[0]]);var r=this.schema.indexes.concat(this.schema.primKey).filter(function(h){if(h.compound&&t.every(function(p){return h.keyPath.indexOf(p)>=0})){for(var l=0;l<t.length;++l)if(t.indexOf(h.keyPath[l])===-1)return!1;return!0}return!1}).sort(function(h,l){return h.keyPath.length-l.keyPath.length})[0];if(r&&this.db._maxKey!==we){var i=r.keyPath.slice(0,t.length);return this.where(i).equals(i.map(function(h){return n[h]}))}var a=this.schema.idxByName;function u(h,l){return M(h,l)===0}var o=t.reduce(function(h,l){var p=h[0],_=h[1],f=a[l],d=n[l];return[p||f,p||!f?Ae(_,f&&f.multi?function(v){var b=ue(v,l);return N(b)&&b.some(function(m){return u(d,m)})}:function(v){return u(d,ue(v,l))}):_]},[null,null]),s=o[0],c=o[1];return s?this.where(s.name).equals(n[s.keyPath]).filter(c):r?this.filter(c):this.where(t).equals("")},e.prototype.filter=function(n){return this.toCollection().and(n)},e.prototype.count=function(n){return this.toCollection().count(n)},e.prototype.offset=function(n){return this.toCollection().offset(n)},e.prototype.limit=function(n){return this.toCollection().limit(n)},e.prototype.each=function(n){return this.toCollection().each(n)},e.prototype.toArray=function(n){return this.toCollection().toArray(n)},e.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},e.prototype.orderBy=function(n){return new this.db.Collection(new this.db.WhereClause(this,N(n)?"[".concat(n.join("+"),"]"):n))},e.prototype.reverse=function(){return this.toCollection().reverse()},e.prototype.mapToClass=function(n){var t=this,r=t.db,i=t.name;this.schema.mappedClass=n,n.prototype instanceof Hr&&(n=function(s){pr(c,s);function c(){return s!==null&&s.apply(this,arguments)||this}return Object.defineProperty(c.prototype,"db",{get:function(){return r},enumerable:!1,configurable:!0}),c.prototype.table=function(){return i},c}(n));for(var a=new Set,u=n.prototype;u;u=Ie(u))Object.getOwnPropertyNames(u).forEach(function(s){return a.add(s)});var o=function(s){if(!s)return s;var c=Object.create(n.prototype);for(var h in s)if(!a.has(h))try{c[h]=s[h]}catch{}return c};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=o,this.hook("reading",o),n},e.prototype.defineClass=function(){function n(t){J(this,t)}return this.mapToClass(n)},e.prototype.add=function(n,t){var r=this,i=this.schema.primKey,a=i.auto,u=i.keyPath,o=n;return u&&a&&(o=nn(u)(n)),this._trans("readwrite",function(s){return r.core.mutate({trans:s,type:"add",keys:t!=null?[t]:null,values:[o]})}).then(function(s){return s.numFailures?S.reject(s.failures[0]):s.lastResult}).then(function(s){if(u)try{G(n,u,s)}catch{}return s})},e.prototype.update=function(n,t){if(typeof n=="object"&&!N(n)){var r=ue(n,this.schema.primKey.keyPath);return r===void 0?V(new D.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(r).modify(t)}else return this.where(":id").equals(n).modify(t)},e.prototype.put=function(n,t){var r=this,i=this.schema.primKey,a=i.auto,u=i.keyPath,o=n;return u&&a&&(o=nn(u)(n)),this._trans("readwrite",function(s){return r.core.mutate({trans:s,type:"put",values:[o],keys:t!=null?[t]:null})}).then(function(s){return s.numFailures?S.reject(s.failures[0]):s.lastResult}).then(function(s){if(u)try{G(n,u,s)}catch{}return s})},e.prototype.delete=function(n){var t=this;return this._trans("readwrite",function(r){return t.core.mutate({trans:r,type:"delete",keys:[n]})}).then(function(r){return r.numFailures?S.reject(r.failures[0]):void 0})},e.prototype.clear=function(){var n=this;return this._trans("readwrite",function(t){return n.core.mutate({trans:t,type:"deleteRange",range:rr})}).then(function(t){return t.numFailures?S.reject(t.failures[0]):void 0})},e.prototype.bulkGet=function(n){var t=this;return this._trans("readonly",function(r){return t.core.getMany({keys:n,trans:r}).then(function(i){return i.map(function(a){return t.hook.reading.fire(a)})})})},e.prototype.bulkAdd=function(n,t,r){var i=this,a=Array.isArray(t)?t:void 0;r=r||(a?void 0:t);var u=r?r.allKeys:void 0;return this._trans("readwrite",function(o){var s=i.schema.primKey,c=s.auto,h=s.keyPath;if(h&&a)throw new D.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(a&&a.length!==n.length)throw new D.InvalidArgument("Arguments objects and keys must have the same length");var l=n.length,p=h&&c?n.map(nn(h)):n;return i.core.mutate({trans:o,type:"add",keys:a,values:p,wantResults:u}).then(function(_){var f=_.numFailures,d=_.results,v=_.lastResult,b=_.failures,m=u?d:v;if(f===0)return m;throw new Pe("".concat(i.name,".bulkAdd(): ").concat(f," of ").concat(l," operations failed"),b)})})},e.prototype.bulkPut=function(n,t,r){var i=this,a=Array.isArray(t)?t:void 0;r=r||(a?void 0:t);var u=r?r.allKeys:void 0;return this._trans("readwrite",function(o){var s=i.schema.primKey,c=s.auto,h=s.keyPath;if(h&&a)throw new D.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(a&&a.length!==n.length)throw new D.InvalidArgument("Arguments objects and keys must have the same length");var l=n.length,p=h&&c?n.map(nn(h)):n;return i.core.mutate({trans:o,type:"put",keys:a,values:p,wantResults:u}).then(function(_){var f=_.numFailures,d=_.results,v=_.lastResult,b=_.failures,m=u?d:v;if(f===0)return m;throw new Pe("".concat(i.name,".bulkPut(): ").concat(f," of ").concat(l," operations failed"),b)})})},e.prototype.bulkUpdate=function(n){var t=this,r=this.core,i=n.map(function(o){return o.key}),a=n.map(function(o){return o.changes}),u=[];return this._trans("readwrite",function(o){return r.getMany({trans:o,keys:i,cache:"clone"}).then(function(s){var c=[],h=[];n.forEach(function(p,_){var f=p.key,d=p.changes,v=s[_];if(v){for(var b=0,m=Object.keys(d);b<m.length;b++){var g=m[b],w=d[g];if(g===t.schema.primKey.keyPath){if(M(w,f)!==0)throw new D.Constraint("Cannot update primary key in bulkUpdate()")}else G(v,g,w)}u.push(_),c.push(f),h.push(v)}});var l=c.length;return r.mutate({trans:o,type:"put",keys:c,values:h,updates:{keys:i,changeSpecs:a}}).then(function(p){var _=p.numFailures,f=p.failures;if(_===0)return l;for(var d=0,v=Object.keys(f);d<v.length;d++){var b=v[d],m=u[Number(b)];if(m!=null){var g=f[b];delete f[b],f[m]=g}}throw new Pe("".concat(t.name,".bulkUpdate(): ").concat(_," of ").concat(l," operations failed"),f)})})})},e.prototype.bulkDelete=function(n){var t=this,r=n.length;return this._trans("readwrite",function(i){return t.core.mutate({trans:i,type:"delete",keys:n})}).then(function(i){var a=i.numFailures,u=i.lastResult,o=i.failures;if(a===0)return u;throw new Pe("".concat(t.name,".bulkDelete(): ").concat(a," of ").concat(r," operations failed"),o)})},e}();function Je(e){var n={},t=function(o,s){if(s){for(var c=arguments.length,h=new Array(c-1);--c;)h[c-1]=arguments[c];return n[o].subscribe.apply(null,h),e}else if(typeof o=="string")return n[o]};t.addEventType=a;for(var r=1,i=arguments.length;r<i;++r)a(arguments[r]);return t;function a(o,s,c){if(typeof o=="object")return u(o);s||(s=Rr),c||(c=F);var h={subscribers:[],fire:c,subscribe:function(l){h.subscribers.indexOf(l)===-1&&(h.subscribers.push(l),h.fire=s(h.fire,l))},unsubscribe:function(l){h.subscribers=h.subscribers.filter(function(p){return p!==l}),h.fire=h.subscribers.reduce(s,c)}};return n[o]=t[o]=h,h}function u(o){W(o).forEach(function(s){var c=o[s];if(N(c))a(s,o[s][0],o[s][1]);else if(c==="asap")var h=a(s,Ge,function(){for(var p=arguments.length,_=new Array(p);p--;)_[p]=arguments[p];h.subscribers.forEach(function(f){Wt(function(){f.apply(null,_)})})});else throw new D.InvalidArgument("Invalid event config")})}}function Ze(e,n){return Be(n).from({prototype:e}),n}function Gr(e){return Ze(ir.prototype,function(t,r,i){this.db=e,this._tx=i,this.name=t,this.schema=r,this.hook=e._allTables[t]?e._allTables[t].hook:Je(null,{creating:[Pr,F],reading:[Dr,Ge],updating:[Ir,F],deleting:[Tr,F]})})}function Oe(e,n){return!(e.filter||e.algorithm||e.or)&&(n?e.justLimit:!e.replayFilter)}function Bn(e,n){e.filter=Ae(e.filter,n)}function Mn(e,n,t){var r=e.replayFilter;e.replayFilter=r?function(){return Ae(r(),n())}:n,e.justLimit=t&&!r}function Jr(e,n){e.isMatch=Ae(e.isMatch,n)}function dn(e,n){if(e.isPrimKey)return n.primaryKey;var t=n.getIndexByKeyPath(e.index);if(!t)throw new D.Schema("KeyPath "+e.index+" on object store "+n.name+" is not indexed");return t}function Pt(e,n,t){var r=dn(e,n.schema);return n.openCursor({trans:t,values:!e.keysOnly,reverse:e.dir==="prev",unique:!!e.unique,query:{index:r,range:e.range}})}function tn(e,n,t,r){var i=e.replayFilter?Ae(e.filter,e.replayFilter()):e.filter;if(e.or){var a={},u=function(o,s,c){if(!i||i(s,c,function(p){return s.stop(p)},function(p){return s.fail(p)})){var h=s.primaryKey,l=""+h;l==="[object ArrayBuffer]"&&(l=""+new Uint8Array(h)),Q(a,l)||(a[l]=!0,n(o,s,c))}};return Promise.all([e.or._iterate(u,t),Tt(Pt(e,r,t),e.algorithm,u,!e.keysOnly&&e.valueMapper)])}else return Tt(Pt(e,r,t),Ae(e.algorithm,i),n,!e.keysOnly&&e.valueMapper)}function Tt(e,n,t,r){var i=r?function(u,o,s){return t(r(u),o,s)}:t,a=j(i);return e.then(function(u){if(u)return u.start(function(){var o=function(){return u.continue()};(!n||n(u,function(s){return o=s},function(s){u.stop(s),o=F},function(s){u.fail(s),o=F}))&&a(u.value,u,function(s){return o=s}),o()})})}var Zr=function(){function e(n){Object.assign(this,n)}return e.prototype.execute=function(n){var t;if(this.add!==void 0){var r=this.add;if(N(r))return vn(vn([],N(n)?n:[],!0),r).sort();if(typeof r=="number")return(Number(n)||0)+r;if(typeof r=="bigint")try{return BigInt(n)+r}catch{return BigInt(0)+r}throw new TypeError("Invalid term ".concat(r))}if(this.remove!==void 0){var i=this.remove;if(N(i))return N(n)?n.filter(function(u){return!i.includes(u)}).sort():[];if(typeof i=="number")return Number(n)-i;if(typeof i=="bigint")try{return BigInt(n)-i}catch{return BigInt(0)-i}throw new TypeError("Invalid subtrahend ".concat(i))}var a=(t=this.replacePrefix)===null||t===void 0?void 0:t[0];return a&&typeof n=="string"&&n.startsWith(a)?this.replacePrefix[1]+n.substring(a.length):n},e}(),qr=function(){function e(){}return e.prototype._read=function(n,t){var r=this._ctx;return r.error?r.table._trans(null,V.bind(null,r.error)):r.table._trans("readonly",n).then(t)},e.prototype._write=function(n){var t=this._ctx;return t.error?t.table._trans(null,V.bind(null,t.error)):t.table._trans("readwrite",n,"locked")},e.prototype._addAlgorithm=function(n){var t=this._ctx;t.algorithm=Ae(t.algorithm,n)},e.prototype._iterate=function(n,t){return tn(this._ctx,n,t,this._ctx.table.core)},e.prototype.clone=function(n){var t=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return n&&J(r,n),t._ctx=r,t},e.prototype.raw=function(){return this._ctx.valueMapper=null,this},e.prototype.each=function(n){var t=this._ctx;return this._read(function(r){return tn(t,n,r,t.table.core)})},e.prototype.count=function(n){var t=this;return this._read(function(r){var i=t._ctx,a=i.table.core;if(Oe(i,!0))return a.count({trans:r,query:{index:dn(i,a.schema),range:i.range}}).then(function(o){return Math.min(o,i.limit)});var u=0;return tn(i,function(){return++u,!1},r,a).then(function(){return u})}).then(n)},e.prototype.sortBy=function(n,t){var r=n.split(".").reverse(),i=r[0],a=r.length-1;function u(c,h){return h?u(c[r[h]],h-1):c[i]}var o=this._ctx.dir==="next"?1:-1;function s(c,h){var l=u(c,a),p=u(h,a);return M(l,p)*o}return this.toArray(function(c){return c.sort(s)}).then(t)},e.prototype.toArray=function(n){var t=this;return this._read(function(r){var i=t._ctx;if(i.dir==="next"&&Oe(i,!0)&&i.limit>0){var a=i.valueMapper,u=dn(i,i.table.core.schema);return i.table.core.query({trans:r,limit:i.limit,values:!0,query:{index:u,range:i.range}}).then(function(s){var c=s.result;return a?c.map(a):c})}else{var o=[];return tn(i,function(s){return o.push(s)},r,i.table.core).then(function(){return o})}},n)},e.prototype.offset=function(n){var t=this._ctx;return n<=0?this:(t.offset+=n,Oe(t)?Mn(t,function(){var r=n;return function(i,a){return r===0?!0:r===1?(--r,!1):(a(function(){i.advance(r),r=0}),!1)}}):Mn(t,function(){var r=n;return function(){return--r<0}}),this)},e.prototype.limit=function(n){return this._ctx.limit=Math.min(this._ctx.limit,n),Mn(this._ctx,function(){var t=n;return function(r,i,a){return--t<=0&&i(a),t>=0}},!0),this},e.prototype.until=function(n,t){return Bn(this._ctx,function(r,i,a){return n(r.value)?(i(a),t):!0}),this},e.prototype.first=function(n){return this.limit(1).toArray(function(t){return t[0]}).then(n)},e.prototype.last=function(n){return this.reverse().first(n)},e.prototype.filter=function(n){return Bn(this._ctx,function(t){return n(t.value)}),Jr(this._ctx,n),this},e.prototype.and=function(n){return this.filter(n)},e.prototype.or=function(n){return new this.db.WhereClause(this._ctx.table,n,this)},e.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},e.prototype.desc=function(){return this.reverse()},e.prototype.eachKey=function(n){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(r,i){n(i.key,i)})},e.prototype.eachUniqueKey=function(n){return this._ctx.unique="unique",this.eachKey(n)},e.prototype.eachPrimaryKey=function(n){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(r,i){n(i.primaryKey,i)})},e.prototype.keys=function(n){var t=this._ctx;t.keysOnly=!t.isMatch;var r=[];return this.each(function(i,a){r.push(a.key)}).then(function(){return r}).then(n)},e.prototype.primaryKeys=function(n){var t=this._ctx;if(t.dir==="next"&&Oe(t,!0)&&t.limit>0)return this._read(function(i){var a=dn(t,t.table.core.schema);return t.table.core.query({trans:i,values:!1,limit:t.limit,query:{index:a,range:t.range}})}).then(function(i){var a=i.result;return a}).then(n);t.keysOnly=!t.isMatch;var r=[];return this.each(function(i,a){r.push(a.primaryKey)}).then(function(){return r}).then(n)},e.prototype.uniqueKeys=function(n){return this._ctx.unique="unique",this.keys(n)},e.prototype.firstKey=function(n){return this.limit(1).keys(function(t){return t[0]}).then(n)},e.prototype.lastKey=function(n){return this.reverse().firstKey(n)},e.prototype.distinct=function(){var n=this._ctx,t=n.index&&n.table.schema.idxByName[n.index];if(!t||!t.multi)return this;var r={};return Bn(this._ctx,function(i){var a=i.primaryKey.toString(),u=Q(r,a);return r[a]=!0,!u}),this},e.prototype.modify=function(n){var t=this,r=this._ctx;return this._write(function(i){var a;if(typeof n=="function")a=n;else{var u=W(n),o=u.length;a=function(m){for(var g=!1,w=0;w<o;++w){var y=u[w],x=n[y],K=ue(m,y);x instanceof Zr?(G(m,y,x.execute(K)),g=!0):K!==x&&(G(m,y,x),g=!0)}return g}}var s=r.table.core,c=s.schema.primaryKey,h=c.outbound,l=c.extractKey,p=200,_=t.db._options.modifyChunkSize;_&&(typeof _=="object"?p=_[s.name]||_["*"]||200:p=_);var f=[],d=0,v=[],b=function(m,g){var w=g.failures,y=g.numFailures;d+=m-y;for(var x=0,K=W(w);x<K.length;x++){var E=K[x];f.push(w[E])}};return t.clone().primaryKeys().then(function(m){var g=Oe(r)&&r.limit===1/0&&(typeof n!="function"||n===Fn)&&{index:r.index,range:r.range},w=function(y){var x=Math.min(p,m.length-y);return s.getMany({trans:i,keys:m.slice(y,y+x),cache:"immutable"}).then(function(K){for(var E=[],C=[],R=h?[]:null,k=[],I=0;I<x;++I){var P=K[I],B={value:Ke(P),primKey:m[y+I]};a.call(B,B.value,B)!==!1&&(B.value==null?k.push(m[y+I]):!h&&M(l(P),l(B.value))!==0?(k.push(m[y+I]),E.push(B.value)):(C.push(B.value),h&&R.push(m[y+I])))}return Promise.resolve(E.length>0&&s.mutate({trans:i,type:"add",values:E}).then(function(O){for(var L in O.failures)k.splice(parseInt(L),1);b(E.length,O)})).then(function(){return(C.length>0||g&&typeof n=="object")&&s.mutate({trans:i,type:"put",keys:R,values:C,criteria:g,changeSpec:typeof n!="function"&&n,isAdditionalChunk:y>0}).then(function(O){return b(C.length,O)})}).then(function(){return(k.length>0||g&&n===Fn)&&s.mutate({trans:i,type:"delete",keys:k,criteria:g,isAdditionalChunk:y>0}).then(function(O){return b(k.length,O)})}).then(function(){return m.length>y+x&&w(y+p)})})};return w(0).then(function(){if(f.length>0)throw new pn("Error modifying one or more objects",f,d,v);return m.length})})})},e.prototype.delete=function(){var n=this._ctx,t=n.range;return Oe(n)&&(n.isPrimKey||t.type===3)?this._write(function(r){var i=n.table.core.schema.primaryKey,a=t;return n.table.core.count({trans:r,query:{index:i,range:a}}).then(function(u){return n.table.core.mutate({trans:r,type:"deleteRange",range:a}).then(function(o){var s=o.failures;o.lastResult,o.results;var c=o.numFailures;if(c)throw new pn("Could not delete some values",Object.keys(s).map(function(h){return s[h]}),u-c);return u-c})})}):this.modify(Fn)},e}(),Fn=function(e,n){return n.value=null};function ei(e){return Ze(qr.prototype,function(t,r){this.db=e;var i=rr,a=null;if(r)try{i=r()}catch(c){a=c}var u=t._ctx,o=u.table,s=o.hook.reading.fire;this._ctx={table:o,index:u.index,isPrimKey:!u.index||o.schema.primKey.keyPath&&u.index===o.schema.primKey.name,range:i,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:a,or:u.or,valueMapper:s!==Ge?s:null}})}function ni(e,n){return e<n?-1:e===n?0:1}function ti(e,n){return e>n?-1:e===n?0:1}function X(e,n,t){var r=e instanceof ur?new e.Collection(e):e;return r._ctx.error=t?new t(n):new TypeError(n),r}function Ce(e){return new e.Collection(e,function(){return ar("")}).limit(0)}function ri(e){return e==="next"?function(n){return n.toUpperCase()}:function(n){return n.toLowerCase()}}function ii(e){return e==="next"?function(n){return n.toLowerCase()}:function(n){return n.toUpperCase()}}function ai(e,n,t,r,i,a){for(var u=Math.min(e.length,r.length),o=-1,s=0;s<u;++s){var c=n[s];if(c!==r[s])return i(e[s],t[s])<0?e.substr(0,s)+t[s]+t.substr(s+1):i(e[s],r[s])<0?e.substr(0,s)+r[s]+t.substr(s+1):o>=0?e.substr(0,o)+n[o]+t.substr(o+1):null;i(e[s],c)<0&&(o=s)}return u<r.length&&a==="next"?e+t.substr(e.length):u<e.length&&a==="prev"?e.substr(0,t.length):o<0?null:e.substr(0,o)+r[o]+t.substr(o+1)}function rn(e,n,t,r){var i,a,u,o,s,c,h,l=t.length;if(!t.every(function(d){return typeof d=="string"}))return X(e,tr);function p(d){i=ri(d),a=ii(d),u=d==="next"?ni:ti;var v=t.map(function(b){return{lower:a(b),upper:i(b)}}).sort(function(b,m){return u(b.lower,m.lower)});o=v.map(function(b){return b.upper}),s=v.map(function(b){return b.lower}),c=d,h=d==="next"?"":r}p("next");var _=new e.Collection(e,function(){return se(o[0],s[l-1]+r)});_._ondirectionchange=function(d){p(d)};var f=0;return _._addAlgorithm(function(d,v,b){var m=d.key;if(typeof m!="string")return!1;var g=a(m);if(n(g,s,f))return!0;for(var w=null,y=f;y<l;++y){var x=ai(m,g,o[y],s[y],u,c);x===null&&w===null?f=y+1:(w===null||u(w,x)>0)&&(w=x)}return v(w!==null?function(){d.continue(w+h)}:b),!1}),_}function se(e,n,t,r){return{type:2,lower:e,upper:n,lowerOpen:t,upperOpen:r}}function ar(e){return{type:1,lower:e,upper:e}}var ur=function(){function e(){}return Object.defineProperty(e.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),e.prototype.between=function(n,t,r,i){r=r!==!1,i=i===!0;try{return this._cmp(n,t)>0||this._cmp(n,t)===0&&(r||i)&&!(r&&i)?Ce(this):new this.Collection(this,function(){return se(n,t,!r,!i)})}catch{return X(this,ie)}},e.prototype.equals=function(n){return n==null?X(this,ie):new this.Collection(this,function(){return ar(n)})},e.prototype.above=function(n){return n==null?X(this,ie):new this.Collection(this,function(){return se(n,void 0,!0)})},e.prototype.aboveOrEqual=function(n){return n==null?X(this,ie):new this.Collection(this,function(){return se(n,void 0,!1)})},e.prototype.below=function(n){return n==null?X(this,ie):new this.Collection(this,function(){return se(void 0,n,!1,!0)})},e.prototype.belowOrEqual=function(n){return n==null?X(this,ie):new this.Collection(this,function(){return se(void 0,n)})},e.prototype.startsWith=function(n){return typeof n!="string"?X(this,tr):this.between(n,n+we,!0,!0)},e.prototype.startsWithIgnoreCase=function(n){return n===""?this.startsWith(n):rn(this,function(t,r){return t.indexOf(r[0])===0},[n],we)},e.prototype.equalsIgnoreCase=function(n){return rn(this,function(t,r){return t===r[0]},[n],"")},e.prototype.anyOfIgnoreCase=function(){var n=ae.apply(De,arguments);return n.length===0?Ce(this):rn(this,function(t,r){return r.indexOf(t)!==-1},n,"")},e.prototype.startsWithAnyOfIgnoreCase=function(){var n=ae.apply(De,arguments);return n.length===0?Ce(this):rn(this,function(t,r){return r.some(function(i){return t.indexOf(i)===0})},n,we)},e.prototype.anyOf=function(){var n=this,t=ae.apply(De,arguments),r=this._cmp;try{t.sort(r)}catch{return X(this,ie)}if(t.length===0)return Ce(this);var i=new this.Collection(this,function(){return se(t[0],t[t.length-1])});i._ondirectionchange=function(u){r=u==="next"?n._ascending:n._descending,t.sort(r)};var a=0;return i._addAlgorithm(function(u,o,s){for(var c=u.key;r(c,t[a])>0;)if(++a,a===t.length)return o(s),!1;return r(c,t[a])===0?!0:(o(function(){u.continue(t[a])}),!1)}),i},e.prototype.notEqual=function(n){return this.inAnyRange([[Jn,n],[n,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},e.prototype.noneOf=function(){var n=ae.apply(De,arguments);if(n.length===0)return new this.Collection(this);try{n.sort(this._ascending)}catch{return X(this,ie)}var t=n.reduce(function(r,i){return r?r.concat([[r[r.length-1][1],i]]):[[Jn,i]]},null);return t.push([n[n.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},e.prototype.inAnyRange=function(n,t){var r=this,i=this._cmp,a=this._ascending,u=this._descending,o=this._min,s=this._max;if(n.length===0)return Ce(this);if(!n.every(function(y){return y[0]!==void 0&&y[1]!==void 0&&a(y[0],y[1])<=0}))return X(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",D.InvalidArgument);var c=!t||t.includeLowers!==!1,h=t&&t.includeUppers===!0;function l(y,x){for(var K=0,E=y.length;K<E;++K){var C=y[K];if(i(x[0],C[1])<0&&i(x[1],C[0])>0){C[0]=o(C[0],x[0]),C[1]=s(C[1],x[1]);break}}return K===E&&y.push(x),y}var p=a;function _(y,x){return p(y[0],x[0])}var f;try{f=n.reduce(l,[]),f.sort(_)}catch{return X(this,ie)}var d=0,v=h?function(y){return a(y,f[d][1])>0}:function(y){return a(y,f[d][1])>=0},b=c?function(y){return u(y,f[d][0])>0}:function(y){return u(y,f[d][0])>=0};function m(y){return!v(y)&&!b(y)}var g=v,w=new this.Collection(this,function(){return se(f[0][0],f[f.length-1][1],!c,!h)});return w._ondirectionchange=function(y){y==="next"?(g=v,p=a):(g=b,p=u),f.sort(_)},w._addAlgorithm(function(y,x,K){for(var E=y.key;g(E);)if(++d,d===f.length)return x(K),!1;return m(E)?!0:(r._cmp(E,f[d][1])===0||r._cmp(E,f[d][0])===0||x(function(){p===a?y.continue(f[d][0]):y.continue(f[d][1])}),!1)}),w},e.prototype.startsWithAnyOf=function(){var n=ae.apply(De,arguments);return n.every(function(t){return typeof t=="string"})?n.length===0?Ce(this):this.inAnyRange(n.map(function(t){return[t,t+we]})):X(this,"startsWithAnyOf() only works with strings")},e}();function ui(e){return Ze(ur.prototype,function(t,r,i){if(this.db=e,this._ctx={table:t,index:r===":id"?null:r,or:i},this._cmp=this._ascending=M,this._descending=function(a,u){return M(u,a)},this._max=function(a,u){return M(a,u)>0?a:u},this._min=function(a,u){return M(a,u)<0?a:u},this._IDBKeyRange=e._deps.IDBKeyRange,!this._IDBKeyRange)throw new D.MissingAPI})}function te(e){return j(function(n){return He(n),e(n.target.error),!1})}function He(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var qe="storagemutated",Zn="x-storagemutated-1",ye=Je(null,qe),oi=function(){function e(){}return e.prototype._lock=function(){return Ve(!A.global),++this._reculock,this._reculock===1&&!A.global&&(A.lockOwnerFor=this),this},e.prototype._unlock=function(){if(Ve(!A.global),--this._reculock===0)for(A.global||(A.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var n=this._blockedFuncs.shift();try{ke(n[1],n[0])}catch{}}return this},e.prototype._locked=function(){return this._reculock&&A.lockOwnerFor!==this},e.prototype.create=function(n){var t=this;if(!this.mode)return this;var r=this.db.idbdb,i=this.db._state.dbOpenError;if(Ve(!this.idbtrans),!n&&!r)switch(i&&i.name){case"DatabaseClosedError":throw new D.DatabaseClosed(i);case"MissingAPIError":throw new D.MissingAPI(i.message,i);default:throw new D.OpenFailed(i)}if(!this.active)throw new D.TransactionInactive;return Ve(this._completion._state===null),n=this.idbtrans=n||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):r.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})),n.onerror=j(function(a){He(a),t._reject(n.error)}),n.onabort=j(function(a){He(a),t.active&&t._reject(new D.Abort(n.error)),t.active=!1,t.on("abort").fire(a)}),n.oncomplete=j(function(){t.active=!1,t._resolve(),"mutatedParts"in n&&ye.storagemutated.fire(n.mutatedParts)}),this},e.prototype._promise=function(n,t,r){var i=this;if(n==="readwrite"&&this.mode!=="readwrite")return V(new D.ReadOnly("Transaction is readonly"));if(!this.active)return V(new D.TransactionInactive);if(this._locked())return new S(function(u,o){i._blockedFuncs.push([function(){i._promise(n,t,r).then(u,o)},A])});if(r)return de(function(){var u=new S(function(o,s){i._lock();var c=t(o,s,i);c&&c.then&&c.then(o,s)});return u.finally(function(){return i._unlock()}),u._lib=!0,u});var a=new S(function(u,o){var s=t(u,o,i);s&&s.then&&s.then(u,o)});return a._lib=!0,a},e.prototype._root=function(){return this.parent?this.parent._root():this},e.prototype.waitFor=function(n){var t=this._root(),r=S.resolve(n);if(t._waitingFor)t._waitingFor=t._waitingFor.then(function(){return r});else{t._waitingFor=r,t._waitingQueue=[];var i=t.idbtrans.objectStore(t.storeNames[0]);(function u(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(i.get(-1/0).onsuccess=u)})()}var a=t._waitingFor;return new S(function(u,o){r.then(function(s){return t._waitingQueue.push(j(u.bind(null,s)))},function(s){return t._waitingQueue.push(j(o.bind(null,s)))}).finally(function(){t._waitingFor===a&&(t._waitingFor=null)})})},e.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new D.Abort))},e.prototype.table=function(n){var t=this._memoizedTables||(this._memoizedTables={});if(Q(t,n))return t[n];var r=this.schema[n];if(!r)throw new D.NotFound("Table "+n+" not part of transaction");var i=new this.db.Table(n,r,this);return i.core=this.db.core.table(n),t[n]=i,i},e}();function si(e){return Ze(oi.prototype,function(t,r,i,a,u){var o=this;this.db=e,this.mode=t,this.storeNames=r,this.schema=i,this.chromeTransactionDurability=a,this.idbtrans=null,this.on=Je(this,"complete","error","abort"),this.parent=u||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new S(function(s,c){o._resolve=s,o._reject=c}),this._completion.then(function(){o.active=!1,o.on.complete.fire()},function(s){var c=o.active;return o.active=!1,o.on.error.fire(s),o.parent?o.parent._reject(s):c&&o.idbtrans&&o.idbtrans.abort(),V(s)})})}function qn(e,n,t,r,i,a,u){return{name:e,keyPath:n,unique:t,multi:r,auto:i,compound:a,src:(t&&!u?"&":"")+(r?"*":"")+(i?"++":"")+or(n)}}function or(e){return typeof e=="string"?e:e?"["+[].join.call(e,"+")+"]":""}function dt(e,n,t){return{name:e,primKey:n,indexes:t,mappedClass:null,idxByName:br(t,function(r){return[r.name,r]})}}function ci(e){return e.length===1?e[0]:e}var Qe=function(e){try{return e.only([[]]),Qe=function(){return[[]]},[[]]}catch{return Qe=function(){return we},we}};function et(e){return e==null?function(){}:typeof e=="string"?li(e):function(n){return ue(n,e)}}function li(e){var n=e.split(".");return n.length===1?function(t){return t[e]}:function(t){return ue(t,e)}}function It(e){return[].slice.call(e)}var fi=0;function Ye(e){return e==null?":id":typeof e=="string"?e:"[".concat(e.join("+"),"]")}function hi(e,n,t){function r(l,p){var _=It(l.objectStoreNames);return{schema:{name:l.name,tables:_.map(function(f){return p.objectStore(f)}).map(function(f){var d=f.keyPath,v=f.autoIncrement,b=N(d),m=d==null,g={},w={name:f.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:m,compound:b,keyPath:d,autoIncrement:v,unique:!0,extractKey:et(d)},indexes:It(f.indexNames).map(function(y){return f.index(y)}).map(function(y){var x=y.name,K=y.unique,E=y.multiEntry,C=y.keyPath,R=N(C),k={name:x,compound:R,keyPath:C,unique:K,multiEntry:E,extractKey:et(C)};return g[Ye(C)]=k,k}),getIndexByKeyPath:function(y){return g[Ye(y)]}};return g[":id"]=w.primaryKey,d!=null&&(g[Ye(d)]=w.primaryKey),w})},hasGetAll:_.length>0&&"getAll"in p.objectStore(_[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function i(l){if(l.type===3)return null;if(l.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var p=l.lower,_=l.upper,f=l.lowerOpen,d=l.upperOpen,v=p===void 0?_===void 0?null:n.upperBound(_,!!d):_===void 0?n.lowerBound(p,!!f):n.bound(p,_,!!f,!!d);return v}function a(l){var p=l.name;function _(v){var b=v.trans,m=v.type,g=v.keys,w=v.values,y=v.range;return new Promise(function(x,K){x=j(x);var E=b.objectStore(p),C=E.keyPath==null,R=m==="put"||m==="add";if(!R&&m!=="delete"&&m!=="deleteRange")throw new Error("Invalid operation type: "+m);var k=(g||w||{length:1}).length;if(g&&w&&g.length!==w.length)throw new Error("Given keys array must have same length as given values array.");if(k===0)return x({numFailures:0,failures:{},results:[],lastResult:void 0});var I,P=[],B=[],O=0,L=function(ne){++O,He(ne)};if(m==="deleteRange"){if(y.type===4)return x({numFailures:O,failures:B,results:[],lastResult:void 0});y.type===3?P.push(I=E.clear()):P.push(I=E.delete(i(y)))}else{var U=R?C?[w,g]:[w,null]:[g,null],ee=U[0],H=U[1];if(R)for(var Z=0;Z<k;++Z)P.push(I=H&&H[Z]!==void 0?E[m](ee[Z],H[Z]):E[m](ee[Z])),I.onerror=L;else for(var Z=0;Z<k;++Z)P.push(I=E[m](ee[Z])),I.onerror=L}var oe=function(ne){var Le=ne.target.result;P.forEach(function(q,en){return q.error!=null&&(B[en]=q.error)}),x({numFailures:O,failures:B,results:m==="delete"?g:P.map(function(q){return q.result}),lastResult:Le})};I.onerror=function(ne){L(ne),oe(ne)},I.onsuccess=oe})}function f(v){var b=v.trans,m=v.values,g=v.query,w=v.reverse,y=v.unique;return new Promise(function(x,K){x=j(x);var E=g.index,C=g.range,R=b.objectStore(p),k=E.isPrimaryKey?R:R.index(E.name),I=w?y?"prevunique":"prev":y?"nextunique":"next",P=m||!("openKeyCursor"in k)?k.openCursor(i(C),I):k.openKeyCursor(i(C),I);P.onerror=te(K),P.onsuccess=j(function(B){var O=P.result;if(!O){x(null);return}O.___id=++fi,O.done=!1;var L=O.continue.bind(O),U=O.continuePrimaryKey;U&&(U=U.bind(O));var ee=O.advance.bind(O),H=function(){throw new Error("Cursor not started")},Z=function(){throw new Error("Cursor not stopped")};O.trans=b,O.stop=O.continue=O.continuePrimaryKey=O.advance=H,O.fail=j(K),O.next=function(){var oe=this,ne=1;return this.start(function(){return ne--?oe.continue():oe.stop()}).then(function(){return oe})},O.start=function(oe){var ne=new Promise(function(q,en){q=j(q),P.onerror=te(en),O.fail=en,O.stop=function(vr){O.stop=O.continue=O.continuePrimaryKey=O.advance=Z,q(vr)}}),Le=function(){if(P.result)try{oe()}catch(q){O.fail(q)}else O.done=!0,O.start=function(){throw new Error("Cursor behind last entry")},O.stop()};return P.onsuccess=j(function(q){P.onsuccess=Le,Le()}),O.continue=L,O.continuePrimaryKey=U,O.advance=ee,Le(),ne},x(O)},K)})}function d(v){return function(b){return new Promise(function(m,g){m=j(m);var w=b.trans,y=b.values,x=b.limit,K=b.query,E=x===1/0?void 0:x,C=K.index,R=K.range,k=w.objectStore(p),I=C.isPrimaryKey?k:k.index(C.name),P=i(R);if(x===0)return m({result:[]});if(v){var B=y?I.getAll(P,E):I.getAllKeys(P,E);B.onsuccess=function(ee){return m({result:ee.target.result})},B.onerror=te(g)}else{var O=0,L=y||!("openKeyCursor"in I)?I.openCursor(P):I.openKeyCursor(P),U=[];L.onsuccess=function(ee){var H=L.result;if(!H)return m({result:U});if(U.push(y?H.value:H.primaryKey),++O===x)return m({result:U});H.continue()},L.onerror=te(g)}})}}return{name:p,schema:l,mutate:_,getMany:function(v){var b=v.trans,m=v.keys;return new Promise(function(g,w){g=j(g);for(var y=b.objectStore(p),x=m.length,K=new Array(x),E=0,C=0,R,k=function(O){var L=O.target;(K[L._pos]=L.result)!=null,++C===E&&g(K)},I=te(w),P=0;P<x;++P){var B=m[P];B!=null&&(R=y.get(m[P]),R._pos=P,R.onsuccess=k,R.onerror=I,++E)}E===0&&g(K)})},get:function(v){var b=v.trans,m=v.key;return new Promise(function(g,w){g=j(g);var y=b.objectStore(p),x=y.get(m);x.onsuccess=function(K){return g(K.target.result)},x.onerror=te(w)})},query:d(s),openCursor:f,count:function(v){var b=v.query,m=v.trans,g=b.index,w=b.range;return new Promise(function(y,x){var K=m.objectStore(p),E=g.isPrimaryKey?K:K.index(g.name),C=i(w),R=C?E.count(C):E.count();R.onsuccess=j(function(k){return y(k.target.result)}),R.onerror=te(x)})}}}var u=r(e,t),o=u.schema,s=u.hasGetAll,c=o.tables.map(function(l){return a(l)}),h={};return c.forEach(function(l){return h[l.name]=l}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(l){var p=h[l];if(!p)throw new Error("Table '".concat(l,"' not found"));return h[l]},MIN_KEY:-1/0,MAX_KEY:Qe(n),schema:o}}function di(e,n){return n.reduce(function(t,r){var i=r.create;return T(T({},t),i(t))},e)}function vi(e,n,t,r){var i=t.IDBKeyRange;t.indexedDB;var a=di(hi(n,i,r),e.dbcore);return{dbcore:a}}function bn(e,n){var t=n.db,r=vi(e._middlewares,t,e._deps,n);e.core=r.dbcore,e.tables.forEach(function(i){var a=i.name;e.core.schema.tables.some(function(u){return u.name===a})&&(i.core=e.core.table(a),e[a]instanceof e.Table&&(e[a].core=i.core))})}function wn(e,n,t,r){t.forEach(function(i){var a=r[i];n.forEach(function(u){var o=Vt(u,i);(!o||"value"in o&&o.value===void 0)&&(u===e.Transaction.prototype||u instanceof e.Transaction?he(u,i,{get:function(){return this.table(i)},set:function(s){Lt(this,i,{value:s,writable:!0,configurable:!0,enumerable:!0})}}):u[i]=new e.Table(i,a))})})}function nt(e,n){n.forEach(function(t){for(var r in t)t[r]instanceof e.Table&&delete t[r]})}function pi(e,n){return e._cfg.version-n._cfg.version}function yi(e,n,t,r){var i=e._dbSchema;t.objectStoreNames.contains("$meta")&&!i.$meta&&(i.$meta=dt("$meta",cr("")[0],[]),e._storeNames.push("$meta"));var a=e._createTransaction("readwrite",e._storeNames,i);a.create(t),a._completion.catch(r);var u=a._reject.bind(a),o=A.transless||A;de(function(){if(A.trans=a,A.transless=o,n===0)W(i).forEach(function(s){pt(t,s,i[s].primKey,i[s].indexes)}),bn(e,t),S.follow(function(){return e.on.populate.fire(a)}).catch(u);else return bn(e,t),gi(e,a,n).then(function(s){return bi(e,s,a,t)}).catch(u)})}function mi(e,n){sr(e._dbSchema,n),n.db.version%10===0&&!n.objectStoreNames.contains("$meta")&&n.db.createObjectStore("$meta").add(Math.ceil(n.db.version/10-1),"version");var t=Dn(e,e.idbdb,n);xn(e,e._dbSchema,n);for(var r=vt(t,e._dbSchema),i=function(c){if(c.change.length||c.recreate)return{value:void 0};var h=n.objectStore(c.name);c.add.forEach(function(l){_n(h,l)})},a=0,u=r.change;a<u.length;a++){var o=u[a],s=i(o);if(typeof s=="object")return s.value}}function gi(e,n,t){return n.storeNames.includes("$meta")?n.table("$meta").get("version").then(function(r){return r??t}):S.resolve(t)}function bi(e,n,t,r){var i=[],a=e._versions,u=e._dbSchema=Dn(e,e.idbdb,r),o=a.filter(function(c){return c._cfg.version>=n});if(o.length===0)return S.resolve();o.forEach(function(c){i.push(function(){var h=u,l=c._cfg.dbschema;xn(e,h,r),xn(e,l,r),u=e._dbSchema=l;var p=vt(h,l);p.add.forEach(function(m){pt(r,m[0],m[1].primKey,m[1].indexes)}),p.change.forEach(function(m){if(m.recreate)throw new D.Upgrade("Not yet support for changing primary key");var g=r.objectStore(m.name);m.add.forEach(function(w){return _n(g,w)}),m.change.forEach(function(w){g.deleteIndex(w.name),_n(g,w)}),m.del.forEach(function(w){return g.deleteIndex(w)})});var _=c._cfg.contentUpgrade;if(_&&c._cfg.version>n){bn(e,r),t._memoizedTables={};var f=Yt(l);p.del.forEach(function(m){f[m]=h[m]}),nt(e,[e.Transaction.prototype]),wn(e,[e.Transaction.prototype],W(f),f),t.schema=f;var d=at(_);d&&Ne();var v,b=S.follow(function(){if(v=_(t),v&&d){var m=ve.bind(null,null);v.then(m,m)}});return v&&typeof v.then=="function"?S.resolve(v):b.then(function(){return v})}}),i.push(function(h){var l=c._cfg.dbschema;wi(l,h),nt(e,[e.Transaction.prototype]),wn(e,[e.Transaction.prototype],e._storeNames,e._dbSchema),t.schema=e._dbSchema}),i.push(function(h){e.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(e.idbdb.version/10)===c._cfg.version?(e.idbdb.deleteObjectStore("$meta"),delete e._dbSchema.$meta,e._storeNames=e._storeNames.filter(function(l){return l!=="$meta"})):h.objectStore("$meta").put(c._cfg.version,"version"))})});function s(){return i.length?S.resolve(i.shift()(t.idbtrans)).then(s):S.resolve()}return s().then(function(){sr(u,r)})}function vt(e,n){var t={del:[],add:[],change:[]},r;for(r in e)n[r]||t.del.push(r);for(r in n){var i=e[r],a=n[r];if(!i)t.add.push([r,a]);else{var u={name:r,def:a,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(a.primKey.keyPath||"")||i.primKey.auto!==a.primKey.auto)u.recreate=!0,t.change.push(u);else{var o=i.idxByName,s=a.idxByName,c=void 0;for(c in o)s[c]||u.del.push(c);for(c in s){var h=o[c],l=s[c];h?h.src!==l.src&&u.change.push(l):u.add.push(l)}(u.del.length>0||u.add.length>0||u.change.length>0)&&t.change.push(u)}}}return t}function pt(e,n,t,r){var i=e.db.createObjectStore(n,t.keyPath?{keyPath:t.keyPath,autoIncrement:t.auto}:{autoIncrement:t.auto});return r.forEach(function(a){return _n(i,a)}),i}function sr(e,n){W(e).forEach(function(t){n.db.objectStoreNames.contains(t)||pt(n,t,e[t].primKey,e[t].indexes)})}function wi(e,n){[].slice.call(n.db.objectStoreNames).forEach(function(t){return e[t]==null&&n.db.deleteObjectStore(t)})}function _n(e,n){e.createIndex(n.name,n.keyPath,{unique:n.unique,multiEntry:n.multi})}function Dn(e,n,t){var r={},i=An(n.objectStoreNames,0);return i.forEach(function(a){for(var u=t.objectStore(a),o=u.keyPath,s=qn(or(o),o||"",!0,!1,!!u.autoIncrement,o&&typeof o!="string",!0),c=[],h=0;h<u.indexNames.length;++h){var l=u.index(u.indexNames[h]);o=l.keyPath;var p=qn(l.name,o,!!l.unique,!!l.multiEntry,!1,o&&typeof o!="string",!1);c.push(p)}r[a]=dt(a,s,c)}),r}function _i(e,n,t){e.verno=n.version/10;var r=e._dbSchema=Dn(e,n,t);e._storeNames=An(n.objectStoreNames,0),wn(e,[e._allTables],W(r),r)}function xi(e,n){var t=Dn(e,e.idbdb,n),r=vt(t,e._dbSchema);return!(r.add.length||r.change.some(function(i){return i.add.length||i.change.length}))}function xn(e,n,t){for(var r=t.db.objectStoreNames,i=0;i<r.length;++i){var a=r[i],u=t.objectStore(a);e._hasGetAll="getAll"in u;for(var o=0;o<u.indexNames.length;++o){var s=u.indexNames[o],c=u.index(s).keyPath,h=typeof c=="string"?c:"["+An(c).join("+")+"]";if(n[a]){var l=n[a].idxByName[h];l&&(l.name=s,delete n[a].idxByName[h],n[a].idxByName[s]=l)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&Y.WorkerGlobalScope&&Y instanceof Y.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function cr(e){return e.split(",").map(function(n,t){n=n.trim();var r=n.replace(/([&*]|\+\+)/g,""),i=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return qn(r,i||null,/\&/.test(n),/\*/.test(n),/\+\+/.test(n),N(i),t===0)})}var Ei=function(){function e(){}return e.prototype._parseStoresSpec=function(n,t){W(n).forEach(function(r){if(n[r]!==null){var i=cr(n[r]),a=i.shift();if(a.unique=!0,a.multi)throw new D.Schema("Primary key cannot be multi-valued");i.forEach(function(u){if(u.auto)throw new D.Schema("Only primary key can be marked as autoIncrement (++)");if(!u.keyPath)throw new D.Schema("Index must have a name and cannot be an empty string")}),t[r]=dt(r,a,i)}})},e.prototype.stores=function(n){var t=this.db;this._cfg.storesSource=this._cfg.storesSource?J(this._cfg.storesSource,n):n;var r=t._versions,i={},a={};return r.forEach(function(u){J(i,u._cfg.storesSource),a=u._cfg.dbschema={},u._parseStoresSpec(i,a)}),t._dbSchema=a,nt(t,[t._allTables,t,t.Transaction.prototype]),wn(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],W(a),a),t._storeNames=W(a),this},e.prototype.upgrade=function(n){return this._cfg.contentUpgrade=st(this._cfg.contentUpgrade||F,n),this},e}();function Ki(e){return Ze(Ei.prototype,function(t){this.db=e,this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}function yt(e,n){var t=e._dbNamesDB;return t||(t=e._dbNamesDB=new Sn(Cn,{addons:[],indexedDB:e,IDBKeyRange:n}),t.version(1).stores({dbnames:"name"})),t.table("dbnames")}function mt(e){return e&&typeof e.databases=="function"}function Si(e){var n=e.indexedDB,t=e.IDBKeyRange;return mt(n)?Promise.resolve(n.databases()).then(function(r){return r.map(function(i){return i.name}).filter(function(i){return i!==Cn})}):yt(n,t).toCollection().primaryKeys()}function ki(e,n){var t=e.indexedDB,r=e.IDBKeyRange;!mt(t)&&n!==Cn&&yt(t,r).put({name:n}).catch(F)}function Ai(e,n){var t=e.indexedDB,r=e.IDBKeyRange;!mt(t)&&n!==Cn&&yt(t,r).delete(n).catch(F)}function tt(e){return de(function(){return A.letThrough=!0,e()})}function Oi(){var e=!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent);if(!e||!indexedDB.databases)return Promise.resolve();var n;return new Promise(function(t){var r=function(){return indexedDB.databases().finally(t)};n=setInterval(r,100),r()}).finally(function(){return clearInterval(n)})}var jn;function gt(e){return!("from"in e)}var $=function(e,n){if(this)J(this,arguments.length?{d:1,from:e,to:arguments.length>1?n:e}:{d:0});else{var t=new $;return e&&"d"in e&&J(t,e),t}};Re($.prototype,(jn={add:function(e){return En(this,e),this},addKey:function(e){return Xe(this,e,e),this},addKeys:function(e){var n=this;return e.forEach(function(t){return Xe(n,t,t)}),this},hasKey:function(e){var n=Kn(this).next(e).value;return n&&M(n.from,e)<=0&&M(n.to,e)>=0}},jn[Un]=function(){return Kn(this)},jn));function Xe(e,n,t){var r=M(n,t);if(!isNaN(r)){if(r>0)throw RangeError();if(gt(e))return J(e,{from:n,to:t,d:1});var i=e.l,a=e.r;if(M(t,e.from)<0)return i?Xe(i,n,t):e.l={from:n,to:t,d:1,l:null,r:null},Rt(e);if(M(n,e.to)>0)return a?Xe(a,n,t):e.r={from:n,to:t,d:1,l:null,r:null},Rt(e);M(n,e.from)<0&&(e.from=n,e.l=null,e.d=a?a.d+1:1),M(t,e.to)>0&&(e.to=t,e.r=null,e.d=e.l?e.l.d+1:1);var u=!e.r;i&&!e.l&&En(e,i),a&&u&&En(e,a)}}function En(e,n){function t(r,i){var a=i.from,u=i.to,o=i.l,s=i.r;Xe(r,a,u),o&&t(r,o),s&&t(r,s)}gt(n)||t(e,n)}function Ci(e,n){var t=Kn(n),r=t.next();if(r.done)return!1;for(var i=r.value,a=Kn(e),u=a.next(i.from),o=u.value;!r.done&&!u.done;){if(M(o.from,i.to)<=0&&M(o.to,i.from)>=0)return!0;M(i.from,o.from)<0?i=(r=t.next(o.from)).value:o=(u=a.next(i.from)).value}return!1}function Kn(e){var n=gt(e)?null:{s:0,n:e};return{next:function(t){for(var r=arguments.length>0;n;)switch(n.s){case 0:if(n.s=1,r)for(;n.n.l&&M(t,n.n.from)<0;)n={up:n,n:n.n.l,s:1};else for(;n.n.l;)n={up:n,n:n.n.l,s:1};case 1:if(n.s=2,!r||M(t,n.n.to)<=0)return{value:n.n,done:!1};case 2:if(n.n.r){n.s=3,n={up:n,n:n.n.r,s:0};continue}case 3:n=n.up}return{done:!0}}}}function Rt(e){var n,t,r=(((n=e.r)===null||n===void 0?void 0:n.d)||0)-(((t=e.l)===null||t===void 0?void 0:t.d)||0),i=r>1?"r":r<-1?"l":"";if(i){var a=i==="r"?"l":"r",u=T({},e),o=e[i];e.from=o.from,e.to=o.to,e[i]=o[i],u[i]=o[a],e[a]=u,u.d=Bt(u)}e.d=Bt(e)}function Bt(e){var n=e.r,t=e.l;return(n?t?Math.max(n.d,t.d):n.d:t?t.d:0)+1}function Pn(e,n){return W(n).forEach(function(t){e[t]?En(e[t],n[t]):e[t]=Ht(n[t])}),e}function bt(e,n){return e.all||n.all||Object.keys(e).some(function(t){return n[t]&&Ci(n[t],e[t])})}var Ee={},Nn={},Ln=!1;function an(e,n){Pn(Nn,e),Ln||(Ln=!0,setTimeout(function(){Ln=!1;var t=Nn;Nn={},wt(t,!1)},0))}function wt(e,n){n===void 0&&(n=!1);var t=new Set;if(e.all)for(var r=0,i=Object.values(Ee);r<i.length;r++){var a=i[r];Mt(a,e,t,n)}else for(var u in e){var o=/^idb\:\/\/(.*)\/(.*)\//.exec(u);if(o){var s=o[1],c=o[2],a=Ee["idb://".concat(s,"/").concat(c)];a&&Mt(a,e,t,n)}}t.forEach(function(h){return h()})}function Mt(e,n,t,r){for(var i=[],a=0,u=Object.entries(e.queries.query);a<u.length;a++){for(var o=u[a],s=o[0],c=o[1],h=[],l=0,p=c;l<p.length;l++){var _=p[l];bt(n,_.obsSet)?_.subscribers.forEach(function(b){return t.add(b)}):r&&h.push(_)}r&&i.push([s,h])}if(r)for(var f=0,d=i;f<d.length;f++){var v=d[f],s=v[0],h=v[1];e.queries.query[s]=h}}function Di(e){var n=e._state,t=e._deps.indexedDB;if(n.isBeingOpened||e.idbdb)return n.dbReadyPromise.then(function(){return n.dbOpenError?V(n.dbOpenError):e});n.isBeingOpened=!0,n.dbOpenError=null,n.openComplete=!1;var r=n.openCanceller,i=Math.round(e.verno*10),a=!1;function u(){if(n.openCanceller!==r)throw new D.DatabaseClosed("db.open() was cancelled")}var o=n.dbReadyResolve,s=null,c=!1,h=function(){return new S(function(l,p){if(u(),!t)throw new D.MissingAPI;var _=e.name,f=n.autoSchema||!i?t.open(_):t.open(_,i);if(!f)throw new D.MissingAPI;f.onerror=te(p),f.onblocked=j(e._fireOnBlocked),f.onupgradeneeded=j(function(d){if(s=f.transaction,n.autoSchema&&!e._options.allowEmptyDB){f.onerror=He,s.abort(),f.result.close();var v=t.deleteDatabase(_);v.onsuccess=v.onerror=j(function(){p(new D.NoSuchDatabase("Database ".concat(_," doesnt exist")))})}else{s.onerror=te(p);var b=d.oldVersion>Math.pow(2,62)?0:d.oldVersion;c=b<1,e.idbdb=f.result,a&&mi(e,s),yi(e,b/10,s,p)}},p),f.onsuccess=j(function(){s=null;var d=e.idbdb=f.result,v=An(d.objectStoreNames);if(v.length>0)try{var b=d.transaction(ci(v),"readonly");if(n.autoSchema)_i(e,d,b);else if(xn(e,e._dbSchema,b),!xi(e,b)&&!a)return d.close(),i=d.version+1,a=!0,l(h());bn(e,b)}catch{}Te.push(e),d.onversionchange=j(function(m){n.vcFired=!0,e.on("versionchange").fire(m)}),d.onclose=j(function(m){e.on("close").fire(m)}),c&&ki(e._deps,_),l()},p)}).catch(function(l){switch(l?.name){case"UnknownError":if(n.PR1398_maxLoop>0)return n.PR1398_maxLoop--,h();break;case"VersionError":if(i>0)return i=0,h();break}return S.reject(l)})};return S.race([r,(typeof navigator>"u"?S.resolve():Oi()).then(h)]).then(function(){return u(),n.onReadyBeingFired=[],S.resolve(tt(function(){return e.on.ready.fire(e.vip)})).then(function l(){if(n.onReadyBeingFired.length>0){var p=n.onReadyBeingFired.reduce(st,F);return n.onReadyBeingFired=[],S.resolve(tt(function(){return p(e.vip)})).then(l)}})}).finally(function(){n.openCanceller===r&&(n.onReadyBeingFired=null,n.isBeingOpened=!1)}).catch(function(l){n.dbOpenError=l;try{s&&s.abort()}catch{}return r===n.openCanceller&&e._close(),V(l)}).finally(function(){n.openComplete=!0,o()}).then(function(){if(c){var l={};e.tables.forEach(function(p){p.schema.indexes.forEach(function(_){_.name&&(l["idb://".concat(e.name,"/").concat(p.name,"/").concat(_.name)]=new $(-1/0,[[[]]]))}),l["idb://".concat(e.name,"/").concat(p.name,"/")]=l["idb://".concat(e.name,"/").concat(p.name,"/:dels")]=new $(-1/0,[[[]]])}),ye(qe).fire(l),wt(l,!0)}return e})}function rt(e){var n=function(u){return e.next(u)},t=function(u){return e.throw(u)},r=a(n),i=a(t);function a(u){return function(o){var s=u(o),c=s.value;return s.done?c:!c||typeof c.then!="function"?N(c)?Promise.all(c).then(r,i):r(c):c.then(r,i)}}return a(n)()}function Pi(e,n,t){var r=arguments.length;if(r<2)throw new D.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];t=i.pop();var a=Ut(i);return[e,a,t]}function lr(e,n,t,r,i){return S.resolve().then(function(){var a=A.transless||A,u=e._createTransaction(n,t,e._dbSchema,r);u.explicit=!0;var o={trans:u,transless:a};if(r)u.idbtrans=r.idbtrans;else try{u.create(),u.idbtrans._explicit=!0,e._state.PR1398_maxLoop=3}catch(l){return l.name===ot.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(e.close({disableAutoOpen:!1}),e.open().then(function(){return lr(e,n,t,null,i)})):V(l)}var s=at(i);s&&Ne();var c,h=S.follow(function(){if(c=i.call(u,u),c)if(s){var l=ve.bind(null,null);c.then(l,l)}else typeof c.next=="function"&&typeof c.throw=="function"&&(c=rt(c))},o);return(c&&typeof c.then=="function"?S.resolve(c).then(function(l){return u.active?l:V(new D.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):h.then(function(){return c})).then(function(l){return r&&u._resolve(),u._completion.then(function(){return l})}).catch(function(l){return u._reject(l),V(l)})})}function un(e,n,t){for(var r=N(e)?e.slice():[e],i=0;i<t;++i)r.push(n);return r}function Ti(e){return T(T({},e),{table:function(n){var t=e.table(n),r=t.schema,i={},a=[];function u(d,v,b){var m=Ye(d),g=i[m]=i[m]||[],w=d==null?0:typeof d=="string"?1:d.length,y=v>0,x=T(T({},b),{name:y?"".concat(m,"(virtual-from:").concat(b.name,")"):b.name,lowLevelIndex:b,isVirtual:y,keyTail:v,keyLength:w,extractKey:et(d),unique:!y&&b.unique});if(g.push(x),x.isPrimaryKey||a.push(x),w>1){var K=w===2?d[0]:d.slice(0,w-1);u(K,v+1,b)}return g.sort(function(E,C){return E.keyTail-C.keyTail}),x}var o=u(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[o];for(var s=0,c=r.indexes;s<c.length;s++){var h=c[s];u(h.keyPath,0,h)}function l(d){var v=i[Ye(d)];return v&&v[0]}function p(d,v){return{type:d.type===1?2:d.type,lower:un(d.lower,d.lowerOpen?e.MAX_KEY:e.MIN_KEY,v),lowerOpen:!0,upper:un(d.upper,d.upperOpen?e.MIN_KEY:e.MAX_KEY,v),upperOpen:!0}}function _(d){var v=d.query.index;return v.isVirtual?T(T({},d),{query:{index:v.lowLevelIndex,range:p(d.query.range,v.keyTail)}}):d}var f=T(T({},t),{schema:T(T({},r),{primaryKey:o,indexes:a,getIndexByKeyPath:l}),count:function(d){return t.count(_(d))},query:function(d){return t.query(_(d))},openCursor:function(d){var v=d.query.index,b=v.keyTail,m=v.isVirtual,g=v.keyLength;if(!m)return t.openCursor(d);function w(y){function x(E){E!=null?y.continue(un(E,d.reverse?e.MAX_KEY:e.MIN_KEY,b)):d.unique?y.continue(y.key.slice(0,g).concat(d.reverse?e.MIN_KEY:e.MAX_KEY,b)):y.continue()}var K=Object.create(y,{continue:{value:x},continuePrimaryKey:{value:function(E,C){y.continuePrimaryKey(un(E,e.MAX_KEY,b),C)}},primaryKey:{get:function(){return y.primaryKey}},key:{get:function(){var E=y.key;return g===1?E[0]:E.slice(0,g)}},value:{get:function(){return y.value}}});return K}return t.openCursor(_(d)).then(function(y){return y&&w(y)})}});return f}})}var Ii={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:Ti};function _t(e,n,t,r){return t=t||{},r=r||"",W(e).forEach(function(i){if(!Q(n,i))t[r+i]=void 0;else{var a=e[i],u=n[i];if(typeof a=="object"&&typeof u=="object"&&a&&u){var o=Yn(a),s=Yn(u);o!==s?t[r+i]=n[i]:o==="Object"?_t(a,u,t,r+i+"."):a!==u&&(t[r+i]=n[i])}else a!==u&&(t[r+i]=n[i])}}),W(n).forEach(function(i){Q(e,i)||(t[r+i]=n[i])}),t}function xt(e,n){return n.type==="delete"?n.keys:n.keys||n.values.map(e.extractKey)}var Ri={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return T(T({},e),{table:function(n){var t=e.table(n),r=t.schema.primaryKey,i=T(T({},t),{mutate:function(a){var u=A.trans,o=u.table(n).hook,s=o.deleting,c=o.creating,h=o.updating;switch(a.type){case"add":if(c.fire===F)break;return u._promise("readwrite",function(){return l(a)},!0);case"put":if(c.fire===F&&h.fire===F)break;return u._promise("readwrite",function(){return l(a)},!0);case"delete":if(s.fire===F)break;return u._promise("readwrite",function(){return l(a)},!0);case"deleteRange":if(s.fire===F)break;return u._promise("readwrite",function(){return p(a)},!0)}return t.mutate(a);function l(f){var d=A.trans,v=f.keys||xt(r,f);if(!v)throw new Error("Keys missing");return f=f.type==="add"||f.type==="put"?T(T({},f),{keys:v}):T({},f),f.type!=="delete"&&(f.values=vn([],f.values)),f.keys&&(f.keys=vn([],f.keys)),Bi(t,f,v).then(function(b){var m=v.map(function(g,w){var y=b[w],x={onerror:null,onsuccess:null};if(f.type==="delete")s.fire.call(x,g,y,d);else if(f.type==="add"||y===void 0){var K=c.fire.call(x,g,f.values[w],d);g==null&&K!=null&&(g=K,f.keys[w]=g,r.outbound||G(f.values[w],r.keyPath,g))}else{var E=_t(y,f.values[w]),C=h.fire.call(x,E,g,y,d);if(C){var R=f.values[w];Object.keys(C).forEach(function(k){Q(R,k)?R[k]=C[k]:G(R,k,C[k])})}}return x});return t.mutate(f).then(function(g){for(var w=g.failures,y=g.results,x=g.numFailures,K=g.lastResult,E=0;E<v.length;++E){var C=y?y[E]:v[E],R=m[E];C==null?R.onerror&&R.onerror(w[E]):R.onsuccess&&R.onsuccess(f.type==="put"&&b[E]?f.values[E]:C)}return{failures:w,results:y,numFailures:x,lastResult:K}}).catch(function(g){return m.forEach(function(w){return w.onerror&&w.onerror(g)}),Promise.reject(g)})})}function p(f){return _(f.trans,f.range,1e4)}function _(f,d,v){return t.query({trans:f,values:!1,query:{index:r,range:d},limit:v}).then(function(b){var m=b.result;return l({type:"delete",keys:m,trans:f}).then(function(g){return g.numFailures>0?Promise.reject(g.failures[0]):m.length<v?{failures:[],numFailures:0,lastResult:void 0}:_(f,T(T({},d),{lower:m[m.length-1],lowerOpen:!0}),v)})})}}});return i}})}};function Bi(e,n,t){return n.type==="add"?Promise.resolve([]):e.getMany({trans:n.trans,keys:t,cache:"immutable"})}function fr(e,n,t){try{if(!n||n.keys.length<e.length)return null;for(var r=[],i=0,a=0;i<n.keys.length&&a<e.length;++i)M(n.keys[i],e[a])===0&&(r.push(t?Ke(n.values[i]):n.values[i]),++a);return r.length===e.length?r:null}catch{return null}}var Mi={stack:"dbcore",level:-1,create:function(e){return{table:function(n){var t=e.table(n);return T(T({},t),{getMany:function(r){if(!r.cache)return t.getMany(r);var i=fr(r.keys,r.trans._cache,r.cache==="clone");return i?S.resolve(i):t.getMany(r).then(function(a){return r.trans._cache={keys:r.keys,values:r.cache==="clone"?Ke(a):a},a})},mutate:function(r){return r.type!=="add"&&(r.trans._cache=null),t.mutate(r)}})}}}};function hr(e,n){return e.trans.mode==="readonly"&&!!e.subscr&&!e.trans.explicit&&e.trans.db._options.cache!=="disabled"&&!n.schema.primaryKey.outbound}function dr(e,n){switch(e){case"query":return n.values&&!n.unique;case"get":return!1;case"getMany":return!1;case"count":return!1;case"openCursor":return!1}}var Fi={stack:"dbcore",level:0,name:"Observability",create:function(e){var n=e.schema.name,t=new $(e.MIN_KEY,e.MAX_KEY);return T(T({},e),{transaction:function(r,i,a){if(A.subscr&&i!=="readonly")throw new D.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(A.querier));return e.transaction(r,i,a)},table:function(r){var i=e.table(r),a=i.schema,u=a.primaryKey,o=a.indexes,s=u.extractKey,c=u.outbound,h=u.autoIncrement&&o.filter(function(f){return f.compound&&f.keyPath.includes(u.keyPath)}),l=T(T({},i),{mutate:function(f){var d,v,b=f.trans,m=f.mutatedParts||(f.mutatedParts={}),g=function(P){var B="idb://".concat(n,"/").concat(r,"/").concat(P);return m[B]||(m[B]=new $)},w=g(""),y=g(":dels"),x=f.type,K=f.type==="deleteRange"?[f.range]:f.type==="delete"?[f.keys]:f.values.length<50?[xt(u,f).filter(function(P){return P}),f.values]:[],E=K[0],C=K[1],R=f.trans._cache;if(N(E)){w.addKeys(E);var k=x==="delete"||E.length===C.length?fr(E,R):null;k||y.addKeys(E),(k||C)&&ji(g,a,k,C)}else if(E){var I={from:(d=E.lower)!==null&&d!==void 0?d:e.MIN_KEY,to:(v=E.upper)!==null&&v!==void 0?v:e.MAX_KEY};y.add(I),w.add(I)}else w.add(t),y.add(t),a.indexes.forEach(function(P){return g(P.name).add(t)});return i.mutate(f).then(function(P){return E&&(f.type==="add"||f.type==="put")&&(w.addKeys(P.results),h&&h.forEach(function(B){for(var O=f.values.map(function(H){return B.extractKey(H)}),L=B.keyPath.findIndex(function(H){return H===u.keyPath}),U=0,ee=P.results.length;U<ee;++U)O[U][L]=P.results[U];g(B.name).addKeys(O)})),b.mutatedParts=Pn(b.mutatedParts||{},m),P})}}),p=function(f){var d,v,b=f.query,m=b.index,g=b.range;return[m,new $((d=g.lower)!==null&&d!==void 0?d:e.MIN_KEY,(v=g.upper)!==null&&v!==void 0?v:e.MAX_KEY)]},_={get:function(f){return[u,new $(f.key)]},getMany:function(f){return[u,new $().addKeys(f.keys)]},count:p,query:p,openCursor:p};return W(_).forEach(function(f){l[f]=function(d){var v=A.subscr,b=!!v,m=hr(A,i)&&dr(f,d),g=m?d.obsSet={}:v;if(b){var w=function(k){var I="idb://".concat(n,"/").concat(r,"/").concat(k);return g[I]||(g[I]=new $)},y=w(""),x=w(":dels"),K=_[f](d),E=K[0],C=K[1];if(f==="query"&&E.isPrimaryKey&&!d.values?x.add(C):w(E.name||"").add(C),!E.isPrimaryKey)if(f==="count")x.add(t);else{var R=f==="query"&&c&&d.values&&i.query(T(T({},d),{values:!1}));return i[f].apply(this,arguments).then(function(k){if(f==="query"){if(c&&d.values)return R.then(function(O){var L=O.result;return y.addKeys(L),k});var I=d.values?k.result.map(s):k.result;d.values?y.addKeys(I):x.addKeys(I)}else if(f==="openCursor"){var P=k,B=d.values;return P&&Object.create(P,{key:{get:function(){return x.addKey(P.primaryKey),P.key}},primaryKey:{get:function(){var O=P.primaryKey;return x.addKey(O),O}},value:{get:function(){return B&&y.addKey(P.primaryKey),P.value}}})}return k})}}return i[f].apply(this,arguments)}}),l}})}};function ji(e,n,t,r){function i(a){var u=e(a.name||"");function o(c){return c!=null?a.extractKey(c):null}var s=function(c){return a.multiEntry&&N(c)?c.forEach(function(h){return u.addKey(h)}):u.addKey(c)};(t||r).forEach(function(c,h){var l=t&&o(t[h]),p=r&&o(r[h]);M(l,p)!==0&&(l!=null&&s(l),p!=null&&s(p))})}n.indexes.forEach(i)}function Ft(e,n,t){if(t.numFailures===0)return n;if(n.type==="deleteRange")return null;var r=n.keys?n.keys.length:"values"in n&&n.values?n.values.length:1;if(t.numFailures===r)return null;var i=T({},n);return N(i.keys)&&(i.keys=i.keys.filter(function(a,u){return!(u in t.failures)})),"values"in i&&N(i.values)&&(i.values=i.values.filter(function(a,u){return!(u in t.failures)})),i}function Ni(e,n){return n.lower===void 0?!0:n.lowerOpen?M(e,n.lower)>0:M(e,n.lower)>=0}function Li(e,n){return n.upper===void 0?!0:n.upperOpen?M(e,n.upper)<0:M(e,n.upper)<=0}function Vn(e,n){return Ni(e,n)&&Li(e,n)}function jt(e,n,t,r,i,a){if(!t||t.length===0)return e;var u=n.query.index,o=u.multiEntry,s=n.query.range,c=r.schema.primaryKey,h=c.extractKey,l=u.extractKey,p=(u.lowLevelIndex||u).extractKey,_=t.reduce(function(f,d){var v=f,b=[];if(d.type==="add"||d.type==="put")for(var m=new $,g=d.values.length-1;g>=0;--g){var w=d.values[g],y=h(w);if(!m.hasKey(y)){var x=l(w);(o&&N(x)?x.some(function(k){return Vn(k,s)}):Vn(x,s))&&(m.addKey(y),b.push(w))}}switch(d.type){case"add":{var K=new $().addKeys(n.values?f.map(function(k){return h(k)}):f);v=f.concat(n.values?b.filter(function(k){var I=h(k);return K.hasKey(I)?!1:(K.addKey(I),!0)}):b.map(function(k){return h(k)}).filter(function(k){return K.hasKey(k)?!1:(K.addKey(k),!0)}));break}case"put":{var E=new $().addKeys(d.values.map(function(k){return h(k)}));v=f.filter(function(k){return!E.hasKey(n.values?h(k):k)}).concat(n.values?b:b.map(function(k){return h(k)}));break}case"delete":var C=new $().addKeys(d.keys);v=f.filter(function(k){return!C.hasKey(n.values?h(k):k)});break;case"deleteRange":var R=d.range;v=f.filter(function(k){return!Vn(h(k),R)});break}return v},e);return _===e?e:(_.sort(function(f,d){return M(p(f),p(d))||M(h(f),h(d))}),n.limit&&n.limit<1/0&&(_.length>n.limit?_.length=n.limit:e.length===n.limit&&_.length<n.limit&&(i.dirty=!0)),a?Object.freeze(_):_)}function Nt(e,n){return M(e.lower,n.lower)===0&&M(e.upper,n.upper)===0&&!!e.lowerOpen==!!n.lowerOpen&&!!e.upperOpen==!!n.upperOpen}function Vi(e,n,t,r){if(e===void 0)return n!==void 0?-1:0;if(n===void 0)return 1;var i=M(e,n);if(i===0){if(t&&r)return 0;if(t)return 1;if(r)return-1}return i}function zi(e,n,t,r){if(e===void 0)return n!==void 0?1:0;if(n===void 0)return-1;var i=M(e,n);if(i===0){if(t&&r)return 0;if(t)return-1;if(r)return 1}return i}function Wi(e,n){return Vi(e.lower,n.lower,e.lowerOpen,n.lowerOpen)<=0&&zi(e.upper,n.upper,e.upperOpen,n.upperOpen)>=0}function Yi(e,n,t,r){var i=Ee["idb://".concat(e,"/").concat(n)];if(!i)return[];var a=i.queries[t];if(!a)return[null,!1,i,null];var u=r.query?r.query.index.name:null,o=a[u||""];if(!o)return[null,!1,i,null];switch(t){case"query":var s=o.find(function(l){return l.req.limit===r.limit&&l.req.values===r.values&&Nt(l.req.query.range,r.query.range)});if(s)return[s,!0,i,o];var c=o.find(function(l){var p="limit"in l.req?l.req.limit:1/0;return p>=r.limit&&(r.values?l.req.values:!0)&&Wi(l.req.query.range,r.query.range)});return[c,!1,i,o];case"count":var h=o.find(function(l){return Nt(l.req.query.range,r.query.range)});return[h,!!h,i,o]}}function Ui(e,n,t,r){e.subscribers.add(t),r.addEventListener("abort",function(){e.subscribers.delete(t),e.subscribers.size===0&&$i(e,n)})}function $i(e,n){setTimeout(function(){e.subscribers.size===0&&me(n,e)},3e3)}var Hi={stack:"dbcore",level:0,name:"Cache",create:function(e){var n=e.schema.name,t=T(T({},e),{transaction:function(r,i,a){var u=e.transaction(r,i,a);if(i==="readwrite"){var o=new AbortController,s=o.signal,c=function(h){return function(){if(o.abort(),i==="readwrite"){for(var l=new Set,p=0,_=r;p<_.length;p++){var f=_[p],d=Ee["idb://".concat(n,"/").concat(f)];if(d){var v=e.table(f),b=d.optimisticOps.filter(function(B){return B.trans===u});if(u._explicit&&h&&u.mutatedParts)for(var m=0,g=Object.values(d.queries.query);m<g.length;m++)for(var w=g[m],y=0,x=w.slice();y<x.length;y++){var K=x[y];bt(K.obsSet,u.mutatedParts)&&(me(w,K),K.subscribers.forEach(function(B){return l.add(B)}))}else if(b.length>0){d.optimisticOps=d.optimisticOps.filter(function(B){return B.trans!==u});for(var E=0,C=Object.values(d.queries.query);E<C.length;E++)for(var w=C[E],R=0,k=w.slice();R<k.length;R++){var K=k[R];if(K.res!=null&&u.mutatedParts)if(h&&!K.dirty){var I=Object.isFrozen(K.res),P=jt(K.res,K.req,b,v,K,I);K.dirty?(me(w,K),K.subscribers.forEach(function(L){return l.add(L)})):P!==K.res&&(K.res=P,K.promise=S.resolve({result:P}))}else K.dirty&&me(w,K),K.subscribers.forEach(function(L){return l.add(L)})}}}}l.forEach(function(B){return B()})}}};u.addEventListener("abort",c(!1),{signal:s}),u.addEventListener("error",c(!1),{signal:s}),u.addEventListener("complete",c(!0),{signal:s})}return u},table:function(r){var i=e.table(r),a=i.schema.primaryKey,u=T(T({},i),{mutate:function(o){var s=A.trans;if(a.outbound||s.db._options.cache==="disabled"||s.explicit||s.idbtrans.mode!=="readwrite")return i.mutate(o);var c=Ee["idb://".concat(n,"/").concat(r)];if(!c)return i.mutate(o);var h=i.mutate(o);return(o.type==="add"||o.type==="put")&&(o.values.length>=50||xt(a,o).some(function(l){return l==null}))?h.then(function(l){var p=T(T({},o),{values:o.values.map(function(f,d){var v;if(l.failures[d])return f;var b=!((v=a.keyPath)===null||v===void 0)&&v.includes(".")?Ke(f):T({},f);return G(b,a.keyPath,l.results[d]),b})}),_=Ft(c,p,l);c.optimisticOps.push(_),queueMicrotask(function(){return o.mutatedParts&&an(o.mutatedParts)})}):(c.optimisticOps.push(o),o.mutatedParts&&an(o.mutatedParts),h.then(function(l){if(l.numFailures>0){me(c.optimisticOps,o);var p=Ft(c,o,l);p&&c.optimisticOps.push(p),o.mutatedParts&&an(o.mutatedParts)}}),h.catch(function(){me(c.optimisticOps,o),o.mutatedParts&&an(o.mutatedParts)})),h},query:function(o){var s;if(!hr(A,i)||!dr("query",o))return i.query(o);var c=((s=A.trans)===null||s===void 0?void 0:s.db._options.cache)==="immutable",h=A,l=h.requery,p=h.signal,_=Yi(n,r,"query",o),f=_[0],d=_[1],v=_[2],b=_[3];if(f&&d)f.obsSet=o.obsSet;else{var m=i.query(o).then(function(g){var w=g.result;if(f&&(f.res=w),c){for(var y=0,x=w.length;y<x;++y)Object.freeze(w[y]);Object.freeze(w)}else g.result=Ke(w);return g}).catch(function(g){return b&&f&&me(b,f),Promise.reject(g)});f={obsSet:o.obsSet,promise:m,subscribers:new Set,type:"query",req:o,dirty:!1},b?b.push(f):(b=[f],v||(v=Ee["idb://".concat(n,"/").concat(r)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}}),v.queries.query[o.query.index.name||""]=b)}return Ui(f,b,l,p),f.promise.then(function(g){return{result:jt(g.result,o,v?.optimisticOps,i,f,c)}})}});return u}});return t}};function on(e,n){return new Proxy(e,{get:function(t,r,i){return r==="db"?n:Reflect.get(t,r,i)}})}var Sn=function(){function e(n,t){var r=this;this._middlewares={},this.verno=0;var i=e.dependencies;this._options=t=T({addons:e.addons,autoOpen:!0,indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange,cache:"cloned"},t),this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange};var a=t.addons;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var u={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:F,dbReadyPromise:null,cancelOpen:F,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:t.autoOpen};u.dbReadyPromise=new S(function(s){u.dbReadyResolve=s}),u.openCanceller=new S(function(s,c){u.cancelOpen=c}),this._state=u,this.name=n,this.on=Je(this,"populate","blocked","versionchange","close",{ready:[st,F]}),this.on.ready.subscribe=zt(this.on.ready.subscribe,function(s){return function(c,h){e.vip(function(){var l=r._state;if(l.openComplete)l.dbOpenError||S.resolve().then(c),h&&s(c);else if(l.onReadyBeingFired)l.onReadyBeingFired.push(c),h&&s(c);else{s(c);var p=r;h||s(function _(){p.on.ready.unsubscribe(c),p.on.ready.unsubscribe(_)})}})}}),this.Collection=ei(this),this.Table=Gr(this),this.Transaction=si(this),this.Version=Ki(this),this.WhereClause=ui(this),this.on("versionchange",function(s){s.newVersion>0,r.close({disableAutoOpen:!1})}),this.on("blocked",function(s){!s.newVersion||s.newVersion<s.oldVersion}),this._maxKey=Qe(t.IDBKeyRange),this._createTransaction=function(s,c,h,l){return new r.Transaction(s,c,h,r._options.chromeTransactionDurability,l)},this._fireOnBlocked=function(s){r.on("blocked").fire(s),Te.filter(function(c){return c.name===r.name&&c!==r&&!c._state.vcFired}).map(function(c){return c.on("versionchange").fire(s)})},this.use(Mi),this.use(Hi),this.use(Fi),this.use(Ii),this.use(Ri);var o=new Proxy(this,{get:function(s,c,h){if(c==="_vip")return!0;if(c==="table")return function(p){return on(r.table(p),o)};var l=Reflect.get(s,c,h);return l instanceof ir?on(l,o):c==="tables"?l.map(function(p){return on(p,o)}):c==="_createTransaction"?function(){var p=l.apply(this,arguments);return on(p,o)}:l}});this.vip=o,a.forEach(function(s){return s(r)})}return e.prototype.version=function(n){if(isNaN(n)||n<.1)throw new D.Type("Given version is not a positive number");if(n=Math.round(n*10)/10,this.idbdb||this._state.isBeingOpened)throw new D.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,n);var t=this._versions,r=t.filter(function(i){return i._cfg.version===n})[0];return r||(r=new this.Version(n),t.push(r),t.sort(pi),r.stores({}),this._state.autoSchema=!1,r)},e.prototype._whenReady=function(n){var t=this;return this.idbdb&&(this._state.openComplete||A.letThrough||this._vip)?n():new S(function(r,i){if(t._state.openComplete)return i(new D.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._state.autoOpen){i(new D.DatabaseClosed);return}t.open().catch(F)}t._state.dbReadyPromise.then(r,i)}).then(n)},e.prototype.use=function(n){var t=n.stack,r=n.create,i=n.level,a=n.name;a&&this.unuse({stack:t,name:a});var u=this._middlewares[t]||(this._middlewares[t]=[]);return u.push({stack:t,create:r,level:i??10,name:a}),u.sort(function(o,s){return o.level-s.level}),this},e.prototype.unuse=function(n){var t=n.stack,r=n.name,i=n.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(function(a){return i?a.create!==i:r?a.name!==r:!1})),this},e.prototype.open=function(){var n=this;return ke(fe,function(){return Di(n)})},e.prototype._close=function(){var n=this._state,t=Te.indexOf(this);if(t>=0&&Te.splice(t,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}n.isBeingOpened||(n.dbReadyPromise=new S(function(r){n.dbReadyResolve=r}),n.openCanceller=new S(function(r,i){n.cancelOpen=i}))},e.prototype.close=function(n){var t=n===void 0?{disableAutoOpen:!0}:n,r=t.disableAutoOpen,i=this._state;r?(i.isBeingOpened&&i.cancelOpen(new D.DatabaseClosed),this._close(),i.autoOpen=!1,i.dbOpenError=new D.DatabaseClosed):(this._close(),i.autoOpen=this._options.autoOpen||i.isBeingOpened,i.openComplete=!1,i.dbOpenError=null)},e.prototype.delete=function(n){var t=this;n===void 0&&(n={disableAutoOpen:!0});var r=arguments.length>0&&typeof arguments[0]!="object",i=this._state;return new S(function(a,u){var o=function(){t.close(n);var s=t._deps.indexedDB.deleteDatabase(t.name);s.onsuccess=j(function(){Ai(t._deps,t.name),a()}),s.onerror=te(u),s.onblocked=t._fireOnBlocked};if(r)throw new D.InvalidArgument("Invalid closeOptions argument to db.delete()");i.isBeingOpened?i.dbReadyPromise.then(o):o()})},e.prototype.backendDB=function(){return this.idbdb},e.prototype.isOpen=function(){return this.idbdb!==null},e.prototype.hasBeenClosed=function(){var n=this._state.dbOpenError;return n&&n.name==="DatabaseClosed"},e.prototype.hasFailed=function(){return this._state.dbOpenError!==null},e.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(e.prototype,"tables",{get:function(){var n=this;return W(this._allTables).map(function(t){return n._allTables[t]})},enumerable:!1,configurable:!0}),e.prototype.transaction=function(){var n=Pi.apply(this,arguments);return this._transaction.apply(this,n)},e.prototype._transaction=function(n,t,r){var i=this,a=A.trans;(!a||a.db!==this||n.indexOf("!")!==-1)&&(a=null);var u=n.indexOf("?")!==-1;n=n.replace("!","").replace("?","");var o,s;try{if(s=t.map(function(h){var l=h instanceof i.Table?h.name:h;if(typeof l!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return l}),n=="r"||n===In)o=In;else if(n=="rw"||n==Rn)o=Rn;else throw new D.InvalidArgument("Invalid transaction mode: "+n);if(a){if(a.mode===In&&o===Rn)if(u)a=null;else throw new D.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");a&&s.forEach(function(h){if(a&&a.storeNames.indexOf(h)===-1)if(u)a=null;else throw new D.SubTransaction("Table "+h+" not included in parent transaction.")}),u&&a&&!a.active&&(a=null)}}catch(h){return a?a._promise(null,function(l,p){p(h)}):V(h)}var c=lr.bind(null,this,o,s,a,r);return a?a._promise(o,c,"lock"):A.trans?ke(A.transless,function(){return i._whenReady(c)}):this._whenReady(c)},e.prototype.table=function(n){if(!Q(this._allTables,n))throw new D.InvalidTable("Table ".concat(n," does not exist"));return this._allTables[n]},e}(),Qi=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Xi=function(){function e(n){this._subscribe=n}return e.prototype.subscribe=function(n,t,r){return this._subscribe(!n||typeof n=="function"?{next:n,error:t,complete:r}:n)},e.prototype[Qi]=function(){return this},e}(),kn;try{kn={indexedDB:Y.indexedDB||Y.mozIndexedDB||Y.webkitIndexedDB||Y.msIndexedDB,IDBKeyRange:Y.IDBKeyRange||Y.webkitIDBKeyRange}}catch{kn={indexedDB:null,IDBKeyRange:null}}function Gi(e){var n=!1,t,r=new Xi(function(i){var a=at(e);function u(b){var m=Fe();try{a&&Ne();var g=de(e,b);return a&&(g=g.finally(ve)),g}finally{m&&je()}}var o=!1,s,c={},h={},l={get closed(){return o},unsubscribe:function(){o||(o=!0,s&&s.abort(),p&&ye.storagemutated.unsubscribe(d))}};i.start&&i.start(l);var p=!1,_=function(){return Tn(v)};function f(){return bt(h,c)}var d=function(b){Pn(c,b),f()&&_()},v=function(){if(!(o||!kn.indexedDB)){c={};var b={};s&&s.abort(),s=new AbortController;var m={subscr:b,signal:s.signal,requery:_,querier:e,trans:null},g=u(m);Promise.resolve(g).then(function(w){n=!0,t=w,!(o||m.signal.aborted)&&(c={},h=b,!Er(h)&&!p&&(ye(qe,d),p=!0),Tn(function(){return!o&&i.next&&i.next(w)}))},function(w){n=!1,["DatabaseClosedError","AbortError"].includes(w?.name)||o||Tn(function(){o||i.error&&i.error(w)})})}};return setTimeout(_,0),l});return r.hasValue=function(){return n},r.getValue=function(){return t},r}var be=Sn;Re(be,T(T({},On),{delete:function(e){var n=new be(e,{addons:[]});return n.delete()},exists:function(e){return new be(e,{addons:[]}).open().then(function(n){return n.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{return Si(be.dependencies).then(e)}catch{return V(new D.MissingAPI)}},defineClass:function(){function e(n){J(this,n)}return e},ignoreTransaction:function(e){return A.trans?ke(A.transless,e):e()},vip:tt,async:function(e){return function(){try{var n=rt(e.apply(this,arguments));return!n||typeof n.then!="function"?S.resolve(n):n}catch(t){return V(t)}}},spawn:function(e,n,t){try{var r=rt(e.apply(t,n||[]));return!r||typeof r.then!="function"?S.resolve(r):r}catch(i){return V(i)}},currentTransaction:{get:function(){return A.trans||null}},waitFor:function(e,n){var t=S.resolve(typeof e=="function"?be.ignoreTransaction(e):e).timeout(n||6e4);return A.trans?A.trans.waitFor(t):t},Promise:S,debug:{get:function(){return re},set:function(e){Gt(e)}},derive:Be,extend:J,props:Re,override:zt,Events:Je,on:ye,liveQuery:Gi,extendObservabilitySet:Pn,getByKeyPath:ue,setByKeyPath:G,delByKeyPath:wr,shallowClone:Yt,deepClone:Ke,getObjectDiff:_t,cmp:M,asap:Wt,minKey:Jn,addons:[],connections:Te,errnames:ot,dependencies:kn,cache:Ee,semVer:Ot,version:Ot.split(".").map(function(e){return parseInt(e)}).reduce(function(e,n,t){return e+n/Math.pow(10,t*2)})}));be.maxKey=Qe(be.dependencies.IDBKeyRange);typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(ye(qe,function(e){if(!le){var n;n=new CustomEvent(Zn,{detail:e}),le=!0,dispatchEvent(n),le=!1}}),addEventListener(Zn,function(e){var n=e.detail;le||Et(n)}));function Et(e){var n=le;try{le=!0,ye.storagemutated.fire(e),wt(e,!0)}finally{le=n}}var le=!1,ce,it=function(){};typeof BroadcastChannel<"u"&&(it=function(){ce=new BroadcastChannel(Zn),ce.onmessage=function(e){return e.data&&Et(e.data)}},it(),typeof ce.unref=="function"&&ce.unref(),ye(qe,function(e){le||ce.postMessage(e)}));typeof addEventListener<"u"&&(addEventListener("pagehide",function(e){if(!Sn.disableBfCache&&e.persisted){ce?.close();for(var n=0,t=Te;n<t.length;n++){var r=t[n];r.close({disableAutoOpen:!1})}}}),addEventListener("pageshow",function(e){!Sn.disableBfCache&&e.persisted&&(it(),Et({all:new $(-1/0,[[]])}))}));S.rejectionMapper=Cr;Gt(re);export{Sn as D};
