import{d as h,q as M,r as f,o as I,a as E,b as L,e as R,k as t,j as v,ag as w,a2 as B}from"./@vue-exp-CzdoyapG.js";import{i as D,j as O,u as U,g as C,c as _,k as j}from"./index-DylLUN-r.js";import{W as o,t as H,w as V}from"./xframelib-exp-uSJ3EBow.js";import{b as $}from"./vue-router-exp-B23Vo4Jw.js";import{cE as q,cD as F}from"./vendor-CSzZZ-de.js";import{S as K}from"./SystemsEvent-DUQCZw_Q.js";import"./monaco-editor-exp-BNK_u0iZ.js";import"./quasar-exp-B7YDMHDE.js";import"./xgis-cesium-exp-Cbv1lISI.js";import"./lottie-web-exp-CIY4INm7.js";import"./axios-exp-C7rfqWEd.js";import"./@iconify/vue-exp-BLEeEXwl.js";const N={class:"container",style:{height:"500px"}},T={class:"login"},W={class:"login-center clearfix"},z={class:"login-center-input"},A={class:"login-center clearfix"},G={class:"login-center-input"},y="loginIFrame",ae=h({name:"loginIFrame",__name:"loginModal",props:{data:q([Object]).def({}),extra:F().isRequired},setup(J){const x=$(),s=M({username:"",password:""}),a=f(),l=f();function d(){a.value&&(a.value.placeholder="请输入账号"),l.value&&(l.value.placeholder="请输入密码")}let r=!0;const m=async()=>{if(!r){o.Logger().debug("频繁点击登录******");return}if(r=!1,s.username.trim()===""||s.password.trim()=="")return setTimeout(()=>{r=!0},2e3),o.Message?.warn("用户名或密码不能为空！");let i={username:s.username.trim(),pwd:s.password.trim()};const e=await H(i).catch(n=>{o.Message?.warn(`登录失败:${n.message}!`),r=!0});e&&await k(e)};async function k(i){const e=U();e.init(i),o.User=e.id;const n=C(),S=e.DefaultMaxRoleLevel===0;let g=!0;const c=await V(n,S).catch(u=>{g=!1,o.Message?.err("该系统未注册！")});if(r=!0,!!g){if(o.Logger().debug(c,"登录后的系统权限"),c){const u=_();o.Logger().debug(u,"系统路由权限"),u?.forEach(b=>{x.addRoute(b)})}else{o.Message?.warn(s.username+"无系统权限，无法登录！");return}j(K.UserLoginSuccess,void 0)}}function p(i){}return I(()=>{D(y,p)}),E(()=>{O(y,p)}),(i,e)=>(L(),R("div",N,[t("div",T,[e[8]||(e[8]=t("div",{class:"login-top"},"用户登录",-1)),t("div",W,[e[5]||(e[5]=t("div",{class:"login-center-img"},[t("img",{src:"img/login/name.png"})],-1)),t("div",z,[v(t("input",{ref_key:"nameInput",ref:a,"onUpdate:modelValue":e[0]||(e[0]=n=>s.username=n),type:"text",placeholder:"请输入账号",onfocus:"this.placeholder=''",onBlur:e[1]||(e[1]=n=>d())},null,544),[[w,s.username]]),e[4]||(e[4]=t("div",{class:"login-center-input-text"},"账号",-1))])]),t("div",A,[e[7]||(e[7]=t("div",{class:"login-center-img"},[t("img",{src:"img/login/password.png"})],-1)),t("div",G,[v(t("input",{ref_key:"pwdInput",ref:l,"onUpdate:modelValue":e[2]||(e[2]=n=>s.password=n),type:"password",placeholder:"请输入密码",onfocus:"this.placeholder=''",onBlur:e[3]||(e[3]=n=>d()),onKeyup:B(m,["enter"])},null,544),[[w,s.password]]),e[6]||(e[6]=t("div",{class:"login-center-input-text"},"密码",-1))])]),t("div",{class:"login-button",onClick:m},"登录")])]))}});export{ae as default};
