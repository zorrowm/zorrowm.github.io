import{u as se,d as ce,V as me,a0 as S,F as O,q as fe,e as d,O as pe,i as Y,j as B,k,a1 as ge,M as ve,a2 as I,c as T,h as be,G as F,m as we,a3 as _e,L as ye,a4 as ke,A as Fe,T as Be,aa as H}from"./quasar-exp-BsaNoQ7w.js";import{B as Ce}from"./BaseContent-Bj_GXZNN.js";import{B as G,p as De}from"./xframelib-exp-CMLeiWD4.js";import{b as xe,_ as Ee}from"./index-BQ7ovaqR.js";import{B as he}from"./BtnDel-DMuq8vVt.js";import{D as g}from"./DBService-CSAZW8Q8.js";import{d as Qe,c as J,r as u,w as Ue,b as s,f as b,a4 as a,j as l,l as r,k as m,v as h,e as Q,F as Ae,ab as Pe,ac as c,a7 as K,a1 as Ve}from"./@vue-exp-Bws36Ke9.js";import"./vue-router-exp-CO9L2VdX.js";import"./axios-exp-C7rfqWEd.js";import"./vendor-DJm_4oaR.js";import"./lottie-web-exp-CIY4INm7.js";import"./monaco-editor-exp-BNK_u0iZ.js";import"./@iconify/vue-exp-Q9Q0SWJB.js";import"./xgis-cesium-exp-Hv7oMXHX.js";const qe=Qe({name:"DBTable",__name:"DBTable",setup(W,{expose:o}){o();const U=se(),e=xe(),M=J(()=>e.showTabMenu?"padding-bottom: 30px;":""),C=u(null),n=u(null),i=u({sortBy:"id",descending:!1,page:1,rowsPerPage:10}),w=u(1);let f;const A=u(0),X=J(()=>Math.ceil(A.value/i.value.rowsPerPage)),Z=u(""),j=u([]),L=u([{name:"id",align:"center",label:"索引",field:"id",sortable:!0},{name:"name",align:"center",label:"姓名",field:"name"},{name:"age",align:"center",label:"年龄",field:"age",sortable:!0},{name:"picture",required:!0,label:"照片",align:"center",field:"picture"},{name:"profile",required:!0,label:"档案",align:"center",field:"pid"},{name:"modifytime",required:!0,label:"更新时间",align:"center",field:"lastModified",format:t=>t?ce.formatDate(t,"YYYY-MM-DD HH:mm:ss"):"无",sortable:!0},{name:"opt",align:"center",label:"操作",field:"opt"}]),P=u([]);Ue(()=>w.value,t=>{_()});function _(){g.getPageList(void 0,w.value,i.value.rowsPerPage).then(t=>{P.value=t})}function z(){g.getCount().then(t=>{A.value=t}),g.getPageList(void 0,w.value,i.value.rowsPerPage).then(t=>{P.value=t})}z();const N=u([]),D=u("新建"),v=u({}),y=u(void 0);L.value.forEach(({name:t})=>{N.value.push(t)});function $(){const t=`确认删除这 ${j.value.length} 条记录吗？`;U.dialog({title:"批量删除",message:t,cancel:!0,persistent:!0}).onOk(()=>{}).onOk(()=>{}).onCancel(()=>{}).onDismiss(()=>{})}function ee(){D.value="新建",v.value={name:"",age:10},y.value&&y.value.show()}function le(t){g.deleteItem(t.id).then(p=>{_(),G.Message.info("删除成功")})}function oe(t){D.value="编辑",v.value={...t},y.value&&y.value.show()}function ae(t){}async function te(){D.value==="新建"?g.addItem(v.value).then(t=>{t&&f&&g.saveProfile(t,f[0]).then(()=>{f=void 0}),_()}):g.updateItem(v.value.id,v.value).then(()=>{f?g.saveProfile(v.value.id,f).then(()=>{f=void 0,_()}):_()}),y.value.hide(),G.Message.info("提交更改成功！")}function ne(){n.value?.pickFiles()}function ie(t){const p=t[0],x=new FileReader;x.onload=function(E){v.value.picture=E.target.result},x.readAsDataURL(p)}function re(t){const p=t[0],x=p.name,E=new FileReader;E.onload=function(V){let q=null;typeof V.target.result=="object"?q=new Blob([V.target.result]):q=V.target.result,f={name:x,content:q}},E.readAsArrayBuffer(p)}function ue(){C.value&&C.value.pickFiles()}async function de(t){const p=await g.getProfile(t);p&&De(p.file,p.name)}const R={$q:U,appState:e,sizeStyle:M,profileUploader:C,imgUploader:n,pagination:i,currentPage:w,get uploadFiles(){return f},set uploadFiles(t){f=t},rowSum:A,pagesNumber:X,filter:Z,selected:j,columns:L,rows:P,query:_,init:z,group:N,editType:D,form:v,dialogRef:y,showConfirm:$,add:ee,del:le,edit:oe,design:ae,submit:te,doImageUpload:ne,pictureUpload:ie,fileUpload:re,doUpload:ue,doDowload:de,BaseContent:Ce,BtnDel:he};return Object.defineProperty(R,"__isScriptSetup",{enumerable:!1,value:!0}),R}}),Se={class:"row no-wrap full-width"},Ie={class:"q-gutter-xs"},Te=["src"],Me={key:1},je={key:1},Le={class:"full-width row justify-center"},ze={class:"view_title justify-between q-px-md"},Ne={class:"row q-col-gutter-x-md dialog_form q-pa-md"},Re={class:"col-6"},Oe={class:"col-6"},Ye={class:"col-12"},He={class:"col-12"},Ge={class:"row justify-center q-pa-md"};function Je(W,o,U,e,M,C){return s(),b(e.BaseContent,{class:"q-pa-sm",style:Ve(e.sizeStyle)},{default:a(()=>[l(me,{class:"fit sticky-header-table",selection:"multiple",selected:e.selected,"onUpdate:selected":o[4]||(o[4]=n=>e.selected=n),dense:e.$q.screen.lt.md,separator:"cell",flat:"",bordered:"",rows:e.rows,filter:e.filter,columns:e.columns,"row-key":"name","visible-columns":e.group,pagination:e.pagination,"onUpdate:pagination":o[5]||(o[5]=n=>e.pagination=n)},{top:a(n=>[r("div",Se,[l(S,{clearable:"",outlined:"",dense:"",placeholder:"请输入关键字搜索",class:"on-left",debounce:"300",modelValue:e.filter,"onUpdate:modelValue":o[0]||(o[0]=i=>e.filter=i)},{append:a(()=>[l(O,{name:"search"})]),_:1},8,["modelValue"]),l(fe),r("div",Ie,[l(d,{icon:"add","no-wrap":"",color:"primary",label:"新建",onClick:e.add}),m(l(d,{disable:e.selected.length===0,"no-wrap":"",color:"negative",label:"批量删除",onClick:o[1]||(o[1]=i=>e.showConfirm()),icon:"delete_outline"},null,8,["disable"]),[[h,e.$q.screen.gt.sm]]),m(l(d,{color:"primary",label:"切换全屏","no-wrap":"",onClick:n.toggleFullscreen,icon:n.inFullscreen?"fullscreen_exit":"fullscreen"},null,8,["onClick","icon"]),[[h,e.$q.screen.gt.sm]]),m(l(pe,{color:"primary",label:"自选列",icon:"view_list","no-wrap":""},{default:a(()=>[l(Y,null,{default:a(()=>[(s(!0),Q(Ae,null,Pe(e.columns,i=>(s(),b(B,{tag:"label",key:i.name},{default:a(()=>[l(k,{avatar:""},{default:a(()=>[l(ge,{modelValue:e.group,"onUpdate:modelValue":o[2]||(o[2]=w=>e.group=w),val:i.name},null,8,["modelValue","val"])]),_:2},1024),l(k,null,{default:a(()=>[l(ve,null,{default:a(()=>[c(K(i.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},512),[[h,e.$q.screen.gt.sm]])])])]),"body-cell-picture":a(n=>[l(I,{props:n},{default:a(()=>[n.row.picture?(s(),Q("img",{key:0,src:n.row.picture,width:"80",height:"80"},null,8,Te)):(s(),Q("span",Me,"暂无"))]),_:2},1032,["props"])]),"body-cell-profile":a(n=>[l(I,{props:n},{default:a(()=>[n.row.pid?(s(),b(d,{key:0,label:"下载档案",color:"primary",onClick:i=>e.doDowload(n.row.pid)},null,8,["onClick"])):(s(),Q("span",je,"暂无"))]),_:2},1032,["props"])]),"body-cell-opt":a(n=>[l(I,{props:n,"auto-width":!0},{default:a(()=>[l(d,{flat:"",round:"",dense:"",color:"primary",icon:"edit",onClick:i=>e.edit(n.row)},{default:a(()=>[l(T,null,{default:a(()=>o[8]||(o[8]=[c("编辑")])),_:1})]),_:2},1032,["onClick"]),l(d,{flat:"",round:"",dense:"",color:"primary",icon:"mdi-image-edit-outline",onClick:i=>e.design(n.row)},{default:a(()=>[l(T,null,{default:a(()=>o[9]||(o[9]=[c("视图设计")])),_:1})]),_:2},1032,["onClick"]),l(e.BtnDel,{label:"视图",onConfirm:i=>e.del(n.row)},null,8,["onConfirm"]),l(d,{flat:"",round:"",dense:"",color:"primary",icon:"mdi-more"},{default:a(()=>[l(T,null,{default:a(()=>o[10]||(o[10]=[c("更多")])),_:1}),l(be,null,{default:a(()=>[l(Y,{style:{"min-width":"100px"}},{default:a(()=>[m((s(),b(B,{clickable:""},{default:a(()=>[l(k,null,{default:a(()=>o[11]||(o[11]=[c("发布服务")])),_:1})]),_:1})),[[F]]),m((s(),b(B,{clickable:""},{default:a(()=>[l(k,null,{default:a(()=>o[12]||(o[12]=[c("新建索引")])),_:1})]),_:1})),[[F]]),l(we),m((s(),b(B,{clickable:""},{default:a(()=>[l(k,null,{default:a(()=>o[13]||(o[13]=[c("清理缓存")])),_:1})]),_:1})),[[F]]),m((s(),b(B,{clickable:""},{default:a(()=>[l(k,null,{default:a(()=>o[14]||(o[14]=[c("新增数据")])),_:1})]),_:1})),[[F]])]),_:1})]),_:1})]),_:1})]),_:2},1032,["props"])]),bottom:a(()=>[r("div",Le,[l(_e,{modelValue:e.currentPage,"onUpdate:modelValue":o[3]||(o[3]=n=>e.currentPage=n),max:e.pagesNumber},null,8,["modelValue","max"])])]),_:1},8,["selected","dense","rows","filter","columns","visible-columns","pagination"]),l(ye,{maximized:"",flat:"",persistent:"",ref:"dialogRef"},{default:a(()=>[l(ke,{onSubmit:e.submit,class:"dialog_card column"},{default:a(()=>[r("h5",ze,[c(K(e.editType)+"视图 ",1),m(l(d,{dense:"",outline:"",round:"",icon:"clear",size:"sm"},null,512),[[F]])]),l(Fe,{class:"col"},{default:a(()=>[r("div",Ne,[r("div",Re,[r("h5",null,[l(O,{name:"star",color:"red"}),o[15]||(o[15]=c("姓名： "))]),l(S,{outlined:"",dense:"",modelValue:e.form.name,"onUpdate:modelValue":o[6]||(o[6]=n=>e.form.name=n),type:"text"},null,8,["modelValue"])]),r("div",Oe,[o[16]||(o[16]=r("h5",null,"年龄：",-1)),l(S,{outlined:"",dense:"",modelValue:e.form.age,"onUpdate:modelValue":o[7]||(o[7]=n=>e.form.age=n),type:"text"},null,8,["modelValue"])]),r("div",Ye,[o[17]||(o[17]=r("h5",null,"个人照片",-1)),l(Be,{src:e.form.picture??"img/noimage.gif","spinner-color":"white",style:{height:"80px","max-width":"80px"},onClick:e.doImageUpload},null,8,["src"]),o[18]||(o[18]=c()),l(H,{ref:"imgUploader","max-files":1,class:"hidden",accept:"image/*","field-name":"file",onAdded:e.pictureUpload},null,512)]),r("div",He,[o[19]||(o[19]=r("h5",null,"上传简历",-1)),m(l(d,{"no-wrap":"",label:"上传",icon:"mdi-cloud-upload-outline",color:"primary",onClick:e.doUpload},{default:a(()=>[l(H,{ref:"profileUploader","max-files":1,class:"hidden",accept:".doc, .docx, .pdf","field-name":"file",onAdded:e.fileUpload},null,512)]),_:1},512),[[h,e.$q.screen.gt.sm]])])])]),_:1}),r("div",Ge,[m(l(d,{outline:"",color:"primary",icon:"mdi-close-thick",label:"关闭"},null,512),[[F]]),l(d,{class:"q-mx-sm",color:"primary",icon:"mdi-check-bold",label:"提交",type:"submit"})])]),_:1})]),_:1},512)]),_:1},8,["style"])}const dl=Ee(qe,[["render",Je],["__scopeId","data-v-d5198cad"],["__file","DBTable.vue"]]);export{dl as default};
