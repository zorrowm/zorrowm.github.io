import{W as r}from"./xframelib-exp-uSJ3EBow.js";import{D as d}from"./dexie-exp-BSZCzc8U.js";const s=new d("MyDB");s.version(1).stores({students:"++id, name, age, picture,pid,lastModified",profiles:"++id, sid,name, file"});class f{static async getCount(){return await s.students.count()}static async getPageList(t,e=1,a=10){const n=((e>=1?e:1)-1)*a;let c;return t?c=await s.students.where("name").equalsIgnoreCase(t).offset(n).limit(a).toArray():c=await s.students.offset(n).limit(a).toArray(),c}static async getAll(){return await s.students.toArray()}static async clear(){await s.profiles.clear(),await s.students.clear()}static async getItem(t){return await s.students.get(t)}static async addItem(t){return t?await s.students.add({...t,lastModified:new Date}):-1}static async deleteItem(t){const e=await this.getItem(t);if(e){if(e.pid){const i=e.pid;await s.profiles.where("id").equals(i).delete()}return await s.students.where("id").equals(t).delete()}}static async batchDelete(t){t&&t.length>0&&t.forEach(async({id:e})=>await this.deleteItem(e))}static async updateItem(t,e={}){let a=await s.students.get(t);if(a){const i=this.getTableNames(s.students);i&&e&&i.forEach(n=>{const c=e[n];c!=null&&(a[n]=c)}),a.lastModified=new Date,await s.students.put(a)}}static async updatePicture(t,e){const a={picture:e,key:"test"};return await this.updateItem(t,a)}static async saveProfile(t,e){if(!e)return;const a=await s.profiles.add({sid:t,name:e.name,file:e.content});return await this.updateItem(t,{pid:a})}static async getProfile(t){return await s.profiles.get(t)}static tabFields=new Map;static getTableNames(t){const e=t.name;if(!this.tabFields.has(e)){const a=[];this.tabFields.set(e,a);const i=t.schema.indexes,n=s.students.schema.primKey.name;i.forEach(c=>{c.name!=n&&a.push(c.name)})}return this.tabFields.get(e)}static async test(){let t=await s.students.get(1);if(t){const e=this.getTableNames(s.students),a={name:"WM",age:40,test:2,t:"45566"};e?.forEach(i=>{const n=a[i];n!=null&&(t[i]=n)}),t.lastModified=new Date,r.Logger().info("55555",t)}}static async test1(){s.profiles.clear()}}export{f as D};
