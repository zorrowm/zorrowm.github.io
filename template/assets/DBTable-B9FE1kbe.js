import{u as se,d as re,U as ue,a0 as T,F as H,q as de,e as u,O as me,i as R,j as h,k as w,a1 as ce,M as fe,a2 as $,c as A,h as pe,H as _,m as ve,a3 as ge,L as be,a4 as we,A as _e,T as ye,aa as z}from"./quasar-exp-B7YDMHDE.js";import{d as ke,c as N,r as s,w as xe,b as d,f as v,a3 as a,i as l,I as C,k as i,j as c,v as D,e as q,F as Qe,a9 as he,aa as m,a6 as Y,a0 as Ce}from"./@vue-exp-CzdoyapG.js";import{_ as Ue}from"./BaseContent.vue_vue_type_script_setup_true_lang-CHGumBnk.js";import{W as O,H as Ve}from"./xframelib-exp-uSJ3EBow.js";import{b as Pe,_ as De}from"./index-DylLUN-r.js";import{_ as qe}from"./BtnDel.vue_vue_type_script_setup_true_lang-C1ek4QfO.js";import{D as f}from"./DBService-DJHD52el.js";import"./vue-router-exp-B23Vo4Jw.js";import"./axios-exp-C7rfqWEd.js";import"./vendor-CSzZZ-de.js";import"./lottie-web-exp-CIY4INm7.js";import"./monaco-editor-exp-BNK_u0iZ.js";import"./@iconify/vue-exp-BLEeEXwl.js";import"./xgis-cesium-exp-Cbv1lISI.js";import"./dexie-exp-BSZCzc8U.js";const Be={class:"row no-wrap full-width"},Se={class:"q-gutter-xs"},Ie=["src"],Fe={key:1},Me={key:1},Te={class:"full-width row justify-center"},$e={class:"view_title justify-between q-px-md"},Ae={class:"row q-col-gutter-x-md dialog_form q-pa-md"},Le={class:"col-6"},je={class:"col-6"},He={class:"col-12"},Re={class:"col-12"},ze={class:"row justify-center q-pa-md"},Ne=ke({name:"DBTable",__name:"DBTable",setup(Ye){const g=se(),E=Pe(),W=N(()=>E.showTabMenu?"padding-bottom: 30px;":""),B=s(null),L=s(null),y=s({sortBy:"id",descending:!1,page:1,rowsPerPage:10}),k=s(1);let p;const j=s(0),G=N(()=>Math.ceil(j.value/y.value.rowsPerPage)),S=s(""),U=s([]),I=s([{name:"id",align:"center",label:"索引",field:"id",sortable:!0},{name:"name",align:"center",label:"姓名",field:"name"},{name:"age",align:"center",label:"年龄",field:"age",sortable:!0},{name:"picture",required:!0,label:"照片",align:"center",field:"picture"},{name:"profile",required:!0,label:"档案",align:"center",field:"pid"},{name:"modifytime",required:!0,label:"更新时间",align:"center",field:"lastModified",format:o=>o?re.formatDate(o,"YYYY-MM-DD HH:mm:ss"):"无",sortable:!0},{name:"opt",align:"center",label:"操作",field:"opt"}]),F=s([]);xe(()=>k.value,o=>{x()});function x(){f.getPageList(void 0,k.value,y.value.rowsPerPage).then(o=>{F.value=o})}function J(){f.getCount().then(o=>{j.value=o}),f.getPageList(void 0,k.value,y.value.rowsPerPage).then(o=>{F.value=o})}J();const V=s([]),P=s("新建"),r=s({}),b=s(void 0);I.value.forEach(({name:o})=>{V.value.push(o)});function K(){const o=`确认删除这 ${U.value.length} 条记录吗？`;g.dialog({title:"批量删除",message:o,cancel:!0,persistent:!0}).onOk(()=>{}).onOk(()=>{}).onCancel(()=>{}).onDismiss(()=>{})}function X(){P.value="新建",r.value={name:"",age:10},b.value&&b.value.show()}function Z(o){f.deleteItem(o.id).then(e=>{x(),O.Message.info("删除成功")})}function ee(o){P.value="编辑",r.value={...o},b.value&&b.value.show()}function Oe(o){}async function le(){P.value==="新建"?f.addItem(r.value).then(o=>{o&&p&&f.saveProfile(o,p[0]).then(()=>{p=void 0}),x()}):f.updateItem(r.value.id,r.value).then(()=>{p?f.saveProfile(r.value.id,p).then(()=>{p=void 0,x()}):x()}),b.value.hide(),O.Message.info("提交更改成功！")}function ae(){L.value?.pickFiles()}function te(o){const e=o[0],t=new FileReader;t.onload=function(n){r.value.picture=n.target.result},t.readAsDataURL(e)}function oe(o){const e=o[0],t=e.name,n=new FileReader;n.onload=function(Q){let M=null;typeof Q.target.result=="object"?M=new Blob([Q.target.result]):M=Q.target.result,p={name:t,content:M}},n.readAsArrayBuffer(e)}function ne(){B.value&&B.value.pickFiles()}async function ie(o){const e=await f.getProfile(o);e&&Ve(e.file,e.name)}return(o,e)=>(d(),v(Ue,{class:"q-pa-sm",style:Ce(W.value)},{default:a(()=>[l(ue,{class:"fit sticky-header-table",selection:"multiple",selected:U.value,"onUpdate:selected":e[4]||(e[4]=t=>U.value=t),dense:C(g).screen.lt.md,separator:"cell",flat:"",bordered:"",rows:F.value,filter:S.value,columns:I.value,"row-key":"name","visible-columns":V.value,pagination:y.value,"onUpdate:pagination":e[5]||(e[5]=t=>y.value=t)},{top:a(t=>[i("div",Be,[l(T,{clearable:"",outlined:"",dense:"",placeholder:"请输入关键字搜索",class:"on-left",debounce:"300",modelValue:S.value,"onUpdate:modelValue":e[0]||(e[0]=n=>S.value=n)},{append:a(()=>[l(H,{name:"search"})]),_:1},8,["modelValue"]),l(de),i("div",Se,[l(u,{icon:"add","no-wrap":"",color:"primary",label:"新建",onClick:X}),c(l(u,{disable:U.value.length===0,"no-wrap":"",color:"negative",label:"批量删除",onClick:e[1]||(e[1]=n=>K()),icon:"delete_outline"},null,8,["disable"]),[[D,C(g).screen.gt.sm]]),c(l(u,{color:"primary",label:"切换全屏","no-wrap":"",onClick:t.toggleFullscreen,icon:t.inFullscreen?"fullscreen_exit":"fullscreen"},null,8,["onClick","icon"]),[[D,C(g).screen.gt.sm]]),c(l(me,{color:"primary",label:"自选列",icon:"view_list","no-wrap":""},{default:a(()=>[l(R,null,{default:a(()=>[(d(!0),q(Qe,null,he(I.value,n=>(d(),v(h,{tag:"label",key:n.name},{default:a(()=>[l(w,{avatar:""},{default:a(()=>[l(ce,{modelValue:V.value,"onUpdate:modelValue":e[2]||(e[2]=Q=>V.value=Q),val:n.name},null,8,["modelValue","val"])]),_:2},1024),l(w,null,{default:a(()=>[l(fe,null,{default:a(()=>[m(Y(n.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},512),[[D,C(g).screen.gt.sm]])])])]),"body-cell-picture":a(t=>[l($,{props:t},{default:a(()=>[t.row.picture?(d(),q("img",{key:0,src:t.row.picture,width:"80",height:"80"},null,8,Ie)):(d(),q("span",Fe,"暂无"))]),_:2},1032,["props"])]),"body-cell-profile":a(t=>[l($,{props:t},{default:a(()=>[t.row.pid?(d(),v(u,{key:0,label:"下载档案",color:"primary",onClick:n=>ie(t.row.pid)},null,8,["onClick"])):(d(),q("span",Me,"暂无"))]),_:2},1032,["props"])]),"body-cell-opt":a(t=>[l($,{props:t,"auto-width":!0},{default:a(()=>[l(u,{flat:"",round:"",dense:"",color:"primary",icon:"edit",onClick:n=>ee(t.row)},{default:a(()=>[l(A,null,{default:a(()=>e[8]||(e[8]=[m("编辑")])),_:1})]),_:2},1032,["onClick"]),l(u,{flat:"",round:"",dense:"",color:"primary",icon:"mdi-image-edit-outline",onClick:n=>(t.row,void 0)},{default:a(()=>[l(A,null,{default:a(()=>e[9]||(e[9]=[m("视图设计")])),_:1})]),_:2},1032,["onClick"]),l(qe,{label:"视图",onConfirm:n=>Z(t.row)},null,8,["onConfirm"]),l(u,{flat:"",round:"",dense:"",color:"primary",icon:"mdi-more"},{default:a(()=>[l(A,null,{default:a(()=>e[10]||(e[10]=[m("更多")])),_:1}),l(pe,null,{default:a(()=>[l(R,{style:{"min-width":"100px"}},{default:a(()=>[c((d(),v(h,{clickable:""},{default:a(()=>[l(w,null,{default:a(()=>e[11]||(e[11]=[m("发布服务")])),_:1})]),_:1})),[[_]]),c((d(),v(h,{clickable:""},{default:a(()=>[l(w,null,{default:a(()=>e[12]||(e[12]=[m("新建索引")])),_:1})]),_:1})),[[_]]),l(ve),c((d(),v(h,{clickable:""},{default:a(()=>[l(w,null,{default:a(()=>e[13]||(e[13]=[m("清理缓存")])),_:1})]),_:1})),[[_]]),c((d(),v(h,{clickable:""},{default:a(()=>[l(w,null,{default:a(()=>e[14]||(e[14]=[m("新增数据")])),_:1})]),_:1})),[[_]])]),_:1})]),_:1})]),_:1})]),_:2},1032,["props"])]),bottom:a(()=>[i("div",Te,[l(ge,{modelValue:k.value,"onUpdate:modelValue":e[3]||(e[3]=t=>k.value=t),max:G.value},null,8,["modelValue","max"])])]),_:1},8,["selected","dense","rows","filter","columns","visible-columns","pagination"]),l(be,{maximized:"",flat:"",persistent:"",ref_key:"dialogRef",ref:b},{default:a(()=>[l(we,{onSubmit:le,class:"dialog_card column"},{default:a(()=>[i("h5",$e,[m(Y(P.value)+"视图 ",1),c(l(u,{dense:"",outline:"",round:"",icon:"clear",size:"sm"},null,512),[[_]])]),l(_e,{class:"col"},{default:a(()=>[i("div",Ae,[i("div",Le,[i("h5",null,[l(H,{name:"star",color:"red"}),e[15]||(e[15]=m("姓名： "))]),l(T,{outlined:"",dense:"",modelValue:r.value.name,"onUpdate:modelValue":e[6]||(e[6]=t=>r.value.name=t),type:"text"},null,8,["modelValue"])]),i("div",je,[e[16]||(e[16]=i("h5",null,"年龄：",-1)),l(T,{outlined:"",dense:"",modelValue:r.value.age,"onUpdate:modelValue":e[7]||(e[7]=t=>r.value.age=t),type:"text"},null,8,["modelValue"])]),i("div",He,[e[17]||(e[17]=i("h5",null,"个人照片",-1)),l(ye,{src:r.value.picture??"img/noimage.gif","spinner-color":"white",style:{height:"80px","max-width":"80px"},onClick:ae},null,8,["src"]),e[18]||(e[18]=m()),l(z,{ref_key:"imgUploader",ref:L,"max-files":1,class:"hidden",accept:"image/*","field-name":"file",onAdded:te},null,512)]),i("div",Re,[e[19]||(e[19]=i("h5",null,"上传简历",-1)),c(l(u,{"no-wrap":"",label:"上传",icon:"mdi-cloud-upload-outline",color:"primary",onClick:ne},{default:a(()=>[l(z,{ref_key:"profileUploader",ref:B,"max-files":1,class:"hidden",accept:".doc, .docx, .pdf","field-name":"file",onAdded:oe},null,512)]),_:1},512),[[D,C(g).screen.gt.sm]])])])]),_:1}),i("div",ze,[c(l(u,{outline:"",color:"primary",icon:"mdi-close-thick",label:"关闭"},null,512),[[_]]),l(u,{class:"q-mx-sm",color:"primary",icon:"mdi-check-bold",label:"提交",type:"submit"})])]),_:1})]),_:1},512)]),_:1},8,["style"]))}}),rl=De(Ne,[["__scopeId","data-v-d5198cad"]]);export{rl as default};
