import{u as J,U as O,V as $}from"./quasar-exp-BsaNoQ7w.js";import{d as j,ah as ee,a0 as te,b as q,e as X,j as I,a4 as Y,n as ae,u as ne,r as y,o as oe,a as ie,l as se,af as re,F as le}from"./@vue-exp-Bws36Ke9.js";import{cA as G,cD as N}from"./vendor-DJm_4oaR.js";import{_ as W}from"./index-BQ7ovaqR.js";import{k as z,B as H}from"./xframelib-exp-CMLeiWD4.js";import{W as ce}from"./xgis-cesium-exp-Hv7oMXHX.js";import"./lottie-web-exp-CIY4INm7.js";import"./monaco-editor-exp-BNK_u0iZ.js";import"./vue-router-exp-CO9L2VdX.js";import"./axios-exp-C7rfqWEd.js";import"./@iconify/vue-exp-Q9Q0SWJB.js";const ue=j({__name:"PopoverPanel",props:{isShown:G().def(!1),leftX:N().def("0px"),topY:N().def("0px"),autoHide:G().def(!1)},setup(r,{expose:t}){t(),ee(a=>({"02eea6e8":r.leftX,e74a722e:r.topY}));const i={};return Object.defineProperty(i,"__isScriptSetup",{enumerable:!1,value:!0}),i}}),pe={class:"popoverInfo"};function me(r,t,i,a,e,l){const o=te("VDropdown");return q(),X("div",pe,[I(o,{placement:"top",distance:10,triggers:[],shown:i.isShown,autohide:i.autoHide},{popper:Y(()=>[ae(r.$slots,"content",{},void 0,!0)]),_:3},8,["shown","autohide"])])}const de=W(ue,[["render",me],["__scopeId","data-v-c5f4fcb4"],["__file","PopoverPanel.vue"]]);function fe(r){let t=Cesium.Color.GOLD;switch(r){case"给水管":t=Cesium.Color.AQUA;break;case"热力":t=Cesium.Color.TOMATO;break;case"天然气":t=Cesium.Color.ORANGE;break;case"污水管":t=Cesium.Color.BLACK;break;case"雨水管":t=Cesium.Color.SADDLEBROWN;break;case"交通信号":t=Cesium.Color.DARKORCHID;break}return t}async function ge(r){const t=await z(r).catch(i=>{});if(t&&t.data)return t.data}function Ce(r){const t=[];for(let i=0;i<360;i++){const a=Cesium.Math.toRadians(i),e=new Cesium.Cartesian2(r*Math.cos(a),r*Math.sin(a));t.push(e)}return t}async function ve(r,t,i){return t.forEach(a=>{const e=a.geometry.coordinates,l=e[0],o=e[1],s=a.properties,g=s.管线编,C=s.起点高,k=s.终点高,p=parseFloat(s.管径)/1e3,m=s.图层;i.set(g,[{name:"管线编号",value:s.管线编},{name:"类型",value:s.图层},{name:"材质",value:s.材质},{name:"长度",value:s.长度},{name:"位置",value:s.所在道},{name:"起点埋",value:s.起点埋},{name:"终点埋",value:s.终点埋},{name:"管径",value:s.管径}]);const f=fe(m),c=new Cesium.PolylineVolumeGeometry({polylinePositions:Cesium.Cartesian3.fromDegreesArrayHeights([l[0],l[1],C,o[0],o[1],k]),shapePositions:Ce(p)}),v=Cesium.PolylineVolumeGeometry.createGeometry(c),_=new Cesium.GeometryInstance({geometry:v,id:g,attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(f)}}),w=new Cesium.PerInstanceColorAppearance({flat:!0,translucent:!1}),b=new Cesium.Primitive({geometryInstances:_,appearance:w,asynchronous:!1});r.add(b)}),r}async function we(r){const t=await z(r).catch(i=>{});if(t&&t.data)return t.data}const be=new Cesium.Material({fabric:{type:"Image",uniforms:{image:"img/jing2.png"}}}),he=new Cesium.Material({fabric:{type:"Image",uniforms:{image:"bizi.png"}}}),M=899e-8/2,ye=new Cesium.MaterialAppearance({material:be,faceForward:!1}),_e=new Cesium.MaterialAppearance({material:he,faceForward:!0}),Ae=new Cesium.Material({fabric:{type:"Color",uniforms:{color:new Cesium.Color(1,1,0,1)}}});new Cesium.MaterialAppearance({material:Ae});async function Fe(r,t,i){const a=[],e=[];if(t.forEach(l=>{const o=l.properties,s=o.ID;o.图层,o.埋深;const g=o.井底高,C=o.地面高;let p=o.附属物==="篦子";i.set(s,[{name:"编号",value:o.ID},{name:"类型",value:o.图层},{name:"特征",value:o.特征},{name:"地面高程",value:o.地面高},{name:"井底高程",value:o.井底高},{name:"埋设方法",value:o.埋设方}]);const m=l.geometry.coordinates;let f;p?f=new Cesium.RectangleGeometry({rectangle:Cesium.Rectangle.fromDegrees(m[0]-M,m[1]-M,m[0]+M,m[1]+M),height:C+.2}):f=new Cesium.CircleGeometry({center:Cesium.Cartesian3.fromDegrees(m[0],m[1]),radius:1,height:C+1,extrudedHeight:g});const c=new Cesium.GeometryInstance({id:s,geometry:f});p?a.push(c):e.push(c)}),a.length>0){const l=new Cesium.Primitive({geometryInstances:a,appearance:_e,asynchronous:!0});l.disableDepthTestDistance=99e3,r.add(l)}if(e.length>0){const l=new Cesium.Primitive({geometryInstances:e,appearance:ye,asynchronous:!0});l.disableDepthTestDistance=99e3,r.add(l)}}async function U(r,t=10){const i=r.features.length,a=Math.ceil(i/t),e=new Array;let l=0,o=t;for(let s=1;s<=a;s++)o=s*t,o>=i&&(o=i-1),e.push(r.features.slice(l,o)),l=o;return e}const Pe=j({__name:"PipelineWidget",setup(r,{expose:t}){t();const i=J();let a;ne(()=>{a!==void 0&&(clearTimeout(a),i.loading.hide())});let e;const l=y(!1),o=y(!1),s=y(!1),g=y("0px"),C=y("0px"),k=[{name:"name",label:"属性名",align:"left",field:"name"},{name:"value",align:"center",label:"值",field:"value"}],p=y([]),m=y({rowsPerPage:0});function f(){return H.CesiumViewer&&(e||(e=H.CesiumViewer)),e}let c,v=!0,_,w;const b=new Map,F=new Map,R=new Cesium.Material({fabric:{type:"Image",uniforms:{image:"img/red.png"}}}),K=new Cesium.MaterialAppearance({material:R,faceForward:!1});let D;function B(){c&&(c.primitive&&(v?c.primitive.appearance=new Cesium.PerInstanceColorAppearance({flat:!0,translucent:!1}):c.primitive.appearance=D),e.scene.requestRender(),c=void 0)}_||ge("data/line_4490.json").then(n=>{_=n,L(n)});async function L(n){b.clear();const d=await U(n,100);n=void 0;const u=d.length;for(let h=0;h<u;h++){const E=d[h],P=new Cesium.PrimitiveCollection;e.scene.primitives.add(P),ve(P,E,b)}}w||we("data/point_4490.json").then(async n=>{w=n,S(w)});async function S(n){F.clear();const d=await U(n,200),u=d.length;for(let h=0;h<u;h++){const E=d[h],P=new Cesium.PrimitiveCollection;e.scene.primitives.add(P),Fe(P,E,F)}}let A;i.loading.show({message:"正在加载3万多管线数据，请稍等……"}),a=setTimeout(()=>{e&&e.scene.requestRender(),i.loading.show({messageColor:"black",backgroundColor:"white",message:"正在渐进式渲染点数据……"}),a=setTimeout(()=>{i.loading.hide(),a=void 0},5e3)},7e3),oe(()=>{f(),e?.flyToPosition(new ce(116.2698,36.3475,203,5.69,-26.2,360)),A=new Cesium.ScreenSpaceEventHandler(e.scene.canvas),A.setInputAction(async function(n){const d=n.position;var u=e.scene.pick(n.position);u?(s.value=!1,C.value=d.y+"px",g.value=d.x+"px",c&&B(),c=u,setTimeout(()=>{s.value=!0},50),u.id.length>10?(v=!0,u.primitive.appearance=new Cesium.MaterialAppearance({material:Cesium.Material.fromType("Color"),faceForward:!0}),u.primitive.appearance.material.uniforms.color=new Cesium.Color(1,0,0,1),e.scene.requestRender(),b.size>0&&(p.value=[],p.value=b.get(u.id))):(D=u.primitive.appearance,e.scene.requestRender(),v=!1,F.size>0&&(p.value=[],p.value=F.get(u.id)))):(s.value=!1,B())},Cesium.ScreenSpaceEventType.LEFT_CLICK)}),ie(()=>{A&&A.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK),e&&e.scene.primitives.removeAll()});function Q(n,d){e&&(e.scene.globe.depthTestAgainstTerrain=n,e.scene.requestRender())}function Z(n,d){e&&(n?T():V(),e.scene.requestRender())}function T(){e.scene.screenSpaceCameraController.enableCollisionDetection=!1,e.scene.globe.translucency.enabled=!0,e.scene.globe.translucency.frontFaceAlphaByDistance=new Cesium.NearFarScalar(400,.5,8e3,.9)}function V(){e.scene.screenSpaceCameraController.enableCollisionDetection=!0,e.scene.globe.translucency.enabled=!1}const x={$q:i,get timer(){return a},set timer(n){a=n},get viewer(){return e},set viewer(n){e=n},depthRef:l,subwayRef:o,isOpen:s,leftX:g,topY:C,columns:k,rows:p,pagination:m,getViewer:f,get lastPick(){return c},set lastPick(n){c=n},get lastIsLine(){return v},set lastIsLine(n){v=n},get line4490(){return _},set line4490(n){_=n},get point4490(){return w},set point4490(n){w=n},lineMap:b,pointMap:F,imgMaterial2:R,appearanceSelected:K,get lastOldAppearance(){return D},set lastOldAppearance(n){D=n},rebackAppearance:B,loadLinesHandler:L,loadPointsHandler:S,get handler(){return A},set handler(n){A=n},depthChanged:Q,subwayChanged:Z,OpenUnderGroup:T,CloseUnderGroud:V,PopoverPanel:de};return Object.defineProperty(x,"__isScriptSetup",{enumerable:!1,value:!0}),x}}),Ie={class:"toolbarLine"};function ke(r,t,i,a,e,l){return q(),X(le,null,[I(a.PopoverPanel,{isShown:a.isOpen,leftX:a.leftX,topY:a.topY},{content:Y(()=>[I($,{pagination:a.pagination,"onUpdate:pagination":t[0]||(t[0]=o=>a.pagination=o),title:"属性表",rows:a.rows,columns:a.columns,"row-key":"name",dense:!0},null,8,["pagination","rows"])]),_:1},8,["isShown","leftX","topY"]),se("div",Ie,[I(O,{modelValue:a.depthRef,"onUpdate:modelValue":[t[1]||(t[1]=o=>a.depthRef=o),a.depthChanged],label:"地形深度检测"},null,8,["modelValue"]),I(O,{modelValue:a.subwayRef,"onUpdate:modelValue":[t[2]||(t[2]=o=>a.subwayRef=o),a.subwayChanged],label:"地下模式"},null,8,["modelValue"])]),t[3]||(t[3]=re('<div class="legendPanel" data-v-0bd19625><b data-v-0bd19625>管线图例：</b><ul data-v-0bd19625><li style="background-color:#00FFFF;" data-v-0bd19625>给水管：#00FFFF </li><li style="background-color:#FF6347;" data-v-0bd19625>热力 : #FF6347</li><li style="background-color:#FFA500;" data-v-0bd19625>天然气 :#FFA500</li><li style="background-color:#000000;color:#fff;" data-v-0bd19625>污水管 :#000000 </li><li style="background-color:#8B4513;" data-v-0bd19625>雨水管 :#8B4513</li><li style="background-color:#9932CC;" data-v-0bd19625>交通信号 :#9932CC</li><li style="background-color:#4682B4;" data-v-0bd19625>其他 :#4682B4 </li></ul></div>',1))],64)}const Ge=W(Pe,[["render",ke],["__scopeId","data-v-0bd19625"],["__file","PipelineWidget.vue"]]);export{Ge as default};
