import{i as M,j as C,u as I,g as R,c as D,k as E,_ as O}from"./index-CvUQtR9N.js";import{B as o,P as U,b as j}from"./xframelib-exp-B9KgMBHw.js";import{b as H}from"./vue-router-exp-DWvvxSx9.js";import{b_ as P,bZ as V}from"./vendor-B1f7FUIB.js";import{S as K}from"./SystemsEvent-DUQCZw_Q.js";import{d as y,p as N,r as _,o as T,a as q,b as Z,e as z,l as t,k as x,ah as B,a2 as A}from"./@vue-exp-DMKPrOh0.js";import"./pdfjs-dist-exp-C7mOU4gj.js";import"./@hprose-exp-BEudjurc.js";import"./axios-exp-B_zfNCMU.js";import"./@iconify/vue-exp-5llPk3YT.js";const G=y({name:"loginIFrame"}),J=y({...G,props:{data:P([Object]).def({}),extra:V().isRequired},setup(f,{expose:e}){e();const u="loginIFrame",s=f,d=H(),r=N({username:"",password:""}),n=_(),c=_();function h(){n.value&&(n.value.placeholder="请输入账号"),c.value&&(c.value.placeholder="请输入密码")}let a=!0;const k=async()=>{if(!a){o.Logger().debug("频繁点击登录******");return}if(a=!1,r.username.trim()===""||r.password.trim()=="")return setTimeout(()=>{a=!0},2e3),o.Message?.warn("用户名或密码不能为空！");let i={username:r.username.trim(),pwd:r.password.trim()};const l=await U(i).catch(p=>{o.Message?.warn(`登录失败:${p.message}!`),a=!0});l&&await v(l)};async function v(i){const l=I();l.init(i),o.User=l.id;const p=R(),F=l.DefaultMaxRoleLevel===0;let w=!0;const S=await j(p,F).catch(g=>{w=!1,o.Message?.err("该系统未注册！")});if(a=!0,!!w){if(o.Logger().debug(S,"登录后的系统权限"),S){const g=D();o.Logger().debug(g,"系统路由权限"),g?.forEach(L=>{d.addRoute(L)})}else{o.Message?.warn(r.username+"无系统权限，无法登录！");return}E(K.UserLoginSuccess,void 0)}}function m(i){}T(()=>{M(u,m)}),q(()=>{C(u,m)});const b={name:u,props:s,router:d,formState:r,nameInput:n,pwdInput:c,onblur:h,get canLoginClicked(){return a},set canLoginClicked(i){a=i},handleSubmit:k,loginSuccess:v,OkCancelHandler:m};return Object.defineProperty(b,"__isScriptSetup",{enumerable:!1,value:!0}),b}}),Q={class:"container",style:{height:"500px"}},W={class:"login"},X={class:"login-center clearfix"},Y={class:"login-center-input"},$={class:"login-center clearfix"},ee={class:"login-center-input"};function te(f,e,u,s,d,r){return Z(),z("div",Q,[t("div",W,[e[8]||(e[8]=t("div",{class:"login-top"},"用户登录",-1)),t("div",X,[e[5]||(e[5]=t("div",{class:"login-center-img"},[t("img",{src:"img/login/name.png"})],-1)),t("div",Y,[x(t("input",{ref:"nameInput","onUpdate:modelValue":e[0]||(e[0]=n=>s.formState.username=n),type:"text",placeholder:"请输入账号",onfocus:"this.placeholder=''",onBlur:e[1]||(e[1]=n=>s.onblur())},null,544),[[B,s.formState.username]]),e[4]||(e[4]=t("div",{class:"login-center-input-text"},"账号",-1))])]),t("div",$,[e[7]||(e[7]=t("div",{class:"login-center-img"},[t("img",{src:"img/login/password.png"})],-1)),t("div",ee,[x(t("input",{ref:"pwdInput","onUpdate:modelValue":e[2]||(e[2]=n=>s.formState.password=n),type:"password",placeholder:"请输入密码",onfocus:"this.placeholder=''",onBlur:e[3]||(e[3]=n=>s.onblur()),onKeyup:A(s.handleSubmit,["enter"])},null,544),[[B,s.formState.password]]),e[6]||(e[6]=t("div",{class:"login-center-input-text"},"密码",-1))])]),t("div",{class:"login-button",onClick:s.handleSubmit},"登录")])])}const me=O(J,[["render",te],["__file","loginModal.vue"]]);export{me as default};
