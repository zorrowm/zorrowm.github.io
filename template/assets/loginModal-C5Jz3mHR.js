import{i as I,j as h,u as C,g as L,c as R,k as D,_ as E}from"./index-BQ7ovaqR.js";import{B as o,I as O,d as U}from"./xframelib-exp-CMLeiWD4.js";import{b as j}from"./vue-router-exp-CO9L2VdX.js";import{cC as H,cB as V}from"./vendor-DJm_4oaR.js";import{S as q}from"./SystemsEvent-DUQCZw_Q.js";import{d as K,q as N,r as B,o as T,a as z,b as P,e as A,l as t,k as x,ai as _,a3 as G}from"./@vue-exp-Bws36Ke9.js";import"./monaco-editor-exp-BNK_u0iZ.js";import"./quasar-exp-BsaNoQ7w.js";import"./xgis-cesium-exp-Hv7oMXHX.js";import"./lottie-web-exp-CIY4INm7.js";import"./axios-exp-C7rfqWEd.js";import"./@iconify/vue-exp-Q9Q0SWJB.js";const p="loginIFrame",J=K({name:"loginIFrame",__name:"loginModal",props:{data:H([Object]).def({}),extra:V().isRequired},setup(g,{expose:e}){e();const f=g,s=j(),r=N({username:"",password:""}),u=B(),n=B();function y(){u.value&&(u.value.placeholder="请输入账号"),n.value&&(n.value.placeholder="请输入密码")}let a=!0;const M=async()=>{if(!a){o.Logger().debug("频繁点击登录******");return}if(a=!1,r.username.trim()===""||r.password.trim()=="")return setTimeout(()=>{a=!0},2e3),o.Message?.warn("用户名或密码不能为空！");let i={username:r.username.trim(),pwd:r.password.trim()};const l=await O(i).catch(m=>{o.Message?.warn(`登录失败:${m.message}!`),a=!0});l&&await v(l)};async function v(i){const l=C();l.init(i),o.User=l.id;const m=L(),k=l.DefaultMaxRoleLevel===0;let S=!0;const b=await U(m,k).catch(c=>{S=!1,o.Message?.err("该系统未注册！")});if(a=!0,!!S){if(o.Logger().debug(b,"登录后的系统权限"),b){const c=R();o.Logger().debug(c,"系统路由权限"),c?.forEach(F=>{s.addRoute(F)})}else{o.Message?.warn(r.username+"无系统权限，无法登录！");return}D(q.UserLoginSuccess,void 0)}}function d(i){}T(()=>{I(p,d)}),z(()=>{h(p,d)});const w={name:p,props:f,router:s,formState:r,nameInput:u,pwdInput:n,onblur:y,get canLoginClicked(){return a},set canLoginClicked(i){a=i},handleSubmit:M,loginSuccess:v,OkCancelHandler:d};return Object.defineProperty(w,"__isScriptSetup",{enumerable:!1,value:!0}),w}}),Q={class:"container",style:{height:"500px"}},W={class:"login"},X={class:"login-center clearfix"},Y={class:"login-center-input"},Z={class:"login-center clearfix"},$={class:"login-center-input"};function ee(g,e,f,s,r,u){return P(),A("div",Q,[t("div",W,[e[8]||(e[8]=t("div",{class:"login-top"},"用户登录",-1)),t("div",X,[e[5]||(e[5]=t("div",{class:"login-center-img"},[t("img",{src:"img/login/name.png"})],-1)),t("div",Y,[x(t("input",{ref:"nameInput","onUpdate:modelValue":e[0]||(e[0]=n=>s.formState.username=n),type:"text",placeholder:"请输入账号",onfocus:"this.placeholder=''",onBlur:e[1]||(e[1]=n=>s.onblur())},null,544),[[_,s.formState.username]]),e[4]||(e[4]=t("div",{class:"login-center-input-text"},"账号",-1))])]),t("div",Z,[e[7]||(e[7]=t("div",{class:"login-center-img"},[t("img",{src:"img/login/password.png"})],-1)),t("div",$,[x(t("input",{ref:"pwdInput","onUpdate:modelValue":e[2]||(e[2]=n=>s.formState.password=n),type:"password",placeholder:"请输入密码",onfocus:"this.placeholder=''",onBlur:e[3]||(e[3]=n=>s.onblur()),onKeyup:G(s.handleSubmit,["enter"])},null,544),[[_,s.formState.password]]),e[6]||(e[6]=t("div",{class:"login-center-input-text"},"密码",-1))])]),t("div",{class:"login-button",onClick:s.handleSubmit},"登录")])])}const pe=E(J,[["render",ee],["__file","loginModal.vue"]]);export{pe as default};
