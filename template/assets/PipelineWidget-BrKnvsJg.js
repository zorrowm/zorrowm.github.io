import{U as z,V,u as K}from"./quasar-exp-B7YDMHDE.js";import{d as B,e as G,i as F,a3 as E,$ as Q,b as N,l as Z,af as J,u as ee,r as w,o as ae,a as te,k as ne,ad as oe,F as ie}from"./@vue-exp-CzdoyapG.js";import{cC as L,cF as R}from"./vendor-CSzZZ-de.js";import{_ as O}from"./index-DylLUN-r.js";import{r as H,W as x}from"./xframelib-exp-uSJ3EBow.js";import{W as se}from"./xgis-cesium-exp-Cbv1lISI.js";import"./lottie-web-exp-CIY4INm7.js";import"./monaco-editor-exp-BNK_u0iZ.js";import"./vue-router-exp-B23Vo4Jw.js";import"./axios-exp-C7rfqWEd.js";import"./@iconify/vue-exp-BLEeEXwl.js";const re={class:"popoverInfo"},le=B({__name:"PopoverPanel",props:{isShown:L().def(!1),leftX:R().def("0px"),topY:R().def("0px"),autoHide:L().def(!1)},setup(n){return J(a=>({"02eea6e8":n.leftX,e74a722e:n.topY})),(a,i)=>{const e=Q("VDropdown");return N(),G("div",re,[F(e,{placement:"top",distance:10,triggers:[],shown:n.isShown,autohide:n.autoHide},{popper:E(()=>[Z(a.$slots,"content",{},void 0,!0)]),_:3},8,["shown","autohide"])])}}}),ce=O(le,[["__scopeId","data-v-c5f4fcb4"]]);function ue(n){let a=Cesium.Color.GOLD;switch(n){case"给水管":a=Cesium.Color.AQUA;break;case"热力":a=Cesium.Color.TOMATO;break;case"天然气":a=Cesium.Color.ORANGE;break;case"污水管":a=Cesium.Color.BLACK;break;case"雨水管":a=Cesium.Color.SADDLEBROWN;break;case"交通信号":a=Cesium.Color.DARKORCHID;break}return a}async function me(n){const a=await H(n).catch(i=>{});if(a&&a.data)return a.data}function pe(n){const a=[];for(let i=0;i<360;i++){const e=Cesium.Math.toRadians(i),u=new Cesium.Cartesian2(n*Math.cos(e),n*Math.sin(e));a.push(u)}return a}async function de(n,a,i){return a.forEach(e=>{const u=e.geometry.coordinates,l=u[0],t=u[1],o=e.properties,g=o.管线编,b=o.起点高,d=o.终点高,v=parseFloat(o.管径)/1e3,p=o.图层;i.set(g,[{name:"管线编号",value:o.管线编},{name:"类型",value:o.图层},{name:"材质",value:o.材质},{name:"长度",value:o.长度},{name:"位置",value:o.所在道},{name:"起点埋",value:o.起点埋},{name:"终点埋",value:o.终点埋},{name:"管径",value:o.管径}]);const m=ue(p),f=new Cesium.PolylineVolumeGeometry({polylinePositions:Cesium.Cartesian3.fromDegreesArrayHeights([l[0],l[1],b,t[0],t[1],d]),shapePositions:pe(v)}),I=Cesium.PolylineVolumeGeometry.createGeometry(f),P=new Cesium.GeometryInstance({geometry:I,id:g,attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(m)}}),y=new Cesium.PerInstanceColorAppearance({flat:!0,translucent:!1}),h=new Cesium.Primitive({geometryInstances:P,appearance:y,asynchronous:!1});n.add(h)}),n}async function fe(n){const a=await H(n).catch(i=>{});if(a&&a.data)return a.data}const ge=new Cesium.Material({fabric:{type:"Image",uniforms:{image:"img/jing2.png"}}}),ve=new Cesium.Material({fabric:{type:"Image",uniforms:{image:"bizi.png"}}}),k=899e-8/2,Ce=new Cesium.MaterialAppearance({material:ge,faceForward:!1}),we=new Cesium.MaterialAppearance({material:ve,faceForward:!0}),be=new Cesium.Material({fabric:{type:"Color",uniforms:{color:new Cesium.Color(1,1,0,1)}}});new Cesium.MaterialAppearance({material:be});async function ye(n,a,i){const e=[],u=[];if(a.forEach(l=>{const t=l.properties,o=t.ID;t.图层,t.埋深;const g=t.井底高,b=t.地面高;let v=t.附属物==="篦子";i.set(o,[{name:"编号",value:t.ID},{name:"类型",value:t.图层},{name:"特征",value:t.特征},{name:"地面高程",value:t.地面高},{name:"井底高程",value:t.井底高},{name:"埋设方法",value:t.埋设方}]);const p=l.geometry.coordinates;let m;v?m=new Cesium.RectangleGeometry({rectangle:Cesium.Rectangle.fromDegrees(p[0]-k,p[1]-k,p[0]+k,p[1]+k),height:b+.2}):m=new Cesium.CircleGeometry({center:Cesium.Cartesian3.fromDegrees(p[0],p[1]),radius:1,height:b+1,extrudedHeight:g});const f=new Cesium.GeometryInstance({id:o,geometry:m});v?e.push(f):u.push(f)}),e.length>0){const l=new Cesium.Primitive({geometryInstances:e,appearance:we,asynchronous:!0});l.disableDepthTestDistance=99e3,n.add(l)}if(u.length>0){const l=new Cesium.Primitive({geometryInstances:u,appearance:Ce,asynchronous:!0});l.disableDepthTestDistance=99e3,n.add(l)}}async function S(n,a=10){const i=n.features.length,e=Math.ceil(i/a),u=new Array;let l=0,t=a;for(let o=1;o<=e;o++)t=o*a,t>=i&&(t=i-1),u.push(n.features.slice(l,t)),l=t;return u}const he={class:"toolbarLine"},Pe=B({__name:"PipelineWidget",setup(n){const a=K();let i;ee(()=>{i!==void 0&&(clearTimeout(i),a.loading.hide())});let e;const u=w(!1),l=w(!1),t=w(!1),o=w("0px"),g=w("0px"),b=[{name:"name",label:"属性名",align:"left",field:"name"},{name:"value",align:"center",label:"值",field:"value"}],d=w([]),v=w({rowsPerPage:0});function p(){return x.CesiumViewer&&(e||(e=x.CesiumViewer)),e}let m,f=!0,I,P;const y=new Map,h=new Map,U=new Cesium.Material({fabric:{type:"Image",uniforms:{image:"img/red.png"}}});new Cesium.MaterialAppearance({material:U,faceForward:!1});let _;function T(){m&&(m.primitive&&(f?m.primitive.appearance=new Cesium.PerInstanceColorAppearance({flat:!0,translucent:!1}):m.primitive.appearance=_),e.scene.requestRender(),m=void 0)}I||me("data/line_4490.json").then(c=>{I=c,q(c)});async function q(c){y.clear();const s=await S(c,100);c=void 0;const r=s.length;for(let C=0;C<r;C++){const D=s[C],A=new Cesium.PrimitiveCollection;e.scene.primitives.add(A),de(A,D,y)}}P||fe("data/point_4490.json").then(async c=>{P=c,W(P)});async function W(c){h.clear();const s=await S(c,200),r=s.length;for(let C=0;C<r;C++){const D=s[C],A=new Cesium.PrimitiveCollection;e.scene.primitives.add(A),ye(A,D,h)}}let M;a.loading.show({message:"正在加载3万多管线数据，请稍等……"}),i=setTimeout(()=>{e&&e.scene.requestRender(),a.loading.show({messageColor:"black",backgroundColor:"white",message:"正在渐进式渲染点数据……"}),i=setTimeout(()=>{a.loading.hide(),i=void 0},5e3)},7e3),ae(()=>{p(),e?.flyToPosition(new se(116.2698,36.3475,203,5.69,-26.2,360)),M=new Cesium.ScreenSpaceEventHandler(e.scene.canvas),M.setInputAction(async function(c){const s=c.position;var r=e.scene.pick(c.position);r?(t.value=!1,g.value=s.y+"px",o.value=s.x+"px",m&&T(),m=r,setTimeout(()=>{t.value=!0},50),r.id.length>10?(f=!0,r.primitive.appearance=new Cesium.MaterialAppearance({material:Cesium.Material.fromType("Color"),faceForward:!0}),r.primitive.appearance.material.uniforms.color=new Cesium.Color(1,0,0,1),e.scene.requestRender(),y.size>0&&(d.value=[],d.value=y.get(r.id))):(_=r.primitive.appearance,e.scene.requestRender(),f=!1,h.size>0&&(d.value=[],d.value=h.get(r.id)))):(t.value=!1,T())},Cesium.ScreenSpaceEventType.LEFT_CLICK)}),te(()=>{M&&M.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK),e&&e.scene.primitives.removeAll()});function $(c,s){e&&(e.scene.globe.depthTestAgainstTerrain=c,e.scene.requestRender())}function j(c,s){e&&(c?X():Y(),e.scene.requestRender())}function X(){e.scene.screenSpaceCameraController.enableCollisionDetection=!1,e.scene.globe.translucency.enabled=!0,e.scene.globe.translucency.frontFaceAlphaByDistance=new Cesium.NearFarScalar(400,.5,8e3,.9)}function Y(){e.scene.screenSpaceCameraController.enableCollisionDetection=!0,e.scene.globe.translucency.enabled=!1}return(c,s)=>(N(),G(ie,null,[F(ce,{isShown:t.value,leftX:o.value,topY:g.value},{content:E(()=>[F(z,{pagination:v.value,"onUpdate:pagination":s[0]||(s[0]=r=>v.value=r),title:"属性表",rows:d.value,columns:b,"row-key":"name",dense:!0},null,8,["pagination","rows"])]),_:1},8,["isShown","leftX","topY"]),ne("div",he,[F(V,{modelValue:u.value,"onUpdate:modelValue":[s[1]||(s[1]=r=>u.value=r),$],label:"地形深度检测"},null,8,["modelValue"]),F(V,{modelValue:l.value,"onUpdate:modelValue":[s[2]||(s[2]=r=>l.value=r),j],label:"地下模式"},null,8,["modelValue"])]),s[3]||(s[3]=oe('<div class="legendPanel" data-v-0bd19625><b data-v-0bd19625>管线图例：</b><ul data-v-0bd19625><li style="background-color:#00FFFF;" data-v-0bd19625>给水管：#00FFFF </li><li style="background-color:#FF6347;" data-v-0bd19625>热力 : #FF6347</li><li style="background-color:#FFA500;" data-v-0bd19625>天然气 :#FFA500</li><li style="background-color:#000000;color:#fff;" data-v-0bd19625>污水管 :#000000 </li><li style="background-color:#8B4513;" data-v-0bd19625>雨水管 :#8B4513</li><li style="background-color:#9932CC;" data-v-0bd19625>交通信号 :#9932CC</li><li style="background-color:#4682B4;" data-v-0bd19625>其他 :#4682B4 </li></ul></div>',1))],64))}}),xe=O(Pe,[["__scopeId","data-v-0bd19625"]]);export{xe as default};
