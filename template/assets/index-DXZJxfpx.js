import{d as G,V as W,O as J,i as K,j as X,k as Q,a1 as Z,M as $,a2 as S,e as ee,aa as ae}from"./quasar-exp-BsaNoQ7w.js";import{A as te,P as ne,T as oe}from"./TopFunBar-DoB4Gx3Q.js";import{B as le}from"./BaseContent-Bj_GXZNN.js";import{b as re,i as ie,j as se,_ as ce}from"./index-BQ7ovaqR.js";import{q as ue,h as de,B as c,p as fe}from"./xframelib-exp-CMLeiWD4.js";import{T as R}from"./TableEvent-Bxu_GHGl.js";import{d as me}from"./WidgetsTool-TGcRel5R.js";import{r as d,d as pe,c as U,w as ge,o as be,a as ve,b as p,f as C,a4 as l,j as i,k as we,e as y,F as ye,ab as he,ac as Pe,a7 as ke,v as _e,l as Me,a1 as Se}from"./@vue-exp-Bws36Ke9.js";import{S as x}from"./StudentService-DlLAObFe.js";import{G as Ce}from"./ApiExampleDemo-fezgN7i-.js";import"./vendor-DJm_4oaR.js";import"./lottie-web-exp-CIY4INm7.js";import"./monaco-editor-exp-BNK_u0iZ.js";import"./vue-router-exp-CO9L2VdX.js";import"./xgis-cesium-exp-Hv7oMXHX.js";import"./axios-exp-C7rfqWEd.js";import"./@iconify/vue-exp-Q9Q0SWJB.js";const xe=[{value:"preview",name:"查看",icon:"ant-design:eye-outlined"},{value:"upload",name:"上传档案",icon:"ant-design:upload-outlined"},{value:"edit",name:"编辑",icon:"ant-design:form-outlined"},{value:"delete",name:"删除",icon:"ant-design:delete-outlined",isdelete:!0}],De=[{name:"查看关联对象",icon:"ant-design:apartment-outlined",value:"relateView"},{name:"发布服务",icon:"ant-design:aim-outlined",value:"publishService"},{name:"附件清理",icon:"ant-design:clear-outlined",value:"clearProfile"}];function Ae(){return xe}function Be(){return De}const L=[{name:"id",align:"center",label:"索引",field:"id",sortable:!0},{name:"name",align:"center",label:"姓名",field:"name"},{name:"age",align:"center",label:"年龄",field:"age",sortable:!0},{name:"picture",required:!0,label:"照片",align:"center",field:"picture"},{name:"profile",required:!0,label:"档案",align:"center",field:"pid"},{name:"modifytime",required:!0,label:"更新时间",align:"center",field:"lastModified",format:u=>u?G.formatDate(u,"YYYY-MM-DD"):"无",sortable:!0},{name:"opt",align:"center",label:"操作",field:"opt"}],V=d([]);L.forEach(({name:u})=>{V.value.push(u)});class Te{hproseProxyClient;constructor(r){r===void 0?this.hproseProxyClient=ue.getDefaultClient():this.hproseProxyClient=r}async SaveProfileInfoAsync(r){return await(await this.hproseProxyClient.getHproseProxy())?.SaveProfileInfoAsync(r)}async DeleteProfilesAsync(r){return await(await this.hproseProxyClient.getHproseProxy())?.DeleteProfilesAsync(r)}}const q=new Te,Fe=pe({name:"StandardTable",__name:"index",setup(u,{expose:r}){r();const g=re(),e=U(()=>g.showTabMenu?"padding-bottom: 30px;":""),b=d({sortBy:"id",descending:!1,page:1,rowsPerPage:10}),m=d(1),t=d(0),f=U(()=>Math.ceil(t.value/b.value.rowsPerPage)),h=d(""),P=d([]),k=d("");ge(()=>m.value,a=>{s()});let w="";const _=d(null);async function N(a){const n=a[0],o=n.name,v=await de.readFileBytes(n),E=await q.SaveProfileInfoAsync({id:"",file:v,name:o,studentid:w});if(_.value?.reset(),E){c.Message.info("档案上传成功！"),s();return}c.Message.info("档案上传失败！")}async function D(a){if(!a){c.Message.info("不存在附件文件");return}await q.DeleteProfilesAsync([a])?(c.Message.info("清理成功！"),s()):c.Message.info("清理失败！")}function M(a,n){let o="",v;switch(a){case"add":o="addEditForm3",v={title:"新建",footer:"true"};break;case"edit":o="addEditForm3",v={title:"编辑",footer:"true"};break}o&&me({modalID:o,extraData:v,rowData:n,width:700})}function z(a){return[...Ae()]}function j(a){return Be()}const H=(a,n)=>{switch(c.Logger().trace("表格菜单点击",a,n),a){case"preview":break;case"upload":w=n.id,_.value?.pickFiles();break;case"edit":F(n);break;case"delete":x.DeleteStudentsAsync([n.id]).then(o=>{s(),c.Message.info("删除成功")}).catch(o=>{c.Message.info("删除出现异常")});break;case"clearProfile":D(n.pid);break}},O=(a,n)=>{switch(a){case"searchWord":k.value=n,s();break;case"creatNew":T();break;case"batchDelete":B();break;case"refresh":s();break}},A=d([]);async function s(a=void 0){a&&(a.page&&(m.value=a.page),a.pageSize&&(b.value.rowsPerPage=a.pageSize));const n=await x.GetStudentListAsync("",k.value,m.value,b.value.rowsPerPage).catch(o=>{});n&&(t.value=n.totalCount,A.value=n.datas),m.value>f.value&&(m.value=f.value)}async function B(){if(P.value.length>0){const a=P.value.map(o=>o.id);await x.DeleteStudentsAsync(a).catch(o=>(c.Message.info("删除出现异常"),!1))&&(s(),c.Message.info("删除成功"))}}function T(){M("add",{name:"",age:10})}function F(a){M("edit",a)}async function Y(a,n){const o=await Ce(a);o&&o.response?.status==200&&o.data&&fe(o.data,n)}be(()=>{ie(R.RefeshTable,s),s()}),ve(()=>{se(R.RefeshTable,s)});const I={appState:g,sizeStyle:e,pagination:b,currentPage:m,rowSum:t,pagesNumber:f,filter:h,selected:P,keywordRef:k,get currentSelectId(){return w},set currentSelectId(a){w=a},profileUploader2:_,UploadFileToProfile:N,ClearProfile:D,showModal:M,getRightDefaultMenus:z,getRightMoreMenus:j,doActionClick:H,topBarClick:O,rows:A,query:s,batchDelete:B,add:T,edit:F,doDowload:Y,ActionMenu:te,BaseContent:le,get columns(){return L},get visibleColumns(){return V},PaginationLine:ne,TopFunBar:oe};return Object.defineProperty(I,"__isScriptSetup",{enumerable:!1,value:!0}),I}}),Ie=["src"],Ee={key:1},Qe={key:1},Re={class:"full-width row justify-end"};function Ue(u,r,g,e,b,m){return p(),C(e.BaseContent,{class:"q-pa-sm",style:Se(e.sizeStyle)},{default:l(()=>[i(W,{class:"fit sticky-header-table",selection:"multiple",selected:e.selected,"onUpdate:selected":r[1]||(r[1]=t=>e.selected=t),dense:u.$q.screen.lt.md,separator:"cell",flat:"",bordered:"",rows:e.rows,filter:e.filter,columns:e.columns,"row-key":"name","visible-columns":e.visibleColumns,pagination:e.pagination,"onUpdate:pagination":r[2]||(r[2]=t=>e.pagination=t)},{top:l(t=>[i(e.TopFunBar,{target:t,batch:e.selected.length===0,title:"服务列表",onTopBarClick:e.topBarClick},{rightAppend:l(()=>[we(i(J,{outlined:"",label:"自选列",icon:"view_list","no-wrap":""},{default:l(()=>[i(K,null,{default:l(()=>[(p(!0),y(ye,null,he(e.columns,f=>(p(),C(X,{tag:"label",key:f.name},{default:l(()=>[i(Q,{avatar:""},{default:l(()=>[i(Z,{modelValue:e.visibleColumns,"onUpdate:modelValue":r[0]||(r[0]=h=>e.visibleColumns=h),val:f.name},null,8,["modelValue","val"])]),_:2},1024),i(Q,null,{default:l(()=>[i($,null,{default:l(()=>[Pe(ke(f.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},512),[[_e,u.$q.screen.gt.sm]])]),_:2},1032,["target","batch"])]),"body-cell-picture":l(t=>[i(S,{props:t},{default:l(()=>[t.row.picture?(p(),y("img",{key:0,src:t.row.picture,width:"80",height:"80"},null,8,Ie)):(p(),y("span",Ee,"暂无"))]),_:2},1032,["props"])]),"body-cell-profile":l(t=>[i(S,{props:t},{default:l(()=>[t.row.pid?(p(),C(ee,{key:0,label:"下载档案",color:"primary",onClick:f=>e.doDowload(t.row.id,t.row.pname)},null,8,["onClick"])):(p(),y("span",Qe,"暂无"))]),_:2},1032,["props"])]),"body-cell-opt":l(t=>[i(S,{props:t,"auto-width":!0},{default:l(()=>[i(e.ActionMenu,{currentRow:t.row,onDoActionClick:e.doActionClick,"default-menus":e.getRightDefaultMenus(t.row),"append-menus":e.getRightMoreMenus(t.row)},null,8,["currentRow","default-menus","append-menus"])]),_:2},1032,["props"])]),bottom:l(()=>[Me("div",Re,[i(e.PaginationLine,{"rows-number":e.rowSum,"rows-per-page":e.pagination.rowsPerPage,max:e.pagesNumber},null,8,["rows-number","rows-per-page","max"])])]),_:1},8,["selected","dense","rows","filter","columns","visible-columns","pagination"]),i(ae,{ref:"profileUploader2","max-files":1,class:"hidden",accept:".doc, .docx, .pdf","field-name":"file",onAdded:e.UploadFileToProfile},null,512)]),_:1},8,["style"])}const aa=ce(Fe,[["render",Ue],["__file","index.vue"]]);export{aa as default};
