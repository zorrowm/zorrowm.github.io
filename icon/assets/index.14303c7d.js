import{d as L,u as M,c as T,e as U,h as A,_ as $}from"./index.a7a016cc.js";import{L as u,M as B,d as V,j as q,m as P}from"./xframelib-exp.abb6dc89.js";import{b as K,u as W}from"./vue-router-exp.aea90ceb.js";import{d as j,r as x,a as f,y as N,o as O,b as z,g as t,D as w,A as C,ab as y,ac as G}from"./vendor.fba62f44.js";import{_ as H}from"./logo.c922a61e.js";import"./@iconify/vue-exp.2703a4cd.js";import"./lodash-es-exp.5cb72cd8.js";import"./axios-exp.a055fae1.js";const J=j({setup(){const e=x({username:"",password:""}),s=f(),p=f(),h=f("");h.value=u.Config.UI?.SiteTitle;const F=f("");F.value=u.Config.UI?.CopyRight;const n=K(),o=W();let i=decodeURIComponent(o.query?.redirect||"/back");const D=B();let m;if(D){V(),n&&n.replace(i).then(v=>{o.name=="login"&&n.replace("/back")});return}let c=!0;const S=async()=>{if(!c){u.Logger().debug("\u9891\u7E41\u70B9\u51FB\u767B\u5F55******");return}if(c=!1,e.username.trim()===""||e.password.trim()=="")return setTimeout(()=>{c=!0},2e3),u.Message?.warn("\u7528\u6237\u540D\u6216\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A\uFF01");let v={username:e.username.trim(),pwd:e.password.trim()};const r=await q(v).catch(a=>{u.Message?.warn(`\u767B\u5F55\u5931\u8D25:${a.message}!`),c=!0});if(r){const a=M();a.init(r),u.User=a.id;const R=T(),I=a.DefaultMaxRoleLevel===0;let _=!0;const b=await P(R,I).catch(l=>{_=!1,u.Message?.err("\u8BE5\u7CFB\u7EDF\u672A\u6CE8\u518C\uFF01")});if(c=!0,!_)return;if(u.Logger().debug(b,"\u767B\u5F55\u540E\u7684\u7CFB\u7EDF\u6743\u9650"),b){const l=U();u.Logger().debug(l,"\u7CFB\u7EDF\u8DEF\u7531\u6743\u9650");let g;l?.forEach(k=>{g||(g=k),n.addRoute(k)}),g&&A(n,g)}else{u.Message?.warn(e.username+"\u65E0\u7CFB\u7EDF\u6743\u9650\uFF0C\u65E0\u6CD5\u767B\u5F55\uFF01");return}const d=decodeURIComponent(o.query?.redirect||"/back");if(n)if(u.Logger().debug(d,"toPath"),d.startsWith("http://")||d.startsWith("https://")){const l=B();window.open(d+"#/?tk="+l.token,"_self")}else n.replace(d).then(l=>{o.name=="login"&&n.replace("/back")});u.Message?.msg("\u767B\u5F55\u6210\u529F")}};N(async()=>{if(m=void 0,i&&(m=o.query?.tk?.toString()),m&&await L(m)){const r=B();r&&(i?.indexOf("?")>0?i+="&tk="+r.token:i+="?tk="+r.token,n.replace(i).then(a=>{o.name=="login"&&n.replace("/")}))}});function E(){s.value&&(s.value.placeholder="\u8BF7\u8F93\u5165\u8D26\u53F7"),p.value&&(p.value.placeholder="\u8BF7\u8F93\u5165\u5BC6\u7801")}return{formState:e,systemTitle:h,handleSubmit:S,onblur:E,nameInput:s,pwdInput:p,copyRightInfo:F}}}),Q=""+new URL("../img/login/name.png",import.meta.url).href,X=""+new URL("../img/login/password.png",import.meta.url).href,Y={class:"container"},Z={class:"login-logo"},ee=t("img",{src:H,alt:""},null,-1),te={class:"login-title"},se={class:"login"},oe=t("div",{class:"login-top"},"\u7528\u6237\u767B\u5F55",-1),ue={class:"login-center clearfix"},ne=t("div",{class:"login-center-img"},[t("img",{src:Q})],-1),ie={class:"login-center-input"},re=t("div",{class:"login-center-input-text"},"\u8D26\u53F7",-1),ae={class:"login-center clearfix"},le=t("div",{class:"login-center-img"},[t("img",{src:X})],-1),ce={class:"login-center-input"},de=t("div",{class:"login-center-input-text"},"\u5BC6\u7801",-1),pe={class:"login-copyright"};function me(e,s,p,h,F,n){return O(),z("div",Y,[t("div",Z,[ee,t("span",te,w(e.systemTitle),1)]),t("div",se,[oe,t("div",ue,[ne,t("div",ie,[C(t("input",{ref:"nameInput",type:"text",placeholder:"\u8BF7\u8F93\u5165\u8D26\u53F7",onfocus:"this.placeholder=''",onBlur:s[0]||(s[0]=o=>e.onblur()),"onUpdate:modelValue":s[1]||(s[1]=o=>e.formState.username=o)},null,544),[[y,e.formState.username]]),re])]),t("div",ae,[le,t("div",ce,[C(t("input",{ref:"pwdInput",type:"password",placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801",onfocus:"this.placeholder=''",onBlur:s[2]||(s[2]=o=>e.onblur()),"onUpdate:modelValue":s[3]||(s[3]=o=>e.formState.password=o),onKeyup:s[4]||(s[4]=G((...o)=>e.handleSubmit&&e.handleSubmit(...o),["enter"]))},null,544),[[y,e.formState.password]]),de])]),t("div",{class:"login-button",onClick:s[5]||(s[5]=(...o)=>e.handleSubmit&&e.handleSubmit(...o))}," \u767B\u5F55 ")]),t("div",pe,w(e.copyRightInfo),1)])}const ke=$(J,[["render",me]]);export{ke as default};
