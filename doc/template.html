<!DOCTYPE html><html><head>
      <title>vue-widget-quasar-clivite-template技术交流</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:///c:\Users\zorro\.vscode\extensions\shd101wyy.markdown-preview-enhanced-0.8.15\crossnote\dependencies\katex\katex.min.css">
      
      
      
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<h1 id="vue-widget-quasar-clivite-template技术交流">vue-widget-quasar-clivite-template技术交流 </h1>
<blockquote>
<p>vue-widget-quasar-clivite-template核心是基于VUE的Widget机制开发框架，使用quasar作为UI库，通过quasar-cli和Vite结合方式进行前端工程编译打包。</p>
</blockquote>
<p>​	与现在的vue-widget-tempalte相比较，目录组织机构相同（views改为pages)，Widget插件机制相同，只是在UI库方面由AntDesign转为Quasar，打包编译配置和插件基本相同，都利用了vite。</p>
<h2 id="主要优势">主要优势 </h2>
<ul>
<li>基于项目经验积累的与界面无关的前端基础库xframelib</li>
<li>Layout多层次布局（上下左右，中间前后三层）</li>
<li>Widget动态加载卸载、可配置可复用机制</li>
<li>WidgetMenu可配置菜单机制</li>
<li>基于Iconify标准的在线图标和离线图标</li>
<li>系统路由MenuRoutes.json自动生成与手动注册/更新</li>
<li>统一的用户角色权限控制</li>
<li>内部已经积累的组件、指令和布局模版（后台、大屏、门户等）</li>
<li>配套积累常用代码片段CodeSnippets</li>
<li>Quasar更强大UI和样式适配特性</li>
</ul>
<h2 id="为什么选择quasar">为什么选择Quasar </h2>
<ol>
<li><strong>官方理由：</strong></li>
</ol>
<ul>
<li>基于Vue.js</li>
<li>开箱即用的提供给<strong>网站</strong>和<strong>应用程序</strong>的最先进的UI（遵循《Material指南》）</li>
<li>开箱即用的对桌面和<strong>移动浏览器</strong>（包括iOS Safari！）的最佳支持</li>
<li>通过与我们自己的CLI紧密集成，对每种构建模式（SPA、SSR、PWA、移动应用程序、桌面应用程序和浏览器扩展）提供了一流的支持，并提供了最佳的开发人员体验</li>
<li>易于自定义（CSS）和可扩展（JS）</li>
<li>这是最注重性能的框架</li>
<li>自动tree shaking</li>
</ul>
<hr>
<ol start="2">
<li><strong>个人理由：</strong></li>
</ol>
<ul>
<li>
<p>AntDesign仅仅是个好用的Web组件UI库，但Quasar不仅有组件且兼容支持Web、移动应用程序、桌面应用程序和浏览器扩展（一体化解决），而且有指令、组合函数、插件等。</p>
<p><img src="./data/quasar%E5%86%85%E5%AE%B9.png" alt="quasar内容.png"></p>
</li>
<li>
<p>Quasar组件粒度小，大部分组件可以互相嵌套灵活组合，形成万变变化（类似积木）</p>
</li>
<li>
<p>Quasar自带常用/好用的间距、阴影、断点以及可见性和定位等样式，特别是断点广泛适用，大大降低多屏适配的工作量</p>
</li>
<li>
<p>Quasar指令超级实用好用</p>
<p><img src="./data/quasar%E6%8C%87%E4%BB%A4.png" alt="quasar指令.png"></p>
</li>
</ul>
<h2 id="xframelib前端基础库">XFramelib前端基础库 </h2>
<blockquote>
<p>基于 VUE3+Hprose+Typescript 的前端框架，与ElementUI、AntDesign VUE等界面库无关，一直是来源于项目和服务于项目。</p>
</blockquote>
<p><img src="./data/xframelib.png" alt="xframelib.png"></p>
<ul>
<li>
<p>网站系统配置Sysconfig.js对应的Global.Config</p>
</li>
<li>
<p>公共事件总线Global.EventBus</p>
</li>
<li>
<p>整体系统日志Global.Logger()</p>
</li>
<li>
<p>Layout布局容器和Widget机制实现</p>
</li>
<li>
<p>Axios的Http请求封装实现Global.Axios、AxiosHelper{get, post, requestPost, requestGet, getData, requestPostBody}</p>
</li>
<li>
<p>Hprose Proxy方式调用后台Hprose服务实现</p>
</li>
<li>
<p>与用户系统后台服务适配的Token验证/刷新和角色权限过滤</p>
</li>
<li>
<p>大文件下载BigFileDownload</p>
</li>
<li>
<p>普通文件下载FileDownload封装{ Download, SaveAs, JsonDownload, HttpDownload, DownloadByUrl }</p>
</li>
<li>
<p>大文件上传FileUpload</p>
</li>
<li>
<p>H5Tool常用小功能</p>
</li>
<li>
<p>SignalrClient</p>
</li>
<li>
<p>JQuery工具 （hasClass 、addClass、removeClass、toggleClass、setCssProperty）</p>
</li>
<li>
<p>StorageHelper 本地缓存对象</p>
</li>
<li>
<p>IsTool类型判断工具（数字、字符串、对象、数组、函数等）</p>
</li>
<li>
<p>ValidateTool验证工具（身份证、手机号、IP地址、邮箱、密码强度判断、URL、车牌号等）</p>
</li>
<li>
<p>与后端配合使用的加密解密算法XXTEA</p>
</li>
</ul>
<h2 id="vue-widget-quasar开发模板">vue-widget-quasar开发模板 </h2>
<h3 id="初始配置">初始配置 </h3>
<p>npm install 后需要对@quasar/app-vite的vite版本进行单独升级（默认版本太旧）</p>
<p>quasar-vite升级.png<img src="./data/quasar-vite%E5%8D%87%E7%BA%A7.png" alt="quasar-vite升级.png"></p>
<h3 id="目录结构">目录结构 </h3>
<img src="./data/目录结构.png" alt="目录结构.png" style="zoom: 80%;">
<p>--public  不打包全局资源</p>
<p>​	--css 公共全局样式</p>
<p>​	--img 图片资源<br>
​	--js  js库</p>
<p>​	--SysConfig.js 网站系统配置，主要</p>
<p>--src</p>
<p>​	--actions</p>
<p>​	--api  根据后台WebAPI服务自动生成的前端代码</p>
<p>​	--assets 图片和css等资源（参与打包）</p>
<p>​	--boot 系统初始化、挂接全局资源的（不用修改）</p>
<p>​	--components 自带的通用基础组件</p>
<p>​	--composables 类似VueUse库包装</p>
<p>​	--css   css变量；主题CSS</p>
<p>​	--directives 积累的指令</p>
<p>​	--enums  枚举变量</p>
<p>​	--enents 定义各类事件，按模块划分组织</p>
<p>​	--examples 自带组件使用示例</p>
<p>​	--layouts 各种布局页面，每个布局也都优先使用基于<layoutcontainer>方式</layoutcontainer></p>
<p>​	--models公共模型对象</p>
<p>​	--netAPI 网络服务AIP调用，IP查询、QQ定位、天气状况</p>
<p>​	--pages 按布局layout名称定义不同的文件夹，组织视图页面</p>
<p>​	--permission 角色权限过滤的相关方法</p>
<p>​	--router 按布局layouts名划分组织定义路由；路由守卫</p>
<p>​	--service  通过后台hprose服务生成的业务服务TS代码</p>
<p>​	--settings  设置项，modal对话框设置，widgetMenu设置，widget设置，函数设置，project设置</p>
<p>​	--stores    按业务模块组织pinia 公共数据层</p>
<p>​	--utils  通用工具方法</p>
<p>​	--widgets 按Layout名定义不同的文件夹，组织业务组件Widgets</p>
<p>​        --workers 编写异步函数方法，都会编译成一个webworke</p>
<h3 id="sysconifgjs解析">SysConifg.js解析 </h3>
<p>SysConfig.js是在XFramelib初始化时全局挂接到 Global.Config对象上的,对应模型为ISystemConfig，<strong><u>一二级配置项都具有自定义扩展能力。</u></strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-export">export</span> <span class="token keyword keyword-interface">interface</span> <span class="token class-name">ISystemConfig</span> <span class="token punctuation">{</span>
  <span class="token doc-comment comment">/**
   * 用户界面配置
   */</span>
  <span class="token constant">UI</span><span class="token operator">:</span> IUIObject<span class="token punctuation">;</span>
  <span class="token doc-comment comment">/**
   * 服务URL
   */</span>
  ServiceURL<span class="token operator">:</span> IServiceURL<span class="token punctuation">;</span>
  <span class="token doc-comment comment">/**
   * 地图相关Keys
   */</span>
  MapKeys<span class="token operator">?</span><span class="token operator">:</span> IMapKeys<span class="token punctuation">;</span>
  <span class="token doc-comment comment">/**
   * API服务路径
   */</span>
  APIPath<span class="token operator">?</span><span class="token operator">:</span> object<span class="token punctuation">;</span> <span class="token comment">//</span>
  <span class="token comment">//其他配置信息</span>
  <span class="token punctuation">[</span>props<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>UI为默认系统界面相关配置，对应模型为IUIObject,选项具有可扩展能力。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-export">export</span> <span class="token keyword keyword-interface">interface</span> <span class="token class-name">IUIObject</span> <span class="token punctuation">{</span>
  <span class="token doc-comment comment">/**
   * 网站标题
   */</span>
  SiteTitle<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token doc-comment comment">/**
   * 系统的所属组名
   */</span>
  Group<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token doc-comment comment">/**
   * 版权
   */</span>
  CopyRight<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> <span class="token comment">//'Copyright ©XXX  2021-2025',</span>
  <span class="token doc-comment comment">/**
   * 官方链接
   */</span>
  WebSite<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> <span class="token comment">//网站链接</span>
  <span class="token doc-comment comment">/**
   * 超时锁屏时间(单位：秒s)
   * 自动锁屏时间，为0不锁屏。
   */</span>
  LockTime<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> <span class="token comment">//</span>
  <span class="token doc-comment comment">/**
   * 是否是能访问互联网，还是内网部署应用
   * */</span>
  IsInternet<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>

  <span class="token doc-comment comment">/**
   * 网站灰色模式，用于可能悼念的日期开启
   * 默认为false
   */</span>
  GrayMode<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>

  <span class="token doc-comment comment">/**
   * 其他扩展的属性
   */</span>
  <span class="token punctuation">[</span>props<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>ServiceURL 为默认后台服务地址配置，可自定义扩展字段。</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-export">export</span> <span class="token keyword keyword-interface">interface</span> <span class="token class-name">IServiceURL</span> <span class="token punctuation">{</span>
  <span class="token doc-comment comment">/**
   * 用户登录验证服务（统一用户登录:后台）
   */</span>
  LoginAuthURL<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> <span class="token comment">//用户验证</span>
  <span class="token doc-comment comment">/**
   * 用户登录界面（统一用户登录界面:前台）
   */</span>
  UILoginURL<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span><span class="token comment">//用户登录界面</span>
  <span class="token doc-comment comment">/**
   * 文件管理服务地址（统一文件管理：后台）
   */</span>
  FileServiceURL<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> <span class="token comment">//文件管理</span>
  <span class="token doc-comment comment">/**
   * 文件管理（统一文件管理：前台）
   */</span>
  UIFileURL<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> <span class="token comment">//文件管理，在线</span>
  <span class="token doc-comment comment">/**
   * 在线日志服务（统一日志记录）
   */</span>
  LogServiceURL<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token doc-comment comment">/**
   * 图标在线服务地址
   */</span>
  IconServiceURL<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token doc-comment comment">/**
   * Axios普通WebAPI的BaseURL
   * 全局默认的http请求地址（一般与主hprose相同或不同）;文件上传地址
   */</span>
  DefaultWebAPI<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token doc-comment comment">/**
   * 默认HproseAPI的服务地址
   */</span>
  DefaultHproseAPI<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token doc-comment comment">/**
   * 其他扩展的URL属性
   */</span>
  <span class="token punctuation">[</span>props<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>MapKeys 为全局设置地图服务的KEYS,可以单个KEY或数组,对应模型为IMapKeys</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-export">export</span> <span class="token keyword keyword-interface">interface</span> <span class="token class-name">IMapKeys</span> <span class="token punctuation">{</span>
  <span class="token doc-comment comment">/**
   * 天地图Key ,单个或数组
   */</span>
  TDTKey<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token operator">|</span><span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token doc-comment comment">/**
   * MapboxKey ,单个或数组
   */</span>
  MapboxKey<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token operator">|</span><span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token doc-comment comment">/**
   * Cesium Key ,单个或数组
   */</span>
  CesiumKey<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token operator">|</span><span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token doc-comment comment">/**
   * Google地图Key ,单个或数组
   */</span>
  GoogleKey<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token operator">|</span><span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token doc-comment comment">/**
   * 其他扩展的Key属性
   */</span>
  <span class="token punctuation">[</span>props<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>APIPath 为配置API服务的相对路径，与ServiceURL里的选项配合使用，字段名称和值自定义。</p>
<h3 id="系统注册更新">系统注册/更新 </h3>
<p>每个新项目系统要修改package.json的name和version，name和version共同作为唯一确认系统的ID。</p>
<p><img src="./data/packagename.png" alt="packagename.png"></p>
<p>开发模式下，每次系统运行，会在Public目录下生成MenuRoutes.json或 /help/register请求来生成系统元数据JSON。</p>
<p><a href="http://localhost:9000/#/help/register">基于widget Quasar-cli开发模板</a></p>
<p><img src="./data/helpregister.png" alt="helpregister.png"></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>{
  "id": "fbe867c7bd3c208c41791a2e0e38c7fe",
  "name": "基于widget Quasar-cli开发模板",
  "product": "vue-widget-quasar-clivite-template",
  "version": "0.0.1",
  "routes": [
    {
      "path": "/default",
      "name": "DefaultLayout",
      "type": 0,
      "children": [
        {
          "path": "home",
          "name": "home2",
          "title": "首页2",
          "type": 0,
          "index": 1
        },
        {
          "path": "dashboard",
          "name": "dashboard2",
          "title": "仪表盘",
          "type": 0,
          "index": 2,
          "children": [
            {
              "path": "/default/dashboard/welcome",
              "name": "dashboard2-welcome",
              "title": "欢迎",
              "type": 0
            }
          ]
        },
        {
          "path": "http://www.baidu.com",
          "name": "http://www.baidu.com",
          "title": "百度",
          "type": 0,
          "index": 3
        }
      ]
    },
    {
      "path": "/main",
      "name": "Main",
      "title": "主页面布局",
      "type": 1,
      "children": [
        {
          "path": "/main/test",
          "name": "main-test",
          "type": 0,
          "index": 1
        }
      ]
    },
    {
      "path": "/back",
      "name": "BackLayout",
      "title": "",
      "type": 1,
      "children": [
        {
          "path": "dashboard",
          "name": "dashboard",
          "title": "仪表盘",
          "type": 0,
          "index": 1,
          "children": [
            {
              "path": "welcome",
              "name": "dashboard-welcome",
              "title": "欢迎",
              "type": 0
            }
          ]
        },
        {
          "path": "home",
          "name": "home",
          "title": "首页",
          "type": 0,
          "index": 2
        },
        {
          "path": "http://www.baidu.com",
          "name": "http://www.baidu.com",
          "title": "百度",
          "type": 0,
          "index": 3
        }
      ]
    },
    {
      "path": "/bigscreen",
      "name": "bigscreen",
      "title": "",
      "type": 0,
      "children": [
        {
          "path": "/test",
          "name": "test",
          "title": "routes.home",
          "type": 0
        },
        {
          "path": "/test2",
          "name": "test2",
          "title": "routes.home",
          "type": 0
        }
      ]
    }
  ],
  "widgetMenu": [
    {
      "name": "地图工具",
      "index": 1,
      "path": "linkMenuWidget",
      "type": 0,
      "children": [
        {
          "name": "测量工具",
          "path": "flyMenuWidget",
          "type": 0,
          "children": [
            {
              "name": "test1",
              "path": "flyRoamingWidget1",
              "type": 0
            },
            {
              "name": "test2",
              "path": "SimulationWidget2",
              "type": 0
            }
          ]
        },
        {
          "name": "量算工具",
          "path": "measureToolWidget",
          "type": 0
        },
        {
          "name": "标绘工具",
          "path": "drawToolWidget",
          "type": 0
        },
        {
          "name": "态势标绘",
          "path": "plotMapWidget",
          "type": 0
        },
        {
          "name": "截图/视频",
          "path": "photoVideoWidget",
          "type": 0
        }
      ]
    },
    {
      "name": "图层树",
      "index": 2,
      "path": "layerManagerWidget",
      "type": 0
    },
    {
      "name": "专题地图",
      "index": 3,
      "path": "layerManagerWidget",
      "type": 0
    },
    {
      "name": "场景视角",
      "index": 4,
      "path": "layerManagerWidget",
      "type": 0
    },
    {
      "name": "地图特效",
      "index": 5,
      "path": "layerManagerWidget",
      "type": 0
    }
  ],
  "widgets": [
    {
      "id": "HeaderTitleWidget",
      "label": "头部栏",
      "container": 0,
      "preload": true
    },
    {
      "id": "LogoTitleWidget",
      "label": "图标标题",
      "container": 0,
      "preload": true,
      "afterid": "HeaderTitleWidget"
    },
    {
      "id": "FooterCopyrightWidget",
      "label": "底部栏",
      "container": 1,
      "preload": false
    },
    {
      "id": "ModalContainerWidget",
      "label": "弹框容器",
      "container": 0,
      "preload": true
    },
    {
      "id": "SideMenuWidget",
      "label": "左侧菜单",
      "container": 5,
      "preload": true
    },
    {
      "id": "headerTitleWidget",
      "label": "头部栏",
      "container": 0,
      "preload": true
    },
    {
      "id": "bottomMenuWidget",
      "container": 1,
      "preload": true
    },
    {
      "id": "statusWidget",
      "container": 1,
      "preload": true
    },
    {
      "id": "cesiumWidget",
      "container": 2,
      "preload": true
    },
    {
      "id": "menuBarWidget",
      "container": 2,
      "preload": true
    },
    {
      "id": "linkMenuWidget",
      "container": 2,
      "preload": false
    },
    {
      "id": "templateMenuWidget",
      "container": 2,
      "preload": false
    },
    {
      "id": "flyMenuWidget",
      "container": 2,
      "preload": false
    },
    {
      "id": "HeaderTitleWidget",
      "label": "头部栏",
      "container": 0,
      "preload": true
    },
    {
      "id": "FooterCopyrightWidget",
      "label": "底部栏",
      "container": 1,
      "preload": true
    },
    {
      "id": "ModalContainerWidget",
      "label": "弹框容器",
      "container": 0,
      "preload": true
    },
    {
      "id": "LogoTitleWidget",
      "label": "头部栏",
      "container": 0,
      "preload": true
    },
    {
      "id": "TopMenuWidget",
      "label": "头部菜单栏",
      "container": 0,
      "preload": true
    },
    {
      "id": "ModalContainerWidget",
      "label": "弹框容器",
      "container": 0,
      "preload": true
    }
  ]
}
</code></pre><p>登录新版用户系统 <a href="https://gis-auth.digsur.com/">https://gis-auth.digsur.com/</a> 进行系统注册（只有管理员级别用户才有权限）</p>
<p><img src="./data/sysregister.png" alt="sysregister.png"></p>
<h3 id="用户登录与权限控制">用户登录与权限控制 </h3>
<p>用户登录</p>
<p>统一用户登录</p>
<h4 id="外部token验证与跳转">外部token验证与跳转 </h4>
<blockquote>
<p><strong>解决外部传入tk时，优先验证token，实现正确跳转。</strong></p>
<p>即：A系统登录后，带着有效token，直接进入B系统里的使用相关功能</p>
</blockquote>
<p><strong>2024-10-21后开发模板版本，支持跳转的两种模式：</strong></p>
<ul>
<li>
<p>业务路径+token</p>
<p><a href="http://localhost:9001/#**/back/pdfviewer?tk=xxxx">http://localhost:9001/#**/back/pdfviewer?tk=xxxx</a>**</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>http://localhost:9001/#/back/pdfviewer?tk=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1laWRlbnRpZmllciI6IjAwMDY1YTMzLTc5NTEtNDI1MC1iMWIyLWFiN2I4NzFhNGFhMyIsImh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDUvMDUvaWRlbnRpdHkvY2xhaW1zL25hbWUiOiJhZG1pbiIsImh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vd3MvMjAwOC8wNi9pZGVudGl0eS9jbGFpbXMvcm9sZSI6IjAiLCJodHRwOi8vc2NoZW1hcy5taWNyb3NvZnQuY29tL3dzLzIwMDgvMDYvaWRlbnRpdHkvY2xhaW1zL3VzZXJkYXRhIjoiMCIsIm5iZiI6MTcyOTQ5NjQwOCwiZXhwIjoxNzI5NDk3MDA4LCJpc3MiOiJGbHlMb2xvIiwiYXVkIjoiVGVzdEF1ZGllbmNlIn0.AXlIOAGRhZmve4aVuT78pwonJi58ujdaUifV1MEYroU
</code></pre></li>
<li>
<p>login+业务路径+token</p>
</li>
</ul>
<p><a href="http://localhost:9001/#**/login?redirect=/default/pdfviewer&amp;tk=xxxx">http://localhost:9001/#**/login?redirect=/default/pdfviewer&amp;tk=xxxx</a>**</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>http://localhost:9001/#/login?redirect=/default/pdfviewer&amp;tk=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1laWRlbnRpZmllciI6IjAwMDY1YTMzLTc5NTEtNDI1MC1iMWIyLWFiN2I4NzFhNGFhMyIsImh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDUvMDUvaWRlbnRpdHkvY2xhaW1zL25hbWUiOiJhZG1pbiIsImh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vd3MvMjAwOC8wNi9pZGVudGl0eS9jbGFpbXMvcm9sZSI6IjAiLCJodHRwOi8vc2NoZW1hcy5taWNyb3NvZnQuY29tL3dzLzIwMDgvMDYvaWRlbnRpdHkvY2xhaW1zL3VzZXJkYXRhIjoiMCIsIm5iZiI6MTcyOTQ5NzM5MywiZXhwIjoxNzI5NDk3OTkzLCJpc3MiOiJGbHlMb2xvIiwiYXVkIjoiVGVzdEF1ZGllbmNlIn0.fqCiIjL8W518g3J5LyGKVDa668zrVZcp0Jpme6UCO_M

</code></pre><blockquote>
<p>已有开展业务的项目，只需要更新替换src/router/router-guards.ts里的createRouterGuards方法就行：</p>
</blockquote>
<pre data-role="codeBlock" data-info="" class="language-text"><code>export function createRouterGuards(router: Router) {
  let toPath = '';
  const breadcrumbsState = breadcrumbsStore();
  router.beforeEach((to, from, next) =&gt; {
    NProgress.start(); // start progress bar
    const toName = to.name as string;
    toPath = to.path;
    const userState = userStore();
    //获取
    const tokenInfo = getLocalToken();
    if (tokenInfo) {
      const systemRight = getCurrentSystemRight();
      //WM:解决刷新路径时，无法启动定时刷新任务的问题
      if (!Global.User &amp;&amp; userState.id) {
        checkDoRefreshToken();
        //刷新用户的角色权限
        if (toName === 'NotFound') {
          //判断是否加入过权限控制的路由
          if (systemRight &amp;&amp; systemRight.routes &amp;&amp; systemRight.routes.length &gt; 0) {
            const rightRoutes = getRightRoutes();
            if (rightRoutes) {
              //确保获取到路由权限后，赋值全局变量
              Global.User = userState.id;
              let first: RouteRecordRaw;
              rightRoutes.forEach((item) =&gt; {
                if (!first) {
                  first = item;
                }
                router.addRoute(item);
              });
              if (first) checkAddDefaultRoute(router, first);
              //WM:必须的,解决默认名为NotFound
              to.name = undefined;
              next(to);
            }
            return;
          }
        }
      }

      if (toName === 'login') {
        next({ path: defaultRoutePath });
        NProgress.done();
      } else {
        const hasRoute = router.hasRoute(toName);

        // 在免登录名单，直接进入
        if (isSystemRoute(toName) || hasRoute) {
          if (!systemRight &amp;&amp; toName === 'NotFound') {
            //退出登录,当前无法获取到系统权限时
            logout();
            clearRight();
            //跳转到——》登录界面
            next({
              path: loginRoutePath,
              query: { redirect: to.fullPath },
              replace: true
            });
          } else {
            // Global.Logger().info(isSystemRoute(toName)+':'+toName);
            next();
            breadcrumbsState.setBreadcurmbs(to.matched, to.query);
          }
          NProgress.done();
        }
      }
    } else {
      const tokenValue = to.query?.tk?.toString();
      if (tokenValue) {
        //登录验证token
        doTokenCheck(tokenValue).then((checkResult) =&gt; {
          if (checkResult) {
            //WM:请求获取授权，以加载权限模块
            const sysID = getSystemID();
            //是否是超级管理员
            const isSuperLevel = userState.DefaultMaxRoleLevel === 0;
            //获取系统角色权限
            getSystemRoleRight(sysID, isSuperLevel)
              .then(() =&gt; {
                const rightRoutes = getRightRoutes();
                if (rightRoutes) {
                  let first: RouteRecordRaw|undefined=undefined;
                  rightRoutes.forEach((item) =&gt; {
                    if (!first) first = item;
                    router.addRoute(item);
                  });
                  if (first) checkAddDefaultRoute(router, first);
                  //WM:20241021 支持token跳转验证
                  if(to.query.redirect)
                    {
                      const redirectURL=to.query.redirect as string;
                      if(redirectURL.startsWith("http"))
                        {
                          window.open(redirectURL, '_self');
                        }
                        else{
                          console.log('99999999',redirectURL);
                          next({ path: redirectURL });
                        }
                    }
                  else
                  {
                    console.log('888888888',to.path);
                    next({ path: to.path });
                  }

                  return;
                }
              })
              .catch(() =&gt; {
                Global.Message.warn('获取用户功能权限失败！');
                next();
              });
          } else {
            Global.Logger().debug('验证外部的tk参数失败！');
            const rebackURL = Global.Config.ServiceURL.UILoginURL;
            if (rebackURL) { //统一登录界面
              const tofullPath = document.URL;
              window.open(rebackURL + '?redirect=' + tofullPath, '_self');
            } else {
              //内部登录
              let  redirectURL2=to.fullPath;
              if(to.query.redirect)
              {
                  redirectURL2=to.query.redirect as string;
              }
              //#region 登录界面
              next({
                path: loginRoutePath,
                query: { redirect: redirectURL2 },
                replace: true
              });
              //#endregion
            }
            NProgress.done();
          }
        })
      } 
      else{
        // not login
      if (isSystemRoute(toName)) {
        // 在免登录名单，直接进入
        next();
        breadcrumbsState.setBreadcurmbs(to.matched, to.query);
      } else {
        //#region 统一登录验证界面
          //跳转到主网站登录页面
          const rebackURL = Global.Config.ServiceURL.UILoginURL;
          if (rebackURL) {
            const tofullPath = document.URL;
            window.open(rebackURL + '?redirect=' + tofullPath, '_self');
          } else {
            //#region 登录界面
            next({
              path: loginRoutePath,
              query: { redirect: to.fullPath },
              replace: true
            });
            //#endregion
          }

          NProgress.done();
        //#endregion
      }

      }
    }
  });

  router.afterEach((to, from, failure) =&gt; {
    const asyncRouteStoreState = asyncRouteStore();
    //设置网页Title
    document.title = getPageTitle(to.meta.title);
    if (isNavigationFailure(failure)) {
      Global.Logger().debug('failed navigation', failure);
    }
    // 在这里设置需要缓存的组件名称
    const keepAliveComponents = asyncRouteStoreState.keepAliveComponents;
    const currentComName = to.matched.find((item) =&gt; item.name == to.name)?.components?.default.name;
    if (currentComName &amp;&amp; !keepAliveComponents?.includes(currentComName) &amp;&amp; to.meta?.keepAlive) {
      // 需要缓存的组件
      keepAliveComponents.push(currentComName);
    } else if (!to.meta?.keepAlive || to.name == 'Redirect') {
      // 不需要缓存的组件
      const index = asyncRouteStoreState.keepAliveComponents.findIndex((name) =&gt; name == currentComName);
      if (index != -1) {
        keepAliveComponents?.splice(index, 1);
      }
    }
    // store.commit('asyncRoute/setKeepAliveComponents', keepAliveComponents);
    NProgress.done(); // finish progress bar
  });

  router.onError((error) =&gt; {
    Global.Message.err('加载视图错误:' + error.message);
    Global.Logger().debug(error, '路由错误');
    router.push('/error/404');
  });
}
</code></pre><h3 id="在线api代码生成">在线API代码生成 </h3>
<blockquote>
<p><strong>API文件夹、Service文件夹</strong>，前端服务对接代码都是通过后台服务元数据在线生成的。</p>
</blockquote>
<p><img src="./data/serviceTool.png" alt="seviceTool.png"></p>
<ol>
<li>
<p><a href="https://gis-hprosetest.digsur.com/">https://gis-hprosetest.digsur.com/</a>   在线生成Hprose服务代码，放在<u><strong>/src/service</strong></u>文件夹下</p>
<p><a href="https://hprosetest.gis.digsur.com/#/home">https://hprosetest.gis.digsur.com/#/home</a></p>
</li>
</ol>
<p><img src="https://gis-urlnavi.digsur.com/img/menuConfig/hprosetest.png" alt="img"></p>
<ol start="2">
<li>
<p><a href="https://gis-apitest.digsur.com/#/home">https://gis-apitest.digsur.com/#/home</a>   在线生成WebAPI服务代码，放在<u><strong>/src/api</strong></u>文件夹下</p>
<p><a href="https://apitest.gis.digsur.com/#/home">https://apitest.gis.digsur.com/#/home</a></p>
</li>
</ol>
<p><img src="./data/swaggerapi.png" alt="WebAPI"></p>
<h3 id="store使用">store使用 </h3>
<h3 id="用户登录">用户登录 </h3>
<h4 id="1接入统一用户权限管理系统">1.接入统一用户权限管理系统 </h4>
<p>配置用户登录验证URL:<strong>SysConfig.js里ServiceURL项的 <u>LoginAuthURL</u> 属性</strong></p>
<p><img src="./data/loginurl.png" alt="配置用户登录验证URL"></p>
<h4 id="2用户登录密码加密方式">2.用户登录密码加密方式 </h4>
<p>前端使用“XXTEA非对称加密”算法进行加密的。</p>
<h4 id="3-外部后台使用用户系统验证token">3. 外部后台使用用户系统，验证token </h4>
<p><a href="https://auth.gis.digsur.com/swagger/index.html">https://auth.gis.digsur.com/swagger/index.html</a> 的 /api/Token/check方法，如果验证正确token，返回用户信息；如果错误，则报500异常</p>
<p><img src="./data/checktoken.png" alt="验证token"></p>
<h3 id="table表格规范化开发">Table表格规范化开发 </h3>
<blockquote>
<p>参考模版代码为：src/pages/back/StandardTable/index.vue</p>
</blockquote>
<p>下图为表格规范化结构：</p>
<p><img src="./data/tableStruct.png" alt="表格规范化结构"></p>
<ul>
<li>
<p>index.vue为表格所在主页面视图</p>
</li>
<li>
<p>models/TabColummns.ts 为表格相关属性字段定义</p>
</li>
<li>
<p>models/ActionMenus.ts 为表格行操作功能和扩展功能定义</p>
</li>
<li>
<p>modals为表格相关弹框对话框内容，存放不同对话框文件夹</p>
</li>
</ul>
<p>涉及的主要组件为:</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-import">import</span> ActionMenu <span class="token keyword keyword-from">from</span> <span class="token string">"@/components/Menu/ActionMenu.vue"</span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> BaseContent <span class="token keyword keyword-from">from</span> <span class="token string">"src/components/Quasar/BaseContent.vue"</span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> PaginationLine <span class="token keyword keyword-from">from</span> <span class="token string">"@/components/Quasar/TableParts/PaginationLine.vue"</span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> TopFunBar <span class="token keyword keyword-from">from</span> <span class="token string">"@/components/Quasar/TableParts/TopFunBar.vue"</span><span class="token punctuation">;</span>
</code></pre><p>BaseContent ：为通用视图容器</p>
<p>TopFunBar：为顶部表格操作按钮栏</p>
<pre data-role="codeBlock" data-info="vue" class="language-vue vue"><code>      &lt;template #top="table"&gt;
        &lt;TopFunBar :target="table" :batch="selected.length===0" :title="'服务列表'" @topBarClick="topBarClick" &gt;
        &lt;/TopFunBar&gt;
      &lt;/template&gt;
</code></pre><p>PaginationLine：为分页切换栏</p>
<pre data-role="codeBlock" data-info="vue" class="language-vue vue"><code>      &lt;template v-slot:bottom&gt;
        &lt;div class="full-width row  justify-end"&gt;
          &lt;PaginationLine :rows-number="rowSum" :rows-per-page="pagination.rowsPerPage" :max="pagesNumber"&gt;
          &lt;/PaginationLine&gt;
        &lt;/div&gt;
      &lt;/template&gt;
    &lt;/q-table&gt;
</code></pre><p>ActionMenu ：表格右侧操作按钮</p>
<pre data-role="codeBlock" data-info="vue" class="language-vue vue"><code>      &lt;template #body-cell-opt="props"&gt;
        &lt;q-td :props="props" :auto-width="true"&gt;
          &lt;ActionMenu :currentRow="props.row" @doActionClick="doActionClick"
            :default-menus="getRightDefaultMenus(props.row)" :append-menus="getRightMoreMenus(props.row)" /&gt;
        &lt;/q-td&gt;
      &lt;/template&gt;
</code></pre><p>TabColumns使用：</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> columns<span class="token punctuation">,</span> visibleColumns <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'./models/TabColumns'</span><span class="token punctuation">;</span>
</code></pre><pre data-role="codeBlock" data-info="vue" class="language-vue vue"><code>    &lt;q-table class="fit sticky-header-table" selection="multiple" v-model:selected="selected" :dense="$q.screen.lt.md"
      separator="cell" flat bordered :rows="rows" :filter="filter" :columns="columns" row-key="name"
      :visible-columns="visibleColumns" v-model:pagination="pagination"&gt;
</code></pre><p>ActionMenus 使用</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> getDefaultMenus<span class="token punctuation">,</span> getMoreMenus <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">"./models/ActionMenus"</span><span class="token punctuation">;</span>

<span class="token comment">//#region 更多操作</span>
<span class="token comment">//获取表格的菜单栏</span>
<span class="token keyword keyword-function">function</span> <span class="token function">getRightDefaultMenus</span><span class="token punctuation">(</span>rowItem<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> menusArray <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token function">getDefaultMenus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-return">return</span> menusArray<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword keyword-function">function</span> <span class="token function">getRightMoreMenus</span><span class="token punctuation">(</span>rowItem<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-return">return</span> <span class="token function">getMoreMenus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword keyword-const">const</span> <span class="token function-variable function">doActionClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span>action<span class="token punctuation">,</span> row<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  Global<span class="token punctuation">.</span><span class="token function">Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">'表格菜单点击'</span><span class="token punctuation">,</span> action<span class="token punctuation">,</span> row<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-switch">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-case">case</span> <span class="token string">"preview"</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>预览
      <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-case">case</span> <span class="token string">"edit"</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>编辑
      <span class="token function">edit</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-case">case</span> <span class="token string">"delete"</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>删除
      DBService<span class="token punctuation">.</span><span class="token function">deleteItem</span><span class="token punctuation">(</span>row<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>p <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Global<span class="token punctuation">.</span>Message<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'删除成功'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
    <span class="token comment">// case "preview":</span>
    <span class="token comment">//   preview(row);</span>
    <span class="token comment">//   break;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//#endregion</span>
</code></pre><p><strong>index.vue完整表格页开发示例代码：</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>&lt;template&gt;
  &lt;base-content class="q-pa-sm" :style="sizeStyle"&gt;
    &lt;q-table class="fit sticky-header-table" selection="multiple" v-model:selected="selected" :dense="$q.screen.lt.md"
      separator="cell" flat bordered :rows="rows" :filter="filter" :columns="columns" row-key="name"
      :visible-columns="visibleColumns" v-model:pagination="pagination"&gt;
      &lt;template #top="table"&gt;
        &lt;TopFunBar :target="table" :batch="selected.length===0" :title="'服务列表'" @topBarClick="topBarClick" &gt;
          &lt;template #rightAppend&gt;
            &lt;q-btn-dropdown outlined label="自选列" icon="view_list" no-wrap v-show="$q.screen.gt.sm"&gt;
              &lt;q-list&gt;
                &lt;q-item tag="label" v-for="item in columns" :key="item.name"&gt;
                  &lt;q-item-section avatar&gt;
                    &lt;q-checkbox v-model="visibleColumns" :val="item.name" /&gt;
                  &lt;/q-item-section&gt;
                  &lt;q-item-section&gt;
                    &lt;q-item-label&gt;{{ item.label }}&lt;/q-item-label&gt;
                  &lt;/q-item-section&gt;
                &lt;/q-item&gt;
              &lt;/q-list&gt;
            &lt;/q-btn-dropdown&gt;
          &lt;/template&gt;
        &lt;/TopFunBar&gt;
      &lt;/template&gt;
      &lt;template #body-cell-picture="props"&gt;
        &lt;q-td :props="props"&gt;
          &lt;img v-if="props.row.picture" :src="props.row.picture" width="80" height="80" /&gt;
          &lt;span v-else&gt;暂无&lt;/span&gt;
        &lt;/q-td&gt;
      &lt;/template&gt;
      &lt;template #body-cell-profile="props"&gt;
        &lt;q-td :props="props"&gt;
          &lt;q-btn v-if="props.row.pid" label="下载档案" color="primary" @click="doDowload(props.row.pid)" /&gt;
          &lt;span v-else&gt;暂无&lt;/span&gt;
        &lt;/q-td&gt;
      &lt;/template&gt;

      &lt;template #body-cell-opt="props"&gt;
        &lt;q-td :props="props" :auto-width="true"&gt;
          &lt;ActionMenu :currentRow="props.row" @doActionClick="doActionClick"
            :default-menus="getRightDefaultMenus(props.row)" :append-menus="getRightMoreMenus(props.row)" /&gt;
        &lt;/q-td&gt;
      &lt;/template&gt;
      &lt;template v-slot:bottom&gt;
        &lt;div class="full-width row  justify-end"&gt;
          &lt;!-- &lt;q-pagination v-model="currentPage" :max="pagesNumber" /&gt; --&gt;
          &lt;PaginationLine :rows-number="rowSum" :rows-per-page="pagination.rowsPerPage" :max="pagesNumber"&gt;
          &lt;/PaginationLine&gt;
        &lt;/div&gt;
      &lt;/template&gt;
    &lt;/q-table&gt;
  &lt;/base-content&gt;
&lt;/template&gt;

&lt;script lang="ts" setup&gt;
import ActionMenu from "@/components/Menu/ActionMenu.vue";
import BaseContent from "src/components/Quasar/BaseContent.vue";
import { appStore } from 'src/stores';
import { computed, onMounted, onUnmounted, ref, watch } from "vue";
import DBService from "@/database/CommonDB/DBService";
import { OffEventHandler, OnEventHandler } from '@/events';
import TableEvent from '@/events/modules/TableEvent';
import { doLoadModal } from '@/utils/WidgetsTool';
import { Global, SaveAs } from "xframelib";
import { getDefaultMenus, getMoreMenus } from "./models/ActionMenus";
import { columns, visibleColumns } from './models/TabColumns';
import PaginationLine from "@/components/Quasar/TableParts/PaginationLine.vue";
import TopFunBar from "@/components/Quasar/TableParts/TopFunBar.vue";

defineOptions({ name: "StandardTable" })
const appState = appStore();
const sizeStyle = computed(() =&gt; {
  return appState.showTabMenu ? "padding-bottom: 30px;" : "";
})
const pagination = ref({
  sortBy: 'id',
  descending: false,
  page: 1,
  rowsPerPage: 10
})
const currentPage = ref(1);
//总记录数
const rowSum = ref(0);
const pagesNumber = computed(() =&gt; {
  return Math.ceil(rowSum.value / pagination.value.rowsPerPage)
})
const filter = ref&lt;string&gt;("")
const selected = ref([]);
const keywordRef=ref('');

//页码发生变化
watch(() =&gt; currentPage.value, val =&gt; {
  query();
})

//#region 通用对话框的相关代码
function showModal(actionMethod: string, rowData?: any) {
  let modalID: string = '';
  let extraData: any;
  switch (actionMethod) {
    case 'add':
      modalID = 'addEditForm';
      extraData = {
        title: `新建`,
        footer: 'true'
      };
      break;
    case 'edit':
      modalID = 'addEditForm';
      extraData = {
        title: `编辑`,
        footer: 'true'
      };
      break;
  }
  if (modalID) {
    const modalData = {
      modalID,
      extraData,
      rowData,
      width: 700
    };
    doLoadModal(modalData);
  }
}
//#endregion
//#region 更多操作
//获取表格的菜单栏
function getRightDefaultMenus(rowItem) {
  const menusArray = [...getDefaultMenus()];
  return menusArray;
}
function getRightMoreMenus(rowItem) {
  return getMoreMenus();
}
const doActionClick = (action, row) =&gt; {
  Global.Logger().trace('表格菜单点击', action, row);
  switch (action) {
    case "preview"://预览
      break;
    case "edit"://编辑
      edit(row);
      break;
    case "delete"://删除
      DBService.deleteItem(row.id).then(p =&gt; {
        query();
        Global.Message.info('删除成功')
      });
      break;
    // case "preview":
    //   preview(row);
    //   break;
  }
};
//#endregion

/**
 * 表格上方菜单操作
 */
const topBarClick = (val: string, searchValue: string) =&gt; {
  switch (val) {
    case 'searchWord':
      keywordRef.value=searchValue;
      query();
      break;
    case 'creatNew':
      add();
      break;
    case 'batchDelete':
      batchDelete();
      break;
    case 'refresh':
      query();
      break;
  }
};

const rows = ref&lt;any&gt;([])
async function query(data:{page?:number,pageSize?:number} = undefined) {
  if (data) {
    if (data.page)
    {
      currentPage.value = data.page;
    }

    if (data.pageSize) {
      pagination.value.rowsPerPage = data.pageSize;
    }
  }
    //获取总记录数
    rowSum.value=await DBService.getCount();
    if(currentPage.value&gt;pagesNumber.value)
       currentPage.value = pagesNumber.value;
  //请求用户数据
  DBService.getPageList(keywordRef.value, currentPage.value, pagination.value.rowsPerPage).then(data =&gt; {
    rows.value = data;
  });
}
//批量删除
 function batchDelete()
{
  if(selected.value.length&gt;0)
  {
     DBService.batchDelete(selected.value).then(()=&gt;query());
  }
}
//添加新记录
function add() {
  showModal('add', { name: '', age: 10 });
}
function edit(item) {
  showModal('edit', item);
}
//下载
async function doDowload(pid: number) {
  const pp = await DBService.getProfile(pid);
  if (pp) {

    SaveAs(pp.file, pp.name);
  }
}
onMounted(() =&gt; {
  OnEventHandler(TableEvent.RefeshTable, query);
  //初始化
  query();
})
onUnmounted(() =&gt; {
  OffEventHandler(TableEvent.RefeshTable, query);
})
&lt;/script&gt;
&lt;style lang="scss" scoped&gt;&lt;/style&gt;
</code></pre><h3 id="系统logger替换consolelog">系统Logger替换Console.log </h3>
<blockquote>
<p>SysConfig.js里UI的ProductLog 来控制：发布后系统是否输出系统日志</p>
<p>发布后建议改为：false</p>
</blockquote>
<p><img src="./data/productLog.png" alt="Log配置"></p>
<p>####<strong>Logging使用方法：</strong></p>
<p><mark><strong>Global.Logger().info</strong> 代替 <strong>Console.log</strong></mark></p>
<p>5 actual logging methods, ordered and available as:</p>
<ul>
<li><code>Global.Logger().trace(msg)</code></li>
<li><code>Global.Logger().debug(msg)</code></li>
<li><code>Global.Logger().info(msg)</code></li>
<li><code>Global.Logger().warn(msg)</code></li>
<li><code>Global.Logger().error(msg)</code></li>
</ul>
<p><code>log.setLevel(level, [persist])</code></p>
<p>This disables all logging below the given level, so that after a <code>log.setLevel("warn")</code> call <code>log.warn("something")</code> or <code>log.error("something")</code> will output messages, but <code>log.info("something")</code> will not.</p>
<p>####<strong>本质原理：</strong></p>
<p>xframelib使用封装了loglevel库，<a href="https://www.npmjs.com/package/loglevel">https://www.npmjs.com/package/loglevel</a></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>  //日志记录
  Logger: (name?: string) =&gt; {
    //标记是否第一次判断
    if (!firstLogger) {
      //开发环节和产品发布后
      if (import.meta.env?.DEV || SysConfig.UI.ProductLog) {
        Log.enableAll();
      } else {
        //Log.disableAll();//trace  0
        Log.setDefaultLevel("warn"); //3
      }
      firstLogger = true;
    }
    const logname = name || "default";
    return Log.getLogger(logname);
  }
</code></pre><h3 id="settings配置">settings配置 </h3>
<h4 id="1-projectsettingts-系统配置">1. projectSetting.ts 系统配置 </h4>
<p>实现接口ProjectConfig：</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>export interface ProjectConfig {
  //左侧抽屉-菜单状态
  leftDrawerOpen:boolean;
   //刷新页面
   reloadFlag:boolean;
   //显示TabMenu
   showTabMenu:boolean;
   TabMenuHeight:number;
   //显示breadcrumbs
  showBreadCrumbs:boolean;
  //#region 新增的，根据业务需要进行增加
  //整体默认主题样式
  themeStyle: string;
  //暗黑样式
  darkTheme: string;
  //是否收缩，默认收缩(左侧)
  leftCollapsed: boolean;
  //是否浮动起来(左侧菜单)
  overlayMenu: boolean;
  // 针对后台类布局的设置
  //右侧-主内容高度
  layoutContentHeight: number;
  //右侧-主内容宽度
  layoutContentWidth: number;
  //#endregion

  //#region  未启用配置字段（备用）
  // 是否显示SettingButton
  showSettingButton: boolean;
  // pageLayout whether to enable keep-alive
  openKeepAlive: boolean;
  // Use error-handler-plugin
  useErrorHandle: boolean;
  //#endregion

  // Whether to display the logo
  showLogo: boolean;
  // Whether to show the global footer
  showFooter: boolean;
  //底部栏的高度
  footerHeight: number;
  // menuType: MenuTypeEnum;
  headerSetting: HeaderSetting;
  // menuSetting
  menuSetting: MenuSetting;
}
</code></pre><p>leftDrawerOpen 控制左侧抽屉_菜单状态（展开/收缩）</p>
<p>//显示TabMenu</p>
<p>showTabMenu:true,</p>
<p>TabMenuHeight:30,</p>
<p><img src="./data/tabMenuSetting.png" alt="TabMenu"></p>
<p>//显示面包屑</p>
<p>showBreadCrumbs:true,</p>
<p><img src="./data/breadcrumbs.png" alt="面包屑"></p>
<h4 id="2-widgetsettings配置">2. widgetSettings配置 </h4>
<h5 id="21-配置规则">2.1 配置规则 </h5>
<h5 id="22-配置布局白名单">2.2 配置布局白名单 </h5>
<p><strong>src/permission/index.ts</strong></p>
<p>配置或修改对应的<strong>免登录</strong>可看的layout名称，<strong><u>否则无法获取到对应的widgetConfig列表</u></strong>。例如：</p>
<p><strong>const layoutIDwhiteList = ['portalLayout', 'bigScreenLayout', 'productLayout'];</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token doc-comment comment">/**
 * 白名单数组
 */</span>
<span class="token keyword keyword-const">const</span> resultWhiteList<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>IWidgetConfig<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
 * 获取不需要登录时，白名单
 * Layouts对应的WidgetConfig数组
 * <span class="token keyword keyword-@returns">@returns</span>
 */</span>
<span class="token keyword keyword-function">function</span> <span class="token function">getWhiteListWidgetConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> layoutIDwhiteList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'portalLayout'</span><span class="token punctuation">,</span> <span class="token string">'bigScreenLayout'</span><span class="token punctuation">,</span> <span class="token string">'productLayout'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>resultWhiteList<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span>
    widgetConfigSetting<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword keyword-const">const</span> layoutid <span class="token operator">=</span> it<span class="token punctuation">.</span>layoutID<span class="token punctuation">;</span>
      <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>layoutid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> idx <span class="token operator">=</span> layoutIDwhiteList<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>layoutid<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>idx <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> resultWhiteList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-return">return</span> resultWhiteList<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="3modalsetting配置">3.modalSetting配置 </h4>
<blockquote>
<p>modalSetting是用来配置动态对话框内容组件的配置，一般按布局或视图分文件配置</p>
</blockquote>
<p><img src="./data/modalSetting.png" alt="modalSetting"></p>
<h5 id="弹框使用方法">弹框使用方法 </h5>
<ol>
<li>
<p>为Layout布局，配置弹框容器ModalContainerWidget.vue，并默认加载</p>
<p>弹框容器路径：<strong><u>src/widgets/layouts/ModalContainerWidget.vue</u></strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>  {
    layoutID: 'backLayout', //归属组
    id: 'ModalContainerWidget',
    label: '弹框容器',
    container: LayoutContainerEnum.top,
    component: () =&gt; import('src/widgets/layouts/ModalContainerWidget.vue'),
    preload: true
  },

</code></pre><p><img src="./data/modalContainerWidget.png" alt="弹框容器配置"></p>
</li>
<li>
<p>编写对话框内容组件</p>
<p>以对话框src/pages/back/standardTable/modals/addEditForm.vue为例</p>
<p>1）<strong>定义对话框名称标识，要与modalSetting里配置相同</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>const name = 'addEditForm';
defineOptions({ name: 'addEditForm' });
</code></pre><p>2）固定内容，<strong>用于确认或取消的处理方法</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>import { ref, onMounted, onUnmounted, watch } from 'vue';
import { OffEventHandler, OnEventHandler, EmitMsg } from '@/events';
import { IExtraProperty } from '@/models/IModalModels';

//#region 固定模板
//确定或取消的处理方法
function OkCancelHandler(isOk: boolean) {
  if (isOk) {
    onSubmit();
  } else {
    formRef.value = {}
  }
}
onMounted(() =&gt; {
  //启动时监听
  OnEventHandler(name, OkCancelHandler);
  // init(props.data);
});
onUnmounted(() =&gt; {
  OffEventHandler(name, OkCancelHandler);
});
//#endregion 
</code></pre><p>3）<strong>定义props</strong>，固定两个props属性名为<strong>data</strong>和<strong>extra</strong>,类型可自定义或默认为object。用于接收弹框打开时，从外面传入的相关参数。</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>import { object, oneOfType } from 'vue-types';
import { IExtraProperty } from '@/models/IModalModels';

const props = defineProps({
  data: oneOfType([Object]).def({}),
  extra: object&lt;IExtraProperty&gt;().isRequired,
});
</code></pre><p>props.data是外部传入的主要数据，主要用于填充表格，使用示例如下：</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>const formRef = ref({});
watch(
  () =&gt; props.data,
  val =&gt; {
    //initData();
    if (val)
      formRef.value = { ...val }
    else
      formRef.value = {}
  }, { immediate: true, deep: true }
);
</code></pre></li>
</ol>
<p>在template模版里绑定相关业务值 <strong><a href="http://formRef.name">formRef.name</a></strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>  &lt;q-form class="modalContent column"&gt;
    &lt;q-scroll-area class="col"&gt;
      &lt;div class="row q-col-gutter-x-md dialog_form q-pa-md"&gt;
        &lt;div class="col-6"&gt;
          &lt;h5&gt;
            &lt;q-icon name="star" color="red" /&gt;姓名：
          &lt;/h5&gt;
          &lt;q-input outlined dense v-model="formRef.name" type="text" /&gt;
        &lt;/div&gt;
        &lt;div class="col-6"&gt;
          &lt;h5&gt;年龄：&lt;/h5&gt;
          &lt;q-input outlined dense v-model="formRef.age" type="text" /&gt;
        &lt;/div&gt;
        &lt;div class="col-12"&gt;
          &lt;h5&gt;上传简历&lt;/h5&gt;
          &lt;q-btn no-wrap v-show="$q.screen.gt.sm" label="上传" icon="mdi-cloud-upload-outline" color="primary"
            @click="doUpload"&gt;
            &lt;q-uploader ref="profileUploader" :max-files="1" class="hidden" accept=".doc, .docx, .pdf" field-name="file"
              @added="fileUpload" /&gt;
          &lt;/q-btn&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/q-scroll-area&gt;
  &lt;/q-form&gt;
</code></pre><ol start="3">
<li>调用对话框</li>
</ol>
<p>调用showModal方法，传入actionMethod方法名和数据，例如：</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>//添加新记录
function add() {
  showModal('add', { name: '', age: 10 });
}
//编辑
function edit(item) {
  showModal('edit', item);
}
</code></pre><p>showModal方法模版：</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>//#region 通用对话框的相关代码
function showModal(actionMethod: string, rowData?: any) {
  let modalID: string = '';
  let extraData: any;
  switch (actionMethod) {
    case 'add':
      modalID = 'addEditForm';
      extraData = {
        title: `新建`,
        footer: 'true'
      };
      break;
    case 'edit':
      modalID = 'addEditForm';
      extraData = {
        title: `编辑`,
        footer: 'true'
      };
      break;
  }
  if (modalID) {
    const modalData = {
      modalID,
      extraData,
      rowData,
      width: 700
    };
    doLoadModal(modalData);
  }
}
//#endregion
</code></pre><h3 id="环境变量设置与使用">环境变量设置与使用 </h3>
<blockquote>
<p>VUE自带环境变量与 .env里用户自定义环境变量</p>
<p>process.env.*</p>
</blockquote>
<p><strong>console.log('环境变量',process.env);</strong><br>
结果如下：<br>
<img src="./data/processEnv.png" alt="环境变量"></p>
<h4 id="1-vue自带环境变量">1. VUE自带环境变量 </h4>
<p>process.env.App_URL 网站根地址</p>
<p>process.env.DEV 开发模式</p>
<p>process.env.PROD 开发模式</p>
<h4 id="2-env用户自定义环境变量">2. .env用户自定义环境变量 </h4>
<p>用户自定义环境变量，必须是：“VITE_ ”开头，且全部大写，保存在 .env文件里。</p>
<p>自定义环境变量：process.env.VITE_PROJ_NAME</p>
<p><img src="./data/selfdefineEnv.png" alt="用户自定义环境变量"></p>
<h4 id="3环境变量使用全局绑定">3.环境变量使用（全局绑定） </h4>
<p>全局绑定方式：</p>
<pre data-role="codeBlock" data-info="vue" class="language-vue vue"><code>  //保存网站根地址
  app.config.globalProperties.$AppURL=process.env.APP_URL;
</code></pre><p>使用/调用方式</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">.</span>$AppURL<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="主题设置">主题设置 </h3>
<blockquote>
<p>Quasar默认支持的黑/白模式主题；自定义扩展其他主题</p>
</blockquote>
<h4 id="1quasar默认的黑白主题模式">1.Quasar默认的黑/白主题模式 </h4>
<p>主题存放路径：<strong><u>src/css/theme.css</u></strong></p>
<p><strong>1）黑白主题模式全局变量定义:</strong></p>
<p><strong>.body--light为浅色模式的通用变量定义；.body--dark为深色模式的通用变量定义。</strong></p>
<p><img src="./data/darklight_theme.png" alt="黑白主题模式变量定义"></p>
<p><strong>2）单个组件的（局部）黑白主题模式样式定义:</strong></p>
<p>在 style里，将样式定义，分别包在 .body--light和.body--dark里</p>
<pre data-role="codeBlock" data-info="css" class="language-css css"><code><span class="token selector">&lt;style lang="scss" scoped<span class="token combinator">&gt;</span>
<span class="token class">.body--light</span></span> <span class="token punctuation">{</span>
  <span class="token selector"><span class="token class">.header</span></span> <span class="token punctuation">{</span>
    <span class="token property">color</span><span class="token punctuation">:</span> <span class="token color">black</span><span class="token punctuation">;</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token color">white</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token selector"><span class="token class">.body--dark</span></span> <span class="token punctuation">{</span>
  <span class="token selector"><span class="token class">.header</span></span> <span class="token punctuation">{</span>
    <span class="token property">color</span><span class="token punctuation">:</span> <span class="token color">white</span><span class="token punctuation">;</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> $dark<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
&lt;/style&gt;
</code></pre><p><img src="./data/singleComponentTheme.png" alt="单组件黑白样式"></p>
<h4 id="2自定义扩展其他主题">2.自定义扩展其他主题 </h4>
<p>存放路径在：public/theme/*.css定义不同主题的相关变量</p>
<p><img src="./data/self_theme.png" alt="扩展其他主题"></p>
<p>需要修改SysConfig.js进行开启和切换主题样式</p>
<p><img src="./data/sysconfig_theme.png" alt="切换其他主题"></p>
<h4 id="3-定义scss样式变量">3. 定义SCSS样式变量 </h4>
<p>路径：src/css/quasar.variables.scss，定义css变量，以$开头</p>
<p>Quasar SCSS (&amp; Sass) Variables</p>
<p><img src="./data/quasar_scss_variables.png" alt="scss样式变量"></p>
<p>使用方式：$ITEM_COLOR</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>&lt;style lang="scss" scoped&gt;
.body--light {
  .base-menu-item {
    color: $ITEM_COLOR !important;

    .baseRootItemActive {
      color: $ACTIVE_COLOR !important;
    }

    .baseItemActive {
      color: $ACTIVE_COLOR !important;
      background: $ACTIVE_BACKGROUND;
      transition: all 0.618s;
      font-weight: bold;

      &amp;:after {
        content: '';
        position: absolute;
        width: 3px;
        height: 100%;
        background: $ACTIVE_COLOR !important;
        top: 0;
        right: 0;
      }
    }
  }
}

.body--dark {
  .base-menu-item {
    color: $ITEM_COLOR_DARK !important;

    .baseRootItemActive {
      color: $ACTIVE_COLOR_DARK !important;
    }

    .baseItemActive {
      color: $ACTIVE_COLOR_DARK !important;
      background: $ACTIVE_BACKGROUND_DARK;
      transition: all 0.618s;
      font-weight: bold;

      &amp;:after {
        content: '';
        position: absolute;
        width: 3px;
        height: 100%;
        background: $ACTIVE_COLOR_DARK !important;
        top: 0;
        right: 0;
      }
    }
  }
}
&lt;/style&gt;
</code></pre><h3 id="其他问题">其他问题 </h3>
<h4 id="1-quasar-spa打包后indexhtml-双引号丢失问题">1. quasar spa打包后index.html 双引号丢失问题 </h4>
<pre class="language-text">原因：quasar 使用了html-minifier库  npmjs.com/package/html-minifier
解决方法：
**Ignoring chunks of markup**
If you have chunks of markup you would like preserved, you can wrap them &lt;!-- htmlmin:ignore --&gt;.
![htmlignore.png](./data/htmlignore.png)
</pre>
<h4 id="2-打包后编译运行预览">2. 打包后编译，运行预览 </h4>
<p>​     <strong><u>quasar serve  dist/spa</u></strong></p>
<ul>
<li>全局安装 @quasar/cli<br>
<img src="./data/quasarcli.png" alt="@quasar/cli"></li>
<li>预览命令  <strong>quasar serve  dist/spa</strong></li>
</ul>
<h4 id="3-使用cesium注意事项">3. 使用cesium注意事项： </h4>
<ul>
<li>需要安装与配置 vite-plugin-cesium插件，build发布时，会在index.html自动添加js和css引入<br>
<img src="./data/cesiumjs.png" alt="cesiumjs.png"></li>
<li>在public/cesium目录下放在cesium发布版代码和资源，不能删减Assets<br>
<img src="./data/cesium.png" alt="cesium资源"></li>
</ul>
<h4 id="4-cesium升级的注意事项">4. cesium升级的注意事项 </h4>
<p>package.json里的cesium版本升级，同时需要拷贝 <strong>nodemodules/cesium/Build/Cesium</strong>文件下全部内容，替换项目<strong>public/Cesium</strong>文件下内容。</p>
<p><img src="./data/cesiumUpdate.png" alt="cesium文件夹拷贝"></p>
<h4 id="5-项目打包报top-level-await错误">5. 项目打包报“Top-Level-Await”错误 </h4>
<blockquote>
<p>修改quasar.config.ts文件，增加viteConf.esbuild项内容为：</p>
<pre class="language-text"> supported: {
  'top-level-await': true
 },
</pre>
</blockquote>
<p>​    解决方法截图：</p>
<p><img src="./data/top-level-await.png" alt="Top-Level-Await错误解决方法"></p>
<h4 id="6-quasar默认的material图标查询">6. quasar默认的material图标查询 </h4>
<p>查询地址：<a href="https://mui.com/material-ui/material-icons/">https://mui.com/material-ui/material-icons/</a></p>
<p>Iconfify图标库地址：<a href="https://icon.gis.digsur.com/">https://icon.gis.digsur.com/</a>     的material-symbols图标库，<strong>图标名要以<u>下划线</u>连接</strong>。</p>
<h4 id="7-定义路径别名">7. 定义路径别名 </h4>
<p>参考：<a href="https://quasar.dev/quasar-cli-vite/handling-vite#folder-aliases">https://quasar.dev/quasar-cli-vite/handling-vite#folder-aliases</a></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>{
  "extends": "@quasar/app-vite/tsconfig-preset",
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "src/*": ["src/*"],
      "app/*": ["*"],
      "components/*": ["src/components/*"],
      "layouts/*": ["src/layouts/*"],
      "pages/*": ["src/pages/*"],
      "assets/*": ["src/assets/*"],
      "boot/*": ["src/boot/*"],
      "stores/*": ["src/stores/*"],

      "utils/*": ["src/utils/*"]
    }
  }
}
</code></pre><p><a href="https://www.npmjs.com/package/vite-tsconfig-paths">https://www.npmjs.com/package/vite-tsconfig-paths</a></p>
<p>统一在tsconfig.json里<strong>paths项</strong>定义<strong>路径别名</strong>，通过在<strong>quasar.config.ts</strong> 增加vite插件**<u>vite-tsconfig-paths</u>**来启用。</p>
<p><img src="./data/vite-paths.png" alt="定义路径别名的插件配置"></p>
<h4 id="8-解决import路径警告问题">8. 解决import路径警告问题 </h4>
<p>问题如下：</p>
<p><img src="./data/import_path_warning.png" alt="import找不到模块警告"></p>
<p>解决方法：在tsconfig.json 添加上"include": ["src/**/*"]</p>
<p><img src="./data/tsconfig_include.png" alt="找不到模块解决方法"></p>
<p>参考：<a href="https://juejin.cn/post/6924264635218542605">https://juejin.cn/post/6924264635218542605</a></p>
<p><a href="https://segmentfault.com/q/1010000040178399">https://segmentfault.com/q/1010000040178399</a></p>
<h3 id="webworker提升性能vite-plugin-webworker-service插件">WebWorker提升性能：vite-plugin-webworker-service插件 </h3>
<blockquote>
<p>说明：使用vite-plugin-webworker-service来代替workerpool库。<strong>因为 workerpool库有局限性，无法使用import引入外部类库或方法。</strong></p>
</blockquote>
<p><a href="https://www.npmjs.com/package/vite-plugin-webworker-service">vite-plugin-webworker-service - npm (npmjs.com)</a></p>
<p><strong>Vite plugin webworker service</strong> is a lightweight, powerful, and easy-to-use tool designed to make working with WebWorkers in your projects as seamless as possible.</p>
<p><strong>The plugin generates a webworker file based on the used files ending in .service, as well as a bridge between the main thread and the webworker thread at build time</strong>, thereby allowing you to enjoy the reliability of typescript typechecks and various code editor tools, which cannot be achieved by directly using webworkers with postMessage and onmessage</p>
<p>Quasar.config配置：<br>
<img src="./data/webworker1.png" alt="vite-plugin-webworker-service插件"></p>
<p>使用在 src/workers目录下编写 **.service.ts文件，自动编译成module模块化的worker.js</p>
<p><img src="./data/webworker2.png" alt="使用示例代码"></p>
<h3 id="animatecss使用方法">Animate.css使用方法 </h3>
<blockquote>
<p>Animate.css is a library of ready-to-use, cross-browser animations for use in your web projects. Great for emphasis, home pages, sliders, and attention-guiding hints.<br>
<a href="https://animate.style/">https://animate.style/</a></p>
</blockquote>
<h4 id="1-在css中使用">1. 在CSS中使用 </h4>
<p>直接使用动画的原始名称，例如 “fadeIn”</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token operator">&lt;</span>script setup lang<span class="token operator">=</span><span class="token string">"ts"</span><span class="token operator">&gt;</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> array<span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token builtin">string</span> <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'vue-types'</span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> IFlashCardSection <span class="token keyword keyword-from">from</span> <span class="token string">'./IFlashCardSection'</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> props <span class="token operator">=</span> <span class="token function">defineProps</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  animateIn<span class="token operator">:</span> <span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">def</span><span class="token punctuation">(</span><span class="token string">'fadeIn'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  dataList<span class="token operator">:</span> <span class="token generic-function"><span class="token function">array</span><span class="token generic class-name"><span class="token operator">&lt;</span>IFlashCardSection<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">def</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//数据列表</span>
  nwidth<span class="token operator">:</span> <span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">def</span><span class="token punctuation">(</span><span class="token number">340</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//面板宽度</span>
  nheight<span class="token operator">:</span> <span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">def</span><span class="token punctuation">(</span><span class="token number">238</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//面板高度</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><p>在CSS里使用方法如下：<strong>animation:fadeIn;</strong></p>
<pre data-role="codeBlock" data-info="css" class="language-css css"><code><span class="token selector"><span class="token class">.flash_card</span></span> <span class="token punctuation">{</span>
  <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">v-bind</span><span class="token punctuation">(</span>nwidth<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token function">v-bind</span><span class="token punctuation">(</span>nheight<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
  <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>
  <span class="token selector">&amp;<span class="token pseudo-class">:hover</span></span> <span class="token punctuation">{</span>
    <span class="token selector"><span class="token class">.sectionHoverDiv</span></span> <span class="token punctuation">{</span>
      <span class="token property">-webkit-animation</span><span class="token punctuation">:</span> <span class="token function">v-bind</span><span class="token punctuation">(</span>animateIn<span class="token punctuation">)</span> <span class="token number">2</span><span class="token unit">s</span><span class="token punctuation">;</span>
      <span class="token property">animation</span><span class="token punctuation">:</span> <span class="token function">v-bind</span><span class="token punctuation">(</span>animateIn<span class="token punctuation">)</span> <span class="token number">2</span><span class="token unit">s</span><span class="token punctuation">;</span>
      <span class="token property">visibility</span><span class="token punctuation">:</span> visible<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="2-在vue组件中使用transitionslidevue">2. 在VUE组件中使用——TransitionSlide.vue </h4>
<p>参考：<a href="https://vuejs.org/guide/built-ins/transition.html#custom-transition-classes">https://vuejs.org/guide/built-ins/transition.html#custom-transition-classes</a><br>
<a href="https://www.quasar-cn.cn/options/animations">https://www.quasar-cn.cn/options/animations</a></p>
<ul>
<li>多个元素的动画<br>
也可以为一组 DOM/组件添加过渡动画。</li>
</ul>
<pre data-role="codeBlock" data-info="vue" class="language-vue vue"><code>&lt;!-- 多个元素/组件的示例 --&gt;
&lt;transition-group
  appear
  enter-active-class="animated fadeIn"
  leave-active-class="animated fadeOut"
&gt;

  &lt;p key="text"&gt;
     Lorem Ipsum
  &lt;/p&gt;
  &lt;q-btn
    key="email-button"
    color="secondary"
    icon="mail"
    label="Email"
  /&gt;
&lt;/transition-group&gt;
</code></pre><p>在上面的多元素示例中注意:</p>
<p>注意使用 <transition-group> 代替了 <transition>.<br>
DOM/组件都有 key 属性标记，例如key="text" 或者 key="email-button"<br>
上面的两个示例中都使用了appear属性，这使得动画在组件渲染后将立即执行一次。此属性是可选的。</transition></transition-group></p>
<ul>
<li>组件位置：src/components/TransitionSlide.vue</li>
</ul>
<pre data-role="codeBlock" data-info="" class="language-text"><code>&lt;template&gt;
  &lt;Transition
    mode="out-in"
    name="animate__slide"
    :duration="duration"
    :appear="appear"
    :enter-active-class="`animated ${enter}`"
    :leave-active-class="`animated ${leave}`"
  &gt;
    &lt;slot&gt;&lt;/slot&gt;
  &lt;/Transition&gt;
&lt;/template&gt;
&lt;script lang="ts"&gt;
import { defineComponent } from 'vue';
export default defineComponent({
  name: 'TransitionSlide',

  props: {
    enter: {
      type: String,
      default: 'fadeIn'
    },
    leave: {
      type: String,
      default: 'fadeOut'
    },
    duration: {
      type: Number,
      default: 1000
    },
    appear: {
      type: Boolean,
      default: true
    }
  }
});
&lt;/script&gt;
</code></pre><h4 id="3使用v-wow中使用方法">3.使用v-wow中使用方法 </h4>
<pre data-role="codeBlock" data-info="" class="language-text"><code>&lt;template&gt;
  &lt;div :style="{ overflow: 'auto', height: containerHeight + 'px' }"&gt;
    &lt;VideoPanel v-wow="{ 'animation-name': 'slideInDown' }"&gt;&lt;/VideoPanel&gt;
    &lt;div v-wow="{ 'animation-name': 'slideInUp' }" style="background-color: #f00; height: 400px; width: 100%"&gt;&lt;/div&gt;
    &lt;div v-wow="{ 'animation-name': 'slideInLeft' }" style="background-color: #0f0; height: 400px; width: 100%"&gt;&lt;/div&gt;
    &lt;div v-wow="{ 'animation-name': 'slideInUp' }" style="background-color: #00f; height: 400px; width: 100%"&gt;&lt;/div&gt;
    &lt;CarouselPanel v-wow="{ 'animation-name': 'slideInLeft', 'animation-duration': '2s' }"&gt;&lt;/CarouselPanel&gt;
    &lt;VideoPanel v-wow="{ 'animation-name': 'slideInRight', 'animation-duration': '2s' }"&gt;&lt;/VideoPanel&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { computed } from 'vue';

import CarouselPanel from '../ScrollPage/CarouselPanel.vue';
import VideoPanel from '../ScrollPage/VideoPanel.vue';
const containerHeight = computed(() =&gt; {
  return document.body.clientHeight; //LayoutTool.getContentHeight();
});
&lt;/script&gt;
</code></pre><h4 id="4-在quasar中使用">4. 在Quasar中使用 </h4>
<p>Built-in animation classes<br>
<a href="https://quasar.dev/options/animations#introduction">https://quasar.dev/options/animations#introduction</a></p>
<p><a href="https://www.quasar-cn.cn/options/transitions/">https://www.quasar-cn.cn/options/transitions/</a><br>
Quasar 组件的过渡效果<br>
一些 Quasar 组件可以通过transition-show/transition-hide 或 transition-prev/transition-next 或 transition 等属性来控制过渡效果:</p>
<p><strong>1）transition-show/transition-hide</strong></p>
<p>QBtnDropdown<br>
QInnerLoading<br>
QTooltip<br>
QMenu<br>
QDialog<br>
QSelect (通过 QMenu 和 QDialog)<br>
QPopupProxy (通过 QMenu 和 QDialog)</p>
<pre data-role="codeBlock" data-info="vue" class="language-vue vue"><code>&lt;q-menu
  transition-show="jump-down"
  transition-hide="jump-up"
/&gt;
</code></pre><p><strong>2）transition-prev/transition-next</strong></p>
<p>QCarousel<br>
QTabPanels<br>
QStepper<br>
transition</p>
<p><strong>3）QIntersection</strong></p>
<blockquote>
<q-intersection once="" transition="scale">
</q-intersection></blockquote>
<pre data-role="codeBlock" data-info="vue" class="language-vue vue"><code>      &lt;q-intersection once transition="flip-right"&gt;
      &lt;FlashCardPanel :data-list="dataDemoList"&gt;&lt;/FlashCardPanel&gt;
      &lt;/q-intersection&gt;
</code></pre><h2 id="配置electron编译模式流程桌面端">配置Electron编译模式流程（桌面端） </h2>
<ol>
<li>执行以下指令：<strong>pnpm quasar  mode add electron</strong> 或 <strong>pnpm quasar dev -m electron</strong></li>
</ol>
<p>新增了 src-electron目录 和自动安装必要的依赖库<br>
<img src="./data/electron1.png" alt="electron1.png"></p>
<ol start="2">
<li><em>不一定需要执行，如果运行第三步报错可以尝试运行这一步。 找到并切换到./node_modules/electron目录下命令窗口，执行命令：</em>* npm install** ，需等待2分左右<br>
<img src="./data/electron2.png" alt="单独安装electron"></li>
<li>回到项目目录下，执行命令：<strong>pnpm dev -m electron</strong>  即可以本地窗体模式运行<br>
<img src="./data/electron3.png" alt="electron3.png"></li>
<li>运行效果<br>
<img src="./data/electron4.png" alt="electron4.png"></li>
</ol>
<h2 id="基于capacitor-移动混合app开发">基于Capacitor 移动混合APP开发 </h2>
<h3 id="什么是capacitor">什么是Capacitor </h3>
<p><strong>Capacitor: A cross-platform native runtime for web apps</strong></p>
<p><strong>Capacitor</strong> is an open source native runtime for <strong>building Web Native apps</strong>. Create cross-platform iOS, Android, and Progressive Web Apps with JavaScript, HTML, and CSS.</p>
<p><a href="https://capacitorjs.com/">https://capacitorjs.com/</a></p>
<h3 id="capacitor原生跨平台插件">Capacitor原生跨平台插件 </h3>
<p><strong>Plugins in Capacitor enable JavaScript to interface directly with Native APIs.</strong></p>
<p><strong>Capacitor中的插件使JavaScript能够直接调用Native API接口</strong></p>
<p>Web apps can access the full power of Native APIs with plugins. Plugins wrap common native operations that might use very different APIs across platforms while exposing a consistent, cross-platform API to JavaScript.</p>
<p>Web应用程序可以通过插件访问Native API的全部功能。插件包装了常见的本机操作，这些操作可能跨平台使用非常不同的API，同时向JavaScript公开了一致的跨平台API。</p>
<p>Additionally, the plugin capability in Capacitor makes it possible for teams with a mix of traditional native developers and web developers to work together on different parts of the app.</p>
<p>此外，Capacitor中的插件功能使传统移动开发人员和Web开发人员的团队能够在应用程序的不同部分协同工作。</p>
<p>Capacitor automatically generates JavaScript hooks on the client, so most plugins only need to use Swift/Obj-C for iOS and/or Java/Kotlin for Android. Of course, adding custom JavaScript for a plugin is also possible.</p>
<p>Capacitor会自动在客户端生成JavaScript挂钩，因此大多数插件只需要使用iOS版的Swift/Oj-C和/或Android版的Java/Kotlin。当然，为插件添加自定义JavaScript也是可能的。</p>
<p><a href="https://capacitorjs.com/docs/plugins">https://capacitorjs.com/docs/plugins</a></p>
<h3 id="capacitor插件源列表">Capacitor插件源列表 </h3>
<h4 id="官方版capacitor跨平台插件">官方版Capacitor跨平台插件 </h4>
<p>官网 <a href="https://capacitorjs.com/docs/apis">https://capacitorjs.com/docs/apis</a></p>
<p>NPM <a href="https://www.npmjs.com/org/capacitor">https://www.npmjs.com/org/capacitor</a></p>
<h4 id="社区版-capacitor-community插件">社区版-Capacitor Community插件 </h4>
<p>Github <a href="https://github.com/capacitor-community">https://github.com/capacitor-community</a></p>
<p>NPM <a href="https://www.npmjs.com/org/capacitor-community">https://www.npmjs.com/org/capacitor-community</a></p>
<h4 id="社区版-capawesome插件">社区版-Capawesome插件 </h4>
<p>官网：<a href="https://capawesome.io/plugins/"><strong>https://capawesome.io/plugins/</strong></a></p>
<p>Github <a href="https://github.com/capawesome-team">https://github.com/capawesome-team</a></p>
<p>NPM  <a href="https://www.npmjs.com/org/capawesome">https://www.npmjs.com/org/capawesome</a></p>
<p>示例工程：<a href="https://github.com/robingenz/capacitor-plugin-demo">https://github.com/robingenz/capacitor-plugin-demo</a></p>
<h4 id="cordova兼容插件-awesome-cordova-plugins">Cordova兼容插件-awesome-cordova-plugins </h4>
<p>Capacitor has support for most Cordova plugins, so developers can use the <a href="https://cordova.apache.org/plugins/">hundreds of existing Cordova plugins</a> in their Capacitor apps. While certain Cordova plugins are <a href="https://capacitorjs.com/docs/plugins/cordova#known-incompatible-plugins">not compatible</a> with Capacitor, most are, so it's worth trying one if there's no existing Capacitor-specific plugin available.</p>
<p><a href="https://capacitorjs.com/docs/plugins/community">https://capacitorjs.com/docs/plugins/community</a></p>
<p>官网： <a href="https://danielsogl.gitbook.io/awesome-cordova-plugins">https://danielsogl.gitbook.io/awesome-cordova-plugins</a></p>
<p>Awesome Cordova Plugins is a curated set of wrappers for Cordova plugins that make adding any native functionality you need to your <a href="https://ionicframework.com/">Ionic</a> mobile app easy.</p>
<p>Github <a href="https://github.com/danielsogl/awesome-cordova-plugins">https://github.com/danielsogl/awesome-cordova-plugins</a></p>
<p>NPM :<a href="https://www.npmjs.com/org/awesome-cordova-plugins">https://www.npmjs.com/org/awesome-cordova-plugins</a></p>
<ul>
<li><strong>@ionic-native 与@awesome-cordova-plugins关系</strong></li>
</ul>
<p>@ionic-native NPM :<a href="https://www.npmjs.com/org/ionic-native">https://www.npmjs.com/org/ionic-native</a></p>
<p><strong><u>Ionic Native was renamed to Awesome Cordova Plugins原因</u></strong></p>
<p>Today we are announcing some changes to the open source ionic-native project, namely that community member <a href="https://github.com/danielsogl">Daniel Sogl</a> will be taking it over and it will be renamed <a href="https://github.com/danielsogl/awesome-cordova-plugins">awesome-cordova-plugins</a>.</p>
<p><a href="https://ionic.io/blog/a-new-chapter-for-ionic-native">https://ionic.io/blog/a-new-chapter-for-ionic-native</a></p>
<h3 id="quasar-capacitor开发模式">Quasar Capacitor开发模式 </h3>
<p><strong>Capacitor5 需要Gradle8和java17</strong>，下载最新版的Android Studio即可。</p>
<p><a href="https://quasar.dev/quasar-cli-vite/developing-capacitor-apps/capacitor-version-support">Capacitor versions</a></p>
<blockquote>
<p>Requirements</p>
<ul>
<li>Xcode 14.1+ (for iOS)</li>
<li>Android Studio Flamingo 2022.2.1 or newer (for Android)</li>
</ul>
</blockquote>
<h4 id="step-1-安装开发环境">Step 1: 安装开发环境 </h4>
<p>下载安装 最新版的Android Studio,<a href="https://developer.android.com/studio?hl=zh-cn">下载 Android Studio</a>,</p>
<p>通过SDK Managers可补充安装更多的 Android SDK</p>
<p><img src="./data/image-20240226113038094.png" alt="SDK Manager"></p>
<p><img src="./data/installandroidsdk.png" alt="Sdk Manager安装SDK"></p>
<p>配置Windows上的 Android环境变量 <strong>ANDROID_SDK_ROOT</strong> （注意：环境变量 ANDROID_HOME 已经废弃）</p>
<p>cmd命令行界面运行下面的命令</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>setx ANDROID_SDK_ROOT "%USERPROFILE%\AppData\Local\Android\Sdk"
setx path "%path%;%ANDROID_SDK_ROOT%\tools;%ANDROID_SDK_ROOT%\platform-tools"
</code></pre><h4 id="step2安装打包环境">Step2：安装打包环境 </h4>
<p>1）java环境配置，打包时用到keytool命令</p>
<p>下载JDK  <a href="https://www.oracle.com/java/technologies/downloads/">Java Downloads | Oracle</a></p>
<p>安装JDK 17,配置环境变量：JAVA_HOME 为 C:\Program Files\Java\jdk-17</p>
<p>为path变量增加  C:\Program Files\Java\jdk-17\bin  （否则，打包是keytool命令行找不到）</p>
<p>cmd命令行界面运行：</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>setx JAVA_HOME "C:\Program Files\Java\jdk-17"
setx path "%path%;C:\Program Files\Java\jdk-17\bin"
</code></pre><p>2）打包发布apk包时，需要用到的处理命令：zipalign 、 apksigner</p>
<p><strong>注意：<strong>配置android</strong>打包发布</strong>时的环境变量path，否则<strong>zipalign命令找不到</strong>。34.0.0为我的Android SDK版本号</p>
<p>例如：C:\Users\zorro\AppData\Local\Android\Sdk\build-tools\34.0.0</p>
<p>cmd命令行界面运行：</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>setx path "%path%;%ANDROID_SDK_ROOT%\build-tools\34.0.0"
</code></pre><h4 id="step-3生成-capacitor工程目录">Step 3:生成 Capacitor工程目录 </h4>
<p>生成src-capacitor</p>
<p><code>quasar mode add capacitor</code></p>
<p>/src-capacitor/package.json内容类似</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>dependencies: {
  "@capacitor/app": "^5.0.0",
  "@capacitor/cli": "^5.0.0",
  "@capacitor/core": "^5.0.0",
  "@capacitor/splash-screen": "^5.0.0"
}
</code></pre><p>The <code>@capacitor/app</code> and <code>@capacitor/splash-screen</code> are optional, but it helps Quasar with some UI functionality if they are installed.</p>
<p>在src-capacitor下运行</p>
<p><code>npm install</code></p>
<h4 id="step-4-安装capacitor插件">Step 4: 安装Capacitor插件 </h4>
<p>在quasar主工程下安装capacitor插件，例如命令如下：</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>pnpm add @capacitor-community/keep-awake
</code></pre><p>同时，在src-capacitor也得重新运行安装上面插件</p>
<p><img src="./data/installplugin.png" alt="安装插件"></p>
<h4 id="step-5-运行调试">Step 5: 运行调试 </h4>
<p><code>$ quasar dev -m capacitor -T [android|ios]</code> 将启动IDE打开（Android Studio 或 Xcode） 开发环境，来连接移动设备运行调试。</p>
<p><strong>注意：首次运行时，需要下载gradle相关依赖jar包（需要翻墙）</strong></p>
<p><img src="./data/androiddebug.png" alt="android debug"></p>
<p>运行调试：打开浏览器，同步调试和输出log。</p>
<p>Chrome 浏览器 URL 输入<code>chrome://inspect/#devices</code> .</p>
<p>Edge浏览器  URL输入 edge://inspect/#devices</p>
<p><img src="./data/webdebug1.png" alt="web  debug"></p>
<p><img src="./data/webdebug2.png" alt="运行调试"></p>
<h3 id="android-相关配置说明">Android 相关配置说明 </h3>
<h4 id="gradle配置修改">gradle配置修改 </h4>
<ul>
<li><strong>gradle-wrapper.properties文件修改</strong></li>
</ul>
<p>修改distributionUrl下载地址，改为gradle国内镜像地址 <a href="https://mirrors.cloud.tencent.com/gradle/">https://mirrors.cloud.tencent.com/gradle/</a></p>
<p>目前统一使用8.0.2</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>distributionUrl=https\://mirrors.cloud.tencent.com/gradle/gradle-8.0.2-all.zip
</code></pre><p><img src="./data/gradleurl.png" alt="gradle URL"></p>
<ul>
<li><strong>build.gradle文件内容替换</strong></li>
</ul>
<p>完全替换下面内容，优先使用国内阿里的Maven源</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>// Top-level build file where you can add configuration options common to all sub-projects/modules.

buildscript {
    
    repositories {
      maven {
        url 'https://maven.aliyun.com/repository/public/'
      }
        google()
        mavenCentral()
    }
    dependencies {
        classpath 'com.android.tools.build:gradle:8.0.0'
        classpath 'com.google.gms:google-services:4.3.15'

        // NOTE: Do not place your application dependencies here; they belong
        // in the individual module build.gradle files
    }
}

apply from: "variables.gradle"

allprojects {
    repositories {
      maven {
        url 'https://maven.aliyun.com/repository/public/'
      }
      maven {
        url 'https://maven.aliyun.com/repository/central'
      }
        google()
        mavenCentral()
    }
}

task clean(type: Delete) {
    delete rootProject.buildDir
}

</code></pre><ul>
<li>
<p>gradle.properties文件修改</p>
<p>增加内容：</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>android.overridePathCheck=true
android.enableJetifier=true
</code></pre><p><img src="./data/gradleproperties.png" alt="修改"></p>
</li>
</ul>
<h4 id="androidmanifestxml修改">AndroidManifest.xml修改 </h4>
<p>路径：\src-capacitor\android\app\src\main\AndroidManifest.xml</p>
<h5 id="android功能权限修改"><strong>android功能权限修改</strong> </h5>
<pre data-role="codeBlock" data-info="" class="language-text"><code>    &lt;!-- Permissions --&gt;
    &lt;uses-permission android:name="android.permission.INTERNET" /&gt;
    &lt;uses-permission android:name="android.permission.FOREGROUND_SERVICE_CONNECTED_DEVICE"/&gt;

    &lt;!-- 地理位置权限 --&gt;
    &lt;uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" /&gt;
    &lt;uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" /&gt;
    &lt;uses-permission android:name="android.permission.ACCESS_BACKGROUND_LOCATION" /&gt;
    &lt;uses-permission android:name="android.permission.FOREGROUND_SERVICE" /&gt;
    &lt;uses-permission android:name="android.permission.REQUEST_IGNORE_BATTERY_OPTIMIZATIONS" /&gt;
    &lt;uses-feature android:name="android.hardware.location.gps" /&gt;
    &lt;!-- 图片权限 --&gt;
    &lt;uses-permission android:name="android.permission.READ_MEDIA_IMAGES"/&gt;
    &lt;uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE"/&gt;
    &lt;uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" /&gt;
    &lt;!-- 录音权限 --&gt;
    &lt;uses-permission android:name="android.permission.RECORD_AUDIO"/&gt;
    &lt;uses-permission android:name="android.permission.MODIFY_AUDIO_SETTINGS"/&gt;
    &lt;uses-permission android:name="android.permission.READ_CONTACTS"/&gt;
    &lt;uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" /&gt;
    &lt;!-- 视频需要开启的权限 --&gt;
    &lt;uses-permission android:name="android.permission.READ_MEDIA_VIDEO" /&gt;
    &lt;uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" /&gt;
    &lt;uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" /&gt;
    &lt;!-- 通知权限 --&gt;
    &lt;uses-permission android:name="android.permission.VIBRATE" /&gt;
    &lt;uses-permission android:name="android.permission.SCHEDULE_EXACT_ALARM" /&gt;
    &lt;!-- 摄像头 --&gt;
       &lt;uses-permission android:name="android.permission.CAMERA" /&gt;
</code></pre><h5 id="竖屏横屏控制"><strong>竖屏横屏控制</strong> </h5>
<p><strong>强制竖屏</strong>： <code>android:screenOrientation="portrait"</code></p>
<p><img src="./data/shuping.png" alt="竖屏"></p>
<ul>
<li>
<p><strong>activity</strong> <strong>竖屏节点属性：</strong></p>
<p>android:screenOrientation="landscape"</p>
<ul>
<li>unspecified，默认值，由系统决定，不同手机可能不一致</li>
<li>landscape，强制横屏显示</li>
<li>portrait，强制竖屏显</li>
<li>behind，与前一个activity方向相同</li>
<li>sensor，根据物理传感器方向转动，用户90度、180度、270度旋转手机方向，activity都更着变化</li>
<li>sensorLandscape，横屏旋转，一般横屏游戏会这样设置</li>
<li>sensorPortrait，竖屏旋转</li>
<li>nosensor，旋转设备时候，界面不会跟着旋转。初始化界面方向由系统控制</li>
<li>user，用户当前设置的方向</li>
</ul>
</li>
</ul>
<p>参考资料：<a href="http://flashme.cn/index.php/study/66.html">Capacitor打包APP应用 )</a></p>
<h5 id="键盘浮在页面上面">键盘浮在页面上面 </h5>
<p>参考链接：<a href="https://blog.csdn.net/mjyy10181103/article/details/78261500">android如何让布局保持位于键盘上方（一直在键盘上面）_如何让悬浮床始终在键盘的上方-CSDN博客</a></p>
<p>解决方法：</p>
<p>在manifest文件中的activity标签中修改android:windowSoftInputMode属性<br>
属性参数：</p>
<p>各值的含义：<br>
【A】stateUnspecified：软键盘的状态并没有指定，系统将选择一个合适的状态或依赖于主题的设置<br>
【B】stateUnchanged：当这个activity出现时，软键盘将一直保持在上一个activity里的状态，无论是隐藏还是显示<br>
【C】stateHidden：用户选择activity时，软键盘总是被隐藏<br>
【D】stateAlwaysHidden：当该Activity主窗口获取焦点时，软键盘也总是被隐藏的<br>
【E】stateVisible：软键盘通常是可见的<br>
【F】stateAlwaysVisible：用户选择activity时，软键盘总是显示的状态<br>
【G】adjustUnspecified：默认设置，通常由系统自行决定是隐藏还是显示<br>
【H】adjustResize：该Activity总是调整屏幕的大小以便留出软键盘的空间<br>
【I 】adjustPan：当前窗口的内容将自动移动以便当前焦点从不被键盘覆盖和用户能总是看到输入内容的部分</p>
<p>增加或修改下面内容：</p>
<p>android:windowSoftInputMode="adjustPan"</p>
<p><img src="./data/keyboard1.png" alt="修改设置"></p>
<p>键盘浮在页面的上面，效果图：</p>
<p><img src="./data/keyboard2.jpg" alt="键盘浮在页面的上面"></p>
<h4 id="android-app名称设置">Android APP名称设置 </h4>
<p>设置app安装名称和app的桌面显示名称，路径为</p>
<p><strong><u>src_capacitor/android/app/src/main/res/values/strings.xml</u></strong></p>
<p><img src="./data/appname.png" alt="App名称"></p>
<p>app_name为安装时显示名称</p>
<p>title_activity_main为app桌面图标显示名称</p>
<h3 id="capacitor--android打包发布">Capacitor  Android打包发布 </h3>
<h4 id="打包发布版">打包发布版 </h4>
<pre data-role="codeBlock" data-info="" class="language-text"><code> quasar build -m capacitor -T android
</code></pre><p><img src="./data/buildapk.png" alt="apk build发布"></p>
<h4 id="android-app打包发布处理">Android APP打包发布处理 </h4>
<p><mark>注意：</mark></p>
<blockquote>
<p><u>apk文件实质上是zip压缩格式，再<strong>Android 11以上</strong>，apk需要进行4字节对齐。</u><br>
安卓SDK提供了 对齐工具zipalign。</p>
</blockquote>
<p>zipalign 是一种 zip 归档文件对齐工具。它可确保归档中的所有未压缩文件相对于文件开头都是对齐的。这样一来，您便可直接通过 mmap(2) 访问这些文件，而无需在 RAM 中复制相关数据并减少了应用的内存用量。</p>
<p>[Android 11 重打包对齐错误_failure <a href="https://blog.csdn.net/xys616/article/details/123892541">-124: failed parse during installpackagel-CSDN博客</a></p>
<p>下面参考来源：<a href="https://quasar.dev/quasar-cli-vite/developing-capacitor-apps/publishing-to-store">quasar官网publish to store</a></p>
<ol>
<li>
<p>使用JDK &gt;bin目录下的keytool工具，生成密钥store，需要输入和记住密码</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>keytool -genkey -v -keystore my-release-key.keystore -alias alias_name -keyalg RSA -keysize 2048 -validity 20000
</code></pre></li>
<li>
<p>使用zipalign 对齐apk安装包</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>$ zipalign -v 4 &lt;path-to-same-apk-file&gt; HelloWorld.apk
</code></pre></li>
<li>
<p>使用android sdk 下的build-tools中找到，apksigner 进行签名</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>apksigner sign --ks my-release-key.keystore --ks-key-alias alias_name &lt;path-to-unsigned-apk-file&gt;
</code></pre></li>
</ol>
<p>打包后安装示例：</p>
<center class="img">
<img title="安装app" src="./data/installapp.jpg" width="45%">
<img title="导航APP" src="./data/navigateapp.jpg" width="45%">
</center>
<h4 id="capacitor版本升级后无法打包问题">Capacitor版本升级后无法打包问题 </h4>
<p>capacitor升级到6.0.0后，导致app无法打包，报错：“Execution failed for task ':app:checkReleaseAarMetadata'.”</p>
<p>解决方法：</p>
<p>1、src-capacitor/android/variables.gradle中变量targetSdkVersion和compileSdkVersion值由33改为34</p>
<p><img src="./data/sdkversion.png" alt="sdkversion"></p>
<p>2、修改gradle-wrapper.properties里的gradle版本，路径为src-capacitor/android/gradle/wrapper/gradle-wrapper.properties</p>
<p>distributionUrl=https://mirrors.cloud.tencent.com/gradle**/gradle-8.2.1-all.zip**</p>
<p><img src="./data/gradle821.png" alt="gradle"></p>
<p>3、build.gradle的buildscrptip路径为src-capacitor/android/build.gradle的dependencies</p>
<p>classpath 'com.android.tools.build:gradle:8.2.1'</p>
<p><img src="./data/buildgradle.png" alt="buildgradle.png"></p>
<h4 id="node低版本16x下quasarapp-vite无法编译和capacitor无法打包问题">Node低版本16.x下@quasar/app-vite无法编译和Capacitor无法打包问题 </h4>
<p>原因：@quasar/app-vite 和 @capacitor/cli 都要求node版本大于18.0.0</p>
<p>解决方法：</p>
<ul>
<li>
<p>@quasar/app-vite的修改<img src="./data/quasarvite%E7%89%88%E6%9C%AC%E8%A6%81%E6%B1%82.png" alt="quasarvite版本要求"></p>
</li>
<li>
<p>@capacitor/cli的修改</p>
<p><img src="./data/clinode%E7%89%88%E6%9C%AC.png" alt="clinode版本"></p>
</li>
</ul>
<h3 id="capacitor-将file本地地址转换http地址">Capacitor 将file://本地地址转换http地址 </h3>
<p><a href="https://ionicframework.com/docs/core-concepts/webview#file-protocol">https://ionicframework.com/docs/core-concepts/webview#file-protocol</a></p>
<p><strong>File Protocol</strong></p>
<p>Capacitor and Cordova apps are hosted on a local HTTP server and are served with the <code>http://</code> protocol. Some plugins, however, attempt to access device files via the <code>file://</code> protocol. To avoid difficulties between <code>http://</code> and <code>file://</code>, paths to device files must be rewritten to use the local HTTP server. <u>For example, <code>file:///path/to/device/file</code> must be rewritten as <code>http://&lt;host&gt;:&lt;port&gt;/&lt;prefix&gt;/path/to/device/file</code> before being rendered in the app.</u></p>
<p>For Capacitor apps, convert file URIs like so:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword module keyword-import">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Capacitor</span> <span class="token punctuation">}</span></span> <span class="token keyword module keyword-from">from</span> <span class="token string">'@capacitor/core'</span><span class="token punctuation">;</span>

<span class="token maybe-class-name">Capacitor</span><span class="token punctuation">.</span><span class="token method function property-access">convertFileSrc</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>For Cordova apps, the <a href="https://github.com/ionic-team/cordova-plugin-ionic-webview">Ionic Web View plugin</a> provides a utility function for converting File URIs: <code>window.Ionic.WebView.convertFileSrc()</code>. There is also a corresponding Ionic Native plugin: <a href="https://ionicframework.com/docs/native/ionic-webview.md"><code>@awesome-cordova-plugins/ionic-webview</code></a>.</p>
<p>工程里示例代码：</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-function">function</span> <span class="token function">add3DTileModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> layer <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">TilesetLayer</span><span class="token punctuation">(</span><span class="token string">'layer'</span><span class="token punctuation">)</span>
  viewer<span class="token punctuation">.</span><span class="token function">addLayer</span><span class="token punctuation">(</span>layer<span class="token punctuation">)</span>
  <span class="token keyword keyword-const">const</span> filePath<span class="token operator">=</span><span class="token string">'file:///storage/emulated/0/Android/data/com.digsur.flight.navi/files/end3d/tileset.json'</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-let">let</span> tileset <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Tileset</span><span class="token punctuation">(</span>
    <span class="token comment">// 'end3d/tileset.json'</span>
    Capacitor<span class="token punctuation">.</span><span class="token function">convertFileSrc</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  tileset<span class="token punctuation">.</span><span class="token function">setHeight</span><span class="token punctuation">(</span><span class="token number">1420</span><span class="token punctuation">)</span>
  layer<span class="token punctuation">.</span><span class="token function">addOverlay</span><span class="token punctuation">(</span>tileset<span class="token punctuation">)</span>
  viewer<span class="token punctuation">.</span><span class="token function">flyToTarget</span><span class="token punctuation">(</span>tileset<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h2 id="iconify图标在线服务离线图标">Iconify图标在线服务+离线图标 </h2>
<p><a href="https://juejin.cn/post/7189164727485300793">23年了，icon 方案该升级了 - 掘金 (juejin.cn)</a></p>
<p>，<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ficonify%2Ficonify">iconify</a> 的方案充分利用 svg 能力，利用 <code>iconify.json</code> 存储图标矢量信息。再通过下游的不同消费方式，开发者可以制作任意自己喜欢的图标消费方式。利用开放的形态，成功的将生产端和消费端以一种非依赖的关系分开，使用者可以自由组合。在经过一些年的发展，又拥有海量的存量图标和丰富的生态。</p>
<p>在项目中，利用上述方案，我们在不改变设计师习惯的同时，保留了开发者熟悉工具，还创新的引入了更好的图标方案。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ficonify%2Ficonify">iconify</a> 方案中，我们可以避免上述提到的"字体"所带来的一切弊端，同时具备了以下几项优势：</p>
<ul>
<li><strong>按需引入</strong>，按照项目使用的图标打包产物，无惧新增</li>
<li><strong>自由组合</strong>，随便你需要使用什么图标，来自哪个包、哪个业务的图标，统统都是 SVG</li>
<li><strong>文字样式</strong>，所有图标产物具备文字样式控制，无对齐问题，可以直接通过样式控制其颜色、大小等</li>
<li><strong>多端</strong>，不论 PC、Mobile，不论你用什么组件库，开箱即用（只需容器支持 SVG）</li>
<li><strong>可复制</strong>，如果你不满意，或者设计师觉得不符合当前的业务，完全可以利用同样的方案，轻松制作另外一个 SVG 包（不超过 1 分钟）</li>
</ul>
<p>​	作者：YeeWang<br>
​	链接：<a href="https://juejin.cn/post/7189164727485300793">https://juejin.cn/post/7189164727485300793</a></p>
<h3 id="iconify图标在线服务使用-">**Iconify图标在线服务使用 ** </h3>
<ol>
<li><strong>为VSCode安装Iconify IntelliSense插件</strong></li>
</ol>
<p><img src="./data/001.png" alt=""></p>
<ol start="2">
<li><strong>前端工程中安装开发依赖 npm i -D @Iconify/vue</strong></li>
</ol>
<p><img src="./data/002.png" alt="IMG256"></p>
<ol start="3">
<li><strong>vue页面/组件开发中使用Iconify图标（默认为在线模式）</strong></li>
</ol>
<ul>
<li>
<ol>
<li>引用@Iconify/vue;</li>
</ol>
</li>
</ul>
<p><img src="./data/003.png" alt=""></p>
<ul>
<li>
<ol start="2">
<li>直接使用<icon>，默认使用官方的图标服务</icon></li>
</ol>
</li>
</ul>
<p><img src="./data/004.png" alt=""></p>
<p><img src="./data/005.png" alt=""></p>
<ul>
<li>
<ol start="3">
<li>如要使用自己图标在线服务地址，需在SysConfig.js里配置。</li>
</ol>
</li>
</ul>
<p>注意：服务地址最后不能带“/”</p>
<p><img src="./data/006.png" alt="IMG256"></p>
<h3 id="iconify图标在线服务列表">Iconify图标在线服务列表 </h3>
<p>提供符合Iconify标准服务接口的 在线SVG图标服务</p>
<ol>
<li><strong>国外服务地址</strong></li>
</ol>
<ul>
<li>
<p>默认官方<a href="https://icon-sets.iconify.design/">https://icon-sets.iconify.design/</a><br><br>
后台服务：<a href="https://api.iconify.design/">https://api.iconify.design/</a></p>
</li>
<li>
<p><a href="https://icon-sets.iconify.design/">https://icon-sets.iconify.design/</a><br><br>
后台服务：<a href="https://icones.js.org/collections/">https://icones.js.org/collections/</a></p>
</li>
</ul>
<ol start="2">
<li><strong>国内服务地址</strong></li>
</ol>
<ul>
<li><a href="https://gis-icon.digsur.com">https://gis-icon.digsur.com</a><br><br>
后台服务：<a href="https://gis-icon.digsur.com/online">https://gis-icon.digsur.com/online</a></li>
</ul>
<p><img src="./data/icononline.png" alt="icononline.png"></p>
<h3 id="离线icon图标使用说明">离线Icon图标使用说明 </h3>
<blockquote>
<p>使用情景：不部署icon图标服务或内网环境下</p>
</blockquote>
<p><u><strong>离线操作步骤：</strong></u><br>
<strong>如果项目部署是需要使用离线图标方式，在项目开发结束后，打包前进行如下设置和操作。</strong></p>
<ol>
<li>下载<strong>IconOffline.exe命令行工具</strong>，放在前端工程src同目录下，指定图标在线服务地址URL，运行扫描前端工程源码，生成图标离线注册文件。</li>
</ol>
<p><img src="./data/007.png" alt="%ZM$WRK6SM{7(M9`WGHU5UK"></p>
<ol start="2">
<li>成功后会在src下的components中见到生成的IconOffline.ts文件（有新增代码，重新生成离线图标文件）</li>
</ol>
<p><img src="./data/008.png" alt=""></p>
<ol start="3">
<li>将SysyConfig.js中的 <strong>IconServiceURL置空</strong>，重新启动工程或网站，即可切换到使用<strong>离线图标状态</strong>下。</li>
</ol>
<h2 id="vscode-用户代码片段">VSCode 用户代码片段 </h2>
<h3 id="codesnippets在线生成工具">CodeSnippets在线生成工具 </h3>
<p><a href="https://snippet-generator.app/">https://snippet-generator.app/</a></p>
<p><img src="./data/snippets1.png" alt="代码片段生成实例"></p>
<hr>
<h3 id="积累的代码片段代码">积累的代码片段代码 </h3>
<ul>
<li>
<p>代码片段存储位置</p>
<p>C:\Users\用户名\AppData\Roaming\Code\User\snippets</p>
</li>
<li>
<p>代码片段集合     <a href="./data/snippets20231219.zip">下载</a></p>
</li>
</ul>
<p><img src="./data/snippets2.png" alt="代码片段集合"></p>
<h2 id="开源前端工程">开源前端工程 </h2>
<h3 id="模板参考的前端工程">模板参考的前端工程 </h3>
<p><a href="https://github.com/york11122/quasar-admin-vue3-typescript">https://github.com/york11122/quasar-admin-vue3-typescript</a></p>
<p><a href="https://york11122.github.io/quasar-admin-vue3-typescript/#/login">https://york11122.github.io/quasar-admin-vue3-typescript/#/login</a></p>
<h4 id="基于vuequasar-的中后台前端解决方案">基于vue/quasar 的中后台前端解决方案 </h4>
<p><a href="https://gitee.com/incimo/vue-quasar-manage">https://gitee.com/incimo/vue-quasar-manage</a></p>
<p><a href="https://incimo.gitee.io/vue-quasar-manage">https://incimo.gitee.io/vue-quasar-manage</a></p>
<h4 id="quasar-sika-design-开箱即用的中台前端--设计解决方案">Quasar-Sika-Design 开箱即用的中台前端 / 设计解决方案 </h4>
<p><a href="https://github.com/sika-code-cloud/quasar-sika-design">https://github.com/sika-code-cloud/quasar-sika-design</a></p>
<p><a href="http://quasar.sikacode.com/">http://quasar.sikacode.com/</a></p>
<p><img src="./data/backadmin.png" alt="quasar admin"></p>
<h4 id="聚商汇wms-开源仓库管理系统">聚商汇WMS-开源仓库管理系统 </h4>
<p><a href="https://github.com/GreaterWMS/GreaterWMS">https://github.com/GreaterWMS/GreaterWMS</a></p>
<p>This Inventory management system is the currently Ford Asia Pacific after-sales logistics warehousing supply chain process . After I leave Ford , I start this project . You can share your vacant warehouse space, use it for those in need, and generate income</p>
<p><a href="https://www.56yhz.com/md/windows/zh-CN">https://www.56yhz.com/md/windows/zh-CN</a></p>
<p><a href="https://space.bilibili.com/407321291/channel/series">https://space.bilibili.com/407321291/channel/series</a></p>
<h4 id="cc-admin-基于quasar的后台管理系统">CC-ADMIN 基于Quasar的后台管理系统 </h4>
<p><a href="https://blog.51cto.com/u_15896157/5895903">https://blog.51cto.com/u_15896157/5895903</a></p>
<p><a href="https://github.com/zhy6599/cc-admin-web">https://github.com/zhy6599/cc-admin-web</a></p>
<p><a href="https://www.cc-admin.top/#/login">https://www.cc-admin.top/#/login</a></p>
<p><img src="./data/cc-admin.png" alt="cc-admin.png"></p>
<h4 id="基于-quasar-framework-开发的-electron-笔记应用">基于 Quasar Framework 开发的 Electron 笔记应用 </h4>
<p>vue全家桶+Electron+Quasar框架快速构建跨平台应用</p>
<p><a href="https://blog.csdn.net/leida_wt/article/details/113495857">https://blog.csdn.net/leida_wt/article/details/113495857</a></p>
<p>quasar-awesome</p>
<p><a href="https://github.com/quasarframework/quasar-awesome">https://github.com/quasarframework/quasar-awesome</a></p>
<p><a href="https://next-quasar-admin.netlify.app/">https://next-quasar-admin.netlify.app/</a>   mail</p>
<h2 id="开源成熟npm库收集与使用">开源成熟NPM库收集与使用 </h2>
<h3 id="1-前端http拦截">1. 前端http拦截 </h3>
<blockquote>
<p>拦截所有ajax请求并允许修改请求数据和响应数据！实际项目中可以用于请求添加<strong>统一签名、协议自动解析、接口调用统计、改为离线化资源</strong>等。</p>
<p>前端http拦截js库   xhook &gt; ajax-hook  &gt;xspy</p>
</blockquote>
<h4 id="xhook">xhook </h4>
<p>Easily intercept and modify XHR request and response</p>
<p>开源地址：<a href="https://github.com/jpillora/xhook">https://github.com/jpillora/xhook</a></p>
<p>NPM地址：<a href="https://www.npmjs.com/package/xhook">https://www.npmjs.com/package/xhook</a></p>
<p><strong><code>xhook.before(handler(request[, callback])[, index])</code></strong></p>
<p>Modifying <strong>any</strong> property of the <code>request</code> object will modify the underlying XHR before it is sent.</p>
<p>To make the <code>handler</code> is asynchronous, just include the optional <code>callback</code> function, which accepts an optional <code>response</code> object.</p>
<p>To provide a <strong>fake</strong> response, <code>return</code> <strong>or</strong> <code>callback()</code> a <code>response</code> object.</p>
<p><strong><code>xhook.after(handler(request, response[, callback]) [, index])</code></strong></p>
<p>Modifying <strong>any</strong> property of the <code>response</code> object will modify the underlying XHR before it is received.</p>
<p>To make the <code>handler</code> is asynchronous, just include the optional <code>callback</code> function.</p>
<p><strong><code>xhook.enable()</code></strong></p>
<p>Enables XHook (swaps out the native <code>XMLHttpRequest</code> class). XHook is enabled be default.</p>
<p><strong><code>xhook.disable()</code></strong></p>
<p>Disables XHook (swaps the native <code>XMLHttpRequest</code> class back in)</p>
<p><strong>响应结果对象结构：<code>response</code> Object</strong></p>
<ul>
<li><code>status</code> (Number) <strong>Required when for fake <code>response</code>s</strong> <em>(<a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest#status"><code>status</code></a>)</em></li>
<li><code>statusText</code> (String) <em>(<a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest#statusText"><code>statusText</code></a>)</em></li>
<li><code>text</code> (String) <em>(<a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest#responseText"><code>responseText</code></a>)</em></li>
<li><code>headers</code> (Object) (<em>Contains Name-Value pairs retrieved with <a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest#getAllResponseHeaders()"><code>getAllResponseHeaders()</code></a></em>)</li>
<li><code>xml</code> (XML) <em>(<a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest#responseXML"><code>responseXML</code></a>)</em></li>
<li><code>data</code> (Varies) <em>(<a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest#response"><code>response</code></a>)</em></li>
</ul>
<p>示例代码：返回假结果 <a href="https://github.com/jpillora/xhook/blob/main/example/fake-response.html">https://github.com/jpillora/xhook/blob/main/example/fake-response.html</a></p>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token operator">&lt;</span>h5<span class="token operator">&gt;</span>example3<span class="token punctuation">.</span><span class="token method function property-access">txt</span> <span class="token punctuation">(</span>which does not actually exist <span class="token operator">-</span> verify <span class="token keyword keyword-in">in</span> devtools<span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>h5<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>pre id<span class="token operator">=</span><span class="token string">"res"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>pre<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>h5<span class="token operator">&gt;</span>example3<span class="token punctuation">.</span><span class="token method function property-access">txt</span> <span class="token punctuation">(</span>which does not actually exist <span class="token operator">-</span> verify <span class="token keyword keyword-in">in</span> devtools<span class="token punctuation">)</span> <span class="token operator">-</span> fetch<span class="token operator">&lt;</span><span class="token operator">/</span>h5<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>pre id<span class="token operator">=</span><span class="token string">"fetch_res"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>pre<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"../dist/xhook.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">&gt;</span>

xhook<span class="token punctuation">.</span><span class="token method function property-access">before</span><span class="token punctuation">(</span><span class="token keyword keyword-function">function</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//asynchronously...</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword keyword-function">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//callback with a fake response</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
      <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'this is the third text file example (example3.txt)'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">Foo</span><span class="token operator">:</span> <span class="token string">'Bar'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//vanilla call</span>
<span class="token keyword keyword-var">var</span> xhr <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token method function property-access">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'example1.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'readystatechange'</span><span class="token punctuation">,</span> <span class="token keyword keyword-function">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'res'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">innerHTML</span> <span class="token operator">=</span> xhr<span class="token punctuation">.</span><span class="token property-access">responseText</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'example1.txt'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token keyword keyword-function">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-return">return</span> response<span class="token punctuation">.</span><span class="token method function property-access">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token keyword keyword-function">function</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'fetch_res'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">innerHTML</span> <span class="token operator">=</span> text<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><h4 id="ajax-hook">ajax-hook </h4>
<p>开源地址：<a href="https://github.com/wendux/ajax-hook">https://github.com/wendux/ajax-hook</a></p>
<p>原理：<a href="https://www.jianshu.com/p/7337ac624b8e">https://www.jianshu.com/p/7337ac624b8e</a></p>
<p>Ajax-hook实现的整体思路是实现一个XMLHttpRequest的代理对象，然后覆盖全局的XMLHttpRequest，</p>
<p><img src="./data/ajaxhook.png" alt="原理图"></p>
<p><a href="https://www.npmjs.com/package/ajax-hook">https://www.npmjs.com/package/ajax-hook</a></p>
<p>关键API</p>
<p><a href="https://www.npmjs.com/package/ajax-hook?activeTab=readme#proxyproxyobject-window"><code>proxy(proxyObject, [window\])</code></a></p>
<p>拦截全局<code>XMLHttpRequest</code></p>
<blockquote>
<p>注意：proxy 是通过ES5的getter和setter特性实现的，并没有使用ES6 的Proxy对象，所以可以兼容ES5浏览器。</p>
</blockquote>
<p>参数：</p>
<ul>
<li><code>proxyObject</code>是一个对象，包含三个可选的钩子<code>onRequest</code>、<code>onResponse</code>、<code>onError</code>，我们可以直接在这三个钩子中对请求进行预处理。</li>
<li><code>window</code>：可选参数，默认情况会使用当前窗口的<code>window</code>对象，如果要拦截iframe中的请求，可以将<code>iframe.contentWindow</code> 传入，注意，只能拦截<strong>同源</strong>的iframe页面（不能跨域）。</li>
</ul>
<p>返回值： <code>ProxyReturnObject</code></p>
<p>ProxyReturnObject 是一个对象，包含了 <code>unProxy</code> 和 <code>originXhr</code></p>
<ul>
<li><code>unProxy([window])</code>：取消拦截；取消后 <code>XMLHttpRequest</code> 将不会再被代理，浏览器原生<code>XMLHttpRequest</code>会恢复到全局变量空间</li>
<li><code>originXhr</code>： 浏览器原生的 <code>XMLHttpRequest</code></li>
</ul>
<p>示例代码：</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>let result: any
function loadProxy() {
 result = proxy({
    //请求发起前进入
    onRequest: (config, handler) =&gt; {
      const { url } = config;

      const start = url.startsWith('https://3ds');
      if (start) {
        console.log('拦截的URL', url);
        // const proxyURL=url.replace('//resource.dvgis.cn/data/3dtiles/dayanta/','//3ds/end3d/')
        get3DTilesFile(url,11).then(result =&gt; {
         const {data,isText}=result;
          handler.resolve({
            config,
            status: 200,
            headers: {
              'content-type':isText? 'application/json':'application/octet-stream',
              'content-length': result?.length ?? 0,
              'access-control-allow-origin': '*',
              'access-control-allow-methods': '*',
              'access-control-allow-headers': 'Origin,X-Requested-Width,Content-Type,Accept'
            },
            response: data,
          })   
        });
        return;
      }
      else
        handler.next(config);
    },
    //请求发生错误时进入，比如超时；注意，不包括http状态码错误，如404仍然会认为请求成功
    onError: (err, handler) =&gt; {
      console.log(err.type, err, '66666')
      handler.next(err)
    },
    //请求成功后进入
    onResponse: (response, handler) =&gt; {
      const url=response.config.url;
      // const start = url.indexOf('//resource.dvgis.cn')&gt;0;
      // if(start)
      // {
      //   console.log('555拦截返回结',url,response)
      //   handler.next(response);
      // }
      // else
        handler.next(response)
    }
  })
</code></pre><p>取消拦截代码</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token function">onUnmounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span>
     result<span class="token punctuation">.</span><span class="token function">unProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><h4 id="xspy">xspy </h4>
<p>Hook ajax request and/or response. Modify header, body, status, credentials, etc in request/response</p>
<ul>
<li>Catch fetch/XMLHttpRequest request before it is sent.</li>
<li>Catch fetch/XMLHttpRequest response before it is available to client.</li>
<li>Comes with type definitions by Typescript for great developer experience.</li>
<li>High test coverage</li>
<li>Works in modern browsers and <strong>IE9/10/11</strong>.</li>
</ul>
<p>开源地址：<a href="https://github.com/jpillora/xhook">https://github.com/jpillora/xhook</a></p>
<p><a href="https://www.npmjs.com/package/xspy">https://www.npmjs.com/package/xspy</a></p>
<p>示例：</p>
<ul>
<li>Add Authorization header if it doesn't exist on request header</li>
</ul>
<pre data-role="codeBlock" data-info="" class="language-text"><code>xspy.onRequest((req) =&gt; {
  if(!req.headers["Authorization"]){
    req.headers["Authorization"] = "bearer sakxxd0ejdalkjdalkjfajd";
  }
});
</code></pre><ul>
<li>Return fake API response without sending actual ajax request</li>
</ul>
<pre data-role="codeBlock" data-info="" class="language-text"><code>xspy.onRequest(async (request, sendResponse) =&gt; {
  var result = await someAsyncOperation();
  var response = {...};
  sendResponse(response);
});
</code></pre><ul>
<li>Log every response headers to console</li>
</ul>
<pre data-role="codeBlock" data-info="" class="language-text"><code>xspy.onResponse((req, res) =&gt; {
  console.log(res.url, res.status, res.headers);
});
</code></pre><h3 id="2-webworker相关类库">2. WebWorker相关类库 </h3>
<h4 id="vite-plugin-webworker-service">vite-plugin-webworker-service </h4>
<p><a href="https://www.npmjs.com/package/vite-plugin-webworker-service">https://www.npmjs.com/package/vite-plugin-webworker-service</a></p>
<p><strong>Vite plugin webworker service</strong> is a lightweight, powerful, and easy-to-use tool designed to make working with WebWorkers in your projects as seamless as possible.</p>
<p>The plugin generates a webworker file based on the used files ending in <strong>.service</strong>, as well as a bridge between the main thread and the webworker thread at build time, thereby allowing you to enjoy the reliability of typescript typechecks and various code editor tools, which cannot be achieved by directly using webworkers with postMessage and onmessage</p>
<ol>
<li>
<p>Install via npm:</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>npm install -D vite-plugin-webworker-service
</code></pre></li>
<li>
<p>Integrate in your project:</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>//vite.config.ts
import WebWorkerPlugin from 'vite-plugin-webworker-service';

export default defineConfig({
  plugins: [WebWorkerPlugin()]
})
</code></pre></li>
<li>
<p>vite or vite build</p>
</li>
<li>
<p>Start using it! Check out <strong>Usage</strong> for more detailed examples.</p>
</li>
</ol>
<p>使用方法：</p>
<p>Basic usage:</p>
<p><em>.ts/</em>.js</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>import { add } from "some.service.ts"
import { x2state } from "any.service.ts"

const res = await add(1,2)
console.log(res) // 3
await x2state() // state.value === 6
</code></pre><p>[some].<strong>service</strong>.ts</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>import { state } from 'state.ts'

// this function calculate in webworker
export async function add(a: number, b: number) {
    const res = a + b
    state.value = res
    return res
}
</code></pre><p>[any].<strong>service</strong>.ts</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>import { state } from 'state.ts'

// this function calculate in webworker
export async function x2state() {
    state.value = state.value * 2
}
</code></pre><ul>
<li>
<p>使用示例</p>
<p><img src="./data/workers_demo.png" alt="workers使用示例"></p>
</li>
</ul>
<h2 id="前端升级支持扫码登录方法">前端升级支持扫码登录方法 </h2>
<p>使用“帝测授权宝”APP -android版，实现前端系统的扫码登录。扫码APP是默认连接外网用户权限管理系统，也就是系统SysConfig.js的LoginAuthURL为：<a href="https://gis-auth.digsur.com">https://gis-auth.digsur.com</a></p>
<h3 id="使用antdesign版模版的升级">使用Antdesign版模版的升级 </h3>
<p>升级支持扫码登录需要修改内容：</p>
<p><img src="./data/%E6%89%AB%E7%A0%81%E7%99%BB%E5%BD%95%E5%8D%87%E7%BA%A7%E5%86%85%E5%AE%B9.png" alt="扫码登录升级内容"></p>
<ul>
<li>
<p>增加@microsoft/signalr依赖库</p>
<p>npm install @microsoft/signalr</p>
</li>
<li>
<p>SysConfig.js中APIPath，增加 SignalR:'chathub'</p>
<p><img src="./data/%E4%BF%AE%E6%94%B9sysconfigsignalr.png" alt="修改sysconfigsignalr.png"></p>
</li>
<li>
<p>修改或更新public/css/common.css</p>
<p>补充下面样式：</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>.righttop-login
{
  position: absolute;
  right: 0;
  top:0;
  width:50px;
  height:50px;
}
.loginQRCode
{
  margin:0 auto;
  width:250px;
  height:200px;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 16px;
}
.login-top-append
{
  font-size: 14px;  
  color:gray;
  text-align: center;
  margin-top: -10px;
  margin-bottom: 10px;
}
</code></pre></li>
<li>
<p>下载替换views/shared/login/index.vue文件</p>
<p><a href="./data/%E6%97%A7%E7%89%88%E6%9C%AClogin-index.vue" title="index.vue">旧版本的login-index.vue</a></p>
</li>
<li>
<p>补充与替换登录相关图片</p>
<p><img src="./data/%E6%89%AB%E7%A0%81%E5%BC%80%E5%85%B3.png" alt="扫码切换图标"></p>
<p><a href="./data/%E6%89%AB%E7%A0%81%E5%9B%BE%E6%A0%87.zip">扫码图标.zip下载</a></p>
</li>
</ul>
<h3 id="使用quasar版模版的升级">使用Quasar版模版的升级 </h3>
<ul>
<li>
<p>修改或更新public/css/common.css</p>
<p>补充下面样式：</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>.righttop-login
{
  position: absolute;
  right: 0;
  top:0;
  width:50px;
  height:50px;
}
.loginQRCode
{
  margin:0 auto;
  width:250px;
  height:200px;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 16px;
}
.login-top-append
{
  font-size: 14px;  
  color:gray;
  text-align: center;
  margin-top: -10px;
  margin-bottom: 10px;
}
</code></pre></li>
<li>
<p>下载替换pages/shared/login/index.vue文件</p>
<p><a href="./data/%E6%96%B0login-index.vue" title="index.vue">新login-index.vue</a></p>
</li>
<li>
<p>补充与替换登录相关图片</p>
<p><img src="./data/%E6%89%AB%E7%A0%81%E5%BC%80%E5%85%B3.png" alt="扫码切换图标"></p>
<p><a href="./data/%E6%89%AB%E7%A0%81%E5%9B%BE%E6%A0%87.zip">扫码图标.zip下载</a></p>
</li>
</ul>
<h2 id="xframelib使用知识点">*xframelib使用知识点 </h2>
<h3 id="0-layout使用方法">0. Layout使用方法 </h3>
<h4 id="1layoutcontainer使用获取对应的layoutmanager">1）LayoutContainer使用，获取对应的LayoutManager </h4>
<ul>
<li>
<p>关闭加载动画，在onMounted中调用   <strong><u>Global.Loading('end');</u></strong></p>
</li>
<li>
<p>@containerLoaded 是处理和获取对应LayoutManager对象；内部会发送SysEvents.LayoutContainerLoaded，通知该LayoutContainer容器被加载</p>
</li>
</ul>
<p>示例代码：</p>
<pre data-role="codeBlock" data-info="vue" class="language-vue vue"><code>&lt;template&gt;
    &lt;LayoutContainer
      id="flydemoLayoutContainer"
      :widgetConfig="configRef"
      :layoutID="layoutIDRef"
      @containerLoaded="loadedHandler"
    &gt;
    &lt;/LayoutContainer&gt;
  &lt;/template&gt;
  
  &lt;script lang="ts" setup&gt;
  import { getRightWidgetConfig } from 'src/permission';
import { defineOptions,onMounted, onUnmounted, ref } from 'vue';
import { Global,LayoutContainer, LayoutManager } from 'xframelib';
  
  defineOptions({
    name: 'flydemoLayout'
  });
  
  const configRef = ref(getRightWidgetConfig());
  const layoutIDRef = ref('flydemoLayout');
  //要加载的Widget列表 
  const initWidgetIDs=["MapDemoWidget"];
  let layoutManager: LayoutManager;
  //获取服务此Layout的layoutManager
  function loadedHandler(evt: any) {
    layoutManager=evt.layoutManager;
    if(layoutManager)
    {
        initWidgetIDs.forEach(id=&gt;{
            //加载组件
            layoutManager.loadWidget(id);
        });
    }
  }
 onMounted(()=&gt;{
     //关闭加载动画
  Global.Loading('end');
 })
  onUnmounted(()=&gt;{
    if(layoutManager)
    {   
        //卸载组件
        initWidgetIDs.forEach(id=&gt;{
            layoutManager.unloadWidget(id);
        });
    }

  });
  &lt;/script&gt;
  
  &lt;style scoped lang="scss"&gt;
  :deep(.centerdiv) {
    pointer-events: none !important;
    &gt;*{
      pointer-events:auto;
    }
  }
  &lt;/style&gt;
  
</code></pre><h4 id="2视图页面中获取对应的layoutmanger">2）视图页面中获取对应的LayoutManger </h4>
<p>监听SysEvents.LayoutContainerLoaded事件，传入参数为 {layoutID,layoutManager}。</p>
<blockquote>
<p><strong>注意</strong>：首次加载时，视图可能先于LayoutManager构建出来，就需要使用监听方式</p>
</blockquote>
<p>示例代码关键代码</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>import { OnEventHandler,OffEventHandler } from 'src/events';
import { onMounted, onUnmounted } from 'vue';
import { Global,LayoutManager,SysEvents } from 'xframelib';

let layoutManager: LayoutManager|undefined;
OnEventHandler(SysEvents.LayoutContainerLoaded,init);
function init(evt)
{
    if(evt.layoutID==='flydemoLayout')
    {
      load(evt.layoutManager);
      OffEventHandler(SysEvents.LayoutContainerLoaded,init);
   } 
}
</code></pre><p>完整视图实例代码：GameControl.vue</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>&lt;template&gt;
&lt;/template&gt;
&lt;script setup lang="ts"&gt;
import { OnEventHandler,OffEventHandler } from 'src/events';
import { onMounted, onUnmounted } from 'vue';
import { Global,LayoutManager,SysEvents } from 'xframelib';

  //要加载的Widget列表
const initWidgetIDs=["GameControlWidget",'KeyboardControlWidget','PanelDataWidget2'];
let layoutManager: LayoutManager|undefined;
OnEventHandler(SysEvents.LayoutContainerLoaded,init);
function init(evt)
{
    if(evt.layoutID==='flydemoLayout')
    {
      load(evt.layoutManager);
      OffEventHandler(SysEvents.LayoutContainerLoaded,init);
   } 
}
function load(layoutmanager:LayoutManager)
{
  layoutManager= layoutmanager;
        if(layoutManager)
        {
            initWidgetIDs.forEach(id=&gt;{
                layoutManager?.loadWidget(id);
            })
        }
}
onMounted(()=&gt;{
    layoutManager= Global.LayoutMap.get("flydemoLayout");
    if(layoutManager)
    load(layoutManager);
});
onUnmounted(()=&gt;{
    OffEventHandler(SysEvents.LayoutContainerLoaded,init);
    if(layoutManager)
    {
      layoutManager?.unloadWidgets(initWidgetIDs);
    }
})
&lt;/script&gt;
&lt;style scoped&gt;&lt;/style&gt;
</code></pre><h4 id="3layoutcontainer的插槽应用">3）LayoutContainer的插槽应用 </h4>
<p>LayoutContainer的<strong>具名插槽</strong>有：<strong>main、back、front、left、right、bottom</strong>，默认插槽为 <strong>default</strong></p>
<p>LayoutContainer容器代码（部分）如下：</p>
<pre data-role="codeBlock" data-info="vue" class="language-vue vue"><code>&lt;template&gt;
  &lt;div class="layoutContainer" :style="containerStyle"&gt;
    &lt;div ref="topContainer" class="topContainer"&gt;
      &lt;slot name="top"&gt;&lt;/slot&gt;
      &lt;component v-for="[key, item] in topContainerComponents" :ref="(el) =&gt; setItemRef(el, key)" :key="key" :is="item"&gt;
      &lt;/component&gt;
    &lt;/div&gt;
    &lt;div&gt;
      &lt;!-- 主要容器-底部 --&gt;
      &lt;div ref="centerMainContainer" class="centerdiv mainContainer" v-if="isEnableRouterView"&gt;
        &lt;slot name="main"&gt;
          &lt;router-transition&gt;&lt;/router-transition&gt;
        &lt;/slot&gt;
      &lt;/div&gt;
      &lt;!-- 上一层-主容器 --&gt;
      &lt;div ref="centerBackContainer" class="centerdiv backContainer"&gt;
        &lt;slot name="back"&gt;&lt;/slot&gt;
        &lt;component v-for="[key, item] in centerbackComponents" :ref="(el) =&gt; setItemRef(el, key)" :key="key" :is="item"&gt;
        &lt;/component&gt;
      &lt;/div&gt;
      &lt;!-- 最上浮动-主容器 --&gt;
      &lt;div ref="centerFrontContainer" class="centerdiv centerFrontContainer"&gt;
        &lt;slot name="front"&gt;&lt;/slot&gt;
        &lt;component v-for="[key, item] in centerfrontComponents" :ref="(el) =&gt; setItemRef(el, key)" :key="key"
          :is="item"&gt;&lt;/component&gt;
      &lt;/div&gt;

      &lt;div ref="leftContainer" class="leftContainer"&gt;
        &lt;slot name="left"&gt;&lt;/slot&gt;
        &lt;component v-for="[key, item] in leftContainerComponents" :ref="(el) =&gt; setItemRef(el, key)" :key="key"
          :is="item"&gt;&lt;/component&gt;
      &lt;/div&gt;

      &lt;div ref="rightContainer" class="rightContainer"&gt;
        &lt;slot name="right"&gt;&lt;/slot&gt;
        &lt;component v-for="[key, item] in rightContainerComponents" :ref="(el) =&gt; setItemRef(el, key)" :key="key"
          :is="item"&gt;&lt;/component&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div ref="bottomContainer" class="bottomContainer"&gt;
      &lt;slot name="bottom"&gt;&lt;/slot&gt;
      &lt;component v-for="[key, item] in bottomContainerComponents" :ref="(el) =&gt; setItemRef(el, key)" :key="key"
        :is="item"&gt;&lt;/component&gt;
    &lt;/div&gt;
    &lt;!-- 增加默认插槽 --&gt;
    &lt;slot name="default"&gt;&lt;/slot&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre><ul>
<li>
<p><strong>具名插槽back使用</strong></p>
<p><img src="./data/layoutSlotBackCode.png" alt="示例代码"></p>
<p><img src="./data/layoutSlotBack.png" alt="具名插槽back使用示例"></p>
</li>
<li>
<p><strong>示例代码</strong>：</p>
</li>
</ul>
<pre data-role="codeBlock" data-info="vue" class="language-vue vue"><code>&lt;template&gt;
    &lt;LayoutContainer
      id="flydemoLayoutContainer"
      :widgetConfig="configRef"
      :layoutID="layoutIDRef"
      @containerLoaded="loadedHandler"
    &gt;
    &lt;template #back&gt;  
       &lt;div style="background-color: #f00;height:100%"&gt;这是布局对象的SLot插入内容背景          &lt;/div&gt;
    &lt;/template&gt;
    &lt;/LayoutContainer&gt;
  &lt;/template&gt;
  
  &lt;script lang="ts" setup&gt;
  &lt;/script&gt;
  
  &lt;style scoped lang="scss"&gt;
  :deep(.centerdiv) {
    pointer-events: none !important;
    &gt;*{
      pointer-events:auto;
    }
  }
  &lt;/style&gt;
  
</code></pre><h3 id="1-v077之前通用知识点">1. V0.7.7之前通用知识点 </h3>
<h4 id="1widget组件如何才能支持隐藏和打开可见性控制">1）Widget组件如何才能支持“隐藏”和“打开”——可见性控制 </h4>
<p><em>widget需要对外暴露 isShow属性 和 changeVisible方法</em></p>
<ul>
<li>可见性控制的Widget模版代码</li>
</ul>
<pre data-role="codeBlock" data-info="vue" class="language-vue vue"><code>&lt;template&gt;
   &lt;div v-show="isShow"&gt;
       &lt;span&gt;能支持“隐藏”和“打开”——可见性控制的Widget示例模版&lt;/span&gt;
   &lt;/div&gt;
&lt;/template&gt;
&lt;script lang="ts" setup&gt;
import { onMounted, ref } from 'vue';
onMounted(() =&gt; {

})
/**
* 对外暴露接口
*/
const isShow = ref(true);
function changeVisible(isVisible: boolean = false) {
   isShow.value = isVisible;
}
defineExpose({ changeVisible, isShow });
&lt;/script&gt;
&lt;style lang="scss" scoped&gt;&lt;/style&gt;
</code></pre><h4 id="2监听后续widget组件是否加载了">2）监听后续Widget组件是否加载了 </h4>
<p>import { SysEvents} from 'xframelib';</p>
<p>import {OffEventHandler,OnEventHandler} from 'src/events/index';</p>
<p>OnEventHandler(SysEvents.WidgetLoadedEvent,onWidgetLoaded);</p>
<pre class="language-text">      function onWidgetLoaded(evt2)
      {
        if(evt2.layoutID===_LayoutID&amp;&amp;evt2.widgetID===_widgetID)
          {
            //TODO:做事情
            OffEventHandler(SysEvents.WidgetLoadedEvent,onWidgetLoaded);
          }
      }
      OnEventHandler(SysEvents.WidgetLoadedEvent,onWidgetLoaded);
</pre>
<h4 id="3使用hprose的序列化与反序列化">3）使用Hprose的序列化与反序列化 </h4>
<p>Hprose序列化协议规范：<a href="https://github.com/hprose/hprose/tree/master/3.0">https://github.com/hprose/hprose/tree/master/3.0</a></p>
<p><a href="https://github.com/hprose/hprose/blob/master/3.0/Hprose%203.0%20%E5%BA%8F%E5%88%97%E5%8C%96%E5%8D%8F%E8%AE%AE%E8%A7%84%E8%8C%83.mediawiki">https://github.com/hprose/hprose/blob/master/3.0/Hprose 3.0 序列化协议规范.mediawiki</a></p>
<p>建议：使用Hprose的序列化取代JSON序列化</p>
<p>原因：</p>
<ul>
<li>1、类似二进制的，数据量小，更安全</li>
<li>2、保持类型不变，跨语言的  (json虽然也跨语言，但不同语言解析出来的有差异，导致类型丢失或类型转换错)</li>
</ul>
<p>使用方法：</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> deserialize<span class="token punctuation">,</span> serialize <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'xframelib'</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> testObj<span class="token operator">=</span><span class="token punctuation">{</span>
  <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"wangming"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"age"</span><span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span>
  <span class="token string-property property">"other"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"111"</span><span class="token punctuation">,</span>
    <span class="token number">2222</span><span class="token punctuation">,</span>
    <span class="token string">"test"</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//序列化</span>
<span class="token keyword keyword-const">const</span> result<span class="token operator">=</span><span class="token function">serialize</span><span class="token punctuation">(</span>testObj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'序列化结果：'</span><span class="token punctuation">,</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//反序列化对象</span>
<span class="token keyword keyword-const">const</span> obj<span class="token operator">=</span><span class="token function">deserialize</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'反序列化对象：'</span><span class="token punctuation">,</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>结果如下：</p>
<p><img src="./data/hprose_serialize.png" alt="hprose序列化与反序列化"></p>
<h4 id="4h5tool中复制文本">4）H5Tool中复制文本 </h4>
<p><strong>H5Tool支持的复制文本方法</strong></p>
<ul>
<li><strong>copyTextByCommand</strong> （旧方式，用的技术 <u>document.execCommand('copy');</u>）</li>
<li><strong>copyText</strong>     （新方式，使用navigator.clipboard.writeText）</li>
<li><strong>copyElementTextByCommand</strong>   （旧方式，通过节点复制文本）</li>
<li><strong>copyElementText</strong>    （新方式）</li>
</ul>
<h3 id="2-v078新增的">2. V0.7.8新增的 </h3>
<h4 id="1-globalgetlayoutmanager通过widgetid反向获取layoutmanager">1） Global.getLayoutManager通过WidgetID反向获取LayoutManager </h4>
<p>Global.WidgetConfigList存储所有的WidgetSetting，在开发模版的src/permission/index.ts的getRightWidgetConfig()方法里进行的初始化</p>
<p><img src="./data/WidgetConfigList.png" alt="WidgetConfigList初始化"></p>
<p>通过WidgetID反向获取LayoutManager</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code>        <span class="token keyword keyword-const">const</span> tmpLayoutManager <span class="token operator">=</span> Global<span class="token punctuation">.</span><span class="token function">getLayoutManager</span><span class="token punctuation">(</span>widgetID<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        tmpLayoutManager<span class="token operator">?.</span><span class="token function">changeWidgetVisible</span><span class="token punctuation">(</span>widgetID<span class="token punctuation">.</span>value<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4 id="2xwindow组件如何使用">2）XWindow组件如何使用 </h4>
<p>vue仿win窗口实现悬浮窗拖动，调整大小，最大化，复原。</p>
<ul>
<li>
<p>同类开源工程和示例</p>
<p><a href="https://github.com/mxywds/vue-float-window-pro">https://github.com/mxywds/vue-float-window-pro</a></p>
<p><a href="https://vue-float-window-pro.pages.dev/">https://vue-float-window-pro.pages.dev/</a></p>
<p><a href="https://github.com/AshOnDiscord/floatingVueWM">https://github.com/AshOnDiscord/floatingVueWM</a></p>
</li>
<li>
<p>对外暴露的属性字段</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>{
    top: {
        type: (StringConstructor | NumberConstructor)[];
        default: number;
    };
    left: {
        type: (StringConstructor | NumberConstructor)[];
        default: number;
    };
    nWidth: {
        type: (StringConstructor | NumberConstructor)[];
        default: string;
    };
    nHeight: {
        type: (StringConstructor | NumberConstructor)[];
        default: string;
    };
    icon: {
        type: StringConstructor;
        default: string;
    };
    title: {
        type: StringConstructor;
        default: string;
    };
    titleHeight: {
        type: (StringConstructor | NumberConstructor)[];
        default: string;
    };
    hasMin: {
        type: BooleanConstructor;
        default: boolean;
    };
    hasMax: {
        type: BooleanConstructor;
        default: boolean;
    };
    hasClose: {
        type: BooleanConstructor;
        default: boolean;
    };
    isDark: {
        type: BooleanConstructor;
        default: boolean;
    };
    pid: {
        type: StringConstructor;
        default: string;
    };
    tag: {
        type: (StringConstructor | NumberConstructor | ArrayConstructor | ObjectConstructor)[];
        default: string;
    };
}
</code></pre></li>
<li>
<p>对外暴露的事件</p>
<p>("close" | "open" | "loaded" | "minimize"}</p>
</li>
<li>
<p>使用示例</p>
<p><strong>import { XWindow, XWindowManager,WindowsMap,MinWindowMap } from 'xframelib';</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>&lt;template&gt;
    &lt;XWindow v-show="isShow" top="10px" left="10px" nWidth="300px" nHeight="400px" title="XWindowWidget模版"
        icon="img/basicimage/arcgis_img.png" :hasMax="true"pid="widgetID"  @loaded="loadedHandle" @close="doClosePanel"&gt;
        &lt;span&gt;这是XWindowWidget模版，窗体的内容示例&lt;/span&gt;
    &lt;/XWindow&gt;
&lt;/template&gt;
</code></pre><h4>3）SysConfig.UI.Theme主题样式支持</h4>
<h4>4）SysConfig.Enables控制外部资源动态引入</h4>
</li>
</ul>
<pre data-role="codeBlock" data-info="" class="language-text"><code>  //#region **********用于控制功能是否启用
 Enables:{
   TurfAsync:true,
   CesiumOfflineCache:true,//Cesium缓存
 }
 //#endregion
</code></pre><p>在App.vue的onBeforeMount()函数里添加控制代码<br>
<img src="./data/Enables%E6%8E%A7%E5%88%B6.png" alt="Enables控制"></p>
<ul>
<li>TurfAsync 异步函数库是否启用</li>
</ul>
<pre data-role="codeBlock" data-info="" class="language-text"><code>	   //参考：https://github.com/zorrowm/turf-async
	    //启用turfAsync
	    if(Global.Config.Enables.TurfAsync)
	    {
	      loadScript('./js/turf-async/index.js');
	    }
</code></pre><ul>
<li>Cesium离线缓存功能是否启用</li>
</ul>
<pre data-role="codeBlock" data-info="" class="language-text"><code>	     //启用Cesium缓存
	    if(Global.Config.Enables.CesiumOfflineCache)
	    {
	      loadScript('./js/CesiumOfflineCache.min.js');
	    }
</code></pre><p>在CesiumViewerWidget.vue里，setup中启用cesium缓存功能</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>    //参考：https://github.com/zorrowm/CesiumOfflineCache
    if (Global.Config.Enables.CesiumOfflineCache) {
      (window as any).CesiumOfflineCache?.ruleList?.add('*');
    }
</code></pre><h3 id="3-v079">3. V0.7.9 </h3>
<h4 id="1每个layoutmanager对象自动加载到globallayoutmap里">1）每个LayoutManager对象自动加载到Global.LayoutMap里 </h4>
<p>旧LayoutContainer代码<br>
<img src="./data/LayoutContainerInit_old.png" alt="旧LayoutContainer初始化代码"></p>
<p>新代码示例——节选，也可以去掉containerLoaded事件监听</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>&lt;template&gt;
  &lt;div class="dc-container"&gt;
    &lt;LayoutContainer :widgetConfig="configRef" :layoutID="layoutIDRef" /&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script lang="ts"&gt;
import { getRightWidgetConfig } from 'src/permission';
import { appStore } from 'src/stores';
import { defineComponent, onMounted, ref } from 'vue';
import { Global, H5Tool, LayoutContainer } from 'xframelib';

export default defineComponent({
  name: 'bigScreenLayout',
  components: {
    LayoutContainer
  },
  setup(props, { attrs, slots, emit }) {
    const widgetCofig = getRightWidgetConfig();
    const configRef = ref(widgetCofig);
    const layoutIDRef = ref('bigScreenLayout');
    //获取服务此Layout的layoutManager
    // function loadedHandler(evt: any) {
    //   if (evt.layoutID === layoutIDRef.value) {
    //     //Global.Logger().debug(evt, 'loadedHandler');
    //     Global.LayoutMap.set(evt.layoutID, evt.layoutManager);
    //   }
    // }
</code></pre><h4 id="2监听syseventslayoutcontainerloaded来判断layoutmanager已经构建">2)监听SysEvents.LayoutContainerLoaded来判断LayoutManager已经构建 </h4>
<blockquote>
<p>​    OnEventHandler(<strong>SysEvents.LayoutContainerLoaded</strong>, initHandler);  来监听判断LayoutContainer已经加载好了。（主要用于LayoutContainer放在Widget里做容器时）</p>
</blockquote>
<p>示例代码如下：</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>&lt;template&gt;
  &lt;TransitionSlide enter="fadeInUp" leave="fadeOutUp"&gt;
    &lt;APIExamplePanel v-if="apiExamplesList" :data="apiExamplesList" @contentItemClicked="doItemClickHandler" /&gt;
  &lt;/TransitionSlide&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import APIExamplePanel from 'components/Quasar/APIExample/index.vue';
import TransitionSlide from 'components/TransitionSlide.vue';
import { onMounted,ref } from 'vue';
import {  Global, LayoutManager, SysEvents } from 'xframelib';
import { useRoute, useRouter } from 'vue-router';
import { OffEventHandler, OnEventHandler } from 'src/events';
import SystemsEvent from 'src/events/modules/SystemsEvent';

const route=useRoute();
const router = useRouter();
const apiExamplesList = ref&lt;any[]&gt;();
//异步加载数据
import('src/settings/apiExampleSetting/cesium/index').then((p) =&gt; {
  apiExamplesList.value = p.default;
});

let currentItem:any;
let layoutManagerExamples: LayoutManager;
//新的容器widget
const layoutWidgetID = 'frontLayoutWidget';
function initHandler(data)
{
  if(Global.LayoutMap.has(layoutWidgetID))
  {
    layoutManagerExamples = Global.LayoutMap.get(layoutWidgetID);
    OffEventHandler(SysEvents.LayoutContainerLoaded, initHandler);
    cesiumLoadedHandler();
  }
}

function cesiumLoadedHandler()
{
  if(layoutManagerExamples&amp;&amp;currentItem?.path)
  {
    console.log('开始加载：',currentItem.path)
      layoutManagerExamples.loadWidget(currentItem.path);
  }
  else
  {
    console.log('失败加载：',currentItem.path)
  }
}

function doItemClickHandler(it) {
  currentItem=it;
  //主页面的LayoutManager
  const mainlayoutManager: LayoutManager = Global.LayoutMap.get('productLayout');

  if(route.query?.wid!=it.path)
    router.push({query:{wid:it.path}});

  if (!mainlayoutManager.isWidgetLoaded(layoutWidgetID)) {
  
    OnEventHandler(SysEvents.LayoutContainerLoaded, initHandler);
    mainlayoutManager.loadWidget(layoutWidgetID).then(() =&gt; {
       //首次直接加载
      console.log('首次直接加载',layoutWidgetID);
      //首次直接加载
    });
  } else {
    layoutManagerExamples = Global.LayoutMap.get(layoutWidgetID);
    if (layoutManagerExamples) {
      let isExist = false;
      const excludeWidgetIDs = ['cesiumWidget', it.path];
      layoutManagerExamples.unloadAllWidgets(excludeWidgetIDs);
      isExist = layoutManagerExamples.isWidgetLoaded(it.path);
      if (!isExist) {
        //没有加载，则加载
        layoutManagerExamples.loadWidget(it.path);
      } else {
        console.log('让widget可见');
        layoutManagerExamples.changeWidgetVisible(it.path, true);
      }
    }

    mainlayoutManager.getWidgetComponent(layoutWidgetID).changeVisible(true);
  }
}

onMounted(()=&gt;{
  const wid=route.query?.wid;
  if(wid)
  {
    setTimeout(() =&gt; {
      doItemClickHandler({path:wid});
    }, 500);

  }
})
&lt;/script&gt;

</code></pre><h4 id="3强化widget链式排队加载通过afterid实现顺序加载">3）强化Widget链式排队加载，通过afterid实现顺序加载 </h4>
<blockquote>
<p>通过SysEvents.WidgetLoadedEvent实现，等待父组件加载后，再加载当前子组件，实现链式依赖的顺序加载</p>
</blockquote>
<p>核心代码片段如下：</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code> {
          const self=this;
          const afterID=widgetTarget.afterid;
          const laterWidget=widgetTarget;
          function onWidgetLoaded(evt2)
          {
            if(evt2.layoutID===self._LayoutID&amp;&amp;evt2.widgetID===afterID)
              {
                self._loadWidget(laterWidget);
                // console.log('0000晚加载widget',laterWidget);
                Global.EventBus.off(SysEvents.WidgetLoadedEvent,onWidgetLoaded);
              }
          }
          Global.EventBus.on(SysEvents.WidgetLoadedEvent,onWidgetLoaded);
          return this.loadWidget(widgetTarget.afterid);
        }
</code></pre><h4 id="4为h5tool增加dom操作方法等">4)为H5Tool增加DOM操作方法等 </h4>
<p>H5Tool新增相关方法如下</p>
<ul>
<li>getRandomNum 获取范围内的随机数</li>
<li>formatNum 格式化小数</li>
<li>trim 去除空格</li>
<li>splitWords 按空格分割字符串</li>
<li>emptyImageUrl</li>
<li>debounce、throttle</li>
<li>create DOM创建</li>
<li>getStyle 获取样式</li>
<li>removeElement 移除元素</li>
<li>addClass、removeClass、setClass，添加移除class</li>
<li>createSvgElement创建SVG要素</li>
</ul>
<h3 id="4-v080">4. V0.8.0 </h3>
<h4 id="1统一修改各层样式">1)统一修改各层样式 </h4>
<blockquote>
<p>统一修改各层样式，默认空白区域鼠标可以穿越，各元素鼠标可点击</p>
</blockquote>
<p>默认各层容器样式改为，例如：</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>.leftContainer {
  position: absolute;
  top: 0px;
  left: 0px;
  z-index: var(--layout-left-zindex);
  height: 100%;
  pointer-events: none;
  &gt;* {
    pointer-events: all !important;
  }
}
</code></pre><h3 id="5-v081">5. V0.8.1 </h3>
<h4 id="1增加routertransitionanimate组件">1)增加RouterTransitionAnimate组件 </h4>
<blockquote>
<p>增加具有默认动画的RouterTransitionAnimate组件</p>
<p>RouterTransitionAnimate支持视图切换时，自带动画效果，也可以修改设置动画效果</p>
</blockquote>
<p>该组件的代码为：</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>&lt;template&gt;
  &lt;SuspenseWithError&gt;
    &lt;router-view v-slot="{ Component, route }"&gt;
      &lt;transition-group appear
        :enter-active-class="enterActive"
        :leave-active-class="leaveActive"
      &gt;
        &lt;keep-alive &gt;
          &lt;component v-if="route.meta.keepAlive"  :is="Component"  :key="route.name" /&gt;
        &lt;/keep-alive&gt;
        &lt;component  v-if="!route.meta.keepAlive" :is="Component" :key="route.name" /&gt;
      &lt;/transition-group&gt;
    &lt;/router-view&gt;
  &lt;/SuspenseWithError&gt;
&lt;/template&gt;

&lt;script lang="ts" setup&gt;
import SuspenseWithError from './SuspenseWithError.vue';
defineOptions({ name: 'RouterTransition' });
interface Props {
    enterActive?: string;
    leaveActive?:string;
}
//参考：https://quasar.dev/options/animations#usage
const props = withDefaults(defineProps&lt;Props&gt;(), {
  enterActive:"animated fadeIn",
  leaveActive:"animated fadeOut"
});
&lt;/script&gt;
</code></pre><h4 id="2widget配置支持外部配置样式重要">2)widget配置支持外部配置样式（重要） </h4>
<blockquote>
<p>widget配置对象（IWidgetConfig）启用layout属性（IWidgetLayout布局样式），增加cssClass外部配置样式类</p>
</blockquote>
<p>IWidgetConfig配置接口对象，变化的两个属性：</p>
<p><img src="./data/iwidgetconfig_cssClass.png" alt="widgetConfig配置对象外部样式"></p>
<ul>
<li><strong>应用示例</strong></li>
</ul>
<p>以前端开发模板里的 <u>src/widgets/portal/PortalHeaderTitleWidget.vue</u>为例</p>
<p><img src="./data/portal_header_style_example.png" alt="PortalHeaderTitleWidget.vue"></p>
<ol>
<li>
<p>给Widget配置外部布局和CSS样式</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>/**
 * 组件配置项
 */
const defaultWidgetCofig: Array&lt;IWidgetConfig&gt; = [
  {
    layoutID: 'portalLayout', //归属组
    id: 'HeaderTitleWidget',
    label: '头部栏',
    container: LayoutContainerEnum.top,
    component: () =&gt; import('src/widgets/portal/PortalHeaderTitleWidget.vue'),
    preload: true,
    layout:{
      top:30,
      left:10,
      width:"100%",
      height:"30px",
      background:"#f00"
    },
    cssClass:"a1 a2"
  },
</code></pre><p><img src="./data/widgetConfig_style.png" alt="配置外部样式和布局"></p>
</li>
<li>
<p>在Layout或对应视图里定义类名为a1、a2的样式</p>
<p><img src="./data/portalLayout_a1a2.png" alt=""></p>
</li>
<li>
<p>加载后效果——外部样式应用</p>
<p><img src="./data/portal_header_outstyle.png" alt="外部样式应用结果"></p>
</li>
</ol>
<h3 id="6-v082">6. V0.8.2 </h3>
<blockquote>
<p>修改VueWindow组件（VWindow）拖动定位错误;弃用DownloadByUrl方法;移除窗体同步库WSynchro.js;更新依赖库版本;</p>
</blockquote>
<p><strong>重点：</strong> <strong>修改VueWindow组件（VWindow）拖动定位错误</strong></p>
<h2 id="重要业务组件使用">*重要业务组件使用 </h2>
<h3 id="0-qlayoutmaincontainer组件">0. QLayoutMainContainer组件 </h3>
<blockquote>
<p><strong>解决LayoutContainer与QLayout等组件的兼容使用问题</strong></p>
<p>用于LayoutContainer的mainContainer容器的router-view页面切换；</p>
<p>以支持视图里使用 QPage、QFoot等组件（这些Quasar组件要求必须放在QLayout里）</p>
</blockquote>
<ul>
<li>
<p>使用范围</p>
<p>web /mobile app/ electron</p>
</li>
<li>
<p>安装依赖</p>
<p>无</p>
</li>
<li>
<p>组件路径和方法</p>
<p>src/components/Quasar/QLayoutMainContainer/index.vue</p>
</li>
<li>
<p>使用示例</p>
<p>在Layouts里使用，例如：backLayout.vue的</p>
<pre data-role="codeBlock" data-info="vue" class="language-vue vue"><code>  &lt;template #main&gt;
    &lt;QLayoutMainContainer/&gt;
  &lt;/template&gt;
</code></pre><p>import <strong>QLayoutMainContainer</strong> from 'src/components/Quasar/QLayoutMainContainer/index.vue';</p>
<pre data-role="codeBlock" data-info="vue" class="language-vue vue"><code>&lt;template&gt;
  &lt;LayoutContainer
    :widgetConfig="configRef"
    :layoutID="layoutIDRef"
    @containerLoaded="loadedHandler"
  &gt;
  &lt;template #main&gt;
    &lt;QLayoutMainContainer/&gt;
  &lt;/template&gt;
  &lt;/LayoutContainer&gt;
&lt;/template&gt;

&lt;script lang="ts" setup&gt;
import { storeToRefs } from 'pinia';
import { getRightWidgetConfig } from 'src/permission';
import { appStore,tabMenuStore } from 'src/stores';
import {  onMounted, ref, watch } from 'vue';
import { Global, H5Tool, LayoutContainer, LayoutManager } from 'xframelib';
import QLayoutMainContainer from 'src/components/Quasar/QLayoutMainContainer/index.vue';
……
&lt;/script&gt;
</code></pre></li>
</ul>
<h3 id="1-pdfviewer组件">1. PDFViewer组件 </h3>
<ul>
<li>
<p>使用范围</p>
<p>web /mobile app/ electron</p>
</li>
<li>
<p>安装依赖</p>
<p>npm install  @tato30/vue-pdf</p>
</li>
<li>
<p>组件路径和方法</p>
<p>src/components/PDFViewer/index.vue</p>
<p>src/components/PDFViewer/PDFTool.ts</p>
</li>
<li>
<p>示例</p>
<pre data-role="codeBlock" data-info="vue" class="language-vue vue"><code>&lt;template&gt;
  &lt;div style="width:100%;height:500px;"&gt;
    &lt;PDFViewer&gt;&lt;/PDFViewer&gt;
  &lt;/div&gt;

&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import PDFViewer from 'src/components/PDFViewer/index.vue';
//任意位置改变PDF路径时引用
import { setPDF } from 'src/components/PDFViewer/PDFTool';
import {onMounted } from 'vue';

onMounted(()=&gt;{
  setPDF('/test.pdf');//任意位置进行调用setPDF
})

&lt;/script&gt;

&lt;style scoped lang="scss"&gt;&lt;/style&gt;

</code></pre></li>
<li>
<p>示例效果截图</p>
<p><img src="./data/pdfViewerExample.png" alt="PDF浏览和缩放"></p>
</li>
<li>
<p><strong>ERROR: Top-level await</strong>错误解决：</p>
<p>如下错误</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code> [vite] error while updating dependencies:
Error: Build failed with 1 error:
node_modules/.pnpm/pdfjs-dist@4.2.67/node_modules/pdfjs-dist/build/pdf.mjs:19764:53: ERROR: Top-level await is not available in the configured target environment ("chrome87", "edge88", "es2020", "firefox78", "safari14" + 2 overrides)
    at failureErrorWithLog (D:\WorkSpace\FlightNaviWebGIS\Front\node_modules\.pnpm\esbuild@0.21.5\node_modules\esbuild\lib\main.js:1472:15)
    at D:\WorkSpace\FlightNaviWebGIS\Front\node_modules\.pnpm\esbuild@0.21.5\node_modules\esbuild\lib\main.js:945:25
    at D:\WorkSpace\FlightNaviWebGIS\Front\node_modules\.pnpm\esbuild@0.21.5\node_modules\esbuild\lib\main.js:1353:9
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
</code></pre><p>解决参考：<a href="https://github.com/mozilla/pdf.js/issues/17245">https://github.com/mozilla/pdf.js/issues/17245</a></p>
<p><strong>vue-widget-quasar-clivite-template开发框架里的quasar.config.ts已经修改好了</strong></p>
<blockquote>
<p>this should be the final answer</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>{
  build: {
    target: "es2022"
  },
  esbuild: {
    target: "es2022"
  },
  optimizeDeps:{
    esbuildOptions: {
      target: "es2022",
    }
  }
}
</code></pre></blockquote>
<p>this fixed it for me, thank you!</p>
</li>
</ul>
<h3 id="2-imageviewer组件">2. ImageViewer组件 </h3>
<ul>
<li>
<p>使用范围</p>
<p>web /mobile app/ electron</p>
</li>
<li>
<p>安装依赖</p>
<p>npm install  viewerjs</p>
</li>
<li>
<p>组件路径和方法</p>
<p>src/components/ImageViewer.vue</p>
</li>
<li>
<p>示例</p>
</li>
</ul>
<pre data-role="codeBlock" data-info="vue" class="language-vue vue"><code>&lt;template&gt;
  &lt;div &gt;
    &lt;q-layout  view="hHh lpR fFf" container style="height: calc(100vh - 50px)" class="shadow-2 "&gt;
      &lt;q-page-container class="pageContainer"&gt;

        &lt;div class="pageBottom"&gt;
          &lt;div class="q-col-gutter-xs row items-start "&gt;
            &lt;div class="col-4"&gt;
              &lt;q-img src="/img/daxing.jpg"  @click="showImage(1)"&gt;
                &lt;div class="absolute-bottom text-center" &gt;
                  机场图片
                &lt;/div&gt;
              &lt;/q-img&gt;
            &lt;/div&gt;

            &lt;div class="col-4" &gt;
              &lt;q-img src="/img/daxing2.jpg" style="height:70px;" @click="showImage(2)"&gt;
                &lt;div class="absolute-bottom text-center"&gt;
                  进近图
                &lt;/div&gt;
              &lt;/q-img&gt;
            &lt;/div&gt;

            &lt;div class="col-4"&gt;
              &lt;q-img src="/img/daxing3.jpg" @click="showImage(3)"&gt;
                &lt;div class="absolute-bottom text-center"&gt;
                  三维模型
                &lt;/div&gt;
              &lt;/q-img&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/q-page-container&gt;
    &lt;/q-layout&gt;
    &lt;ImageViewer  :url="imgURL"/&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import ImageViewer from 'src/components/ImageViewer.vue';
import { ref } from 'vue';

const  imgURL=ref(null);
function showImage(item:number)
{
  setTimeout(()=&gt;{
    imgURL.value=undefined;
  },20);
  switch(item)
  {
    case 1:
    imgURL.value='img/daxing.jpg'
      break;
      case 2:
    imgURL.value='img/daxing2.jpg'
      break;
      case 3:
    imgURL.value='img/daxing3.jpg'
      break;
  }
}
&lt;/script&gt;

&lt;style  lang="scss" scoped&gt;
.pageContainer
{
  position: relative;
  background-color: #0f0;
}
.pageBottom
{
  position:absolute;
  bottom: 0px;
  height:70px;
  width:100%;
  background-color: #f00;
}
&lt;/style&gt;
</code></pre><ul>
<li>示例效果截图</li>
</ul>
<p><img src="./data/imageviewer.png" alt="ImageViewer示例"></p>
<h3 id="3popoverpanel组件">3.PopoverPanel组件 </h3>
<p>用于地图选中要素时弹框显示属性表或其他内容</p>
<ul>
<li>
<p>使用范围</p>
<p>web /mobile app/ electron</p>
</li>
<li>
<p>安装依赖</p>
<p>npm install  floating-vue</p>
<p>使用的是VDropdown</p>
<p><img src="./data/floatingvue1.png" alt="注册VDropdown组件"></p>
</li>
<li>
<p>组件路径和方法</p>
<p>src/components/PopoverPanel.vue</p>
</li>
<li>
<p>示例</p>
<pre data-role="codeBlock" data-info="vue" class="language-vue vue"><code>&lt;template&gt;
  &lt;PopoverPanel :isShown='isOpen' :leftX="leftX" :topY="topY"&gt;
    &lt;template #content&gt;
      &lt;q-table
        v-model:pagination="pagination" title="属性表" :rows="rows" :columns="columns" row-key="name"
        :dense="true" /&gt;
    &lt;/template&gt;
  &lt;/PopoverPanel&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import * as Cesium from 'cesium';
import PopoverPanel from 'src/components/PopoverPanel.vue';
import { getLineObject, getLinePrimitives, loadLineLayer } from 'src/workers/line.service.ts';
import { getPointObject, getPointPrimitives, loadPointLayer } from 'src/workers/point.service.ts';
import { nextTick, onMounted, ref } from 'vue';
import { Global } from 'xframelib';

let viewer: Cesium.Viewer;
const isOpen = ref(false);
const leftX = ref('0px');
const topY = ref('0px');
const columns = [
    {
        name: 'name',
        // required: true,
        label: '属性名',
        align: 'left',
        field: 'name',
    },
    { name: 'value', align: 'center', label: '值', field: 'value' }
]

const rows = ref([]);
const pagination = ref({
    rowsPerPage: 0
});

//获得当前视图
function getViewer(): Cesium.Viewer | undefined {
    if (Global.CesiumViewer) {
        if (!viewer) viewer = &lt;Cesium.Viewer&gt;Global.CesiumViewer;
    }
    return viewer;
}

let lastPick: any = undefined;
let line4490: any, point4490: any;

onMounted(() =&gt; {
    getViewer();
    const handler = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas);
    handler.setInputAction(async function (movement) {
        const position = movement.position;
        var pick = viewer.scene.pick(movement.position);
        console.log(pick, movement.position, '选中对象')
        if (pick) {
            isOpen.value = false;
            topY.value = position.y + 'px';
            leftX.value = position.x + 'px';
            if (lastPick) {
                if (lastPick.primitive)
                    lastPick.primitive.appearance = new Cesium.PerInstanceColorAppearance();
            }

            pick.primitive.appearance = new Cesium.MaterialAppearance({
                material: Cesium.Material.fromType('Color'),
                faceForward: true
            });
            pick.primitive.appearance.material.uniforms.color = new Cesium.Color(1.0, 0.0, 0.0, 1);
            lastPick = pick;
            setTimeout(() =&gt; {
                isOpen.value = true;
            },20);
            if (pick.id.length &gt; 10) {
                const current = await getLineObject(line4490, pick.id);
                rows.value.length = 0;
                if (current) {
                    const props = current.properties;
                    rows.value = [
                        {
                            name: '管线编号',
                            value: props['管线编'],
                        },
                        {
                            name: '类型',
                            value: props['图层'],
                        },
                        {
                            name: '材质',
                            value: props['材质'],
                        },
                        {
                            name: '长度',
                            value: props['长度'],
                        },
                        {
                            name: '位置',
                            value: props['所在道'],
                        },
                        {
                            name: '起点埋',
                            value: props['起点埋'],
                        },
                        {
                            name: '终点埋',
                            value: props['终点埋'],
                        },
                        {
                            name: '管径',
                            value: props['管径'],
                        }
                    ]
                }
            }
            else {
                const currentPT = await getPointObject(point4490, pick.id);
                rows.value.length = 0;
                if (currentPT) {
                    const props = currentPT.properties;
                    rows.value = [
                        {
                            name: '编号',
                            value: props['ID'],
                        },
                        {
                            name: '类型',
                            value: props['图层'],
                        },
                        {
                            name: '特征',
                            value: props['特征'],
                        },
                        {
                            name: '地面高程',
                            value: props['地面高'],
                        },
                        {
                            name: '井底高程',
                            value: props['井底高'],
                        },

                        {
                            name: '埋设方法',
                            value: props['埋设方'],
                        }
                    ]
                }
            }

        }
        else {
            isOpen.value = false;
            if (lastPick) {
                if (lastPick.primitive)
                    lastPick.primitive.appearance = new Cesium.PerInstanceColorAppearance();
                lastPick = undefined;
            }
        }

    }, Cesium.ScreenSpaceEventType.LEFT_CLICK);

    loadLineLayer('data/line_4490.json').then(async p =&gt; {
        line4490 = p;
        const linePrimitives = await getLinePrimitives(line4490);
        if (linePrimitives)
            linePrimitives.forEach(item =&gt; {
                viewer.scene.primitives.add(item);
            });
    })
    loadPointLayer('data/point_4490.json').then(async p =&gt; {
        point4490 = p;
        const pointPrimitives = await getPointPrimitives(point4490);
        if (pointPrimitives)
            viewer.scene.primitives.add(pointPrimitives);
    })

    viewer.camera.flyTo({
        destination: Cesium.Cartesian3.fromDegrees(116.269988, 36.3500, 2000.0)
    });

});
&lt;/script&gt;

&lt;style&gt;
.q-table__bottom {
    display: none;
}
&lt;/style&gt;
</code></pre><p><img src="./data/PopoverPaneldemo.png" alt="PopoverPanelDemo"></p>
</li>
</ul>
<h3 id="4xwindow组件">4.XWindow组件 </h3>
<p>防Windows窗体的容器组件，支持缩小、放大/还原、关闭、拖拽移动、拖拽改变窗体大小，支持任务栏窗体图标控制。</p>
<ul>
<li>
<p>使用范围</p>
<p>web /mobile app/ electron</p>
</li>
<li>
<p>安装依赖</p>
<p>npm install  xframelib@0.7.8</p>
</li>
<li>
<p>组件路径和方法</p>
<p>import {XWindow,XWindowManager,WindowMap,MinWindowMap} from 'xframelib'</p>
</li>
<li>
<p>使用XWindow的Widget示例代码</p>
</li>
</ul>
<pre data-role="codeBlock" data-info="vue" class="language-vue vue"><code>&lt;template&gt;
    &lt;XWindow v-show="isShow" top="10px" left="10px" nWidth="300px" nHeight="400px" title="XWindowWidget模版"
        icon="img/basicimage/arcgis_img.png" :hasMax="true"pid="widgetID"  @loaded="loadedHandle" @close="doClosePanel"&gt;
        &lt;span&gt;这是XWindowWidget模版，窗体的内容示例&lt;/span&gt;
    &lt;/XWindow&gt;
&lt;/template&gt;

&lt;script lang="ts" setup&gt;
import { onMounted, ref } from 'vue';
import { Global, XWindow, XWindowManager,WindowsMap,MinWindowMap } from 'xframelib';
const widgetID = ref('xwindowWidgetTemplate');
let windowID = '';
//获取到窗体的id
function loadedHandle(panelData) {
    windowID = panelData.id;
}
function doClosePanel(panelData) {
    widgetID.value = panelData.pid;
    if (panelData.pid) {
        Global.LayoutManager?.unloadWidget(widgetID.value);
    }
}
onMounted(() =&gt; {
    //最小化后，定时打开widget
    setTimeout(() =&gt; {
        const tmpLayoutManager = Global.getLayoutManager(widgetID.value);
        tmpLayoutManager?.changeWidgetVisible(widgetID.value, true);
    }, 8000);
})
/**
 * 对外暴露接口
 */
const isShow = ref(true);
function changeVisible(isVisible: boolean = false) {
    isShow.value = isVisible;
    if (windowID &amp;&amp; isVisible)
        XWindowManager.openWindowPanel(windowID);
}
defineExpose({ changeVisible, isShow });
&lt;/script&gt;
&lt;style lang="scss" scoped&gt;&lt;/style&gt;
</code></pre><p>对应的WidgetSetting配置widgetdemos如下：</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>import { LayoutContainerEnum } from 'xframelib';
/**
 * 组件配置项
 */
const defaultWidgetCofig: Array&lt;IWidgetConfig&gt; = [ 
  {
    layoutID: 'bigScreenLayout', //归属组
    id: 'xwindowWidgetTemplate',
    label:'XWindowWidget示例',
    container: LayoutContainerEnum.centerFront,
    component: () =&gt; import('src/widgets/layouts/XWindowWidgetTemplate.vue'),
    preload: true
  },

];
export default defaultWidgetCofig;
</code></pre><ul>
<li>
<p>示例效果图</p>
<p><img src="./data/XWindow%E7%A4%BA%E4%BE%8B.png" alt="XWindow示例"></p>
</li>
</ul>
<h3 id="5markdown组件">5.Markdown组件 </h3>
<p>实现Markdown文档的在线编辑与在线预览</p>
<ul>
<li>
<p>使用范围</p>
<p>web /mobile app/ electron</p>
</li>
<li>
<p>安装依赖</p>
<p>npm install  md-editor-v3</p>
<p><a href="https://www.npmjs.com/package/md-editor-v3">https://www.npmjs.com/package/md-editor-v3</a></p>
</li>
<li>
<p>组件路径和方法</p>
<p>MD编辑组件：src/components/Markdown/MarkdownEditor.vue</p>
<p>MD预览组件：src/components/Markdown/MarkdownViewer.vue</p>
</li>
<li>
<p>MarkdownViewer使用</p>
<p>传入参数说明：</p>
<p>file ：md文件网络地址，加载md文档内容；</p>
<p>content:传入md文档的文本内容；</p>
<p>showList: 默认false,控制是否显示目录列表</p>
</li>
</ul>
<pre data-role="codeBlock" data-info="" class="language-text"><code>const props=defineProps(
    {
        file:{
            type:String,
            default:""
        },
        content:
        {
            type:String,
            default:"",
        },
        //是否显示主题列表
        showList:
        {
          type:Boolean,
          default:false,
        }
    }
  );
</code></pre><p><strong>MarkdownViewer的大小默认为100%填充，可通过margin-bottom来控制下边距。</strong></p>
<ul>
<li>
<p>MarkdownViewer使用示例</p>
<blockquote>
<p>根据footer底部栏是否显示，控制MarkdownViewer的下面边距。</p>
<p>src/pages/adefault/markdown/MarkdownViewerTest.vue</p>
</blockquote>
</li>
</ul>
<pre data-role="codeBlock" data-info="vue" class="language-vue vue"><code>&lt;template&gt;
    &lt;base-content scrollable&gt;
        &lt;MarkdownViewer file="README.md" :style="bottomStyle"/&gt;
    &lt;/base-content&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import BaseContent from 'src/components/Quasar/BaseContent.vue';
import MarkdownViewer from '@/components/Markdown/MarkdownViewer.vue';
import { appStore } from '@/stores';
import { computed } from 'vue';
const appState=appStore();
const bottomStyle=computed(()=&gt;{
    if(appState.showFooter)
    return `margin-bottom:${appState.footerHeight}px;`;
    else
    return '';
}
);
&lt;/script&gt;
</code></pre><ul>
<li>MarkdownEditor使用</li>
</ul>
<p>传入参数说明：</p>
<p>file ：md文件网络地址，加载md文档内容；</p>
<p>content:传入md文档的文本内容；</p>
<p><strong>MarkdownEditor的大小默认为100%填充，可通过<u>bottom</u>来控制下边距。</strong></p>
<ul>
<li>
<p>MarkdownEditor使用示例</p>
<blockquote>
<p>根据footer底部栏是否显示，通过<strong>bottom</strong> 来控制MarkdownEditor的下面边距。</p>
<p>src/pages/adefault/markdown/MarkdownEditorTest.vue</p>
</blockquote>
</li>
</ul>
<pre data-role="codeBlock" data-info="vue" class="language-vue vue"><code>&lt;template&gt;
    &lt;base-content scrollable&gt;
        &lt;MarkdownEditor file="README.md" :style="bottomStyle"/&gt;
    &lt;/base-content&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import BaseContent from 'src/components/Quasar/BaseContent.vue';
import MarkdownEditor from '@/components/Markdown/MarkdownEditor.vue';
import { appStore } from '@/stores';
import { computed } from 'vue';
const appState=appStore();
const bottomStyle=computed(()=&gt;{
    if(appState.showFooter)
    return `bottom:${appState.footerHeight}px;`;
    else
    return '';
}
);
&lt;/script&gt;
</code></pre><h3 id="6sidemenubar组件">6.SideMenuBar组件 </h3>
<p>实现左边或右边浮动路由菜单，放在q-drawer组件里使用。</p>
<ul>
<li>
<p>使用范围</p>
<p>web /mobile app/ electron</p>
</li>
<li>
<p>组件路径和方法</p>
<p>SideMenuBar组件：src/components/Menu/SideMenuBar/index.vue</p>
</li>
<li>
<p>SideMenuBar使用效果</p>
<p><img src="./data/sidemenubar.png" alt="SideMenuBar使用效果"></p>
</li>
<li>
<p>SideMenuBar使用</p>
</li>
</ul>
<pre data-role="codeBlock" data-info="vue" class="language-vue vue"><code>  &lt;q-layout v-if="$q.screen.lt.sm" view="hHH lpR fFf"&gt;
    &lt;q-drawer v-model="rightDrawerOpen" side="right" bordered&gt;
      &lt;!-- drawer content --&gt;
      &lt;q-btn dense flat round v-tooltip="'菜单列表'" @click="toggleRightDrawer" &gt;
        &lt;Icon icon = "codicon:chrome-close" /&gt;
      &lt;/q-btn&gt;
      &lt;SideMenuBar :top-menu-children="menuList"&gt;&lt;/SideMenuBar&gt;
    &lt;/q-drawer&gt;
  &lt;/q-layout&gt;
</code></pre><p><strong>支持传入EnumPageMenu列表或Router列表</strong></p>
<p><sidemenubar :top-menu-children="menuList"></sidemenubar></p>
<pre data-role="codeBlock" data-info="ts" class="language-ts ts"><code><span class="token keyword keyword-const">const</span> menuList <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    label<span class="token operator">:</span> <span class="token string">'首页'</span><span class="token punctuation">,</span>
    icon<span class="token operator">:</span> <span class="token string">'ant-design:home-outlined'</span><span class="token punctuation">,</span>
    kind<span class="token operator">:</span> EnumPageMenu<span class="token punctuation">.</span>Route<span class="token punctuation">,</span>
    path<span class="token operator">:</span> <span class="token string">'/product/index'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    label<span class="token operator">:</span> <span class="token string">'帝测时空云平台'</span><span class="token punctuation">,</span>
    kind<span class="token operator">:</span> EnumPageMenu<span class="token punctuation">.</span>Route<span class="token punctuation">,</span>
    path<span class="token operator">:</span> <span class="token string">'/product/productPage'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    label<span class="token operator">:</span> <span class="token string">'解决方案'</span><span class="token punctuation">,</span>
    children<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        label<span class="token operator">:</span> <span class="token string">'智慧农业'</span><span class="token punctuation">,</span>
        kind<span class="token operator">:</span> EnumPageMenu<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">,</span>
        path<span class="token operator">:</span> <span class="token string">'https://www.baidu.com'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        label<span class="token operator">:</span> <span class="token string">'智慧水利'</span><span class="token punctuation">,</span>
        kind<span class="token operator">:</span> EnumPageMenu<span class="token punctuation">.</span>Route<span class="token punctuation">,</span>
        path<span class="token operator">:</span> <span class="token string">'/river'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        label<span class="token operator">:</span> <span class="token string">'智慧物流'</span><span class="token punctuation">,</span>
        kind<span class="token operator">:</span> EnumPageMenu<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">,</span>
        path<span class="token operator">:</span> <span class="token string">'https://www.126.com'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    label<span class="token operator">:</span> <span class="token string">'API示例'</span><span class="token punctuation">,</span>
    kind<span class="token operator">:</span> EnumPageMenu<span class="token punctuation">.</span>Route<span class="token punctuation">,</span>
    path<span class="token operator">:</span> <span class="token string">'/product/apiexamples'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><p><strong>Router列表</strong></p>
<p><sidemenubar :top-menu-children="topMenuChildren"></sidemenubar></p>
<pre data-role="codeBlock" data-info="vue" class="language-vue vue"><code>const topMenuChildren = computed(() =&gt; {
  const rightRoutes = productRoute.children;
  if (!rightRoutes) {
    Global.Message.warn('无法获取路由列表！');
    return [];
  }
  return rightRoutes;
});
</code></pre><h3 id="7contextmenu组件">7.ContextMenu组件 </h3>
<p>ContextMenu组件为通用的右键菜单。</p>
<ul>
<li>
<p>使用范围</p>
<p>web /mobile app/ electron</p>
</li>
<li>
<p>组件路径和方法</p>
<p>ContextMenu组件：src/components/Menu/ContextMenu.vue</p>
</li>
<li>
<p>使用说明<br>
组件对外属性：</p>
<ul>
<li>
<p>target 为要绑定的HTML元素，绑定方式：<strong>CSS  ID、ref、true</strong>(true时是默认绑定为父对象)</p>
</li>
<li>
<p>menuList 为菜单对象列表，为IContextMenuItem数组（只支持2级菜单）</p>
</li>
</ul>
<p>对外事件：</p>
<p>itemClicked 传递为菜单对象（IContextMenuItem类型）</p>
<p>IContextMenuItem接口类型，<u>src/models/IContextMenuItem.ts</u>，<strong>添加分割线则传入空对象{}</strong></p>
<pre data-role="codeBlock" data-info="ts" class="language-ts ts"><code><span class="token doc-comment comment">/**
 * 定义右键菜单
 */</span>
<span class="token keyword keyword-export">export</span> <span class="token keyword keyword-interface">interface</span> <span class="token class-name">IContextMenuItem</span>
<span class="token punctuation">{</span>  
    id<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="token comment">//标识ID</span>
    label<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="token comment">//菜单或分组名</span>
    icon<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">string</span><span class="token punctuation">;</span><span class="token comment">//菜单图标</span>
    tag<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span> <span class="token comment">//传递的数据（备用）</span>
    children<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>IContextMenuItem<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></li>
</ul>
<ul>
<li>
<p><strong>测试示例代码</strong></p>
<p>绑定父元素：const parentRef = ref(true);</p>
<pre data-role="codeBlock" data-info="vue" class="language-vue vue"><code>      &lt;div class="test3"&gt;父面板的右键菜单
         &lt;ContextMenu :target="parentRef" :menuList="menuList2" @itemClicked="doItemClicked"&gt;&lt;/ContextMenu&gt;
          &lt;q-btn color="primary" label="开关右键菜单" @click="toggleMenu"&gt;&lt;/q-btn&gt;
        &lt;/div&gt;
</code></pre><p>绑定HTML元素ID</p>
<pre data-role="codeBlock" data-info="vue" class="language-vue vue"><code> &lt;div id="map"&gt; 模拟地图面板，点击右键菜单 &lt;/div&gt;
&lt;ContextMenu :target="'map'" :menuList="menuList" @itemClicked="doItemClicked"&gt;&lt;/ContextMenu&gt;
</code></pre><p>绑定ref对应的HTML元素：const testRef = ref();</p>
<pre data-role="codeBlock" data-info="vue" class="language-vue vue"><code> &lt;div ref="testRef" class="test2"&gt; 普通面板的右键菜单&lt;/div&gt;
         &lt;ContextMenu :target="testRef" :menuList="menuList2" @itemClicked="doItemClicked"&gt;&lt;/ContextMenu&gt;
    &lt;/div&gt;
</code></pre><p>完整示例代码：<u>src/pages/adefault/ContextMenuTest.vue</u></p>
<pre data-role="codeBlock" data-info="vue" class="language-vue vue"><code>&lt;template&gt;
    &lt;div class="row justify-center"&gt;
        &lt;div id="map"&gt; 模拟地图面板，点击右键菜单 &lt;/div&gt;
        &lt;div ref="testRef" class="test2"&gt; 普通面板的右键菜单&lt;/div&gt;
        &lt;div class="test3"&gt;父面板的右键菜单
         &lt;ContextMenu :target="parentRef" :menuList="menuList2" @itemClicked="doItemClicked"&gt;&lt;/ContextMenu&gt;
          &lt;q-btn color="primary" label="开关右键菜单" @click="toggleMenu"&gt;&lt;/q-btn&gt;
        &lt;/div&gt;
        &lt;ContextMenu :target="'map'" :menuList="menuList" @itemClicked="doItemClicked"&gt;&lt;/ContextMenu&gt;
        &lt;ContextMenu :target="testRef" :menuList="menuList2" @itemClicked="doItemClicked"&gt;&lt;/ContextMenu&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { IContextMenuItem } from '@/models';
import ContextMenu from 'src/components/Menu/ContextMenu.vue';
import { ref } from 'vue';
import { Global } from 'xframelib';

const testRef = ref();
//地图默认右键菜单
const menuList:Array&lt;IContextMenuItem&gt; = [{
    id: 'show-position',
    label: '查看此处坐标',
    icon: 'ic:baseline-info'
},
{},
{
    id: 'zoom-in',
    label: '放大',
    icon: 'ic:baseline-zoom-in'
},
{
    id: 'zoom-out',
    label: '缩小',
    icon: 'ic:baseline-zoom-out'
},
{
    id: 'locate-center',
    label: '移动到此处',
    icon: 'ion:md-locate'
}
]

const menuList2:Array&lt;IContextMenuItem&gt;  = [{
    id: 'file',
    label: '文件',
    icon: 'icons8:audio-file',
    children: [
        {
            id: 'create',
            label: '新建文件',
            icon: 'material-symbols:create-new-folder-outline'
        },
        {},
        {
            id: 'open',
            label: '打开文件',
            icon: 'system-uicons:create'
        },
        {
            id: 'save',
            label: '保存文件',
            icon: 'ic:baseline-save'
        }
    ]
},
{},
{
    id: 'test1',
    label: '测试1',
    icon: 'ic:baseline-data-saver-on"'
},
{
    id: 'test2',
    label: '其他',
    icon: 'ic:baseline-10k'
},
{},
{
    id: 'test3',
    label: '测试3',
    icon: 'ion:md-locate'
}
]
const parentRef = ref(true);
function toggleMenu() {
    parentRef.value = !parentRef.value;
}
function doItemClicked(item)
{
    Global.Message.info(item.label)
}
&lt;/script&gt;

&lt;style scoped&gt;
#map {
    width: 400px;
    height: 400px;
    background-color: #0f0;
}
.test2 {
    width: 400px;
    height: 400px;
    background-color: #f00;
}
.test3 {
    width: 400px;
    height: 400px;
    background-color: #eee;
}
&lt;/style&gt;
</code></pre></li>
</ul>
<ul>
<li>
<p>使用效果</p>
<p><img src="./data/contextMenuControl.png" alt="contextMenu组件使用"></p>
</li>
</ul>
<h2 id="前端开发知识点积累大杂烩">前端开发知识点积累（大杂烩） </h2>
<h3 id="1-flex布局知识点">1. Flex布局知识点 </h3>
<h4 id="1flex1的作用">1）Flex:1的作用 </h4>
<p>来源：<a href="https://mp.weixin.qq.com/s/uX8AesG2pLdEOXWCG_uAUg">https://mp.weixin.qq.com/s/uX8AesG2pLdEOXWCG_uAUg</a></p>
<blockquote>
<p>在现代网页布局中，Flexbox（弹性盒子布局）是一种强大的工具。它通过 "flex" 属性，帮助开发者轻松控制元素的伸缩性。</p>
</blockquote>
<p><strong>Flex 属性的组成</strong></p>
<p>Flex 属性是一个复合属性，包含以下三个子属性：</p>
<ol>
<li><strong>「flex-grow」</strong>：决定元素在容器中剩余空间的分配比例。默认值为 0，表示元素不会扩展。当设置为正数时，元素会按照设定比例扩展。</li>
<li><strong>「flex-shrink」</strong>：决定元素在空间不足时的收缩比例。默认值为 1，表示元素会按比例收缩。当设置为 0 时，元素不会收缩。</li>
<li><strong>「flex-basis」</strong>：定义元素在分配多余空间之前所占据的主轴空间。默认值为 auto，表示元素占据其本来大小。</li>
</ol>
<p>语法格式为：</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>flex: &lt;flex-grow&gt; &lt;flex-shrink&gt; &lt;flex-basis&gt;;
</code></pre><p><em><strong>将一个元素的 <code>flex</code> 属性设置为 1，相当于将其分配了一个相对于其他元素相同的可伸缩空间</strong></em>。换句话说，<code>flex: 1</code> 会使该元素尽可能地占据父容器中的剩余空间，同时保持其他元素的相对位置和大小。</p>
<p>具体来说：</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>flex: 1; /* 等同于 flex: 1 1 0%; */
</code></pre><ul>
<li><strong>「flex-grow」</strong> 设置为 1，表示元素会扩展，填满所有可用的额外空间。</li>
<li><strong>「flex-shrink」</strong> 设置为 1，表示元素会在空间不足时收缩，避免溢出。</li>
<li><strong>「flex-basis」</strong> 设置为 0%，表示元素在分配额外空间前不占用空间。</li>
</ul>
<p><strong>实际应用示例</strong></p>
<p>这种设置对于实现灵活、响应式的布局非常有用。例如，我们可以将导航栏中的项目设置为 <code>flex: 1</code>，使其自动平分导航栏的宽度。</p>
<p><strong>「HTML 结构：」</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>&lt;nav class="navbar"&gt;
  &lt;a href="#"&gt;标签 1&lt;/a&gt;
  &lt;a href="#"&gt;标签 2&lt;/a&gt;
  &lt;a href="#"&gt;标签 3&lt;/a&gt;
&lt;/nav&gt;
</code></pre><p><strong>「CSS 样式：」</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>.navbar {
  display: flex;
}

.navbar a {
  flex: 1;
  border: 1px solid #ccc;
  padding: 10px;
  text-align: center;
}
</code></pre><p>在这个示例中，通过设置链接的 <code>flex</code> 属性为 1，实现了它们的平均分配。无论导航栏的宽度如何变化，链接都会自动调整大小，以适应父容器的空间。</p>
<p><strong>更多</strong><br>
比较 "flex: 1" 与其他值：</p>
<ul>
<li><strong>「flex: 1」 是最常用的设置，因为它能让子元素自动填充剩余空间，使布局更灵活</strong>。</li>
<li><strong>「flex: 0」</strong> 表示子元素不会自动填充剩余空间，而是根据其内容或固定尺寸进行布局。</li>
<li><strong>「flex: none」</strong> 则表示子元素不可伸缩，其大小仅受 <code>flex-basis</code> 限制，不会根据剩余空间自动调整。</li>
</ul>
<p>通过掌握 flex 属性及其子属性，你可以创建出更加灵活和响应式的网页布局，提升用户体验。</p>
<h4 id="2垂直分散居中">2）垂直分散居中 </h4>
<p>display: flex;</p>
<p>flex-direction:column;(row为水平方向，column为垂直方向)；</p>
<pre data-role="codeBlock" data-info="css" class="language-css css"><code>    <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
    flex-direction<span class="token punctuation">:</span> column<span class="token punctuation">;</span>
    justify-content<span class="token punctuation">:</span> space-between<span class="token punctuation">;</span>
    align-items<span class="token punctuation">:</span> center<span class="token punctuation">;</span>
</code></pre><p><img src="./data/flex_column.png" alt="垂直居中"></p>
<h3 id="2-vue组件传参方式">2. Vue组件传参方式 </h3>
<p>来源：Vue 3组件通信13种方法，<a href="https://mp.weixin.qq.com/s/ZlImQB2FIsJ0R8s4SVl84g">https://mp.weixin.qq.com/s/ZlImQB2FIsJ0R8s4SVl84g</a></p>
<h4 id="1父传子-props方式">1）父传子 Props方式 </h4>
<p>这是最基本也是最常用的通信方式。父组件通过属性向子组件传递数据。</p>
<p><strong>「父组件:」</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>&lt;template&gt;
  &lt;child :name="name"&gt;&lt;/child&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref } from 'vue'
import Child from './Child.vue'

const name = ref('小明')
&lt;/script&gt;
</code></pre><p><strong>「子组件:」</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>&lt;template&gt;
  &lt;div&gt;{{ props.name }}&lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { defineProps } from 'vue'

const props = defineProps({
  name: {
    type: String,
    default: '',
  },
})
&lt;/script&gt;
</code></pre><h4 id="2子传父--emit内部事件">2）子传父  Emit内部事件 </h4>
<p>子组件可以通过触发事件的方式向父组件传递数据。</p>
<p><strong>「子组件:」</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>&lt;template&gt;
  &lt;button @click="handleClick"&gt;点击我&lt;/button&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref, defineEmits } from 'vue'

const message = ref('来自子组件的问候')
const emits = defineEmits(['greet'])

const handleClick = () =&gt; {
  emits('greet', message.value)
}
&lt;/script&gt;
</code></pre><p><strong>「父组件:」</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>&lt;template&gt;
  &lt;child @greet="handleGreet"&gt;&lt;/child&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref } from 'vue'
import Child from './Child.vue'

const handleGreet = (message) =&gt; {
  console.log(message) // 输出: "来自子组件的问候"
}
&lt;/script&gt;
</code></pre><h4 id="3父传子-attributes-attrs">3）父传子 Attributes ($attrs) </h4>
<p>$attrs 包含了父组件传递给子组件的所有属性,除了那些已经被 props 或 emits 声明的。</p>
<p><strong>「父组件:」</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>&lt;template&gt;
  &lt;child name="小明" age="18" hobby="篮球"&gt;&lt;/child&gt;
&lt;/template&gt;
</code></pre><p><strong>「子组件:」</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>&lt;script setup&gt;
import { useAttrs } from 'vue'

const attrs = useAttrs()
console.log(attrs) // { age: "18", hobby: "篮球" }
&lt;/script&gt;
</code></pre><h4 id="4父子组件-双向绑定-v-model">4）*父子组件， 双向绑定 (v-model) </h4>
<p>v-model 提供了一种简洁的方式来实现父子组件之间的双向数据绑定。</p>
<p><strong>「父组件:」</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>&lt;template&gt;
  &lt;child v-model:name="name"&gt;&lt;/child&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref } from 'vue'
import Child from './Child.vue'

const name = ref('小明')
&lt;/script&gt;
</code></pre><p><strong>「子组件:」</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>&lt;template&gt;
  &lt;input :value="name" @input="updateName" /&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { defineProps, defineEmits } from 'vue'

const props = defineProps(['name'])
const emit = defineEmits(['update:name'])

const updateName = (e) =&gt; {
  emit('update:name', e.target.value)
}
&lt;/script&gt;
</code></pre><h4 id="5祖先组件与子孙组件依赖注入-provideinject">5）祖先组件与子孙组件，依赖注入 (Provide/Inject) </h4>
<p>provide 和 inject 允许祖先组件向所有子孙组件传递数据,而不需要通过每一层组件手动传递。</p>
<p><strong>「祖先组件:」</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>&lt;script setup&gt;
import { provide, ref } from 'vue'

const themeColor = ref('blue')
provide('theme', themeColor)
&lt;/script&gt;
</code></pre><p><strong>「子孙组件:」</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>&lt;script setup&gt;
import { inject } from 'vue'

const theme = inject('theme')
console.log(theme.value) // 'blue'
&lt;/script&gt;
</code></pre><h4 id="6浏览器存储">6）浏览器存储 </h4>
<p>localStorage 和 sessionStorage 可以用于在不同页面或组件之间共享数据。</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>// 存储数据
localStorage.setItem('user', JSON.stringify({ name: '小明', age: 18 }))

// 读取数据
const user = JSON.parse(localStorage.getItem('user'))
</code></pre><h4 id="7window-对象">7）Window 对象 </h4>
<p>虽然不推荐,但在某些场景下,可以使用 window 对象在全局范围内共享数据。</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>// 设置全局数据
window.globalData = { message: '全局消息' }

// 在任何地方使用
console.log(window.globalData.message)
</code></pre><h4 id="8全局属性">8）全局属性 </h4>
<p>Vue 3 提供了 <strong>app.config.globalProperties</strong> 来替代 Vue 2 中的 Vue.prototype,用于添加全局可用的属性。</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>// main.js
const app = createApp(App)
app.config.globalProperties.$http = axios

// 在组件中使用
import { getCurrentInstance } from 'vue'

const { proxy } = getCurrentInstance()
proxy.$http.get('/api/data')
</code></pre><h4 id="9其他路由传参-pinia-状态管理-vuex-状态管理-公共事件通信-mitt">9）其他（路由传参、Pinia 状态管理、Vuex 状态管理、公共事件通信 Mitt） </h4>
<h3 id="3-typescript枚举类型与字符串转换">3、Typescript枚举类型与字符串转换 </h3>
<p><a href="https://typescript.p6p.net/typescript-tutorial/enum.html">https://typescript.p6p.net/typescript-tutorial/enum.html</a></p>
<p><strong>测试代码：</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>  enum EnumBasicLayer
      {
          Single='single',
          TDT_VEC='tdt_vec',
          TDT_IMG='tdt_img',
      }
    onMounted(() =&gt; {
      console.log('0000',EnumBasicLayer.Single,typeof EnumBasicLayer.Single)
      console.log('1111','single'===EnumBasicLayer.Single);
      const tt='tdt_vec'
      switch(tt)
      {
        case EnumBasicLayer.TDT_VEC:
          console.log('2222','switch string OK');
          break;
      }
      switch(EnumBasicLayer.TDT_VEC)
      {
         case 'tdt_vec':
         console.log('3333','switch Enum OK');
         break;
      }
</code></pre><p><strong>测试结果：</strong></p>
<blockquote>
<p>0000 single string<br>
1111 true<br>
2222 switch string OK<br>
3333 switch Enum OK</p>
</blockquote>
<h3 id="4-font字体转换压缩woffwoff2">4、Font字体转换压缩——WOFF/WOFF2 </h3>
<p><strong>WOFF &amp; WOFF2</strong></p>
<blockquote>
<p><strong>Web开放字体格式</strong>（Web Open Font Format，简称<strong>WOFF</strong>）是一种网页所采用的<a href="https://link.zhihu.com/?target=https%3A//zh.wikipedia.org/wiki/%E5%AD%97%E9%AB%94">字体</a>格式标准。此字体格式发展于2009年，[<a href="https://link.zhihu.com/?target=https%3A//zh.wikipedia.org/wiki/Web%E9%96%8B%E6%94%BE%E5%AD%97%E5%9E%8B%E6%A0%BC%E5%BC%8F%23cite_note-spec-3">3]</a>由<a href="https://link.zhihu.com/?target=https%3A//zh.wikipedia.org/wiki/%E4%B8%87%E7%BB%B4%E7%BD%91%E8%81%94%E7%9B%9F">万维网联盟</a>的Web字体工作小组标准化，现在已经是<a href="https://link.zhihu.com/?target=https%3A//zh.wikipedia.org/wiki/W3C%E6%8E%A8%E8%8D%90%E6%A0%87%E5%87%86">推荐标准</a>。[<a href="https://link.zhihu.com/?target=https%3A//zh.wikipedia.org/wiki/Web%E9%96%8B%E6%94%BE%E5%AD%97%E5%9E%8B%E6%A0%BC%E5%BC%8F%23cite_note-charter-4">4]</a>此字体格式不但能够有效利用压缩来减少文件大小，并且不包含加密也不受DRM（<a href="https://link.zhihu.com/?target=https%3A//zh.wikipedia.org/wiki/%E6%95%B8%E4%BD%8D%E8%91%97%E4%BD%9C%E6%AC%8A%E7%AE%A1%E7%90%86">数字著作权管理</a>）限制。（来源：<a href="https://link.zhihu.com/?target=https%3A//zh.wikipedia.org/wiki/Web%E9%96%8B%E6%94%BE%E5%AD%97%E5%9E%8B%E6%A0%BC%E5%BC%8F">维基百科</a>）</p>
</blockquote>
<p>这是专门给网页使用的字体格式，体积非常小，实测压缩<a href="https://link.zhihu.com/?target=https%3A//github.com/adobe-fonts/source-han-serif/tree/release">思源宋体</a>字体文件，可以把体积压缩到 OTF 字体 70% 的大小。</p>
<p>WOFF 和 WOFF2 的区别在于：</p>
<blockquote>
<p>WOFF本质上是包含了基于<a href="https://link.zhihu.com/?target=https%3A//zh.wikipedia.org/wiki/SFNT">SFNT</a>的字体（如<a href="https://link.zhihu.com/?target=https%3A//zh.wikipedia.org/wiki/TrueType">TrueType</a>、<a href="https://link.zhihu.com/?target=https%3A//zh.wikipedia.org/wiki/OpenType">OpenType</a>或其他开放字体格式），且这些字体均经过WOFF的编码工具压缩，以便嵌入网页中。[<a href="https://link.zhihu.com/?target=https%3A//zh.wikipedia.org/wiki/Web%E9%96%8B%E6%94%BE%E5%AD%97%E5%9E%8B%E6%A0%BC%E5%BC%8F%23cite_note-spec-3">3]</a>WOFF 1.0使用<a href="https://link.zhihu.com/?target=https%3A//zh.wikipedia.org/wiki/Zlib">zlib</a>压缩，[<a href="https://link.zhihu.com/?target=https%3A//zh.wikipedia.org/wiki/Web%E9%96%8B%E6%94%BE%E5%AD%97%E5%9E%8B%E6%A0%BC%E5%BC%8F%23cite_note-spec-3">3]</a>文件大小一般比TTF小40%。[<a href="https://link.zhihu.com/?target=https%3A//zh.wikipedia.org/wiki/Web%E9%96%8B%E6%94%BE%E5%AD%97%E5%9E%8B%E6%A0%BC%E5%BC%8F%23cite_note-11">11]</a>而WOFF 2.0使用<a href="https://link.zhihu.com/?target=https%3A//zh.wikipedia.org/wiki/Brotli">Brotli</a>压缩，文件大小比上一版小30%。（来源：<a href="https://link.zhihu.com/?target=https%3A//zh.wikipedia.org/wiki/Web%E9%96%8B%E6%94%BE%E5%AD%97%E5%9E%8B%E6%A0%BC%E5%BC%8F">维基百科</a>）</p>
</blockquote>
<p><strong>因此，一般推荐直接使用 WOFF2。</strong>（<a href="https://zhuanlan.zhihu.com/p/577387539%EF%BC%89">https://zhuanlan.zhihu.com/p/577387539）</a></p>
<p>在线转换工具网站：</p>
<p><a href="https://fontconverter.com/zh/">https://fontconverter.com/zh/</a></p>
<p><a href="https://convertio.co/zh/font-converter/">https://convertio.co/zh/font-converter/</a></p>
<p><a href="https://transfonter.org/">https://transfonter.org/</a></p>
<h3 id="5-typescript接口反射及应用">5、TypeScript接口反射及应用 </h3>
<p>参考：<a href="https://deepinout.com/typescript/typescript-questions/190_typescript_typescript_reflection_for_interfaces.html">https://deepinout.com/typescript/typescript-questions/190_typescript_typescript_reflection_for_interfaces.html</a></p>
<p>在 TypeScript 中，我们可以使用 <code>keyof</code> 关键字来获取接口的所有属性名。例如，我们可以使用如下代码获取 <code>Person</code> 接口的属性名数组：</p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-type">type</span> <span class="token class-name">PersonKeys</span> <span class="token operator">=</span> <span class="token keyword keyword-keyof">keyof</span> Person<span class="token punctuation">;</span>

<span class="token comment">// Output: "name" | "age" | "greet"</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>PersonKeys<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>TypeScript</p>
<p>Copy</p>
<p>上面的代码中，我们定义了一个类型别名 <code>PersonKeys</code>，它是 <code>Person</code> 接口的属性名的联合类型。然后我们使用 <code>console.log</code> 打印出了 <code>PersonKeys</code> 的值，得到了 <code>"name" | "age" | "greet"</code>。</p>
<p><strong>实际应用</strong></p>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-static">static</span> <span class="token keyword keyword-async">async</span> <span class="token function">updateItem</span><span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> itemPart<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-let">let</span> student <span class="token operator">=</span> <span class="token keyword keyword-await">await</span> db<span class="token punctuation">.</span>students<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>student<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//WM错误：无法使用</span>
      <span class="token comment">// type fieldKeys = keyof IStudent;</span>
      <span class="token comment">// const keys = Object.keys(itemPart) as fieldKeys[];</span>
      <span class="token comment">// keys.forEach((field: string) =&gt; {</span>
      <span class="token comment">//   student[field] = itemPart[field];</span>
      <span class="token comment">// });</span>
      <span class="token keyword keyword-const">const</span> fields<span class="token operator">=</span><span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token function">getTableNames</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span>students<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>fields<span class="token operator">&amp;&amp;</span>itemPart<span class="token punctuation">)</span>
      fields<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>field<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> tmp<span class="token operator">=</span>itemPart<span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>tmp<span class="token operator">!=</span><span class="token keyword keyword-undefined">undefined</span><span class="token punctuation">)</span>
        student<span class="token punctuation">[</span>field<span class="token punctuation">]</span> <span class="token operator">=</span>tmp<span class="token punctuation">;</span> 
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      student<span class="token punctuation">.</span>lastModified <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword keyword-await">await</span> db<span class="token punctuation">.</span>students<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre><p><strong>注意：keyof在vue中无法使用！！！！</strong></p>
<blockquote>
<p>IndexDB里通过数据库表字段，来控制传入的对象</p>
</blockquote>
<pre data-role="codeBlock" data-info="typescript" class="language-typescript typescript"><code><span class="token keyword keyword-private">private</span> <span class="token keyword keyword-static">static</span> tabFields<span class="token operator">:</span>Map<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span><span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;=</span><span class="token keyword keyword-new">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-static">static</span>  <span class="token function">getTableNames</span><span class="token punctuation">(</span>dbtable<span class="token operator">:</span><span class="token builtin">any</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>

    <span class="token keyword keyword-const">const</span> key<span class="token operator">=</span>dbtable<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword keyword-this">this</span><span class="token punctuation">.</span>tabFields<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> fields<span class="token operator">:</span><span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span>tabFields<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>fields<span class="token punctuation">)</span>
        <span class="token keyword keyword-const">const</span> tt<span class="token operator">=</span>dbtable<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>indexes<span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> primKey<span class="token operator">=</span> db<span class="token punctuation">.</span>students<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>primKey<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
        tt<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>it<span class="token operator">=&gt;</span><span class="token punctuation">{</span>
          <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span>name<span class="token operator">!=</span>primKey<span class="token punctuation">)</span>
           fields<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span>tabFields<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><h3 id="6-其他">6、其他 </h3>

      </div>
      
      
    
    
    
    
    
    
  
    </body></html>