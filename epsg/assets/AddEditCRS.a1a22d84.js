import{d as A,av as I,y as E,_ as M,w as T,a as k,r as N,c as _,o as w,v as $,l,k as a,C as j,j as P,g as O,$ as G,aH as H,aI as V,aJ as h,aK as q,aL as z,a0 as K,aM as W}from"./vendor.de069ad6.js";import{B as F,g as p}from"./xframelib-exp.e4d795a1.js";import{e as J,I as L,E as Z,c as Q}from"./SpatialService.fe9450b1.js";import{O as ee,h as ue,E as R,_ as ae}from"./index.f27a7adf.js";import{T as D}from"./TableEvent.69ad174d.js";import"./lodash-es-exp.d3c3d62f.js";import"./axios-exp.cd5cf947.js";import"./vue-router-exp.aee9d5fb.js";const X="AddEditCRS";let te;const U={validateForm:te,name:X,props:{data:{type:Number},extra:I()},setup(u,{emit:t}){function Y(r){r&&g()}E(()=>{ee(X,Y)}),M(()=>{ue(X,Y)}),T(()=>u.data,r=>{n()},{deep:!0});const f=k(),e=N({code:"",name:"",kind:"geographic",area:"",proj4:"",wkt:"",bminX:"",bminY:"",bmaxX:"",bmaxY:"",pminX:"",pminY:"",pmaxX:"",pmaxY:"",deprecated:!1}),B=_(()=>u.extra?.isEdit),v=_(()=>e.kind==="geographic"),s=async(r,o)=>{if(!o)return Promise.reject("\u8BF7\u8F93\u5165\u552F\u4E00\u6570\u5B57\u7F16\u7801");const C=+o;return Number.isInteger(C)?await Q(C)?Promise.reject("\u7F16\u7801\u5DF2\u7ECF\u5B58\u5728\uFF0C\u8BF7\u4FEE\u6539\uFF01"):Promise.resolve():Promise.reject("\u5FC5\u987B\u4E3A\u6574\u6570\u6570\u5B57")},m=[{message:"\u5FC5\u987B\u4E3A\u6570\u5B57",trigger:"blur",type:"number"}],c={code:[{required:!0,validator:s,type:"number",trigger:"blur"}],name:[{required:!0,message:"\u8BF7\u8F93\u5165\u5750\u6807\u7CFB\u540D\u79F0",trigger:"blur"}],wkt:[{required:!0,message:"\u8BF7\u8F93\u5165WKT\u6587\u672C",trigger:"blur"}],bminX:m,bmaxX:m,bminY:m,bmaxY:m,pminX:m,pmaxX:m,pminY:m,pmaxY:m};U.validateForm=()=>f.value.validate();const g=()=>{B.value?S():d()};function b(){const r={code:e.code,name:e.name,kind:e.kind,wkt:e.wkt};return e.area&&(r.area=e.area),e.proj4&&(r.proj4=e.proj4),e.kind==="geographic"?(r.unit="degree",p(e.bminX)&&p(e.bminY)&&p(e.bmaxY)&&p(e.bmaxX)&&(r.bbox=`${e.bminX},${e.bminY},${e.bmaxX},${e.bmaxY}`)):(r.unit="metre",p(e.bminX)&&p(e.bminY)&&p(e.bmaxY)&&p(e.bmaxX)&&(r.bbox=`${e.bminX},${e.bminY},${e.bmaxX},${e.bmaxY}`),p(e.pminX)&&p(e.pminY)&&p(e.pmaxY)&&p(e.pmaxX)&&(r.pbox=`${e.pminX},${e.pminY},${e.pmaxX},${e.pmaxY}`)),r}const d=()=>{const r=b();L(r).then(o=>{o?(F.Message?.msg("\u65B0\u5EFA\u5750\u6807\u7CFB\u6210\u529F!"),f.value.resetFields(),R(D.RefeshTable,void 0)):F.Message?.err("\u65B0\u5EFA\u5750\u6807\u7CFB\u5931\u8D25!")}).catch(o=>{F.Message?.err("\u64CD\u4F5C\u5931\u8D25:"+o.message)})},S=()=>{const r=b();Z(r).then(o=>{o?(F.Message?.msg("\u66F4\u65B0\u5750\u6807\u7CFB\u6210\u529F!"),f.value.resetFields(),R(D.RefeshTable,void 0)):F.Message?.err("\u66F4\u65B0\u5750\u6807\u7CFB\u5931\u8D25!")}).catch(o=>{F.Message?.err("\u64CD\u4F5C\u5931\u8D25:"+o.message)})},n=async()=>{if(u.extra?.isEdit){const r=+u.data,o=await J(r);if(console.log(o,"6877777"),o){if(e.code=o.code,e.name=o.name,e.kind=o.kind,e.area=o.area,e.wkt=o.wkt,e.proj4=o.proj4,e.unit=o.unit,o.bbox){const i=o.bbox.split(",");i.length>=4&&(e.bminX=i[0],e.bminY=i[1],e.bmaxX=i[2],e.bmaxY=i[3])}if(o.kind==="projected"&&o.pbox){const i=o.pbox.split(",");i.length>=4&&(e.pminX=i[0],e.pminY=i[1],e.pmaxX=i[2],e.pmaxY=i[3])}}}else f.value.resetFields()};E(()=>{n()});function y(){var r=new FileReader;r.onload=function(){r.result&&(console.log("899990000000000"),e.wkt=r.result.toString())},r.readAsText(x.value.files[0])}const x=k();return{formState:e,labelCol:{span:6},wrapperCol:{span:14},formRef:f,rules:c,onSubmit:g,isEdit:B,isGeographic:v,openFile:y,picker:x}}},ne=A(U);function oe(u,t,Y,f,e,B){const v=G,s=H,m=V,c=h,g=q,b=z,d=K,S=W;return w(),$(S,{model:u.formState,"label-col":u.labelCol,"wrapper-col":u.wrapperCol,rules:u.rules,ref:"formRef"},{default:l(()=>[a(m,{style:{"margin-left":"105px"}},{default:l(()=>[a(s,{label:"\u7F16\u7801",name:"code"},{default:l(()=>[a(v,{value:u.formState.code,"onUpdate:value":t[0]||(t[0]=n=>u.formState.code=n),placeholder:"\u8BF7\u8F93\u5165\u552F\u4E00\u6570\u5B57\u7F16\u7801",disabled:u.isEdit,min:1e4},null,8,["value","disabled"])]),_:1}),a(s,{label:"\u540D\u79F0",name:"name"},{default:l(()=>[a(v,{value:u.formState.name,"onUpdate:value":t[1]||(t[1]=n=>u.formState.name=n),placeholder:"\u8F93\u5165\u4E2D\u6587\u540D\u79F0"},null,8,["value"])]),_:1})]),_:1}),a(s,{label:"\u6295\u5F71\u7C7B\u578B",name:"kind"},{default:l(()=>[a(g,{value:u.formState.kind,"onUpdate:value":t[2]||(t[2]=n=>u.formState.kind=n),placeholder:"\u8BF7\u9009\u62E9\u670D\u52A1\u7C7B\u578B"},{default:l(()=>[a(c,{value:"projected"},{default:l(()=>[j("\u6295\u5F71\u5750\u6807\u7CFB\u7EDF")]),_:1}),a(c,{value:"geographic"},{default:l(()=>[j("\u5730\u7406\u5750\u6807\u7CFB\u7EDF")]),_:1})]),_:1},8,["value"])]),_:1}),a(s,{label:"\u4F7F\u7528\u8303\u56F4",name:"area"},{default:l(()=>[a(b,{value:u.formState.area,"onUpdate:value":t[3]||(t[3]=n=>u.formState.area=n),placeholder:"\u8F93\u5165\u5750\u6807\u7684\u6709\u6548\u8303\u56F4\u8BF4\u660E","auto-size":{minRows:1,maxRows:3}},null,8,["value"])]),_:1}),a(s,{label:"\u7ECF\u7EAC\u5EA6\u8303\u56F4"},{default:l(()=>[a(m,null,{default:l(()=>[a(s,{label:"\u6700\u5C0FX",name:"bminX",class:"scopeBox"},{default:l(()=>[a(d,{value:u.formState.bminX,"onUpdate:value":t[4]||(t[4]=n=>u.formState.bminX=n),placeholder:"\u6700\u5C0FX,-180"},null,8,["value"])]),_:1}),a(s,{label:"\u6700\u5C0FY",name:"bminY",class:"scopeBox"},{default:l(()=>[a(d,{value:u.formState.bminY,"onUpdate:value":t[5]||(t[5]=n=>u.formState.bminY=n),placeholder:"\u6700\u5C0FY,-90"},null,8,["value"])]),_:1})]),_:1}),a(m,null,{default:l(()=>[a(s,{label:"\u6700\u5927X",name:"bmaxX",class:"scopeBox"},{default:l(()=>[a(d,{value:u.formState.bmaxX,"onUpdate:value":t[6]||(t[6]=n=>u.formState.bmaxX=n),placeholder:"\u6700\u5927X,180"},null,8,["value"])]),_:1}),a(s,{label:"\u6700\u5927Y",name:"bmaxY",class:"scopeBox"},{default:l(()=>[a(d,{value:u.formState.bmaxY,"onUpdate:value":t[7]||(t[7]=n=>u.formState.bmaxY=n),placeholder:"\u6700\u5927Y,90"},null,8,["value"])]),_:1})]),_:1})]),_:1}),u.isGeographic?P("",!0):(w(),$(s,{key:0,label:"\u6295\u5F71\u8303\u56F4"},{default:l(()=>[a(m,null,{default:l(()=>[a(s,{label:"\u6700\u5C0FY",name:"pminY",class:"scopeBox"},{default:l(()=>[a(d,{value:u.formState.pminX,"onUpdate:value":t[8]||(t[8]=n=>u.formState.pminX=n),placeholder:"\u8BF7\u8F93\u5165\u6700\u5C0FX"},null,8,["value"])]),_:1}),a(s,{label:"\u6700\u5C0FY",name:"pminY",class:"scopeBox"},{default:l(()=>[a(d,{value:u.formState.pminY,"onUpdate:value":t[9]||(t[9]=n=>u.formState.pminY=n),placeholder:"\u8BF7\u8F93\u5165\u6700\u5C0FY"},null,8,["value"])]),_:1})]),_:1}),a(m,null,{default:l(()=>[a(s,{label:"\u6700\u5927X",name:"pmaxX",class:"scopeBox"},{default:l(()=>[a(d,{value:u.formState.pmaxX,"onUpdate:value":t[10]||(t[10]=n=>u.formState.pmaxX=n),placeholder:"\u8BF7\u8F93\u5165\u6700\u5927X"},null,8,["value"])]),_:1}),a(s,{label:"\u6700\u5927Y",name:"pmaxY",class:"scopeBox"},{default:l(()=>[a(d,{value:u.formState.pmaxY,"onUpdate:value":t[11]||(t[11]=n=>u.formState.pmaxY=n),placeholder:"\u8BF7\u8F93\u5165\u6700\u5927Y"},null,8,["value"])]),_:1})]),_:1})]),_:1})),a(s,{label:"OGC WKT",name:"wkt"},{default:l(()=>[a(b,{value:u.formState.wkt,"onUpdate:value":t[12]||(t[12]=n=>u.formState.wkt=n),"auto-size":{minRows:3,maxRows:7}},null,8,["value"]),O("input",{type:"file",ref:"picker",accept:".prj,.wkt",onChange:t[13]||(t[13]=n=>u.openFile())},null,544)]),_:1}),a(s,{label:"Proj4",name:"proj4"},{default:l(()=>[a(b,{value:u.formState.proj4,"onUpdate:value":t[14]||(t[14]=n=>u.formState.proj4=n),"auto-size":{minRows:2,maxRows:5}},null,8,["value"])]),_:1})]),_:1},8,["model","label-col","wrapper-col","rules"])}const be=ae(ne,[["render",oe],["__scopeId","data-v-e5df06e8"]]);export{be as default};
