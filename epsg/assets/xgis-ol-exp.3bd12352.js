import{r as Is,d as ve,P as la,Q as Yl,S as gs,U as Kl,V as jc,w as Xt,k as G,t as tt,o as ot,b as Ct,C as Fi,D as pe,v as Ai,l as ut,F as Zl,x as Hl,g as I,q as zc,j as Me,W as Ul,X as Bc,a as gt,Y as Nc,c as Ot,y as Ln,Z as ha,_ as Wc,E as Xc,e as on,$ as Vc,a0 as Yc,a1 as Kc,f as ti,J as Zc,A as Hc,B as Uc,a2 as qc,a3 as Jc,n as $c,h as Qc}from"./vendor.de069ad6.js";import{I as Ge}from"./@iconify/vue-exp.b199edd5.js";const et={LAYER_ORDER_CHANGED:"LAYER_ORDER_CHANGED",LAYER_LOCATE:"LAYER_LOCATE",LAYER_OPACITY_CHANGED:"LAYER_OPACITY_CHANGED",LAYER_VISIBLE_CHANGED:"LAYER_VISIBLE_CHANGED",LAYER_ADDED:"LAYER_ADDED",LAYER_REMOVED:"LAYER_REMOVED",LAYER_COPY:"LAYER_COPY",LAYER_ITEMS_CHANGED:"LAYER_ITEMS_CHANGED",LAYER_ITEM_UPDATED:"LAYER_ITEM_UPDATED",LAYER_SWIPE_CHANGED:"LAYER_SWIPE_CHANGED",MAP_SYNC_VIEW:"MAP_SYNC_VIEW",MAP_SYNC_VIEW_END:"MAP_SYNC_VIEW_END",MAP_ZOOM_CHANGED:"MAP_ZOOM_CHANGED",MAP_MESSAGE_INFO:"MAP_MESSAGE_INFO",LAYER_TREE_CONTEXT_MENU:"LAYER_TREE_CONTEXT_MENU"};class po{mapID;mapGroup;data;target;constructor(t,e){this.mapID=t,this.mapGroup=e}}function ql(i){return{all:i=i||new Map,on(t,e){const n=i?.get(t);n&&n.push(e)||i?.set(t,[e])},off(t,e){const n=i?.get(t);n&&n.splice(n.indexOf(e)>>>0,1)},emit(t,e){(i?.get(t)||[]).slice().map(n=>{n(e)}),(i?.get("*")||[]).slice().map(n=>{n(t,e)})}}}ql();class tu{eventBus;constructor(){this.eventBus=ql()}eventEmit(t,e){this.eventBus.emit(t,e)}eventOn(t,e){this.eventBus.on(t,e)}eventOff(t,e){this.eventBus.off(t,e)}}const Jl=new tu;function Wi(i,t=null){const e=new po(F.mapid,F.mapgroup);return e.data=i,e.target=t,e}const F=Is({mapid:"map",mapgroup:"map",changed:!1,groups:[],layers:[],swipeid:void 0});function eu(i,t,e="map"){F.mapEventBus=i,F.mapid=t,F.mapgroup=e,F.changed=!1,F.layers=[],F.groups=[],F.mapEventBus.eventOn(et.LAYER_ADDED,iu)}function iu(i){if(i.mapID!=F.mapid)return!1;const t=i.data;if(!t||!t.id)return!1;if(F.layers){if(nu(t.id))return!1;F.layers.push(t),F.changed=!F.changed}else F.layers=[],F.layers.push(t),F.changed=!F.changed}function nu(i){if(!i)return!0;if(!F.layers)return!1;let t=!1;const e=F.layers.length;for(let n=0;n<e;n++)if(F.layers[n].id===i){t=!0;break}return t}function ca(i){let t=!1;if(F.layers){let n=-1;const s=F.layers.length;for(var e=0;e<s;e++)if(F.layers[e].id===i){n=e;break}n!=-1&&(F.layers.splice(n,1),t=!0,F.mapEventBus.eventEmit(et.LAYER_REMOVED,Wi({id:i})),F.changed=!F.changed)}return t}function ua(i,t){if(F.layers){const n=F.layers.length;for(var e=0;e<n;e++){let s=F.layers[e];if(s.id===i){s.visible=t,F.mapEventBus.eventEmit(et.LAYER_VISIBLE_CHANGED,Wi({id:i,visible:t}));break}}}}function su(i,t){if(F.layers){const n=F.layers.length;for(var e=0;e<n;e++){let s=F.layers[e];if(s.id===i){let r=1;r=t>1?1:t<0?0:t,s.opacity=r,F.mapEventBus.eventEmit(et.LAYER_OPACITY_CHANGED,Wi({id:i,opacity:r}));break}}}}function ru(i,t){if(F.layers){let n=-1;const s=F.layers.length;let r;for(var e=0;e<s;e++)if(r=F.layers[e],r.id===i){n=e;break}if(n>=0){const o=n-t;if(o<0||o>=s)return;F.layers.splice(n,1),F.layers.splice(o,0,r),F.mapEventBus.eventEmit(et.LAYER_ORDER_CHANGED,Wi({id:i,index:n,newindex:o})),F.changed=!F.changed}}}function ou(i){if(i&&F.layers){let e=-1;const n=F.layers.length;let s;for(var t=0;t<n;t++)if(s=F.layers[t],s.id===i){e=t;break}e>=0&&(F.swipeid=i,F.mapEventBus.eventEmit(et.LAYER_SWIPE_CHANGED,Wi({id:i,index:e})))}}function au(i){F.mapEventBus.eventEmit(et.LAYER_TREE_CONTEXT_MENU,Wi({key:i}))}function kt(i,t){(function(n){return typeof n=="string"&&n.indexOf(".")!==-1&&parseFloat(n)===1})(i)&&(i="100%");var e=function(n){return typeof n=="string"&&n.indexOf("%")!==-1}(i);return i=t===360?i:Math.min(t,Math.max(0,parseFloat(i))),e&&(i=parseInt(String(i*t),10)/100),Math.abs(i-t)<1e-6?1:i=t===360?(i<0?i%t+t:i%t)/parseFloat(String(t)):i%t/parseFloat(String(t))}function zn(i){return i<=1?"".concat(100*Number(i),"%"):i}function Hs(i){return i.length===1?"0"+i:String(i)}function Us(i,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?i+6*e*(t-i):e<.5?t:e<2/3?i+(t-i)*(2/3-e)*6:i}function da(i){return Et(i)/255}function Et(i){return parseInt(i,16)}var ga={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function qi(i){var t={r:0,g:0,b:0},e=1,n=null,s=null,r=null,o=!1,a=!1;return typeof i=="string"&&(i=function(l){if((l=l.trim().toLowerCase()).length===0)return!1;var h=!1;if(ga[l])l=ga[l],h=!0;else if(l==="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var c=zt.rgb.exec(l);return c?{r:c[1],g:c[2],b:c[3]}:(c=zt.rgba.exec(l))?{r:c[1],g:c[2],b:c[3],a:c[4]}:(c=zt.hsl.exec(l))?{h:c[1],s:c[2],l:c[3]}:(c=zt.hsla.exec(l))?{h:c[1],s:c[2],l:c[3],a:c[4]}:(c=zt.hsv.exec(l))?{h:c[1],s:c[2],v:c[3]}:(c=zt.hsva.exec(l))?{h:c[1],s:c[2],v:c[3],a:c[4]}:(c=zt.hex8.exec(l))?{r:Et(c[1]),g:Et(c[2]),b:Et(c[3]),a:da(c[4]),format:h?"name":"hex8"}:(c=zt.hex6.exec(l))?{r:Et(c[1]),g:Et(c[2]),b:Et(c[3]),format:h?"name":"hex"}:(c=zt.hex4.exec(l))?{r:Et(c[1]+c[1]),g:Et(c[2]+c[2]),b:Et(c[3]+c[3]),a:da(c[4]+c[4]),format:h?"name":"hex8"}:(c=zt.hex3.exec(l))?{r:Et(c[1]+c[1]),g:Et(c[2]+c[2]),b:Et(c[3]+c[3]),format:h?"name":"hex"}:!1}(i)),typeof i=="object"&&(le(i.r)&&le(i.g)&&le(i.b)?(t=function(l,h,c){return{r:255*kt(l,255),g:255*kt(h,255),b:255*kt(c,255)}}(i.r,i.g,i.b),o=!0,a=String(i.r).substr(-1)==="%"?"prgb":"rgb"):le(i.h)&&le(i.s)&&le(i.v)?(n=zn(i.s),s=zn(i.v),t=function(l,h,c){l=6*kt(l,360),h=kt(h,100),c=kt(c,100);var u=Math.floor(l),d=l-u,g=c*(1-h),p=c*(1-d*h),f=c*(1-(1-d)*h),m=u%6;return{r:255*[c,p,g,g,f,c][m],g:255*[f,c,c,p,g,g][m],b:255*[g,g,f,c,c,p][m]}}(i.h,n,s),o=!0,a="hsv"):le(i.h)&&le(i.s)&&le(i.l)&&(n=zn(i.s),r=zn(i.l),t=function(l,h,c){var u,d,g;if(l=kt(l,360),h=kt(h,100),c=kt(c,100),h===0)d=c,g=c,u=c;else{var p=c<.5?c*(1+h):c+h-c*h,f=2*c-p;u=Us(f,p,l+1/3),d=Us(f,p,l),g=Us(f,p,l-1/3)}return{r:255*u,g:255*d,b:255*g}}(i.h,n,r),o=!0,a="hsl"),Object.prototype.hasOwnProperty.call(i,"a")&&(e=i.a)),e=function(l){return l=parseFloat(l),(isNaN(l)||l<0||l>1)&&(l=1),l}(e),{ok:o,format:i.format||a,r:Math.min(255,Math.max(t.r,0)),g:Math.min(255,Math.max(t.g,0)),b:Math.min(255,Math.max(t.b,0)),a:e}}var Le="(?:".concat("[-\\+]?\\d*\\.\\d+%?",")|(?:").concat("[-\\+]?\\d+%?",")"),qs="[\\s|\\(]+(".concat(Le,")[,|\\s]+(").concat(Le,")[,|\\s]+(").concat(Le,")\\s*\\)?"),Js="[\\s|\\(]+(".concat(Le,")[,|\\s]+(").concat(Le,")[,|\\s]+(").concat(Le,")[,|\\s]+(").concat(Le,")\\s*\\)?"),zt={CSS_UNIT:new RegExp(Le),rgb:new RegExp("rgb"+qs),rgba:new RegExp("rgba"+Js),hsl:new RegExp("hsl"+qs),hsla:new RegExp("hsla"+Js),hsv:new RegExp("hsv"+qs),hsva:new RegExp("hsva"+Js),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function le(i){return Boolean(zt.CSS_UNIT.exec(String(i)))}var lu=[{index:7,opacity:.15},{index:6,opacity:.25},{index:5,opacity:.3},{index:5,opacity:.45},{index:5,opacity:.65},{index:5,opacity:.85},{index:4,opacity:.9},{index:3,opacity:.95},{index:2,opacity:.97},{index:1,opacity:.98}];function fa(i){var t=function(e,n,s){e=kt(e,255),n=kt(n,255),s=kt(s,255);var r=Math.max(e,n,s),o=Math.min(e,n,s),a=0,l=r,h=r-o,c=r===0?0:h/r;if(r===o)a=0;else{switch(r){case e:a=(n-s)/h+(n<s?6:0);break;case n:a=(s-e)/h+2;break;case s:a=(e-n)/h+4}a/=6}return{h:a,s:c,v:l}}(i.r,i.g,i.b);return{h:360*t.h,s:t.s,v:t.v}}function Bn(i){var t=i.r,e=i.g,n=i.b;return"#".concat(function(s,r,o,a){var l=[Hs(Math.round(s).toString(16)),Hs(Math.round(r).toString(16)),Hs(Math.round(o).toString(16))];return a&&l[0].startsWith(l[0].charAt(1))&&l[1].startsWith(l[1].charAt(1))&&l[2].startsWith(l[2].charAt(1))?l[0].charAt(0)+l[1].charAt(0)+l[2].charAt(0):l.join("")}(t,e,n,!1))}function hu(i,t,e){var n=e/100;return{r:(t.r-i.r)*n+i.r,g:(t.g-i.g)*n+i.g,b:(t.b-i.b)*n+i.b}}function pa(i,t,e){var n;return(n=Math.round(i.h)>=60&&Math.round(i.h)<=240?e?Math.round(i.h)-2*t:Math.round(i.h)+2*t:e?Math.round(i.h)+2*t:Math.round(i.h)-2*t)<0?n+=360:n>=360&&(n-=360),n}function ma(i,t,e){return i.h===0&&i.s===0?i.s:((n=e?i.s-.16*t:t===4?i.s+.16:i.s+.05*t)>1&&(n=1),e&&t===5&&n>.1&&(n=.1),n<.06&&(n=.06),Number(n.toFixed(2)));var n}function _a(i,t,e){var n;return(n=e?i.v+.05*t:i.v-.15*t)>1&&(n=1),Number(n.toFixed(2))}function Lr(i){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=[],n=qi(i),s=5;s>0;s-=1){var r=fa(n),o=Bn(qi({h:pa(r,s,!0),s:ma(r,s,!0),v:_a(r,s,!0)}));e.push(o)}e.push(Bn(n));for(var a=1;a<=4;a+=1){var l=fa(n),h=Bn(qi({h:pa(l,a),s:ma(l,a),v:_a(l,a)}));e.push(h)}return t.theme==="dark"?lu.map(function(c){var u=c.index,d=c.opacity;return Bn(hu(qi(t.backgroundColor||"#141414"),qi(e[u]),100*d))}):e}var $s={red:"#F5222D",volcano:"#FA541C",orange:"#FA8C16",gold:"#FAAD14",yellow:"#FADB14",lime:"#A0D911",green:"#52C41A",cyan:"#13C2C2",blue:"#1890FF",geekblue:"#2F54EB",purple:"#722ED1",magenta:"#EB2F96",grey:"#666666"},Qs={},tr={};Object.keys($s).forEach(function(i){Qs[i]=Lr($s[i]),Qs[i].primary=Qs[i][5],tr[i]=Lr($s[i],{theme:"dark",backgroundColor:"#141414"}),tr[i].primary=tr[i][5]});var ya=[],Ji=[];function cu(i,t){if(t=t||{},i===void 0)throw new Error("insert-css: You need to provide a CSS string. Usage: insertCss(cssString[, options]).");var e,n=t.prepend===!0?"prepend":"append",s=t.container!==void 0?t.container:document.querySelector("head"),r=ya.indexOf(s);return r===-1&&(r=ya.push(s)-1,Ji[r]={}),Ji[r]!==void 0&&Ji[r][n]!==void 0?e=Ji[r][n]:(e=Ji[r][n]=function(){var o=document.createElement("style");return o.setAttribute("type","text/css"),o}(),n==="prepend"?s.insertBefore(e,s.childNodes[0]):s.appendChild(e)),i.charCodeAt(0)===65279&&(i=i.substr(1,i.length)),e.styleSheet?e.styleSheet.cssText+=i:e.textContent+=i,e}function va(i){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?Object(arguments[t]):{},n=Object.keys(e);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(e).filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),n.forEach(function(s){uu(i,s,e[s])})}return i}function uu(i,t,e){return t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}function xa(i){return typeof i=="object"&&typeof i.name=="string"&&typeof i.theme=="string"&&(typeof i.icon=="object"||typeof i.icon=="function")}function $l(i,t,e){return Qc(i.tag,e?va({key:t},e,i.attrs):va({key:t},i.attrs),(i.children||[]).map(function(n,s){return $l(n,"".concat(t,"-").concat(i.tag,"-").concat(s))}))}function Ql(i){return Lr(i)[0]}function th(i){return i?Array.isArray(i)?i:[i]:[]}var du=`
.anticon {
  display: inline-block;
  color: inherit;
  font-style: normal;
  line-height: 0;
  text-align: center;
  text-transform: none;
  vertical-align: -0.125em;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

.anticon > * {
  line-height: 1;
}

.anticon svg {
  display: inline-block;
}

.anticon::before {
  display: none;
}

.anticon .anticon-icon {
  display: block;
}

.anticon[tabindex] {
  cursor: pointer;
}

.anticon-spin::before,
.anticon-spin {
  display: inline-block;
  -webkit-animation: loadingCircle 1s infinite linear;
  animation: loadingCircle 1s infinite linear;
}

@-webkit-keyframes loadingCircle {
  100% {
    -webkit-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}

@keyframes loadingCircle {
  100% {
    -webkit-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}
`,Ca=!1,gu=["icon","primaryColor","secondaryColor"];function fu(i,t){if(i==null)return{};var e,n,s=function(o,a){if(o==null)return{};var l,h,c={},u=Object.keys(o);for(h=0;h<u.length;h++)l=u[h],a.indexOf(l)>=0||(c[l]=o[l]);return c}(i,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);for(n=0;n<r.length;n++)e=r[n],t.indexOf(e)>=0||Object.prototype.propertyIsEnumerable.call(i,e)&&(s[e]=i[e])}return s}function os(i){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?Object(arguments[t]):{},n=Object.keys(e);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(e).filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),n.forEach(function(s){pu(i,s,e[s])})}return i}function pu(i,t,e){return t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}var en={primaryColor:"#333",secondaryColor:"#E6E6E6",calculated:!1},Re=function(i,t){var e=os({},i,t.attrs),n=e.icon,s=e.primaryColor,r=e.secondaryColor,o=fu(e,gu),a=en;if(s&&(a={primaryColor:s,secondaryColor:r||Ql(s)}),function(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:du;$c(function(){Ca||(typeof window<"u"&&window.document&&window.document.documentElement&&cu(h,{prepend:!0}),Ca=!0)})}(),xa(n),!xa(n))return null;var l=n;return l&&typeof l.icon=="function"&&(l=os({},l,{icon:l.icon(a.primaryColor,a.secondaryColor)})),$l(l.icon,"svg-".concat(l.name),os({},o,{"data-icon":l.name,width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true"}))};function mu(i,t){return function(e){if(Array.isArray(e))return e}(i)||function(e,n){var s=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(s!=null){var r,o,a=[],l=!0,h=!1;try{for(s=s.call(e);!(l=(r=s.next()).done)&&(a.push(r.value),!n||a.length!==n);l=!0);}catch(c){h=!0,o=c}finally{try{l||s.return==null||s.return()}finally{if(h)throw o}}return a}}(i,t)||function(e,n){if(e){if(typeof e=="string")return wa(e,n);var s=Object.prototype.toString.call(e).slice(8,-1);if(s==="Object"&&e.constructor&&(s=e.constructor.name),s==="Map"||s==="Set")return Array.from(e);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return wa(e,n)}}(i,t)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function wa(i,t){(t==null||t>i.length)&&(t=i.length);for(var e=0,n=new Array(t);e<t;e++)n[e]=i[e];return n}function eh(i){var t=mu(th(i),2),e=t[0],n=t[1];return Re.setTwoToneColors({primaryColor:e,secondaryColor:n})}Re.props={icon:Object,primaryColor:String,secondaryColor:String,focusable:String},Re.inheritAttrs=!1,Re.displayName="IconBase",Re.getTwoToneColors=function(){return os({},en)},Re.setTwoToneColors=function(i){var t=i.primaryColor,e=i.secondaryColor;en.primaryColor=t,en.secondaryColor=e||Ql(t),en.calculated=!!e};var _u=["class","icon","spin","rotate","tabindex","twoToneColor","onClick"];function yu(i,t){return function(e){if(Array.isArray(e))return e}(i)||function(e,n){var s=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(s!=null){var r,o,a=[],l=!0,h=!1;try{for(s=s.call(e);!(l=(r=s.next()).done)&&(a.push(r.value),!n||a.length!==n);l=!0);}catch(c){h=!0,o=c}finally{try{l||s.return==null||s.return()}finally{if(h)throw o}}return a}}(i,t)||function(e,n){if(e){if(typeof e=="string")return Sa(e,n);var s=Object.prototype.toString.call(e).slice(8,-1);if(s==="Object"&&e.constructor&&(s=e.constructor.name),s==="Map"||s==="Set")return Array.from(e);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return Sa(e,n)}}(i,t)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Sa(i,t){(t==null||t>i.length)&&(t=i.length);for(var e=0,n=new Array(t);e<t;e++)n[e]=i[e];return n}function Ea(i){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?Object(arguments[t]):{},n=Object.keys(e);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(e).filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),n.forEach(function(s){Pr(i,s,e[s])})}return i}function Pr(i,t,e){return t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}function vu(i,t){if(i==null)return{};var e,n,s=function(o,a){if(o==null)return{};var l,h,c={},u=Object.keys(o);for(h=0;h<u.length;h++)l=u[h],a.indexOf(l)>=0||(c[l]=o[l]);return c}(i,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);for(n=0;n<r.length;n++)e=r[n],t.indexOf(e)>=0||Object.prototype.propertyIsEnumerable.call(i,e)&&(s[e]=i[e])}return s}eh("#1890ff");var Si=function(i,t){var e,n=Ea({},i,t.attrs),s=n.class,r=n.icon,o=n.spin,a=n.rotate,l=n.tabindex,h=n.twoToneColor,c=n.onClick,u=vu(n,_u),d=(Pr(e={anticon:!0},"anticon-".concat(r.name),Boolean(r.name)),Pr(e,s,s),e),g=o===""||o||r.name==="loading"?"anticon-spin":"",p=l;p===void 0&&c&&(p=-1,u.tabindex=p);var f=a?{msTransform:"rotate(".concat(a,"deg)"),transform:"rotate(".concat(a,"deg)")}:void 0,m=yu(th(h),2),_=m[0],y=m[1];return G("span",Ea({role:"img","aria-label":r.name},u,{onClick:c,class:d}),[G(Re,{class:g,icon:r,primaryColor:_,secondaryColor:y,style:f},null)])};Si.props={spin:Boolean,rotate:Number,icon:Object,twoToneColor:String},Si.displayName="AntdIcon",Si.inheritAttrs=!1,Si.getTwoToneColor=function(){var i=Re.getTwoToneColors();return i.calculated?[i.primaryColor,i.secondaryColor]:i.primaryColor},Si.setTwoToneColor=eh;var xu={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"};function ba(i){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?Object(arguments[t]):{},n=Object.keys(e);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(e).filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),n.forEach(function(s){Cu(i,s,e[s])})}return i}function Cu(i,t,e){return t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}var Fr=function(i,t){var e=ba({},i,t.attrs);return G(Si,ba({},e,{icon:xu}),null)};Fr.displayName="ExclamationCircleOutlined",Fr.inheritAttrs=!1;var wu=Fr;const Su=[{name:"\u5347\u5E8F",icon:"gis:layer-up",value:"upMove"},{name:"\u964D\u5E8F",icon:"gis:layer-down",value:"downMove"},{name:"\u5B9A\u4F4D",icon:"gis:location-on",value:"location"},{name:"\u5220\u9664",icon:"gis:layer-2-rm-o",value:"delete"}];function Eu(){return Su}const bu=[{name:"\u6DFB\u52A0\u5929\u5730\u56FE\u56FE\u5C42",icon:"gis:wmts",value:"addTDTWMTS"},{name:"\u6DFB\u52A0WMTS\u56FE\u5C42",icon:"gis:wmts",value:"addWMTS"},{name:"\u6DFB\u52A0XYZ\u56FE\u5C42",icon:"gis:xyz",value:"addXYZ"},{name:"\u6DFB\u52A0MVT\u56FE\u5C42",icon:"gis:mvt",value:"addMVT"},{name:"\u6DFB\u52A0Geojson",icon:"gis:geojson-file",value:"addGeoJson"}],Tu={grid:"gis:layer-height",vector:"gis:extent-alt",mvt:"gis:layer-road",symbol:"gis:layer-poi"};var as=ve({name:"",props:{data:{type:Object,required:!0}},emits:["copy","delete","orderChanged","opacityChanged","location"],components:{Modal:la,"a-popover":Yl,"a-menu":gs,"a-menu-item":gs.Item,"a-dropdown":Kl,Slider:jc,Icon:Ge},setup(i,{attrs:t,slots:e,emit:n}){const s=Is(i.data);return Xt(()=>i.data,()=>{s.id=i.data.id}),{getSymbol:function(r){return Symbol(r)},itemObj:s,getLayerItemIcon:function(r){let o=Tu[r];return o||(o="gis:photogrammetry"),o},copyClick:()=>{n("copy",s.id)},sliderChanged:function(r){n("opacityChanged",s.id,r)},getSwipeClass:function(r){return r===F.swipeid?"gis:map-control":"gis:map-o"},setSwipeLayer:function(){ou(s.id)},getLayerActionMenus:Eu,onContextMenuClick:(r,o)=>{switch(console.log(`treeKey: ${r}, menuKey: ${o}`),o){case"upMove":n("orderChanged",s.id,1);break;case"downMove":n("orderChanged",s.id,-1);break;case"location":n("location",s.id);break;case"delete":la.confirm({title:"\u786E\u5B9A\u79FB\u9664\u56FE\u5C42\uFF1F",icon:G(wu),content:`\u56FE\u5C42\u540D\uFF1A${s.name}`,okType:"danger",onOk(){n("delete",r)},onCancel(){console.log("\u53D6\u6D88\u5220\u9664")}})}}}}});const Iu={key:0},Ru=["title"],Mu={class:"layerItemMenu"},Lu={key:0},Pu={class:"opacitySpan"};as.render=function(i,t,e,n,s,r){const o=tt("Icon"),a=tt("slider"),l=tt("a-popover"),h=tt("a-menu-item"),c=tt("a-menu"),u=tt("a-dropdown");return i.itemObj.children?.length>0?(ot(),Ct("span",Iu,[G(o,{icon:"gis:world-folder"}),Fi(" "+pe(i.itemObj.name),1)])):(ot(),Ai(u,{key:1,trigger:["contextmenu"]},{overlay:ut(()=>[G(c,{onClick:t[2]||(t[2]=({key:d})=>i.onContextMenuClick(i.itemObj.id,d))},{default:ut(()=>[(ot(!0),Ct(Zl,null,Hl(i.getLayerActionMenus(),d=>(ot(),Ai(h,{key:d.value},{default:ut(()=>[I("span",null,[G(o,{icon:d.icon,width:"16",height:"16",color:"#666"},null,8,["icon"]),Fi(" "+pe(d.name),1)])]),_:2},1024))),128))]),_:1})]),default:ut(()=>[(ot(),Ct("div",{class:"layerItemLine",key:i.getSymbol(i.itemObj.id)},[I("div",{class:"titleflow",title:i.itemObj.name},[G(o,{icon:i.getLayerItemIcon(i.itemObj.type)},null,8,["icon"]),Fi(" "+pe(i.itemObj.alias??i.itemObj.name),1)],8,Ru),I("div",null,[I("ul",Mu,[I("li",null,[I("span",{title:"\u900F\u89C6\u56FE\u5C42",onClick:t[0]||(t[0]=zc((...d)=>i.setSwipeLayer&&i.setSwipeLayer(...d),["stop"]))},[G(o,{icon:i.getSwipeClass(i.itemObj.id)},null,8,["icon"])])]),i.itemObj.opacity?(ot(),Ct("li",Lu,[G(l,{title:"\u900F\u660E\u5EA6"},{content:ut(()=>[I("p",null,[G(a,{value:i.itemObj.opacity,"onUpdate:value":t[1]||(t[1]=d=>i.itemObj.opacity=d),min:0,max:1,step:.05,onChange:i.sliderChanged},null,8,["value","step","onChange"])])]),default:ut(()=>[I("span",Pu,pe(i.itemObj.opacity),1)]),_:1})])):Me("v-if",!0)])])]))]),_:1}))},as.__scopeId="data-v-5912a264",as.__file="src/components/LayerTree/LayerItem.vue";const ct=Is({layerTree:!1,dataPanel:!0,location:!1,drawTool:!1,measureTool:!1,swipeTool:!1,otherTool:!1});Ul.config({top:"100px",duration:1,maxCount:3});const Ta=Ul;function Fu(i,t){var e=t-i,n=Math.random();return i+Math.round(n*e)}function Xe(){let i=[];const t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";for(var e=0;e<36;e++){const s=Math.floor(16*Math.random());i[e]=t.substring(s,s+1)}i[14]="4";const n=3&Number(i[19])|8;return i[19]=t.substring(n,n+1),i[8]=i[13]=i[18]=i[23]="-",i.join("")}function ku(){const i=window.document;var t=document.exitFullscreen||i.mozCancelFullScreen||i.webkitExitFullscreen||i.webkitExitFullscreen;if(t)t.call(document);else if(typeof window.ActiveXObject<"u"){var e=new window.ActiveXObject("WScript.Shell");e!==null&&e.SendKeys("{F11}")}}function Du(i=window.document.documentElement){let t=i;var e=t.requestFullScreen||t.webkitRequestFullScreen||t.mozRequestFullScreen||t.msRequestFullScreen;if(e)e.call(t);else if(typeof window.ActiveXObject<"u"){var n=new window.ActiveXObject("WScript.Shell");n!==null&&n.SendKeys("{F11}")}}function ih(){const i=new Event("resize");window.dispatchEvent(i)}function nh(i,t){return toString.call(i)===`[object ${t}]`}function sh(i){return nh(i,"String")}const Au=i=>i!==null&&nh(i,"Object");function kr(i={},t={}){let e;for(e in t)i[e]=Au(i[e])?kr(i[e],t[e]):i[e]=t[e];return i}var ls=ve({name:"LayerTree",components:{"a-tree":Bc,"a-dropdown":Kl,"a-menu":gs,"a-menu-item":gs.Item,LayerItem:as,Icon:Ge},props:{moreMainContext:{type:Array}},setup(i){const t=gt([]),e=gt([]),n=gt([]);Xt(()=>e,()=>{const l=Nc(e.value),h=o,c=l.filter(d=>!h.includes(d)),u=h.filter(d=>!l.includes(d));c&&c.forEach(d=>{ua(d,!0)}),u&&u.forEach(d=>{ua(d,!1)}),o=[...l]},{immediate:!1,deep:!0}),Xt(()=>F.changed,()=>{r()});const s=Ot(()=>{let l=[...bu];return i.moreMainContext&&(l=l.concat(i.moreMainContext)),l});function r(){setTimeout(()=>a(F.layers),10)}let o=[];const a=l=>{o=[],n.value=[];let h,c=[];const u=l.length;for(let p=0;p<u;p++){const f=l[p];let m,_,y;p<u-1&&(m=l[p+1]),m&&(y=m.group),_=f.group,_?h===_?c[c.length-1].children.push(f):m&&y===_?c.push({id:Xe(),name:_,type:"group",children:[f]}):c.push(f):c.push(f),h=_}n.value=c;const d=n.value.length,g=[];for(let p=0;p<d;p++){const f=n.value[p];if(g.push(f.id),f.children){let m=!0;const _=f.children.length;for(let y=0;y<_;y++){let v=f.children[y];v.visible?o.push(v.id):m=!1}m&&o.push(f.id)}else f.visible&&o.push(f.id)}t.value=g,e.value=o};return Ln(()=>{r()}),{treeDataRef:n,expandedKeys:t,checkedKeys:e,doItemDelete:function(l){const h=[...n.value],c=h.length;for(let u=0;u<c;u++){const d=h[u];if(d.id===l){ca(l);break}let g=!1;if(d.children){const p=d.children.length;for(let f=0;f<p;f++)if(d.children[f].id===l){ca(l),g=!0;break}}if(g)break}r()},orderChangedHandler:function(l,h){ru(l,h)},opacityChangedHandler:function(l,h){su(l,h)},replaceFields:{title:"alias",children:"children",key:"id"},onContextMenuClick:l=>{console.log(`menuKey: ${l}`),au(l)},mainContextMenus:s,hidePanel:function(){ct.layerTree=!1},locationHandler:function(l){(function(h){F.mapEventBus.eventEmit(et.LAYER_LOCATE,h)})(l)}}}});const rh=i=>(qc("data-v-65825d6f"),i=i(),Jc(),i),Ou={class:"treeBox"},Gu=rh(()=>I("div",{class:"treeboxBody"},null,-1)),ju={class:"treeboxHeader"},zu=rh(()=>I("span",null,"\u56FE\u5C42\u7BA1\u7406",-1));ls.render=function(i,t,e,n,s,r){const o=tt("Icon"),a=tt("a-menu-item"),l=tt("a-menu"),h=tt("a-dropdown"),c=tt("layer-item"),u=tt("a-tree");return ot(),Ct("div",Ou,[G(h,{trigger:["contextmenu"]},{overlay:ut(()=>[G(l,{onClick:t[0]||(t[0]=({key:d})=>i.onContextMenuClick(d))},{default:ut(()=>[(ot(!0),Ct(Zl,null,Hl(i.mainContextMenus,d=>(ot(),Ai(a,{key:d.value},{default:ut(()=>[I("span",null,[G(o,{icon:d.icon,width:"18px",height:"18px",color:"#666"},null,8,["icon"]),Fi(" "+pe(d.name),1)])]),_:2},1024))),128))]),_:1})]),default:ut(()=>[Gu]),_:1}),I("div",ju,[zu,G(o,{style:{float:"right",margin:"4px 5px"},icon:"ant-design:close-circle-outlined",onClick:i.hidePanel},null,8,["onClick"])]),G(u,{checkable:"",blockNode:"","show-icon":"","tree-data":i.treeDataRef,expandedKeys:i.expandedKeys,"onUpdate:expandedKeys":t[1]||(t[1]=d=>i.expandedKeys=d),checkedKeys:i.checkedKeys,"onUpdate:checkedKeys":t[2]||(t[2]=d=>i.checkedKeys=d),fieldNames:i.replaceFields},{title:ut(({id:d,name:g,alias:p,opacity:f,type:m,children:_})=>[(ot(),Ai(c,{data:{id:d,name:g,alias:p,opacity:f,type:m,children:_},key:d,onDelete:i.doItemDelete,onOrderChanged:i.orderChangedHandler,onOpacityChanged:i.opacityChangedHandler,onLocation:i.locationHandler},null,8,["data","onDelete","onOrderChanged","onOpacityChanged","onLocation"]))]),_:1},8,["tree-data","expandedKeys","checkedKeys","fieldNames"])])},ls.__scopeId="data-v-65825d6f",ls.__file="src/components/LayerTree/LayerTree.vue";const pn={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class ei{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0&&t.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||pn[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!(!t||!this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!(!this.global_||!t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const Ri=6378137*Math.PI,Bu=[-Ri,-Ri,Ri,Ri],Nu=[-180,-85,180,85],Nn=6378137*Math.log(Math.tan(Math.PI/2));class _i extends ei{constructor(t){super({code:t,units:"m",extent:Bu,global:!0,worldExtent:Nu,getPointResolution:function(e,n){return e/Math.cosh(n[1]/6378137)}})}}const Ia=[new _i("EPSG:3857"),new _i("EPSG:102100"),new _i("EPSG:102113"),new _i("EPSG:900913"),new _i("http://www.opengis.net/def/crs/EPSG/0/3857"),new _i("http://www.opengis.net/gml/srs/epsg.xml#3857")];function Wu(i,t,e){const n=i.length;e=e>1?e:2,t===void 0&&(t=e>2?i.slice():new Array(n));for(let s=0;s<n;s+=e){t[s]=Ri*i[s]/180;let r=6378137*Math.log(Math.tan(Math.PI*(+i[s+1]+90)/360));r>Nn?r=Nn:r<-Nn&&(r=-Nn),t[s+1]=r}return t}function Xu(i,t,e){const n=i.length;e=e>1?e:2,t===void 0&&(t=e>2?i.slice():new Array(n));for(let s=0;s<n;s+=e)t[s]=180*i[s]/Ri,t[s+1]=360*Math.atan(Math.exp(i[s+1]/6378137))/Math.PI-90;return t}const Ra=[-180,-90,180,90],Vu=6378137*Math.PI/180;class Ne extends ei{constructor(t,e){super({code:t,units:"degrees",extent:Ra,axisOrientation:e,global:!0,metersPerUnit:Vu,worldExtent:Ra})}}const Ma=[new Ne("CRS:84"),new Ne("EPSG:4326","neu"),new Ne("urn:ogc:def:crs:OGC:1.3:CRS84"),new Ne("urn:ogc:def:crs:OGC:2:84"),new Ne("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new Ne("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Ne("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Dr={};function Pn(i){for(const t in i)delete i[t]}function mn(i){let t;for(t in i)return!1;return!t}let ki={};function Oi(i,t,e){const n=i.getCode(),s=t.getCode();n in ki||(ki[n]={}),ki[n][s]=e}function oh(i,t){let e;return i in ki&&t in ki[i]&&(e=ki[i][t]),e}var La=0,fs=1,Ar=2,Or=4,Gr=8,jr=16;const Yu={1:"The view center is not defined",2:"The view resolution is not defined",3:"The view rotation is not defined",4:"`image` and `src` cannot be provided at the same time",5:"`imgSize` must be set when `image` is provided",7:"`format` must be set when `url` is set",8:"Unknown `serverType` configured",9:"`url` must be configured or set using `#setUrl()`",10:"The default `geometryFunction` can only handle `Point` geometries",11:"`options.featureTypes` must be an Array",12:"`options.geometryName` must also be provided when `options.bbox` is set",13:"Invalid corner",14:"Invalid color",15:"Tried to get a value for a key that does not exist in the cache",16:"Tried to set a value for a key that is used already",17:"`resolutions` must be sorted in descending order",18:"Either `origin` or `origins` must be configured, never both",19:"Number of `tileSizes` and `resolutions` must be equal",20:"Number of `origins` and `resolutions` must be equal",22:"Either `tileSize` or `tileSizes` must be configured, never both",24:"Invalid extent or geometry provided as `geometry`",25:"Cannot fit empty extent provided as `geometry`",26:"Features must have an id set",27:"Features must have an id set",28:'`renderMode` must be `"hybrid"` or `"vector"`',30:"The passed `feature` was already added to the source",31:"Tried to enqueue an `element` that was already added to the queue",32:"Transformation matrix cannot be inverted",33:"Invalid units",34:"Invalid geometry layout",36:"Unknown SRS type",37:"Unknown geometry type found",38:"`styleMapValue` has an unknown type",39:"Unknown geometry type",40:"Expected `feature` to have a geometry",41:"Expected an `ol/style/Style` or an array of `ol/style/Style.js`",42:"Question unknown, the answer is 42",43:"Expected `layers` to be an array or a `Collection`",47:"Expected `controls` to be an array or an `ol/Collection`",48:"Expected `interactions` to be an array or an `ol/Collection`",49:"Expected `overlays` to be an array or an `ol/Collection`",50:"`options.featureTypes` should be an Array",51:"Either `url` or `tileJSON` options must be provided",52:"Unknown `serverType` configured",53:"Unknown `tierSizeCalculation` configured",55:"The {-y} placeholder requires a tile grid with extent",56:"mapBrowserEvent must originate from a pointer event",57:"At least 2 conditions are required",59:"Invalid command found in the PBF",60:"Missing or invalid `size`",61:"Cannot determine IIIF Image API version from provided image information JSON",62:"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`",64:"Layer opacity must be a number",66:"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has not been enabled. This is done by providing adequate shaders using the `hitVertexShader` and `hitFragmentShader` properties of `WebGLPointsLayerRenderer`",67:"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both",68:"A VectorTile source can only be rendered if it has a projection compatible with the view projection"};class ah extends Error{constructor(t){const e=Yu[t];super(e),this.code=t,this.name="AssertionError",this.message=e}}function B(i,t){if(!i)throw new ah(t)}function zr(i){const t=Ku();for(let e=0,n=i.length;e<n;++e)an(t,i[e]);return t}function mo(i,t,e){return e?(e[0]=i[0]-t,e[1]=i[1]-t,e[2]=i[2]+t,e[3]=i[3]+t,e):[i[0]-t,i[1]-t,i[2]+t,i[3]+t]}function lh(i,t){return t?(t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t):i.slice()}function di(i,t,e){let n,s;return n=t<i[0]?i[0]-t:i[2]<t?t-i[2]:0,s=e<i[1]?i[1]-e:i[3]<e?e-i[3]:0,n*n+s*s}function Rs(i,t){return _o(i,t[0],t[1])}function Ze(i,t){return i[0]<=t[0]&&t[2]<=i[2]&&i[1]<=t[1]&&t[3]<=i[3]}function _o(i,t,e){return i[0]<=t&&t<=i[2]&&i[1]<=e&&e<=i[3]}function Br(i,t){const e=i[0],n=i[1],s=i[2],r=i[3],o=t[0],a=t[1];let l=La;return o<e?l|=jr:o>s&&(l|=Or),a<n?l|=Gr:a>r&&(l|=Ar),l===La&&(l=fs),l}function Ku(){return[1/0,1/0,-1/0,-1/0]}function Kt(i,t,e,n,s){return s?(s[0]=i,s[1]=t,s[2]=e,s[3]=n,s):[i,t,e,n]}function Fn(i){return Kt(1/0,1/0,-1/0,-1/0,i)}function Zu(i,t){const e=i[0],n=i[1];return Kt(e,n,e,n,t)}function hh(i,t,e,n,s){return uh(Fn(s),i,t,e,n)}function _n(i,t){return i[0]==t[0]&&i[2]==t[2]&&i[1]==t[1]&&i[3]==t[3]}function ch(i,t){return t[0]<i[0]&&(i[0]=t[0]),t[2]>i[2]&&(i[2]=t[2]),t[1]<i[1]&&(i[1]=t[1]),t[3]>i[3]&&(i[3]=t[3]),i}function an(i,t){t[0]<i[0]&&(i[0]=t[0]),t[0]>i[2]&&(i[2]=t[0]),t[1]<i[1]&&(i[1]=t[1]),t[1]>i[3]&&(i[3]=t[1])}function uh(i,t,e,n,s){for(;e<n;e+=s)Hu(i,t[e],t[e+1]);return i}function Hu(i,t,e){i[0]=Math.min(i[0],t),i[1]=Math.min(i[1],e),i[2]=Math.max(i[2],t),i[3]=Math.max(i[3],e)}function yo(i,t){let e;return e=t(Ms(i)),e||(e=t(Ls(i)),e||(e=t(Ps(i)),e||(e=t(je(i)),e||!1)))}function Nr(i){let t=0;return vo(i)||(t=U(i)*ie(i)),t}function Ms(i){return[i[0],i[1]]}function Ls(i){return[i[2],i[1]]}function ye(i){return[(i[0]+i[2])/2,(i[1]+i[3])/2]}function Uu(i,t){let e;return t==="bottom-left"?e=Ms(i):t==="bottom-right"?e=Ls(i):t==="top-left"?e=je(i):t==="top-right"?e=Ps(i):B(!1,13),e}function Wr(i,t,e,n,s){const[r,o,a,l,h,c,u,d]=Xr(i,t,e,n);return Kt(Math.min(r,a,h,u),Math.min(o,l,c,d),Math.max(r,a,h,u),Math.max(o,l,c,d),s)}function Xr(i,t,e,n){const s=t*n[0]/2,r=t*n[1]/2,o=Math.cos(e),a=Math.sin(e),l=s*o,h=s*a,c=r*o,u=r*a,d=i[0],g=i[1];return[d-l+u,g-h-c,d-l-u,g-h+c,d+l-u,g+h+c,d+l+u,g+h-c,d-l+u,g-h-c]}function ie(i){return i[3]-i[1]}function ln(i,t,e){const n=e||[1/0,1/0,-1/0,-1/0];return _t(i,t)?(i[0]>t[0]?n[0]=i[0]:n[0]=t[0],i[1]>t[1]?n[1]=i[1]:n[1]=t[1],i[2]<t[2]?n[2]=i[2]:n[2]=t[2],i[3]<t[3]?n[3]=i[3]:n[3]=t[3]):Fn(n),n}function je(i){return[i[0],i[3]]}function Ps(i){return[i[2],i[3]]}function U(i){return i[2]-i[0]}function _t(i,t){return i[0]<=t[2]&&i[2]>=t[0]&&i[1]<=t[3]&&i[3]>=t[1]}function vo(i){return i[2]<i[0]||i[3]<i[1]}function qu(i,t,e,n){let s=[];if(n>1){const a=i[2]-i[0],l=i[3]-i[1];for(let h=0;h<n;++h)s.push(i[0]+a*h/n,i[1],i[2],i[1]+l*h/n,i[2]-a*h/n,i[3],i[0],i[3]-l*h/n)}else s=[i[0],i[1],i[2],i[1],i[2],i[3],i[0],i[3]];t(s,s,2);const r=[],o=[];for(let a=0,l=s.length;a<l;a+=2)r.push(s[a]),o.push(s[a+1]);return function(a,l,h){return Kt(Math.min.apply(null,a),Math.min.apply(null,l),Math.max.apply(null,a),Math.max.apply(null,l),h)}(r,o,e)}function dh(i,t){const e=t.getExtent(),n=ye(i);if(t.canWrapX()&&(n[0]<e[0]||n[0]>=e[2])){const s=U(e),r=Math.floor((n[0]-e[0])/s)*s;i[0]-=r,i[2]-=r}return i}function it(i,t,e){return Math.min(Math.max(i,t),e)}function Ju(i,t,e,n,s,r){const o=s-e,a=r-n;if(o!==0||a!==0){const l=((i-e)*o+(t-n)*a)/(o*o+a*a);l>1?(e=s,n=r):l>0&&(e+=o*l,n+=a*l)}return me(i,t,e,n)}function me(i,t,e,n){const s=e-i,r=n-t;return s*s+r*r}function ii(i){return i*Math.PI/180}function Di(i,t){const e=i%t;return e*t<0?e+t:e}function ge(i,t,e){return i+e*(t-i)}function xo(i,t){const e=Math.pow(10,t);return Math.round(i*e)/e}function Wn(i,t){return Math.floor(xo(i,t))}function Xn(i,t){return Math.ceil(xo(i,t))}function ps(i,t){let e=!0;for(let n=i.length-1;n>=0;--n)if(i[n]!=t[n]){e=!1;break}return e}function Co(i,t){const e=Math.cos(t),n=Math.sin(t),s=i[0]*e-i[1]*n,r=i[1]*e+i[0]*n;return i[0]=s,i[1]=r,i}function gh(i,t){const e=i[0]-t[0],n=i[1]-t[1];return e*e+n*n}function Pa(i,t){return Math.sqrt(gh(i,t))}function er(i,t){return function(e,n,s){return e?n.replace("{x}",e[0].toFixed(s)).replace("{y}",e[1].toFixed(s)):""}(i,"{x}, {y}",t)}function fh(i,t){if(t.canWrapX()){const e=U(t.getExtent()),n=ph(i,t,e);n&&(i[0]-=n*e)}return i}function ph(i,t,e){const n=t.getExtent();let s=0;return t.canWrapX()&&(i[0]<n[0]||i[0]>n[2])&&(e=e||U(n),s=Math.floor((i[0]-n[0])/e)),s}function Vr(i,t,e){e=e||63710088e-1;const n=ii(i[1]),s=ii(t[1]),r=(s-n)/2,o=ii(t[0]-i[0])/2,a=Math.sin(r)*Math.sin(r)+Math.sin(o)*Math.sin(o)*Math.cos(n)*Math.cos(s);return 2*e*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}function ir(i,t){let e=0;for(let n=0,s=i.length;n<s-1;++n)e+=Vr(i[n],i[n+1],t);return e}function mh(i,t){const e=(t=t||{}).radius||63710088e-1,n=t.projection||"EPSG:3857",s=i.getType();s!=="GeometryCollection"&&(i=i.clone().transform(n,"EPSG:4326"));let r,o,a,l,h,c,u=0;switch(s){case"Point":case"MultiPoint":break;case"LineString":case"LinearRing":r=i.getCoordinates(),u=ir(r,e);break;case"MultiLineString":case"Polygon":for(r=i.getCoordinates(),a=0,l=r.length;a<l;++a)u+=ir(r[a],e);break;case"MultiPolygon":for(r=i.getCoordinates(),a=0,l=r.length;a<l;++a)for(o=r[a],h=0,c=o.length;h<c;++h)u+=ir(o[h],e);break;case"GeometryCollection":{const d=i.getGeometries();for(a=0,l=d.length;a<l;++a)u+=mh(d[a],t);break}default:throw new Error("Unsupported geometry type: "+s)}return u}function Vn(i,t){let e=0;const n=i.length;let s=i[n-1][0],r=i[n-1][1];for(let o=0;o<n;o++){const a=i[o][0],l=i[o][1];e+=ii(a-s)*(2+Math.sin(ii(r))+Math.sin(ii(l))),s=a,r=l}return e*t*t/2}function _h(i,t){const e=(t=t||{}).radius||63710088e-1,n=t.projection||"EPSG:3857",s=i.getType();s!=="GeometryCollection"&&(i=i.clone().transform(n,"EPSG:4326"));let r,o,a,l,h,c,u=0;switch(s){case"Point":case"MultiPoint":case"LineString":case"MultiLineString":case"LinearRing":break;case"Polygon":for(r=i.getCoordinates(),u=Math.abs(Vn(r[0],e)),a=1,l=r.length;a<l;++a)u-=Math.abs(Vn(r[a],e));break;case"MultiPolygon":for(r=i.getCoordinates(),a=0,l=r.length;a<l;++a)for(o=r[a],u+=Math.abs(Vn(o[0],e)),h=1,c=o.length;h<c;++h)u-=Math.abs(Vn(o[h],e));break;case"GeometryCollection":{const d=i.getGeometries();for(a=0,l=d.length;a<l;++a)u+=_h(d[a],t);break}default:throw new Error("Unsupported geometry type: "+s)}return u}let Yr=!0;function wo(i,t,e){if(t!==void 0)for(let n=0,s=i.length;n<s;++n)t[n]=i[n];else t=i.slice();return t}function yh(i,t,e){if(t!==void 0&&i!==t){for(let n=0,s=i.length;n<s;++n)t[n]=i[n];i=t}return i}function vh(i){(function(t,e){Dr[t]=e})(i.getCode(),i),Oi(i,i,wo)}function dt(i){return typeof i=="string"?Dr[t=i]||Dr[t.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null:i||null;var t}function Fa(i,t,e,n){let s;const r=(i=dt(i)).getPointResolutionFunc();if(r){if(s=r(t,e),n&&n!==i.getUnits()){const o=i.getMetersPerUnit();o&&(s=s*o/pn[n])}}else{const o=i.getUnits();if(o=="degrees"&&!n||n=="degrees")s=t;else{const a=So(i,dt("EPSG:4326"));if(a===yh&&o!=="degrees")s=t*i.getMetersPerUnit();else{let h=[e[0]-t/2,e[1],e[0]+t/2,e[1],e[0],e[1]-t/2,e[0],e[1]+t/2];h=a(h,h,2),s=(Vr(h.slice(0,2),h.slice(2,4))+Vr(h.slice(4,6),h.slice(6,8)))/2}const l=n?pn[n]:i.getMetersPerUnit();l!==void 0&&(s/=l)}}return s}function Kr(i){(function(t){t.forEach(vh)})(i),i.forEach(function(t){i.forEach(function(e){t!==e&&Oi(t,e,wo)})})}function nr(i,t){return i?typeof i=="string"?dt(i):i:dt(t)}function ka(i){return function(t,e,n){const s=t.length;n=n!==void 0?n:2,e=e!==void 0?e:new Array(s);for(let r=0;r<s;r+=n){const o=i(t.slice(r,r+n)),a=o.length;for(let l=0,h=n;l<h;++l)e[r+l]=l>=a?t[r+l]:o[l]}return e}}function $u(i,t,e,n){const s=dt(i),r=dt(t);Oi(s,r,ka(e)),Oi(r,s,ka(n))}function Ei(i,t){if(i===t)return!0;const e=i.getUnits()===t.getUnits();return(i.getCode()===t.getCode()||So(i,t)===wo)&&e}function So(i,t){let e=oh(i.getCode(),t.getCode());return e||(e=yh),e}function yn(i,t){return So(dt(i),dt(t))}function xh(i,t,e){return yn(t,e)(i,void 0,i.length)}function Zr(i,t){return i}function Nt(i,t){return Yr&&!ps(i,[0,0])&&i[0]>=-180&&i[0]<=180&&i[1]>=-90&&i[1]<=90&&(Yr=!1,console.warn("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),i}function Ch(i,t){return i}function He(i,t){return i}function Da(i,t,e){return function(n){let s,r;if(i.canWrapX()){const o=i.getExtent(),a=U(o);r=ph(n=n.slice(0),i,a),r&&(n[0]=n[0]-r*a),n[0]=it(n[0],o[0],o[2]),n[1]=it(n[1],o[1],o[3]),s=e(n)}else s=e(n);return r&&t.canWrapX()&&(s[0]+=r*U(t.getExtent())),s}}var Aa,Oa,Ga;Kr(Ia),Kr(Ma),Aa=Ia,Oa=Wu,Ga=Xu,Ma.forEach(function(i){Aa.forEach(function(t){Oi(i,t,Oa),Oi(t,i,Ga)})});class Eo{constructor(t,e,n,s){this.minX=t,this.maxX=e,this.minY=n,this.maxY=s}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function yi(i,t,e,n,s){return s!==void 0?(s.minX=i,s.maxX=t,s.minY=e,s.maxY=n,s):new Eo(i,t,e,n)}function ja(i,t,e,n){return n!==void 0?(n[0]=i,n[1]=t,n[2]=e,n):[i,t,e]}function Fs(i,t,e){return i+"/"+t+"/"+e}function wh(i){return Fs(i[0],i[1],i[2])}function Qu(i){return i.split("/").map(Number)}function Sh(i,t,e,n,s){let r;for(t+=n;t<e;t+=n)if(r=s(i.slice(t-n,t),i.slice(t,t+n)),r)return r;return!1}function td(i,t,e,n,s){return!yo(s,function(r){return!Ue(i,t,e,n,r[0],r[1])})}function Ue(i,t,e,n,s,r){let o=0,a=i[e-n],l=i[e-n+1];for(;t<e;t+=n){const h=i[t],c=i[t+1];l<=r?c>r&&(h-a)*(r-l)-(s-a)*(c-l)>0&&o++:c<=r&&(h-a)*(r-l)-(s-a)*(c-l)<0&&o--,a=h,l=c}return o!==0}function bo(i,t,e,n,s,r){if(e.length===0||!Ue(i,t,e[0],n,s,r))return!1;for(let o=1,a=e.length;o<a;++o)if(Ue(i,e[o-1],e[o],n,s,r))return!1;return!0}function ks(i,t,e,n,s){const r=uh([1/0,1/0,-1/0,-1/0],i,t,e,n);return!!_t(s,r)&&(!!Ze(s,r)||r[0]>=s[0]&&r[2]<=s[2]||r[1]>=s[1]&&r[3]<=s[3]||Sh(i,t,e,n,function(o,a){return function(l,h,c){let u=!1;const d=Br(l,h),g=Br(l,c);if(d===fs||g===fs)u=!0;else{const p=l[0],f=l[1],m=l[2],_=l[3],y=h[0],v=h[1],x=c[0],C=c[1],E=(C-v)/(x-y);let S,T;g&Ar&&!(d&Ar)&&(S=x-(C-_)/E,u=S>=p&&S<=m),u||!(g&Or)||d&Or||(T=C-(x-m)*E,u=T>=f&&T<=_),u||!(g&Gr)||d&Gr||(S=x-(C-f)/E,u=S>=p&&S<=m),u||!(g&jr)||d&jr||(T=C-(x-p)*E,u=T>=f&&T<=_)}return u}(s,o,a)}))}function Eh(i,t,e,n,s){return!!ks(i,t,e,n,s)||!!Ue(i,t,e,n,s[0],s[1])||!!Ue(i,t,e,n,s[0],s[3])||!!Ue(i,t,e,n,s[2],s[1])||!!Ue(i,t,e,n,s[2],s[3])}function bh(i,t,e,n,s){if(!Eh(i,t,e[0],n,s))return!1;if(e.length===1)return!0;for(let r=1,o=e.length;r<o;++r)if(td(i,e[r-1],e[r],n,s)&&!ks(i,e[r-1],e[r],n,s))return!1;return!0}function ai(i,t){return i>t?1:i<t?-1:0}function Hr(i,t,e){const n=i.length;if(i[0]<=t)return 0;if(t<=i[n-1])return n-1;{let s;if(e>0){for(s=1;s<n;++s)if(i[s]<t)return s-1}else if(e<0){for(s=1;s<n;++s)if(i[s]<=t)return s}else for(s=1;s<n;++s){if(i[s]==t)return s;if(i[s]<t)return typeof e=="function"?e(t,i[s-1],i[s])>0?s-1:s:i[s-1]-t<t-i[s]?s-1:s}return n-1}}function ed(i,t,e){for(;t<e;){const n=i[t];i[t]=i[e],i[e]=n,++t,--e}}function _e(i,t){const e=Array.isArray(t)?t:[t],n=e.length;for(let s=0;s<n;s++)i[i.length]=e[s]}function gi(i,t){const e=i.length;if(e!==t.length)return!1;for(let n=0;n<e;n++)if(i[n]!==t[n])return!1;return!0}function za(i){return i[0]>0&&i[1]>0}function xt(i,t){return Array.isArray(i)?i:(t===void 0?t=[i,i]:(t[0]=i,t[1]=i),t)}const id=[0,0,0];class To{constructor(t){let e;if(this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,B(function(s,r,o){const a=r||ai;return s.every(function(l,h){if(h===0)return!0;const c=a(s[h-1],l);return!(c>0||o&&c===0)})}(this.resolutions_,function(s,r){return r-s},!0),17),!t.origins)for(let s=0,r=this.resolutions_.length-1;s<r;++s)if(e){if(this.resolutions_[s]/this.resolutions_[s+1]!==e){e=void 0;break}}else e=this.resolutions_[s]/this.resolutions_[s+1];this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,B(this.origins_.length==this.resolutions_.length,20));const n=t.extent;n===void 0||this.origin_||this.origins_||(this.origin_=je(n)),B(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,B(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:256,B(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=n!==void 0?n:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map(function(s,r){const o=new Eo(Math.min(0,s[0]),Math.max(s[0]-1,-1),Math.min(0,s[1]),Math.max(s[1]-1,-1));if(n){const a=this.getTileRangeForExtentAndZ(n,r);o.minX=Math.max(a.minX,o.minX),o.maxX=Math.min(a.maxX,o.maxX),o.minY=Math.max(a.minY,o.minY),o.maxY=Math.min(a.maxY,o.maxY)}return o},this):n&&this.calculateTileRanges_(n)}forEachTileCoord(t,e,n){const s=this.getTileRangeForExtentAndZ(t,e);for(let r=s.minX,o=s.maxX;r<=o;++r)for(let a=s.minY,l=s.maxY;a<=l;++a)n([e,r,a])}forEachTileCoordParentTileRange(t,e,n,s){let r,o,a,l=null,h=t[0]-1;for(this.zoomFactor_===2?(o=t[1],a=t[2]):l=this.getTileCoordExtent(t,s);h>=this.minZoom;){if(this.zoomFactor_===2?(o=Math.floor(o/2),a=Math.floor(a/2),r=yi(o,o,a,a,n)):r=this.getTileRangeForExtentAndZ(l,h,n),e(h,r))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,n){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){const r=2*t[1],o=2*t[2];return yi(r,r+1,o,o+1,e)}const s=this.getTileCoordExtent(t,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(s,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,n){if(e>this.maxZoom||e<this.minZoom)return null;const s=t[0],r=t[1],o=t[2];if(e===s)return yi(r,o,r,o,n);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,e-s),h=Math.floor(r*l),c=Math.floor(o*l);return e<s?yi(h,h,c,c,n):yi(h,Math.floor(l*(r+1))-1,c,Math.floor(l*(o+1))-1,n)}const a=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,e,n)}getTileRangeExtent(t,e,n){const s=this.getOrigin(t),r=this.getResolution(t),o=xt(this.getTileSize(t),this.tmpSize_),a=s[0]+e.minX*o[0]*r,l=s[0]+(e.maxX+1)*o[0]*r;return Kt(a,s[1]+e.minY*o[1]*r,l,s[1]+(e.maxY+1)*o[1]*r,n)}getTileRangeForExtentAndZ(t,e,n){const s=id;this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,s);const r=s[1],o=s[2];return this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,s),yi(r,s[1],o,s[2],n)}getTileCoordCenter(t){const e=this.getOrigin(t[0]),n=this.getResolution(t[0]),s=xt(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*s[0]*n,e[1]-(t[2]+.5)*s[1]*n]}getTileCoordExtent(t,e){const n=this.getOrigin(t[0]),s=this.getResolution(t[0]),r=xt(this.getTileSize(t[0]),this.tmpSize_),o=n[0]+t[1]*r[0]*s,a=n[1]-(t[2]+1)*r[1]*s;return Kt(o,a,o+r[0]*s,a+r[1]*s,e)}getTileCoordForCoordAndResolution(t,e,n){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,n)}getTileCoordForXYAndResolution_(t,e,n,s,r){const o=this.getZForResolution(n),a=n/this.getResolution(o),l=this.getOrigin(o),h=xt(this.getTileSize(o),this.tmpSize_);let c=a*(t-l[0])/n/h[0],u=a*(l[1]-e)/n/h[1];return s?(c=Xn(c,5)-1,u=Xn(u,5)-1):(c=Wn(c,5),u=Wn(u,5)),ja(o,c,u,r)}getTileCoordForXYAndZ_(t,e,n,s,r){let o=this.getOrigin(n);const a=this.getResolution(n),l=xt(this.getTileSize(n),this.tmpSize_);o||(o=this.origin_?this.origin_:[-200375083427893e-7,200375083427893e-7]);let h=(t-o[0])/a/l[0],c=(o[1]-e)/a/l[1];return s?(h=Xn(h,5)-1,c=Xn(c,5)-1):(h=Wn(h,5),c=Wn(c,5)),ja(n,h,c,r)}getTileCoordForCoordAndZ(t,e,n){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,n)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){return it(Hr(this.resolutions_,t,e||0),this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return Eh(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const e=this.resolutions_.length,n=new Array(e);for(let s=this.minZoom;s<e;++s)n[s]=this.getTileRangeForExtentAndZ(t,s);this.fullTileRanges_=n}}var nd=class extends To{constructor(i){super({extent:i.extent,origin:i.origin,origins:i.origins,resolutions:i.resolutions,tileSize:i.tileSize,tileSizes:i.tileSizes,sizes:i.sizes}),this.matrixIds_=i.matrixIds}getMatrixId(i){return this.matrixIds_[i]}getMatrixIds(){return this.matrixIds_}};class Z{static prjMap=new Map;static tileGridMap=new Map;static EPSG4326Extent=[-180,-90,180,90];static EPSG3857Extent=[-2003750834e-2,-2003750834e-2,2003750834e-2,2003750834e-2];static getProjection(t){const e="EPSG:3857";let n;if(t&&t.epsg){if(n=Z.prjMap.get(t.epsg),n)return n;if(n=dt(t.epsg),!n){if(!t.proj4)throw Error("\u7F3A\u5C11Prj4j\u5185\u5BB9\uFF0C\u65E0\u6CD5\u6CE8\u518C\u6295\u5F71\uFF01");ha.defs(t.epsg,t.proj4),function(s){const r=Object.keys(s.defs),o=r.length;let a,l;for(a=0;a<o;++a){const h=r[a];if(!dt(h)){const c=s.defs(h);let u=c.units;u||c.projName!=="longlat"||(u="degrees"),vh(new ei({code:h,axisOrientation:c.axis,metersPerUnit:c.to_meter,units:u}))}}for(a=0;a<o;++a){const h=r[a],c=dt(h);for(l=0;l<o;++l){const u=r[l],d=dt(u);if(!oh(h,u))if(s.defs[h]===s.defs[u])Kr([c,d]);else{const g=s(h,u);$u(c,d,Da(c,d,g.forward),Da(d,c,g.inverse))}}}}(ha),n=new ei({code:t.epsg,extent:t.prjExtent})}n&&Z.prjMap.set(t.epsg,n)}else n=Z.prjMap.get(e),n||(n=new ei({code:e}),Z.prjMap.set(e,n));return n}static toLonLat(t,e){return Z.transformCoordinate(t,e,"EPSG:4326")}static fromLonLat(t,e){return Z.transformCoordinate(t,"EPSG:4326",e)}static fromLonLatCoordinate(t,e){return Z.transformCoordinate(t,"EPSG:4326",e)}static transformCoordinate(t,e,n){return xh(t,e,n)}static getExtentFrom4326(t,e="EPSG:3857"){return Z.getExtentFromTransform(t,"EPSG:4326",e)}static transformExtent(t,e,n="EPSG:3857"){Z.getExtentFromTransform(t,e,n)}static getExtentFromTransform(t,e,n="EPSG:3857"){return qu(t,yn(e,n))}static transformGeometry(t,e,n="EPSG:3857"){return t.transform(e,n)}static createWMTSTileGrid(t){const e=t.rule,n=Z.tileGridMap.get(e);if(n)return n;const s=[],r=[];for(let l in t.resolutions){const h=Number(l);s[h]=l,r[h]=t.resolutions[l]}const o={origin:t.origin,extent:t.extent,resolutions:r,matrixIds:s,tileSize:t.tileSize},a=new nd(o);return Z.tileGridMap.set(e,a),a}static getTDTTileGrid(t=!0){const e=t?"W":"C",n=Z.tileGridMap.get(e);if(n)return n;const s=t?Z.EPSG3857Extent:Z.EPSG4326Extent,r=U(s)/256,o={};for(var a=1;a<22;++a)o[a.toString()]=r/Math.pow(2,a);const l={rule:e,origin:je(s),resolutions:o,tileSize:[256,256]},h=Z.createWMTSTileGrid(l);return h&&Z.tileGridMap.set(e,h),h}}function Ba(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function Th(i,t,e){return t&&Ba(i.prototype,t),e&&Ba(i,e),i}function hs(){return(hs=Object.assign||function(i){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(i[n]=e[n])}return i}).apply(this,arguments)}function Na(i,t){i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.__proto__=t}function Ih(i,t){if(i==null)return{};var e,n,s={},r=Object.keys(i);for(n=0;n<r.length;n++)t.indexOf(e=r[n])>=0||(s[e]=i[e]);return s}function Wa(i){return((t=i)!=null&&typeof t=="object"&&Array.isArray(t)===!1)==1&&Object.prototype.toString.call(i)==="[object Object]";var t}var Rh=Object.prototype,Mh=Rh.toString,sd=Rh.hasOwnProperty,Lh=/^\s*function (\w+)/;function Xa(i){var t,e=(t=i?.type)!==null&&t!==void 0?t:i;if(e){var n=e.toString().match(Lh);return n?n[1]:""}return""}var li=function(i){var t,e;return Wa(i)!==!1&&typeof(t=i.constructor)=="function"&&Wa(e=t.prototype)!==!1&&e.hasOwnProperty("isPrototypeOf")!==!1},rd=function(i){return i},mt=rd,vn=function(i,t){return sd.call(i,t)},od=Number.isInteger||function(i){return typeof i=="number"&&isFinite(i)&&Math.floor(i)===i},Gi=Array.isArray||function(i){return Mh.call(i)==="[object Array]"},ji=function(i){return Mh.call(i)==="[object Function]"},ms=function(i){return li(i)&&vn(i,"_vueTypes_name")},Ph=function(i){return li(i)&&(vn(i,"type")||["_vueTypes_name","validator","default","required"].some(function(t){return vn(i,t)}))};function Io(i,t){return Object.defineProperty(i.bind(t),"__original",{value:i})}function qe(i,t,e){var n;e===void 0&&(e=!1);var s=!0,r="";n=li(i)?i:{type:i};var o=ms(n)?n._vueTypes_name+" - ":"";if(Ph(n)&&n.type!==null){if(n.type===void 0||n.type===!0||!n.required&&t===void 0)return s;Gi(n.type)?(s=n.type.some(function(u){return qe(u,t,!0)===!0}),r=n.type.map(function(u){return Xa(u)}).join(" or ")):s=(r=Xa(n))==="Array"?Gi(t):r==="Object"?li(t):r==="String"||r==="Number"||r==="Boolean"||r==="Function"?function(u){if(u==null)return"";var d=u.constructor.toString().match(Lh);return d?d[1]:""}(t)===r:t instanceof n.type}if(!s){var a=o+'value "'+t+'" should be of type "'+r+'"';return e===!1?(mt(a),!1):a}if(vn(n,"validator")&&ji(n.validator)){var l=mt,h=[];if(mt=function(u){h.push(u)},s=n.validator(t),mt=l,!s){var c=(h.length>1?"* ":"")+h.join(`
* `);return h.length=0,e===!1?(mt(c),s):c}}return s}function bt(i,t){var e=Object.defineProperties(t,{_vueTypes_name:{value:i,writable:!0},isRequired:{get:function(){return this.required=!0,this}},def:{value:function(s){return s!==void 0||this.default?ji(s)||qe(this,s,!0)===!0?(this.default=Gi(s)?function(){return[].concat(s)}:li(s)?function(){return Object.assign({},s)}:s,this):(mt(this._vueTypes_name+' - invalid default value: "'+s+'"'),this):this}}}),n=e.validator;return ji(n)&&(e.validator=Io(n,e)),e}function Qt(i,t){var e=bt(i,t);return Object.defineProperty(e,"validate",{value:function(n){return ji(this.validator)&&mt(this._vueTypes_name+` - calling .validate() will overwrite the current custom validator function. Validator info:
`+JSON.stringify(this)),this.validator=Io(n,this),this}})}function Va(i,t,e){var n,s,r=(n=t,s={},Object.getOwnPropertyNames(n).forEach(function(u){s[u]=Object.getOwnPropertyDescriptor(n,u)}),Object.defineProperties({},s));if(r._vueTypes_name=i,!li(e))return r;var o,a,l=e.validator,h=Ih(e,["validator"]);if(ji(l)){var c=r.validator;c&&(c=(a=(o=c).__original)!==null&&a!==void 0?a:o),r.validator=Io(c?function(u){return c.call(this,u)&&l.call(this,u)}:l,r)}return Object.assign(r,h)}function cs(i){return i.replace(/^(?!\s*$)/gm,"  ")}var Ds=function(){return Qt("boolean",{type:Boolean})},xn=function(){return Qt("string",{type:String})},_s=function(){return Qt("number",{type:Number})},us=function(){return Qt("array",{type:Array})},Fh=function(){return Qt("object",{type:Object})};function Ro(i){if(!Gi(i))throw new TypeError("[VueTypes error]: You must provide an array as argument");for(var t=!1,e=[],n=0;n<i.length;n+=1){var s=i[n];if(Ph(s)){if(ms(s)&&s._vueTypes_name==="oneOf"){e=e.concat(s.type);continue}if(ji(s.validator)&&(t=!0),s.type!==!0&&s.type){e=e.concat(s.type);continue}}e.push(s)}return e=e.filter(function(r,o){return e.indexOf(r)===o}),bt("oneOfType",t?{type:e,validator:function(r){var o=[],a=i.some(function(l){var h=qe(ms(l)&&l._vueTypes_name==="oneOf"?l.type||null:l,r,!0);return typeof h=="string"&&o.push(h),h===!0});return a||mt("oneOfType - provided value does not match any of the "+o.length+` passed-in validators:
`+cs(o.join(`
`))),a}}:{type:e})}var Jt=function(){function i(){}return i.extend=function(t){var e=this;if(Gi(t))return t.forEach(function(u){return e.extend(u)}),this;var n=t.name,s=t.validate,r=s!==void 0&&s,o=t.getter,a=o!==void 0&&o,l=Ih(t,["name","validate","getter"]);if(vn(this,n))throw new TypeError('[VueTypes error]: Type "'+n+'" already defined');var h,c=l.type;return ms(c)?(delete l.type,Object.defineProperty(this,n,a?{get:function(){return Va(n,c,l)}}:{value:function(){var u,d=Va(n,c,l);return d.validator&&(d.validator=(u=d.validator).bind.apply(u,[d].concat([].slice.call(arguments)))),d}})):(h=a?{get:function(){var u=Object.assign({},l);return r?Qt(n,u):bt(n,u)},enumerable:!0}:{value:function(){var u,d,g=Object.assign({},l);return u=r?Qt(n,g):bt(n,g),g.validator&&(u.validator=(d=g.validator).bind.apply(d,[u].concat([].slice.call(arguments)))),u},enumerable:!0},Object.defineProperty(this,n,h))},Th(i,null,[{key:"any",get:function(){return Qt("any",{})}},{key:"func",get:function(){return Qt("function",{type:Function}).def(this.defaults.func)}},{key:"bool",get:function(){return Ds().def(this.defaults.bool)}},{key:"string",get:function(){return xn().def(this.defaults.string)}},{key:"number",get:function(){return _s().def(this.defaults.number)}},{key:"array",get:function(){return us().def(this.defaults.array)}},{key:"object",get:function(){return Fh().def(this.defaults.object)}},{key:"integer",get:function(){return bt("integer",{type:Number,validator:function(t){return od(t)}}).def(this.defaults.integer)}},{key:"symbol",get:function(){return bt("symbol",{validator:function(t){return typeof t=="symbol"}})}}]),i}();Jt.defaults={},Jt.custom=function(i,t){if(t===void 0&&(t="custom validation failed"),typeof i!="function")throw new TypeError("[VueTypes error]: You must provide a function as argument");return bt(i.name||"<<anonymous function>>",{validator:function(e){var n=i(e);return n||mt(this._vueTypes_name+" - "+t),n}})},Jt.oneOf=function(i){if(!Gi(i))throw new TypeError("[VueTypes error]: You must provide an array as argument.");var t='oneOf - value should be one of "'+i.join('", "')+'".',e=i.reduce(function(n,s){if(s!=null){var r=s.constructor;n.indexOf(r)===-1&&n.push(r)}return n},[]);return bt("oneOf",{type:e.length>0?e:void 0,validator:function(n){var s=i.indexOf(n)!==-1;return s||mt(t),s}})},Jt.instanceOf=function(i){return bt("instanceOf",{type:i})},Jt.oneOfType=Ro,Jt.arrayOf=function(i){return bt("arrayOf",{type:Array,validator:function(t){var e,n=t.every(function(s){return(e=qe(i,s,!0))===!0});return n||mt(`arrayOf - value validation error:
`+cs(e)),n}})},Jt.objectOf=function(i){return bt("objectOf",{type:Object,validator:function(t){var e,n=Object.keys(t).every(function(s){return(e=qe(i,t[s],!0))===!0});return n||mt(`objectOf - value validation error:
`+cs(e)),n}})},Jt.shape=function(i){var t=Object.keys(i),e=t.filter(function(s){var r;return!!(!((r=i[s])===null||r===void 0)&&r.required)}),n=bt("shape",{type:Object,validator:function(s){var r=this;if(!li(s))return!1;var o=Object.keys(s);if(e.length>0&&e.some(function(l){return o.indexOf(l)===-1})){var a=e.filter(function(l){return o.indexOf(l)===-1});return mt(a.length===1?'shape - required property "'+a[0]+'" is not defined.':'shape - required properties "'+a.join('", "')+'" are not defined.'),!1}return o.every(function(l){if(t.indexOf(l)===-1)return r._vueTypes_isLoose===!0||(mt('shape - shape definition does not include a "'+l+'" property. Allowed keys: "'+t.join('", "')+'".'),!1);var h=qe(i[l],s[l],!0);return typeof h=="string"&&mt('shape - "'+l+`" property validation error:
 `+cs(h)),h===!0})}});return Object.defineProperty(n,"_vueTypes_isLoose",{writable:!0,value:!1}),Object.defineProperty(n,"loose",{get:function(){return this._vueTypes_isLoose=!0,this}}),n},Jt.utils={validate:function(i,t){return qe(t,i,!0)===!0},toType:function(i,t,e){return e===void 0&&(e=!1),e?Qt(i,t):bt(i,t)}},function(i){function t(){return i.apply(this,arguments)||this}Na(t,i)}(function(i){var t;return i===void 0&&(i={func:function(){},bool:!0,string:"",number:0,array:function(){return[]},object:function(){return{}},integer:0}),(t=function(e){function n(){return e.apply(this,arguments)||this}return Na(n,e),Th(n,null,[{key:"sensibleDefaults",get:function(){return hs({},this.defaults)},set:function(s){this.defaults=s!==!1?hs({},s!==!0?s:i):{}}}]),n}(Jt)).defaults=hs({},i),t}());class Yn{static zoomTo(t,e,n){if(t){const s=t.getView(),r=s.getProjection();let o=e;n&&(o=Z.getExtentFromTransform(e,n,r));const a=s.getResolutionForExtent(o,t.getSize());s.setResolution(a),s.setCenter(ye(o))}}static removeLayer(t,e){return t?.removeLayer(e)}static changeLayerOrder(t,e,n){if(t){const s=t.getLayers(),r=s.removeAt(e);r&&s.insertAt(n,r)}}static zoomToCenter(t,e,n){const s=t.getView();if(e){const r=Z.fromLonLatCoordinate(e,s.getProjection());s.setCenter(r),n!=null&&n>0&&s.setZoom(n)}}}class ad{map;mapEventBus;target;swipeLayerIndex;MapLayers=new Map;constructor(t,e){t&&(this.map=t,this.mapEventBus=Jl,this.initEventListener()),this.target=e}get SwipeLayerIndex(){return this.swipeLayerIndex}initEventListener(){this.mapEventBus.eventOn(et.LAYER_OPACITY_CHANGED,this.layerOpacityHandler.bind(this)),this.mapEventBus.eventOn(et.LAYER_VISIBLE_CHANGED,this.layerVisibleHandler.bind(this)),this.mapEventBus.eventOn(et.LAYER_LOCATE,this.layerLocateHandler.bind(this)),this.mapEventBus.eventOn(et.LAYER_ORDER_CHANGED,this.layerOrderHandler.bind(this)),this.mapEventBus.eventOn(et.LAYER_REMOVED,this.removeLayer.bind(this)),this.mapEventBus.eventOn(et.LAYER_COPY,this.copyLayer.bind(this)),this.mapEventBus.eventOn(et.LAYER_SWIPE_CHANGED,this.changeSwipeLayerID.bind(this))}removeLayer(t){if(t.mapID!=this.target)return;const{id:e}=t.data;if(this.MapLayers.has(e)){const n=this.MapLayers.get(e);n&&(this.map.removeLayer(n),this.MapLayers.delete(e))}}copyLayer(t){if(t.mapID!=this.target)return;const{id:e,newid:n,ids:s}=t.data;if(this.MapLayers.has(e)){const r=this.MapLayers.get(e);if(r){const o={...r};for(let a of this.MapLayers.values())this.map.removeLayer(a);o.set("lyrID",n),this.MapLayers.set(n,o),s.forEach(a=>{const l=this.MapLayers.get(a);this.map.addLayer(l)})}}}changeSwipeLayerID(t){if(t.mapID!=this.target)return;const{id:e,index:n}=t.data;this.MapLayers.has(e)&&(this.swipeLayerIndex=n,console.log(this.swipeLayerIndex,"\u900F\u89C6\u56FE\u5C42\u7D22\u5F15"))}layerVisibleHandler(t){if(t.mapID!=this.target)return;const{id:e,visible:n}=t.data;if(this.MapLayers.has(e)){const s=this.MapLayers.get(e);s&&s.setVisible(n)}}layerOpacityHandler(t){if(t.mapID!=this.target)return;const{id:e,opacity:n}=t.data;if(this.MapLayers.has(e)){const s=this.MapLayers.get(e);s&&s.setOpacity(n)}}layerOrderHandler(t){if(t.mapID===this.target){const{id:e,index:n,newindex:s}=t.data;Yn.changeLayerOrder(this.map,n,s)}}layerLocateHandler(t){const e=this.MapLayers.get(t);if(e){const n=e.getSource()?.getProjection(),s=e.get("bounds");if(s)Yn.zoomTo(this.map,s,"EPSG:4326");else{const r=e.get("center");if(r){let o=e.get("level");const a=[r[0],r[1]];r.length===3&&(o=r[2]),Yn.zoomToCenter(this.map,a,o)}else Yn.zoomTo(this.map,e.getExtent(),n)}}}deleteLayerByIndex(t){const e=this.map.getLayers()[t];if(e){let n;for(let s of this.MapLayers)if(s[1]===e){n=s[0];break}n&&this.MapLayers.delete(n),this.map.removeLayer(e)}}deleteLayer(t){if(t){let e;for(let n of this.MapLayers)if(n[1]===t){e=n[0];break}e&&this.MapLayers.delete(e),this.map.removeLayer(t)}}clearLayers(){this.MapLayers.forEach((t,e)=>{this.map.removeLayer(t)}),this.MapLayers.clear()}newEvtArgs(t,e=null){const n=new po(this.target,"map");return n.data=t,n.target=e,n}registerLayer(t,e){this.MapLayers.set(e.id,t),e&&this.mapEventBus?.eventEmit(et.LAYER_ADDED,this.newEvtArgs(e))}}class ne{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}var zi="propertychange";class Mo{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function Bi(){return!0}function Xi(){return!1}function hi(){}class As extends Mo{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const n=this.listeners_||(this.listeners_={}),s=n[t]||(n[t]=[]);s.includes(e)||s.push(e)}dispatchEvent(t){const e=typeof t=="string",n=e?t:t.type,s=this.listeners_&&this.listeners_[n];if(!s)return;const r=e?new ne(t):t;r.target||(r.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});let l;n in o||(o[n]=0,a[n]=0),++o[n];for(let h=0,c=s.length;h<c;++h)if(l="handleEvent"in s[h]?s[h].handleEvent(r):s[h].call(this,r),l===!1||r.propagationStopped){l=!1;break}if(--o[n]==0){let h=a[n];for(delete a[n];h--;)this.removeEventListener(n,hi);delete o[n]}return l}disposeInternal(){this.listeners_&&Pn(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return!!this.listeners_&&(t?t in this.listeners_:Object.keys(this.listeners_).length>0)}removeEventListener(t,e){const n=this.listeners_&&this.listeners_[t];if(n){const s=n.indexOf(e);s!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(n[s]=hi,++this.pendingRemovals_[t]):(n.splice(s,1),n.length===0&&delete this.listeners_[t]))}}}var lt="change",ld="error",Ur="contextmenu",Cn="click",hd="dblclick",ys="keydown",kh="keypress",cd="load",ud="resize",Ya="touchmove",hn="wheel";function N(i,t,e,n,s){if(n&&n!==i&&(e=e.bind(n)),s){const o=e;e=function(){i.removeEventListener(t,e),o.apply(this,arguments)}}const r={target:i,type:t,listener:e};return i.addEventListener(t,e),r}function vs(i,t,e,n){return N(i,t,e,n,!0)}function $(i){i&&i.target&&(i.target.removeEventListener(i.type,i.listener),Pn(i))}class cn extends As{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(lt)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const n=t.length,s=new Array(n);for(let r=0;r<n;++r)s[r]=N(this,t[r],e);return s}return N(this,t,e)}onceInternal(t,e){let n;if(Array.isArray(t)){const s=t.length;n=new Array(s);for(let r=0;r<s;++r)n[r]=vs(this,t[r],e)}else n=vs(this,t,e);return e.ol_key=n,n}unInternal(t,e){const n=e.ol_key;if(n)Mi(n);else if(Array.isArray(t))for(let s=0,r=t.length;s<r;++s)this.removeEventListener(t[s],e);else this.removeEventListener(t,e)}}function Mi(i){if(Array.isArray(i))for(let t=0,e=i.length;t<e;++t)$(i[t]);else $(i)}function X(){throw new Error("Unimplemented abstract method.")}cn.prototype.on,cn.prototype.once,cn.prototype.un;let dd=0;function Y(i){return i.ol_uid||(i.ol_uid=String(++dd))}class Ka extends ne{constructor(t,e,n){super(t),this.key=e,this.oldValue=n}}class Ut extends cn{constructor(t){super(),this.on,this.once,this.un,Y(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}hasProperties(){return!!this.values_}notify(t,e){let n;n=`change:${t}`,this.hasListener(n)&&this.dispatchEvent(new Ka(n,t,e)),n=zi,this.hasListener(n)&&this.dispatchEvent(new Ka(n,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,n){const s=this.values_||(this.values_={});if(n)s[t]=e;else{const r=s[t];s[t]=e,r!==e&&this.notify(t,r)}}setProperties(t,e){for(const n in t)this.set(n,t[n],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const n=this.values_[t];delete this.values_[t],mn(this.values_)&&(this.values_=null),e||this.notify(t,n)}}}class Ke extends Ut{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new Ke(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const n=this.getStyle();return n&&t.setStyle(n),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&($(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=N(t,lt,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?function(e){if(typeof e=="function")return e;{let n;return Array.isArray(e)?n=e:(B(typeof e.getZIndex=="function",41),n=[e]),function(){return n}}}(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}const Pe=typeof navigator<"u"&&navigator.userAgent!==void 0?navigator.userAgent.toLowerCase():"",gd=Pe.includes("firefox");Pe.includes("safari")&&!Pe.includes("chrom")&&(Pe.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(Pe));const fd=Pe.includes("webkit")&&!Pe.includes("edge"),pd=Pe.includes("macintosh"),Dh=typeof devicePixelRatio<"u"?devicePixelRatio:1,Lo=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,md=typeof Image<"u"&&Image.prototype.decode,Ah=function(){let i=!1;try{const t=Object.defineProperty({},"passive",{get:function(){i=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return i}();new Array(6);function _d(i,t,e,n,s,r,o){return i[0]=t,i[1]=e,i[2]=n,i[3]=s,i[4]=r,i[5]=o,i}function at(i,t){const e=t[0],n=t[1];return t[0]=i[0]*e+i[2]*n+i[4],t[1]=i[1]*e+i[3]*n+i[5],t}function Oe(i,t,e,n,s,r,o,a){const l=Math.sin(r),h=Math.cos(r);return i[0]=n*h,i[1]=s*l,i[2]=-n*l,i[3]=s*h,i[4]=o*n*h-a*n*l+t,i[5]=o*s*l+a*s*h+e,i}function Po(i,t){const e=(n=t)[0]*n[3]-n[1]*n[2];var n;B(e!==0,32);const s=t[0],r=t[1],o=t[2],a=t[3],l=t[4],h=t[5];return i[0]=a/e,i[1]=-r/e,i[2]=-o/e,i[3]=s/e,i[4]=(o*h-a*l)/e,i[5]=-(s*h-r*l)/e,i}let Za;function Oh(i){const t="matrix("+i.join(", ")+")";if(Lo)return t;const e=Za||(Za=document.createElement("div"));return e.style.transform=t,e.style.transform}function Je(i,t,e,n,s,r){r=r||[];let o=0;for(let a=t;a<e;a+=n){const l=i[a],h=i[a+1];r[o++]=s[0]*l+s[2]*h+s[4],r[o++]=s[1]*l+s[3]*h+s[5]}return r&&r.length!=o&&(r.length=o),r}function Fo(i,t,e,n,s,r,o){o=o||[];const a=Math.cos(s),l=Math.sin(s),h=r[0],c=r[1];let u=0;for(let d=t;d<e;d+=n){const g=i[d]-h,p=i[d+1]-c;o[u++]=h+g*a-p*l,o[u++]=c+g*l+p*a;for(let f=d+2;f<d+n;++f)o[u++]=i[f]}return o&&o.length!=u&&(o.length=u),o}function Gh(i,t,e,n,s,r,o){o=o||[];let a=0;for(let l=t;l<e;l+=n){o[a++]=i[l]+s,o[a++]=i[l+1]+r;for(let h=l+2;h<l+n;++h)o[a++]=i[h]}return o&&o.length!=a&&(o.length=a),o}const Ha=[1,0,0,1,0,0];class jh extends Ut{constructor(){super(),this.extent_=[1/0,1/0,-1/0,-1/0],this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=function(t){let e,n,s,r=!1;return function(){const o=Array.prototype.slice.call(arguments);return r&&this===s&&gi(o,n)||(r=!0,s=this,n=o,e=t.apply(this,arguments)),e}}(function(t,e,n){if(!n)return this.getSimplifiedGeometry(e);const s=this.clone();return s.applyTransform(n),s.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return X()}closestPointXY(t,e,n,s){return X()}containsXY(t,e){const n=this.getClosestPoint([t,e]);return n[0]===t&&n[1]===e}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return X()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&Fn(e),this.extentRevision_=this.getRevision()}return function(e,n){return n?(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n):e}(this.extent_,t)}rotate(t,e){X()}scale(t,e,n){X()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return X()}getType(){return X()}applyTransform(t){X()}intersectsExtent(t){return X()}translate(t,e){X()}transform(t,e){const n=dt(t),s=n.getUnits()=="tile-pixels"?function(r,o,a){const l=n.getExtent(),h=n.getWorldExtent(),c=ie(h)/ie(l);return Oe(Ha,h[0],h[3],c,-c,0,0,0),Je(r,0,r.length,a,Ha,o),yn(n,e)(r,o,a)}:yn(n,e);return this.applyTransform(s),this}}class ze extends jh{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates=null}computeExtent(t){return hh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return X()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=xs(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){X()}setLayout(t,e,n){let s;if(t)s=xs(t);else{for(let r=0;r<n;++r){if(e.length===0)return this.layout="XY",void(this.stride=2);e=e[0]}s=e.length,t=function(r){let o;return r==2?o="XY":r==3?o="XYZ":r==4&&(o="XYZM"),o}(s)}this.layout=t,this.stride=s}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(t,e){const n=this.getFlatCoordinates();if(n){const s=this.getStride();Fo(n,0,n.length,s,t,e,n),this.changed()}}scale(t,e,n){e===void 0&&(e=t),n||(n=ye(this.getExtent()));const s=this.getFlatCoordinates();if(s){const r=this.getStride();(function(o,a,l,h,c,u,d,g){g=g||[];const p=d[0],f=d[1];let m=0;for(let _=a;_<l;_+=h){const y=o[_]-p,v=o[_+1]-f;g[m++]=p+c*y,g[m++]=f+u*v;for(let x=_+2;x<_+h;++x)g[m++]=o[x]}g&&g.length!=m&&(g.length=m)})(s,0,s.length,r,t,e,n,s),this.changed()}}translate(t,e){const n=this.getFlatCoordinates();if(n){const s=this.getStride();Gh(n,0,n.length,s,t,e,n),this.changed()}}}function xs(i){let t;return i=="XY"?t=2:i=="XYZ"||i=="XYM"?t=3:i=="XYZM"&&(t=4),t}function Ua(i,t,e,n,s,r,o){const a=i[t],l=i[t+1],h=i[e]-a,c=i[e+1]-l;let u;if(h===0&&c===0)u=t;else{const d=((s-a)*h+(r-l)*c)/(h*h+c*c);if(d>1)u=e;else{if(d>0){for(let g=0;g<n;++g)o[g]=ge(i[t+g],i[e+g],d);return void(o.length=n)}u=t}}for(let d=0;d<n;++d)o[d]=i[u+d];o.length=n}function ko(i,t,e,n,s){let r=i[t],o=i[t+1];for(t+=n;t<e;t+=n){const a=i[t],l=i[t+1],h=me(r,o,a,l);h>s&&(s=h),r=a,o=l}return s}function Do(i,t,e,n,s){for(let r=0,o=e.length;r<o;++r){const a=e[r];s=ko(i,t,a,n,s),t=a}return s}function Ao(i,t,e,n,s,r,o,a,l,h,c){if(t==e)return h;let u,d;if(s===0){if(d=me(o,a,i[t],i[t+1]),d<h){for(u=0;u<n;++u)l[u]=i[t+u];return l.length=n,d}return h}c=c||[NaN,NaN];let g=t+n;for(;g<e;)if(Ua(i,g-n,g,n,o,a,c),d=me(o,a,c[0],c[1]),d<h){for(h=d,u=0;u<n;++u)l[u]=c[u];l.length=n,g+=n}else g+=n*Math.max((Math.sqrt(d)-Math.sqrt(h))/s|0,1);if(r&&(Ua(i,e-n,t,n,o,a,c),d=me(o,a,c[0],c[1]),d<h)){for(h=d,u=0;u<n;++u)l[u]=c[u];l.length=n}return h}function Oo(i,t,e,n,s,r,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,d=e.length;u<d;++u){const g=e[u];h=Ao(i,t,g,n,s,r,o,a,l,h,c),t=g}return h}function zh(i,t,e,n){for(let s=0,r=e.length;s<r;++s)i[t++]=e[s];return t}function Os(i,t,e,n){for(let s=0,r=e.length;s<r;++s){const o=e[s];for(let a=0;a<n;++a)i[t++]=o[a]}return t}function Go(i,t,e,n,s){s=s||[];let r=0;for(let o=0,a=e.length;o<a;++o){const l=Os(i,t,e[o],n);s[r++]=l,t=l}return s.length=r,s}function jo(i,t,e,n,s,r,o){const a=(e-t)/n;if(a<3){for(;t<e;t+=n)r[o++]=i[t],r[o++]=i[t+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const h=[t,e-n];let c=0;for(;h.length>0;){const u=h.pop(),d=h.pop();let g=0;const p=i[d],f=i[d+1],m=i[u],_=i[u+1];for(let y=d+n;y<u;y+=n){const v=Ju(i[y],i[y+1],p,f,m,_);v>g&&(c=y,g=v)}g>s&&(l[(c-t)/n]=1,d+n<c&&h.push(d,c),c+n<u&&h.push(c,u))}for(let u=0;u<a;++u)l[u]&&(r[o++]=i[t+u*n],r[o++]=i[t+u*n+1]);return o}function Ve(i,t){return t*Math.round(i/t)}function yd(i,t,e,n,s,r,o){if(t==e)return o;let a,l,h=Ve(i[t],s),c=Ve(i[t+1],s);t+=n,r[o++]=h,r[o++]=c;do if(a=Ve(i[t],s),l=Ve(i[t+1],s),(t+=n)==e)return r[o++]=a,r[o++]=l,o;while(a==h&&l==c);for(;t<e;){const u=Ve(i[t],s),d=Ve(i[t+1],s);if(t+=n,u==a&&d==l)continue;const g=a-h,p=l-c,f=u-h,m=d-c;g*m==p*f&&(g<0&&f<g||g==f||g>0&&f>g)&&(p<0&&m<p||p==m||p>0&&m>p)?(a=u,l=d):(r[o++]=a,r[o++]=l,h=a,c=l,a=u,l=d)}return r[o++]=a,r[o++]=l,o}function Bh(i,t,e,n,s,r,o,a){for(let l=0,h=e.length;l<h;++l){const c=e[l];o=yd(i,t,c,n,s,r,o),a.push(o),t=c}return o}function Fe(i,t,e,n,s){s=s!==void 0?s:[];let r=0;for(let o=t;o<e;o+=n)s[r++]=i.slice(o,o+n);return s.length=r,s}function wn(i,t,e,n,s){s=s!==void 0?s:[];let r=0;for(let o=0,a=e.length;o<a;++o){const l=e[o];s[r++]=Fe(i,t,l,n,s[r]),t=l}return s.length=r,s}function qr(i,t,e,n,s){s=s!==void 0?s:[];let r=0;for(let o=0,a=e.length;o<a;++o){const l=e[o];s[r++]=l.length===1&&l[0]===t?[]:wn(i,t,l,n,s[r]),t=l[l.length-1]}return s.length=r,s}function Nh(i,t,e,n,s,r,o){let a,l;const h=(e-t)/n;if(h===1)a=t;else if(h===2)a=t,l=s;else if(h!==0){let c=i[t],u=i[t+1],d=0;const g=[0];for(let m=t+n;m<e;m+=n){const _=i[m],y=i[m+1];d+=Math.sqrt((_-c)*(_-c)+(y-u)*(y-u)),g.push(d),c=_,u=y}const p=s*d,f=function(m,_,y){let v,x;y=y||ai;let C=0,E=m.length,S=!1;for(;C<E;)v=C+(E-C>>1),x=+y(m[v],_),x<0?C=v+1:(E=v,S=!x);return S?C:~C}(g,p);f<0?(l=(p-g[-f-2])/(g[-f-1]-g[-f-2]),a=t+(-f-2)*n):a=t+f*n}o=o>1?o:2,r=r||new Array(o);for(let c=0;c<o;++c)r[c]=a===void 0?NaN:l===void 0?i[a+c]:ge(i[a+c],i[a+n+c],l);return r}function Jr(i,t,e,n,s,r){if(e==t)return null;let o;if(s<i[t+n-1])return r?(o=i.slice(t,t+n),o[n-1]=s,o):null;if(i[e-1]<s)return r?(o=i.slice(e-n,e),o[n-1]=s,o):null;if(s==i[t+n-1])return i.slice(t,t+n);let a=t/n,l=e/n;for(;a<l;){const u=a+l>>1;s<i[(u+1)*n-1]?l=u:a=u+1}const h=i[a*n-1];if(s==h)return i.slice((a-1)*n,(a-1)*n+n);const c=(s-h)/(i[(a+1)*n-1]-h);o=[];for(let u=0;u<n-1;++u)o.push(ge(i[(a-1)*n+u],i[a*n+u],c));return o.push(s),o}function Wh(i,t,e,n){let s=i[t],r=i[t+1],o=0;for(let a=t+n;a<e;a+=n){const l=i[a],h=i[a+1];o+=Math.sqrt((l-s)*(l-s)+(h-r)*(h-r)),s=l,r=h}return o}class Vt extends ze{constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,e===void 0||Array.isArray(t[0])?this.setCoordinates(t,e):this.setFlatCoordinates(e,t)}appendCoordinate(t){this.flatCoordinates?_e(this.flatCoordinates,t):this.flatCoordinates=t.slice(),this.changed()}clone(){const t=new Vt(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,s){return s<di(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(ko(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ao(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,n,s))}forEachSegment(t){return Sh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){return this.layout!="XYM"&&this.layout!="XYZM"?null:(e=e!==void 0&&e,Jr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e))}getCoordinates(){return Fe(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return Nh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}getLength(){return Wh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const e=[];return e.length=jo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new Vt(e,"XY")}getType(){return"LineString"}intersectsExtent(t){return ks(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Os(this.flatCoordinates,0,t,this.stride),this.changed()}}function Xh(i,t,e,n){let s=0,r=i[e-n],o=i[e-n+1];for(;t<e;t+=n){const a=i[t],l=i[t+1];s+=o*a-r*l,r=a,o=l}return s/2}function Vh(i,t,e,n){let s=0;for(let r=0,o=e.length;r<o;++r){const a=e[r];s+=Xh(i,t,a,n),t=a}return s}class Sn extends ze{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,e===void 0||Array.isArray(t[0])?this.setCoordinates(t,e):this.setFlatCoordinates(e,t)}clone(){return new Sn(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,n,s){return s<di(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(ko(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ao(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,n,s))}getArea(){return Xh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return Fe(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=jo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new Sn(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Os(this.flatCoordinates,0,t,this.stride),this.changed()}}class En extends ze{constructor(t,e,n){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,e);else if(e!==void 0&&n)this.setFlatCoordinates(e,t),this.ends_=n;else{let s=this.getLayout();const r=t,o=[],a=[];for(let l=0,h=r.length;l<h;++l){const c=r[l];l===0&&(s=c.getLayout()),_e(o,c.getFlatCoordinates()),a.push(o.length)}this.setFlatCoordinates(s,o),this.ends_=a}}appendLineString(t){this.flatCoordinates?_e(this.flatCoordinates,t.getFlatCoordinates().slice()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new En(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,n,s){return s<di(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Do(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Oo(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,n,s))}getCoordinateAtM(t,e,n){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(e=e!==void 0&&e,n=n!==void 0&&n,function(s,r,o,a,l,h,c){if(c)return Jr(s,r,o[o.length-1],a,l,h);let u;if(l<s[a-1])return h?(u=s.slice(0,a),u[a-1]=l,u):null;if(s[s.length-1]<l)return h?(u=s.slice(s.length-a),u[a-1]=l,u):null;for(let d=0,g=o.length;d<g;++d){const p=o[d];if(r!=p){if(l<s[r+a-1])return null;if(l<=s[p-1])return Jr(s,r,p,a,l,!1);r=p}}return null}(this.flatCoordinates,0,this.ends_,this.stride,t,e,n))}getCoordinates(){return wn(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new Vt(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){const t=this.flatCoordinates,e=this.ends_,n=this.layout,s=[];let r=0;for(let o=0,a=e.length;o<a;++o){const l=e[o],h=new Vt(t.slice(r,l),n);s.push(h),r=l}return s}getFlatMidpoints(){const t=[],e=this.flatCoordinates;let n=0;const s=this.ends_,r=this.stride;for(let o=0,a=s.length;o<a;++o){const l=s[o];_e(t,Nh(e,n,l,r,.5)),n=l}return t}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=function(s,r,o,a,l,h,c,u){for(let d=0,g=o.length;d<g;++d){const p=o[d];c=jo(s,r,p,a,l,h,c),u.push(c),r=p}return c}(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,n),new En(e,"XY",n)}getType(){return"MultiLineString"}intersectsExtent(t){return function(e,n,s,r,o){for(let a=0,l=s.length;a<l;++a){if(ks(e,n,s[a],r,o))return!0;n=s[a]}return!1}(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=Go(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}class Ae extends ze{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new Ae(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,s){const r=this.flatCoordinates,o=me(t,e,r[0],r[1]);if(o<s){const a=this.stride;for(let l=0;l<a;++l)n[l]=r[l];return n.length=a,o}return s}getCoordinates(){return this.flatCoordinates?this.flatCoordinates.slice():[]}computeExtent(t){return Zu(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return _o(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=zh(this.flatCoordinates,0,t,this.stride),this.changed()}}class Gs extends ze{constructor(t,e){super(),e&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendPoint(t){this.flatCoordinates?_e(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.changed()}clone(){const t=new Gs(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,s){if(s<di(this.getExtent(),t,e))return s;const r=this.flatCoordinates,o=this.stride;for(let a=0,l=r.length;a<l;a+=o){const h=me(t,e,r[a],r[a+1]);if(h<s){s=h;for(let c=0;c<o;++c)n[c]=r[a+c];n.length=o}}return s}getCoordinates(){return Fe(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){const e=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;return t<0||e<=t?null:new Ae(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){const t=this.flatCoordinates,e=this.layout,n=this.stride,s=[];for(let r=0,o=t.length;r<o;r+=n){const a=new Ae(t.slice(r,r+n),e);s.push(a)}return s}getType(){return"MultiPoint"}intersectsExtent(t){const e=this.flatCoordinates,n=this.stride;for(let s=0,r=e.length;s<r;s+=n)if(_o(t,e[s],e[s+1]))return!0;return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Os(this.flatCoordinates,0,t,this.stride),this.changed()}}function Yh(i,t,e,n,s,r,o){let a,l,h,c,u,d,g;const p=s[r+1],f=[];for(let y=0,v=e.length;y<v;++y){const x=e[y];for(c=i[x-n],d=i[x-n+1],a=t;a<x;a+=n)u=i[a],g=i[a+1],(p<=d&&g<=p||d<=p&&p<=g)&&(h=(p-d)/(g-d)*(u-c)+c,f.push(h)),c=u,d=g}let m=NaN,_=-1/0;for(f.sort(ai),c=f[0],a=1,l=f.length;a<l;++a){u=f[a];const y=Math.abs(u-c);y>_&&(h=(c+u)/2,bo(i,t,e,n,h,p)&&(m=h,_=y)),c=u}return isNaN(m)&&(m=s[r]),o?(o.push(m,p,_),o):[m,p,_]}function vd(i,t,e,n,s){let r=[];for(let o=0,a=e.length;o<a;++o){const l=e[o];r=Yh(i,t,l,n,s,2*o,r),t=l[l.length-1]}return r}function xd(i,t,e,n){for(;t<e-n;){for(let s=0;s<n;++s){const r=i[t+s];i[t+s]=i[e-n+s],i[e-n+s]=r}t+=n,e-=n}}function Kh(i,t,e,n){let s=0,r=i[e-n],o=i[e-n+1];for(;t<e;t+=n){const a=i[t],l=i[t+1];s+=(a-r)*(l+o),r=a,o=l}return s===0?void 0:s>0}function Zh(i,t,e,n,s){s=s!==void 0&&s;for(let r=0,o=e.length;r<o;++r){const a=e[r],l=Kh(i,t,a,n);if(r===0){if(s&&l||!s&&!l)return!1}else if(s&&!l||!s&&l)return!1;t=a}return!0}function $r(i,t,e,n,s){s=s!==void 0&&s;for(let r=0,o=e.length;r<o;++r){const a=e[r],l=Kh(i,t,a,n);(r===0?s&&l||!s&&!l:s&&!l||!s&&l)&&xd(i,t,a,n),t=a}return t}function qa(i,t,e,n,s){for(let r=0,o=e.length;r<o;++r)t=$r(i,t,e[r],n,s);return t}class Zt extends ze{constructor(t,e,n){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,e!==void 0&&n?(this.setFlatCoordinates(e,t),this.ends_=n):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?_e(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new Zt(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,n,s){return s<di(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Do(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Oo(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,n,s))}containsXY(t,e){return bo(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return Vh(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),$r(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,wn(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=ye(this.getExtent());this.flatInteriorPoint_=Yh(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Ae(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new Sn(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,n=this.ends_,s=[];let r=0;for(let o=0,a=n.length;o<a;++o){const l=n[o],h=new Sn(e.slice(r,l),t);s.push(h),r=l}return s}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;Zh(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=$r(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=Bh(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,n),new Zt(e,"XY",n)}getType(){return"Polygon"}intersectsExtent(t){return bh(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=Go(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}function Ja(i){const t=i[0],e=i[1],n=i[2],s=i[3],r=[t,e,t,s,n,s,n,e,t,e];return new Zt(r,"XY",[r.length])}function Cd(i,t,e,n){const s=[];let r=[1/0,1/0,-1/0,-1/0];for(let o=0,a=e.length;o<a;++o){const l=e[o];r=hh(i,t,l[0],n),s.push((r[0]+r[2])/2,(r[1]+r[3])/2),t=l[l.length-1]}return s}class bn extends ze{constructor(t,e,n){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!n&&!Array.isArray(t[0])){let s=this.getLayout();const r=t,o=[],a=[];for(let l=0,h=r.length;l<h;++l){const c=r[l];l===0&&(s=c.getLayout());const u=o.length,d=c.getEnds();for(let g=0,p=d.length;g<p;++g)d[g]+=u;_e(o,c.getFlatCoordinates()),a.push(d)}e=s,t=o,n=a}e!==void 0&&n?(this.setFlatCoordinates(e,t),this.endss_=n):this.setCoordinates(t,e)}appendPolygon(t){let e;if(this.flatCoordinates){const n=this.flatCoordinates.length;_e(this.flatCoordinates,t.getFlatCoordinates()),e=t.getEnds().slice();for(let s=0,r=e.length;s<r;++s)e[s]+=n}else this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();this.endss_.push(e),this.changed()}clone(){const t=this.endss_.length,e=new Array(t);for(let s=0;s<t;++s)e[s]=this.endss_[s].slice();const n=new bn(this.flatCoordinates.slice(),this.layout,e);return n.applyProperties(this),n}closestPointXY(t,e,n,s){return s<di(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(function(r,o,a,l,h){for(let c=0,u=a.length;c<u;++c){const d=a[c];h=Do(r,o,d,l,h),o=d[d.length-1]}return h}(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),function(r,o,a,l,h,c,u,d,g,p,f){f=f||[NaN,NaN];for(let m=0,_=a.length;m<_;++m){const y=a[m];p=Oo(r,o,y,l,h,c,u,d,g,p,f),o=y[y.length-1]}return p}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,n,s))}containsXY(t,e){return function(n,s,r,o,a,l){if(r.length===0)return!1;for(let h=0,c=r.length;h<c;++h){const u=r[h];if(bo(n,s,u,o,a,l))return!0;s=u[u.length-1]}return!1}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)}getArea(){return function(t,e,n,s){let r=0;for(let o=0,a=n.length;o<a;++o){const l=n[o];r+=Vh(t,e,l,s),e=l[l.length-1]}return r}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),qa(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,qr(e,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const t=Cd(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=vd(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new Gs(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;(function(e,n,s,r,o){for(let a=0,l=s.length;a<l;++a){const h=s[a];if(!Zh(e,n,h,r,o))return!1;h.length&&(n=h[h.length-1])}return!0})(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=qa(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=function(s,r,o,a,l,h,c,u){for(let d=0,g=o.length;d<g;++d){const p=o[d],f=[];c=Bh(s,r,p,a,l,h,c,f),u.push(f),r=p[p.length-1]}return c}(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,n),new bn(e,"XY",n)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let e;if(t===0)e=0;else{const r=this.endss_[t-1];e=r[r.length-1]}const n=this.endss_[t].slice(),s=n[n.length-1];if(e!==0)for(let r=0,o=n.length;r<o;++r)n[r]-=e;return new Zt(this.flatCoordinates.slice(e,s),this.layout,n)}getPolygons(){const t=this.layout,e=this.flatCoordinates,n=this.endss_,s=[];let r=0;for(let o=0,a=n.length;o<a;++o){const l=n[o].slice(),h=l[l.length-1];if(r!==0)for(let u=0,d=l.length;u<d;++u)l[u]-=r;const c=new Zt(e.slice(r,h),t,l);s.push(c),r=h}return s}getType(){return"MultiPolygon"}intersectsExtent(t){return function(e,n,s,r,o){for(let a=0,l=s.length;a<l;++a){const h=s[a];if(bh(e,n,h,r,o))return!0;n=h[h.length-1]}return!1}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);const n=function(s,r,o,a,l){l=l||[];let h=0;for(let c=0,u=o.length;c<u;++c){const d=Go(s,r,o[c],a,l[h]);d.length===0&&(d[0]=r),l[h++]=d,r=d[d.length-1]}return l.length=h,l}(this.flatCoordinates,0,t,this.stride,this.endss_);if(n.length===0)this.flatCoordinates.length=0;else{const s=n[n.length-1];this.flatCoordinates.length=s.length===0?0:s[s.length-1]}this.changed()}}class Cs extends jh{constructor(t){super(),this.geometries_=t||null,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach($),this.changeEventsKeys_.length=0}listenGeometriesChange_(){if(this.geometries_)for(let t=0,e=this.geometries_.length;t<e;++t)this.changeEventsKeys_.push(N(this.geometries_[t],lt,this.changed,this))}clone(){const t=new Cs(null);return t.setGeometries(this.geometries_),t.applyProperties(this),t}closestPointXY(t,e,n,s){if(s<di(this.getExtent(),t,e))return s;const r=this.geometries_;for(let o=0,a=r.length;o<a;++o)s=r[o].closestPointXY(t,e,n,s);return s}containsXY(t,e){const n=this.geometries_;for(let s=0,r=n.length;s<r;++s)if(n[s].containsXY(t,e))return!0;return!1}computeExtent(t){Fn(t);const e=this.geometries_;for(let n=0,s=e.length;n<s;++n)ch(t,e[n].getExtent());return t}getGeometries(){return $a(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let t=[];const e=this.geometries_;for(let n=0,s=e.length;n<s;++n)e[n].getType()===this.getType()?t=t.concat(e[n].getGeometriesArrayRecursive()):t.push(e[n]);return t}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=[],n=this.geometries_;let s=!1;for(let r=0,o=n.length;r<o;++r){const a=n[r],l=a.getSimplifiedGeometry(t);e.push(l),l!==a&&(s=!0)}if(s){const r=new Cs(null);return r.setGeometriesArray(e),r}return this.simplifiedGeometryMaxMinSquaredTolerance=t,this}getType(){return"GeometryCollection"}intersectsExtent(t){const e=this.geometries_;for(let n=0,s=e.length;n<s;++n)if(e[n].intersectsExtent(t))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(t,e){const n=this.geometries_;for(let s=0,r=n.length;s<r;++s)n[s].rotate(t,e);this.changed()}scale(t,e,n){n||(n=ye(this.getExtent()));const s=this.geometries_;for(let r=0,o=s.length;r<o;++r)s[r].scale(t,e,n);this.changed()}setGeometries(t){this.setGeometriesArray($a(t))}setGeometriesArray(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}applyTransform(t){const e=this.geometries_;for(let n=0,s=e.length;n<s;++n)e[n].applyTransform(t);this.changed()}translate(t,e){const n=this.geometries_;for(let s=0,r=n.length;s<r;++s)n[s].translate(t,e);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function $a(i){const t=[];for(let e=0,n=i.length;e<n;++e)t.push(i[e].clone());return t}class zo{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null}clone(){const t=this.getColor();return new zo({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){this.color_=t}}var Tt=zo,js=0,wd=1,Yt=2,Bo=3;class zs{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=xt(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new zs({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return X()}getImage(t){return X()}getHitDetectionImage(){return X()}getPixelRatio(t){return 1}getImageState(){return X()}getImageSize(){return X()}getOrigin(){return X()}getSize(){return X()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=xt(t)}listenImageChange(t){X()}load(){X()}unlistenImageChange(t){X()}}const Sd=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,Ed=/^([a-z]*)$|^hsla?\(.*\)$/i;function Hh(i){return typeof i=="string"?i:Uh(i)}const bd=function(){const i={};let t=0;return function(e){let n;if(i.hasOwnProperty(e))n=i[e];else{if(t>=1024){let s=0;for(const r in i)(3&s++)==0&&(delete i[r],--t)}n=function(s){let r,o,a,l,h;if(Ed.exec(s)&&(s=function(c){const u=document.createElement("div");if(u.style.color=c,u.style.color!==""){document.body.appendChild(u);const d=getComputedStyle(u).color;return document.body.removeChild(u),d}return""}(s)),Sd.exec(s)){const c=s.length-1;let u;u=c<=4?1:2;const d=c===4||c===8;r=parseInt(s.substr(1+0*u,u),16),o=parseInt(s.substr(1+1*u,u),16),a=parseInt(s.substr(1+2*u,u),16),l=d?parseInt(s.substr(1+3*u,u),16):255,u==1&&(r=(r<<4)+r,o=(o<<4)+o,a=(a<<4)+a,d&&(l=(l<<4)+l)),h=[r,o,a,l/255]}else s.startsWith("rgba(")?(h=s.slice(5,-1).split(",").map(Number),Qa(h)):s.startsWith("rgb(")?(h=s.slice(4,-1).split(",").map(Number),h.push(1),Qa(h)):B(!1,14);return h}(e),i[e]=n,++t}return n}}();function ws(i){return Array.isArray(i)?i:bd(i)}function Qa(i){return i[0]=it(i[0]+.5|0,0,255),i[1]=it(i[1]+.5|0,0,255),i[2]=it(i[2]+.5|0,0,255),i[3]=it(i[3],0,1),i}function Uh(i){let t=i[0];t!=(0|t)&&(t=t+.5|0);let e=i[1];e!=(0|e)&&(e=e+.5|0);let n=i[2];return n!=(0|n)&&(n=n+.5|0),"rgba("+t+","+e+","+n+","+(i[3]===void 0?1:Math.round(100*i[3])/100)+")"}function wt(i,t,e,n){let s;return s=e&&e.length?e.shift():Lo?new OffscreenCanvas(i||300,t||300):document.createElement("canvas"),i&&(s.width=i),t&&(s.height=t),s.getContext("2d",n)}function qh(i){const t=i.canvas;t.width=1,t.height=1,i.clearRect(0,0,1,1)}function Td(i){let t=i.offsetWidth;const e=getComputedStyle(i);return t+=parseInt(e.marginLeft,10)+parseInt(e.marginRight,10),t}function Id(i){let t=i.offsetHeight;const e=getComputedStyle(i);return t+=parseInt(e.marginTop,10)+parseInt(e.marginBottom,10),t}function tl(i,t){const e=t.parentNode;e&&e.replaceChild(i,t)}function Ss(i){return i&&i.parentNode?i.parentNode.removeChild(i):null}function Jh(i){for(;i.lastChild;)i.removeChild(i.lastChild)}function el(i,t,e){return t+":"+i+":"+(e?Hh(e):"null")}const Es=new class{constructor(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let i=0;for(const t in this.cache_){const e=this.cache_[t];(3&i++)!=0||e.hasListener()||(delete this.cache_[t],--this.cacheSize_)}}}get(i,t,e){const n=el(i,t,e);return n in this.cache_?this.cache_[n]:null}set(i,t,e,n){const s=el(i,t,e);this.cache_[s]=n,++this.cacheSize_}setSize(i){this.maxCacheSize_=i,this.expire()}};function $h(i,t,e){const n=i;let s=!0,r=!1,o=!1;const a=[vs(n,cd,function(){o=!0,r||t()})];return n.src&&md?(r=!0,n.decode().then(function(){s&&t()}).catch(function(l){s&&(o?t():e())})):a.push(vs(n,ld,e)),function(){s=!1,a.forEach($)}}let $i=null;class Rd extends As{constructor(t,e,n,s,r,o){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=s,this.canvas_={},this.color_=o,this.unlisten_=null,this.imageState_=r,this.size_=n,this.src_=e,this.tainted_}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===Yt){$i||($i=wt(1,1)),$i.drawImage(this.image_,0,0);try{$i.getImageData(0,0,1,1),this.tainted_=!1}catch{$i=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(lt)}handleImageError_(){this.imageState_=Bo,this.unlistenImage_(),this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=Yt,this.size_?(this.image_.width=this.size_[0],this.image_.height=this.size_[1]):this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],n=wt(t,e);n.fillRect(0,0,t,e),this.hitDetectionImage_=n.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===js){this.image_||this.initializeImage_(),this.imageState_=wd;try{this.image_.src=this.src_}catch{this.handleImageError_()}this.unlisten_=$h(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==Yt)return;const e=this.image_,n=document.createElement("canvas");n.width=Math.ceil(e.width*t),n.height=Math.ceil(e.height*t);const s=n.getContext("2d");s.scale(t,t),s.drawImage(e,0,0),s.globalCompositeOperation="multiply",s.fillStyle=Hh(this.color_),s.fillRect(0,0,n.width/t,n.height/t),s.globalCompositeOperation="destination-in",s.drawImage(e,0,0),this.canvas_[t]=n}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}class Bs extends zs{constructor(t){const e=(t=t||{}).opacity!==void 0?t.opacity:1,n=t.rotation!==void 0?t.rotation:0,s=t.scale!==void 0?t.scale:1,r=t.rotateWithView!==void 0&&t.rotateWithView;super({opacity:e,rotation:n,scale:s,displacement:t.displacement!==void 0?t.displacement:[0,0],rotateWithView:r,declutterMode:t.declutterMode}),this.anchor_=t.anchor!==void 0?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin!==void 0?t.anchorOrigin:"top-left",this.anchorXUnits_=t.anchorXUnits!==void 0?t.anchorXUnits:"fraction",this.anchorYUnits_=t.anchorYUnits!==void 0?t.anchorYUnits:"fraction",this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null;const o=t.img!==void 0?t.img:null;this.imgSize_=t.imgSize;let a=t.src;B(!(a!==void 0&&o),4),B(!o||o&&this.imgSize_,5),a!==void 0&&a.length!==0||!o||(a=o.src||Y(o)),B(a!==void 0&&a.length>0,6);const l=t.src!==void 0?js:Yt;this.color_=t.color!==void 0?ws(t.color):null,this.iconImage_=function(h,c,u,d,g,p){let f=Es.get(c,d,p);return f||(f=new Rd(h,c,u,d,g,p),Es.set(c,d,p,f)),f}(o,a,this.imgSize_!==void 0?this.imgSize_:null,this.crossOrigin_,l,this.color_),this.offset_=t.offset!==void 0?t.offset:[0,0],this.offsetOrigin_=t.offsetOrigin!==void 0?t.offsetOrigin:"top-left",this.origin_=null,this.size_=t.size!==void 0?t.size:null}clone(){const t=this.getScale();return new Bs({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,imgSize:this.imgSize_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:Array.isArray(t)?t.slice():t,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const s=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!s)return null;t=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(t[0]*=s[0]),this.anchorYUnits_=="fraction"&&(t[1]*=s[1])}if(this.anchorOrigin_!="top-left"){if(!s)return null;t===this.anchor_&&(t=this.anchor_.slice()),this.anchorOrigin_!="top-right"&&this.anchorOrigin_!="bottom-right"||(t[0]=-t[0]+s[0]),this.anchorOrigin_!="bottom-left"&&this.anchorOrigin_!="bottom-right"||(t[1]=-t[1]+s[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),n=this.getScaleArray();return[t[0]-e[0]/n[0],t[1]+e[1]/n[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(this.offsetOrigin_!="top-left"){const e=this.getSize(),n=this.iconImage_.getSize();if(!e||!n)return null;t=t.slice(),this.offsetOrigin_!="top-right"&&this.offsetOrigin_!="bottom-right"||(t[0]=n[0]-e[0]-t[0]),this.offsetOrigin_!="bottom-left"&&this.offsetOrigin_!="bottom-right"||(t[1]=n[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}listenImageChange(t){this.iconImage_.addEventListener(lt,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(lt,t)}}class No{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new No({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}var ee=No;function te(i){return Array.isArray(i)?Uh(i):i}const Md=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),il=["style","variant","weight","size","lineHeight","family"],Qh=function(i){const t=i.match(Md);if(!t)return null;const e={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let n=0,s=il.length;n<s;++n){const r=t[n+1];r!==void 0&&(e[il[n]]=r)}return e.families=e.family.split(/,\s?/),e},Tn=[],$e=[0,0,0,0],ue=new Ut;let Qr,bi=null;const to={},Ld=function(){const i="32px ",t=["monospace","serif"],e=t.length,n="wmytzilWMYTZIL@#/&?$%10\uF013";let s,r;function o(l,h,c){let u=!0;for(let d=0;d<e;++d){const g=t[d];if(r=bs(l+" "+h+" "+i+g,n),c!=g){const p=bs(l+" "+h+" "+i+c+","+g,n);u=u&&p!=r}}return!!u}function a(){let l=!0;const h=ue.getKeys();for(let c=0,u=h.length;c<u;++c){const d=h[c];ue.get(d)<100&&(o.apply(this,d.split(`
`))?(Pn(to),bi=null,Qr=void 0,ue.set(d,100)):(ue.set(d,ue.get(d)+1,!0),l=!1))}l&&(clearInterval(s),s=void 0)}return function(l){const h=Qh(l);if(!h)return;const c=h.families;for(let u=0,d=c.length;u<d;++u){const g=c[u],p=h.style+`
`+h.weight+`
`+g;ue.get(p)===void 0&&(ue.set(p,100,!0),o(h.style,h.weight,g)||(ue.set(p,0,!0),s===void 0&&(s=setInterval(a,32))))}}}(),Pd=function(){let i;return function(t){let e=to[t];if(e==null){if(Lo){const n=Qh(t),s=tc(t,"\u017Dg");e=(isNaN(Number(n.lineHeight))?1.2:Number(n.lineHeight))*(s.actualBoundingBoxAscent+s.actualBoundingBoxDescent)}else i||(i=document.createElement("div"),i.innerHTML="M",i.style.minHeight="0",i.style.maxHeight="none",i.style.height="auto",i.style.padding="0",i.style.border="none",i.style.position="absolute",i.style.display="block",i.style.left="-99999px"),i.style.font=t,document.body.appendChild(i),e=i.offsetHeight,document.body.removeChild(i);to[t]=e}return e}}();function tc(i,t){return bi||(bi=wt(1,1)),i!=Qr&&(bi.font=i,Qr=bi.font),bi.measureText(t)}function bs(i,t){return tc(i,t).width}function nl(i,t,e){if(t in e)return e[t];const n=t.split(`
`).reduce((s,r)=>Math.max(s,bs(i,r)),0);return e[t]=n,n}function Fd(i,t,e,n,s,r,o,a,l,h,c){i.save(),e!==1&&(i.globalAlpha*=e),t&&i.setTransform.apply(i,t),n.contextInstructions?(i.translate(l,h),i.scale(c[0],c[1]),function(u,d){const g=u.contextInstructions;for(let p=0,f=g.length;p<f;p+=2)Array.isArray(g[p+1])?d[g[p]].apply(d,g[p+1]):d[g[p]]=g[p+1]}(n,i)):c[0]<0||c[1]<0?(i.translate(l,h),i.scale(c[0],c[1]),i.drawImage(n,s,r,o,a,0,0,o,a)):i.drawImage(n,s,r,o,a,l,h,o*c[0],a*c[1]),i.restore()}class Ns extends zs{constructor(t){super({opacity:1,rotateWithView:t.rotateWithView!==void 0&&t.rotateWithView,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode}),this.canvas_=void 0,this.hitDetectionCanvas_=null,this.fill_=t.fill!==void 0?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius_=t.radius!==void 0?t.radius:t.radius1,this.radius2_=t.radius2,this.angle_=t.angle!==void 0?t.angle:0,this.stroke_=t.stroke!==void 0?t.stroke:null,this.size_=null,this.renderOptions_=null,this.render()}clone(){const t=this.getScale(),e=new Ns({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_;if(!t)return null;const e=this.getDisplacement(),n=this.getScaleArray();return[t[0]/2-e[0]/n[0],t[1]/2+e[1]/n[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_}getImage(t){let e=this.canvas_[t];if(!e){const n=this.renderOptions_,s=wt(n.size*t,n.size*t);this.draw_(n,s,t),e=s.canvas,this.canvas_[t]=e}return e}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return Yt}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,n){if(e===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return e;let s=this.radius_,r=this.radius2_===void 0?s:this.radius2_;if(s<r){const y=s;s=r,r=y}const o=this.radius2_===void 0?this.points_:2*this.points_,a=2*Math.PI/o,l=r*Math.sin(a),h=s-Math.sqrt(r*r-l*l),c=Math.sqrt(l*l+h*h),u=c/l;if(t==="miter"&&u<=n)return u*e;const d=e/2/u,g=e/2*(h/c),p=Math.sqrt((s+d)*(s+d)+g*g)-s;if(this.radius2_===void 0||t==="bevel")return 2*p;const f=s*Math.sin(a),m=r-Math.sqrt(s*s-f*f),_=Math.sqrt(f*f+m*m)/f;if(_<=n){const y=_*e/2-r-s;return 2*Math.max(p,y)}return 2*p}createRenderOptions(){let t,e="round",n=0,s=null,r=0,o=0;this.stroke_&&(t=this.stroke_.getColor(),t===null&&(t="#000"),t=te(t),o=this.stroke_.getWidth(),o===void 0&&(o=1),s=this.stroke_.getLineDash(),r=this.stroke_.getLineDashOffset(),e=this.stroke_.getLineJoin(),e===void 0&&(e="round"),n=this.stroke_.getMiterLimit(),n===void 0&&(n=10));const a=this.calculateLineJoinSize_(e,o,n),l=Math.max(this.radius_,this.radius2_||0);return{strokeStyle:t,strokeWidth:o,size:Math.ceil(2*l+a),lineDash:s,lineDashOffset:r,lineJoin:e,miterLimit:n}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.canvas_={},this.size_=[t,t]}draw_(t,e,n){if(e.scale(n,n),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let s=this.fill_.getColor();s===null&&(s="#000"),e.fillStyle=te(s),e.fill()}this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){if(this.fill_){let e=this.fill_.getColor(),n=0;if(typeof e=="string"&&(e=ws(e)),e===null?n=1:Array.isArray(e)&&(n=e.length===4?e[3]:1),n===0){const s=wt(t.size,t.size);this.hitDetectionCanvas_=s.canvas,this.drawHitDetectionCanvas_(t,s)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))}createPath_(t){let e=this.points_;const n=this.radius_;if(e===1/0)t.arc(0,0,n,0,2*Math.PI);else{const s=this.radius2_===void 0?n:this.radius2_;this.radius2_!==void 0&&(e*=2);const r=this.angle_-Math.PI/2,o=2*Math.PI/e;for(let a=0;a<e;a++){const l=r+a*o,h=a%2==0?n:s;t.lineTo(h*Math.cos(l),h*Math.sin(l))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle="#000",e.fill(),this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}}class Wo extends Ns{constructor(t){super({points:1/0,fill:(t=t||{radius:5}).fill,radius:t.radius,stroke:t.stroke,scale:t.scale!==void 0?t.scale:1,rotation:t.rotation!==void 0?t.rotation:0,rotateWithView:t.rotateWithView!==void 0&&t.rotateWithView,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new Wo({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius_=t,this.render()}}var ci=Wo;class ke{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=sl,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&typeof t=="object"&&(t=t.clone()),new ke({geometry:t,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){typeof t=="function"?this.geometryFunction_=t:typeof t=="string"?this.geometryFunction_=function(e){return e.get(t)}:t?t!==void 0&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=sl,this.geometry_=t}setZIndex(t){this.zIndex_=t}}let sr=null;function kd(i,t){if(!sr){const e=new Tt({color:"rgba(255,255,255,0.4)"}),n=new ee({color:"#3399CC",width:1.25});sr=[new ke({image:new ci({fill:e,stroke:n,radius:5}),fill:e,stroke:n})]}return sr}function sl(i){return i.getGeometry()}var ui=ke;class Xo{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.scale_=t.scale,this.scaleArray_=xt(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new Tt({color:"#333"}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding}clone(){const t=this.getScale();return new Xo({font:this.getFont(),placement:this.getPlacement(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRotateWithView(t){this.rotateWithView_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=xt(t!==void 0?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}}typeof TextDecoder>"u"||new TextDecoder("utf8");class Ws extends ze{constructor(t,e,n){super(),n!==void 0&&e===void 0?this.setFlatCoordinates(n,t):(e=e||0,this.setCenterAndRadius(t,e,n))}clone(){const t=new Ws(this.flatCoordinates.slice(),void 0,this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,s){const r=this.flatCoordinates,o=t-r[0],a=e-r[1],l=o*o+a*a;if(l<s){if(l===0)for(let h=0;h<this.stride;++h)n[h]=r[h];else{const h=this.getRadius()/Math.sqrt(l);n[0]=r[0]+h*o,n[1]=r[1]+h*a;for(let c=2;c<this.stride;++c)n[c]=r[c]}return n.length=this.stride,l}return s}containsXY(t,e){const n=this.flatCoordinates,s=t-n[0],r=e-n[1];return s*s+r*r<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(t){const e=this.flatCoordinates,n=e[this.stride]-e[0];return Kt(e[0]-n,e[1]-n,e[0]+n,e[1]+n,t)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const t=this.flatCoordinates[this.stride]-this.flatCoordinates[0],e=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return t*t+e*e}getType(){return"Circle"}intersectsExtent(t){if(_t(t,this.getExtent())){const e=this.getCenter();return t[0]<=e[0]&&t[2]>=e[0]||t[1]<=e[1]&&t[3]>=e[1]||yo(t,this.intersectsCoordinate.bind(this))}return!1}setCenter(t){const e=this.stride,n=this.flatCoordinates[e]-this.flatCoordinates[0],s=t.slice();s[e]=s[0]+n;for(let r=1;r<e;++r)s[e+r]=t[r];this.setFlatCoordinates(this.layout,s),this.changed()}setCenterAndRadius(t,e,n){this.setLayout(n,t,0),this.flatCoordinates||(this.flatCoordinates=[]);const s=this.flatCoordinates;let r=zh(s,0,t,this.stride);s[r++]=s[0]+e;for(let o=1,a=this.stride;o<a;++o)s[r++]=s[o];s.length=r,this.changed()}getCoordinates(){return null}setCoordinates(t,e){}setRadius(t){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+t,this.changed()}rotate(t,e){const n=this.getCenter(),s=this.getStride();this.setCenter(Fo(n,0,n.length,s,t,e,n)),this.changed()}translate(t,e){const n=this.getCenter(),s=this.getStride();this.setCenter(Gh(n,0,n.length,s,t,e,n)),this.changed()}}Ws.prototype.transform;var Wt=0,In=1,It=2,Ht=3,At=4;function ec(i){return Math.pow(i,3)}function Vi(i){return 1-ec(1-i)}function Dd(i){return 3*i*i-2*i*i*i}function Ad(i){return i}class ic extends As{constructor(t,e,n){super(),n=n||{},this.tileCoord=t,this.state=e,this.interimTile=null,this.key="",this.transition_=n.transition===void 0?250:n.transition,this.transitionStarts_={},this.interpolate=!!n.interpolate}changed(){this.dispatchEvent(lt)}release(){this.state===Ht&&this.setState(At)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){if(!this.interimTile)return this;let t=this.interimTile;do{if(t.getState()==It)return this.transition_=0,t;t=t.interimTile}while(t);return this}refreshInterimChain(){if(!this.interimTile)return;let t=this.interimTile,e=this;do{if(t.getState()==It){t.interimTile=null;break}t.getState()==In?e=t:t.getState()==Wt?e.interimTile=t.interimTile:e=t,t=e.interimTile}while(t)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==Ht&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}load(){X()}getAlpha(t,e){if(!this.transition_)return 1;let n=this.transitionStarts_[t];if(n){if(n===-1)return 1}else n=e,this.transitionStarts_[t]=n;const s=e-n+1e3/60;return s>=this.transition_?1:ec(s/this.transition_)}inTransition(t){return!!this.transition_&&this.transitionStarts_[t]!==-1}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}}class nc extends class{constructor(t){this.highWaterMark=t!==void 0?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(t,e){const n=this.entries_[t];return B(n!==void 0,15),n===this.newest_||(n===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(n.newer.older=n.older,n.older.newer=n.newer),n.newer=null,n.older=this.newest_,this.newest_.newer=n,this.newest_=n),n.value_}remove(t){const e=this.entries_[t];return B(e!==void 0,15),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}getCount(){return this.count_}getKeys(){const t=new Array(this.count_);let e,n=0;for(e=this.newest_;e;e=e.older)t[n++]=e.key_;return t}getValues(){const t=new Array(this.count_);let e,n=0;for(e=this.newest_;e;e=e.older)t[n++]=e.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){if(this.containsKey(t))return this.entries_[t].value_}pop(){const t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(t,e){B(!(t in this.entries_),16);const n={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=n:this.oldest_=n,this.newest_=n,this.entries_[t]=n,++this.count_}setSize(t){this.highWaterMark=t}}{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(t){for(;this.canExpireCache()&&!(this.peekLast().getKey()in t);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;const t=Qu(this.peekFirstKey())[0];this.forEach(function(e){e.tileCoord[0]!==t&&(this.remove(wh(e.tileCoord)),e.release())}.bind(this))}}var Od="tileloadstart",Gd="tileloadend",jd="tileloaderror";class sc extends Ut{constructor(t){super(),this.projection=dt(t.projection),this.attributions_=rl(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible===void 0||t.attributionsCollapsible,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0&&t.wrapX,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const e=this;this.viewPromise_=new Promise(function(n,s){e.viewResolver=n,e.viewRejector=s})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(){return X()}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=rl(t),this.changed()}setState(t){this.state_=t,this.changed()}}function rl(i){return i?Array.isArray(i)?function(t){return i}:typeof i=="function"?i:function(t){return[i]}:null}function rc(i){let t=i.getDefaultTileGrid();return t||(t=function(e,n,s,r){return function(o,a,l,h){h=h!==void 0?h:"top-left";const c=oc(o,a,l);return new To({extent:o,origin:Uu(o,h),resolutions:c,tileSize:l})}(Vo(e),n,s,r)}(i),i.setDefaultTileGrid(t)),t}function zd(i){const t=i||{},e=t.extent||dt("EPSG:3857").getExtent(),n={extent:e,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:oc(e,t.maxZoom,t.tileSize,t.maxResolution)};return new To(n)}function oc(i,t,e,n){t=t!==void 0?t:42,e=xt(e!==void 0?e:256);const s=ie(i),r=U(i);n=n>0?n:Math.max(r/e[0],s/e[1]);const o=t+1,a=new Array(o);for(let l=0;l<o;++l)a[l]=n/Math.pow(2,l);return a}function Vo(i){let t=(i=dt(i)).getExtent();if(!t){const e=180*pn.degrees/i.getMetersPerUnit();t=Kt(-e,-e,e,e)}return t}class Bd extends sc{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.opaque_=t.opaque!==void 0&&t.opaque,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;const e=[256,256];this.tileGrid&&xt(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),e),this.tileCache=new nc(t.cacheSize||0),this.tmpSize=[0,0],this.key_=t.key||"",this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(t,e){const n=this.getTileCacheForProjection(t);n&&n.expireCache(e)}forEachLoadedTile(t,e,n,s){const r=this.getTileCacheForProjection(t);if(!r)return!1;let o,a,l,h=!0;for(let c=n.minX;c<=n.maxX;++c)for(let u=n.minY;u<=n.maxY;++u)a=Fs(e,c,u),l=!1,r.containsKey(a)&&(o=r.get(a),l=o.getState()===It,l&&(l=s(o)!==!1)),l||(h=!1);return h}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getOpaque(t){return this.opaque_}getResolutions(){return this.tileGrid?this.tileGrid.getResolutions():null}getTile(t,e,n,s,r){return X()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:rc(t)}getTileCacheForProjection(t){const e=this.getProjection();return B(e===null||Ei(e,t),68),this.tileCache}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,n){const s=this.getTileGridForProjection(n),r=this.getTilePixelRatio(e),o=xt(s.getTileSize(t),this.tmpSize);return r==1?o:(a=o,l=r,(h=this.tmpSize)===void 0&&(h=[0,0]),h[0]=a[0]*l+.5|0,h[1]=a[1]*l+.5|0,h);var a,l,h}getTileCoordForTileUrlFunction(t,e){e=e!==void 0?e:this.getProjection();const n=this.getTileGridForProjection(e);return this.getWrapX()&&e.isGlobal()&&(t=function(s,r,o){const a=r[0],l=s.getTileCoordCenter(r),h=Vo(o);if(Rs(h,l))return r;{const c=U(h),u=Math.ceil((h[0]-l[0])/c);return l[0]+=c*u,s.getTileCoordForCoordAndZ(l,a)}}(n,t,e)),function(s,r){const o=s[0],a=s[1],l=s[2];if(r.getMinZoom()>o||o>r.getMaxZoom())return!1;const h=r.getFullTileRange(o);return!h||h.containsXY(a,l)}(t,n)?t:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(t,e){const n=this.getTileCacheForProjection(e);t>n.highWaterMark&&(n.highWaterMark=t)}useTile(t,e,n,s){}}class Nd extends ne{constructor(t,e){super(t),this.tile=e}}function Wd(i,t){const e=/\{z\}/g,n=/\{x\}/g,s=/\{y\}/g,r=/\{-y\}/g;return function(o,a,l){return o?i.replace(e,o[0].toString()).replace(n,o[1].toString()).replace(s,o[2].toString()).replace(r,function(){const h=o[0],c=t.getFullTileRange(h);return B(c,55),(c.getHeight()-o[2]-1).toString()}):void 0}}function eo(i){return i.length===1?i[0]:function(t,e,n){if(t){const s=function(o){return(o[1]<<o[0])+o[2]}(t),r=Di(s,i.length);return i[r](t,e,n)}}}function ac(i){const t=[];let e=/\{([a-z])-([a-z])\}/.exec(i);if(e){const n=e[1].charCodeAt(0),s=e[2].charCodeAt(0);let r;for(r=n;r<=s;++r)t.push(i.replace(e[0],String.fromCharCode(r)));return t}if(e=/\{(\d+)-(\d+)\}/.exec(i),e){const n=parseInt(e[2],10);for(let s=parseInt(e[1],10);s<=n;s++)t.push(i.replace(e[0],s.toString()));return t}return t.push(i),t}class Yo extends Bd{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===Yo.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const e=t.target,n=Y(e),s=e.getState();let r;s==In?(this.tileLoadingKeys_[n]=!0,r=Od):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],r=s==Ht?jd:s==It?Gd:void 0),r!=null&&this.dispatchEvent(new Nd(r,e))}setTileLoadFunction(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),e!==void 0?this.setKey(e):this.changed()}setUrl(t){const e=ac(t);this.urls=e,this.setUrls(e)}setUrls(t){this.urls=t;const e=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(function(n,s){const r=n.length,o=new Array(r);for(let a=0;a<r;++a)o[a]=Wd(n[a],s);return eo(o)}(t,this.tileGrid),e):this.setKey(e)}tileUrlFunction(t,e,n){}useTile(t,e,n){const s=Fs(t,e,n);this.tileCache.containsKey(s)&&this.tileCache.get(s)}}function Xd(i,t,e,n,s,r,o){const a=new XMLHttpRequest;a.open("GET",typeof i=="function"?i(e,n,s):i,!0),t.getType()=="arraybuffer"&&(a.responseType="arraybuffer"),a.withCredentials=!1,a.onload=function(l){if(!a.status||a.status>=200&&a.status<300){const h=t.getType();let c;h=="json"||h=="text"?c=a.responseText:h=="xml"?(c=a.responseXML,c||(c=new DOMParser().parseFromString(a.responseText,"application/xml"))):h=="arraybuffer"&&(c=a.response),c?r(t.readFeatures(c,{extent:e,featureProjection:s}),t.readProjection(c)):o()}else o()},a.onerror=o,a.send()}function ol(i,t){return function(e,n,s,r,o){const a=this;Xd(i,t,e,n,s,function(l,h){a.addFeatures(l),r!==void 0&&r(l)},o||hi)}}var Kn="opacity",rr="visible",al="extent",or="zIndex",ar="maxResolution",lr="minResolution",hr="maxZoom",cr="minZoom",ur="source",ll="map";class lc extends Ut{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;const e=Object.assign({},t);typeof t.properties=="object"&&(delete e.properties,Object.assign(e,t.properties)),e[Kn]=t.opacity!==void 0?t.opacity:1,B(typeof e[Kn]=="number",64),e[rr]=t.visible===void 0||t.visible,e[or]=t.zIndex,e[ar]=t.maxResolution!==void 0?t.maxResolution:1/0,e[lr]=t.minResolution!==void 0?t.minResolution:0,e[cr]=t.minZoom!==void 0?t.minZoom:-1/0,e[hr]=t.maxZoom!==void 0?t.maxZoom:1/0,this.className_=e.className!==void 0?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:t===void 0||t},n=this.getZIndex();return e.opacity=it(Math.round(100*this.getOpacity())/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=n!==void 0||e.managed?n:1/0,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return X()}getLayerStatesArray(t){return X()}getExtent(){return this.get(al)}getMaxResolution(){return this.get(ar)}getMinResolution(){return this.get(lr)}getMinZoom(){return this.get(cr)}getMaxZoom(){return this.get(hr)}getOpacity(){return this.get(Kn)}getSourceState(){return X()}getVisible(){return this.get(rr)}getZIndex(){return this.get(or)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(al,t)}setMaxResolution(t){this.set(ar,t)}setMinResolution(t){this.set(lr,t)}setMaxZoom(t){this.set(hr,t)}setMinZoom(t){this.set(cr,t)}setOpacity(t){B(typeof t=="number",64),this.set(Kn,t)}setVisible(t){this.set(rr,t)}setZIndex(t){this.set(or,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}var Vd="prerender",Yd="postrender",hc="precompose",Kd="postcompose",dr="rendercomplete";class Xs extends lc{constructor(t){const e=Object.assign({},t);delete e.source,super(e),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(ur,this.handleSourcePropertyChange_);const n=t.source?t.source:null;this.setSource(n)}getLayersArray(t){return(t=t||[]).push(this),t}getLayerStatesArray(t){return(t=t||[]).push(this.getLayerState()),t}getSource(){return this.get(ur)||null}getRenderSource(){return this.getSource()}getSourceState(){const t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed()}handleSourcePropertyChange_(){this.sourceChangeKey_&&($(this.sourceChangeKey_),this.sourceChangeKey_=null);const t=this.getSource();t&&(this.sourceChangeKey_=N(t,lt,this.handleSourceChange_,this)),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):new Promise(e=>e([]))}getData(t){return this.renderer_&&this.rendered?this.renderer_.getData(t):null}render(t,e){const n=this.getRenderer();if(n.prepareFrame(t))return this.rendered=!0,n.renderFrame(t,e)}unrender(){this.rendered=!1}setMapInternal(t){t||this.unrender(),this.set(ll,t)}getMapInternal(){return this.get(ll)}setMap(t){this.mapPrecomposeKey_&&($(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&($(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=N(t,hc,function(e){const n=e.frameState.layerStatesArray,s=this.getLayerState(!1);B(!n.some(function(r){return r.layer===s.layer}),67),n.push(s)},this),this.mapRenderKey_=N(this,lt,t.render,t),this.changed())}setSource(t){this.set(ur,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}}function Ko(i,t){if(!i.visible)return!1;const e=t.resolution;if(e<i.minResolution||e>=i.maxResolution)return!1;const n=t.zoom;return n>i.minZoom&&n<=i.maxZoom}function Zd(i,t,e,n,s){cc(i,t,e||0,n||i.length-1,s||Hd)}function cc(i,t,e,n,s){for(;n>e;){if(n-e>600){var r=n-e+1,o=t-e+1,a=Math.log(r),l=.5*Math.exp(2*a/3),h=.5*Math.sqrt(a*l*(r-l)/r)*(o-r/2<0?-1:1);cc(i,t,Math.max(e,Math.floor(t-o*l/r+h)),Math.min(n,Math.floor(t+(r-o)*l/r+h)),s)}var c=i[t],u=e,d=n;for(Qi(i,e,t),s(i[n],c)>0&&Qi(i,e,n);u<d;){for(Qi(i,u,d),u++,d--;s(i[u],c)<0;)u++;for(;s(i[d],c)>0;)d--}s(i[e],c)===0?Qi(i,e,d):Qi(i,++d,n),d<=t&&(e=d+1),t<=d&&(n=d-1)}}function Qi(i,t,e){var n=i[t];i[t]=i[e],i[e]=n}function Hd(i,t){return i<t?-1:i>t?1:0}class uc{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const n=[];if(!Hn(t,e))return n;const s=this.toBBox,r=[];for(;e;){for(let o=0;o<e.children.length;o++){const a=e.children[o],l=e.leaf?s(a):a;Hn(t,l)&&(e.leaf?n.push(a):fr(t,l)?this._all(a,n):r.push(a))}e=r.pop()}return n}collides(t){let e=this.data;if(!Hn(t,e))return!1;const n=[];for(;e;){for(let s=0;s<e.children.length;s++){const r=e.children[s],o=e.leaf?this.toBBox(r):r;if(Hn(t,o)){if(e.leaf||fr(t,o))return!0;n.push(r)}}e=n.pop()}return!1}load(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(let n=0;n<t.length;n++)this.insert(t[n]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const n=this.data;this.data=e,e=n}this._insert(e,this.data.height-e.height-1,!0)}else this.data=e;return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=Ti([]),this}remove(t,e){if(!t)return this;let n=this.data;const s=this.toBBox(t),r=[],o=[];let a,l,h;for(;n||r.length;){if(n||(n=r.pop(),l=r[r.length-1],a=o.pop(),h=!0),n.leaf){const c=Ud(t,n.children,e);if(c!==-1)return n.children.splice(c,1),r.push(n),this._condense(r),this}h||n.leaf||!fr(n,s)?l?(a++,n=l.children[a],h=!1):n=null:(r.push(n),o.push(a),a=0,l=n,n=n.children[0])}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const n=[];for(;t;)t.leaf?e.push(...t.children):n.push(...t.children),t=n.pop();return e}_build(t,e,n,s){const r=n-e+1;let o,a=this._maxEntries;if(r<=a)return o=Ti(t.slice(e,n+1)),vi(o,this.toBBox),o;s||(s=Math.ceil(Math.log(r)/Math.log(a)),a=Math.ceil(r/Math.pow(a,s-1))),o=Ti([]),o.leaf=!1,o.height=s;const l=Math.ceil(r/a),h=l*Math.ceil(Math.sqrt(a));hl(t,e,n,h,this.compareMinX);for(let c=e;c<=n;c+=h){const u=Math.min(c+h-1,n);hl(t,c,u,l,this.compareMinY);for(let d=c;d<=u;d+=l){const g=Math.min(d+l-1,u);o.children.push(this._build(t,d,g,s-1))}}return vi(o,this.toBBox),o}_chooseSubtree(t,e,n,s){for(;s.push(e),!e.leaf&&s.length-1!==n;){let r,o=1/0,a=1/0;for(let l=0;l<e.children.length;l++){const h=e.children[l],c=gr(h),u=$d(t,h)-c;u<a?(a=u,o=c<o?c:o,r=h):u===a&&c<o&&(o=c,r=h)}e=r||e.children[0]}return e}_insert(t,e,n){const s=n?t:this.toBBox(t),r=[],o=this._chooseSubtree(s,this.data,e,r);for(o.children.push(t),sn(o,s);e>=0&&r[e].children.length>this._maxEntries;)this._split(r,e),e--;this._adjustParentBBoxes(s,r,e)}_split(t,e){const n=t[e],s=n.children.length,r=this._minEntries;this._chooseSplitAxis(n,r,s);const o=this._chooseSplitIndex(n,r,s),a=Ti(n.children.splice(o,n.children.length-o));a.height=n.height,a.leaf=n.leaf,vi(n,this.toBBox),vi(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(n,a)}_splitRoot(t,e){this.data=Ti([t,e]),this.data.height=t.height+1,this.data.leaf=!1,vi(this.data,this.toBBox)}_chooseSplitIndex(t,e,n){let s,r=1/0,o=1/0;for(let a=e;a<=n-e;a++){const l=nn(t,0,a,this.toBBox),h=nn(t,a,n,this.toBBox),c=Qd(l,h),u=gr(l)+gr(h);c<r?(r=c,s=a,o=u<o?u:o):c===r&&u<o&&(o=u,s=a)}return s||n-e}_chooseSplitAxis(t,e,n){const s=t.leaf?this.compareMinX:qd,r=t.leaf?this.compareMinY:Jd;this._allDistMargin(t,e,n,s)<this._allDistMargin(t,e,n,r)&&t.children.sort(s)}_allDistMargin(t,e,n,s){t.children.sort(s);const r=this.toBBox,o=nn(t,0,e,r),a=nn(t,n-e,n,r);let l=Zn(o)+Zn(a);for(let h=e;h<n-e;h++){const c=t.children[h];sn(o,t.leaf?r(c):c),l+=Zn(o)}for(let h=n-e-1;h>=e;h--){const c=t.children[h];sn(a,t.leaf?r(c):c),l+=Zn(a)}return l}_adjustParentBBoxes(t,e,n){for(let s=n;s>=0;s--)sn(e[s],t)}_condense(t){for(let e,n=t.length-1;n>=0;n--)t[n].children.length===0?n>0?(e=t[n-1].children,e.splice(e.indexOf(t[n]),1)):this.clear():vi(t[n],this.toBBox)}}function Ud(i,t,e){if(!e)return t.indexOf(i);for(let n=0;n<t.length;n++)if(e(i,t[n]))return n;return-1}function vi(i,t){nn(i,0,i.children.length,t,i)}function nn(i,t,e,n,s){s||(s=Ti(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(let r=t;r<e;r++){const o=i.children[r];sn(s,i.leaf?n(o):o)}return s}function sn(i,t){return i.minX=Math.min(i.minX,t.minX),i.minY=Math.min(i.minY,t.minY),i.maxX=Math.max(i.maxX,t.maxX),i.maxY=Math.max(i.maxY,t.maxY),i}function qd(i,t){return i.minX-t.minX}function Jd(i,t){return i.minY-t.minY}function gr(i){return(i.maxX-i.minX)*(i.maxY-i.minY)}function Zn(i){return i.maxX-i.minX+(i.maxY-i.minY)}function $d(i,t){return(Math.max(t.maxX,i.maxX)-Math.min(t.minX,i.minX))*(Math.max(t.maxY,i.maxY)-Math.min(t.minY,i.minY))}function Qd(i,t){const e=Math.max(i.minX,t.minX),n=Math.max(i.minY,t.minY),s=Math.min(i.maxX,t.maxX),r=Math.min(i.maxY,t.maxY);return Math.max(0,s-e)*Math.max(0,r-n)}function fr(i,t){return i.minX<=t.minX&&i.minY<=t.minY&&t.maxX<=i.maxX&&t.maxY<=i.maxY}function Hn(i,t){return t.minX<=i.maxX&&t.minY<=i.maxY&&t.maxX>=i.minX&&t.maxY>=i.minY}function Ti(i){return{children:i,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function hl(i,t,e,n,s){const r=[t,e];for(;r.length;){if((e=r.pop())-(t=r.pop())<=n)continue;const o=t+Math.ceil((e-t)/n/2)*n;Zd(i,o,t,e,s),r.push(t,o,o,e)}}function cl(i){return new ui({fill:Rn(i,""),stroke:Mn(i,""),text:tg(i),image:eg(i)})}function Rn(i,t){const e=i[t+"fill-color"];if(e)return new Tt({color:e})}function Mn(i,t){const e=i[t+"stroke-width"],n=i[t+"stroke-color"];if(e||n)return new ee({width:e,color:n,lineCap:i[t+"stroke-line-cap"],lineJoin:i[t+"stroke-line-join"],lineDash:i[t+"stroke-line-dash"],lineDashOffset:i[t+"stroke-line-dash-offset"],miterLimit:i[t+"stroke-miter-limit"]})}function tg(i){const t=i["text-value"];if(t)return new Xo({text:t,font:i["text-font"],maxAngle:i["text-max-angle"],offsetX:i["text-offset-x"],offsetY:i["text-offset-y"],overflow:i["text-overflow"],placement:i["text-placement"],scale:i["text-scale"],rotateWithView:i["text-rotate-with-view"],rotation:i["text-rotation"],textAlign:i["text-align"],justify:i["text-justify"],textBaseline:i["text-baseline"],padding:i["text-padding"],fill:Rn(i,"text-"),backgroundFill:Rn(i,"text-background-"),stroke:Mn(i,"text-"),backgroundStroke:Mn(i,"text-background-")})}function eg(i){const t=i["icon-src"],e=i["icon-img"];if(t||e)return new Bs({src:t,img:e,imgSize:i["icon-img-size"],anchor:i["icon-anchor"],anchorOrigin:i["icon-anchor-origin"],anchorXUnits:i["icon-anchor-x-units"],anchorYUnits:i["icon-anchor-y-units"],color:i["icon-color"],crossOrigin:i["icon-cross-origin"],offset:i["icon-offset"],displacement:i["icon-displacement"],opacity:i["icon-opacity"],scale:i["icon-scale"],rotation:i["icon-rotation"],rotateWithView:i["icon-rotate-with-view"],size:i["icon-size"],declutterMode:i["icon-declutter-mode"]});const n=i["shape-points"];if(n){const r="shape-";return new Ns({points:n,fill:Rn(i,r),stroke:Mn(i,r),radius:i["shape-radius"],radius1:i["shape-radius1"],radius2:i["shape-radius2"],angle:i["shape-angle"],displacement:i["shape-displacement"],rotation:i["shape-rotation"],rotateWithView:i["shape-rotate-with-view"],scale:i["shape-scale"],declutterMode:i["shape-declutter-mode"]})}const s=i["circle-radius"];if(s){const r="circle-";return new ci({radius:s,fill:Rn(i,r),stroke:Mn(i,r),displacement:i["circle-displacement"],scale:i["circle-scale"],rotation:i["circle-rotation"],rotateWithView:i["circle-rotate-with-view"],declutterMode:i["circle-declutter-mode"]})}}const ul="renderOrder";class ig extends Xs{constructor(t){t=t||{};const e=Object.assign({},t);delete e.style,delete e.renderBuffer,delete e.updateWhileAnimating,delete e.updateWhileInteracting,super(e),this.declutter_=t.declutter!==void 0&&t.declutter,this.renderBuffer_=t.renderBuffer!==void 0?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=t.updateWhileAnimating!==void 0&&t.updateWhileAnimating,this.updateWhileInteracting_=t.updateWhileInteracting!==void 0&&t.updateWhileInteracting}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(ul)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t){t.declutterTree||(t.declutterTree=new uc(9)),this.getRenderer().renderDeclutter(t)}setRenderOrder(t){this.set(ul,t)}setStyle(t){let e;if(t===void 0)e=kd;else if(t===null)e=null;else if(typeof t=="function")e=t;else if(t instanceof ui)e=t;else if(Array.isArray(t)){const n=t.length,s=new Array(n);for(let r=0;r<n;++r){const o=t[r];s[r]=o instanceof ui?o:cl(o)}e=s}else e=cl(t);this.style_=e,this.styleFunction_=t===null?void 0:function(n){let s;if(typeof n=="function")s=n;else{let r;Array.isArray(n)?r=n:(B(typeof n.getZIndex=="function",41),r=[n]),s=function(){return r}}return s}(this.style_),this.changed()}}const ds=0,dc=1,gc=2,fc=3,Bt=4,io=5,Ye=6,no=7,pc=8,Zo=9,un=10,ni=11,mc=12,Un=[pc],De=[mc],Qe=[dc],dl=[fc];class _c{drawCustom(t,e,n,s){}drawGeometry(t){}setStyle(t){}drawCircle(t,e){}drawFeature(t,e){}drawGeometryCollection(t,e){}drawLineString(t,e){}drawMultiLineString(t,e){}drawMultiPoint(t,e){}drawMultiPolygon(t,e){}drawPoint(t,e){}drawPolygon(t,e){}drawText(t,e){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}}class rn extends _c{constructor(t,e,n,s){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=s,this.maxLineWidth=0,this.resolution=n,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const e=this.pixelRatio;return e==1?t:t.map(function(n){return n*e})}appendFlatPointCoordinates(t,e){const n=this.getBufferedMaxExtent(),s=this.tmpCoordinate_,r=this.coordinates;let o=r.length;for(let a=0,l=t.length;a<l;a+=e)s[0]=t[a],s[1]=t[a+1],Rs(n,s)&&(r[o++]=s[0],r[o++]=s[1]);return o}appendFlatLineCoordinates(t,e,n,s,r,o){const a=this.coordinates;let l=a.length;const h=this.getBufferedMaxExtent();o&&(e+=s);let c=t[e],u=t[e+1];const d=this.tmpCoordinate_;let g,p,f,m=!0;for(g=e+s;g<n;g+=s)d[0]=t[g],d[1]=t[g+1],f=Br(h,d),f!==p?(m&&(a[l++]=c,a[l++]=u,m=!1),a[l++]=d[0],a[l++]=d[1]):f===fs?(a[l++]=d[0],a[l++]=d[1],m=!1):m=!0,c=d[0],u=d[1],p=f;return(r&&m||g===e+s)&&(a[l++]=c,a[l++]=u),l}drawCustomCoordinates_(t,e,n,s,r){for(let o=0,a=n.length;o<a;++o){const l=n[o],h=this.appendFlatLineCoordinates(t,e,l,s,!1,!1);r.push(h),e=l}return e}drawCustom(t,e,n,s){this.beginGeometry(t,e);const r=t.getType(),o=t.getStride(),a=this.coordinates.length;let l,h,c,u,d;switch(r){case"MultiPolygon":l=t.getOrientedFlatCoordinates(),u=[];const g=t.getEndss();d=0;for(let p=0,f=g.length;p<f;++p){const m=[];d=this.drawCustomCoordinates_(l,d,g[p],o,m),u.push(m)}this.instructions.push([Bt,a,u,t,n,qr]),this.hitDetectionInstructions.push([Bt,a,u,t,s||n,qr]);break;case"Polygon":case"MultiLineString":c=[],l=r=="Polygon"?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),d=this.drawCustomCoordinates_(l,0,t.getEnds(),o,c),this.instructions.push([Bt,a,c,t,n,wn]),this.hitDetectionInstructions.push([Bt,a,c,t,s||n,wn]);break;case"LineString":case"Circle":l=t.getFlatCoordinates(),h=this.appendFlatLineCoordinates(l,0,l.length,o,!1,!1),this.instructions.push([Bt,a,h,t,n,Fe]),this.hitDetectionInstructions.push([Bt,a,h,t,s||n,Fe]);break;case"MultiPoint":l=t.getFlatCoordinates(),h=this.appendFlatPointCoordinates(l,o),h>a&&(this.instructions.push([Bt,a,h,t,n,Fe]),this.hitDetectionInstructions.push([Bt,a,h,t,s||n,Fe]));break;case"Point":l=t.getFlatCoordinates(),this.coordinates.push(l[0],l[1]),h=this.coordinates.length,this.instructions.push([Bt,a,h,t,n]),this.hitDetectionInstructions.push([Bt,a,h,t,s||n])}this.endGeometry(e)}beginGeometry(t,e){this.beginGeometryInstruction1_=[ds,e,0,t],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[ds,e,0,t],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;let e;t.reverse();const n=t.length;let s,r,o=-1;for(e=0;e<n;++e)s=t[e],r=s[0],r==no?o=e:r==ds&&(s[2]=e,ed(this.hitDetectionInstructions,o,e),o=-1)}setFillStrokeStyle(t,e){const n=this.state;if(t){const s=t.getColor();n.fillStyle=te(s||"#000")}else n.fillStyle=void 0;if(e){const s=e.getColor();n.strokeStyle=te(s||"#000");const r=e.getLineCap();n.lineCap=r!==void 0?r:"round";const o=e.getLineDash();n.lineDash=o?o.slice():Tn;const a=e.getLineDashOffset();n.lineDashOffset=a||0;const l=e.getLineJoin();n.lineJoin=l!==void 0?l:"round";const h=e.getWidth();n.lineWidth=h!==void 0?h:1;const c=e.getMiterLimit();n.miterLimit=c!==void 0?c:10,n.lineWidth>this.maxLineWidth&&(this.maxLineWidth=n.lineWidth,this.bufferedMaxExtent_=null)}else n.strokeStyle=void 0,n.lineCap=void 0,n.lineDash=null,n.lineDashOffset=void 0,n.lineJoin=void 0,n.lineWidth=void 0,n.miterLimit=void 0}createFill(t){const e=t.fillStyle,n=[un,e];return typeof e!="string"&&n.push(!0),n}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[ni,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){const n=t.fillStyle;typeof n=="string"&&t.currentFillStyle==n||(n!==void 0&&this.instructions.push(e.call(this,t)),t.currentFillStyle=n)}updateStrokeStyle(t,e){const n=t.strokeStyle,s=t.lineCap,r=t.lineDash,o=t.lineDashOffset,a=t.lineJoin,l=t.lineWidth,h=t.miterLimit;(t.currentStrokeStyle!=n||t.currentLineCap!=s||r!=t.currentLineDash&&!gi(t.currentLineDash,r)||t.currentLineDashOffset!=o||t.currentLineJoin!=a||t.currentLineWidth!=l||t.currentMiterLimit!=h)&&(n!==void 0&&e.call(this,t),t.currentStrokeStyle=n,t.currentLineCap=s,t.currentLineDash=r,t.currentLineDashOffset=o,t.currentLineJoin=a,t.currentLineWidth=l,t.currentMiterLimit=h)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const e=[no,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=lh(this.maxExtent),this.maxLineWidth>0)){const t=this.resolution*(this.maxLineWidth+1)/2;mo(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class gl extends rn{constructor(t,e,n,s){super(t,e,n,s)}drawFlatCoordinatess_(t,e,n,s){const r=this.state,o=r.fillStyle!==void 0,a=r.strokeStyle!==void 0,l=n.length;this.instructions.push(Qe),this.hitDetectionInstructions.push(Qe);for(let h=0;h<l;++h){const c=n[h],u=this.coordinates.length,d=this.appendFlatLineCoordinates(t,e,c,s,!0,!a),g=[Zo,u,d];this.instructions.push(g),this.hitDetectionInstructions.push(g),a&&(this.instructions.push(dl),this.hitDetectionInstructions.push(dl)),e=c}return o&&(this.instructions.push(Un),this.hitDetectionInstructions.push(Un)),a&&(this.instructions.push(De),this.hitDetectionInstructions.push(De)),e}drawCircle(t,e){const n=this.state,s=n.fillStyle,r=n.strokeStyle;if(s===void 0&&r===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([un,"#000"]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([ni,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset]);const o=t.getFlatCoordinates(),a=t.getStride(),l=this.coordinates.length;this.appendFlatLineCoordinates(o,0,o.length,a,!1,!1);const h=[gc,l];this.instructions.push(Qe,h),this.hitDetectionInstructions.push(Qe,h),n.fillStyle!==void 0&&(this.instructions.push(Un),this.hitDetectionInstructions.push(Un)),n.strokeStyle!==void 0&&(this.instructions.push(De),this.hitDetectionInstructions.push(De)),this.endGeometry(e)}drawPolygon(t,e){const n=this.state,s=n.fillStyle,r=n.strokeStyle;if(s===void 0&&r===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([un,"#000"]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([ni,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset]);const o=t.getEnds(),a=t.getOrientedFlatCoordinates(),l=t.getStride();this.drawFlatCoordinatess_(a,0,o,l),this.endGeometry(e)}drawMultiPolygon(t,e){const n=this.state,s=n.fillStyle,r=n.strokeStyle;if(s===void 0&&r===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([un,"#000"]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([ni,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset]);const o=t.getEndss(),a=t.getOrientedFlatCoordinates(),l=t.getStride();let h=0;for(let c=0,u=o.length;c<u;++c)h=this.drawFlatCoordinatess_(a,h,o[c],l);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(t!==0){const e=this.coordinates;for(let n=0,s=e.length;n<s;++n)e[n]=Ve(e[n],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;t.fillStyle!==void 0&&this.updateFillStyle(t,this.createFill),t.strokeStyle!==void 0&&this.updateStrokeStyle(t,this.applyStroke)}}function ng(i,t,e,n,s){let r,o,a,l,h,c,u,d,g,p,f=e,m=e,_=0,y=0,v=e;for(o=e;o<n;o+=s){const x=t[o],C=t[o+1];h!==void 0&&(g=x-h,p=C-c,l=Math.sqrt(g*g+p*p),u!==void 0&&(y+=a,r=Math.acos((u*g+d*p)/(a*l)),r>i&&(y>_&&(_=y,f=v,m=o),y=0,v=o-s)),a=l,u=g,d=p),h=x,c=C}return y+=l,y>_?[v,o]:[f,m]}const dn={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},sg={Circle:gl,Default:rn,Image:class extends rn{constructor(i,t,e,n){super(i,t,e,n),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(i,t){if(!this.image_)return;this.beginGeometry(i,t);const e=i.getFlatCoordinates(),n=i.getStride(),s=this.coordinates.length,r=this.appendFlatPointCoordinates(e,n);this.instructions.push([Ye,s,r,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Ye,s,r,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}drawMultiPoint(i,t){if(!this.image_)return;this.beginGeometry(i,t);const e=i.getFlatCoordinates(),n=i.getStride(),s=this.coordinates.length,r=this.appendFlatPointCoordinates(e,n);this.instructions.push([Ye,s,r,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Ye,s,r,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(i,t){const e=i.getAnchor(),n=i.getSize(),s=i.getOrigin();this.imagePixelRatio_=i.getPixelRatio(this.pixelRatio),this.anchorX_=e[0],this.anchorY_=e[1],this.hitDetectionImage_=i.getHitDetectionImage(),this.image_=i.getImage(this.pixelRatio),this.height_=n[1],this.opacity_=i.getOpacity(),this.originX_=s[0],this.originY_=s[1],this.rotateWithView_=i.getRotateWithView(),this.rotation_=i.getRotation(),this.scale_=i.getScaleArray(),this.width_=n[0],this.declutterMode_=i.getDeclutterMode(),this.declutterImageWithText_=t}},LineString:class extends rn{constructor(i,t,e,n){super(i,t,e,n)}drawFlatCoordinates_(i,t,e,n){const s=this.coordinates.length,r=this.appendFlatLineCoordinates(i,t,e,n,!1,!1),o=[Zo,s,r];return this.instructions.push(o),this.hitDetectionInstructions.push(o),e}drawLineString(i,t){const e=this.state,n=e.strokeStyle,s=e.lineWidth;if(n===void 0||s===void 0)return;this.updateStrokeStyle(e,this.applyStroke),this.beginGeometry(i,t),this.hitDetectionInstructions.push([ni,e.strokeStyle,e.lineWidth,e.lineCap,e.lineJoin,e.miterLimit,Tn,0],Qe);const r=i.getFlatCoordinates(),o=i.getStride();this.drawFlatCoordinates_(r,0,r.length,o),this.hitDetectionInstructions.push(De),this.endGeometry(t)}drawMultiLineString(i,t){const e=this.state,n=e.strokeStyle,s=e.lineWidth;if(n===void 0||s===void 0)return;this.updateStrokeStyle(e,this.applyStroke),this.beginGeometry(i,t),this.hitDetectionInstructions.push([ni,e.strokeStyle,e.lineWidth,e.lineCap,e.lineJoin,e.miterLimit,e.lineDash,e.lineDashOffset],Qe);const r=i.getEnds(),o=i.getFlatCoordinates(),a=i.getStride();let l=0;for(let h=0,c=r.length;h<c;++h)l=this.drawFlatCoordinates_(o,l,r[h],a);this.hitDetectionInstructions.push(De),this.endGeometry(t)}finish(){const i=this.state;return i.lastStroke!=null&&i.lastStroke!=this.coordinates.length&&this.instructions.push(De),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(i){i.lastStroke!=null&&i.lastStroke!=this.coordinates.length&&(this.instructions.push(De),i.lastStroke=this.coordinates.length),i.lastStroke=0,super.applyStroke(i),this.instructions.push(Qe)}},Polygon:gl,Text:class extends rn{constructor(i,t,e,n){super(i,t,e,n),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterImageWithText_=void 0}finish(){const i=super.finish();return i.textStates=this.textStates,i.fillStates=this.fillStates,i.strokeStates=this.strokeStates,i}drawText(i,t){const e=this.textFillState_,n=this.textStrokeState_,s=this.textState_;if(this.text_===""||!s||!e&&!n)return;const r=this.coordinates;let o=r.length;const a=i.getType();let l=null,h=i.getStride();if(s.placement!=="line"||a!="LineString"&&a!="MultiLineString"&&a!="Polygon"&&a!="MultiPolygon"){let c=s.overflow?null:[];switch(a){case"Point":case"MultiPoint":l=i.getFlatCoordinates();break;case"LineString":l=i.getFlatMidpoint();break;case"Circle":l=i.getCenter();break;case"MultiLineString":l=i.getFlatMidpoints(),h=2;break;case"Polygon":l=i.getFlatInteriorPoint(),s.overflow||c.push(l[2]/this.resolution),h=3;break;case"MultiPolygon":const f=i.getFlatInteriorPoints();l=[];for(let m=0,_=f.length;m<_;m+=3)s.overflow||c.push(f[m+2]/this.resolution),l.push(f[m],f[m+1]);if(l.length===0)return;h=2}const u=this.appendFlatPointCoordinates(l,h);if(u===o)return;if(c&&(u-o)/2!=l.length/h){let f=o/2;c=c.filter((m,_)=>{const y=r[2*(f+_)]===l[_*h]&&r[2*(f+_)+1]===l[_*h+1];return y||--f,y})}this.saveTextStates_(),(s.backgroundFill||s.backgroundStroke)&&(this.setFillStrokeStyle(s.backgroundFill,s.backgroundStroke),s.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),s.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(i,t);let d=s.padding;if(d!=$e&&(s.scale[0]<0||s.scale[1]<0)){let f=s.padding[0],m=s.padding[1],_=s.padding[2],y=s.padding[3];s.scale[0]<0&&(m=-m,y=-y),s.scale[1]<0&&(f=-f,_=-_),d=[f,m,_,y]}const g=this.pixelRatio;this.instructions.push([Ye,o,u,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,void 0,this.declutterImageWithText_,d==$e?$e:d.map(function(f){return f*g}),!!s.backgroundFill,!!s.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,c]);const p=1/g;this.hitDetectionInstructions.push([Ye,o,u,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[p,p],NaN,void 0,this.declutterImageWithText_,d,!!s.backgroundFill,!!s.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,c]),this.endGeometry(t)}else{if(!_t(this.getBufferedMaxExtent(),i.getExtent()))return;let c;if(l=i.getFlatCoordinates(),a=="LineString")c=[l.length];else if(a=="MultiLineString")c=i.getEnds();else if(a=="Polygon")c=i.getEnds().slice(0,1);else if(a=="MultiPolygon"){const p=i.getEndss();c=[];for(let f=0,m=p.length;f<m;++f)c.push(p[f][0])}this.beginGeometry(i,t);const u=s.textAlign;let d,g=0;for(let p=0,f=c.length;p<f;++p){if(u==null){const _=ng(s.maxAngle,l,g,c[p],h);g=_[0],d=_[1]}else d=c[p];for(let _=g;_<d;_+=h)r.push(l[_],l[_+1]);const m=r.length;g=c[p],this.drawChars_(o,m),o=m}this.endGeometry(t)}}saveTextStates_(){const i=this.textStrokeState_,t=this.textState_,e=this.textFillState_,n=this.strokeKey_;i&&(n in this.strokeStates||(this.strokeStates[n]={strokeStyle:i.strokeStyle,lineCap:i.lineCap,lineDashOffset:i.lineDashOffset,lineWidth:i.lineWidth,lineJoin:i.lineJoin,miterLimit:i.miterLimit,lineDash:i.lineDash}));const s=this.textKey_;s in this.textStates||(this.textStates[s]={font:t.font,textAlign:t.textAlign||"center",justify:t.justify,textBaseline:t.textBaseline||"middle",scale:t.scale});const r=this.fillKey_;e&&(r in this.fillStates||(this.fillStates[r]={fillStyle:e.fillStyle}))}drawChars_(i,t){const e=this.textStrokeState_,n=this.textState_,s=this.strokeKey_,r=this.textKey_,o=this.fillKey_;this.saveTextStates_();const a=this.pixelRatio,l=dn[n.textBaseline],h=this.textOffsetY_*a,c=this.text_,u=e?e.lineWidth*Math.abs(n.scale[0])/2:0;this.instructions.push([io,i,t,l,n.overflow,o,n.maxAngle,a,h,s,u*a,c,r,1]),this.hitDetectionInstructions.push([io,i,t,l,n.overflow,o,n.maxAngle,1,h,s,u,c,r,1/a])}setTextStyle(i,t){let e,n,s;if(i){const r=i.getFill();r?(n=this.textFillState_,n||(n={},this.textFillState_=n),n.fillStyle=te(r.getColor()||"#000")):(n=null,this.textFillState_=n);const o=i.getStroke();if(o){s=this.textStrokeState_,s||(s={},this.textStrokeState_=s);const g=o.getLineDash(),p=o.getLineDashOffset(),f=o.getWidth(),m=o.getMiterLimit();s.lineCap=o.getLineCap()||"round",s.lineDash=g?g.slice():Tn,s.lineDashOffset=p===void 0?0:p,s.lineJoin=o.getLineJoin()||"round",s.lineWidth=f===void 0?1:f,s.miterLimit=m===void 0?10:m,s.strokeStyle=te(o.getColor()||"#000")}else s=null,this.textStrokeState_=s;e=this.textState_;const a=i.getFont()||"10px sans-serif";Ld(a);const l=i.getScaleArray();e.overflow=i.getOverflow(),e.font=a,e.maxAngle=i.getMaxAngle(),e.placement=i.getPlacement(),e.textAlign=i.getTextAlign(),e.justify=i.getJustify(),e.textBaseline=i.getTextBaseline()||"middle",e.backgroundFill=i.getBackgroundFill(),e.backgroundStroke=i.getBackgroundStroke(),e.padding=i.getPadding()||$e,e.scale=l===void 0?[1,1]:l;const h=i.getOffsetX(),c=i.getOffsetY(),u=i.getRotateWithView(),d=i.getRotation();this.text_=i.getText()||"",this.textOffsetX_=h===void 0?0:h,this.textOffsetY_=c===void 0?0:c,this.textRotateWithView_=u!==void 0&&u,this.textRotation_=d===void 0?0:d,this.strokeKey_=s?(typeof s.strokeStyle=="string"?s.strokeStyle:Y(s.strokeStyle))+s.lineCap+s.lineDashOffset+"|"+s.lineWidth+s.lineJoin+s.miterLimit+"["+s.lineDash.join()+"]":"",this.textKey_=e.font+e.scale+(e.textAlign||"?")+(e.justify||"?")+(e.textBaseline||"?"),this.fillKey_=n?typeof n.fillStyle=="string"?n.fillStyle:"|"+Y(n.fillStyle):""}else this.text_="";this.declutterImageWithText_=t}}};class fl{constructor(t,e,n,s){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=s,this.resolution_=n,this.buildersByZIndex_={}}finish(){const t={};for(const e in this.buildersByZIndex_){t[e]=t[e]||{};const n=this.buildersByZIndex_[e];for(const s in n){const r=n[s].finish();t[e][s]=r}}return t}getBuilder(t,e){const n=t!==void 0?t.toString():"0";let s=this.buildersByZIndex_[n];s===void 0&&(s={},this.buildersByZIndex_[n]=s);let r=s[e];return r===void 0&&(r=new sg[e](this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),s[e]=r),r}}function rg(i,t,e,n,s,r,o,a,l,h,c,u){let d=i[t],g=i[t+1],p=0,f=0,m=0,_=0;function y(){p=d,f=g,d=i[t+=n],g=i[t+1],_+=m,m=Math.sqrt((d-p)*(d-p)+(g-f)*(g-f))}do y();while(t<e-n&&_+m<r);let v=m===0?0:(r-_)/m;const x=ge(p,d,v),C=ge(f,g,v),E=t-n,S=_,T=r+a*l(h,s,c);for(;t<e-n&&_+m<T;)y();v=m===0?0:(T-_)/m;const R=ge(p,d,v),b=ge(f,g,v);let M;if(u){const L=[x,C,R,b];Fo(L,0,4,2,u,L,L),M=L[0]>L[2]}else M=x>R;const P=Math.PI,j=[],O=E+n===t;let A;if(m=0,_=S,d=i[t=E],g=i[t+1],O){y(),A=Math.atan2(g-f,d-p),M&&(A+=A>0?-P:P);const L=(R+x)/2,k=(b+C)/2;return j[0]=[L,k,(T-r)/2,A,s],j}for(let L=0,k=(s=s.replace(/\n/g," ")).length;L<k;){y();let V=Math.atan2(g-f,d-p);if(M&&(V+=V>0?-P:P),A!==void 0){let w=V-A;if(w+=w>P?-2*P:w<-P?2*P:0,Math.abs(w)>o)return null}A=V;const q=L;let K=0;for(;L<k;++L){const w=a*l(h,s[M?k-L-1:L],c);if(t+n<e&&_+m<r+K+w/2)break;K+=w}if(L===q)continue;const W=M?s.substring(k-q,k-L):s.substring(q,L);v=m===0?0:(r+K/2-_)/m;const J=ge(p,d,v),Q=ge(f,g,v);j.push([J,Q,K/2,V,W]),r+=K}return j}const xi=[1/0,1/0,-1/0,-1/0],we=[],he=[],ce=[],Se=[];function pl(i){return i[3].declutterBox}const og=new RegExp("["+String.fromCharCode(1425)+"-"+String.fromCharCode(2303)+String.fromCharCode(64285)+"-"+String.fromCharCode(65023)+String.fromCharCode(65136)+"-"+String.fromCharCode(65276)+String.fromCharCode(67584)+"-"+String.fromCharCode(69631)+String.fromCharCode(124928)+"-"+String.fromCharCode(126975)+"]");function ml(i,t){return t!=="start"&&t!=="end"||og.test(i)||(t=t==="start"?"left":"right"),dn[t]}function ag(i,t,e){return e>0&&i.push(`
`,""),i.push(t,""),i}class lg{constructor(t,e,n,s){this.overlaps=n,this.pixelRatio=e,this.resolution=t,this.alignFill_,this.instructions=s.instructions,this.coordinates=s.coordinates,this.coordinateCache_={},this.renderedTransform_=[1,0,0,1,0,0],this.hitDetectionInstructions=s.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=s.fillStates||{},this.strokeStates=s.strokeStates||{},this.textStates=s.textStates||{},this.widths_={},this.labels_={}}createLabel(t,e,n,s){const r=t+e+n+s;if(this.labels_[r])return this.labels_[r];const o=s?this.strokeStates[s]:null,a=n?this.fillStates[n]:null,l=this.textStates[e],h=this.pixelRatio,c=[l.scale[0]*h,l.scale[1]*h],u=Array.isArray(t),d=l.justify?dn[l.justify]:ml(Array.isArray(t)?t[0]:t,l.textAlign||"center"),g=s&&o.lineWidth?o.lineWidth:0,p=u?t:t.split(`
`).reduce(ag,[]),{width:f,height:m,widths:_,heights:y,lineWidths:v}=function(V,q){const K=[],W=[],J=[];let Q=0,w=0,z=0,st=0;for(let D=0,nt=q.length;D<=nt;D+=2){const ht=q[D];if(ht===`
`||D===nt){Q=Math.max(Q,w),J.push(w),w=0,z+=st;continue}const se=q[D+1]||V.font,rt=bs(se,ht);K.push(rt),w+=rt;const Rt=Pd(se);W.push(Rt),st=Math.max(st,Rt)}return{width:Q,height:z,widths:K,heights:W,lineWidths:J}}(l,p),x=f+g,C=[],E=(x+2)*c[0],S=(m+g)*c[1],T={width:E<0?Math.floor(E):Math.ceil(E),height:S<0?Math.floor(S):Math.ceil(S),contextInstructions:C};c[0]==1&&c[1]==1||C.push("scale",c),s&&(C.push("strokeStyle",o.strokeStyle),C.push("lineWidth",g),C.push("lineCap",o.lineCap),C.push("lineJoin",o.lineJoin),C.push("miterLimit",o.miterLimit),C.push("setLineDash",[o.lineDash]),C.push("lineDashOffset",o.lineDashOffset)),n&&C.push("fillStyle",a.fillStyle),C.push("textBaseline","middle"),C.push("textAlign","center");const R=.5-d;let b=d*x+R*g;const M=[],P=[];let j,O=0,A=0,L=0,k=0;for(let V=0,q=p.length;V<q;V+=2){const K=p[V];if(K===`
`){A+=O,O=0,b=d*x+R*g,++k;continue}const W=p[V+1]||l.font;W!==j&&(s&&M.push("font",W),n&&P.push("font",W),j=W),O=Math.max(O,y[L]);const J=[K,b+R*_[L]+d*(_[L]-v[k]),.5*(g+O)+A];b+=_[L],s&&M.push("strokeText",J),n&&P.push("fillText",J),++L}return Array.prototype.push.apply(C,M),Array.prototype.push.apply(C,P),this.labels_[r]=T,T}replayTextBackground_(t,e,n,s,r,o,a){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,n),t.lineTo.apply(t,s),t.lineTo.apply(t,r),t.lineTo.apply(t,e),o&&(this.alignFill_=o[2],this.fill_(t)),a&&(this.setStrokeStyle_(t,a),t.stroke())}calculateImageOrLabelDimensions_(t,e,n,s,r,o,a,l,h,c,u,d,g,p,f,m){let _=n-(a*=d[0]),y=s-(l*=d[1]);const v=r+h>t?t-h:r,x=o+c>e?e-c:o,C=p[3]+v*d[0]+p[1],E=p[0]+x*d[1]+p[2],S=_-p[3],T=y-p[0];let R;return(f||u!==0)&&(we[0]=S,Se[0]=S,we[1]=T,he[1]=T,he[0]=S+C,ce[0]=he[0],ce[1]=T+E,Se[1]=ce[1]),u!==0?(R=Oe([1,0,0,1,0,0],n,s,1,1,u,-n,-s),at(R,we),at(R,he),at(R,ce),at(R,Se),Kt(Math.min(we[0],he[0],ce[0],Se[0]),Math.min(we[1],he[1],ce[1],Se[1]),Math.max(we[0],he[0],ce[0],Se[0]),Math.max(we[1],he[1],ce[1],Se[1]),xi)):Kt(Math.min(S,S+C),Math.min(T,T+E),Math.max(S,S+C),Math.max(T,T+E),xi),g&&(_=Math.round(_),y=Math.round(y)),{drawImageX:_,drawImageY:y,drawImageW:v,drawImageH:x,originX:h,originY:c,declutterBox:{minX:xi[0],minY:xi[1],maxX:xi[2],maxY:xi[3],value:m},canvasTransform:R,scale:d}}replayImageOrLabel_(t,e,n,s,r,o,a){const l=!(!o&&!a),h=s.declutterBox,c=t.canvas,u=a?a[2]*s.scale[0]/2:0;return h.minX-u<=c.width/e&&h.maxX+u>=0&&h.minY-u<=c.height/e&&h.maxY+u>=0&&(l&&this.replayTextBackground_(t,we,he,ce,Se,o,a),Fd(t,s.canvasTransform,r,n,s.originX,s.originY,s.drawImageW,s.drawImageH,s.drawImageX,s.drawImageY,s.scale)),!0}fill_(t){if(this.alignFill_){const e=at(this.renderedTransform_,[0,0]),n=512*this.pixelRatio;t.save(),t.translate(e[0]%n,e[1]%n),t.rotate(this.viewRotation_)}t.fill(),this.alignFill_&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6])}drawLabelWithPointPlacement_(t,e,n,s){const r=this.textStates[e],o=this.createLabel(t,e,s,n),a=this.strokeStates[n],l=this.pixelRatio,h=ml(Array.isArray(t)?t[0]:t,r.textAlign||"center"),c=dn[r.textBaseline||"middle"],u=a&&a.lineWidth?a.lineWidth:0;return{label:o,anchorX:h*(o.width/l-2*r.scale[0])+2*(.5-h)*u,anchorY:c*o.height/l+2*(.5-c)*u}}execute_(t,e,n,s,r,o,a,l){let h;var c,u;this.pixelCoordinates_&&gi(n,this.renderedTransform_)?h=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),h=Je(this.coordinates,0,this.coordinates.length,2,n,this.pixelCoordinates_),c=this.renderedTransform_,u=n,c[0]=u[0],c[1]=u[1],c[2]=u[2],c[3]=u[3],c[4]=u[4],c[5]=u[5]);let d=0;const g=s.length;let p,f,m,_,y,v,x,C,E,S,T,R,b=0,M=0,P=0,j=null,O=null;const A=this.coordinateCache_,L=this.viewRotation_,k=Math.round(1e12*Math.atan2(-n[1],n[0]))/1e12,V={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:L},q=this.instructions!=s||this.overlaps?0:200;let K,W,J,Q;for(;d<g;){const w=s[d];switch(w[0]){case ds:K=w[1],Q=w[3],K.getGeometry()?a===void 0||_t(a,Q.getExtent())?++d:d=w[2]+1:d=w[2];break;case dc:M>q&&(this.fill_(t),M=0),P>q&&(t.stroke(),P=0),M||P||(t.beginPath(),_=NaN,y=NaN),++d;break;case gc:b=w[1];const z=h[b],st=h[b+1],D=h[b+2]-z,nt=h[b+3]-st,ht=Math.sqrt(D*D+nt*nt);t.moveTo(z+ht,st),t.arc(z,st,ht,0,2*Math.PI,!0),++d;break;case fc:t.closePath(),++d;break;case Bt:b=w[1],p=w[2];const se=w[3],rt=w[4],Rt=w.length==6?w[5]:void 0;V.geometry=se,V.feature=K,d in A||(A[d]=[]);const ft=A[d];Rt?Rt(h,b,p,2,ft):(ft[0]=h[b],ft[1]=h[b+1],ft.length=2),rt(ft,V),++d;break;case Ye:b=w[1],p=w[2],C=w[3],f=w[4],m=w[5];let Ki=w[6];const xe=w[7],Dn=w[8],An=w[9],On=w[10];let fi=w[11];const Vs=w[12];let yt=w[13];const Mt=w[14],Gt=w[15];if(!C&&w.length>=20){E=w[19],S=w[20],T=w[21],R=w[22];const St=this.drawLabelWithPointPlacement_(E,S,T,R);C=St.label,w[3]=C;const qt=w[23];f=(St.anchorX-qt)*this.pixelRatio,w[4]=f;const Lt=w[24];m=(St.anchorY-Lt)*this.pixelRatio,w[5]=m,Ki=C.height,w[6]=Ki,yt=C.width,w[13]=yt}let re,pi,Be,Ce;w.length>25&&(re=w[25]),w.length>17?(pi=w[16],Be=w[17],Ce=w[18]):(pi=$e,Be=!1,Ce=!1),On&&k?fi+=L:On||k||(fi-=L);let mi=0;for(;b<p;b+=2){if(re&&re[mi++]<yt/this.pixelRatio)continue;const St=this.calculateImageOrLabelDimensions_(C.width,C.height,h[b],h[b+1],yt,Ki,f,m,Dn,An,fi,Vs,r,pi,Be||Ce,K),qt=[t,e,C,St,xe,Be?j:null,Ce?O:null];if(l){if(Mt==="none")continue;if(Mt==="obstacle"){l.insert(St.declutterBox);continue}{let Lt,Pt;if(Gt){const oe=p-b;if(!Gt[oe]){Gt[oe]=qt;continue}if(Lt=Gt[oe],delete Gt[oe],Pt=pl(Lt),l.collides(Pt))continue}if(l.collides(St.declutterBox))continue;Lt&&(l.insert(Pt),this.replayImageOrLabel_.apply(this,Lt)),l.insert(St.declutterBox)}}this.replayImageOrLabel_.apply(this,qt)}++d;break;case io:const Gn=w[1],pt=w[2],Ys=w[3],Ac=w[4];R=w[5];const Oc=w[6],na=w[7],sa=w[8];T=w[9];const Ks=w[10];E=w[11],S=w[12];const ra=[w[13],w[13]],Zs=this.textStates[S],Zi=Zs.font,Hi=[Zs.scale[0]*na,Zs.scale[1]*na];let Ui;Zi in this.widths_?Ui=this.widths_[Zi]:(Ui={},this.widths_[Zi]=Ui);const oa=Wh(h,Gn,pt,2),aa=Math.abs(Hi[0])*nl(Zi,E,Ui);if(Ac||aa<=oa){const St=this.textStates[S].textAlign,qt=rg(h,Gn,pt,2,E,(oa-aa)*dn[St],Oc,Math.abs(Hi[0]),nl,Zi,Ui,k?0:this.viewRotation_);t:if(qt){const Lt=[];let Pt,oe,jn,vt,Ft;if(T)for(Pt=0,oe=qt.length;Pt<oe;++Pt){Ft=qt[Pt],jn=Ft[4],vt=this.createLabel(jn,S,"",T),f=Ft[2]+(Hi[0]<0?-Ks:Ks),m=Ys*vt.height+2*(.5-Ys)*Ks*Hi[1]/Hi[0]-sa;const ae=this.calculateImageOrLabelDimensions_(vt.width,vt.height,Ft[0],Ft[1],vt.width,vt.height,f,m,0,0,Ft[3],ra,!1,$e,!1,K);if(l&&l.collides(ae.declutterBox))break t;Lt.push([t,e,vt,ae,1,null,null])}if(R)for(Pt=0,oe=qt.length;Pt<oe;++Pt){Ft=qt[Pt],jn=Ft[4],vt=this.createLabel(jn,S,R,""),f=Ft[2],m=Ys*vt.height-sa;const ae=this.calculateImageOrLabelDimensions_(vt.width,vt.height,Ft[0],Ft[1],vt.width,vt.height,f,m,0,0,Ft[3],ra,!1,$e,!1,K);if(l&&l.collides(ae.declutterBox))break t;Lt.push([t,e,vt,ae,1,null,null])}l&&l.load(Lt.map(pl));for(let ae=0,Gc=Lt.length;ae<Gc;++ae)this.replayImageOrLabel_.apply(this,Lt[ae])}}++d;break;case no:if(o!==void 0){K=w[1];const St=o(K,Q);if(St)return St}++d;break;case pc:q?M++:this.fill_(t),++d;break;case Zo:for(b=w[1],p=w[2],W=h[b],J=h[b+1],v=W+.5|0,x=J+.5|0,v===_&&x===y||(t.moveTo(W,J),_=v,y=x),b+=2;b<p;b+=2)W=h[b],J=h[b+1],v=W+.5|0,x=J+.5|0,b!=p-2&&v===_&&x===y||(t.lineTo(W,J),_=v,y=x);++d;break;case un:j=w,this.alignFill_=w[2],M&&(this.fill_(t),M=0,P&&(t.stroke(),P=0)),t.fillStyle=w[1],++d;break;case ni:O=w,P&&(t.stroke(),P=0),this.setStrokeStyle_(t,w),++d;break;case mc:q?P++:t.stroke(),++d;break;default:++d}}M&&this.fill_(t),P&&t.stroke()}execute(t,e,n,s,r,o){this.viewRotation_=s,this.execute_(t,e,n,this.instructions,r,void 0,void 0,o)}executeHitDetection(t,e,n,s,r){return this.viewRotation_=n,this.execute_(t,1,e,this.hitDetectionInstructions,!0,s,r)}}const pr=["Polygon","Circle","LineString","Image","Text","Default"];class _l{constructor(t,e,n,s,r,o){this.maxExtent_=t,this.overlaps_=s,this.pixelRatio_=n,this.resolution_=e,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=[1,0,0,1,0,0],this.createExecutors_(r)}clip(t,e){const n=this.getClipCoords(e);t.beginPath(),t.moveTo(n[0],n[1]),t.lineTo(n[2],n[3]),t.lineTo(n[4],n[5]),t.lineTo(n[6],n[7]),t.clip()}createExecutors_(t){for(const e in t){let n=this.executorsByZIndex_[e];n===void 0&&(n={},this.executorsByZIndex_[e]=n);const s=t[e];for(const r in s){const o=s[r];n[r]=new lg(this.resolution_,this.pixelRatio_,this.overlaps_,o)}}}hasExecutors(t){for(const e in this.executorsByZIndex_){const n=this.executorsByZIndex_[e];for(let s=0,r=t.length;s<r;++s)if(t[s]in n)return!0}return!1}forEachFeatureAtCoordinate(t,e,n,s,r,o){const a=2*(s=Math.round(s))+1,l=Oe(this.hitDetectionTransform_,s+.5,s+.5,1/e,-1/e,-n,-t[0],-t[1]),h=!this.hitDetectionContext_;h&&(this.hitDetectionContext_=wt(a,a));const c=this.hitDetectionContext_;let u;c.canvas.width!==a||c.canvas.height!==a?(c.canvas.width=a,c.canvas.height=a):h||c.clearRect(0,0,a,a),this.renderBuffer_!==void 0&&(u=[1/0,1/0,-1/0,-1/0],an(u,t),mo(u,e*(this.renderBuffer_+s),u));const d=function(C){if(mr[C]!==void 0)return mr[C];const E=2*C+1,S=C*C,T=new Array(S+1);for(let b=0;b<=C;++b)for(let M=0;M<=C;++M){const P=b*b+M*M;if(P>S)break;let j=T[P];j||(j=[],T[P]=j),j.push(4*((C+b)*E+(C+M))+3),b>0&&j.push(4*((C-b)*E+(C+M))+3),M>0&&(j.push(4*((C+b)*E+(C-M))+3),b>0&&j.push(4*((C-b)*E+(C-M))+3))}const R=[];for(let b=0,M=T.length;b<M;++b)T[b]&&R.push(...T[b]);return mr[C]=R,R}(s);let g;function p(C,E){const S=c.getImageData(0,0,a,a).data;for(let T=0,R=d.length;T<R;T++)if(S[d[T]]>0){if(!o||g!=="Image"&&g!=="Text"||o.includes(C)){const b=(d[T]-3)/4,M=s-b%a,P=s-(b/a|0),j=r(C,E,M*M+P*P);if(j)return j}c.clearRect(0,0,a,a);break}}const f=Object.keys(this.executorsByZIndex_).map(Number);let m,_,y,v,x;for(f.sort(ai),m=f.length-1;m>=0;--m){const C=f[m].toString();for(y=this.executorsByZIndex_[C],_=pr.length-1;_>=0;--_)if(g=pr[_],v=y[g],v!==void 0&&(x=v.executeHitDetection(c,l,n,p,u),x))return x}}getClipCoords(t){const e=this.maxExtent_;if(!e)return null;const n=e[0],s=e[1],r=e[2],o=e[3],a=[n,s,n,o,r,o,r,s];return Je(a,0,8,2,t,a),a}isEmpty(){return mn(this.executorsByZIndex_)}execute(t,e,n,s,r,o,a){const l=Object.keys(this.executorsByZIndex_).map(Number);let h,c,u,d,g,p;for(l.sort(ai),this.maxExtent_&&(t.save(),this.clip(t,n)),o=o||pr,a&&l.reverse(),h=0,c=l.length;h<c;++h){const f=l[h].toString();for(g=this.executorsByZIndex_[f],u=0,d=o.length;u<d;++u)p=g[o[u]],p!==void 0&&p.execute(t,e,n,s,r,a)}this.maxExtent_&&t.restore()}}const mr={};class hg extends cn{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.declutterExecutorGroup=null}getFeatures(t){return X()}getData(t){return null}prepareFrame(t){return X()}renderFrame(t,e){return X()}loadedTileCallback(t,e,n){t[e]||(t[e]={}),t[e][n.tileCoord.toString()]=n}createLoadedTileFinder(t,e,n){return function(s,r){const o=this.loadedTileCallback.bind(this,n,s);return t.forEachLoadedTile(e,s,r,o)}.bind(this)}forEachFeatureAtCoordinate(t,e,n,s,r){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){t.target.getState()===Yt&&this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return e!=Yt&&e!=Bo&&t.addEventListener(lt,this.boundHandleImageChange_),e==js&&(t.load(),e=t.getState()),e==Yt}renderIfReadyAndVisible(){const t=this.getLayer();t&&t.getVisible()&&t.getSourceState()==="ready"&&t.changed()}disposeInternal(){delete this.layer_,super.disposeInternal()}}class yc extends ne{constructor(t,e,n,s){super(t),this.inversePixelTransform=e,this.frameState=n,this.context=s}}const yl=[];let Ci=null;class vc extends hg{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=[1,0,0,1,0,0],this.pixelTransform=[1,0,0,1,0,0],this.inversePixelTransform=[1,0,0,1,0,0],this.context=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(t,e,n){let s;Ci||function(){const r=document.createElement("canvas");r.width=1,r.height=1,Ci=r.getContext("2d")}(),Ci.clearRect(0,0,1,1);try{Ci.drawImage(t,e,n,1,1,0,0,1,1),s=Ci.getImageData(0,0,1,1).data}catch{return Ci=null,null}return s}getBackground(t){let e=this.getLayer().getBackground();return typeof e=="function"&&(e=e(t.viewState.resolution)),e||void 0}useContainer(t,e,n){const s=this.getLayer().getClassName();let r,o;if(t&&t.className===s&&(!n||t&&t.style.backgroundColor&&gi(ws(t.style.backgroundColor),ws(n)))){const a=t.firstElementChild;a instanceof HTMLCanvasElement&&(o=a.getContext("2d"))}if(o&&o.canvas.style.transform===e?(this.container=t,this.context=o,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),!this.container){r=document.createElement("div"),r.className=s;let a=r.style;a.position="absolute",a.width="100%",a.height="100%",o=wt();const l=o.canvas;r.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=r,this.context=o}this.containerReused||!n||this.container.style.backgroundColor||(this.container.style.backgroundColor=n)}clipUnrotated(t,e,n){const s=je(n),r=Ps(n),o=Ls(n),a=Ms(n);at(e.coordinateToPixelTransform,s),at(e.coordinateToPixelTransform,r),at(e.coordinateToPixelTransform,o),at(e.coordinateToPixelTransform,a);const l=this.inversePixelTransform;at(l,s),at(l,r),at(l,o),at(l,a),t.save(),t.beginPath(),t.moveTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(r[0]),Math.round(r[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(a[0]),Math.round(a[1])),t.clip()}dispatchRenderEvent_(t,e,n){const s=this.getLayer();if(s.hasListener(t)){const r=new yc(t,this.inversePixelTransform,n,e);s.dispatchEvent(r)}}preRender(t,e){this.frameState=e,this.dispatchRenderEvent_(Vd,t,e)}postRender(t,e){this.dispatchRenderEvent_(Yd,t,e)}getRenderTransform(t,e,n,s,r,o,a){const l=r/2,h=o/2,c=s/e,u=-c,d=-t[0]+a,g=-t[1];return Oe(this.tempTransform,l,h,c,u,-n,d,g)}disposeInternal(){delete this.frameState,super.disposeInternal()}}class xc extends ic{constructor(t,e,n,s,r,o){super(t,e,o),this.crossOrigin_=s,this.src_=n,this.key=n,this.image_=new Image,s!==null&&(this.image_.crossOrigin=s),this.unlisten_=null,this.tileLoadFunction_=r}getImage(){return this.image_}setImage(t){this.image_=t,this.state=It,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=Ht,this.unlistenImage_(),this.image_=function(){const t=wt(1,1);return t.fillStyle="rgba(0,0,0,0)",t.fillRect(0,0,1,1),t.canvas}(),this.changed()}handleImageLoad_(){const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=It:this.state=At,this.unlistenImage_(),this.changed()}load(){this.state==Ht&&(this.state=Wt,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==Wt&&(this.state=In,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=$h(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}class cg{constructor(t,e,n,s,r,o){this.sourceProj_=t,this.targetProj_=e;let a={};const l=yn(this.targetProj_,this.sourceProj_);this.transformInv_=function(y){const v=y[0]+"/"+y[1];return a[v]||(a[v]=l(y)),a[v]},this.maxSourceExtent_=s,this.errorThresholdSquared_=r*r,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!s&&!!this.sourceProj_.getExtent()&&U(s)==U(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?U(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?U(this.targetProj_.getExtent()):null;const h=je(n),c=Ps(n),u=Ls(n),d=Ms(n),g=this.transformInv_(h),p=this.transformInv_(c),f=this.transformInv_(u),m=this.transformInv_(d),_=10+(o?Math.max(0,Math.ceil(Math.log2(Nr(n)/(o*o*256*256)))):0);if(this.addQuad_(h,c,u,d,g,p,f,m,_),this.wrapsXInSource_){let y=1/0;this.triangles_.forEach(function(v,x,C){y=Math.min(y,v.source[0][0],v.source[1][0],v.source[2][0])}),this.triangles_.forEach(function(v){if(Math.max(v.source[0][0],v.source[1][0],v.source[2][0])-y>this.sourceWorldWidth_/2){const x=[[v.source[0][0],v.source[0][1]],[v.source[1][0],v.source[1][1]],[v.source[2][0],v.source[2][1]]];x[0][0]-y>this.sourceWorldWidth_/2&&(x[0][0]-=this.sourceWorldWidth_),x[1][0]-y>this.sourceWorldWidth_/2&&(x[1][0]-=this.sourceWorldWidth_),x[2][0]-y>this.sourceWorldWidth_/2&&(x[2][0]-=this.sourceWorldWidth_);const C=Math.min(x[0][0],x[1][0],x[2][0]);Math.max(x[0][0],x[1][0],x[2][0])-C<this.sourceWorldWidth_/2&&(v.source=x)}}.bind(this))}a={}}addTriangle_(t,e,n,s,r,o){this.triangles_.push({source:[s,r,o],target:[t,e,n]})}addQuad_(t,e,n,s,r,o,a,l,h){const c=zr([r,o,a,l]),u=this.sourceWorldWidth_?U(c)/this.sourceWorldWidth_:null,d=this.sourceWorldWidth_,g=this.sourceProj_.canWrapX()&&u>.5&&u<1;let p=!1;if(h>0&&(this.targetProj_.isGlobal()&&this.targetWorldWidth_&&(p=U(zr([t,e,n,s]))/this.targetWorldWidth_>.25||p),!g&&this.sourceProj_.isGlobal()&&u&&(p=u>.25||p)),!p&&this.maxSourceExtent_&&isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])&&isFinite(c[3])&&!_t(c,this.maxSourceExtent_))return;let f=0;if(!(p||isFinite(r[0])&&isFinite(r[1])&&isFinite(o[0])&&isFinite(o[1])&&isFinite(a[0])&&isFinite(a[1])&&isFinite(l[0])&&isFinite(l[1]))){if(h>0)p=!0;else if(f=(isFinite(r[0])&&isFinite(r[1])?0:8)+(isFinite(o[0])&&isFinite(o[1])?0:4)+(isFinite(a[0])&&isFinite(a[1])?0:2)+(isFinite(l[0])&&isFinite(l[1])?0:1),f!=1&&f!=2&&f!=4&&f!=8)return}if(h>0){if(!p){const m=[(t[0]+n[0])/2,(t[1]+n[1])/2],_=this.transformInv_(m);let y;g?y=(Di(r[0],d)+Di(a[0],d))/2-Di(_[0],d):y=(r[0]+a[0])/2-_[0];const v=(r[1]+a[1])/2-_[1];p=y*y+v*v>this.errorThresholdSquared_}if(p){if(Math.abs(t[0]-n[0])<=Math.abs(t[1]-n[1])){const m=[(e[0]+n[0])/2,(e[1]+n[1])/2],_=this.transformInv_(m),y=[(s[0]+t[0])/2,(s[1]+t[1])/2],v=this.transformInv_(y);this.addQuad_(t,e,m,y,r,o,_,v,h-1),this.addQuad_(y,m,n,s,v,_,a,l,h-1)}else{const m=[(t[0]+e[0])/2,(t[1]+e[1])/2],_=this.transformInv_(m),y=[(n[0]+s[0])/2,(n[1]+s[1])/2],v=this.transformInv_(y);this.addQuad_(t,m,y,s,r,_,v,l,h-1),this.addQuad_(m,e,n,y,_,o,a,v,h-1)}return}}if(g){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}(11&f)==0&&this.addTriangle_(t,n,s,r,a,l),(14&f)==0&&this.addTriangle_(t,n,e,r,a,o),f&&((13&f)==0&&this.addTriangle_(e,s,t,o,l,r),(7&f)==0&&this.addTriangle_(e,s,n,o,l,a))}calculateSourceExtent(){const t=[1/0,1/0,-1/0,-1/0];return this.triangles_.forEach(function(e,n,s){const r=e.source;an(t,r[0]),an(t,r[1]),an(t,r[2])}),t}getTriangles(){return this.triangles_}}let _r;const Cc=[];function vl(i,t,e,n,s){i.beginPath(),i.moveTo(0,0),i.lineTo(t,e),i.lineTo(n,s),i.closePath(),i.save(),i.clip(),i.fillRect(0,0,Math.max(t,n)+1,Math.max(e,s)),i.restore()}function yr(i,t){return Math.abs(i[4*t]-210)>2||Math.abs(i[4*t+3]-191.25)>2}function xl(i,t,e,n){const s=xh(e,t,i);let r=Fa(t,n,e);const o=t.getMetersPerUnit();o!==void 0&&(r*=o);const a=i.getMetersPerUnit();a!==void 0&&(r/=a);const l=i.getExtent();if(!l||Rs(l,s)){const h=Fa(i,r,s)/r;isFinite(h)&&h>0&&(r/=h)}return r}function ug(i,t,e,n,s,r,o,a,l,h,c,u){const d=wt(Math.round(e*i),Math.round(e*t),Cc);if(u||(d.imageSmoothingEnabled=!1),l.length===0)return d.canvas;function g(x){return Math.round(x*e)/e}d.scale(e,e),d.globalCompositeOperation="lighter";const p=[1/0,1/0,-1/0,-1/0];l.forEach(function(x,C,E){ch(p,x.extent)});const f=U(p),m=ie(p),_=wt(Math.round(e*f/n),Math.round(e*m/n));u||(_.imageSmoothingEnabled=!1);const y=e/n;l.forEach(function(x,C,E){const S=x.extent[0]-p[0],T=-(x.extent[3]-p[3]),R=U(x.extent),b=ie(x.extent);x.image.width>0&&x.image.height>0&&_.drawImage(x.image,h,h,x.image.width-2*h,x.image.height-2*h,S*y,T*y,R*y,b*y)});const v=je(o);return a.getTriangles().forEach(function(x,C,E){const S=x.source,T=x.target;let R=S[0][0],b=S[0][1],M=S[1][0],P=S[1][1],j=S[2][0],O=S[2][1];const A=g((T[0][0]-v[0])/r),L=g(-(T[0][1]-v[1])/r),k=g((T[1][0]-v[0])/r),V=g(-(T[1][1]-v[1])/r),q=g((T[2][0]-v[0])/r),K=g(-(T[2][1]-v[1])/r),W=R,J=b;R=0,b=0,M-=W,P-=J,j-=W,O-=J;const Q=function(w){const z=w.length;for(let D=0;D<z;D++){let nt=D,ht=Math.abs(w[D][D]);for(let rt=D+1;rt<z;rt++){const Rt=Math.abs(w[rt][D]);Rt>ht&&(ht=Rt,nt=rt)}if(ht===0)return null;const se=w[nt];w[nt]=w[D],w[D]=se;for(let rt=D+1;rt<z;rt++){const Rt=-w[rt][D]/w[D][D];for(let ft=D;ft<z+1;ft++)D==ft?w[rt][ft]=0:w[rt][ft]+=Rt*w[D][ft]}}const st=new Array(z);for(let D=z-1;D>=0;D--){st[D]=w[D][z]/w[D][D];for(let nt=D-1;nt>=0;nt--)w[nt][z]-=w[nt][D]*st[D]}return st}([[M,P,0,0,k-A],[j,O,0,0,q-A],[0,0,M,P,V-L],[0,0,j,O,K-L]]);if(Q){if(d.save(),d.beginPath(),function(){if(_r===void 0){const w=document.createElement("canvas").getContext("2d");w.globalCompositeOperation="lighter",w.fillStyle="rgba(210, 0, 0, 0.75)",vl(w,4,5,4,0),vl(w,4,5,0,5);const z=w.getImageData(0,0,3,3).data;_r=yr(z,0)||yr(z,4)||yr(z,8)}return _r}()||!u){d.moveTo(k,V);const w=4,z=A-k,st=L-V;for(let D=0;D<w;D++)d.lineTo(k+g((D+1)*z/w),V+g(D*st/(w-1))),D!=w-1&&d.lineTo(k+g((D+1)*z/w),V+g((D+1)*st/(w-1)));d.lineTo(q,K)}else d.moveTo(k,V),d.lineTo(A,L),d.lineTo(q,K);d.clip(),d.transform(Q[0],Q[2],Q[1],Q[3],A,L),d.translate(p[0]-W,p[3]-J),d.scale(n/e,-n/e),d.drawImage(_.canvas,0,0),d.restore()}}),c&&(d.save(),d.globalCompositeOperation="source-over",d.strokeStyle="black",d.lineWidth=1,a.getTriangles().forEach(function(x,C,E){const S=x.target,T=(S[0][0]-v[0])/r,R=-(S[0][1]-v[1])/r,b=(S[1][0]-v[0])/r,M=-(S[1][1]-v[1])/r,P=(S[2][0]-v[0])/r,j=-(S[2][1]-v[1])/r;d.beginPath(),d.moveTo(b,M),d.lineTo(T,R),d.lineTo(P,j),d.closePath(),d.stroke()}),d.restore()),d.canvas}class so extends ic{constructor(t,e,n,s,r,o,a,l,h,c,u,d){super(r,Wt,{interpolate:!!d}),this.renderEdges_=u!==void 0&&u,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=s,this.wrappedTileCoord_=o||r,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const g=s.getTileCoordExtent(this.wrappedTileCoord_),p=this.targetTileGrid_.getExtent();let f=this.sourceTileGrid_.getExtent();const m=p?ln(g,p):g;if(Nr(m)===0)return void(this.state=At);const _=t.getExtent();_&&(f=f?ln(f,_):_);const y=s.getResolution(this.wrappedTileCoord_[0]),v=function(E,S,T,R){const b=ye(T);let M=xl(E,S,b,R);return(!isFinite(M)||M<=0)&&yo(T,function(P){return M=xl(E,S,P,R),isFinite(M)&&M>0}),M}(t,n,m,y);if(!isFinite(v)||v<=0)return void(this.state=At);const x=c!==void 0?c:.5;if(this.triangulation_=new cg(t,n,m,f,v*x,y),this.triangulation_.getTriangles().length===0)return void(this.state=At);this.sourceZ_=e.getZForResolution(v);let C=this.triangulation_.calculateSourceExtent();if(f&&(t.canWrapX()?(C[1]=it(C[1],f[1],f[3]),C[3]=it(C[3],f[1],f[3])):C=ln(C,f)),Nr(C)){const E=e.getTileRangeForExtentAndZ(C,this.sourceZ_);for(let S=E.minX;S<=E.maxX;S++)for(let T=E.minY;T<=E.maxY;T++){const R=h(this.sourceZ_,S,T,a);R&&this.sourceTiles_.push(R)}this.sourceTiles_.length===0&&(this.state=At)}else this.state=At}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach(function(e,n,s){e&&e.getState()==It&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),image:e.getImage()})}.bind(this)),this.sourceTiles_.length=0,t.length===0)this.state=Ht;else{const e=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(e),s=typeof n=="number"?n:n[0],r=typeof n=="number"?n:n[1],o=this.targetTileGrid_.getResolution(e),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=ug(s,r,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=It}this.changed()}load(){if(this.state==Wt){this.state=In,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(function(e,n,s){const r=e.getState();if(r==Wt||r==In){t++;const o=N(e,lt,function(a){const l=e.getState();l!=It&&l!=Ht&&l!=At||($(o),t--,t===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(o)}}.bind(this)),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(e,n,s){e.getState()==Wt&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach($),this.sourcesListenerKeys_=null}release(){this.canvas_&&(qh(this.canvas_.getContext("2d")),Cc.push(this.canvas_),this.canvas_=null),super.release()}}class dg extends vc{constructor(t){super(t),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=[1/0,1/0,-1/0,-1/0],this.tmpTileRange_=new Eo(0,0,0,0)}isDrawableTile(t){const e=this.getLayer(),n=t.getState(),s=e.getUseInterimTilesOnError();return n==It||n==At||n==Ht&&!s}getTile(t,e,n,s){const r=s.pixelRatio,o=s.viewState.projection,a=this.getLayer();let l=a.getSource().getTile(t,e,n,r,o);return l.getState()==Ht&&a.getUseInterimTilesOnError()&&a.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(l)||(l=l.getInterimTile()),l}getData(t){const e=this.frameState;if(!e)return null;const n=this.getLayer(),s=at(e.pixelToCoordinateTransform,t.slice()),r=n.getExtent();if(r&&!Rs(r,s))return null;const o=e.pixelRatio,a=e.viewState.projection,l=e.viewState,h=n.getRenderSource(),c=h.getTileGridForProjection(l.projection),u=h.getTilePixelRatio(e.pixelRatio);for(let d=c.getZForResolution(l.resolution);d>=c.getMinZoom();--d){const g=c.getTileCoordForCoordAndZ(s,d),p=h.getTile(d,g[1],g[2],o,a);if(!(p instanceof xc||p instanceof so)||p instanceof so&&p.getState()===At)return null;if(p.getState()!==It)continue;const f=c.getOrigin(d),m=xt(c.getTileSize(d)),_=c.getResolution(d),y=Math.floor(u*((s[0]-f[0])/_-g[1]*m[0])),v=Math.floor(u*((f[1]-s[1])/_-g[2]*m[1])),x=Math.round(u*h.getGutterForProjection(l.projection));return this.getImageData(p.getImage(),y+x,v+x)}return null}loadedTileCallback(t,e,n){return!!this.isDrawableTile(n)&&super.loadedTileCallback(t,e,n)}prepareFrame(t){return!!this.getLayer().getSource()}renderFrame(t,e){const n=t.layerStatesArray[t.layerIndex],s=t.viewState,r=s.projection,o=s.resolution,a=s.center,l=s.rotation,h=t.pixelRatio,c=this.getLayer(),u=c.getSource(),d=u.getRevision(),g=u.getTileGridForProjection(r),p=g.getZForResolution(o,u.zDirection),f=g.getResolution(p);let m=t.extent;const _=t.viewState.resolution,y=u.getTilePixelRatio(h),v=Math.round(U(m)/_*h),x=Math.round(ie(m)/_*h),C=n.extent&&He(n.extent);C&&(m=ln(m,He(n.extent)));const E=f*v/2/y,S=f*x/2/y,T=[a[0]-E,a[1]-S,a[0]+E,a[1]+S],R=g.getTileRangeForExtentAndZ(m,p),b={};b[p]={};const M=this.createLoadedTileFinder(u,r,b),P=this.tmpExtent,j=this.tmpTileRange_;this.newTiles_=!1;const O=l?Xr(s.center,_,l,t.size):void 0;for(let Q=R.minX;Q<=R.maxX;++Q)for(let w=R.minY;w<=R.maxY;++w){if(l&&!g.tileCoordIntersectsViewport([p,Q,w],O))continue;const z=this.getTile(p,Q,w,t);if(this.isDrawableTile(z)){const nt=Y(this);if(z.getState()==It){b[p][z.tileCoord.toString()]=z;let ht=z.inTransition(nt);ht&&n.opacity!==1&&(z.endTransition(nt),ht=!1),this.newTiles_||!ht&&this.renderedTiles.includes(z)||(this.newTiles_=!0)}if(z.getAlpha(nt,t.time)===1)continue}const st=g.getTileCoordChildTileRange(z.tileCoord,j,P);let D=!1;st&&(D=M(p+1,st)),D||g.forEachTileCoordParentTileRange(z.tileCoord,M,j,P)}const A=f/o*h/y;Oe(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/h,1/h,l,-v/2,-x/2);const L=Oh(this.pixelTransform);this.useContainer(e,L,this.getBackground(t));const k=this.context,V=k.canvas;Po(this.inversePixelTransform,this.pixelTransform),Oe(this.tempTransform,v/2,x/2,A,A,0,-v/2,-x/2),V.width!=v||V.height!=x?(V.width=v,V.height=x):this.containerReused||k.clearRect(0,0,v,x),C&&this.clipUnrotated(k,t,C),u.getInterpolate()||(k.imageSmoothingEnabled=!1),this.preRender(k,t),this.renderedTiles.length=0;let q,K,W,J=Object.keys(b).map(Number);J.sort(ai),n.opacity!==1||this.containerReused&&!u.getOpaque(t.viewState.projection)?(q=[],K=[]):J=J.reverse();for(let Q=J.length-1;Q>=0;--Q){const w=J[Q],z=u.getTilePixelSize(w,h,r),st=g.getResolution(w)/f,D=z[0]*st*A,nt=z[1]*st*A,ht=g.getTileCoordForCoordAndZ(je(T),w),se=g.getTileCoordExtent(ht),rt=at(this.tempTransform,[y*(se[0]-T[0])/f,y*(T[3]-se[3])/f]),Rt=y*u.getGutterForProjection(r),ft=b[w];for(const Ki in ft){const xe=ft[Ki],Dn=xe.tileCoord,An=ht[1]-Dn[1],On=Math.round(rt[0]-(An-1)*D),fi=ht[2]-Dn[2],Vs=Math.round(rt[1]-(fi-1)*nt),yt=Math.round(rt[0]-An*D),Mt=Math.round(rt[1]-fi*nt),Gt=On-yt,re=Vs-Mt,pi=p===w,Be=pi&&xe.getAlpha(Y(this),t.time)!==1;let Ce=!1;if(!Be)if(q){W=[yt,Mt,yt+Gt,Mt,yt+Gt,Mt+re,yt,Mt+re];for(let mi=0,Gn=q.length;mi<Gn;++mi)if(p!==w&&w<K[mi]){const pt=q[mi];_t([yt,Mt,yt+Gt,Mt+re],[pt[0],pt[3],pt[4],pt[7]])&&(Ce||(k.save(),Ce=!0),k.beginPath(),k.moveTo(W[0],W[1]),k.lineTo(W[2],W[3]),k.lineTo(W[4],W[5]),k.lineTo(W[6],W[7]),k.moveTo(pt[6],pt[7]),k.lineTo(pt[4],pt[5]),k.lineTo(pt[2],pt[3]),k.lineTo(pt[0],pt[1]),k.clip())}q.push(W),K.push(w)}else k.clearRect(yt,Mt,Gt,re);this.drawTileImage(xe,t,yt,Mt,Gt,re,Rt,pi),q&&!Be?(Ce&&k.restore(),this.renderedTiles.unshift(xe)):this.renderedTiles.push(xe),this.updateUsedTiles(t.usedTiles,u,xe)}}return this.renderedRevision=d,this.renderedResolution=f,this.extentChanged=!this.renderedExtent_||!_n(this.renderedExtent_,T),this.renderedExtent_=T,this.renderedPixelRatio=h,this.renderedProjection=r,this.manageTilePyramid(t,u,g,h,r,m,p,c.getPreload()),this.scheduleExpireCache(t,u),this.postRender(k,t),n.extent&&k.restore(),k.imageSmoothingEnabled=!0,L!==V.style.transform&&(V.style.transform=L),this.container}drawTileImage(t,e,n,s,r,o,a,l){const h=this.getTileImage(t);if(!h)return;const c=Y(this),u=e.layerStatesArray[e.layerIndex],d=u.opacity*(l?t.getAlpha(c,e.time):1),g=d!==this.context.globalAlpha;g&&(this.context.save(),this.context.globalAlpha=d),this.context.drawImage(h,a,a,h.width-2*a,h.height-2*a,n,s,r,o),g&&this.context.restore(),d!==u.opacity?e.animate=!0:l&&t.endTransition(c)}getImage(){const t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}scheduleExpireCache(t,e){if(e.canExpireCache()){const n=function(s,r,o){const a=Y(s);a in o.usedTiles&&s.expireCache(o.viewState.projection,o.usedTiles[a])}.bind(null,e);t.postRenderFunctions.push(n)}}updateUsedTiles(t,e,n){const s=Y(e);s in t||(t[s]={}),t[s][n.getKey()]=!0}manageTilePyramid(t,e,n,s,r,o,a,l,h){const c=Y(e);c in t.wantedTiles||(t.wantedTiles[c]={});const u=t.wantedTiles[c],d=t.tileQueue,g=n.getMinZoom(),p=t.viewState.rotation,f=p?Xr(t.viewState.center,t.viewState.resolution,p,t.size):void 0;let m,_,y,v,x,C,E=0;for(C=g;C<=a;++C)for(_=n.getTileRangeForExtentAndZ(o,C,_),y=n.getResolution(C),v=_.minX;v<=_.maxX;++v)for(x=_.minY;x<=_.maxY;++x)p&&!n.tileCoordIntersectsViewport([C,v,x],f)||(a-C<=l?(++E,m=e.getTile(C,v,x,s,r),m.getState()==Wt&&(u[m.getKey()]=!0,d.isKeyQueued(m.getKey())||d.enqueue([m,c,n.getTileCoordCenter(m.tileCoord),y])),h!==void 0&&h(m)):e.useTile(C,v,x,r));e.updateCacheSize(E,r)}}var fe=0,si=1;class gg extends _c{constructor(t,e,n,s,r,o,a){super(),this.context_=t,this.pixelRatio_=e,this.extent_=n,this.transform_=s,this.viewRotation_=r,this.squaredTolerance_=o,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=[1,0,0,1,0,0]}drawImages_(t,e,n,s){if(!this.image_)return;const r=Je(t,e,n,s,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,l=o.globalAlpha;this.imageOpacity_!=1&&(o.globalAlpha=l*this.imageOpacity_);let h=this.imageRotation_;this.imageRotateWithView_&&(h+=this.viewRotation_);for(let c=0,u=r.length;c<u;c+=2){const d=r[c]-this.imageAnchorX_,g=r[c+1]-this.imageAnchorY_;if(h!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const p=d+this.imageAnchorX_,f=g+this.imageAnchorY_;Oe(a,p,f,1,1,h,-p,-f),o.setTransform.apply(o,a),o.translate(p,f),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.setTransform(1,0,0,1,0,0)}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,d,g,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(o.globalAlpha=l)}drawText_(t,e,n,s){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const r=Je(t,e,n,s,this.transform_,this.pixelCoordinates_),o=this.context_;let a=this.textRotation_;for(this.textRotateWithView_&&(a+=this.viewRotation_);e<n;e+=s){const l=r[e]+this.textOffsetX_,h=r[e+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(o.translate(l-this.textOffsetX_,h-this.textOffsetY_),o.rotate(a),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.setTransform(1,0,0,1,0,0)):(this.textStrokeState_&&o.strokeText(this.text_,l,h),this.textFillState_&&o.fillText(this.text_,l,h))}}moveToLineTo_(t,e,n,s,r){const o=this.context_,a=Je(t,e,n,s,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);let l=a.length;r&&(l-=2);for(let h=2;h<l;h+=2)o.lineTo(a[h],a[h+1]);return r&&o.closePath(),n}drawRings_(t,e,n,s){for(let r=0,o=n.length;r<o;++r)e=this.moveToLineTo_(t,e,n[r],s,!0);return e}drawCircle(t){if(_t(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=function(a,l,h){const c=a.getFlatCoordinates();if(c){const u=a.getStride();return Je(c,0,c.length,u,l,h)}return null}(t,this.transform_,this.pixelCoordinates_),n=e[2]-e[0],s=e[3]-e[1],r=Math.sqrt(n*n+s*s),o=this.context_;o.beginPath(),o.arc(e[0],e[1],r,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t)}}drawFeature(t,e){const n=e.getGeometryFunction()(t);n&&_t(this.extent_,n.getExtent())&&(this.setStyle(e),this.drawGeometry(n))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let n=0,s=e.length;n<s;++n)this.drawGeometry(e[n])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(e,0,e.length,n),this.text_!==""&&this.drawText_(e,0,e.length,n)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(e,0,e.length,n),this.text_!==""&&this.drawText_(e,0,e.length,n)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),_t(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,n=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(n,0,n.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(_t(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const n=this.context_,s=t.getFlatCoordinates();let r=0;const o=t.getEnds(),a=t.getStride();n.beginPath();for(let l=0,h=o.length;l<h;++l)r=this.moveToLineTo_(s,r,o[l],a,!1);n.stroke()}if(this.text_!==""){const n=t.getFlatMidpoints();this.drawText_(n,0,n.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),_t(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),_t(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,n=t.getOrientedFlatCoordinates();let s=0;const r=t.getEndss(),o=t.getStride();e.beginPath();for(let a=0,l=r.length;a<l;++a){const h=r[a];s=this.drawRings_(n,s,h,o)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,n=this.contextFillState_;n?n.fillStyle!=t.fillStyle&&(n.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,n=this.contextStrokeState_;n?(n.lineCap!=t.lineCap&&(n.lineCap=t.lineCap,e.lineCap=t.lineCap),gi(n.lineDash,t.lineDash)||e.setLineDash(n.lineDash=t.lineDash),n.lineDashOffset!=t.lineDashOffset&&(n.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),n.lineJoin!=t.lineJoin&&(n.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),n.lineWidth!=t.lineWidth&&(n.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),n.miterLimit!=t.miterLimit&&(n.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),n.strokeStyle!=t.strokeStyle&&(n.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,n=this.contextTextState_,s=t.textAlign?t.textAlign:"center";n?(n.font!=t.font&&(n.font=t.font,e.font=t.font),n.textAlign!=s&&(n.textAlign=s,e.textAlign=s),n.textBaseline!=t.textBaseline&&(n.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=s,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:s,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(t){const n=t.getColor();this.fillState_={fillStyle:te(n||"#000")}}else this.fillState_=null;if(e){const n=e.getColor(),s=e.getLineCap(),r=e.getLineDash(),o=e.getLineDashOffset(),a=e.getLineJoin(),l=e.getWidth(),h=e.getMiterLimit(),c=r||Tn;this.strokeState_={lineCap:s!==void 0?s:"round",lineDash:this.pixelRatio_===1?c:c.map(u=>u*this.pixelRatio_),lineDashOffset:(o||0)*this.pixelRatio_,lineJoin:a!==void 0?a:"round",lineWidth:(l!==void 0?l:1)*this.pixelRatio_,miterLimit:h!==void 0?h:10,strokeStyle:te(n||"#000")}}else this.strokeState_=null}setImageStyle(t){let e;if(!t||!(e=t.getSize()))return void(this.image_=null);const n=t.getPixelRatio(this.pixelRatio_),s=t.getAnchor(),r=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=s[0]*n,this.imageAnchorY_=s[1]*n,this.imageHeight_=e[1]*n,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=r[0],this.imageOriginY_=r[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const o=t.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/n,o[1]*this.pixelRatio_/n],this.imageWidth_=e[0]*n}setTextStyle(t){if(t){const e=t.getFill();if(e){const g=e.getColor();this.textFillState_={fillStyle:te(g||"#000")}}else this.textFillState_=null;const n=t.getStroke();if(n){const g=n.getColor(),p=n.getLineCap(),f=n.getLineDash(),m=n.getLineDashOffset(),_=n.getLineJoin(),y=n.getWidth(),v=n.getMiterLimit();this.textStrokeState_={lineCap:p!==void 0?p:"round",lineDash:f||Tn,lineDashOffset:m||0,lineJoin:_!==void 0?_:"round",lineWidth:y!==void 0?y:1,miterLimit:v!==void 0?v:10,strokeStyle:te(g||"#000")}}else this.textStrokeState_=null;const s=t.getFont(),r=t.getOffsetX(),o=t.getOffsetY(),a=t.getRotateWithView(),l=t.getRotation(),h=t.getScaleArray(),c=t.getText(),u=t.getTextAlign(),d=t.getTextBaseline();this.textState_={font:s!==void 0?s:"10px sans-serif",textAlign:u!==void 0?u:"center",textBaseline:d!==void 0?d:"middle"},this.text_=c!==void 0?Array.isArray(c)?c.reduce((g,p,f)=>g+(f%2?" ":p),""):c:"",this.textOffsetX_=r!==void 0?this.pixelRatio_*r:0,this.textOffsetY_=o!==void 0?this.pixelRatio_*o:0,this.textRotateWithView_=a!==void 0&&a,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*h[0],this.pixelRatio_*h[1]]}else this.text_=""}}function fg(i,t,e,n,s,r,o){const a=wt(.5*i[0],.5*i[1]);a.imageSmoothingEnabled=!1;const l=a.canvas,h=new gg(a,.5,s,null,o),c=e.length,u=Math.floor(16777215/c),d={};for(let p=1;p<=c;++p){const f=e[p-1],m=f.getStyleFunction()||n;if(!n)continue;let _=m(f,r);if(!_)continue;Array.isArray(_)||(_=[_]);const y="#"+("000000"+(p*u).toString(16)).slice(-6);for(let v=0,x=_.length;v<x;++v){const C=_[v],E=C.getGeometryFunction()(f);if(!E||!_t(s,E.getExtent()))continue;const S=C.clone(),T=S.getFill();T&&T.setColor(y);const R=S.getStroke();R&&(R.setColor(y),R.setLineDash(null)),S.setText(void 0);const b=C.getImage();if(b&&b.getOpacity()!==0){const j=b.getImageSize();if(!j)continue;const O=wt(j[0],j[1],void 0,{alpha:!1}),A=O.canvas;O.fillStyle=y,O.fillRect(0,0,A.width,A.height),S.setImage(new Bs({img:A,imgSize:j,anchor:b.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:b.getOrigin(),opacity:1,size:b.getSize(),scale:b.getScale(),rotation:b.getRotation(),rotateWithView:b.getRotateWithView()}))}const M=S.getZIndex()||0;let P=d[M];P||(P={},d[M]=P,P.Polygon=[],P.Circle=[],P.LineString=[],P.Point=[]),P[E.getType().replace("Multi","")].push(E,S)}}const g=Object.keys(d).map(Number).sort(ai);for(let p=0,f=g.length;p<f;++p){const m=d[g[p]];for(const _ in m){const y=m[_];for(let v=0,x=y.length;v<x;v+=2){h.setStyle(y[v+1]);for(let C=0,E=t.length;C<E;++C)h.setTransform(t[C]),h.drawGeometry(y[v])}}}return a.getImageData(0,0,l.width,l.height)}function pg(i,t,e){const n=[];if(e){const s=Math.floor(.5*Math.round(i[0])),r=Math.floor(.5*Math.round(i[1])),o=4*(it(s,0,e.width-1)+it(r,0,e.height-1)*e.width),a=e.data[o],l=e.data[o+1],h=e.data[o+2]+256*(l+256*a),c=Math.floor(16777215/t.length);h&&h%c==0&&n.push(t[h/c-1])}return n}const wc={Point:function(i,t,e,n,s){const r=e.getImage(),o=e.getText();let a;if(r){if(r.getImageState()!=Yt)return;let l=i;if(s){const c=r.getDeclutterMode();if(c!=="none")if(l=s,c==="obstacle"){const u=i.getBuilder(e.getZIndex(),"Image");u.setImageStyle(r,a),u.drawPoint(t,n)}else o&&o.getText()&&(a={})}const h=l.getBuilder(e.getZIndex(),"Image");h.setImageStyle(r,a),h.drawPoint(t,n)}if(o&&o.getText()){let l=i;s&&(l=s);const h=l.getBuilder(e.getZIndex(),"Text");h.setTextStyle(o,a),h.drawText(t,n)}},LineString:function(i,t,e,n,s){const r=e.getStroke();if(r){const a=i.getBuilder(e.getZIndex(),"LineString");a.setFillStrokeStyle(null,r),a.drawLineString(t,n)}const o=e.getText();if(o&&o.getText()){const a=(s||i).getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,n)}},Polygon:function(i,t,e,n,s){const r=e.getFill(),o=e.getStroke();if(r||o){const l=i.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(r,o),l.drawPolygon(t,n)}const a=e.getText();if(a&&a.getText()){const l=(s||i).getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,n)}},MultiPoint:function(i,t,e,n,s){const r=e.getImage(),o=e.getText();let a;if(r){if(r.getImageState()!=Yt)return;let l=i;if(s){const c=r.getDeclutterMode();if(c!=="none")if(l=s,c==="obstacle"){const u=i.getBuilder(e.getZIndex(),"Image");u.setImageStyle(r,a),u.drawMultiPoint(t,n)}else o&&o.getText()&&(a={})}const h=l.getBuilder(e.getZIndex(),"Image");h.setImageStyle(r,a),h.drawMultiPoint(t,n)}if(o&&o.getText()){let l=i;s&&(l=s);const h=l.getBuilder(e.getZIndex(),"Text");h.setTextStyle(o,a),h.drawText(t,n)}},MultiLineString:function(i,t,e,n,s){const r=e.getStroke();if(r){const a=i.getBuilder(e.getZIndex(),"LineString");a.setFillStrokeStyle(null,r),a.drawMultiLineString(t,n)}const o=e.getText();if(o&&o.getText()){const a=(s||i).getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,n)}},MultiPolygon:function(i,t,e,n,s){const r=e.getFill(),o=e.getStroke();if(o||r){const l=i.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(r,o),l.drawMultiPolygon(t,n)}const a=e.getText();if(a&&a.getText()){const l=(s||i).getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,n)}},GeometryCollection:function(i,t,e,n,s){const r=t.getGeometriesArray();let o,a;for(o=0,a=r.length;o<a;++o)(0,wc[r[o].getType()])(i,r[o],e,n,s)},Circle:function(i,t,e,n,s){const r=e.getFill(),o=e.getStroke();if(r||o){const l=i.getBuilder(e.getZIndex(),"Circle");l.setFillStrokeStyle(r,o),l.drawCircle(t,n)}const a=e.getText();if(a&&a.getText()){const l=(s||i).getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,n)}}};function mg(i,t){return parseInt(Y(i),10)-parseInt(Y(t),10)}function _g(i,t){const e=ro(i,t);return e*e}function ro(i,t){return .5*i/t}function Cl(i,t,e,n,s,r,o){let a=!1;const l=e.getImage();if(l){const h=l.getImageState();h==Yt||h==Bo?l.unlistenImageChange(s):(h==js&&l.load(),l.listenImageChange(s),a=!0)}return function(h,c,u,d,g,p){const f=u.getGeometryFunction()(c);if(!f)return;const m=f.simplifyTransformed(d,g);u.getRenderer()?Sc(h,m,u,c):(0,wc[m.getType()])(h,m,u,c,p)}(i,t,e,n,r,o),a}function Sc(i,t,e,n){if(t.getType()=="GeometryCollection"){const s=t.getGeometries();for(let r=0,o=s.length;r<o;++r)Sc(i,s[r],e,n);return}i.getBuilder(e.getZIndex(),"Default").drawCustom(t,n,e.getRenderer(),e.getHitDetectionRenderer())}var wl="preload",Sl="useInterimTilesOnError";class yg extends vc{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=[1/0,1/0,-1/0,-1/0],this.wrappedRenderedExtent_=[1/0,1/0,-1/0,-1/0],this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.declutterExecutorGroup=null,this.clipping=!0,this.compositionContext_=null,this.opacity_=1}renderWorlds(t,e,n){const s=e.extent,r=e.viewState,o=r.center,a=r.resolution,l=r.projection,h=r.rotation,c=l.getExtent(),u=this.getLayer().getSource(),d=e.pixelRatio,g=e.viewHints,p=!(g[fe]||g[si]),f=this.compositionContext_,m=Math.round(e.size[0]*d),_=Math.round(e.size[1]*d),y=u.getWrapX()&&l.canWrapX(),v=y?U(c):null,x=y?Math.ceil((s[2]-c[2])/v)+1:1;let C=y?Math.floor((s[0]-c[0])/v):0;do{const E=this.getRenderTransform(o,a,h,d,m,_,C*v);t.execute(f,1,E,h,p,void 0,n)}while(++C<x)}setupCompositionContext_(){if(this.opacity_!==1){const t=wt(this.context.canvas.width,this.context.canvas.height,yl);this.compositionContext_=t}else this.compositionContext_=this.context}releaseCompositionContext_(){if(this.opacity_!==1){const t=this.context.globalAlpha;this.context.globalAlpha=this.opacity_,this.context.drawImage(this.compositionContext_.canvas,0,0),this.context.globalAlpha=t,qh(this.compositionContext_),yl.push(this.compositionContext_.canvas),this.compositionContext_=null}}renderDeclutter(t){this.declutterExecutorGroup&&(this.setupCompositionContext_(),this.renderWorlds(this.declutterExecutorGroup,t,t.declutterTree),this.releaseCompositionContext_())}renderFrame(t,e){const n=t.pixelRatio,s=t.layerStatesArray[t.layerIndex];(function(f,m,_){_d(f,m,0,0,_,0,0)})(this.pixelTransform,1/n,1/n),Po(this.inversePixelTransform,this.pixelTransform);const r=Oh(this.pixelTransform);this.useContainer(e,r,this.getBackground(t));const o=this.context,a=o.canvas,l=this.replayGroup_,h=this.declutterExecutorGroup;if((!l||l.isEmpty())&&(!h||h.isEmpty()))return null;const c=Math.round(t.size[0]*n),u=Math.round(t.size[1]*n);a.width!=c||a.height!=u?(a.width=c,a.height=u,a.style.transform!==r&&(a.style.transform=r)):this.containerReused||o.clearRect(0,0,c,u),this.preRender(o,t);const d=t.viewState;d.projection,this.opacity_=s.opacity,this.setupCompositionContext_();let g=!1,p=!0;if(s.extent&&this.clipping){const f=He(s.extent);p=_t(f,t.extent),g=p&&!Ze(f,t.extent),g&&this.clipUnrotated(this.compositionContext_,t,f)}return p&&this.renderWorlds(l,t),g&&this.compositionContext_.restore(),this.releaseCompositionContext_(),this.postRender(o,t),this.renderedRotation_!==d.rotation&&(this.renderedRotation_=d.rotation,this.hitDetectionImageData_=null),this.container}getFeatures(t){return new Promise(function(e){if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const n=[this.context.canvas.width,this.context.canvas.height];at(this.pixelTransform,n);const s=this.renderedCenter_,r=this.renderedResolution_,o=this.renderedRotation_,a=this.renderedProjection_,l=this.wrappedRenderedExtent_,h=this.getLayer(),c=[],u=.5*n[0],d=.5*n[1];c.push(this.getRenderTransform(s,r,o,.5,u,d,0).slice());const g=h.getSource(),p=a.getExtent();if(g.getWrapX()&&a.canWrapX()&&!Ze(p,l)){let f=l[0];const m=U(p);let _,y=0;for(;f<p[0];)--y,_=m*y,c.push(this.getRenderTransform(s,r,o,.5,u,d,_).slice()),f+=m;for(y=0,f=l[2];f>p[2];)++y,_=m*y,c.push(this.getRenderTransform(s,r,o,.5,u,d,_).slice()),f-=m}this.hitDetectionImageData_=fg(n,c,this.renderedFeatures_,h.getStyleFunction(),l,r,o)}e(pg(t,this.renderedFeatures_,this.hitDetectionImageData_))}.bind(this))}forEachFeatureAtCoordinate(t,e,n,s,r){if(!this.replayGroup_)return;const o=e.viewState.resolution,a=e.viewState.rotation,l=this.getLayer(),h={},c=function(g,p,f){const m=Y(g),_=h[m];if(_){if(_!==!0&&f<_.distanceSq){if(f===0)return h[m]=!0,r.splice(r.lastIndexOf(_),1),s(g,l,p);_.geometry=p,_.distanceSq=f}}else{if(f===0)return h[m]=!0,s(g,l,p);r.push(h[m]={feature:g,layer:l,geometry:p,distanceSq:f,callback:s})}};let u;const d=[this.replayGroup_];return this.declutterExecutorGroup&&d.push(this.declutterExecutorGroup),d.some(g=>u=g.forEachFeatureAtCoordinate(t,o,a,n,c,g===this.declutterExecutorGroup&&e.declutterTree?e.declutterTree.all().map(p=>p.value):null)),u}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){const e=this.getLayer(),n=e.getSource();if(!n)return!1;const s=t.viewHints[fe],r=t.viewHints[si],o=e.getUpdateWhileAnimating(),a=e.getUpdateWhileInteracting();if(this.ready&&!o&&s||!a&&r)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const l=t.extent,h=t.viewState,c=h.projection,u=h.resolution,d=t.pixelRatio,g=e.getRevision(),p=e.getRenderBuffer();let f=e.getRenderOrder();f===void 0&&(f=mg);const m=h.center.slice(),_=mo(l,p*u),y=_.slice(),v=[_.slice()],x=c.getExtent();if(n.getWrapX()&&c.canWrapX()&&!Ze(x,t.extent)){const O=U(x),A=Math.max(U(_)/2,O);_[0]=x[0]-A,_[2]=x[2]+A,fh(m,c);const L=dh(v[0],c);L[0]<x[0]&&L[2]<x[2]?v.push([L[0]+O,L[1],L[2]+O,L[3]]):L[0]>x[0]&&L[2]>x[2]&&v.push([L[0]-O,L[1],L[2]-O,L[3]])}if(this.ready&&this.renderedResolution_==u&&this.renderedRevision_==g&&this.renderedRenderOrder_==f&&Ze(this.wrappedRenderedExtent_,_))return gi(this.renderedExtent_,y)||(this.hitDetectionImageData_=null,this.renderedExtent_=y),this.renderedCenter_=m,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const C=new fl(ro(u,d),_,u,d);let E;this.getLayer().getDeclutter()&&(E=new fl(ro(u,d),_,u,d));for(let O=0,A=v.length;O<A;++O)n.loadFeatures(v[O],u,c);const S=_g(u,d);let T=!0;const R=function(O){let A;const L=O.getStyleFunction()||e.getStyleFunction();if(L&&(A=L(O,u)),A){const k=this.renderFeature(O,S,A,C,void 0,E);T=T&&!k}}.bind(this),b=Ch(_),M=n.getFeaturesInExtent(b);f&&M.sort(f);for(let O=0,A=M.length;O<A;++O)R(M[O]);this.renderedFeatures_=M,this.ready=T;const P=C.finish(),j=new _l(_,u,d,n.getOverlaps(),P,e.getRenderBuffer());return E&&(this.declutterExecutorGroup=new _l(_,u,d,n.getOverlaps(),E.finish(),e.getRenderBuffer())),this.renderedResolution_=u,this.renderedRevision_=g,this.renderedRenderOrder_=f,this.renderedExtent_=y,this.wrappedRenderedExtent_=_,this.renderedCenter_=m,this.renderedProjection_=c,this.replayGroup_=j,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,e,n,s,r,o){if(!n)return!1;let a=!1;if(Array.isArray(n))for(let l=0,h=n.length;l<h;++l)a=Cl(s,t,n[l],e,this.boundHandleStyleImageChange_,r,o)||a;else a=Cl(s,t,n,e,this.boundHandleStyleImageChange_,r,o);return a}}var Ho=class extends ig{constructor(i){super(i)}createRenderer(){return new yg(this)}},ri="add",oi="remove";const El="length";class qn extends ne{constructor(t,e,n){super(t),this.element=e,this.index=n}}class $t extends Ut{constructor(t,e){if(super(),this.on,this.once,this.un,e=e||{},this.unique_=!!e.unique,this.array_=t||[],this.unique_)for(let n=0,s=this.array_.length;n<s;++n)this.assertUnique_(this.array_[n],n);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let e=0,n=t.length;e<n;++e)this.push(t[e]);return this}forEach(t){const e=this.array_;for(let n=0,s=e.length;n<s;++n)t(e[n],n,e)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(El)}insertAt(t,e){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new qn(ri,e,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);const e=this.getLength();return this.insertAt(e,t),this.getLength()}remove(t){const e=this.array_;for(let n=0,s=e.length;n<s;++n)if(e[n]===t)return this.removeAt(n)}removeAt(t){if(t<0||t>=this.getLength())return;const e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new qn(oi,e,t)),e}setAt(t,e){if(t>=this.getLength())return void this.insertAt(t,e);if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e,t);const n=this.array_[t];this.array_[t]=e,this.dispatchEvent(new qn(oi,n,t)),this.dispatchEvent(new qn(ri,e,t))}updateLength_(){this.set(El,this.array_.length)}assertUnique_(t,e){for(let n=0,s=this.array_.length;n<s;++n)if(this.array_[n]===t&&n!==e)throw new ah(58)}}class bl{constructor(t){this.rbush_=new uc(t),this.items_={}}insert(t,e){const n={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(n),this.items_[Y(e)]=n}load(t,e){const n=new Array(e.length);for(let s=0,r=e.length;s<r;s++){const o=t[s],a=e[s],l={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:a};n[s]=l,this.items_[Y(a)]=l}this.rbush_.load(n)}remove(t){const e=Y(t),n=this.items_[e];return delete this.items_[e],this.rbush_.remove(n)!==null}update(t,e){const n=this.items_[Y(e)];_n([n.minX,n.minY,n.maxX,n.maxY],t)||(this.remove(e),this.insert(t,e))}getAll(){return this.rbush_.all().map(function(t){return t.value})}getInExtent(t){const e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map(function(n){return n.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,e){return this.forEach_(this.getInExtent(t),e)}forEach_(t,e){let n;for(let s=0,r=t.length;s<r;s++)if(n=e(t[s]),n)return n;return n}isEmpty(){return mn(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){const e=this.rbush_.toJSON();return Kt(e.minX,e.minY,e.maxX,e.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(const e in t.items_)this.items_[e]=t.items_[e]}}var Jn="addfeature",vg="changefeature",xg="clear",Tl="removefeature",Cg="featuresloadstart",wg="featuresloadend",Sg="featuresloaderror";function Eg(i,t){return[[-1/0,-1/0,1/0,1/0]]}class Ee extends ne{constructor(t,e,n){super(t),this.feature=e,this.features=n}}var Uo=class extends sc{constructor(i){super({attributions:(i=i||{}).attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:i.wrapX===void 0||i.wrapX}),this.on,this.once,this.un,this.loader_=hi,this.format_=i.format,this.overlaps_=i.overlaps===void 0||i.overlaps,this.url_=i.url,i.loader!==void 0?this.loader_=i.loader:this.url_!==void 0&&(B(this.format_,7),this.loader_=ol(this.url_,this.format_)),this.strategy_=i.strategy!==void 0?i.strategy:Eg;const t=i.useSpatialIndex===void 0||i.useSpatialIndex;let e,n;this.featuresRtree_=t?new bl:null,this.loadedExtentsRtree_=new bl,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null,Array.isArray(i.features)?n=i.features:i.features&&(e=i.features,n=e.getArray()),t||e!==void 0||(e=new $t(n)),n!==void 0&&this.addFeaturesInternal(n),e!==void 0&&this.bindFeaturesCollection_(e)}addFeature(i){this.addFeatureInternal(i),this.changed()}addFeatureInternal(i){const t=Y(i);if(!this.addToIndex_(t,i))return void(this.featuresCollection_&&this.featuresCollection_.remove(i));this.setupChangeEvents_(t,i);const e=i.getGeometry();if(e){const n=e.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(n,i)}else this.nullGeometryFeatures_[t]=i;this.dispatchEvent(new Ee(Jn,i))}setupChangeEvents_(i,t){this.featureChangeKeys_[i]=[N(t,lt,this.handleFeatureChange_,this),N(t,zi,this.handleFeatureChange_,this)]}addToIndex_(i,t){let e=!0;const n=t.getId();return n!==void 0&&(n.toString()in this.idIndex_?e=!1:this.idIndex_[n.toString()]=t),e&&(B(!(i in this.uidIndex_),30),this.uidIndex_[i]=t),e}addFeatures(i){this.addFeaturesInternal(i),this.changed()}addFeaturesInternal(i){const t=[],e=[],n=[];for(let s=0,r=i.length;s<r;s++){const o=i[s],a=Y(o);this.addToIndex_(a,o)&&e.push(o)}for(let s=0,r=e.length;s<r;s++){const o=e[s],a=Y(o);this.setupChangeEvents_(a,o);const l=o.getGeometry();if(l){const h=l.getExtent();t.push(h),n.push(o)}else this.nullGeometryFeatures_[a]=o}if(this.featuresRtree_&&this.featuresRtree_.load(t,n),this.hasListener(Jn))for(let s=0,r=e.length;s<r;s++)this.dispatchEvent(new Ee(Jn,e[s]))}bindFeaturesCollection_(i){let t=!1;this.addEventListener(Jn,function(e){t||(t=!0,i.push(e.feature),t=!1)}),this.addEventListener(Tl,function(e){t||(t=!0,i.remove(e.feature),t=!1)}),i.addEventListener(ri,function(e){t||(t=!0,this.addFeature(e.element),t=!1)}.bind(this)),i.addEventListener(oi,function(e){t||(t=!0,this.removeFeature(e.element),t=!1)}.bind(this)),this.featuresCollection_=i}clear(i){if(i){for(const e in this.featureChangeKeys_)this.featureChangeKeys_[e].forEach($);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const e=function(n){this.removeFeatureInternal(n)}.bind(this);this.featuresRtree_.forEach(e);for(const n in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[n])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const t=new Ee(xg);this.dispatchEvent(t),this.changed()}forEachFeature(i){if(this.featuresRtree_)return this.featuresRtree_.forEach(i);this.featuresCollection_&&this.featuresCollection_.forEach(i)}forEachFeatureAtCoordinateDirect(i,t){const e=[i[0],i[1],i[0],i[1]];return this.forEachFeatureInExtent(e,function(n){return n.getGeometry().intersectsCoordinate(i)?t(n):void 0})}forEachFeatureInExtent(i,t){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(i,t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureIntersectingExtent(i,t){return this.forEachFeatureInExtent(i,function(e){if(e.getGeometry().intersectsExtent(i)){const n=t(e);if(n)return n}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let i;return this.featuresCollection_?i=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(i=this.featuresRtree_.getAll(),mn(this.nullGeometryFeatures_)||_e(i,Object.values(this.nullGeometryFeatures_))),i}getFeaturesAtCoordinate(i){const t=[];return this.forEachFeatureAtCoordinateDirect(i,function(e){t.push(e)}),t}getFeaturesInExtent(i,t){if(this.featuresRtree_){if(!(t&&t.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(i);const e=function(n,s){if(s.canWrapX()){const r=s.getExtent();if(!isFinite(n[0])||!isFinite(n[2]))return[[r[0],n[1],r[2],n[3]]];dh(n,s);const o=U(r);if(U(n)>o)return[[r[0],n[1],r[2],n[3]]];if(n[0]<r[0])return[[n[0]+o,n[1],r[2],n[3]],[r[0],n[1],n[2],n[3]]];if(n[2]>r[2])return[[n[0],n[1],r[2],n[3]],[r[0],n[1],n[2]-o,n[3]]]}return[n]}(i,t);return[].concat(...e.map(n=>this.featuresRtree_.getInExtent(n)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(i,t){const e=i[0],n=i[1];let s=null;const r=[NaN,NaN];let o=1/0;const a=[-1/0,-1/0,1/0,1/0];return t=t||Bi,this.featuresRtree_.forEachInExtent(a,function(l){if(t(l)){const h=l.getGeometry(),c=o;if(o=h.closestPointXY(e,n,r,o),o<c){s=l;const u=Math.sqrt(o);a[0]=e-u,a[1]=n-u,a[2]=e+u,a[3]=n+u}}}),s}getExtent(i){return this.featuresRtree_.getExtent(i)}getFeatureById(i){const t=this.idIndex_[i.toString()];return t!==void 0?t:null}getFeatureByUid(i){const t=this.uidIndex_[i];return t!==void 0?t:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(i){const t=i.target,e=Y(t),n=t.getGeometry();if(n){const r=n.getExtent();e in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[e],this.featuresRtree_&&this.featuresRtree_.insert(r,t)):this.featuresRtree_&&this.featuresRtree_.update(r,t)}else e in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(t),this.nullGeometryFeatures_[e]=t);const s=t.getId();if(s!==void 0){const r=s.toString();this.idIndex_[r]!==t&&(this.removeFromIdIndex_(t),this.idIndex_[r]=t)}else this.removeFromIdIndex_(t),this.uidIndex_[e]=t;this.changed(),this.dispatchEvent(new Ee(vg,t))}hasFeature(i){const t=i.getId();return t!==void 0?t in this.idIndex_:Y(i)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&mn(this.nullGeometryFeatures_):!this.featuresCollection_||this.featuresCollection_.getLength()===0}loadFeatures(i,t,e){const n=this.loadedExtentsRtree_,s=this.strategy_(i,t,e);for(let r=0,o=s.length;r<o;++r){const a=s[r];n.forEachInExtent(a,function(l){return Ze(l.extent,a)})||(++this.loadingExtentsCount_,this.dispatchEvent(new Ee(Cg)),this.loader_.call(this,a,t,e,function(l){--this.loadingExtentsCount_,this.dispatchEvent(new Ee(wg,void 0,l))}.bind(this),function(){--this.loadingExtentsCount_,this.dispatchEvent(new Ee(Sg))}.bind(this)),n.insert(a,{extent:a.slice()}))}this.loading=!(this.loader_.length<4)&&this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(i){const t=this.loadedExtentsRtree_;let e;t.forEachInExtent(i,function(n){if(_n(n.extent,i))return e=n,!0}),e&&t.remove(e)}removeFeature(i){if(!i)return;const t=Y(i);t in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[t]:this.featuresRtree_&&this.featuresRtree_.remove(i),this.removeFeatureInternal(i)&&this.changed()}removeFeatureInternal(i){const t=Y(i),e=this.featureChangeKeys_[t];if(!e)return;e.forEach($),delete this.featureChangeKeys_[t];const n=i.getId();return n!==void 0&&delete this.idIndex_[n.toString()],delete this.uidIndex_[t],this.dispatchEvent(new Ee(Tl,i)),i}removeFromIdIndex_(i){let t=!1;for(const e in this.idIndex_)if(this.idIndex_[e]===i){delete this.idIndex_[e],t=!0;break}return t}setLoader(i){this.loader_=i}setUrl(i){B(this.format_,7),this.url_=i,this.setLoader(ol(i,this.format_))}};class bg extends Xs{constructor(t){t=t||{};const e=Object.assign({},t);delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.setPreload(t.preload!==void 0?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError===void 0||t.useInterimTilesOnError)}getPreload(){return this.get(wl)}setPreload(t){this.set(wl,t)}getUseInterimTilesOnError(){return this.get(Sl)}setUseInterimTilesOnError(t){this.set(Sl,t)}getData(t){return super.getData(t)}}var We=class extends bg{constructor(i){super(i)}createRenderer(){return new dg(this)}};class Ec extends Yo{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:Tg,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate===void 0||t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=t.crossOrigin!==void 0?t.crossOrigin:null,this.tileClass=t.tileClass!==void 0?t.tileClass:xc,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1}expireCache(t,e){const n=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==n?e:{});for(const s in this.tileCacheForProjection){const r=this.tileCacheForProjection[s];r.expireCache(r==n?e:{})}}getGutterForProjection(t){return this.getProjection()&&t&&!Ei(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getOpaque(t){return!(this.getProjection()&&t&&!Ei(this.getProjection(),t))&&super.getOpaque(t)}getTileGridForProjection(t){const e=this.getProjection();if(!this.tileGrid||e&&!Ei(e,t)){const n=Y(t);return n in this.tileGridForProjection||(this.tileGridForProjection[n]=rc(t)),this.tileGridForProjection[n]}return this.tileGrid}getTileCacheForProjection(t){const e=this.getProjection();if(!e||Ei(e,t))return this.tileCache;{const n=Y(t);return n in this.tileCacheForProjection||(this.tileCacheForProjection[n]=new nc(this.tileCache.highWaterMark)),this.tileCacheForProjection[n]}}createTile_(t,e,n,s,r,o){const a=[t,e,n],l=this.getTileCoordForTileUrlFunction(a,r),h=l?this.tileUrlFunction(l,s,r):void 0,c=new this.tileClass(a,h!==void 0?Wt:At,h!==void 0?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=o,c.addEventListener(lt,this.handleTileChange.bind(this)),c}getTile(t,e,n,s,r){const o=this.getProjection();if(o&&r&&!Ei(o,r)){const a=this.getTileCacheForProjection(r),l=[t,e,n];let h;const c=wh(l);a.containsKey(c)&&(h=a.get(c));const u=this.getKey();if(h&&h.key==u)return h;{const d=this.getTileGridForProjection(o),g=this.getTileGridForProjection(r),p=this.getTileCoordForTileUrlFunction(l,r),f=new so(o,d,r,g,l,p,this.getTilePixelRatio(s),this.getGutter(),function(m,_,y,v){return this.getTileInternal(m,_,y,v,o)}.bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.getInterpolate());return f.key=u,h?(f.interimTile=h,f.refreshInterimChain(),a.replace(c,f)):a.set(c,f),f}}return this.getTileInternal(t,e,n,s,o||r)}getTileInternal(t,e,n,s,r){let o=null;const a=Fs(t,e,n),l=this.getKey();if(this.tileCache.containsKey(a)){if(o=this.tileCache.get(a),o.key!=l){const h=o;o=this.createTile_(t,e,n,s,r,l),h.getState()==Wt?o.interimTile=h.interimTile:o.interimTile=h,o.refreshInterimChain(),this.tileCache.replace(a,o)}}else o=this.createTile_(t,e,n,s,r,l),this.tileCache.set(a,o);return o}setRenderReprojectionEdges(t){if(this.renderReprojectionEdges_!=t){this.renderReprojectionEdges_=t;for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}}setTileGridForProjection(t,e){const n=dt(t);if(n){const s=Y(n);s in this.tileGridForProjection||(this.tileGridForProjection[s]=e)}}clear(){super.clear();for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear()}}function Tg(i,t){i.getImage().src=t}class Ig extends Ec{constructor(t){const e=(t=t||{}).projection!==void 0?t.projection:"EPSG:3857",n=t.tileGrid!==void 0?t.tileGrid:zd({extent:Vo(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,opaque:t.opaque,projection:e,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:n,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX===void 0||t.wrapX,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0}getGutter(){return this.gutter_}}var Rg=class extends Ig{constructor(i){super({opaque:!1,projection:(i=i||{}).projection,tileGrid:i.tileGrid,wrapX:i.wrapX===void 0||i.wrapX,zDirection:i.zDirection,url:i.template||"z:{z} x:{x} y:{y}",tileLoadFunction:(t,e)=>{const n=t.getTileCoord()[0],s=xt(this.tileGrid.getTileSize(n)),r=wt(s[0],s[1]);r.strokeStyle="grey",r.strokeRect(.5,.5,s[0]+.5,s[1]+.5),r.fillStyle="grey",r.strokeStyle="white",r.textAlign="center",r.textBaseline="middle",r.font="24px sans-serif",r.lineWidth=4,r.strokeText(e,s[0]/2,s[1]/2,s[0]),r.fillText(e,s[0]/2,s[1]/2,s[0]),t.setImage(r.canvas)}})}};function Il(i,t){const e=[];Object.keys(t).forEach(function(s){t[s]!==null&&t[s]!==void 0&&e.push(s+"="+encodeURIComponent(t[s]))});const n=e.join("&");return i=i.replace(/[?&]$/,""),(i+=i.includes("?")?"&":"?")+n}var wi=class extends Ec{constructor(i){const t=i.requestEncoding!==void 0?i.requestEncoding:"KVP",e=i.tileGrid;let n=i.urls;n===void 0&&i.url!==void 0&&(n=ac(i.url)),super({attributions:i.attributions,attributionsCollapsible:i.attributionsCollapsible,cacheSize:i.cacheSize,crossOrigin:i.crossOrigin,interpolate:i.interpolate,projection:i.projection,reprojectionErrorThreshold:i.reprojectionErrorThreshold,tileClass:i.tileClass,tileGrid:e,tileLoadFunction:i.tileLoadFunction,tilePixelRatio:i.tilePixelRatio,urls:n,wrapX:i.wrapX!==void 0&&i.wrapX,transition:i.transition,zDirection:i.zDirection}),this.version_=i.version!==void 0?i.version:"1.0.0",this.format_=i.format!==void 0?i.format:"image/jpeg",this.dimensions_=i.dimensions!==void 0?i.dimensions:{},this.layer_=i.layer,this.matrixSet_=i.matrixSet,this.style_=i.style,this.requestEncoding_=t,this.setKey(this.getKeyForDimensions_()),n&&n.length>0&&(this.tileUrlFunction=eo(n.map(this.createFromWMTSTemplate.bind(this))))}setUrls(i){this.urls=i;const t=i.join(`
`);this.setTileUrlFunction(eo(i.map(this.createFromWMTSTemplate.bind(this))),t)}getDimensions(){return this.dimensions_}getFormat(){return this.format_}getLayer(){return this.layer_}getMatrixSet(){return this.matrixSet_}getRequestEncoding(){return this.requestEncoding_}getStyle(){return this.style_}getVersion(){return this.version_}getKeyForDimensions_(){let i=0;const t=[];for(const e in this.dimensions_)t[i++]=e+"-"+this.dimensions_[e];return t.join("/")}updateDimensions(i){Object.assign(this.dimensions_,i),this.setKey(this.getKeyForDimensions_())}createFromWMTSTemplate(i){const t=this.requestEncoding_,e={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};t=="KVP"&&Object.assign(e,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),i=t=="KVP"?Il(i,e):i.replace(/\{(\w+?)\}/g,function(r,o){return o.toLowerCase()in e?e[o.toLowerCase()]:r});const n=this.tileGrid,s=this.dimensions_;return function(r,o,a){if(r){const l={TileMatrix:n.getMatrixId(r[0]),TileCol:r[1],TileRow:r[2]};Object.assign(l,s);let h=i;return h=t=="KVP"?Il(h,l):h.replace(/\{(\w+?)\}/g,function(c,u){return l[u]}),h}}}};class gn{tdtKeys=[];xmap;constructor(t,e){e&&this.tdtKeys.push(...e),t&&(this.xmap=t)}setTDTKeys(t){t&&t.length>0&&this.tdtKeys.push(...t)}static addWMTSLayerByOptions(t,e,n,s){const r=Xe(),o="grid",a=n.layer;n.crossOrigin="anonymous",e.source=new wi(n);const l={lyrID:r,lyrName:n.layer,lyrType:o};e.properties?e.properties=kr(e.properties,l):e.properties=l;const h=new We(e);t.map.addLayer(h);const c={id:r,name:a,alias:s,minZoom:e.minZoom??1,maxZoom:e.maxZoom??24,visible:e.visible??!0,opacity:e.opacity??1,type:o};return t.registerLayer(h,c),h}addWMTSLayerByOptions(t,e,n){const s=Xe(),r="grid",o=e.layer;e.crossOrigin="anonymous",t.source=new wi(e);const a={lyrID:s,lyrName:e.layer,lyrType:r};t.properties?t.properties=kr(t.properties,a):t.properties=a;const l=new We(t);this.xmap.map.addLayer(l);const h={id:s,name:o,alias:n,minZoom:t.minZoom??1,maxZoom:t.maxZoom??24,visible:t.visible??!0,opacity:t.opacity??1,type:r};return this.xmap.registerLayer(l,h),l}addWMTSLayer2(t,e,n,s,r,o,a,l,h){const c=o??this.xmap.map.getView().getProjection(),u=r??Z.getTDTTileGrid(!0),d=Xe(),g="grid",p=new We({opacity:1,source:new wi({crossOrigin:"anonymous",layer:e,matrixSet:n,format:"image/png",projection:c,url:s,tileGrid:u,style:a??"default",wrapX:!0}),minZoom:l,maxZoom:h,properties:{lyrID:d,lyrName:e,lyrType:g}});this.xmap.map.addLayer(p);const f={id:d,name:e,alias:t,minZoom:l,maxZoom:h,visible:!0,opacity:1,type:g};return this.xmap.registerLayer(p,f),p}addWMTSLayer(t,e,n,s,r,o,a="KVP",l="image/png"){const h=r??this.xmap.map.getView().getProjection(),c=s??Z.getTDTTileGrid(!0),u=Xe(),d="grid",g=new We({opacity:1,source:new wi({crossOrigin:"anonymous",layer:t,matrixSet:e,format:l,projection:h,requestEncoding:a,url:n,tileGrid:c,style:o??"default",wrapX:!0}),properties:{lyrID:u,lyrName:t,lyrType:d}});this.xmap.map.addLayer(g);const p={id:u,name:t,minZoom:1,maxZoom:24,visible:!0,opacity:1,type:d};return this.xmap.registerLayer(g,p),g}static addWMTSLayerSelf(t,e,n){const s=e.prjInfo,r=Z.getProjection(s),o=e.tileSchema,a=Z.createWMTSTileGrid(o),l={minZoom:e.minlevel,maxZoom:e.maxlevel,opacity:1,visible:!0,properties:{bounds:e.bounds,center:e.center,level:e.level}},h={tileGrid:a,projection:r,layer:n,style:e.style||"default",matrixSet:o.rule,url:e.tileUrl,format:"image/png"},c=this.addWMTSLayerByOptions(t,l,h);return t.map&&e.bounds&&t.zoomToExtent(e.bounds),c}addTDTLayer(t="img_c",e){if(this.tdtKeys.length===0)throw Error("\u8BF7\u5148\u901A\u8FC7setTDTKeys\u8BBE\u7F6ETDT KEYS");if(!this.xmap||!this.xmap.map)throw Error("\u521D\u59CB\u7684XMap\u5730\u56FE\u5BF9\u8C61\u4E0D\u80FD\u4E3A\u7A7A");const n=this.xmap.map;if(t.indexOf("_")<0)return;const s=t.split("_"),r=s[0],o=s[1],a=o==="w"||o==="W",l=Z.getTDTTileGrid(a),h=a?"EPSG:3857":"EPSG:4326",c=gn.getTDTUrls(t,this.tdtKeys);let u="grid";(r==="cva"||r==="cia")&&(u="symbol");const d=Xe(),g=new We({source:new wi({crossOrigin:"anonymous",urls:c,layer:r,style:"default",matrixSet:o,format:"tiles",wrapX:!0,projection:h,tileGrid:l}),minZoom:1,maxZoom:18,properties:{center:[108.95,34.5],level:10,bounds:[-180,-90,180,90],lyrID:d,lyrName:t,lyrType:u,lyrGroup:"\u5929\u5730\u56FE"}});n.addLayer(g);const p={id:d,name:t,alias:`${e}[${t}]`,group:"\u5929\u5730\u56FE",minZoom:1,maxZoom:18,visible:!0,opacity:1,type:u};return this.xmap.registerLayer(g,p),g}static addTDTLayer(t,e,n,s){if(t.length===0)throw Error("\u8BF7\u5148\u901A\u8FC7setTDTKeys\u8BBE\u7F6ETDT KEYS");if(!e||!e.map)throw Error("\u5FC5\u987B\u4F20\u5165XMap\u5730\u56FE\u5BF9\u8C61");const r=e;if(n.indexOf("_")<0)return;const o=n.split("_"),a=o[0],l=o[1],h=l==="w"||l==="W",c=Z.getTDTTileGrid(h),u=h?"EPSG:3857":"EPSG:4326",d=gn.getTDTUrls(n,t);let g="grid";(a==="cva"||a==="cia")&&(g="symbol");const p=Xe(),f=new We({source:new wi({crossOrigin:"anonymous",urls:d,layer:a,style:"default",matrixSet:l,format:"tiles",wrapX:!0,projection:u,tileGrid:c}),minZoom:1,maxZoom:18,properties:{lyrID:p,lyrName:n,lyrType:g,lyrGroup:"\u5929\u5730\u56FE"}});return r.map.addLayer(f),f}static getTDTUrls(t,e){const n=[],s=e.length;if(s===0)return n;let r=e[0];for(let o=0;o<8;o++){s>1&&(r=e[Fu(0,s-1)]);const a=`https://t${o}.tianditu.gov.cn/${t}/wmts?tk=${r}`;n.push(a)}return n}static addWMTSDebugLayer(t,e){const n=e.getSource();return gn.addTileDebugLayer(t,n.getTileGrid(),n.getProjection())}static addTileDebugLayer(t,e,n){if(!t||!t.map)return;const s=new We({source:new Rg({projection:n,tileGrid:e}),properties:{lyrID:"debugLayer",lyrName:"debugLayer",lyrType:"grid"}});return t.map.addLayer(s),s}}class Mg extends Mo{constructor(t){super(),this.map_=t}dispatchRenderEvent(t,e){X()}calculateMatrices2D(t){const e=t.viewState,n=t.coordinateToPixelTransform,s=t.pixelToCoordinateTransform;Oe(n,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),Po(s,n)}forEachFeatureAtCoordinate(t,e,n,s,r,o,a,l){let h;const c=e.viewState;function u(x,C,E,S){return r.call(o,C,x?E:null,S)}const d=c.projection,g=fh(t.slice(),d),p=[[0,0]];if(d.canWrapX()&&s){const x=U(d.getExtent());p.push([-x,0],[x,0])}const f=e.layerStatesArray,m=f.length,_=[],y=[];for(let x=0;x<p.length;x++)for(let C=m-1;C>=0;--C){const E=f[C],S=E.layer;if(S.hasRenderer()&&Ko(E,c)&&a.call(l,S)){const T=S.getRenderer(),R=S.getSource();if(T&&R){const b=R.getWrapX()?g:t,M=u.bind(null,E.managed);y[0]=b[0]+p[x][0],y[1]=b[1]+p[x][1],h=T.forEachFeatureAtCoordinate(y,e,n,M,_)}if(h)return h}}if(_.length===0)return;const v=1/_.length;return _.forEach((x,C)=>x.distanceSq+=C*v),_.sort((x,C)=>x.distanceSq-C.distanceSq),_.some(x=>h=x.callback(x.feature,x.layer,x.geometry)),h}hasFeatureAtCoordinate(t,e,n,s,r,o){return this.forEachFeatureAtCoordinate(t,e,n,s,Bi,this,r,o)!==void 0}getMap(){return this.map_}renderFrame(t){X()}scheduleExpireIconCache(t){Es.canExpireCache()&&t.postRenderFunctions.push(Lg)}}function Lg(i,t){Es.expire()}class Pg extends Mg{constructor(t){super(t),this.fontChangeListenerKey_=N(ue,zi,t.redrawText.bind(t)),this.element_=document.createElement("div");const e=this.element_.style;e.position="absolute",e.width="100%",e.height="100%",e.zIndex="0",this.element_.className="ol-unselectable ol-layers";const n=t.getViewport();n.insertBefore(this.element_,n.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(t,e){const n=this.getMap();if(n.hasListener(t)){const s=new yc(t,void 0,e);n.dispatchEvent(s)}}disposeInternal(){$(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(t){if(!t)return void(this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1));this.calculateMatrices2D(t),this.dispatchRenderEvent(hc,t);const e=t.layerStatesArray.sort(function(o,a){return o.zIndex-a.zIndex}),n=t.viewState;this.children_.length=0;const s=[];let r=null;for(let o=0,a=e.length;o<a;++o){const l=e[o];t.layerIndex=o;const h=l.layer,c=h.getSourceState();if(!Ko(l,n)||c!="ready"&&c!="undefined"){h.unrender();continue}const u=h.render(t,r);u&&(u!==r&&(this.children_.push(u),r=u),"getDeclutter"in h&&s.push(h))}for(let o=s.length-1;o>=0;--o)s[o].renderDeclutter(t);(function(o,a){const l=o.childNodes;for(let h=0;;++h){const c=l[h],u=a[h];if(!c&&!u)break;c!==u&&(c?u?o.insertBefore(u,c):(o.removeChild(c),--h):o.appendChild(u))}})(this.element_,this.children_),this.dispatchRenderEvent(Kd,t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}}class Ie extends ne{constructor(t,e){super(t),this.layer=e}}const vr="layers";class Ni extends lc{constructor(t){t=t||{};const e=Object.assign({},t);delete e.layers;let n=t.layers;super(e),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(vr,this.handleLayersChanged_),n?Array.isArray(n)?n=new $t(n.slice(),{unique:!0}):B(typeof n.getArray=="function",43):n=new $t(void 0,{unique:!0}),this.setLayers(n)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach($),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push(N(t,ri,this.handleLayersAdd_,this),N(t,oi,this.handleLayersRemove_,this));for(const n in this.listenerKeys_)this.listenerKeys_[n].forEach($);Pn(this.listenerKeys_);const e=t.getArray();for(let n=0,s=e.length;n<s;n++){const r=e[n];this.registerLayerListeners_(r),this.dispatchEvent(new Ie("addlayer",r))}this.changed()}registerLayerListeners_(t){const e=[N(t,zi,this.handleLayerChange_,this),N(t,lt,this.handleLayerChange_,this)];t instanceof Ni&&e.push(N(t,"addlayer",this.handleLayerGroupAdd_,this),N(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[Y(t)]=e}handleLayerGroupAdd_(t){this.dispatchEvent(new Ie("addlayer",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new Ie("removelayer",t.layer))}handleLayersAdd_(t){const e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new Ie("addlayer",e)),this.changed()}handleLayersRemove_(t){const e=t.element,n=Y(e);this.listenerKeys_[n].forEach($),delete this.listenerKeys_[n],this.dispatchEvent(new Ie("removelayer",e)),this.changed()}getLayers(){return this.get(vr)}setLayers(t){const e=this.getLayers();if(e){const n=e.getArray();for(let s=0,r=n.length;s<r;++s)this.dispatchEvent(new Ie("removelayer",n[s]))}this.set(vr,t)}getLayersArray(t){return t=t!==void 0?t:[],this.getLayers().forEach(function(e){e.getLayersArray(t)}),t}getLayerStatesArray(t){const e=t!==void 0?t:[],n=e.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(e)});const s=this.getLayerState();let r=s.zIndex;t||s.zIndex!==void 0||(r=0);for(let o=n,a=e.length;o<a;o++){const l=e[o];l.opacity*=s.opacity,l.visible=l.visible&&s.visible,l.maxResolution=Math.min(l.maxResolution,s.maxResolution),l.minResolution=Math.max(l.minResolution,s.minResolution),l.minZoom=Math.max(l.minZoom,s.minZoom),l.maxZoom=Math.min(l.maxZoom,s.maxZoom),s.extent!==void 0&&(l.extent!==void 0?l.extent=ln(l.extent,s.extent):l.extent=s.extent),l.zIndex===void 0&&(l.zIndex=r)}return e}getSourceState(){return"ready"}}class Ii extends ne{constructor(t,e,n){super(t),this.map=e,this.frameState=n!==void 0?n:null}}class de extends Ii{constructor(t,e,n,s,r,o){super(t,e,r),this.originalEvent=n,this.pixel_=null,this.coordinate_=null,this.dragging=s!==void 0&&s,this.activePointers=o}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(t){this.pixel_=t}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(t){this.coordinate_=t}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}var H={SINGLECLICK:"singleclick",CLICK:Cn,DBLCLICK:hd,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},Fg="pointermove",bc="pointerdown";class kg extends As{constructor(t,e){super(t),this.map_=t,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=e===void 0?1:e,this.down_=null;const n=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=n,this.pointerdownListenerKey_=N(n,bc,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=N(n,Fg,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(Ya,this.boundHandleTouchMove_,!!Ah&&{passive:!1})}emulateClick_(t){let e=new de(H.CLICK,this.map_,t);this.dispatchEvent(e),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new de(H.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout(function(){this.clickTimeoutId_=void 0;const n=new de(H.SINGLECLICK,this.map_,t);this.dispatchEvent(n)}.bind(this),250)}updateActivePointers_(t){const e=t,n=e.pointerId;if(e.type==H.POINTERUP||e.type==H.POINTERCANCEL){delete this.trackedTouches_[n];for(const s in this.trackedTouches_)if(this.trackedTouches_[s].target!==e.target){delete this.trackedTouches_[s];break}}else e.type!=H.POINTERDOWN&&e.type!=H.POINTERMOVE||(this.trackedTouches_[n]=e);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(t){this.updateActivePointers_(t);const e=new de(H.POINTERUP,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.emulateClicks_&&!e.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach($),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(t){return t.button===0}handlePointerDown_(t){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(t);const e=new de(H.POINTERDOWN,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.down_={};for(const n in t){const s=t[n];this.down_[n]=typeof s=="function"?hi:s}if(this.dragListenerKeys_.length===0){const n=this.map_.getOwnerDocument();this.dragListenerKeys_.push(N(n,H.POINTERMOVE,this.handlePointerMove_,this),N(n,H.POINTERUP,this.handlePointerUp_,this),N(this.element_,H.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==n&&this.dragListenerKeys_.push(N(this.element_.getRootNode(),H.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(t){if(this.isMoving_(t)){this.updateActivePointers_(t),this.dragging_=!0;const e=new de(H.POINTERDRAG,this.map_,t,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(e)}}relayMoveEvent_(t){this.originalPointerMoveEvent_=t;const e=!(!this.down_||!this.isMoving_(t));this.dispatchEvent(new de(H.POINTERMOVE,this.map_,t,e))}handleTouchMove_(t){const e=this.originalPointerMoveEvent_;e&&!e.defaultPrevented||typeof t.cancelable=="boolean"&&t.cancelable!==!0||t.preventDefault()}isMoving_(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&($(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(Ya,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&($(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach($),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}var qo="postrender",Dg="movestart",Ag="moveend",Rl="loadstart",Ml="loadend",$n="layergroup",xr="size",Qn="target",tn="view";const oo=1/0;class Og extends class{constructor(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,Pn(this.queuedElements_)}dequeue(){const t=this.elements_,e=this.priorities_,n=t[0];t.length==1?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));const s=this.keyFunction_(n);return delete this.queuedElements_[s],n}enqueue(t){B(!(this.keyFunction_(t)in this.queuedElements_),31);const e=this.priorityFunction_(t);return e!=oo&&(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0)}getCount(){return this.elements_.length}getLeftChildIndex_(t){return 2*t+1}getRightChildIndex_(t){return 2*t+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return this.elements_.length===0}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){const e=this.elements_,n=this.priorities_,s=e.length,r=e[t],o=n[t],a=t;for(;t<s>>1;){const l=this.getLeftChildIndex_(t),h=this.getRightChildIndex_(t),c=h<s&&n[h]<n[l]?h:l;e[t]=e[c],n[t]=n[c],t=c}e[t]=r,n[t]=o,this.siftDown_(a,t)}siftDown_(t,e){const n=this.elements_,s=this.priorities_,r=n[e],o=s[e];for(;e>t;){const a=this.getParentIndex_(e);if(!(s[a]>o))break;n[e]=n[a],s[e]=s[a],e=a}n[e]=r,s[e]=o}reprioritize(){const t=this.priorityFunction_,e=this.elements_,n=this.priorities_;let s=0;const r=e.length;let o,a,l;for(a=0;a<r;++a)o=e[a],l=t(o),l==oo?delete this.queuedElements_[this.keyFunction_(o)]:(n[s]=l,e[s++]=o);e.length=s,n.length=s,this.heapify_()}}{constructor(t,e){super(function(n){return t.apply(null,n)},function(n){return n[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=e,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){const e=super.enqueue(t);return e&&t[0].addEventListener(lt,this.boundHandleTileChange_),e}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){const e=t.target,n=e.getState();if(n===It||n===Ht||n===At){n!==Ht&&e.removeEventListener(lt,this.boundHandleTileChange_);const s=e.getKey();s in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[s],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,e){let n,s,r,o=0;for(;this.tilesLoading_<t&&o<e&&this.getCount()>0;)s=this.dequeue()[0],r=s.getKey(),n=s.getState(),n!==Wt||r in this.tilesLoadingKeys_||(this.tilesLoadingKeys_[r]=!0,++this.tilesLoading_,++o,s.load())}}var jt={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function Ll(i,t,e){return function(n,s,r,o,a){if(!n)return;if(!s&&!t)return n;const l=t?0:r[0]*s,h=t?0:r[1]*s,c=a?a[0]:0,u=a?a[1]:0;let d=i[0]+l/2+c,g=i[2]-l/2+c,p=i[1]+h/2+u,f=i[3]-h/2+u;d>g&&(d=(g+d)/2,g=d),p>f&&(p=(f+p)/2,f=p);let m=it(n[0],d,g),_=it(n[1],p,f);if(o&&e&&s){const y=30*s;m+=-y*Math.log(1+Math.max(0,d-n[0])/y)+y*Math.log(1+Math.max(0,n[0]-g)/y),_+=-y*Math.log(1+Math.max(0,p-n[1])/y)+y*Math.log(1+Math.max(0,n[1]-f)/y)}return[m,_]}}function Gg(i){return i}function ao(i,t,e,n){const s=U(t)/e[0],r=ie(t)/e[1];return n?Math.min(i,Math.max(s,r)):Math.min(i,Math.min(s,r))}function lo(i,t,e){let n=Math.min(i,t);return n*=Math.log(1+50*Math.max(0,i/t-1))/50+1,e&&(n=Math.max(n,e),n/=Math.log(1+50*Math.max(0,e/i-1))/50+1),it(n,e/2,2*t)}function Pl(i,t,e,n,s){return e=e===void 0||e,function(r,o,a,l){if(r!==void 0){const h=n?ao(i,n,a,s):i;return e&&l?lo(r,h,t):it(r,t,h)}}}function Jo(i){return i!==void 0?0:void 0}function Fl(i){return i!==void 0?i:void 0}function ts(i,t){setTimeout(function(){i(t)},0)}function jg(i){return!(i.sourceCenter&&i.targetCenter&&!ps(i.sourceCenter,i.targetCenter))&&i.sourceResolution===i.targetResolution&&i.sourceRotation===i.targetRotation}function Cr(i,t,e,n,s){const r=Math.cos(-s);let o=Math.sin(-s),a=i[0]*r-i[1]*o,l=i[1]*r+i[0]*o;return a+=(t[0]/2-e[0])*n,l+=(e[1]-t[1]/2)*n,o=-o,[a*r-l*o,l*r+a*o]}var Te=class extends Ut{constructor(i){super(),this.on,this.once,this.un,i=Object.assign({},i),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=nr(i.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,i.projection&&function(t){Yr=!(t===void 0||t)}(),i.center&&(i.center=Nt(i.center,this.projection_)),i.extent&&(i.extent=He(i.extent,this.projection_)),this.applyOptions_(i)}applyOptions_(i){const t=Object.assign({},i);for(const o in jt)delete t[o];this.setProperties(t,!0);const e=function(o){let a,l,h,c=o.minZoom!==void 0?o.minZoom:0,u=o.maxZoom!==void 0?o.maxZoom:28;const d=o.zoomFactor!==void 0?o.zoomFactor:2,g=o.multiWorld!==void 0&&o.multiWorld,p=o.smoothResolutionConstraint===void 0||o.smoothResolutionConstraint,f=o.showFullExtent!==void 0&&o.showFullExtent,m=nr(o.projection,"EPSG:3857"),_=m.getExtent();let y=o.constrainOnlyCenter,v=o.extent;if(g||v||!m.isGlobal()||(y=!1,v=_),o.resolutions!==void 0){const x=o.resolutions;l=x[c],h=x[u]!==void 0?x[u]:x[x.length-1],a=o.constrainResolution?function(C,E,S,T){return E=E===void 0||E,function(R,b,M,P){if(R!==void 0){const j=C[0],O=C[C.length-1],A=S?ao(j,S,M,T):j;if(P)return E?lo(R,A,O):it(R,O,A);const L=Math.min(A,R),k=Math.floor(Hr(C,L,b));return C[k]>A&&k<C.length-1?C[k+1]:C[k]}}}(x,p,!y&&v,f):Pl(l,h,p,!y&&v,f)}else{const x=(_?Math.max(U(_),ie(_)):360*pn.degrees/m.getMetersPerUnit())/256/Math.pow(2,0),C=x/Math.pow(2,28-0);l=o.maxResolution,l!==void 0?c=0:l=x/Math.pow(d,c),h=o.minResolution,h===void 0&&(h=o.maxZoom!==void 0?o.maxResolution!==void 0?l/Math.pow(d,u):x/Math.pow(d,u):C),u=c+Math.floor(Math.log(l/h)/Math.log(d)),h=l/Math.pow(d,u-c),a=o.constrainResolution?function(E,S,T,R,b,M){return R=R===void 0||R,T=T!==void 0?T:0,function(P,j,O,A){if(P!==void 0){const L=b?ao(S,b,O,M):S;if(A)return R?lo(P,L,T):it(P,T,L);const k=1e-9,V=Math.ceil(Math.log(S/L)/Math.log(E)-k),q=-j*(.5-k)+.5,K=Math.min(L,P),W=Math.floor(Math.log(S/K)/Math.log(E)+q),J=Math.max(V,W);return it(S/Math.pow(E,J),T,L)}}}(d,l,h,p,!y&&v,f):Pl(l,h,p,!y&&v,f)}return{constraint:a,maxResolution:l,minResolution:h,minZoom:c,zoomFactor:d}}(i);this.maxResolution_=e.maxResolution,this.minResolution_=e.minResolution,this.zoomFactor_=e.zoomFactor,this.resolutions_=i.resolutions,this.padding_=i.padding,this.minZoom_=e.minZoom;const n=function(o){if(o.extent!==void 0){const l=o.smoothExtentConstraint===void 0||o.smoothExtentConstraint;return Ll(o.extent,o.constrainOnlyCenter,l)}const a=nr(o.projection,"EPSG:3857");if(o.multiWorld!==!0&&a.isGlobal()){const l=a.getExtent().slice();return l[0]=-1/0,l[2]=1/0,Ll(l,!1,!1)}return Gg}(i),s=e.constraint,r=function(o){if(o.enableRotation===void 0||o.enableRotation){const l=o.constrainRotation;return l===void 0||l===!0?(a=a||ii(5),function(h,c){return c?h:h!==void 0?Math.abs(h)<=a?0:h:void 0}):l===!1?Fl:typeof l=="number"?function(h){const c=2*Math.PI/h;return function(u,d){return d?u:u!==void 0?u=Math.floor(u/c+.5)*c:void 0}}(l):Fl}return Jo;var a}(i);this.constraints_={center:n,resolution:s,rotation:r},this.setRotation(i.rotation!==void 0?i.rotation:0),this.setCenterInternal(i.center!==void 0?i.center:null),i.resolution!==void 0?this.setResolution(i.resolution):i.zoom!==void 0&&this.setZoom(i.zoom)}get padding(){return this.padding_}set padding(i){let t=this.padding_;this.padding_=i;const e=this.getCenter();if(e){const n=i||[0,0,0,0];t=t||[0,0,0,0];const s=this.getResolution(),r=s/2*(n[3]-t[3]+t[1]-n[1]),o=s/2*(n[0]-t[0]+t[2]-n[2]);this.setCenterInternal([e[0]+r,e[1]-o])}}getUpdatedOptions_(i){const t=this.getProperties();return t.resolution!==void 0?t.resolution=this.getResolution():t.zoom=this.getZoom(),t.center=this.getCenterInternal(),t.rotation=this.getRotation(),Object.assign({},t,i)}animate(i){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const t=new Array(arguments.length);for(let e=0;e<t.length;++e){let n=arguments[e];n.center&&(n=Object.assign({},n),n.center=Nt(n.center,this.getProjection())),n.anchor&&(n=Object.assign({},n),n.anchor=Nt(n.anchor,this.getProjection())),t[e]=n}this.animateInternal.apply(this,t)}animateInternal(i){let t,e=arguments.length;e>1&&typeof arguments[e-1]=="function"&&(t=arguments[e-1],--e);let n=0;for(;n<e&&!this.isDef();++n){const h=arguments[n];h.center&&this.setCenterInternal(h.center),h.zoom!==void 0?this.setZoom(h.zoom):h.resolution&&this.setResolution(h.resolution),h.rotation!==void 0&&this.setRotation(h.rotation)}if(n===e)return void(t&&ts(t,!0));let s=Date.now(),r=this.targetCenter_.slice(),o=this.targetResolution_,a=this.targetRotation_;const l=[];for(;n<e;++n){const h=arguments[n],c={start:s,complete:!1,anchor:h.anchor,duration:h.duration!==void 0?h.duration:1e3,easing:h.easing||Dd,callback:t};if(h.center&&(c.sourceCenter=r,c.targetCenter=h.center.slice(),r=c.targetCenter),h.zoom!==void 0?(c.sourceResolution=o,c.targetResolution=this.getResolutionForZoom(h.zoom),o=c.targetResolution):h.resolution&&(c.sourceResolution=o,c.targetResolution=h.resolution,o=c.targetResolution),h.rotation!==void 0){c.sourceRotation=a;const u=Di(h.rotation-a+Math.PI,2*Math.PI)-Math.PI;c.targetRotation=a+u,a=c.targetRotation}jg(c)?c.complete=!0:s+=c.duration,l.push(c)}this.animations_.push(l),this.setHint(fe,1),this.updateAnimations_()}getAnimating(){return this.hints_[fe]>0}getInteracting(){return this.hints_[si]>0}cancelAnimations(){let i;this.setHint(fe,-this.hints_[fe]);for(let t=0,e=this.animations_.length;t<e;++t){const n=this.animations_[t];if(n[0].callback&&ts(n[0].callback,!1),!i)for(let s=0,r=n.length;s<r;++s){const o=n[s];if(!o.complete){i=o.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=i,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const i=Date.now();let t=!1;for(let e=this.animations_.length-1;e>=0;--e){const n=this.animations_[e];let s=!0;for(let r=0,o=n.length;r<o;++r){const a=n[r];if(a.complete)continue;const l=i-a.start;let h=a.duration>0?l/a.duration:1;h>=1?(a.complete=!0,h=1):s=!1;const c=a.easing(h);if(a.sourceCenter){const u=a.sourceCenter[0],d=a.sourceCenter[1],g=a.targetCenter[0],p=a.targetCenter[1];this.nextCenter_=a.targetCenter;const f=u+c*(g-u),m=d+c*(p-d);this.targetCenter_=[f,m]}if(a.sourceResolution&&a.targetResolution){const u=c===1?a.targetResolution:a.sourceResolution+c*(a.targetResolution-a.sourceResolution);if(a.anchor){const d=this.getViewportSize_(this.getRotation()),g=this.constraints_.resolution(u,0,d,!0);this.targetCenter_=this.calculateCenterZoom(g,a.anchor)}this.nextResolution_=a.targetResolution,this.targetResolution_=u,this.applyTargetState_(!0)}if(a.sourceRotation!==void 0&&a.targetRotation!==void 0){const u=c===1?Di(a.targetRotation+Math.PI,2*Math.PI)-Math.PI:a.sourceRotation+c*(a.targetRotation-a.sourceRotation);if(a.anchor){const d=this.constraints_.rotation(u,!0);this.targetCenter_=this.calculateCenterRotate(d,a.anchor)}this.nextRotation_=a.targetRotation,this.targetRotation_=u}if(this.applyTargetState_(!0),t=!0,!a.complete)break}if(s){this.animations_[e]=null,this.setHint(fe,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const r=n[0].callback;r&&ts(r,!0)}}this.animations_=this.animations_.filter(Boolean),t&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(i,t){let e;const n=this.getCenterInternal();var s,r;return n!==void 0&&(e=[n[0]-t[0],n[1]-t[1]],Co(e,i-this.getRotation()),r=t,(s=e)[0]+=+r[0],s[1]+=+r[1]),e}calculateCenterZoom(i,t){let e;const n=this.getCenterInternal(),s=this.getResolution();return n!==void 0&&s!==void 0&&(e=[t[0]-i*(t[0]-n[0])/s,t[1]-i*(t[1]-n[1])/s]),e}getViewportSize_(i){const t=this.viewportSize_;if(i){const e=t[0],n=t[1];return[Math.abs(e*Math.cos(i))+Math.abs(n*Math.sin(i)),Math.abs(e*Math.sin(i))+Math.abs(n*Math.cos(i))]}return t}setViewportSize(i){this.viewportSize_=Array.isArray(i)?i.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const i=this.getCenterInternal();return i&&Zr(i,this.getProjection())}getCenterInternal(){return this.get(jt.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(i){return i!==void 0?(i[0]=this.hints_[0],i[1]=this.hints_[1],i):this.hints_.slice()}calculateExtent(i){return Ch(this.calculateExtentInternal(i),this.getProjection())}calculateExtentInternal(i){i=i||this.getViewportSizeMinusPadding_();const t=this.getCenterInternal();B(t,1);const e=this.getResolution();B(e!==void 0,2);const n=this.getRotation();return B(n!==void 0,3),Wr(t,e,n,i)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(i){this.applyOptions_(this.getUpdatedOptions_({maxZoom:i}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(i){this.applyOptions_(this.getUpdatedOptions_({minZoom:i}))}setConstrainResolution(i){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:i}))}getProjection(){return this.projection_}getResolution(){return this.get(jt.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(i,t){return this.getResolutionForExtentInternal(He(i,this.getProjection()),t)}getResolutionForExtentInternal(i,t){t=t||this.getViewportSizeMinusPadding_();const e=U(i)/t[0],n=ie(i)/t[1];return Math.max(e,n)}getResolutionForValueFunction(i){i=i||2;const t=this.getConstrainedResolution(this.maxResolution_),e=this.minResolution_,n=Math.log(t/e)/Math.log(i);return function(s){return t/Math.pow(i,s*n)}}getRotation(){return this.get(jt.ROTATION)}getValueForResolutionFunction(i){const t=Math.log(i||2),e=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,s=Math.log(e/n)/t;return function(r){return Math.log(e/r)/t/s}}getViewportSizeMinusPadding_(i){let t=this.getViewportSize_(i);const e=this.padding_;return e&&(t=[t[0]-e[1]-e[3],t[1]-e[0]-e[2]]),t}getState(){const i=this.getProjection(),t=this.getResolution(),e=this.getRotation();let n=this.getCenterInternal();const s=this.padding_;if(s){const r=this.getViewportSizeMinusPadding_();n=Cr(n,this.getViewportSize_(),[r[0]/2+s[3],r[1]/2+s[0]],t,e)}return{center:n.slice(0),projection:i!==void 0?i:null,resolution:t,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:e,zoom:this.getZoom()}}getZoom(){let i;const t=this.getResolution();return t!==void 0&&(i=this.getZoomForResolution(t)),i}getZoomForResolution(i){let t,e,n=this.minZoom_||0;if(this.resolutions_){const s=Hr(this.resolutions_,i,1);n=s,t=this.resolutions_[s],e=s==this.resolutions_.length-1?2:t/this.resolutions_[s+1]}else t=this.maxResolution_,e=this.zoomFactor_;return n+Math.log(t/i)/Math.log(e)}getResolutionForZoom(i){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const t=it(Math.floor(i),0,this.resolutions_.length-2),e=this.resolutions_[t]/this.resolutions_[t+1];return this.resolutions_[t]/Math.pow(e,it(i-t,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,i-this.minZoom_)}fit(i,t){let e;if(B(Array.isArray(i)||typeof i.getSimplifiedGeometry=="function",24),Array.isArray(i))B(!vo(i),25),e=Ja(He(i,this.getProjection()));else if(i.getType()==="Circle"){const n=He(i.getExtent(),this.getProjection());e=Ja(n),e.rotate(this.getRotation(),ye(n))}else e=i;this.fitInternal(e,t)}rotatedExtentForGeometry(i){const t=this.getRotation(),e=Math.cos(t),n=Math.sin(-t),s=i.getFlatCoordinates(),r=i.getStride();let o=1/0,a=1/0,l=-1/0,h=-1/0;for(let c=0,u=s.length;c<u;c+=r){const d=s[c]*e-s[c+1]*n,g=s[c]*n+s[c+1]*e;o=Math.min(o,d),a=Math.min(a,g),l=Math.max(l,d),h=Math.max(h,g)}return[o,a,l,h]}fitInternal(i,t){let e=(t=t||{}).size;e||(e=this.getViewportSizeMinusPadding_());const n=t.padding!==void 0?t.padding:[0,0,0,0],s=t.nearest!==void 0&&t.nearest;let r;r=t.minResolution!==void 0?t.minResolution:t.maxZoom!==void 0?this.getResolutionForZoom(t.maxZoom):0;const o=this.rotatedExtentForGeometry(i);let a=this.getResolutionForExtentInternal(o,[e[0]-n[1]-n[3],e[1]-n[0]-n[2]]);a=isNaN(a)?r:Math.max(a,r),a=this.getConstrainedResolution(a,s?0:1);const l=this.getRotation(),h=Math.sin(l),c=Math.cos(l),u=ye(o);u[0]+=(n[1]-n[3])/2*a,u[1]+=(n[0]-n[2])/2*a;const d=u[0]*c-u[1]*h,g=u[1]*c+u[0]*h,p=this.getConstrainedCenter([d,g],a),f=t.callback?t.callback:hi;t.duration!==void 0?this.animateInternal({resolution:a,center:p,duration:t.duration,easing:t.easing},f):(this.targetResolution_=a,this.targetCenter_=p,this.applyTargetState_(!1,!0),ts(f,!0))}centerOn(i,t,e){this.centerOnInternal(Nt(i,this.getProjection()),t,e)}centerOnInternal(i,t,e){this.setCenterInternal(Cr(i,t,e,this.getResolution(),this.getRotation()))}calculateCenterShift(i,t,e,n){let s;const r=this.padding_;if(r&&i){const o=this.getViewportSizeMinusPadding_(-e),a=Cr(i,n,[o[0]/2+r[3],o[1]/2+r[0]],t,e);s=[i[0]-a[0],i[1]-a[1]]}return s}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(i){const t=Zr(this.targetCenter_,this.getProjection());this.setCenter([t[0]+i[0],t[1]+i[1]])}adjustCenterInternal(i){const t=this.targetCenter_;this.setCenterInternal([t[0]+i[0],t[1]+i[1]])}adjustResolution(i,t){t=t&&Nt(t,this.getProjection()),this.adjustResolutionInternal(i,t)}adjustResolutionInternal(i,t){const e=this.getAnimating()||this.getInteracting(),n=this.getViewportSize_(this.getRotation()),s=this.constraints_.resolution(this.targetResolution_*i,0,n,e);t&&(this.targetCenter_=this.calculateCenterZoom(s,t)),this.targetResolution_*=i,this.applyTargetState_()}adjustZoom(i,t){this.adjustResolution(Math.pow(this.zoomFactor_,-i),t)}adjustRotation(i,t){t&&(t=Nt(t,this.getProjection())),this.adjustRotationInternal(i,t)}adjustRotationInternal(i,t){const e=this.getAnimating()||this.getInteracting(),n=this.constraints_.rotation(this.targetRotation_+i,e);t&&(this.targetCenter_=this.calculateCenterRotate(n,t)),this.targetRotation_+=i,this.applyTargetState_()}setCenter(i){this.setCenterInternal(i&&Nt(i,this.getProjection()))}setCenterInternal(i){this.targetCenter_=i,this.applyTargetState_()}setHint(i,t){return this.hints_[i]+=t,this.changed(),this.hints_[i]}setResolution(i){this.targetResolution_=i,this.applyTargetState_()}setRotation(i){this.targetRotation_=i,this.applyTargetState_()}setZoom(i){this.setResolution(this.getResolutionForZoom(i))}applyTargetState_(i,t){const e=this.getAnimating()||this.getInteracting()||t,n=this.constraints_.rotation(this.targetRotation_,e),s=this.getViewportSize_(n),r=this.constraints_.resolution(this.targetResolution_,0,s,e),o=this.constraints_.center(this.targetCenter_,r,s,e,this.calculateCenterShift(this.targetCenter_,r,n,s));this.get(jt.ROTATION)!==n&&this.set(jt.ROTATION,n),this.get(jt.RESOLUTION)!==r&&(this.set(jt.RESOLUTION,r),this.set("zoom",this.getZoom(),!0)),o&&this.get(jt.CENTER)&&ps(this.get(jt.CENTER),o)||this.set(jt.CENTER,o),this.getAnimating()&&!i&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(i,t,e){i=i!==void 0?i:200;const n=t||0,s=this.constraints_.rotation(this.targetRotation_),r=this.getViewportSize_(s),o=this.constraints_.resolution(this.targetResolution_,n,r),a=this.constraints_.center(this.targetCenter_,o,r,!1,this.calculateCenterShift(this.targetCenter_,o,s,r));if(i===0&&!this.cancelAnchor_)return this.targetResolution_=o,this.targetRotation_=s,this.targetCenter_=a,void this.applyTargetState_();e=e||(i===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,this.getResolution()===o&&this.getRotation()===s&&this.getCenterInternal()&&ps(this.getCenterInternal(),a)||(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:s,center:a,resolution:o,duration:i,easing:Vi,anchor:e}))}beginInteraction(){this.resolveConstraints(0),this.setHint(si,1)}endInteraction(i,t,e){e=e&&Nt(e,this.getProjection()),this.endInteractionInternal(i,t,e)}endInteractionInternal(i,t,e){this.setHint(si,-1),this.resolveConstraints(i,t,e)}getConstrainedCenter(i,t){const e=this.getViewportSize_(this.getRotation());return this.constraints_.center(i,t||this.getResolution(),e)}getConstrainedZoom(i,t){const e=this.getResolutionForZoom(i);return this.getZoomForResolution(this.getConstrainedResolution(e,t))}getConstrainedResolution(i,t){t=t||0;const e=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(i,t,e)}};class $o extends Ut{constructor(t){super();const e=t.element;!e||t.target||e.style.pointerEvents||(e.style.pointerEvents="auto"),this.element=e||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){Ss(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(t){this.map_&&Ss(this.element);for(let e=0,n=this.listenerKeys.length;e<n;++e)$(this.listenerKeys[e]);this.listenerKeys.length=0,this.map_=t,t&&((this.target_?this.target_:t.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==hi&&this.listenerKeys.push(N(t,qo,this.render,this)),t.render())}render(t){}setTarget(t){this.target_=typeof t=="string"?document.getElementById(t):t}}class zg extends $o{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=t.collapsed===void 0||t.collapsed,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=t.collapsible!==void 0,this.collapsible_=t.collapsible===void 0||t.collapsible,this.collapsible_||(this.collapsed_=!1);const e=t.className!==void 0?t.className:"ol-attribution",n=t.tipLabel!==void 0?t.tipLabel:"Attributions",s=t.expandClassName!==void 0?t.expandClassName:e+"-expand",r=t.collapseLabel!==void 0?t.collapseLabel:"\u203A",o=t.collapseClassName!==void 0?t.collapseClassName:e+"-collapse";typeof r=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=r,this.collapseLabel_.className=o):this.collapseLabel_=r;const a=t.label!==void 0?t.label:"i";typeof a=="string"?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=s):this.label_=a;const l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=n,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener(Cn,this.handleClick_.bind(this),!1);const h=e+" ol-unselectable ol-control"+(this.collapsed_&&this.collapsible_?" ol-collapsed":"")+(this.collapsible_?"":" ol-uncollapsible"),c=this.element;c.className=h,c.appendChild(this.toggleButton_),c.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(t){const e={},n=[];let s=!0;const r=t.layerStatesArray;for(let o=0,a=r.length;o<a;++o){const l=r[o];if(!Ko(l,t.viewState))continue;const h=l.layer.getSource();if(!h)continue;const c=h.getAttributions();if(!c)continue;const u=c(t);if(u)if(s=s&&h.getAttributionsCollapsible()!==!1,Array.isArray(u))for(let d=0,g=u.length;d<g;++d)u[d]in e||(n.push(u[d]),e[u[d]]=!0);else u in e||(n.push(u),e[u]=!0)}return this.overrideCollapsible_||this.setCollapsible(s),n}updateElement_(t){if(!t)return void(this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1));const e=this.collectSourceAttributions_(t),n=e.length>0;if(this.renderedVisible_!=n&&(this.element.style.display=n?"":"none",this.renderedVisible_=n),!gi(e,this.renderedAttributions_)){Jh(this.ulElement_);for(let s=0,r=e.length;s<r;++s){const o=document.createElement("li");o.innerHTML=e[s],this.ulElement_.appendChild(o)}this.renderedAttributions_=e}}handleClick_(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle("ol-collapsed"),this.collapsed_?tl(this.collapseLabel_,this.label_):tl(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(t){this.userCollapsed_=t,this.collapsible_&&this.collapsed_!==t&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(t){this.updateElement_(t.frameState)}}class Bg extends $o{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target});const e=t.className!==void 0?t.className:"ol-rotate",n=t.label!==void 0?t.label:"\u21E7",s=t.compassClassName!==void 0?t.compassClassName:"ol-compass";this.label_=null,typeof n=="string"?(this.label_=document.createElement("span"),this.label_.className=s,this.label_.textContent=n):(this.label_=n,this.label_.classList.add(s));const r=t.tipLabel?t.tipLabel:"Reset rotation",o=document.createElement("button");o.className=e+"-reset",o.setAttribute("type","button"),o.title=r,o.appendChild(this.label_),o.addEventListener(Cn,this.handleClick_.bind(this),!1);const a=e+" ol-unselectable ol-control",l=this.element;l.className=a,l.appendChild(o),this.callResetNorth_=t.resetNorth?t.resetNorth:void 0,this.duration_=t.duration!==void 0?t.duration:250,this.autoHide_=t.autoHide===void 0||t.autoHide,this.rotation_=void 0,this.autoHide_&&this.element.classList.add("ol-hidden")}handleClick_(t){t.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const t=this.getMap().getView();if(!t)return;const e=t.getRotation();e!==void 0&&(this.duration_>0&&e%(2*Math.PI)!=0?t.animate({rotation:0,duration:this.duration_,easing:Vi}):t.setRotation(0))}render(t){const e=t.frameState;if(!e)return;const n=e.viewState.rotation;if(n!=this.rotation_){const s="rotate("+n+"rad)";if(this.autoHide_){const r=this.element.classList.contains("ol-hidden");r||n!==0?r&&n!==0&&this.element.classList.remove("ol-hidden"):this.element.classList.add("ol-hidden")}this.label_.style.transform=s}this.rotation_=n}}class Ng extends $o{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target});const e=t.className!==void 0?t.className:"ol-zoom",n=t.delta!==void 0?t.delta:1,s=t.zoomInClassName!==void 0?t.zoomInClassName:e+"-in",r=t.zoomOutClassName!==void 0?t.zoomOutClassName:e+"-out",o=t.zoomInLabel!==void 0?t.zoomInLabel:"+",a=t.zoomOutLabel!==void 0?t.zoomOutLabel:"\u2013",l=t.zoomInTipLabel!==void 0?t.zoomInTipLabel:"Zoom in",h=t.zoomOutTipLabel!==void 0?t.zoomOutTipLabel:"Zoom out",c=document.createElement("button");c.className=s,c.setAttribute("type","button"),c.title=l,c.appendChild(typeof o=="string"?document.createTextNode(o):o),c.addEventListener(Cn,this.handleClick_.bind(this,n),!1);const u=document.createElement("button");u.className=r,u.setAttribute("type","button"),u.title=h,u.appendChild(typeof a=="string"?document.createTextNode(a):a),u.addEventListener(Cn,this.handleClick_.bind(this,-n),!1);const d=e+" ol-unselectable ol-control",g=this.element;g.className=d,g.appendChild(c),g.appendChild(u),this.duration_=t.duration!==void 0?t.duration:250}handleClick_(t,e){e.preventDefault(),this.zoomByDelta_(t)}zoomByDelta_(t){const e=this.getMap().getView();if(!e)return;const n=e.getZoom();if(n!==void 0){const s=e.getConstrainedZoom(n+t);this.duration_>0?(e.getAnimating()&&e.cancelAnimations(),e.animate({zoom:s,duration:this.duration_,easing:Vi})):e.setZoom(s)}}}var ho="active";class kn extends Ut{constructor(t){super(),this.on,this.once,this.un,t&&t.handleEvent&&(this.handleEvent=t.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(ho)}getMap(){return this.map_}handleEvent(t){return!0}setActive(t){this.set(ho,t)}setMap(t){this.map_=t}}function Qo(i,t,e,n){const s=i.getZoom();if(s===void 0)return;const r=i.getConstrainedZoom(s+t),o=i.getResolutionForZoom(r);i.getAnimating()&&i.cancelAnimations(),i.animate({resolution:o,anchor:e,duration:n!==void 0?n:250,easing:Vi})}class Tc extends kn{constructor(t){super(),t=t||{},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:250}handleEvent(t){let e=!1;if(t.type==H.DBLCLICK){const n=t.originalEvent,s=t.map,r=t.coordinate,o=n.shiftKey?-this.delta_:this.delta_;Qo(s.getView(),o,r,this.duration_),n.preventDefault(),e=!0}return!e}}class Yi extends kn{constructor(t){super(t=t||{}),t.handleDownEvent&&(this.handleDownEvent=t.handleDownEvent),t.handleDragEvent&&(this.handleDragEvent=t.handleDragEvent),t.handleMoveEvent&&(this.handleMoveEvent=t.handleMoveEvent),t.handleUpEvent&&(this.handleUpEvent=t.handleUpEvent),t.stopDown&&(this.stopDown=t.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(t){return!1}handleDragEvent(t){}handleEvent(t){if(!t.originalEvent)return!0;let e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==H.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==H.POINTERUP){const n=this.handleUpEvent(t);this.handlingDownUpSequence=n&&this.targetPointers.length>0}}else if(t.type==H.POINTERDOWN){const n=this.handleDownEvent(t);this.handlingDownUpSequence=n,e=this.stopDown(n)}else t.type==H.POINTERMOVE&&this.handleMoveEvent(t);return!e}handleMoveEvent(t){}handleUpEvent(t){return!1}stopDown(t){return t}updateTrackedPointers_(t){t.activePointers&&(this.targetPointers=t.activePointers)}}function ta(i){const t=i.length;let e=0,n=0;for(let s=0;s<t;s++)e+=i[s].clientX,n+=i[s].clientY;return[e/t,n/t]}function co(i){const t=arguments;return function(e){let n=!0;for(let s=0,r=t.length;s<r&&(n=n&&t[s](e),n);++s);return n}}const Wg=function(i){const t=i.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},Ic=function(i){return!i.map.getTargetElement().hasAttribute("tabindex")||function(t){const e=t.map.getTargetElement(),n=t.map.getOwnerDocument().activeElement;return e.contains(n)}(i)},uo=Bi,Rc=function(i){const t=i.originalEvent;return t.button==0&&!(fd&&pd&&t.ctrlKey)},Xg=Xi,ea=function(i){const t=i.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},Mc=function(i){const t=i.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},Lc=function(i){const t=i.originalEvent,e=t.target.tagName;return e!=="INPUT"&&e!=="SELECT"&&e!=="TEXTAREA"&&!t.target.isContentEditable},wr=function(i){const t=i.originalEvent;return B(t!==void 0,56),t.pointerType=="mouse"},Vg=function(i){const t=i.originalEvent;return B(t!==void 0,56),t.isPrimary&&t.button===0};class Yg extends Yi{constructor(t){super({stopDown:Xi}),t=t||{},this.kinetic_=t.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const e=t.condition?t.condition:co(ea,Vg);this.condition_=t.onFocusOnly?co(Ic,e):e,this.noKinetic_=!1}handleDragEvent(t){this.panning_||(this.panning_=!0,this.getMap().getView().beginInteraction());const e=this.targetPointers,n=ta(e);if(e.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(n[0],n[1]),this.lastCentroid){const s=[this.lastCentroid[0]-n[0],n[1]-this.lastCentroid[1]],r=t.map.getView();(function(o,a){o[0]*=a,o[1]*=a})(s,r.getResolution()),Co(s,r.getRotation()),r.adjustCenterInternal(s)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=n,this.lastPointersCount_=e.length,t.originalEvent.preventDefault()}handleUpEvent(t){const e=t.map,n=e.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const s=this.kinetic_.getDistance(),r=this.kinetic_.getAngle(),o=n.getCenterInternal(),a=e.getPixelFromCoordinateInternal(o),l=e.getCoordinateFromPixelInternal([a[0]-s*Math.cos(r),a[1]-s*Math.sin(r)]);n.animateInternal({center:n.getConstrainedCenter(l),duration:500,easing:Vi})}return this.panning_&&(this.panning_=!1,n.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(t){if(this.targetPointers.length>0&&this.condition_(t)){const e=t.map.getView();return this.lastCentroid=null,e.getAnimating()&&e.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}class Kg extends Yi{constructor(t){t=t||{},super({stopDown:Xi}),this.condition_=t.condition?t.condition:Wg,this.lastAngle_=void 0,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){if(!wr(t))return;const e=t.map,n=e.getView();if(n.getConstraints().rotation===Jo)return;const s=e.getSize(),r=t.pixel,o=Math.atan2(s[1]/2-r[1],r[0]-s[0]/2);if(this.lastAngle_!==void 0){const a=o-this.lastAngle_;n.adjustRotationInternal(-a)}this.lastAngle_=o}handleUpEvent(t){return wr(t)?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){return wr(t)&&Rc(t)&&this.condition_(t)?(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}class Zg extends Mo{constructor(t){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+t,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const t=this.startPixel_,e=this.endPixel_,n="px",s=this.element_.style;s.left=Math.min(t[0],e[0])+n,s.top=Math.min(t[1],e[1])+n,s.width=Math.abs(e[0]-t[0])+n,s.height=Math.abs(e[1]-t[1])+n}setMap(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const e=this.element_.style;e.left="inherit",e.top="inherit",e.width="inherit",e.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){const t=this.startPixel_,e=this.endPixel_,n=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);n[4]=n[0].slice(),this.geometry_?this.geometry_.setCoordinates([n]):this.geometry_=new Zt([n])}getGeometry(){return this.geometry_}}const Hg="boxstart",Ug="boxdrag",qg="boxend",Jg="boxcancel";class Sr extends ne{constructor(t,e,n){super(t),this.coordinate=e,this.mapBrowserEvent=n}}class $g extends Yi{constructor(t){super(),this.on,this.once,this.un,t=t||{},this.box_=new Zg(t.className||"ol-dragbox"),this.minArea_=t.minArea!==void 0?t.minArea:64,t.onBoxEnd&&(this.onBoxEnd=t.onBoxEnd),this.startPixel_=null,this.condition_=t.condition?t.condition:Rc,this.boxEndCondition_=t.boxEndCondition?t.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(t,e,n){const s=n[0]-e[0],r=n[1]-e[1];return s*s+r*r>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(t){this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new Sr(Ug,t.coordinate,t))}handleUpEvent(t){this.box_.setMap(null);const e=this.boxEndCondition_(t,this.startPixel_,t.pixel);return e&&this.onBoxEnd(t),this.dispatchEvent(new Sr(e?qg:Jg,t.coordinate,t)),!1}handleDownEvent(t){return!!this.condition_(t)&&(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new Sr(Hg,t.coordinate,t)),!0)}onBoxEnd(t){}}class Qg extends $g{constructor(t){super({condition:(t=t||{}).condition?t.condition:Mc,className:t.className||"ol-dragzoom",minArea:t.minArea}),this.duration_=t.duration!==void 0?t.duration:200,this.out_=t.out!==void 0&&t.out}onBoxEnd(t){const e=this.getMap().getView();let n=this.getGeometry();if(this.out_){const s=e.rotatedExtentForGeometry(n),r=e.getResolutionForExtentInternal(s),o=e.getResolution()/r;n=n.clone(),n.scale(o*o)}e.fitInternal(n,{duration:this.duration_,easing:Vi})}}var kl=37,tf=38,Dl=39,Al=40;class ef extends kn{constructor(t){super(),t=t||{},this.defaultCondition_=function(e){return ea(e)&&Lc(e)},this.condition_=t.condition!==void 0?t.condition:this.defaultCondition_,this.duration_=t.duration!==void 0?t.duration:100,this.pixelDelta_=t.pixelDelta!==void 0?t.pixelDelta:128}handleEvent(t){let e=!1;if(t.type==ys){const n=t.originalEvent,s=n.keyCode;if(this.condition_(t)&&(s==Al||s==kl||s==Dl||s==tf)){const r=t.map.getView(),o=r.getResolution()*this.pixelDelta_;let a=0,l=0;s==Al?l=-o:s==kl?a=-o:s==Dl?a=o:l=o;const h=[a,l];Co(h,r.getRotation()),function(c,u,d){const g=c.getCenterInternal();if(g){const p=[g[0]+u[0],g[1]+u[1]];c.animateInternal({duration:d!==void 0?d:250,easing:Ad,center:c.getConstrainedCenter(p)})}}(r,h,this.duration_),n.preventDefault(),e=!0}}return!e}}class nf extends kn{constructor(t){super(),t=t||{},this.condition_=t.condition?t.condition:Lc,this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:100}handleEvent(t){let e=!1;if(t.type==ys||t.type==kh){const n=t.originalEvent,s=n.charCode;if(this.condition_(t)&&(s=="+".charCodeAt(0)||s=="-".charCodeAt(0))){const r=t.map,o=s=="+".charCodeAt(0)?this.delta_:-this.delta_;Qo(r.getView(),o,void 0,this.duration_),n.preventDefault(),e=!0}}return!e}}class sf{constructor(t,e,n){this.decay_=t,this.minVelocity_=e,this.delay_=n,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(t,e){this.points_.push(t,e,Date.now())}end(){if(this.points_.length<6)return!1;const t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;let n=e-3;for(;n>0&&this.points_[n+2]>t;)n-=3;const s=this.points_[e+2]-this.points_[n+2];if(s<1e3/60)return!1;const r=this.points_[e]-this.points_[n],o=this.points_[e+1]-this.points_[n+1];return this.angle_=Math.atan2(o,r),this.initialVelocity_=Math.sqrt(r*r+o*o)/s,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}class rf extends kn{constructor(t){super(t=t||{}),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=t.maxDelta!==void 0?t.maxDelta:1,this.duration_=t.duration!==void 0?t.duration:250,this.timeout_=t.timeout!==void 0?t.timeout:80,this.useAnchor_=t.useAnchor===void 0||t.useAnchor,this.constrainResolution_=t.constrainResolution!==void 0&&t.constrainResolution;const e=t.condition?t.condition:uo;this.condition_=t.onFocusOnly?co(Ic,e):e,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const t=this.getMap();!t||t.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(t){if(!this.condition_(t)||t.type!==hn)return!0;const e=t.map,n=t.originalEvent;let s;if(n.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.coordinate),t.type==hn&&(s=n.deltaY,gd&&n.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(s/=Dh),n.deltaMode===WheelEvent.DOM_DELTA_LINE&&(s*=40)),s===0)return!1;this.lastDelta_=s;const r=Date.now();this.startTime_===void 0&&(this.startTime_=r),(!this.mode_||r-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(s)<4?"trackpad":"wheel");const o=e.getView();if(this.mode_==="trackpad"&&!o.getConstrainResolution()&&!this.constrainResolution_)return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(o.getAnimating()&&o.cancelAnimations(),o.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),o.adjustZoom(-s/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=r,!1;this.totalDelta_+=s;const a=Math.max(this.timeout_-(r-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,e),a),!1}handleWheelZoom_(t){const e=t.getView();e.getAnimating()&&e.cancelAnimations();let n=-it(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(e.getConstrainResolution()||this.constrainResolution_)&&(n=n?n>0?1:-1:0),Qo(e,n,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(t){this.useAnchor_=t,t||(this.lastAnchor_=null)}}class of extends Yi{constructor(t){const e=t=t||{};e.stopDown||(e.stopDown=Xi),super(e),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=t.threshold!==void 0?t.threshold:.3,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){let e=0;const n=this.targetPointers[0],s=this.targetPointers[1],r=Math.atan2(s.clientY-n.clientY,s.clientX-n.clientX);if(this.lastAngle_!==void 0){const c=r-this.lastAngle_;this.rotationDelta_+=c,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=c}this.lastAngle_=r;const o=t.map,a=o.getView();if(a.getConstraints().rotation===Jo)return;const l=o.getViewport().getBoundingClientRect(),h=ta(this.targetPointers);h[0]-=l.left,h[1]-=l.top,this.anchor_=o.getCoordinateFromPixelInternal(h),this.rotating_&&(o.render(),a.adjustRotationInternal(e,this.anchor_))}handleUpEvent(t){return this.targetPointers.length<2?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}}class af extends Yi{constructor(t){const e=t=t||{};e.stopDown||(e.stopDown=Xi),super(e),this.anchor_=null,this.duration_=t.duration!==void 0?t.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(t){let e=1;const n=this.targetPointers[0],s=this.targetPointers[1],r=n.clientX-s.clientX,o=n.clientY-s.clientY,a=Math.sqrt(r*r+o*o);this.lastDistance_!==void 0&&(e=this.lastDistance_/a),this.lastDistance_=a;const l=t.map,h=l.getView();e!=1&&(this.lastScaleDelta_=e);const c=l.getViewport().getBoundingClientRect(),u=ta(this.targetPointers);u[0]-=c.left,u[1]-=c.top,this.anchor_=l.getCoordinateFromPixelInternal(u),l.render(),h.adjustResolutionInternal(e,this.anchor_)}handleUpEvent(t){if(this.targetPointers.length<2){const e=t.map.getView(),n=this.lastScaleDelta_>1?1:-1;return e.endInteraction(this.duration_,n),!1}return!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}}function Pc(i){i instanceof Xs?i.setMapInternal(null):i instanceof Ni&&i.getLayers().forEach(Pc)}function Fc(i,t){if(i instanceof Xs)i.setMapInternal(t);else if(i instanceof Ni){const e=i.getLayers().getArray();for(let n=0,s=e.length;n<s;++n)Fc(e[n],t)}}var lf=class extends Ut{constructor(i){super(),i=i||{},this.on,this.once,this.un;const t=function(n){let s=null;n.keyboardEventTarget!==void 0&&(s=typeof n.keyboardEventTarget=="string"?document.getElementById(n.keyboardEventTarget):n.keyboardEventTarget);const r={},o=n.layers&&typeof n.layers.getLayers=="function"?n.layers:new Ni({layers:n.layers});let a,l,h;return r[$n]=o,r[Qn]=n.target,r[tn]=n.view instanceof Te?n.view:new Te,n.controls!==void 0&&(Array.isArray(n.controls)?a=new $t(n.controls.slice()):(B(typeof n.controls.getArray=="function",47),a=n.controls)),n.interactions!==void 0&&(Array.isArray(n.interactions)?l=new $t(n.interactions.slice()):(B(typeof n.interactions.getArray=="function",48),l=n.interactions)),n.overlays!==void 0?Array.isArray(n.overlays)?h=new $t(n.overlays.slice()):(B(typeof n.overlays.getArray=="function",49),h=n.overlays):h=new $t,{controls:a,interactions:l,keyboardEventTarget:s,overlays:h,values:r}}(i);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=i.maxTilesLoading!==void 0?i.maxTilesLoading:16,this.pixelRatio_=i.pixelRatio!==void 0?i.pixelRatio:Dh,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=[1,0,0,1,0,0],this.pixelToCoordinateTransform_=[1,0,0,1,0,0],this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=i.moveTolerance,this.keyboardEventTarget_=t.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.controls=t.controls||function(n){n=n||{};const s=new $t;return(n.zoom===void 0||n.zoom)&&s.push(new Ng(n.zoomOptions)),(n.rotate===void 0||n.rotate)&&s.push(new Bg(n.rotateOptions)),(n.attribution===void 0||n.attribution)&&s.push(new zg(n.attributionOptions)),s}(),this.interactions=t.interactions||function(n){n=n||{};const s=new $t,r=new sf(-.005,.05,100);return(n.altShiftDragRotate===void 0||n.altShiftDragRotate)&&s.push(new Kg),(n.doubleClickZoom===void 0||n.doubleClickZoom)&&s.push(new Tc({delta:n.zoomDelta,duration:n.zoomDuration})),(n.dragPan===void 0||n.dragPan)&&s.push(new Yg({onFocusOnly:n.onFocusOnly,kinetic:r})),(n.pinchRotate===void 0||n.pinchRotate)&&s.push(new of),(n.pinchZoom===void 0||n.pinchZoom)&&s.push(new af({duration:n.zoomDuration})),(n.keyboard===void 0||n.keyboard)&&(s.push(new ef),s.push(new nf({delta:n.zoomDelta,duration:n.zoomDuration}))),(n.mouseWheelZoom===void 0||n.mouseWheelZoom)&&s.push(new rf({onFocusOnly:n.onFocusOnly,duration:n.zoomDuration})),(n.shiftDragZoom===void 0||n.shiftDragZoom)&&s.push(new Qg({duration:n.zoomDuration})),s}({onFocusOnly:!0}),this.overlays_=t.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new Og(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener($n,this.handleLayerGroupChanged_),this.addChangeListener(tn,this.handleViewChanged_),this.addChangeListener(xr,this.handleSizeChanged_),this.addChangeListener(Qn,this.handleTargetChanged_),this.setProperties(t.values);const e=this;!i.view||i.view instanceof Te||i.view.then(function(n){e.setView(new Te(n))}),this.controls.addEventListener(ri,function(n){n.element.setMap(this)}.bind(this)),this.controls.addEventListener(oi,function(n){n.element.setMap(null)}.bind(this)),this.interactions.addEventListener(ri,function(n){n.element.setMap(this)}.bind(this)),this.interactions.addEventListener(oi,function(n){n.element.setMap(null)}.bind(this)),this.overlays_.addEventListener(ri,function(n){this.addOverlayInternal_(n.element)}.bind(this)),this.overlays_.addEventListener(oi,function(n){const s=n.element.getId();s!==void 0&&delete this.overlayIdIndex_[s.toString()],n.element.setMap(null)}.bind(this)),this.controls.forEach(function(n){n.setMap(this)}.bind(this)),this.interactions.forEach(function(n){n.setMap(this)}.bind(this)),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(i){this.getControls().push(i)}addInteraction(i){this.getInteractions().push(i)}addLayer(i){this.getLayerGroup().getLayers().push(i)}handleLayerAdd_(i){Fc(i.layer,this)}addOverlay(i){this.getOverlays().push(i)}addOverlayInternal_(i){const t=i.getId();t!==void 0&&(this.overlayIdIndex_[t.toString()]=i),i.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(i,t,e){if(!this.frameState_||!this.renderer_)return;const n=this.getCoordinateFromPixelInternal(i),s=(e=e!==void 0?e:{}).hitTolerance!==void 0?e.hitTolerance:0,r=e.layerFilter!==void 0?e.layerFilter:Bi,o=e.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(n,this.frameState_,s,o,t,null,r,null)}getFeaturesAtPixel(i,t){const e=[];return this.forEachFeatureAtPixel(i,function(n){e.push(n)},t),e}getAllLayers(){const i=[];return function t(e){e.forEach(function(n){n instanceof Ni?t(n.getLayers()):i.push(n)})}(this.getLayers()),i}hasFeatureAtPixel(i,t){if(!this.frameState_||!this.renderer_)return!1;const e=this.getCoordinateFromPixelInternal(i),n=(t=t!==void 0?t:{}).layerFilter!==void 0?t.layerFilter:Bi,s=t.hitTolerance!==void 0?t.hitTolerance:0,r=t.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(e,this.frameState_,s,r,n,null)}getEventCoordinate(i){return this.getCoordinateFromPixel(this.getEventPixel(i))}getEventCoordinateInternal(i){return this.getCoordinateFromPixelInternal(this.getEventPixel(i))}getEventPixel(i){const t=this.viewport_.getBoundingClientRect(),e="changedTouches"in i?i.changedTouches[0]:i;return[e.clientX-t.left,e.clientY-t.top]}getTarget(){return this.get(Qn)}getTargetElement(){const i=this.getTarget();return i!==void 0?typeof i=="string"?document.getElementById(i):i:null}getCoordinateFromPixel(i){return Zr(this.getCoordinateFromPixelInternal(i),this.getView().getProjection())}getCoordinateFromPixelInternal(i){const t=this.frameState_;return t?at(t.pixelToCoordinateTransform,i.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(i){const t=this.overlayIdIndex_[i.toString()];return t!==void 0?t:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get($n)}setLayers(i){const t=this.getLayerGroup();if(i instanceof $t)return void t.setLayers(i);const e=t.getLayers();e.clear(),e.extend(i)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const i=this.getLayerGroup().getLayerStatesArray();for(let t=0,e=i.length;t<e;++t){const n=i[t];if(!n.visible)continue;const s=n.layer.getRenderer();if(s&&!s.ready)return!0;const r=n.layer.getSource();if(r&&r.loading)return!0}return!1}getPixelFromCoordinate(i){const t=Nt(i,this.getView().getProjection());return this.getPixelFromCoordinateInternal(t)}getPixelFromCoordinateInternal(i){const t=this.frameState_;return t?at(t.coordinateToPixelTransform,i.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(xr)}getView(){return this.get(tn)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const i=this.getTargetElement();return i?i.ownerDocument:document}getTilePriority(i,t,e,n){return function(s,r,o,a,l){if(!s||!(o in s.wantedTiles)||!s.wantedTiles[o][r.getKey()])return oo;const h=s.viewState.center,c=a[0]-h[0],u=a[1]-h[1];return 65536*Math.log(l)+Math.sqrt(c*c+u*u)/l}(this.frameState_,i,t,e,n)}handleBrowserEvent(i,t){t=t||i.type;const e=new de(t,this,i);this.handleMapBrowserEvent(e)}handleMapBrowserEvent(i){if(!this.frameState_)return;const t=i.originalEvent,e=t.type;if(e===bc||e===hn||e===ys){const n=this.getOwnerDocument(),s=this.viewport_.getRootNode?this.viewport_.getRootNode():n,r=t.target;if(this.overlayContainerStopEvent_.contains(r)||!(s===n?n.documentElement:s).contains(r))return}if(i.frameState=this.frameState_,this.dispatchEvent(i)!==!1){const n=this.getInteractions().getArray().slice();for(let s=n.length-1;s>=0;s--){const r=n[s];if(!(r.getMap()!==this||!r.getActive()||!this.getTargetElement())&&(!r.handleEvent(i)||i.propagationStopped))break}}}handlePostRender(){const i=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){let n=this.maxTilesLoading_,s=n;if(i){const r=i.viewHints;if(r[fe]||r[si]){const o=Date.now()-i.time>8;n=o?0:8,s=o?0:2}}t.getTilesLoading()<n&&(t.reprioritize(),t.loadMoreTiles(n,s))}i&&this.renderer_&&!i.animate&&(this.renderComplete_===!0?(this.hasListener(dr)&&this.renderer_.dispatchRenderEvent(dr,i),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new Ii(Ml,this,i)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new Ii(Rl,this,i))));const e=this.postRenderFunctions_;for(let n=0,s=e.length;n<s;++n)e[n](this,i);e.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let t=0,e=this.targetChangeHandlerKeys_.length;t<e;++t)$(this.targetChangeHandlerKeys_[t]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(Ur,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(hn,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,Ss(this.viewport_)}const i=this.getTargetElement();if(i){i.appendChild(this.viewport_),this.renderer_||(this.renderer_=new Pg(this)),this.mapBrowserEventHandler_=new kg(this,this.moveTolerance_);for(const n in H)this.mapBrowserEventHandler_.addEventListener(H[n],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(Ur,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(hn,this.boundHandleBrowserEvent_,!!Ah&&{passive:!1});const t=this.getOwnerDocument().defaultView,e=this.keyboardEventTarget_?this.keyboardEventTarget_:i;this.targetChangeHandlerKeys_=[N(e,ys,this.handleBrowserEvent,this),N(e,kh,this.handleBrowserEvent,this),N(t,ud,this.updateSize,this)]}else this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&($(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&($(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const i=this.getView();i&&(this.updateViewportSize_(),this.viewPropertyListenerKey_=N(i,zi,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=N(i,lt,this.handleViewPropertyChanged_,this),i.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach($),this.layerGroupPropertyListenerKeys_=null);const i=this.getLayerGroup();i&&(this.handleLayerAdd_(new Ie("addlayer",i)),this.layerGroupPropertyListenerKeys_=[N(i,zi,this.render,this),N(i,lt,this.render,this),N(i,"addlayer",this.handleLayerAdd_,this),N(i,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const i=this.getLayerGroup().getLayerStatesArray();for(let t=0,e=i.length;t<e;++t){const n=i[t].layer;n.hasRenderer()&&n.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(i){return this.getControls().remove(i)}removeInteraction(i){return this.getInteractions().remove(i)}removeLayer(i){return this.getLayerGroup().getLayers().remove(i)}handleLayerRemove_(i){Pc(i.layer)}removeOverlay(i){return this.getOverlays().remove(i)}renderFrame_(i){const t=this.getSize(),e=this.getView(),n=this.frameState_;let s=null;if(t!==void 0&&za(t)&&e&&e.isDef()){const r=e.getHints(this.frameState_?this.frameState_.viewHints:void 0),o=e.getState();if(s={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:Wr(o.center,o.resolution,o.rotation,t),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:t,tileQueue:this.tileQueue_,time:i,usedTiles:{},viewState:o,viewHints:r,wantedTiles:{},mapId:Y(this),renderTargets:{}},o.nextCenter&&o.nextResolution){const a=isNaN(o.nextRotation)?o.rotation:o.nextRotation;s.nextExtent=Wr(o.nextCenter,o.nextResolution,a,t)}}this.frameState_=s,this.renderer_.renderFrame(s),s&&(s.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,s.postRenderFunctions),n&&(!this.previousExtent_||!vo(this.previousExtent_)&&!_n(s.extent,this.previousExtent_))&&(this.dispatchEvent(new Ii(Dg,this,n)),this.previousExtent_=Fn(this.previousExtent_)),this.previousExtent_&&!s.viewHints[fe]&&!s.viewHints[si]&&!_n(s.extent,this.previousExtent_)&&(this.dispatchEvent(new Ii(Ag,this,s)),lh(s.extent,this.previousExtent_))),this.dispatchEvent(new Ii(qo,this,s)),this.renderComplete_=this.hasListener(Rl)||this.hasListener(Ml)||this.hasListener(dr)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(i){const t=this.getLayerGroup();t&&this.handleLayerRemove_(new Ie("removelayer",t)),this.set($n,i)}setSize(i){this.set(xr,i)}setTarget(i){this.set(Qn,i)}setView(i){if(!i||i instanceof Te)return void this.set(tn,i);this.set(tn,new Te);const t=this;i.then(function(e){t.setView(new Te(e))})}updateSize(){const i=this.getTargetElement();let t;if(i){const e=getComputedStyle(i),n=i.offsetWidth-parseFloat(e.borderLeftWidth)-parseFloat(e.paddingLeft)-parseFloat(e.paddingRight)-parseFloat(e.borderRightWidth),s=i.offsetHeight-parseFloat(e.borderTopWidth)-parseFloat(e.paddingTop)-parseFloat(e.paddingBottom)-parseFloat(e.borderBottomWidth);isNaN(n)||isNaN(s)||(t=[n,s],!za(t)&&(i.offsetWidth||i.offsetHeight||i.getClientRects().length)&&console.warn("No map visible because the map container's width or height are 0."))}this.setSize(t),this.updateViewportSize_()}updateViewportSize_(){const i=this.getView();if(i){let t;const e=getComputedStyle(this.viewport_);e.width&&e.height&&(t=[parseInt(e.width,10),parseInt(e.height,10)]),i.setViewportSize(t)}}};class ia{target;map;mapEventBus=Jl;isMainSync=!1;mapGroup="map";layerManager;isInitSuccess=!1;constructor(t="map",e="map",n=!1){this.target=t,this.mapGroup=e,document.getElementById(t)&&(this.isInitSuccess=!0),this.map=new lf({target:this.isInitSuccess?this.target:void 0}),this.map.on("moveend",this.onMoveEnd.bind(this)),n&&(this.layerManager=new ad(this.map,this.target))}get LayerManager(){return this.layerManager}initMapView(t){this.isInitSuccess||this.map.setTarget(this.target);const e=new Te(t);return this.setView(e),e}dispose(){this.layerManager&&(this.layerManager.clearLayers(),this.layerManager=void 0),this.map?.dispose(),this.map=void 0}setView(t){const e=this.map.getView();e&&e.un("change:resolution",this.onResolutionChanged.bind(this)),t&&(this.map.setView(t),t.on("change:resolution",this.onResolutionChanged.bind(this)))}get MapView(){return this.map.getView()}registerLayer(t,e){this.layerManager&&this.layerManager.registerLayer(t,e)}zoomToExtent(t){const e=this.MapView,n=e?.getProjection();if(n){const s=Z.getExtentFrom4326(t,n),r=e.getResolutionForExtent(s,this.map.getSize());e.setResolution(r);const o=ye(s);e.setCenter(o)}}newEvtArgs(t,e=null){const n=new po(this.target,this.mapGroup);return n.data=t,n.target=e,n}enableMapSyncView(){this.mapEventBus.eventOn(et.MAP_SYNC_VIEW,this.mapSyncView.bind(this)),this.mapEventBus.eventOn(et.MAP_SYNC_VIEW_END,this.mapSyncViewEnd.bind(this))}disableMapSyncView(){this.mapEventBus.eventOff(et.MAP_SYNC_VIEW,this.mapSyncView.bind(this)),this.mapEventBus.eventOff(et.MAP_SYNC_VIEW_END,this.mapSyncViewEnd.bind(this))}mapSyncView(t){if(t.mapGroup===this.mapGroup&&t.mapID!=this.target){const{zoom:e,x:n,y:s}=t.data;this.isMainSync=!0,this.map.un("moveend",this.onMoveEnd.bind(this));const r=this.map.getView();r.setZoom(e),r.setCenter([n,s]),setTimeout(()=>{const o=this.newEvtArgs();this.mapEventBus.eventEmit(et.MAP_SYNC_VIEW_END,o)},200)}}mapSyncViewEnd(t){t.mapGroup===this.mapGroup&&(t.mapID!=this.target?this.isMainSync=!1:(this.isMainSync=!1,this.map.on("moveend",this.onMoveEnd.bind(this))))}onMoveEnd(t){if(!this.isMainSync){this.isMainSync=!0;const e=t.map.getView(),n=e.getZoom(),[s,r]=e.getCenter(),o=this.newEvtArgs({zoom:n,x:s,y:r},null);this.mapEventBus.eventEmit(et.MAP_SYNC_VIEW,o)}}onResolutionChanged(t){const e=this.map.getView();if(e){let n=e.getZoom();const s=this.newEvtArgs(n,null);this.mapEventBus.eventEmit(et.MAP_ZOOM_CHANGED,s)}}}var go=ve({name:"myOLMap",components:{},props:{mapid:xn().def("map"),mapgroup:xn().def("map"),hasLayerManager:Ds().def(!1),initTDTLayers:us().def(["img_w","cia_w"]),TDTKeys:us().def(["a90b856f2ade4b97f683cbc9c3c2702e","3566b0e50b26951da109cfea07e583c4","4ed383c68a325d012da2f0195b9609fe"]),viewProjection:Ro([String,ei,Object]).def("EPSG:3857"),defaultCenter:us().def([108.95,34.5]),viewOptions:Fh(),digits:_s().def(4)},emits:["mapInited","mouseCoordChanged"],setup(i,{emit:t}){const e=i.digits,n=Is({epsgInfo:"",zoomInfo:"",centerInfo:"",positionInfo:""}),s=i.mapid,r=gt(i.mapid),o=gt(i.mapid+"_Container"),a=i.mapgroup;let l,h,c=i.viewProjection;function u(f){l=i.viewOptions??{projection:f,center:Z.fromLonLat(i.defaultCenter,f),zoom:3},sh(f)?n.epsgInfo=f:n.epsgInfo=f.getCode(),!l.center&&i.defaultCenter&&(l.center=Z.fromLonLat(i.defaultCenter,l.projection));const m=er(l.center,e);n.centerInfo=`\u4E2D\u5FC3\u70B9:${m} `,h&&(h.dispose(),h=void 0),h=new ia(s,a,i.hasLayerManager),i.hasLayerManager&&eu(h.mapEventBus,s,a)}function d(){if(h){const f=h.map?.getView();if(f){n.epsgInfo=f.getProjection().getCode();const m=f.getZoom()?.toFixed(1);n.zoomInfo=`\u7EA7\u522B:${m} `;let _=f.getCenter();if(_){const y=f.getProjection();_=Z.toLonLat(_,y);const v=er(_,e);n.centerInfo=`\u4E2D\u5FC3\u70B9:${v} `}}}}function g(f){if(n.zoomInfo===""&&d(),h){const m=h.map.getView();if(m){const _=m.getProjection();let y=f.coordinate;t("mouseCoordChanged",y),_.getUnits()!="degrees"&&(y=Z.toLonLat(y,_));const v=er(y,e);n.positionInfo=`\u9F20\u6807\u4F4D\u7F6E:${v}`}}}function p(){let f;if(h.initMapView(l),i.initTDTLayers){const m=i.initTDTLayers;if(m&&m.length>0){const _=i.TDTKeys;f=new gn(h,_),m.forEach(y=>{const v=function(x){let C="";switch(x){case"vec_c":case"vec_w":case"img_c":case"img_w":C="\u77E2\u91CF";break;case"cva_c":case"cva_w":C="\u77E2\u91CF\u6CE8\u8BB0";break;case"cia_c":case"cia_w":C="\u5F71\u50CF\u6CE8\u8BB0";break;case"ter_c":case"ter_w":C="\u5730\u5F62";break;case"cta_c":case"cta_w":C="\u5730\u5F62\u6CE8\u8BB0"}return C}(y.toLocaleLowerCase());f.addTDTLayer(y,v)})}}t("mapInited",{xmap:h,wmtsTool:f}),h.map.on("change:view",d),h.map.on("pointerdrag",d),h.map.on("pointermove",g),h.MapView.on("change:resolution",d)}return Xt(()=>i.viewProjection,f=>{u(f),p()}),Ln(()=>{l||(u(c),p())}),Wc(()=>{h&&(h.map.un("change:view",d),h.map.un("pointerdrag",d),h.map.un("pointermove",g),h.MapView.on("change:resolution",d))}),{...Xc(n),mapIDRef:r,xmap:h,mapContainerRef:o}}});const hf=["id"],cf={class:"mainMapPanel"},uf=["id"],df={class:"mapStateLine"},gf={class:"mapLeftPanel"},ff={class:"mapRightPanel"};go.render=function(i,t,e,n,s,r){return ot(),Ct("div",{id:i.mapContainerRef,class:"mapContainer"},[I("div",cf,[I("div",{id:i.mapIDRef,class:"mainMapPanel"},null,8,uf),Me(" \u5E95\u90E8\u72B6\u6001\u680F "),I("div",df,[I("span",null,pe(i.epsgInfo),1),I("span",null,pe(i.zoomInfo),1),I("span",null,pe(i.centerInfo),1),I("span",null,pe(i.positionInfo),1)]),I("div",null,[on(i.$slots,"default")])]),I("div",gf,[on(i.$slots,"mapLeftPanel")]),I("div",ff,[on(i.$slots,"mapRightPanel")])],8,hf)},go.__file="src/components/OLXmap/index.vue";const Ol="drawstart",pf="drawend",mf="drawabort";class es extends ne{constructor(t,e){super(t),this.feature=e}}function is(i,t){return me(i[0],i[1],t[0],t[1])}function Li(i,t){const e=i.length;return t<0?i[t+e]:t>=e?i[t-e]:i[t]}function ns(i,t,e){let n,s;t<e?(n=t,s=e):(n=e,s=t);const r=Math.ceil(n),o=Math.floor(s);if(r>o)return is(Pi(i,n),Pi(i,s));let a=0;n<r&&(a+=is(Pi(i,n),Li(i,r))),o<s&&(a+=is(Li(i,o),Pi(i,s)));for(let l=r;l<o-1;++l)a+=is(Li(i,l),Li(i,l+1));return a}function kc(i,t,e){if(t instanceof Vt)ss(i,t.getCoordinates(),!1,e);else if(t instanceof En){const n=t.getCoordinates();for(let s=0,r=n.length;s<r;++s)ss(i,n[s],!1,e)}else if(t instanceof Zt){const n=t.getCoordinates();for(let s=0,r=n.length;s<r;++s)ss(i,n[s],!0,e)}else if(t instanceof bn){const n=t.getCoordinates();for(let s=0,r=n.length;s<r;++s){const o=n[s];for(let a=0,l=o.length;a<l;++a)ss(i,o[a],!0,e)}}else if(t instanceof Cs){const n=t.getGeometries();for(let s=0;s<n.length;++s)kc(i,n[s],e)}}const Er={index:-1,endIndex:NaN};function ss(i,t,e,n){const s=i[0],r=i[1];for(let o=0,a=t.length-1;o<a;++o){const l=Dc(s,r,t[o],t[o+1]);if(l.squaredDistance===0){const h=o+l.along;return void n.push({coordinates:t,ring:e,startIndex:h,endIndex:h})}}}const br={along:0,squaredDistance:0};function Dc(i,t,e,n){const s=e[0],r=e[1],o=n[0]-s,a=n[1]-r;let l=0,h=s,c=r;return o===0&&a===0||(l=it(((i-s)*o+(t-r)*a)/(o*o+a*a),0,1),h+=o*l,c+=a*l),br.along=l,br.squaredDistance=xo(me(i,t,h,c),10),br}function Pi(i,t){const e=i.length;let n=Math.floor(t);const s=t-n;n>=e?n-=e:n<0&&(n+=e);let r=n+1;r>=e&&(r-=e);const o=i[n],a=o[0],l=o[1],h=i[r];return[a+(h[0]-a)*s,l+(h[1]-l)*s]}function _f(){const i=function(){const t={},e=[255,255,255,1],n=[0,153,255,1];return t.Polygon=[new ke({fill:new Tt({color:[255,255,255,.5]})})],t.MultiPolygon=t.Polygon,t.LineString=[new ke({stroke:new ee({color:e,width:5})}),new ke({stroke:new ee({color:n,width:3})})],t.MultiLineString=t.LineString,t.Circle=t.Polygon.concat(t.LineString),t.Point=[new ke({image:new ci({radius:6,fill:new Tt({color:n}),stroke:new ee({color:e,width:1.5})}),zIndex:1/0})],t.MultiPoint=t.Point,t.GeometryCollection=t.Polygon.concat(t.LineString,t.Point),t}();return function(t,e){return i[t.getGeometry().getType()]}}var Ts,fn=class extends Yi{constructor(i){const t=i;t.stopDown||(t.stopDown=Xi),super(t),this.on,this.once,this.un,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=i.source?i.source:null,this.features_=i.features?i.features:null,this.snapTolerance_=i.snapTolerance?i.snapTolerance:12,this.type_=i.type,this.mode_=function(n){switch(n){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+n)}}(this.type_),this.stopClick_=!!i.stopClick,this.minPoints_=i.minPoints?i.minPoints:this.mode_==="Polygon"?3:2,this.maxPoints_=this.mode_==="Circle"?2:i.maxPoints?i.maxPoints:1/0,this.finishCondition_=i.finishCondition?i.finishCondition:Bi,this.geometryLayout_=i.geometryLayout?i.geometryLayout:"XY";let e=i.geometryFunction;if(!e){const n=this.mode_;if(n==="Circle")e=function(s,r,o){const a=r||new Ws([NaN,NaN]),l=Nt(s[0]),h=gh(l,Nt(s[s.length-1]));return a.setCenterAndRadius(l,Math.sqrt(h),this.geometryLayout_),a};else{let s;n==="Point"?s=Ae:n==="LineString"?s=Vt:n==="Polygon"&&(s=Zt),e=function(r,o,a){return o?n==="Polygon"?r[0].length?o.setCoordinates([r[0].concat([r[0][0]])],this.geometryLayout_):o.setCoordinates([],this.geometryLayout_):o.setCoordinates(r,this.geometryLayout_):o=new s(r,this.geometryLayout_),o}}}this.geometryFunction_=e,this.dragVertexDelay_=i.dragVertexDelay!==void 0?i.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=i.clickTolerance?i.clickTolerance*i.clickTolerance:36,this.overlay_=new Ho({source:new Uo({useSpatialIndex:!1,wrapX:!!i.wrapX&&i.wrapX}),style:i.style?i.style:_f(),updateWhileInteracting:!0}),this.geometryName_=i.geometryName,this.condition_=i.condition?i.condition:ea,this.freehandCondition_,i.freehand?this.freehandCondition_=uo:this.freehandCondition_=i.freehandCondition?i.freehandCondition:Mc,this.traceCondition_,this.setTrace(i.trace||!1),this.traceState_={active:!1},this.traceSource_=i.traceSource||i.source||null,this.addChangeListener(ho,this.updateState_)}setTrace(i){let t;t=i?i===!0?uo:i:Xg,this.traceCondition_=t}setMap(i){super.setMap(i),this.updateState_()}getOverlay(){return this.overlay_}handleEvent(i){i.originalEvent.type===Ur&&i.originalEvent.preventDefault(),this.freehand_=this.mode_!=="Point"&&this.freehandCondition_(i);let t=i.type===H.POINTERMOVE,e=!0;return!this.freehand_&&this.lastDragTime_&&i.type===H.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=i.pixel,this.shouldHandle_=!this.freehand_,t=!0):this.lastDragTime_=void 0,this.shouldHandle_&&this.downTimeout_!==void 0&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&i.type===H.POINTERDRAG&&this.sketchFeature_!==null?(this.addToDrawing_(i.coordinate),e=!1):this.freehand_&&i.type===H.POINTERDOWN?e=!1:t&&this.getPointerCount()<2?(e=i.type===H.POINTERMOVE,e&&this.freehand_?(this.handlePointerMove_(i),this.shouldHandle_&&i.originalEvent.preventDefault()):(i.originalEvent.pointerType==="mouse"||i.type===H.POINTERDRAG&&this.downTimeout_===void 0)&&this.handlePointerMove_(i)):i.type===H.DBLCLICK&&(e=!1),super.handleEvent(i)&&e}handleDownEvent(i){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=i.pixel,this.finishCoordinate_||this.startDrawing_(i.coordinate),!0):this.condition_(i)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(function(){this.handlePointerMove_(new de(H.POINTERMOVE,i.map,i.originalEvent,!1,i.frameState))}.bind(this),this.dragVertexDelay_),this.downPx_=i.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(i){if(!this.traceSource_||!this.traceCondition_(i))return;if(this.traceState_.active)return void this.deactivateTrace_();const t=this.getMap(),e=zr([t.getCoordinateFromPixel([i.pixel[0]-this.snapTolerance_,i.pixel[1]+this.snapTolerance_]),t.getCoordinateFromPixel([i.pixel[0]+this.snapTolerance_,i.pixel[1]-this.snapTolerance_])]),n=this.traceSource_.getFeaturesInExtent(e);if(n.length===0)return;const s=function(r,o){const a=[];for(let l=0;l<o.length;++l)kc(r,o[l].getGeometry(),a);return a}(i.coordinate,n);s.length&&(this.traceState_={active:!0,startPx:i.pixel.slice(),targets:s,targetIndex:-1})}addOrRemoveTracedCoordinates_(i,t){const e=i.startIndex<=i.endIndex;e===i.startIndex<=t?e&&t>i.endIndex||!e&&t<i.endIndex?this.addTracedCoordinates_(i,i.endIndex,t):(e&&t<i.endIndex||!e&&t>i.endIndex)&&this.removeTracedCoordinates_(t,i.endIndex):(this.removeTracedCoordinates_(i.startIndex,i.endIndex),this.addTracedCoordinates_(i,i.startIndex,t))}removeTracedCoordinates_(i,t){if(i===t)return;let e=0;if(i<t){const n=Math.ceil(i);let s=Math.floor(t);s===t&&(s-=1),e=s-n+1}else{const n=Math.floor(i);let s=Math.ceil(t);s===t&&(s+=1),e=n-s+1}e>0&&this.removeLastPoints_(e)}addTracedCoordinates_(i,t,e){if(t===e)return;const n=[];if(t<e){const s=Math.ceil(t);let r=Math.floor(e);r===e&&(r-=1);for(let o=s;o<=r;++o)n.push(Li(i.coordinates,o))}else{const s=Math.floor(t);let r=Math.ceil(e);r===e&&(r+=1);for(let o=s;o>=r;--o)n.push(Li(i.coordinates,o))}n.length&&this.appendCoordinates(n)}updateTrace_(i){const t=this.traceState_;if(!t.active||t.targetIndex===-1&&Pa(t.startPx,i.pixel)<this.snapTolerance_)return;const e=function(o,a,l,h){const c=o[0],u=o[1];let d=1/0,g=-1,p=NaN;for(let _=0;_<a.targets.length;++_){const y=a.targets[_],v=y.coordinates;let x,C=1/0;for(let E=0;E<v.length-1;++E){const S=Dc(c,u,v[E],v[E+1]);S.squaredDistance<C&&(C=S.squaredDistance,x=E+S.along)}C<d&&(d=C,y.ring&&a.targetIndex===_&&(y.endIndex>y.startIndex?x<y.startIndex&&(x+=v.length):y.endIndex<y.startIndex&&x>y.startIndex&&(x-=v.length)),p=x,g=_)}const f=a.targets[g];let m=f.ring;if(a.targetIndex===g&&m){const _=Pi(f.coordinates,p);Pa(l.getPixelFromCoordinate(_),a.startPx)>h&&(m=!1)}if(m){const _=f.coordinates,y=_.length,v=f.startIndex,x=p;if(v<x){const C=ns(_,v,x);ns(_,v,x-y)<C&&(p-=y)}else{const C=ns(_,v,x);ns(_,v,x+y)<C&&(p+=y)}}return Er.index=g,Er.endIndex=p,Er}(i.coordinate,t,this.getMap(),this.snapTolerance_);if(t.targetIndex!==e.index){if(t.targetIndex!==-1){const a=t.targets[t.targetIndex];this.removeTracedCoordinates_(a.startIndex,a.endIndex)}const o=t.targets[e.index];this.addTracedCoordinates_(o,o.startIndex,e.endIndex)}else{const o=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(o,e.endIndex)}t.targetIndex=e.index;const n=t.targets[t.targetIndex];n.endIndex=e.endIndex;const s=Pi(n.coordinates,n.endIndex),r=this.getMap().getPixelFromCoordinate(s);i.coordinate=s,i.pixel=[Math.round(r[0]),Math.round(r[1])]}handleUpEvent(i){let t=!0;if(this.getPointerCount()===0){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(i);const e=this.traceState_.active;if(this.toggleTraceState_(i),this.shouldHandle_){const n=!this.finishCoordinate_;n&&this.startDrawing_(i.coordinate),!n&&this.freehand_?this.finishDrawing():this.freehand_||n&&this.mode_!=="Point"||(this.atFinish_(i.pixel,e)?this.finishCondition_(i)&&this.finishDrawing():this.addToDrawing_(i.coordinate)),t=!1}else this.freehand_&&this.abortDrawing()}return!t&&this.stopClick_&&i.preventDefault(),t}handlePointerMove_(i){if(this.pointerType_=i.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const t=this.downPx_,e=i.pixel,n=t[0]-e[0],s=t[1]-e[1],r=n*n+s*s;if(this.shouldHandle_=this.freehand_?r>this.squaredClickTolerance_:r<=this.squaredClickTolerance_,!this.shouldHandle_)return}this.finishCoordinate_?(this.updateTrace_(i),this.modifyDrawing_(i.coordinate)):this.createOrUpdateSketchPoint_(i.coordinate.slice())}atFinish_(i,t){let e=!1;if(this.sketchFeature_){let n=!1,s=[this.finishCoordinate_];const r=this.mode_;if(r==="Point")e=!0;else if(r==="Circle")e=this.sketchCoords_.length===2;else if(r==="LineString")n=!t&&this.sketchCoords_.length>this.minPoints_;else if(r==="Polygon"){const o=this.sketchCoords_;n=o[0].length>this.minPoints_,s=[o[0][0],o[0][o[0].length-2]],s=t?[o[0][0]]:[o[0][0],o[0][o[0].length-2]]}if(n){const o=this.getMap();for(let a=0,l=s.length;a<l;a++){const h=s[a],c=o.getPixelFromCoordinate(h),u=i[0]-c[0],d=i[1]-c[1],g=this.freehand_?1:this.snapTolerance_;if(e=Math.sqrt(u*u+d*d)<=g,e){this.finishCoordinate_=h;break}}}}return e}createOrUpdateSketchPoint_(i){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(i):(this.sketchPoint_=new Ke(new Ae(i)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(i){this.sketchLine_||(this.sketchLine_=new Ke);const t=i.getLinearRing(0);let e=this.sketchLine_.getGeometry();e?(e.setFlatCoordinates(t.getLayout(),t.getFlatCoordinates()),e.changed()):(e=new Vt(t.getFlatCoordinates(),t.getLayout()),this.sketchLine_.setGeometry(e))}startDrawing_(i){const t=this.getMap().getView().getProjection(),e=xs(this.geometryLayout_);for(;i.length<e;)i.push(0);this.finishCoordinate_=i,this.mode_==="Point"?this.sketchCoords_=i.slice():this.mode_==="Polygon"?(this.sketchCoords_=[[i.slice(),i.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[i.slice(),i.slice()],this.sketchLineCoords_&&(this.sketchLine_=new Ke(new Vt(this.sketchLineCoords_)));const n=this.geometryFunction_(this.sketchCoords_,void 0,t);this.sketchFeature_=new Ke,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(n),this.updateSketchFeatures_(),this.dispatchEvent(new es(Ol,this.sketchFeature_))}modifyDrawing_(i){const t=this.getMap(),e=this.sketchFeature_.getGeometry(),n=t.getView().getProjection(),s=xs(this.geometryLayout_);let r,o;for(;i.length<s;)i.push(0);this.mode_==="Point"?o=this.sketchCoords_:this.mode_==="Polygon"?(r=this.sketchCoords_[0],o=r[r.length-1],this.atFinish_(t.getPixelFromCoordinate(i))&&(i=this.finishCoordinate_.slice())):(r=this.sketchCoords_,o=r[r.length-1]),o[0]=i[0],o[1]=i[1],this.geometryFunction_(this.sketchCoords_,e,n),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(i),e.getType()==="Polygon"&&this.mode_!=="Polygon"?this.createOrUpdateCustomSketchLine_(e):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(i){const t=this.sketchFeature_.getGeometry(),e=this.getMap().getView().getProjection();let n,s;const r=this.mode_;r==="LineString"||r==="Circle"?(this.finishCoordinate_=i.slice(),s=this.sketchCoords_,s.length>=this.maxPoints_&&(this.freehand_?s.pop():n=!0),s.push(i.slice()),this.geometryFunction_(s,t,e)):r==="Polygon"&&(s=this.sketchCoords_[0],s.length>=this.maxPoints_&&(this.freehand_?s.pop():n=!0),s.push(i.slice()),n&&(this.finishCoordinate_=s[0]),this.geometryFunction_(this.sketchCoords_,t,e)),this.createOrUpdateSketchPoint_(i.slice()),this.updateSketchFeatures_(),n&&this.finishDrawing()}removeLastPoints_(i){if(!this.sketchFeature_)return;const t=this.sketchFeature_.getGeometry(),e=this.getMap().getView().getProjection(),n=this.mode_;for(let s=0;s<i;++s){let r;if(n==="LineString"||n==="Circle"){if(r=this.sketchCoords_,r.splice(-2,1),r.length>=2){this.finishCoordinate_=r[r.length-2].slice();const o=this.finishCoordinate_.slice();r[r.length-1]=o,this.createOrUpdateSketchPoint_(o)}this.geometryFunction_(r,t,e),t.getType()==="Polygon"&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(t)}else if(n==="Polygon"){r=this.sketchCoords_[0],r.splice(-2,1);const o=this.sketchLine_.getGeometry();if(r.length>=2){const a=r[r.length-2].slice();r[r.length-1]=a,this.createOrUpdateSketchPoint_(a)}o.setCoordinates(r),this.geometryFunction_(this.sketchCoords_,t,e)}if(r.length===1){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const i=this.abortDrawing_();if(!i)return;let t=this.sketchCoords_;const e=i.getGeometry(),n=this.getMap().getView().getProjection();this.mode_==="LineString"?(t.pop(),this.geometryFunction_(t,e,n)):this.mode_==="Polygon"&&(t[0].pop(),this.geometryFunction_(t,e,n),t=e.getCoordinates()),this.type_==="MultiPoint"?i.setGeometry(new Gs([t])):this.type_==="MultiLineString"?i.setGeometry(new En([t])):this.type_==="MultiPolygon"&&i.setGeometry(new bn([t])),this.dispatchEvent(new es(pf,i)),this.features_&&this.features_.push(i),this.source_&&this.source_.addFeature(i)}abortDrawing_(){this.finishCoordinate_=null;const i=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),i}abortDrawing(){const i=this.abortDrawing_();i&&this.dispatchEvent(new es(mf,i))}appendCoordinates(i){const t=this.mode_,e=!this.sketchFeature_;let n;if(e&&this.startDrawing_(i[0]),t==="LineString"||t==="Circle")n=this.sketchCoords_;else{if(t!=="Polygon")return;n=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[]}e&&n.shift(),n.pop();for(let r=0;r<i.length;r++)this.addToDrawing_(i[r]);const s=i[i.length-1];this.addToDrawing_(s),this.modifyDrawing_(s)}extend(i){const t=i.getGeometry();this.sketchFeature_=i,this.sketchCoords_=t.getCoordinates();const e=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=e.slice(),this.sketchCoords_.push(e.slice()),this.sketchPoint_=new Ke(new Ae(e)),this.updateSketchFeatures_(),this.dispatchEvent(new es(Ol,this.sketchFeature_))}updateSketchFeatures_(){const i=[];this.sketchFeature_&&i.push(this.sketchFeature_),this.sketchLine_&&i.push(this.sketchLine_),this.sketchPoint_&&i.push(this.sketchPoint_);const t=this.overlay_.getSource();t.clear(!0),t.addFeatures(i)}updateState_(){const i=this.getMap(),t=this.getActive();i&&t||this.abortDrawing(),this.overlay_.setMap(t?i:null)}};(function(i){i.Point="Point",i.LineString="LineString",i.LinearRing="LinearRing",i.Polygon="Polygon",i.MultiPoint="MultiPoint",i.MultiLineString="MultiLineString",i.MultiPolygon="MultiPolygon",i.GeometryCollection="GeometryCollection",i.Circle="Circle",i.Hand="Hand"})(Ts||(Ts={}));class yf{xmap;drawLayer;draw;drawStyle;constructor(t){if(this.xmap=t,t&&!this.drawLayer){const e=new Uo,n=new ui({fill:new Tt({color:"rgba(0, 0, 255, 0.1)"}),stroke:new ee({color:"#0000ff",width:2}),image:new ci({radius:7,fill:new Tt({color:"#00f"})})});this.drawLayer=new Ho({source:e,style:n}),t.map?.addLayer(this.drawLayer)}}setDrawVectorIndex=t=>{this.drawLayer.setZIndex(t)};setDrawLayer(t){if(t){const e=t;if(e)this.drawLayer=e;else{const n=t;this.xmap&&(this.drawLayer=this.xmap.map?.getLayers().item[n])}}}get DrawSource(){return this.drawLayer.getSource()}changeDrawType(t,e){this.clearInteraction(),e&&(this.drawStyle=e),this.drawStyle||(this.drawStyle=new ui({fill:new Tt({color:"rgba(0, 255, 255, 0.5)"}),stroke:new ee({color:"#ff0000",width:2}),image:new ci({radius:7,fill:new Tt({color:"#f00"})})})),this.draw=new fn({source:this.DrawSource,type:t===Ts.Hand?"LineString":t.toString(),style:this.drawStyle,freehand:t===Ts.Hand,snapTolerance:50}),this.xmap.map?.addInteraction(this.draw)}clearInteraction(){const t=this.xmap.map;t&&this.draw&&(t.removeInteraction(this.draw),t.getInteractions().getArray()?.forEach(e=>{e instanceof fn&&t.removeInteraction(e)}))}clearLastDraw(){this.draw&&(()=>{const t=this.DrawSource.getFeatures();t.length!==0&&this.DrawSource.removeFeature(t[t.length-1])})()}clearboard(){this.draw&&this.DrawSource.clear()}}const Tr="element",Ir="map",Rr="offset",rs="position",Mr="positioning";var Dt,Gl=class extends Ut{constructor(i){super(),this.on,this.once,this.un,this.options=i,this.id=i.id,this.insertFirst=i.insertFirst===void 0||i.insertFirst,this.stopEvent=i.stopEvent===void 0||i.stopEvent,this.element=document.createElement("div"),this.element.className=i.className!==void 0?i.className:"ol-overlay-container ol-selectable",this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=i.autoPan===!0?{}:i.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(Tr,this.handleElementChanged),this.addChangeListener(Ir,this.handleMapChanged),this.addChangeListener(Rr,this.handleOffsetChanged),this.addChangeListener(rs,this.handlePositionChanged),this.addChangeListener(Mr,this.handlePositioningChanged),i.element!==void 0&&this.setElement(i.element),this.setOffset(i.offset!==void 0?i.offset:[0,0]),this.setPositioning(i.positioning||"top-left"),i.position!==void 0&&this.setPosition(i.position)}getElement(){return this.get(Tr)}getId(){return this.id}getMap(){return this.get(Ir)||null}getOffset(){return this.get(Rr)}getPosition(){return this.get(rs)}getPositioning(){return this.get(Mr)}handleElementChanged(){Jh(this.element);const i=this.getElement();i&&this.element.appendChild(i)}handleMapChanged(){this.mapPostrenderListenerKey&&(Ss(this.element),$(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const i=this.getMap();if(i){this.mapPostrenderListenerKey=N(i,qo,this.render,this),this.updatePixelPosition();const t=this.stopEvent?i.getOverlayContainerStopEvent():i.getOverlayContainer();this.insertFirst?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(i){this.set(Tr,i)}setMap(i){this.set(Ir,i)}setOffset(i){this.set(Rr,i)}setPosition(i){this.set(rs,i)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(i){const t=this.getMap();if(!t||!t.getTargetElement()||!this.get(rs))return;const e=this.getRect(t.getTargetElement(),t.getSize()),n=this.getElement(),s=this.getRect(n,[Td(n),Id(n)]),r=(i=i||{}).margin===void 0?20:i.margin;if(!Ze(e,s)){const o=s[0]-e[0],a=e[2]-s[2],l=s[1]-e[1],h=e[3]-s[3],c=[0,0];if(o<0?c[0]=o-r:a<0&&(c[0]=Math.abs(a)+r),l<0?c[1]=l-r:h<0&&(c[1]=Math.abs(h)+r),c[0]!==0||c[1]!==0){const u=t.getView().getCenterInternal(),d=t.getPixelFromCoordinateInternal(u);if(!d)return;const g=[d[0]+c[0],d[1]+c[1]],p=i.animation||{};t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(g),duration:p.duration,easing:p.easing})}}}getRect(i,t){const e=i.getBoundingClientRect(),n=e.left+window.pageXOffset,s=e.top+window.pageYOffset;return[n,s,n+t[0],s+t[1]]}setPositioning(i){this.set(Mr,i)}setVisible(i){this.rendered.visible!==i&&(this.element.style.display=i?"":"none",this.rendered.visible=i)}updatePixelPosition(){const i=this.getMap(),t=this.getPosition();if(!i||!i.isRendered()||!t)return void this.setVisible(!1);const e=i.getPixelFromCoordinate(t),n=i.getSize();this.updateRenderedPosition(e,n)}updateRenderedPosition(i,t){const e=this.element.style,n=this.getOffset(),s=this.getPositioning();this.setVisible(!0);let r="0%",o="0%";s=="bottom-right"||s=="center-right"||s=="top-right"?r="-100%":s!="bottom-center"&&s!="center-center"&&s!="top-center"||(r="-50%"),s=="bottom-left"||s=="bottom-center"||s=="bottom-right"?o="-100%":s!="center-left"&&s!="center-center"&&s!="center-right"||(o="-50%");const a=`translate(${r}, ${o}) translate(${Math.round(i[0]+n[0])+"px"}, ${Math.round(i[1]+n[1])+"px"})`;this.rendered.transform_!=a&&(this.rendered.transform_=a,e.transform=a)}getOptions(){return this.options}};class jl{map;sketch;helpTooltipElement;helpTooltip;measureTooltipElement;measureTooltip;continuePolygonMsg="\u7EE7\u7EED\u70B9\u51FB\u7ED8\u5236\u591A\u8FB9\u5F62";continueLineMsg="\u7EE7\u7EED\u70B9\u51FB\u7ED8\u5236\u7EBF";draw;source;measureLayer;doubleClickZoom;isInited=!1;tooltipArray=[];sphereOptions;constructor(t){this.map=t,this.init()}init(){const t=this.map.getView();this.sphereOptions={projection:t.getProjection()},this.createHelpTooltip(),this.createMeasureTooltip(),this.doubleClickZoom=this.map.getInteractions().getArray().find(e=>e instanceof Tc),this.map.on("pointermove",this.pointerMoveHandler.bind(this)),this.map.getViewport().addEventListener("mouseout",this.mouseoutHandler.bind(this)),this.source=new Uo,this.measureLayer=new Ho({source:this.source,style:new ui({fill:new Tt({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ee({color:"#ffcc33",width:2}),image:new ci({radius:7,fill:new Tt({color:"#ffcc33"})})})}),this.measureLayer.set("name","measurelayer"),this.map.addLayer(this.measureLayer),this.isInited=!0}mouseoutHandler(){this.helpTooltipElement.classList.add("hidden")}createHelpTooltip(){this.helpTooltipElement&&this.helpTooltipElement.parentNode?.removeChild(this.helpTooltipElement),this.helpTooltipElement=document.createElement("div"),this.helpTooltipElement.className="myol-tooltip hidden",this.helpTooltip=new Gl({element:this.helpTooltipElement,offset:[15,0],positioning:"center-left"}),this.map.addOverlay(this.helpTooltip),this.tooltipArray.push(this.helpTooltipElement)}createMeasureTooltip(){this.measureTooltipElement&&this.measureTooltipElement.parentNode?.removeChild(this.measureTooltipElement),this.measureTooltipElement=document.createElement("div"),this.measureTooltipElement.className="myol-tooltip myol-tooltip-measure",this.measureTooltip=new Gl({element:this.measureTooltipElement,offset:[0,-15],positioning:"bottom-center"}),this.map.addOverlay(this.measureTooltip),this.tooltipArray.push(this.measureTooltipElement)}listener;formatLength(t){let e,n=mh(t,this.sphereOptions);return e=n>100?Math.round(n/1e3*100)/100+" km":Math.round(100*n)/100+" m",e}formatArea(t){let e,n=_h(t,this.sphereOptions);return e=n>1e4?Math.round(n/1e6*100)/100+" km<sup>2</sup>":Math.round(100*n)/100+" m<sup>2</sup>",e}geometryChanged(t){let e,n=t.target,s="";n instanceof Zt?(s=this.formatArea(n),e=n.getInteriorPoint().getCoordinates()):n instanceof Vt&&(s=this.formatLength(n),e=n.getLastCoordinate()),this.measureTooltipElement&&(this.measureTooltipElement.innerHTML=s),this.measureTooltip.setPosition(e)}pointerMoveHandler(t){if(t.dragging)return;let e="\u8BF7\u70B9\u51FB\u5F00\u59CB\u7ED8\u5236";if(this.sketch){let n=this.sketch.getGeometry();n instanceof Zt?e=this.continuePolygonMsg:n instanceof Vt&&(e=this.continueLineMsg)}this.helpTooltipElement.innerHTML=e,this.helpTooltip.setPosition(t.coordinate),this.helpTooltipElement.classList.remove("hidden")}addInteraction(t="area"){this.isInited||this.init(),this.map&&this.map.getInteractions().getArray()?.forEach(n=>{n instanceof fn&&this.map.removeInteraction(n)});const e=t=="area"?"Polygon":"LineString";this.draw=new fn({source:this.source,type:e,style:new ui({fill:new Tt({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ee({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2}),image:new ci({radius:5,stroke:new ee({color:"rgba(0, 0, 0, 0.7)"}),fill:new Tt({color:"rgba(255, 255, 255, 0.2)"})})})}),this.map.addInteraction(this.draw),this.draw.on("drawstart",this.drawStartHander.bind(this)),this.draw.on("drawend",this.drawEndHander.bind(this))}drawStartHander(t){this.sketch=t.feature,this.listener=this.sketch.getGeometry().on("change",this.geometryChanged.bind(this))}drawEndHander(){this.measureTooltipElement.className="myol-tooltip myol-tooltip-static",this.measureTooltip.setOffset([0,-7]),this.sketch=null,this.measureTooltipElement=null,this.createMeasureTooltip(),Mi(this.listener)}removeInteraction(){this.draw&&(console.log("\u79FB\u9664\u73B0\u6709draw"),this.map.removeInteraction(this.draw)),this.map.getInteractions().getArray()?.forEach(t=>{t instanceof fn&&this.map.removeInteraction(t)}),this.helpTooltipElement&&this.helpTooltipElement.parentNode?.removeChild(this.helpTooltipElement),this.measureTooltipElement&&this.measureTooltipElement.parentNode?.removeChild(this.measureTooltipElement),this.tooltipArray.forEach(t=>{t.parentNode?.removeChild(t)}),this.tooltipArray=[],this.helpTooltip&&this.map.removeOverlay(this.helpTooltip),this.measureTooltip&&this.map.removeOverlay(this.measureTooltip),this.measureLayer&&this.map.removeLayer(this.measureLayer),this.map.getLayers()?.forEach(t=>{t.get("name")==="measurelayer"&&this.map.removeLayer(t)}),this.map.un("pointermove",this.pointerMoveHandler.bind(this)),this.map.getViewport().removeEventListener("mouseout",this.mouseoutHandler.bind(this)),this.doubleClickZoom&&this.map.addInteraction(this.doubleClickZoom),this.isInited=!1}}function be(i,t){return at(i.inversePixelTransform,t.slice(0))}(function(i){i[i.RollHorizonl=0]="RollHorizonl",i[i.RollVertical=1]="RollVertical",i[i.FishEye=2]="FishEye"})(Dt||(Dt={}));class zl{container;xmap;swipeLayer;SwipeType=Dt.RollHorizonl;circleRadius=50;swipeValueX=0;swipeValueY=0;divHeight=0;divWidth=0;line=void 0;preRenderKey;postRenderKey;IsLoaded=!1;constructor(t,e){this.container=t,this.xmap=e,t&&(t.addEventListener("mousemove",this.rollSwipeLayerbak.bind(this)),this.line=document.createElement("div"),t.insertBefore(this.line,t.firstElementChild),this.divWidth=t.clientWidth,this.divHeight=t.clientHeight)}rollSwipeLayerbak(t){const e=t.offsetX,n=t.offsetY;if(this.changeSwipe(e,n),this.line)switch(this.SwipeType){case Dt.RollHorizonl:this.line.removeAttribute("className"),this.line.removeAttribute("class"),this.line.setAttribute("className","horizonaldivider"),this.line.setAttribute("class","horizonaldivider");const s=e;this.line.style.height=this.divHeight+"px",this.line.style.width="4px",this.line.style.left=s+"px",this.line.style.removeProperty("top");break;case Dt.RollVertical:this.line.removeAttribute("className"),this.line.removeAttribute("class"),this.line.setAttribute("className","verticaldivider"),this.line.setAttribute("class","verticaldivider");const r=n;this.line.style.height="4px",this.line.style.removeProperty("left"),this.line.style.width=this.divWidth+"px",this.line.style.top=r+"px"}}setSwipeLayer(t){if(this.swipeLayer&&(Mi(this.postRenderKey),Mi(this.preRenderKey)),typeof t=="number"){const e=t;if(this.xmap){const n=this.xmap.map?.getLayers();this.swipeLayer=n?.getArray()[e]}}else{const e=t;this.swipeLayer=e}this.swipeLayer&&(this.preRenderKey=this.swipeLayer.on("prerender",this.preRenderHandler.bind(this)),this.postRenderKey=this.swipeLayer.on("postrender",this.postRenderHandler.bind(this)),this.IsLoaded=!0)}preRenderHandler(t){const e=this.xmap.map?.getSize();if(e===void 0)return;const n=t.context;switch(n.save(),n.beginPath(),this.SwipeType){case Dt.RollHorizonl:const s=this.swipeValueX,r=be(t,[s,0]),o=be(t,[e[0],0]),a=be(t,[s,e[1]]),l=be(t,e);n.moveTo(r[0],r[1]),n.lineTo(a[0],a[1]),n.lineTo(l[0],l[1]),n.lineTo(o[0],o[1]),n.closePath();break;case Dt.RollVertical:const h=this.swipeValueY,c=be(t,[0,h]),u=be(t,[e[0],h]),d=be(t,[0,e[1]]),g=be(t,e);n.moveTo(c[0],c[1]),n.lineTo(d[0],d[1]),n.lineTo(g[0],g[1]),n.lineTo(u[0],u[1]),n.closePath();break;case Dt.FishEye:const p=this.swipeValueX,f=this.swipeValueY;n.arc(p,f,this.circleRadius,0,2*Math.PI,!1),n.stroke()}n.clip()}postRenderHandler(t){t.context.restore()}changeSwipeType(t,e=50){this.SwipeType=t,t===Dt.FishEye?(e>0&&(this.circleRadius=e),this.line.style.display="none"):(this.line.style.display="unset",this.line.style.removeProperty("display"))}changeSwipe(t,e){this.swipeValueX=t,this.swipeValueY=e,this.xmap&&this.xmap.map?.render()}load(){this.swipeLayer&&(this.preRenderKey=this.swipeLayer.on("prerender",this.preRenderHandler.bind(this)),this.postRenderKey=this.swipeLayer.on("postrender",this.postRenderHandler.bind(this)),this.IsLoaded=!0),this.container&&(this.container.addEventListener("mousemove",this.rollSwipeLayerbak.bind(this)),this.container.insertBefore(this.line,this.container.firstElementChild))}unload(){this.swipeLayer&&(Mi(this.postRenderKey),Mi(this.preRenderKey),this.IsLoaded=!1),this.container&&(this.container.removeEventListener("mousemove",this.rollSwipeLayerbak.bind(this)),this.container.contains(this.line)&&this.container.removeChild(this.line))}}var Bl=ve({name:"drawtool",props:{xmap:ia},components:{Icon:Ge},setup(i){let t,e=i.xmap;return Ln(()=>{}),Xt(()=>i.xmap,n=>{e=n}),{changeType:function(n){!t&&e&&(t=new yf(e));const s=n;t?.changeDrawType(s),t||console.log("drawTool\u5DE5\u5177\u4E3A\u7A7A\uFF01")},clearPic:function(){t?.clearLastDraw()},clearboard:function(){t?.clearboard(),t?.clearInteraction()}}}});const vf={class:"tool-container drawToolList"},xf={title:"\u753B\u70B9"},Cf={title:"\u753B\u7EBF"},wf={title:"\u753B\u9762"},Sf={title:"\u753B\u7B14"},Ef={title:"\u64A4\u9500"},bf={title:"\u6E05\u7A7A"};Bl.render=function(i,t,e,n,s,r){const o=tt("Icon");return ot(),Ct("ul",vf,[I("li",{onClick:t[0]||(t[0]=a=>i.changeType("Point"))},[I("span",xf,[G(o,{icon:"gis:point"})])]),I("li",{onClick:t[1]||(t[1]=a=>i.changeType("LineString"))},[I("span",Cf,[G(o,{icon:"gis:polyline"})])]),I("li",{onClick:t[2]||(t[2]=a=>i.changeType("Polygon"))},[I("span",wf,[G(o,{icon:"gis:polygon-o"})])]),I("li",{onClick:t[3]||(t[3]=a=>i.changeType("Hand"))},[I("span",Sf,[G(o,{icon:"gis:route-start"})])]),I("li",{onClick:t[4]||(t[4]=(...a)=>i.clearPic&&i.clearPic(...a))},[I("span",Ef,[G(o,{icon:"ant-design:undo-outlined"})])]),I("li",{onClick:t[5]||(t[5]=(...a)=>i.clearboard&&i.clearboard(...a))},[I("span",bf,[G(o,{icon:"ant-design:clear-outlined"})])])])},Bl.__file="src/components/MapTools/drawToolBar.vue";var Nl=ve({name:"MeasureToolBar",props:{xmap:ia},components:{Icon:Ge},setup(i){let t,e=i.xmap;return Xt(()=>i.xmap,n=>{e=n}),{measureLine:()=>{!t&&e?.map&&(t=new jl(e.map)),t?.addInteraction("line")},measureArea:()=>{!t&&e?.map&&(t=new jl(e.map)),t?.addInteraction("area")},unloadMeasure:()=>{t&&t.removeInteraction()}}}});const Tf={class:"tool-container measureToolList"},If={title:"\u91CF\u7EBF"},Rf={title:"\u91CF\u9762"},Mf={title:"\u53D6\u6D88"};Nl.render=function(i,t,e,n,s,r){const o=tt("Icon");return ot(),Ct("ul",Tf,[I("li",{onClick:t[0]||(t[0]=(...a)=>i.measureLine&&i.measureLine(...a))},[I("span",If,[G(o,{icon:"gis:measure-line"})])]),I("li",{onClick:t[1]||(t[1]=(...a)=>i.measureArea&&i.measureArea(...a))},[I("span",Rf,[G(o,{icon:"gis:measure-area"})])]),I("li",{onClick:t[2]||(t[2]=(...a)=>i.unloadMeasure&&i.unloadMeasure(...a))},[I("span",Mf,[G(o,{icon:"ant-design:clear-outlined"})])])])},Nl.__file="src/components/MapTools/measureToolBar.vue";var Wl=ve({name:"MainMenu",props:{},components:{Icon:Ge,"a-input":Vc,"a-input-number":Yc,"a-button":Kc,"a-popover":Yl},emits:["locate"],setup(i,{emit:t}){const e=Ot(()=>{let h="";return ct.layerTree&&(h="background-color:#ccc"),h}),n=Ot(()=>{let h="";return ct.location&&(h="background-color:#ccc"),h}),s=Ot(()=>{let h="";return ct.drawTool&&(h="background-color:#ccc"),h}),r=Ot(()=>{let h="";return ct.measureTool&&(h="background-color:#ccc"),h}),o=gt(),a=gt(),l=gt();return{changeLocationVisible:function(){const h=ct.location;ct.location=!h},layerTreeSelected:e,changeLayerTree:function(){const h=ct.layerTree;ct.layerTree=!h},locationSelected:n,drawSelected:s,changeDrawVisible:function(){const h=ct.drawTool;ct.drawTool=!h},mesaureSelected:r,changeMeasureVisible:function(){const h=ct.measureTool;ct.measureTool=!h},locatePostion:function(){o.value!=null&&a.value!=null&&t("locate",o.value,a.value,l.value)},xRef:o,yRef:a,zRef:l}}});const Lf={class:"tool-container menuToolList"},Pf={title:"\u7ED8\u56FE\u5DE5\u5177"},Ff={title:"\u91CF\u7B97"},kf={class:"sjz"},Df={class:"xcoor"},Af=I("div",{style:{"margin-right":"14px"}},"\u7ECF\u5EA6:",-1),Of={class:"ycoor"},Gf=I("div",{style:{"margin-right":"14px"}},"\u7EAC\u5EA6:",-1),jf={class:"ycoor"},zf={style:{"margin-right":"14px","margin-top":"10px"}},Bf=I("b",null,"\u5750\u6807\u5B9A\u4F4D",-1),Nf={title:"\u5B9A\u4F4D"};Wl.render=function(i,t,e,n,s,r){const o=tt("Icon"),a=tt("a-input"),l=tt("a-input-number"),h=tt("a-button"),c=tt("a-popover");return ot(),Ct("ul",Lf,[Me(` <li @click="changeLayerTree" :style="layerTreeSelected">\r
        <span  title="\u56FE\u5C42"><Icon icon = "gis:layer-stack-o" /></span>\r
      </li> `),I("li",{onClick:t[0]||(t[0]=(...u)=>i.changeDrawVisible&&i.changeDrawVisible(...u)),style:ti(i.drawSelected)},[I("span",Pf,[G(o,{icon:"gis:extent-alt"})])],4),I("li",{onClick:t[1]||(t[1]=(...u)=>i.changeMeasureVisible&&i.changeMeasureVisible(...u)),style:ti(i.mesaureSelected)},[I("span",Ff,[G(o,{icon:"gis:measure"})])],4),I("li",{onClick:t[5]||(t[5]=(...u)=>i.changeLocationVisible&&i.changeLocationVisible(...u)),style:ti(i.locationSelected)},[G(c,{placement:"left"},{content:ut(()=>[I("div",kf,[I("div",Df,[Af,G(a,{size:"small",placeholder:"\u7ECF\u5EA6\u5341\u8FDB\u5236",style:{width:"220px"},value:i.xRef,"onUpdate:value":t[2]||(t[2]=u=>i.xRef=u)},null,8,["value"])]),I("div",Of,[Gf,G(a,{size:"small",placeholder:"\u7EAC\u5EA6\u5341\u8FDB\u5236",style:{width:"220px"},value:i.yRef,"onUpdate:value":t[3]||(t[3]=u=>i.yRef=u)},null,8,["value"])]),I("div",jf,[I("div",zf,[Fi(" \u7EA7\u522B: "),G(l,{id:"inputNumber",size:"small",value:i.zRef,"onUpdate:value":t[4]||(t[4]=u=>i.zRef=u),min:1,max:22},null,8,["value"])])]),G(h,{type:"primary",onClick:i.locatePostion,style:{float:"right",top:"-26px"}},{default:ut(()=>[Fi(" \u786E\u5B9A ")]),_:1},8,["onClick"])])]),title:ut(()=>[Bf]),default:ut(()=>[I("span",Nf,[G(o,{icon:"gis:position-o"})])]),_:1})],4)])},Wl.__file="src/components/MapTools/menuToolBar.vue";var Xl=ve({name:"SwipeToolBar",props:{xmap:{type:Object}},components:{Icon:Ge},setup(i){let t,e=i.xmap;return Xt(()=>i.xmap,n=>{e=n}),{unload:function(){t&&t.unload()},useFishEyes:function(){if(!e)return;const n=e.LayerManager?.SwipeLayerIndex;if(n!==void 0){if(t)t.unload(),t.load();else{const s=document.getElementById(e.target);t=new zl(s,e),t.setSwipeLayer(n)}t.changeSwipeType(Dt.FishEye,100)}else Ta.info("\u8BF7\u4ECE\u56FE\u5C42\u6811\u8BBE\u7F6E\u900F\u89C6\u56FE\u5C42!")},useSwipe:function(n=0){if(!e)return;const s=e.LayerManager?.SwipeLayerIndex;if(s!==void 0){if(t)t.unload(),t.load();else{const r=document.getElementById(e.target);t=new zl(r,e)}t.setSwipeLayer(s),n===0?t.changeSwipeType(Dt.RollHorizonl):t.changeSwipeType(Dt.RollVertical)}else Ta.info("\u8BF7\u4ECE\u56FE\u5C42\u6811\u8BBE\u7F6E\u900F\u89C6\u56FE\u5C42!")}}}});const Wf={class:"tool-container swipeToolList"},Xf={title:"\u6A2A\u5411\u5377\u5E18"},Vf={title:"\u7EB5\u5411\u5377\u5E18"},Yf={title:"\u9C7C\u773C"},Kf={title:"\u53D6\u6D88\u900F\u89C6"};Xl.render=function(i,t,e,n,s,r){const o=tt("Icon");return ot(),Ct("ul",Wf,[I("li",{onClick:t[0]||(t[0]=a=>i.useSwipe(0))},[I("span",Xf,[G(o,{icon:"gis:swipe-map-v"})])]),I("li",{onClick:t[1]||(t[1]=a=>i.useSwipe(1))},[I("span",Vf,[G(o,{icon:"gis:swipe-map-h"})])]),I("li",{onClick:t[2]||(t[2]=(...a)=>i.useFishEyes&&i.useFishEyes(...a))},[I("span",Yf,[G(o,{icon:"gis:screen-mag"})])]),I("li",{onClick:t[3]||(t[3]=(...a)=>i.unload&&i.unload(...a))},[I("span",Kf,[G(o,{icon:"gis:earth"})])])])},Xl.__file="src/components/MapTools/swipeToolBar.vue";var fo=ve({name:"ZoomInOut",props:{xmap:{type:Object},hasLayerTree:Ds().def(!1)},components:{Icon:Ge},emits:["locate"],setup(i,{emit:t}){const e=gt(i.hasLayerTree);let n=i.xmap;Xt(()=>i.xmap,l=>{n=l});const s=gt(!1),r=Ot(()=>s.value?"\u9000\u51FA\u5168\u5C4F":"\u5730\u56FE\u5168\u5C4F"),o=Ot(()=>{let l="";return s.value&&(l="background-color:#ccc"),l}),a=Ot(()=>{let l="";return ct.layerTree&&(l="background-color:#ccc"),l});return Ln(()=>{if(n){const l=n.map.getControls();if(l){const h=l.getArray()[0];n.map.removeControl(h)}}}),{isFullScreen:s,toggleMapScreen:function(){if(s.value)ku(),setTimeout(()=>{ih()},300);else{const l=n.target+"_Container";Du(document.getElementById(l))}s.value=!s.value},fullScreenTip:r,fullScreenStyle:o,zoomInOut:function(l=!0){if(!n)return;let h=n.MapView.getZoom()+(l?1:-1);h<=0&&(h=1),n.MapView.setZoom(h)},layerTreeSelected:a,changeLayerTree:function(){const l=ct.layerTree;ct.layerTree=!l},hasLayerTreeRef:e}}});const Zf={class:"tool-container zoomFullList"},Hf={title:"\u653E\u5927"},Uf={title:"\u7F29\u5C0F"},qf=["title"],Jf={title:"\u56FE\u5C42"};fo.render=function(i,t,e,n,s,r){const o=tt("Icon");return ot(),Ct("ul",Zf,[I("li",{onClick:t[0]||(t[0]=a=>i.zoomInOut())},[I("span",Hf,[G(o,{icon:"gis:zoom-in"})])]),I("li",{onClick:t[1]||(t[1]=a=>i.zoomInOut(!1))},[I("span",Uf,[G(o,{icon:"gis:zoom-out"})])]),I("li",{onClick:t[2]||(t[2]=(...a)=>i.toggleMapScreen&&i.toggleMapScreen(...a)),style:ti(i.fullScreenStyle)},[I("span",{title:i.fullScreenTip},[i.isFullScreen?(ot(),Ai(o,{key:1,icon:"ant-design:fullscreen-exit-outlined"})):(ot(),Ai(o,{key:0,icon:"ant-design:fullscreen-outlined"}))],8,qf)],4),i.hasLayerTreeRef?(ot(),Ct("li",{key:0,onClick:t[3]||(t[3]=(...a)=>i.changeLayerTree&&i.changeLayerTree(...a)),style:ti(i.layerTreeSelected)},[I("span",Jf,[G(o,{icon:"gis:layer-stack-o"})])],4)):Me("v-if",!0)])},fo.__file="src/components/MapTools/zoomFullBar.vue";var Vl=ve({name:"xmapView",props:{hasLayerTree:Ds().def(!1),viewHeight:_s().isRequired,viewWidth:_s().isRequired,mapid:xn().def("map"),mapgroup:xn().def("map"),viewProjection:Ro([String,ei]).def("EPSG:4326"),initTDTLayers:Array},components:{Icon:Ge,LayerTree:ls,ZoomFullBar:fo,OLXMap:go},emits:["mapInited"],setup(i,{attrs:t,slots:e,emit:n}){const s=gt(i.hasLayerTree),r=gt(i.viewHeight),o=gt(i.viewWidth),a=gt(i.initTDTLayers),l=gt(),h=gt();let c;function u(f){if(f){if(sh(f))f==="EPSG:4326"&&(a.value=i.initTDTLayers??["vec_c","cva_c"]);else{const m=f.getCode();(m==="EPSG:4326"||m==="EPSG:4490")&&(a.value=i.initTDTLayers??["vec_c","cva_c"])}l.value=f}}u(i.viewProjection),Xt(()=>i.viewProjection,()=>{const f=i.viewProjection;f&&(console.log(f,"\u6295\u5F71\u6539\u53D8\uFF0C\u5728XMAPView",l.value),u(f))}),Xt(()=>i.viewHeight,f=>{r.value=f}),Xt(()=>i.viewWidth,f=>{o.value=f});const d=Ot(()=>`height:${r.value-55}px`),g=Ot(()=>`width:${o.value-20}px;`),p=Ot(()=>{const f=r.value,m=o.value;return ih(),`position:relative;width:${m};height:${f}px`});return Ln(()=>{}),Zc(()=>{let f=c?.map;f&&f.dispose()}),{heightStyle:d,widthStyle:g,layerTreeVisible:Ot(()=>ct.layerTree),mapInitedHandler:function(f){c=f.xmap,h.value=c,n("mapInited",f)},mapRef:h,mainContainStyle:p,hasLayerTreeRef:s,initTDTLayersRef:a,viewProjectionRef:l}}});const $f={class:"extendmenu"},Qf={style:{position:"relative"}};Vl.render=function(i,t,e,n,s,r){const o=tt("LayerTree"),a=tt("ZoomFullBar"),l=tt("OLXMap");return ot(),Ct("div",{class:"mainViewContent",style:ti(i.mainContainStyle)},[G(l,{mapid:i.mapid,mapgroup:i.mapgroup,hasLayerManager:!0,viewProjection:i.viewProjectionRef,initTDTLayers:i.initTDTLayersRef,onMapInited:i.mapInitedHandler},{mapLeftPanel:ut(()=>[Me(' \u56FE\u5C42\u6811class="mapstyle"  '),Hc(G(o,{class:"layerTree",style:ti(i.heightStyle)},null,8,["style"]),[[Uc,i.layerTreeVisible]]),Me(" \u6269\u5C55\u5F39\u6846 "),on(i.$slots,"mapLeftPanelGroup")]),mapRightPanel:ut(()=>[Me("\u5730\u56FE\u6269\u5C55\u83DC\u5355 "),I("div",$f,[I("div",Qf,[G(a,{xmap:i.mapRef,hasLayerTree:i.hasLayerTreeRef},null,8,["xmap","hasLayerTree"])]),Me(" \u6269\u5C55\u83DC\u5355 "),on(i.$slots,"extendMenuGroup")])]),_:3},8,["mapid","mapgroup","viewProjection","initTDTLayers","onMapInited"])],4)},Vl.__file="src/components/XMapView/index.vue";export{Vl as D,Nl as F,Bl as L,Z as Y,ct as g,Wl as k};
