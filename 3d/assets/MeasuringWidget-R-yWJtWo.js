import{W as T,G as D,z as k,Z as I,B as M}from"./vendor-CDV5M84i.js";import{f as W,_ as A}from"./index-DPO_t7vI.js";import{W as x}from"./WidgetsEvent-TR_R_5Fb.js";import{j as g,E as L,d as F}from"./xframelib-exp-CvTEfE5n.js";import"./roadThrough-D75-Yhil.js";import{d as G,r as h,v as V,z as O,G as H,V as B,a1 as S,R as _,Q as m,L as p,N as y,M as E,a8 as z,X}from"./@vue-exp-YaP0LnBg.js";import"./@hprose-exp-DifMA6AO.js";import"./vue-router-exp-BeFgxScw.js";import"./axios-exp-BH40TtQM.js";const R=[{id:"SpatialDistance",label:"空间距离",icon:"straighten"},{id:"GroundDistance",label:"贴地距离",icon:"route"},{id:"HorizontalArea",label:"水平面积",icon:"crop_square"},{id:"GroundArea",label:"贴地面积",icon:"space_dashboard"},{id:"Coordinate",label:"坐标测量",icon:"my_location"},{id:"TriangleMeasurement",label:"三角测量",icon:"square_foot"},{id:"ProfileAnalysis",label:"剖面分析",icon:"landscape"}];class Q{constructor(t){this.viewer=t}getCatesian3FromPX(t){if(this.viewer&&t){var i=this.viewer.scene.drillPick(t),e=null,n=!1,r=!1;for(let a in i){let u=i[a];if((u&&u.primitive instanceof Cesium.Cesium3DTileFeature||u&&u.primitive instanceof Cesium.Cesium3DTileset||u&&u.primitive instanceof Cesium.Model)&&(n=!0),n&&(this.viewer.scene.pick(t),e=this.viewer.scene.pickPosition(t),e)){let d=Cesium.Cartographic.fromCartesian(e);d.height<0&&(d.height=0);let c=Cesium.Math.toDegrees(d.longitude),v=Cesium.Math.toDegrees(d.latitude),f=d.height;e=this.transformWGS84ToCartesian({lng:c,lat:v},f)}}let l=this.viewer.terrainProvider instanceof Cesium.EllipsoidTerrainProvider;if(!n&&!l){var s=this.viewer.scene.camera.getPickRay(t);if(!s)return null;e=this.viewer.scene.globe.pick(s,this.viewer.scene),r=!0}if(!n&&!r&&l&&(e=this.viewer.scene.camera.pickEllipsoid(t,this.viewer.scene.globe.ellipsoid)),e){let a=this.transformCartesianToWGS84(e);return a.alt<0&&(e=this.transformWGS84ToCartesian(a,.1)),e}return!1}}transformWGS84ToCartesian(t,i){if(this.viewer)return t?Cesium.Cartesian3.fromDegrees(t.lng||t.lon,t.lat,t.alt=i||t.alt,Cesium.Ellipsoid.WGS84):Cesium.Cartesian3.ZERO}transformCartesianToWGS84(t){if(this.viewer&&t){var i=Cesium.Ellipsoid.WGS84,e=i.cartesianToCartographic(t);return{lng:Cesium.Math.toDegrees(e.longitude),lat:Cesium.Math.toDegrees(e.latitude),alt:e.height}}}dragMove(){let t=new Cesium.ScreenSpaceEventHandler(this.viewer.canvas);t.setInputAction(i=>{var e=this.getCatesian3FromPX(i.position);if(e){polygonPoints.push(e.clone()),polygonPoints.length===1&&polygonPoints.push(e.clone());var n=this.viewer.entities.add({id:"point"+polygonPoints.length,position:e,point:{color:Cesium.Color.RED,pixelSize:10}});pointEntities.push(n);let r=e.clone(),s=Cesium.Cartographic.fromCartesian(r);allPoints.push([Cesium.Math.toDegrees(s.longitude),Cesium.Math.toDegrees(s.latitude),s.height])}},Cesium.ScreenSpaceEventType.LEFT_CLICK),t.setInputAction(i=>{var e=this.getCatesian3FromPX(i.endPosition);polygonPoints.length>=2&&e&&e.x&&(polygonPoints.pop(),polygonPoints.push(e))},Cesium.ScreenSpaceEventType.MOUSE_MOVE),t.setInputAction(()=>{if(polygonPoints[polygonPoints.length-1],t.destroy(),polygonPoints.length>1){polygonPoints.pop(),allPoints.pop(),allPoints.push(allPoints[0]);var i=this.viewer.entities.getById("point"+(polygonPoints.length+1));i&&this.viewer.entities.remove(i);var e=this.viewer.entities.getById("point1");e&&this.viewer.entities.remove(e)}this.viewer.entities.remove(drawingLine);let n=null,r=-1;var s=new Cesium.ScreenSpaceEventHandler(this.viewer.canvas);s.setInputAction(l=>{const a=this.viewer.scene.pick(l.position);Cesium.defined(a)&&pointEntities.includes(a.id)&&(n=a.id,r=pointEntities.indexOf(n),this.viewer.scene.screenSpaceCameraController.enableRotate=!1,this.viewer.scene.screenSpaceCameraController.enableTranslate=!1,this.viewer.scene.screenSpaceCameraController.enableZoom=!1,this.viewer.scene.screenSpaceCameraController.enableTilt=!1,this.viewer.scene.screenSpaceCameraController.enableLook=!1)},Cesium.ScreenSpaceEventType.LEFT_DOWN),s.setInputAction(l=>{if(n){const a=this.getCatesian3FromPX(l.endPosition);a&&r!==-1&&(n.position=a,polygonPoints[r]=a,(r===0||r===polygonPoints.length-2)&&(polygonPoints[polygonPoints.length-1]=a,pointEntities[polygonPoints.length-1].position.setValue(a)))}},Cesium.ScreenSpaceEventType.MOUSE_MOVE),s.setInputAction(()=>{n=null,r=-1,this.viewer.scene.screenSpaceCameraController.enableRotate=!0,this.viewer.scene.screenSpaceCameraController.enableTranslate=!0,this.viewer.scene.screenSpaceCameraController.enableZoom=!0,this.viewer.scene.screenSpaceCameraController.enableTilt=!0,this.viewer.scene.screenSpaceCameraController.enableLook=!0},Cesium.ScreenSpaceEventType.LEFT_UP)},Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)}}class q{constructor(t){this.viewer=t,this._point=null,this._pointData=null,this._entities=[],this.publicTool=new Q(t)}get point(){return this._point}loadPoint(t){return this.createPoint(t)}getData(){return this._pointData}startCreate(){const t=this;this.handler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.handler.setInputAction(function(i){const e=t.publicTool.getCatesian3FromPX(i.position);if(!e)return;const n=t.createPoint(e);t._pointData=e,t._point=n},Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(()=>{this.destroy(),this.handler=null},Cesium.ScreenSpaceEventType.RIGHT_CLICK)}createPoint(t){const i=this;let e=Cesium.Ellipsoid.WGS84.cartesianToCartographic(t);Cesium.Math.toDegrees(e.latitude).toFixed(4).toString(),Cesium.Math.toDegrees(e.longitude).toFixed(4).toString(),e.height.toFixed(4);const n=document.createElement("div");n.style.width="300px",n.style.height="100px",n.innerHTML="<div>经度：${lon}<div><p>维度：${lat}<p><p>高程：${alti}<p>",this.viewer.cesiumWidget.container.appendChild(n);const r=this.viewer.entities.add({position:t,point:{pixelSize:10,color:Cesium.Color.YELLOW}});return i._entities.push(r),r}destroy(){this.handler&&(this.handler.destroy(),this.handler=null)}clear(){for(let t=0;t<this._entities.length;t++)this.viewer.entities.remove(this._entities[t]);this._entities=[],this._point=null}}const U="/img/background.png",j=G({__name:"MeasuringWidget",setup(C,{expose:t}){let i=h(""),e,n;function r(o){n=o.id}function s(o){e=o.pid,o.pid&&W(x.WidgetClosed,e)}const l=h([{label:"自动",value:"auto"},{label:"米",value:"meter"},{label:"公里",value:"kilometer"}]),a=h(l.value[0]),u=h(0);function d(o){return!!(i.value&&o.id===i.value)}let c;async function v(o){switch(i.value=o.id,o.id){case"SpatialDistance":break;case"GroundDistance":break;case"HorizontalArea":break;case"GroundArea":break;case"Coordinate":c=new q(g.CesiumViewer);break;case"TriangleMeasurement":break;case"ProfileAnalysis":break;default:c&&(c.destroy(),c=null);break}c&&c.startCreate()}function f(){i.value="",g.CesiumViewer.entities.removeAll(),c.destroy()}V(()=>{g.CesiumViewer&&(i.value=g.CesiumViewer.CurrentBasicID)});const w=h(!0);function b(o=!1){w.value=o,n&&o&&F.openWindowPanel(n)}t({changeVisible:b,isShow:w});const P={defaultImg:U,get itemSelected(){return i},set itemSelected(o){i=o},get widgetID(){return e},set widgetID(o){e=o},get windowID(){return n},set windowID(o){n=o},loadedHandle:r,doClosePanel:s,unitOptions:l,unitType:a,totalDistance:u,getSelectedStyle:d,get drawTools(){return c},set drawTools(o){c=o},selectItem:v,handleClearAll:f,isShow:w,changeVisible:b,get XWindow(){return L},get measurementOptions(){return R}};return Object.defineProperty(P,"__isScriptSetup",{enumerable:!1,value:!0}),P}}),K={class:"q-pa-md q-gutter-sm"},N={class:"row justify-between items-center"},Z={class:"totalDistance"},Y={class:"row q-mt-md"},J={class:"text-center textContent"};function $(C,t,i,e,n,r){return O((_(),B(e.XWindow,{isDark:!0,top:"10px",left:"10px",nWidth:"380px",nHeight:"750px",title:"图上量算",icon:"img/basicimage/arcgis_img.png",pid:"MeasuringWidget",onLoaded:e.loadedHandle,onClose:e.doClosePanel},{default:S(()=>[m(M,{style:{height:"100%"}},{default:S(()=>[p("div",K,[p("div",N,[m(T,{filled:"",dense:"",color:"grey-14","bg-color":"grey-10",modelValue:e.unitType,"onUpdate:modelValue":t[0]||(t[0]=s=>e.unitType=s),options:e.unitOptions,style:{width:"100px"}},null,8,["modelValue","options"]),m(D,{name:"delete",color:"white",style:{"font-size":"26px",cursor:"pointer"},onClick:e.handleClearAll})]),p("div",Z,[p("span",null,y(e.totalDistance),1),p("span",null,y(e.unitType.label==="自动"?"米":e.unitType.label),1)])]),p("div",Y,[(_(!0),E(X,null,z(e.measurementOptions,(s,l)=>(_(),E("div",{class:"col-4",key:l},[m(k,{flat:"",class:"cardContent column items-center",onClick:a=>e.selectItem(s)},{default:S(()=>[m(I,{rounded:"",size:"80px","font-size":"45px",color:e.getSelectedStyle(s)?"orange":"teal","text-color":"white",icon:s.icon},null,8,["color","icon"]),p("div",J,y(s.label),1)]),_:2},1032,["onClick"])]))),128))])]),_:1})]),_:1},512)),[[H,e.isShow]])}const ce=A(j,[["render",$],["__scopeId","data-v-1c3f14b7"],["__file","MeasuringWidget.vue"]]);export{ce as default};
