import{_ as x,$ as A}from"./vendor-CDV5M84i.js";import{j as u}from"./xframelib-exp-CvTEfE5n.js";import{f as E,_ as F}from"./index-DPO_t7vI.js";import{S as O}from"./SystemsEvent-BfLq_ix6.js";import{d as V,v as k,x as S,M as D,R as W}from"./@vue-exp-YaP0LnBg.js";import"./@hprose-exp-DifMA6AO.js";import"./axios-exp-BH40TtQM.js";import"./vue-router-exp-BeFgxScw.js";class l{static is(e,i){return toString.call(e)===`[object ${i}]`}static isDef=e=>typeof e<"u";static isObjectX=e=>e!=null&&e!==null&&this.is(e,"Object");static isNumber(e){return this.is(e,"Number")}static isString(e){return this.is(e,"String")}static deepMerge(e={},i={}){let t;for(t in i)e[t]=i[t];return e}}class C{show=!0;minLevel;maxLevel;weight;scale=1;offset;fontColor="#000";fontAlpha=0;fontFamily="宋体";fontSize=10;backgroundColor;backgroundAlpha;backgroundPadding;outlineColor;outlineAlpha;outlineWidth;imgUrl;imgWidth;imgHeight;labelField="name";filterField;includeValue;excludeValue;children;get font(){return this.fontSize+"px "+this.fontFamily}constructor(e){e&&this.copyFrom(e)}static fromOption(e){const i={};if(l.isNumber(e.minLevel)&&(i.minLevel=e.minLevel),l.isNumber(e.maxLevel)&&(i.maxLevel=e.maxLevel),l.isDef(e.fontSize)||l.isString(e.fontFamily)){const t=e.fontSize??10,n=e.fontFamily??"宋体";i.font=t+"px "+n}if(e.fontColor&&(i.fillColor=Cesium.Color.fromCssColorString(e.fontColor).withAlpha(e.fontAlpha??1)),l.isString(e.backgroundColor)&&(i.showBackground=!0,i.backgroundColor=Cesium.Color.fromCssColorString(e.backgroundColor).withAlpha(e.backgroundAlpha??1),i.backgroundPadding=new Cesium.Cartesian2(e.backgroundPadding,e.backgroundPadding)),e.outlineColor&&(i.style=Cesium.LabelStyle.FILL_AND_OUTLINE,i.outlineColor=Cesium.Color.fromCssColorString(e.outlineColor).withAlpha(e.outlineAlpha??1),i.outlineWidth=e.outlineWidth??2),e.imgUrl){i.image=e.imgUrl,i.width=e.imgWidth,i.height=e.imgHeight;const t=l.isNumber(e.offset)?e.offset:0;i.pixelOffset=new Cesium.Cartesian2(0,t)}else e.imgUrl===""&&(i.image=void 0);return i}clone(){const e=new C;return e.show=this.show,e.minLevel=this.minLevel,e.maxLevel=this.maxLevel,e.weight=this.weight,e.offset=this.offset,this.fontColor&&(e.fontColor=this.fontColor),l.isNumber(this.fontAlpha)&&(e.fontAlpha=this.fontAlpha),this.fontSize&&(e.fontSize=this.fontSize),this.fontFamily&&(e.fontFamily=this.fontFamily),e.backgroundColor=this.backgroundColor,e.backgroundAlpha=this.backgroundAlpha,e.backgroundPadding=this.backgroundPadding,e.outlineColor=this.outlineColor,e.outlineAlpha=this.outlineAlpha,e.outlineWidth=this.outlineWidth,e.imgUrl=this.imgUrl,e.imgWidth=this.imgWidth,e.imgHeight=this.imgHeight,e.labelField=this.labelField,e.filterField=this.filterField,e.includeValue=this.includeValue,e.excludeValue=this.excludeValue,e.children=this.children?[...this.children]:void 0,e}copyFrom(e){this.show=e.show,this.minLevel=e.minLevel,this.maxLevel=e.maxLevel,this.weight=e.weight,this.offset=e.offset,e.fontColor&&(this.fontColor=e.fontColor),l.isNumber(e.fontAlpha)&&(this.fontAlpha=e.fontAlpha),e.fontSize&&(this.fontSize=e.fontSize),e.fontFamily&&(this.fontFamily=e.fontFamily),this.backgroundColor=e.backgroundColor,this.backgroundAlpha=e.backgroundAlpha,this.backgroundPadding=e.backgroundPadding,this.outlineColor=e.outlineColor,this.outlineAlpha=e.outlineAlpha,this.outlineWidth=e.outlineWidth,this.imgUrl=e.imgUrl,this.imgWidth=e.imgWidth,this.imgHeight=e.imgHeight,e.labelField&&(this.labelField=e.labelField),this.filterField=e.filterField,this.includeValue=e.includeValue,this.excludeValue=e.excludeValue,this.children=e.children?[...e.children]:void 0}getLabelOption(){const e={show:!0,font:this.font,fillColor:Cesium.Color.fromCssColorString(this.fontColor).withAlpha(this.fontAlpha??1),style:Cesium.LabelStyle.FILL,scale:this.scale,pixelOffset:Cesium.Cartesian2.ZERO,eyeOffset:Cesium.Cartesian3.ZERO,horizontalOrigin:Cesium.HorizontalOrigin.CENTER,verticalOrigin:Cesium.VerticalOrigin.CENTER,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND,distanceDisplayCondition:new Cesium.DistanceDisplayCondition(0,2e7),disableDepthTestDistance:1e8};l.isNumber(this.weight)&&(e.eyeOffset=new Cesium.Cartesian3(0,0,-100*this.weight)),this.backgroundColor&&(e.showBackground=!0,e.backgroundColor=Cesium.Color.fromCssColorString(this.backgroundColor).withAlpha(this.backgroundAlpha??1),e.backgroundPadding=new Cesium.Cartesian2(this.backgroundPadding??7,this.backgroundPadding??5)),this.outlineColor&&(e.style=Cesium.LabelStyle.FILL_AND_OUTLINE,e.outlineColor=Cesium.Color.fromCssColorString(this.outlineColor).withAlpha(this.outlineAlpha??1),e.outlineWidth=this.outlineWidth??2);let i=0;return l.isNumber(this.offset)&&(i=this.offset,e.pixelOffset=new Cesium.Cartesian2(0,i)),this.imgUrl&&(e.image=this.imgUrl,e.width=this.imgWidth,e.height=this.imgHeight),e}getBillboardOption(){return this.imgUrl?{image:this.imgUrl,width:this.imgWidth,height:this.imgHeight}:{}}}class _{viewer;style;billboardCollection=void 0;primitiveCollection=void 0;geojsonData;lastLevel=-1;defaultStyleObject={show:!1,minLevel:3,maxLevel:5,weight:2,offset:-15,fontColor:"#EEEEEE",fontAlpha:1,fontFamily:"黑体",fontSize:16,labelField:"tsmc",filterField:"tsmc",excludeValue:"北京,北京市,中华人民共和国",outlineColor:"#000000",outlineWidth:2,imgUrl:"img/style/city2.png",imgWidth:20,imgHeight:20,children:[{weight:5,offset:-15,fontColor:"#ff0000",fontSize:16,filterField:"tsmc",includeValue:"北京",excludeValue:void 0,imgUrl:"img/style/star.png",imgWidth:20,imgHeight:20},{weight:3,offset:-15,fontColor:"#EEEEEE",fontSize:16,fontAlpha:1,fontFamily:"黑体",filterField:"tsmc",includeValue:"北京市",excludeValue:void 0,imgUrl:"img/style/city1.png",imgWidth:20,imgHeight:20},{weight:5,offset:-15,fontColor:"#EEEEEE",fontSize:16,fontFamily:"黑体",filterField:"tsmc",includeValue:"中华人民共和国",excludeValue:void 0,imgUrl:""},{weight:3,offset:-15,fontColor:"#EEEEEE",fontSize:18,fontAlpha:1,fontFamily:"黑体",filterField:"tsmc",includeValue:"北京市",excludeValue:void 0,imgUrl:"img/style/city1.png",imgWidth:20,imgHeight:20}]};list=new Array;constructor(e,i,t){this.viewer=e;const n=t??this.defaultStyleObject;if(this.style=new C(n),i){const o=this;this.loadGeoJson(i).then(function(){e.scene.postRender.addEventListener(o.renderFrame.bind(o))}.bind(this))}}async loadGeoJson(e){return this.geojsonData=await fetch(e).then(i=>i.json()),this.loadLabelEntities(),this.geojsonData}loadLabelEntities(){const e=this.geojsonData.features,i=this.style,t=this.style.getLabelOption(),n=this.style.labelField,o=this.style.filterField??n;let r;this.primitiveCollection?r=this.primitiveCollection:(r=new Cesium.LabelCollection({scene:this.viewer.scene}),this.viewer.scene.primitives.add(r),this.primitiveCollection=r);let h;if(this.billboardCollection?h=this.billboardCollection:(h=new Cesium.BillboardCollection({scene:this.viewer.scene}),this.viewer.scene.primitives.add(h),this.billboardCollection=h),e)for(let d=0;d<e.length;d++){const f=e[d],a=f.properties;if(a){const b=l.deepMerge({},t),s=this.applyLabelOption(a,o,i,b),p=a[n],c=a.minl,y=a.maxl;if(p){const g=f.geometry.coordinates;if(g){const v=Cesium.Cartesian3.fromDegrees(g[0],g[1],g[2]),w={minZoom:c,maxZoom:y,show:!1,label:void 0,billboard:void 0};if(s.image){const L={show:!1,position:v,disableDepthTestDistance:Number.POSITIVE_INFINITY,image:s.image,width:s.width,height:s.height};w.billboard=h.add(L),delete s.imagep,delete s.width,delete s.height}switch(s.show=!1,p){case"天津市":c===5&&(s.pixelOffset=new Cesium.Cartesian2(30,-5));break;case"香港特别行政区":c===5&&(s.pixelOffset=new Cesium.Cartesian2(60,-15));break;case"澳门特别行政区":c===5&&(s.pixelOffset=new Cesium.Cartesian2(-20,15));break}w.label=r.add({position:v,text:p,...s}),this.list.push(w)}}}}}applyLabelOption(e,i,t,n){let o=n;const r=e[i];let h=!1;l.isString(t.excludeValue)?h=t.excludeValue.split(",").findIndex(b=>b===r)>=0:t.excludeValue&&r===t.excludeValue&&(h=!0);let d=!0;if(t.includeValue)if(l.isNumber(t.includeValue))r!==t.includeValue&&(d=!1);else{const a=t.includeValue.split(",");a&&(d=a.indexOf(r)>=0)}if(d&&!h){const f=C.fromOption(t);return o=l.deepMerge(o,f),o}return(!d||h)&&t.children&&t.children.forEach(f=>{const a=f.filterField??i;o=this.applyLabelOption(e,a,f,o)}),o}renderFrame(){if(!this.viewer)return;const e=this.viewer.zoom;if(this.lastLevel!=-1){const i=Math.floor(e),t=Math.floor(this.lastLevel);if(this.lastLevel=e,i===t)return}else this.lastLevel=e;this.list.forEach(i=>{i.minZoom<=e&&e<=i.maxZoom?(i.label.show=!0,i.billboard&&(i.billboard.show=!0)):(i.label.show=!1,i.billboard&&(i.billboard.show=!1))})}removeAll(){this.billboardCollection&&this.billboardCollection.removeAll(),this.primitiveCollection&&this.primitiveCollection.removeAll()}}const U=V({setup(){Cesium.Camera.DEFAULT_VIEW_FACTOR=.4,Cesium.Camera.DEFAULT_VIEW_RECTANGLE=Cesium.Rectangle.fromDegrees(108,10,116,60),u.Config.Enables.CesiumOfflineCache&&window.CesiumOfflineCache?.ruleList?.add("*");function m(){try{const t=new A("cesiumContainer",{animation:!1,baseLayerPicker:!1,fullscreenButton:!1,geocoder:!1,homeButton:!1,infoBox:!1,sceneModePicker:!1,selectionIndicator:!1,timeline:!1,navigationHelpButton:!1,vrButton:!1,scene3DOnly:!0,fullscreenElement:document.body,navigationInstructionsInitiallyVisible:!1,contextOptions:{webgl:{alpha:!0,depth:!1,stencil:!0,antialias:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!0,failIfMajorPerformanceCaveat:!1}},requestRenderMode:!1,targetFrameRate:60,orderIndependentTranslucency:!1,automaticallyTrackDataSourceClocks:!1,dataSources:void 0,terrainShadows:Cesium.ShadowMode.DISABLED,baseLayer:!1,terrainProvider:new Cesium.EllipsoidTerrainProvider,shouldAnimate:!0});return t.setOptions({globe:{showGroundAtmosphere:!1,depthTestAgainstTerrain:!1},showAtmosphere:!1,showMoon:!1,showSun:!1,showFog:!1,enableFxaa:!0,skyBox:{show:!1}}),t.clock.currentTime=Cesium.JulianDate.fromDate(new Date),t.cesiumWidget.creditContainer.style.display="none",t.cesiumWidget._supportsImageRenderingPixelated&&(t.resolutionScale=window.devicePixelRatio),t}catch(t){u.Message.err("Cesium Viewer初始化失败！"),u.Logger().error("Cesium Viewer初始化失败",t)}}function e(t){try{const n=new _(t,"cesium/chinaData.json")}catch{}}let i;k(()=>{u.CesiumViewer=m(),u.CesiumViewer&&(i=u.CesiumViewer,i.setBasicLayer(x.ARCGIS_IMG,{},{maximumLevel:10}),e(u.CesiumViewer)),E(O.CesiumWidgetLoaded,u.CesiumViewer)}),S(()=>{})}}),I={id:"cesiumContainer",style:{width:"100vw",height:"100vh"}};function N(m,e,i,t,n,o){return W(),D("div",I)}const G=F(U,[["render",N],["__file","CesiumViewerWidget.vue"]]);export{G as default};
