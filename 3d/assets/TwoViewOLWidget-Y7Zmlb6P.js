import{d as _}from"./@vue-exp-YaP0LnBg.js";import{_ as C}from"./index-BTOrG-4i.js";import"./vendor-CDV5M84i.js";import"./@hprose-exp-DifMA6AO.js";import"./xframelib-exp-CvTEfE5n.js";import"./axios-exp-BH40TtQM.js";import"./vue-router-exp-BeFgxScw.js";const G=_({__name:"TwoViewOLWidget",setup(V,{expose:p}){p();function u(e){const n=e.camera.pickEllipsoid(new Cesium.Cartesian2(e.canvas.clientWidth/2,e.canvas.clientHeight/2)),a=Cesium.Ellipsoid.WGS84.cartesianToCartographic(n),i=a.longitude*180/Math.PI,r=a.latitude*180/Math.PI;return{lon:i,lat:r}}let t;function d(){const e=u(Global.CesiumViewer),n=Global.Config.MapKeys?.TDTKey;let a=new TileLayer({source:new XYZ({url:"http://t4.tianditu.com/DataServer?T=vec_w&x={x}&y={y}&l={z}&tk="+n})}),i=new TileLayer({source:new XYZ({url:"http://t3.tianditu.com/DataServer?T=cva_w&x={x}&y={y}&l={z}&tk="+n})});t=new Map({target:"otherContainer",layers:[],view:new View({center:transform([e.lon,e.lat],"EPSG:4326","EPSG:3857"),zoom:4})}),t.addLayer(a),t.addLayer(i),t.addControl(new Rotate({autoHide:!1}))}let o=document.getElementById("otherContainer");function w(e,n){o||(o=document.getElementById("otherContainer"));let a=o.offsetTop,i=a+o.clientHeight,r=o.offsetLeft,c=r+o.clientWidth;return!(e<r||e>c||n<a||n>i)}let l=!1;function m(e){l=w(e.pageX,e.pageY)}function s(){if(l){const e=t.getView().calculateExtent(),n=transformExtent(e,"EPSG:3857","EPSG:4326");let i=360-t.getView().getRotation()%6.283*100*.57297;Global.CesiumViewer.camera.setView({destination:Cesium.Rectangle.fromDegrees(n[0],n[1],n[2],n[3]),orientation:{heading:Cesium.Math.toRadians(i)}})}}function g(){const e=Global.CesiumViewer.camera.computeViewRectangle(),n=e.west/Math.PI*180,a=e.north/Math.PI*180,i=e.east/Math.PI*180,r=e.south/Math.PI*180;if(!l)if(a>87&&r<-87){const c=u(Global.CesiumViewer);t.getView().setZoom(0),t.getView().setCenter(transform([c.lon,c.lat],"EPSG:4326","EPSG:3857"))}else{t.getView().fit(transformExtent([n,r,i,a],"EPSG:4326","EPSG:3857"));let M=(360-Global.CesiumViewer.camera.heading/Math.PI*180)/100/.5837;t.getView().setRotation(M)}}function f(){t.getView().on("change:center",s),t.getView().on("change:rotation",s),Global.CesiumViewer.cesiumWidget.container.parentElement.parentElement.parentElement.parentElement.addEventListener("mousemove",m),Global.CesiumViewer.scene.preRender.addEventListener(g)}function h(){t.getView().un("change:center",s),t.getView().un("change:rotation",s),Global.CesiumViewer.scene.preRender.removeEventListener(g),Global.CesiumViewer.cesiumWidget.container.parentElement.parentElement.parentElement.parentElement.removeEventListener("mousemove",m),Global.olmap=null}onMounted(()=>{Global.LayoutManager?.isWidgetLoaded("twoViewMBWidget")&&Global.LayoutManager?.unloadWidget("twoViewMBWidget"),EmitMsg(SystemEvents.WidgetClosed,"twoViewMBWidget"),o=document.getElementById("otherContainer"),o||Global.LayoutManager?.loadWidget("twoViewWidget");const e=setInterval(()=>{o=document.getElementById("otherContainer"),o&&(d(),Global.olmap=t,f(),clearInterval(e))},100)}),onUnmounted(()=>{h(),t.dispose(),Global.LayoutManager?.isWidgetLoaded("twoViewMBWidget")||Global.LayoutManager?.unloadWidget("twoViewWidget")});const E={getCenterPosition:u,get olMap(){return t},set olMap(e){t=e},initMap:d,get mapDiv(){return o},set mapDiv(e){o=e},isMouseIn2DMap:w,get isIn2DMapFlag(){return l},set isIn2DMapFlag(e){l=e},mouseMoveEvent:m,changeCenterListener:s,getViewCameraRectrange:g,addListener:f,removeListener:h};return Object.defineProperty(E,"__isScriptSetup",{enumerable:!1,value:!0}),E}});function v(V,p,u,t,d,o){return null}const S=C(G,[["render",v],["__file","TwoViewOLWidget.vue"]]);export{S as default};
