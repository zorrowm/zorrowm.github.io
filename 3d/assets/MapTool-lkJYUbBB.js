import{B as l}from"./xframelib-exp-CBRV2soX.js";var _=(o=>(o[o.TDT_None=-1]="TDT_None",o[o.TDT_Img=0]="TDT_Img",o[o.TDT_Vec=1]="TDT_Vec",o[o.TDT_Ter=2]="TDT_Ter",o))(_||{});const u=["img_w","vec_w","ter_w"];class n{accessToken="pk.eyJ1IjoiY2hyaXNuaW5nIiwiYSI6ImNrZzk3dmNveTA2cGUycXAyNXJ3bWNsOHMifQ._4oFj3iqj5yWWvbuONDYnw";UpdateStyleJson(e,t){if(!(!e||!t))try{typeof t=="string"&&(t=JSON.stringify(t)),t&&(e.setStyle(t),e.setCenter(t.center),e.setZoom(t.zoom))}catch(i){l.Logger().debug(i)}}MapLayerVisible(e,t,i=!0){e&&(e.setLayoutProperty(t,"visibility",i?"visible":"none"),e.setZoom(e?.getZoom()+1e-4))}async ZoomByfitBounds(e,t){if(!e)return;let i=await window.turfAsync.bbox(t);const r=[[i[0],i[1]],[i[2],i[3]]];e.fitBounds(r,{padding:{top:100,bottom:100,left:100,right:100}})}AppendTDTLayer(e,t=-1){const i=e.getSource("img_w");i?i.tiles=this.GetTDTSources("img_w"):(e.addSource("img_w",{type:"raster",tiles:this.GetTDTSources("img_w"),minzoom:1,tileSize:256}),e.addLayer({id:"img_w",type:"raster",paint:{},layout:{visibility:t==0?"visible":"none"},source:"img_w"}),e.addSource("cia_w",{type:"raster",tiles:this.GetTDTSources("cia_w"),minzoom:1,tileSize:256}),e.addLayer({id:"cia_w",type:"raster",paint:{},layout:{visibility:t==0?"visible":"none"},source:"cia_w"}));const r=e.getSource("vec_w");r?r.tiles=this.GetTDTSources("vec_w"):(e.addSource("vec_w",{type:"raster",tiles:this.GetTDTSources("vec_w"),minzoom:1,tileSize:256}),e.addLayer({id:"vec_w",type:"raster",paint:{},layout:{visibility:t==1?"visible":"none"},source:"vec_w"}),e.addSource("cva_w",{type:"raster",tiles:this.GetTDTSources("cva_w"),minzoom:1,tileSize:256}),e.addLayer({id:"cva_w",type:"raster",paint:{},layout:{visibility:t==1?"visible":"none"},source:"cva_w"}));const s=e.getSource.ter_w;s?s.tiles=this.GetTDTSources("ter_w"):(e.addSource("ter_w",{type:"raster",tiles:this.GetTDTSources("ter_w"),minzoom:1,tileSize:256}),e.addLayer({id:"ter_w",type:"raster",paint:{},layout:{visibility:t==2?"visible":"none"},source:"ter_w"})),n.CurrentBaseLayer=t}StyleAppendTDTLayer(e,t=-1){const i=e.sources.img_w;i?i.tiles=this.GetTDTSources("img_w"):(e.sources.cia_w={type:"raster",tiles:this.GetTDTSources("cia_w"),minzoom:1,tileSize:256},e.layers.unshift({id:"cia_w",type:"raster",paint:{},layout:{visibility:t==0?"visible":"none"},source:"cia_w"}),e.sources.img_w={type:"raster",tiles:this.GetTDTSources("img_w"),minzoom:1,tileSize:256},e.layers.unshift({id:"img_w",type:"raster",paint:{},layout:{visibility:t==0?"visible":"none"},source:"img_w"}));const r=e.sources.vec_w;r?r.tiles=this.GetTDTSources("vec_w"):(e.sources.cva_w={type:"raster",tiles:this.GetTDTSources("cva_w"),minzoom:1,tileSize:256},e.layers.unshift({id:"cva_w",type:"raster",paint:{},layout:{visibility:t==1?"visible":"none"},source:"cva_w"}),e.sources.vec_w={type:"raster",tiles:this.GetTDTSources("vec_w"),minzoom:1,tileSize:256},e.layers.unshift({id:"vec_w",type:"raster",paint:{},layout:{visibility:t==1?"visible":"none"},source:"vec_w"}));const s=e.sources.ter_w;return s?s.tiles=this.GetTDTSources("ter_w"):(e.sources.cta_w={type:"raster",tiles:this.GetTDTSources("cta_w"),minzoom:1,tileSize:256},e.layers.unshift({id:"cta_w",type:"raster",paint:{},layout:{visibility:t==2?"visible":"none"},source:"cta_w"}),e.sources.ter_w={type:"raster",tiles:this.GetTDTSources("ter_w"),minzoom:1,tileSize:256},e.layers.unshift({id:"ter_w",type:"raster",paint:{},layout:{visibility:t==2?"visible":"none"},source:"ter_w"})),n.CurrentBaseLayer=t,e}GetTDTSources(e="vec_w"){const t=new Array;let i=l.Config.MapKeys?.TDTKey;if((!i||i.length==0)&&(i=["5d27dc75ca0c3bdf34f657ffe1e9881d","587e4b30b61cde5c55680135140dc980","1eafc8f4338343058a4876033f55b7b6"]),i){const r=i.length;for(let s=0;s<=7;s++){const a=Math.floor(Math.random()*r),c=i[a],y=`https://t${s}.tianditu.gov.cn/DataServer?T=${e}&x={x}&y={y}&l={z}&tk=${c}`;t.push(y)}}return t}static CurrentBaseLayer;ChangeBaseLayer(e,t=-1){if(!(!n.CurrentBaseLayer&&n.CurrentBaseLayer!=0)&&e){switch(t){case-1:this.MapLayerVisible(e,u[n.CurrentBaseLayer],!1);break;case 0:case 1:case 2:this.MapLayerVisible(e,u[n.CurrentBaseLayer],!1),this.MapLayerVisible(e,u[t]);break}n.CurrentBaseLayer=t}}GetEmptyStyle(e,t=8){return{version:8,layers:[],sources:{},center:e??[120.9896976107645,23.98274001469663],zoom:t,glyphs:"https://gis-map.digsur.com/Resource/fonts/00065a33-7951-4250-b1b2-ab7b871a4aa3/{fontstack}/{range}"}}GetTDTBaseStyle(e,t=0,i=8){const r=this.GetEmptyStyle(e,i);return this.StyleAppendTDTLayer(r,t)}GetMapPrintData(e){if(!e)return null;e._preserveDrawingBuffer=!0,e._render(0);var t=e.getCanvas().toDataURL("image/png"),i=document.createElement("a");i.href=t,i.download="打印.png",i.click(),e._preserveDrawingBuffer=!1,e._render(0)}base64ToBlob(e){let t=e.split(";base64,"),i=t[0].split(":")[1],r=window.atob(t[1]),s=r.length,a=new Uint8Array(s);for(let c=0;c<s;c++)a[c]=r.charCodeAt(c);return new Blob([a],{type:i})}}const d=new n;export{d as M,_ as T};
