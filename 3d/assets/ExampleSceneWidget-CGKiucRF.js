import{n as oe,B as ae,z as le,A as ue,o as P,p as L,q as U}from"./vendor-6kqmRazU.js";import{f as ce,_ as me}from"./index-CTmLOYTS.js";import{W as de}from"./WidgetsEvent-TR_R_5Fb.js";import{j as i,E as Ce,d as pe}from"./xframelib-exp-CPl8XRlL.js";import{d as fe,ac as j,r as f,v as ge,M as w,z as we,G as ve,Q as l,a1 as u,L as m,a9 as g,N as v,Z as q,X as A,R as x,a8 as G,$ as xe}from"./@vue-exp-BA8o4xMK.js";import"./@hprose-exp-BDOQuVAD.js";import"./vue-router-exp-BxGuMefC.js";import"./axios-exp-BH40TtQM.js";const ye=fe({__name:"ExampleSceneWidget",async setup(K,{expose:o}){let d,t;const W=([d,t]=j(async()=>([d,t]=j(()=>fetch("/config/modelExamplesConfig.json")),d=await d,t(),d).json()),d=await d,t(),d).datas;let p=f(""),c="ExampleSceneWidget",a="";function F(e){a=e.id}function X(e){c=e.pid,e.pid&&ce(de.WidgetClosed,c)}function J(e){let s="";return p.value&&e.id===p.value&&(s="cardSelected"),s}let n;const _=f(!1);async function Z(e){switch(p.value=e.id,e.type){}try{if(n=await Cesium.Cesium3DTileset.fromUrl(e.source),!n)return;if(e.type!=="bim")_.value=!1,i.CesiumViewer.scene.primitives._primitives.forEach(s=>{s._url&&i.CesiumViewer.scene.primitives.remove(s)}),i.CesiumViewer.scene.primitives.add(n),i.CesiumViewer.zoomTo(n);else{if(e.id==="bim1"?(_.value=!0,i.CesiumViewer.screenSpaceEventHandler.setInputAction(r=>{H(r)},Cesium.ScreenSpaceEventType.LEFT_CLICK)):_.value=!1,e.id==="bim2"){const r=n.boundingSphere.center,I=Cesium.Cartesian3.fromDegrees(117.24874313191381,31.845607818553628),S=Cesium.Transforms.eastNorthUpToFixedFrame(I),T=Cesium.Matrix4.inverse(S,new Cesium.Matrix4),D=Cesium.Matrix4.fromScale(new Cesium.Cartesian3(.001,.001,.001)),k=Cesium.Matrix4.multiply(D,T,new Cesium.Matrix4),y=Cesium.Matrix4.multiply(S,k,new Cesium.Matrix4),h=Cesium.Cartographic.fromCartesian(r),M=Cesium.Cartographic.fromDegrees(117.24874313191381,31.845607818553628),b=Cesium.Cartesian3.fromRadians(h.longitude,h.latitude,0),te=Cesium.Cartesian3.fromRadians(M.longitude,M.latitude),se=Cesium.Cartesian3.subtract(te,b,new Cesium.Cartesian3),re=Cesium.Matrix4.fromTranslation(se),ne=Cesium.Matrix4.multiply(y,re,new Cesium.Matrix4);n.modelMatrix=ne}i.CesiumViewer.scene.primitives._primitives.findIndex(r=>r._url===n._url)===-1?(i.CesiumViewer.scene.primitives.add(n),i.CesiumViewer.zoomTo(n)):(i.CesiumViewer.scene.primitives._primitives.forEach(r=>{r._url===n._url&&i.CesiumViewer.scene.primitives.remove(r)}),i.CesiumViewer.scene.primitives.add(n),i.CesiumViewer.zoomTo(n))}}catch(s){throw i.Message.err("模型加载失败"),s}}let C;function Y(){n.style=void 0,C=void 0}function $(){E("B1"),C="B1"}function ee(e){const s="F"+e;E(s)}function E(e){C=e,n.style=new Cesium.Cesium3DTileStyle({color:{conditions:[["${标高} ==='"+e+"' || ${底部约束} ==='"+e+"'","rgb(255, 255, 255)"],["true","rgba(255, 255, 255,0.03)"]]}})}const N=f(""),R=f(""),B=f(""),Q=f("");function H(e){i.Logger().info(e.position);var s=i.CesiumViewer.scene.pick(e.position);let r;Cesium.defined(s)&&(N.value=s.getProperty("file"),R.value=s.getProperty("id"),B.value=s.getProperty("name"),Q.value=s.getProperty("标高")?s.getProperty("标高"):s.getProperty("底部约束"),r=JSON.stringify(s.getProperty("id")),C?n.style=new Cesium.Cesium3DTileStyle({color:{conditions:[["${id} === "+r,'color("cyan", 0.7)'],["${标高} ==='"+C+"' || ${底部约束} ==='"+C+"'","rgb(255, 255, 255)"],["true","rgba(255, 255, 255,0.03)"]]}}):n.style=new Cesium.Cesium3DTileStyle({color:{conditions:[["${id} === "+r,'color("cyan", 0.7)']]}}))}function ie(){const e=new Cesium.ScreenSpaceEventHandler(i.CesiumViewer.scene.canvas);e.setInputAction(s=>{let r=i.CesiumViewer.scene.pick(s.position);r!=null&&(r.primitive.silhouetteColor=Cesium.Color.RED,r.primitive.silhouetteSize=3,e.setInputAction(I=>{const S=Cesium.Transforms.eastNorthUpToFixedFrame(Cesium.Matrix4.getTranslation(r.primitive.modelMatrix,new Cesium.Cartesian3),Cesium.Ellipsoid.WGS84,new Cesium.Matrix4),T=Cesium.Matrix4.multiply(Cesium.Matrix4.inverse(S,new Cesium.Matrix4),r.primitive.modelMatrix,new Cesium.Matrix4),D=Cesium.Matrix4.getRotation(T,new Cesium.Matrix3),k=Cesium.Quaternion.fromRotationMatrix(D),y=Cesium.HeadingPitchRoll.fromQuaternion(k),h=new Cesium.HeadingPitchRoll(y.heading,y.pitch,y.roll);var M=i.CesiumViewer.scene.globe.pick(i.CesiumViewer.camera.getPickRay(I.endPosition),i.CesiumViewer.scene);const b=Cesium.Transforms.headingPitchRollToFixedFrame(M,h,Cesium.Ellipsoid.WGS84,Cesium.Transforms.eastNorthUpToFixedFrame,new Cesium.Matrix4);r.primitive.modelMatrix=b},Cesium.ScreenSpaceEventType.MOUSE_MOVE))},Cesium.ScreenSpaceEventType.LEFT_CLICK)}ge(()=>{i.CesiumViewer&&(p.value=i.CesiumViewer.CurrentBasicID,i.CesiumViewer.screenSpaceEventHandler.setInputAction(e=>{},Cesium.ScreenSpaceEventType.LEFT_CLICK))});const V=f(!0);function z(e=!1){V.value=e,a&&e&&pe.openWindowPanel(a)}o({changeVisible:z,isShow:V});const O={exampleList:W,get itemSelected(){return p},set itemSelected(e){p=e},get widgetID(){return c},set widgetID(e){c=e},get windowID(){return a},set windowID(e){a=e},loadedHandle:F,doClosePanel:X,getSelectedStyle:J,get tileset(){return n},set tileset(e){n=e},isFloored:_,selectItem:Z,get currentLayer(){return C},set currentLayer(e){C=e},showAll:Y,minusOne:$,show:ee,showCengByStyle:E,modelName:N,featureID:R,featureName:B,featureFloor:Q,clickHighlight:H,moveModel:ie,isShow:V,changeVisible:z,get XWindow(){return Ce}};return Object.defineProperty(O,"__isScriptSetup",{enumerable:!1,value:!0}),O}}),_e={class:"row q-col-gutter-sm"},Se={class:"text-center textContent"},he={key:0,class:"infobox"},Me={key:1,class:"container"};function Fe(K,o,d,t,W,p){return x(),w(A,null,[we(l(t.XWindow,{isDark:!0,top:"10px",left:"10px",nWidth:"280px",hHeight:"350px",title:"模型示例",icon:"img/basicimage/arcgis_img.png",pid:"ExampleSceneWidget",onLoaded:t.loadedHandle,onClose:t.doClosePanel},{default:u(()=>[l(ae,{style:{height:"100%"}},{default:u(()=>[m("div",_e,[(x(!0),w(A,null,G(t.exampleList,(c,a)=>(x(),w("div",{class:"col-6",key:a},[l(le,{class:xe(["cardContent",t.getSelectedStyle(c)]),onClick:F=>t.selectItem(c)},{default:u(()=>[l(ue,{src:c.img,height:"75px"},null,8,["src"]),m("div",Se,v(c.label),1)]),_:2},1032,["class","onClick"])]))),128))])]),_:1})]),_:1},512),[[ve,t.isShow]]),t.isFloored?(x(),w("div",he,[m("div",null,[o[0]||(o[0]=m("span",null,"模型名称：",-1)),g(" "+v(t.modelName),1)]),m("div",null,[o[1]||(o[1]=m("span",null,"要素ID：",-1)),g(" "+v(t.featureID),1)]),m("div",null,[o[2]||(o[2]=m("span",null,"要素名称：",-1)),g(" "+v(t.featureName),1)]),m("div",null,[o[3]||(o[3]=m("span",null,"要素所在楼层：",-1)),g(" "+v(t.featureFloor),1)])])):q("",!0),t.isFloored?(x(),w("div",Me,[l(oe,{bordered:"",separator:""},{default:u(()=>[(x(),w(A,null,G(5,(c,a)=>l(P,{clickable:"",key:a,onClick:F=>t.show(a+5-a*2),class:"text-center"},{default:u(()=>[l(L,null,{default:u(()=>[g(v(a+5-a*2)+"F",1)]),_:2},1024)]),_:2},1032,["onClick"])),64)),l(P,{clickable:"",onClick:t.minusOne,class:"text-center"},{default:u(()=>[l(L,null,{default:u(()=>[l(U,null,{default:u(()=>o[4]||(o[4]=[g("-1F")])),_:1})]),_:1})]),_:1}),l(P,{clickable:"",onClick:t.showAll,class:"text-center"},{default:u(()=>[l(L,null,{default:u(()=>[l(U,null,{default:u(()=>o[5]||(o[5]=[g("整体")])),_:1})]),_:1})]),_:1})]),_:1})])):q("",!0)],64)}const Le=me(ye,[["render",Fe],["__scopeId","data-v-e260eb3c"],["__file","ExampleSceneWidget.vue"]]);export{Le as default};
