import{m as y}from"./mapbox-gl-exp-DU9l5VU8.js";import{j as t}from"./xframelib-exp-CvTEfE5n.js";import{d as P,v as S,x as z}from"./@vue-exp-YaP0LnBg.js";import{_ as B}from"./index-DPO_t7vI.js";import"./@hprose-exp-DifMA6AO.js";import"./vendor-CDV5M84i.js";import"./axios-exp-BH40TtQM.js";import"./vue-router-exp-BeFgxScw.js";const R=P({__name:"TwoViewMBWidget",setup(D,{expose:f}){f();function g(e){const i=e.camera.pickEllipsoid(new Cesium.Cartesian2(e.canvas.clientWidth/2,e.canvas.clientHeight/2)),n=Cesium.Ellipsoid.WGS84.cartesianToCartographic(i),m=n.longitude*180/Math.PI,l=n.latitude*180/Math.PI;return{lon:m,lat:l}}let o=document.getElementById("otherContainer");y.accessToken=t.Config.MapKeys?.MapboxKey;const c=t.Config.MapKeys?.TDTKey[0],u=g(t.CesiumViewer);let a;function M(){const e={type:"raster",tiles:["http://t5.tianditu.gov.cn/DataServer?T=vec_w&x={x}&y={y}&l={z}&tk="+c],tileSize:256},i={type:"raster",tiles:["http://t6.tianditu.gov.cn/DataServer?T=cva_w&x={x}&y={y}&l={z}&tk="+c],tileSize:256};a=new y.Map({container:"otherContainer",style:{version:8,sources:{tdtVec:e,tdtCva:i},layers:[{id:"tdtVec",type:"raster",source:"tdtVec",minzoom:0,maxzoom:22},{id:"tdtCva",type:"raster",source:"tdtCva",minzoom:0,maxzoom:22}]},center:[u.lon,u.lat],zoom:2}),a.addControl(new y.NavigationControl)}let s="mapbox";t.CesiumViewer.scene.screenSpaceCameraController.tiltEventTypes=[Cesium.CameraEventType.RIGHT_DRAG],t.CesiumViewer.scene.screenSpaceCameraController.zoomEventTypes=[Cesium.CameraEventType.WHEEL];function x(e,i){return 2*Math.PI*6378137/Math.pow(2,i)/2/Math.tan(e.transform._fov/2)}function v(){let e=a.getPitch(),{lng:i,lat:n}=a.getCenter(),m=a.getZoom(),l=x(a,m),r=a.getBearing();r<0&&(r=r+360);let h=Cesium.Math.toRadians(r),w=Cesium.Cartesian3.fromDegrees(i,n),p=Cesium.Math.toRadians(e-90+.01),d=l/Math.sin((90-e)*Math.PI/180);t.CesiumViewer.camera.lookAt(w,new Cesium.HeadingPitchRange(h,p,d*Math.sin((90-e)*Math.PI/180)))}function V(){let e={minx:0,miny:0,maxx:0,maxy:0},i=t.CesiumViewer.camera.computeViewRectangle();if(typeof i>"u"){let n=t.CesiumViewer.scene.canvas,m=new Cesium.Cartesian2(0,0),l=new Cesium.Cartesian2(n.clientWidth,n.clientHeight),r=t.CesiumViewer.scene.globe.ellipsoid,h=t.CesiumViewer.camera.pickEllipsoid(m,r),w=t.CesiumViewer.camera.pickEllipsoid(l,r),p=t.CesiumViewer.scene.globe.ellipsoid.cartesianToCartographic(h),d=t.CesiumViewer.scene.globe.ellipsoid.cartesianToCartographic(w),L=Cesium.Math.toDegrees(p.longitude),b=Cesium.Math.toDegrees(d.longitude),W=Cesium.Math.toDegrees(d.latitude),I=Cesium.Math.toDegrees(p.latitude);e.minx=L,e.maxx=b,e.miny=W,e.maxy=I}else e.minx=Cesium.Math.toDegrees(i.east),e.maxx=Cesium.Math.toDegrees(i.north),e.miny=Cesium.Math.toDegrees(i.west),e.maxy=Cesium.Math.toDegrees(i.south);return e}function C(){if(s=="cesium"){let e=t.CesiumViewer.camera.heading/Math.PI*180,i=t.CesiumViewer.camera.pitch/Math.PI*180;a.setBearing(e),a.setPitch(i+90);let n=V();a.fitBounds([[n.miny,n.maxy],[n.minx,n.maxx]])}}function T(){a.on("mousedown",i=>{s="mapbox"}),a.on("move",i=>{s=="mapbox"&&v()}),t.CesiumViewer.scene.preRender.addEventListener(C).bind(t.CesiumViewer.camera),new Cesium.ScreenSpaceEventHandler(t.CesiumViewer.scene.canvas).setInputAction(function(i){s="cesium",t.CesiumViewer.camera.lookAtTransform(Cesium.Matrix4.IDENTITY)},Cesium.ScreenSpaceEventType.LEFT_DOWN)}function _(){t.CesiumViewer.scene.preRender.removeEventListener(C),t.mbmap=null,a.remove()}S(()=>{t.LayoutManager?.isWidgetLoaded("twoViewOLWidget")&&t.LayoutManager?.unloadWidget("twoViewOLWidget"),o=document.getElementById("otherContainer"),o||t.LayoutManager?.loadWidget("twoViewWidget");const e=setInterval(()=>{o=document.getElementById("otherContainer"),o&&(M(),t.mbmap=a,T(),clearInterval(e))},100)}),z(()=>{_(),t.LayoutManager?.isWidgetLoaded("twoViewOLWidget")||t.LayoutManager?.unloadWidget("twoViewWidget")});const E={getCenterPosition:g,get mapDiv(){return o},set mapDiv(e){o=e},TDTToken:c,center:u,get mbMap(){return a},set mbMap(e){a=e},initMap:M,get mapType(){return s},set mapType(e){s=e},getElevationByZoom:x,updateCesiumCamera:v,getCesiumViewerExtend:V,updateMB:C,addListener:T,removeListener:_};return Object.defineProperty(E,"__isScriptSetup",{enumerable:!1,value:!0}),E}});function k(D,f,g,o,c,u){return null}const Z=B(R,[["render",k],["__file","TwoViewMBWidget.vue"]]);export{Z as default};
