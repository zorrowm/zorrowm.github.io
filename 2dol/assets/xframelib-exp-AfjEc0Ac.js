import{U as fe,W as ie,Y as me,a5 as Pn,e as gr,Q as Z,G as mr,$ as _e,a6 as zo,V as G,F as ke,a7 as Pe,X as ne,r as Y,d as Me,P as X,E as vr,L as yr,a8 as Jt,a3 as on,a9 as Uo,c as ht,M as wr,aa as we,w as xe,a as Ne,b as sn,A as qo,Z as Ie,J as Fo,D as Xo,v as Dt,o as Vo,S as yt,m as Ko,n as _r,C as Yo}from"./@vue-exp-Mkau1HGZ.js";import{a as Jo}from"./axios-exp-C7rfqWEd.js";import{f as de,q as Go,g as it,h as Qo}from"./vendor-OKllBdZ9.js";import{I as Pt}from"./@iconify/vue-exp-DwwUNauw.js";function Bt(n){return window.TouchEvent&&n instanceof TouchEvent}class ce{e;constructor(e){this.e=e}stopPropagation(){this.e.stopPropagation()}preventDefault(){this.e.preventDefault()}get clientX(){return Bt(this.e)?(this.e.type==="touchend"?this.e.changedTouches:this.e.touches).item(0).clientX:this.e.clientX}get clientY(){return Bt(this.e)?(this.e.type==="touchend"?this.e.changedTouches:this.e.touches).item(0).clientY:this.e.clientY}get clientCoord(){return new an(this.clientX,this.clientY)}static bindDown(e,t,r,o=!1){const i=c=>{t(new ce(c))},s=c=>{c.touches.length===1&&t(new ce(c)),c.touches.length>1&&r&&r(new ce(c))};return e.addEventListener("mousedown",i,o),e.addEventListener("touchstart",s,o),()=>{e.removeEventListener("mousedown",i,o),e.removeEventListener("touchstart",s,o)}}static bindMove(e,t,r=!1){const o=s=>{t(new ce(s))},i=s=>{s.touches.length===1&&t(new ce(s))};return e.addEventListener("mousemove",o,r),e.addEventListener("touchmove",i,r),()=>{e.removeEventListener("mousemove",o,r),e.removeEventListener("touchmove",i,r)}}static bindUp(e,t,r=!1){const o=s=>{t(new ce(s))},i=s=>{s.touches.length===0&&t(new ce(s))};return e.addEventListener("mouseup",o,r),e.addEventListener("touchend",i,r),()=>{e.removeEventListener("mouseup",o,r),e.removeEventListener("touchend",i,r)}}originalEvent({mouse:e,touch:t}){Bt(this.e)?t&&t(this.e):e&&e(this.e)}}class an{x;y;constructor(e,t){this.x=e,this.y=t}clone(){return new an(this.x,this.y)}}class Zo{handle;container;options;unbindDown;unbindMove;unbindUp;constructor(e,t,r={}){this.handle=e,this.container=t,this.options=r,e&&(this.unbindDown=ce.bindDown(e,this.mousedown),e.classList.add("draggable-handle"))}teardown(){this.handle?.classList.remove("draggable-handle"),this.unbindDown&&this.unbindDown(),this.unbindUp&&this.unbindUp(),this.unbindMove&&this.unbindMove()}offsetX;offsetY;mousedown=e=>{e.preventDefault(),this.handle&&(this.offsetX=e.clientX,this.offsetY=e.clientY),this.options.onMoveStart&&this.options.onMoveStart(),this.unbindMove=ce.bindMove(document,this.mousemove),this.unbindUp=ce.bindUp(document,this.mouseup)};mousemove=e=>{this.container&&(this.container.style.left=`calc(${e.clientX-this.offsetX}px + ${this.container.style.left})`,this.container.style.top=`calc(${e.clientY-this.offsetY}px + ${this.container.style.top})`,this.offsetX=e.clientX,this.offsetY=e.clientY),this.options.onMove&&this.options.onMove()};mouseup=e=>{this.options.onMoveEnd&&this.options.onMoveEnd(),this.unbindUp(),this.unbindMove(),this.unbindUp=this.unbindMove=void 0}}class ei{_group;onChange;zIndex;constructor(e,t){this._group=e,this.onChange=t,this.a(r=>r.push(this))}set group(e){this._group=e;const t=at(this._group),r=at(e);t.splice(t.indexOf(this),1),r.push(this),Bn()}get group(){return this._group}unregister(){this.a(e=>e.splice(e.indexOf(this),1))}raise(){this.a(e=>{e.splice(e.indexOf(this),1),e.push(this)})}a(e){e(at(this._group)),Bn()}}const st=new Map,ti=0;function at(n){return st.has(n)||st.set(n,[]),st.get(n)}function br(n,e){return n>e?-br(e,n):n<0&&e>=0?1:n-e}function Bn(){let n=ti;for(const e of function(t){const r=[];return t.forEach((o,i)=>r.push(i)),r}(st).sort(br))for(const t of at(e))n!=t.zIndex&&(t.zIndex=n,t.onChange(n)),n++}function Gt(n){if(n){const{width:e,height:t}=n.style;n.style.width="auto",n.style.height="auto";const r=ct(n);return n.style.width=e,n.style.height=t,r}return{width:0,height:0,top:0,left:0,bottom:0,right:0}}function ct(n){const e=n.getBoundingClientRect(),t=e.width,r=e.height,o=e.top,i=e.left;return{width:t,height:r,top:o,left:i,bottom:o+r,right:i+t}}class ni{container;options;handles;constructor(e,t){if(this.container=e,this.options=t,e&&t){this.handles=Sr.map(p=>new p(e,this));const{width:r,height:o}=Gt(e),i=t.maxWidth||window.innerWidth,s=t.maxHeight||window.innerHeight;let c=!1;(r<t.minWidth||r>i)&&(e.style.width=`${Nn(r,t.minWidth,i)}px`,c=!0),(o<t.minHeight||o>s)&&(e.style.height=`${Nn(o,t.minHeight,s)}px`,c=!0),c&&t.onResize&&t.onResize()}}teardown(){this.handles?.forEach(e=>e.teardown())}}const Sr=[];class Ee{container;helper;handle;handleSize=8;unbindDown;unbindMove;unbindUp;constructor(e,t){this.container=e,this.helper=t,this.handle=this.createHandleElement(),this.unbindDown=ce.bindDown(this.handle,this.mousedown)}teardown(){this.unbindDown(),this.unbindUp&&this.unbindUp(),this.unbindMove&&this.unbindMove(),this.handle.parentElement.removeChild(this.handle)}x0;y0;left0;top0;width0;height0;mousedown=e=>{e.preventDefault(),e.stopPropagation();const{left:t,top:r,width:o,height:i}=ct(this.container);this.x0=e.clientX,this.y0=e.clientY,this.left0=t,this.top0=r,this.width0=o,this.height0=i,this.calcSafeBoundaries(),this.helper.options&&this.helper.options.onResizeStart&&this.helper.options.onResizeStart(),this.unbindMove=ce.bindMove(document,this.mousemove),this.unbindUp=ce.bindUp(document,this.mouseup)};minLeft;maxLeft;minRight;maxRight;minTop;maxTop;minBottom;maxBottom;calcSafeBoundaries(){if(!this.helper.options)return;const{left:e,top:t,right:r,bottom:o}=ct(this.container),i=this.helper.options,s=i.maxWidth||window.innerWidth,c=i.maxHeight||window.innerHeight;this.minLeft=Math.max(r-s,0),this.maxLeft=r-i.minWidth,this.minRight=e+i.minWidth,this.maxRight=Math.min(e+s,window.innerWidth),this.minTop=Math.max(o-c,0),this.maxTop=o-i.minHeight,this.minBottom=t+i.minHeight,this.maxBottom=Math.min(t+c,window.innerHeight)}mousemove=e=>{e.preventDefault(),e.stopPropagation(),this.setPosition(e),this.fixPosition(),this.helper.options&&this.helper.options.onResize&&this.helper.options.onResize()};fixPosition(){const{width:e,height:t,left:r,top:o,right:i,bottom:s}=ct(this.container),c=this.helper.options;c&&(r<this.minLeft?(this.container.style.width=e+r-this.minLeft+"px",this.container.style.left=`${this.minLeft}px`):r>this.maxLeft?(this.container.style.width=`${c.minWidth}px`,this.container.style.left=`${this.maxLeft}px`):i<this.minRight?this.container.style.width=`${c.minWidth}px`:i>this.maxRight&&(this.container.style.width=this.maxRight-r+"px"),o<this.minTop?(this.container.style.height=t+o-this.minTop+"px",this.container.style.top=`${this.minTop}px`):o>this.maxTop?(this.container.style.height=`${c.minHeight}px`,this.container.style.top=`${this.maxTop}px`):s<this.minBottom?this.container.style.height=`${c.minHeight}px`:s>this.maxBottom&&(this.container.style.height=this.maxBottom-o+"px"))}mouseup=e=>{e.preventDefault(),e.stopPropagation(),this.helper.options&&this.helper.options.onResizeEnd&&this.helper.options.onResizeEnd(),this.unbindUp(),this.unbindMove(),this.unbindUp=this.unbindMove=void 0};createHandleElement(){const e=document.createElement("div"),t=e.style;return t.position="absolute",this.applyStyle(t),this.container.appendChild(e),e}}function Nn(n,e,t){return n<e?e:n>t?t:n}Sr.push(class extends Ee{setPosition(n){this.container.style.width=this.width0+n.clientX-this.x0+"px",this.container.style.height=this.height0+n.clientY-this.y0+"px"}applyStyle(n){n.width=2*this.handleSize+"px",n.height=2*this.handleSize+"px",n.right=-this.handleSize+"px",n.bottom=-this.handleSize+"px",n.cursor="nwse-resize"}},class extends Ee{setPosition(n){this.container.style.height=this.height0+n.clientY-this.y0+"px"}applyStyle(n){n.right=`${this.handleSize}px`,n.left=`${this.handleSize}px`,n.height=2*this.handleSize+"px",n.bottom=-this.handleSize+"px",n.cursor="ns-resize"}},class extends Ee{setPosition(n){this.container.style.left=this.left0+n.clientX-this.x0+"px",this.container.style.width=this.width0-(n.clientX-this.x0)+"px",this.container.style.height=this.height0+n.clientY-this.y0+"px"}applyStyle(n){n.left=-this.handleSize+"px",n.bottom=-this.handleSize+"px",n.width=2*this.handleSize+"px",n.height=2*this.handleSize+"px",n.cursor="nesw-resize"}},class extends Ee{setPosition(n){this.container.style.left=this.left0+n.clientX-this.x0+"px",this.container.style.width=this.width0-(n.clientX-this.x0)+"px"}applyStyle(n){n.left=-this.handleSize+"px",n.bottom=`${this.handleSize}px`,n.width=2*this.handleSize+"px",n.top=`${this.handleSize}px`,n.cursor="ew-resize"}},class extends Ee{setPosition(n){this.container.style.left=this.left0+n.clientX-this.x0+"px",this.container.style.width=this.width0-(n.clientX-this.x0)+"px",this.container.style.top=this.top0+n.clientY-this.y0+"px",this.container.style.height=this.height0-(n.clientY-this.y0)+"px"}applyStyle(n){n.left=-this.handleSize+"px",n.top=-this.handleSize+"px",n.width=2*this.handleSize+"px",n.height=2*this.handleSize+"px",n.cursor="nwse-resize"}},class extends Ee{setPosition(n){this.container.style.top=this.top0+n.clientY-this.y0+"px",this.container.style.height=this.height0-(n.clientY-this.y0)+"px"}applyStyle(n){n.left=`${this.handleSize}px`,n.right=`${this.handleSize}px`,n.height=2*this.handleSize+"px",n.top=-this.handleSize+"px",n.cursor="ns-resize"}},class extends Ee{setPosition(n){this.container.style.top=this.top0+n.clientY-this.y0+"px",this.container.style.height=this.height0-(n.clientY-this.y0)+"px",this.container.style.width=this.width0+n.clientX-this.x0+"px"}applyStyle(n){n.right=-this.handleSize+"px",n.top=-this.handleSize+"px",n.height=2*this.handleSize+"px",n.width=2*this.handleSize+"px",n.cursor="nesw-resize"}},class extends Ee{setPosition(n){this.container.style.width=this.width0+n.clientX-this.x0+"px"}applyStyle(n){n.right=-this.handleSize+"px",n.top=`${this.handleSize}px`,n.bottom=`${this.handleSize}px`,n.width=2*this.handleSize+"px",n.cursor="ew-resize"}});var lt=Me({name:"",props:{disabled:{type:Boolean,default:!1},windowStyle:{type:Object,required:!0}},components:{},setup(n){const e=Y(!1),t=Y(!1);return{hover:e,active:t,style:function(){let r=n.windowStyle.button;return e.value&&(r={...r,...this.windowStyle.buttonHover}),t.value&&(r={...r,...this.windowStyle.buttonActive}),r},mouseup:function(r){this.active&&this.$emit("click")},mousedown:function(r){r.preventDefault(),t.value=!0;const o=ce.bindUp(document,()=>{t.value=!1,o()})}}}});const ri=["disabled"];lt.render=function(n,e,t,r,o,i){return X(),fe("div",{class:"btn",style:me(n.style()),onMouseenter:e[0]||(e[0]=s=>n.hover=!0),onMouseleave:e[1]||(e[1]=s=>n.hover=!1),onMousedown:e[2]||(e[2]=Pn((...s)=>n.mousedown&&n.mousedown(...s),["stop"])),onTouchstart:e[3]||(e[3]=Pn((...s)=>n.mousedown&&n.mousedown(...s),["stop"])),onMouseup:e[4]||(e[4]=(...s)=>n.mouseup&&n.mouseup(...s)),onTouchend:e[5]||(e[5]=(...s)=>n.mouseup&&n.mouseup(...s)),disabled:n.disabled},[ie(n.$slots,"default")],44,ri)},lt.__scopeId="data-v-71662210",lt.__file="src/controls/vuewindow/window/Button.vue";const oi=Object.prototype.toString;function wt(n,e){return oi.call(n)===`[object ${e}]`}function ii(n){return wt(n,"Function")}const cn=n=>n!=null&&n!==null&&wt(n,"Object");function Wn(n){return wt(n,"Number")}function Cr(n){return wt(n,"String")}const Ss=n=>/^(https?|ftp):\/\/([a-zA-Z0-9.-]+(:[a-zA-Z0-9.&%$-]+)*@)*((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])){3}|([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+\.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{2}))(:[0-9]+)*(\/($|[a-zA-Z0-9.,?'\\+&%$#=~_-]+))*$/.test(n);var Be=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function _t(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var $n,jn={exports:{}},si=($n||($n=1,jn.exports=function(n){var e=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function t(d,l){var v=d[0],g=d[1],f=d[2],y=d[3];g=((g+=((f=((f+=((y=((y+=((v=((v+=(g&f|~g&y)+l[0]-680876936|0)<<7|v>>>25)+g|0)&g|~v&f)+l[1]-389564586|0)<<12|y>>>20)+v|0)&v|~y&g)+l[2]+606105819|0)<<17|f>>>15)+y|0)&y|~f&v)+l[3]-1044525330|0)<<22|g>>>10)+f|0,g=((g+=((f=((f+=((y=((y+=((v=((v+=(g&f|~g&y)+l[4]-176418897|0)<<7|v>>>25)+g|0)&g|~v&f)+l[5]+1200080426|0)<<12|y>>>20)+v|0)&v|~y&g)+l[6]-1473231341|0)<<17|f>>>15)+y|0)&y|~f&v)+l[7]-45705983|0)<<22|g>>>10)+f|0,g=((g+=((f=((f+=((y=((y+=((v=((v+=(g&f|~g&y)+l[8]+1770035416|0)<<7|v>>>25)+g|0)&g|~v&f)+l[9]-1958414417|0)<<12|y>>>20)+v|0)&v|~y&g)+l[10]-42063|0)<<17|f>>>15)+y|0)&y|~f&v)+l[11]-1990404162|0)<<22|g>>>10)+f|0,g=((g+=((f=((f+=((y=((y+=((v=((v+=(g&f|~g&y)+l[12]+1804603682|0)<<7|v>>>25)+g|0)&g|~v&f)+l[13]-40341101|0)<<12|y>>>20)+v|0)&v|~y&g)+l[14]-1502002290|0)<<17|f>>>15)+y|0)&y|~f&v)+l[15]+1236535329|0)<<22|g>>>10)+f|0,g=((g+=((f=((f+=((y=((y+=((v=((v+=(g&y|f&~y)+l[1]-165796510|0)<<5|v>>>27)+g|0)&f|g&~f)+l[6]-1069501632|0)<<9|y>>>23)+v|0)&g|v&~g)+l[11]+643717713|0)<<14|f>>>18)+y|0)&v|y&~v)+l[0]-373897302|0)<<20|g>>>12)+f|0,g=((g+=((f=((f+=((y=((y+=((v=((v+=(g&y|f&~y)+l[5]-701558691|0)<<5|v>>>27)+g|0)&f|g&~f)+l[10]+38016083|0)<<9|y>>>23)+v|0)&g|v&~g)+l[15]-660478335|0)<<14|f>>>18)+y|0)&v|y&~v)+l[4]-405537848|0)<<20|g>>>12)+f|0,g=((g+=((f=((f+=((y=((y+=((v=((v+=(g&y|f&~y)+l[9]+568446438|0)<<5|v>>>27)+g|0)&f|g&~f)+l[14]-1019803690|0)<<9|y>>>23)+v|0)&g|v&~g)+l[3]-187363961|0)<<14|f>>>18)+y|0)&v|y&~v)+l[8]+1163531501|0)<<20|g>>>12)+f|0,g=((g+=((f=((f+=((y=((y+=((v=((v+=(g&y|f&~y)+l[13]-1444681467|0)<<5|v>>>27)+g|0)&f|g&~f)+l[2]-51403784|0)<<9|y>>>23)+v|0)&g|v&~g)+l[7]+1735328473|0)<<14|f>>>18)+y|0)&v|y&~v)+l[12]-1926607734|0)<<20|g>>>12)+f|0,g=((g+=((f=((f+=((y=((y+=((v=((v+=(g^f^y)+l[5]-378558|0)<<4|v>>>28)+g|0)^g^f)+l[8]-2022574463|0)<<11|y>>>21)+v|0)^v^g)+l[11]+1839030562|0)<<16|f>>>16)+y|0)^y^v)+l[14]-35309556|0)<<23|g>>>9)+f|0,g=((g+=((f=((f+=((y=((y+=((v=((v+=(g^f^y)+l[1]-1530992060|0)<<4|v>>>28)+g|0)^g^f)+l[4]+1272893353|0)<<11|y>>>21)+v|0)^v^g)+l[7]-155497632|0)<<16|f>>>16)+y|0)^y^v)+l[10]-1094730640|0)<<23|g>>>9)+f|0,g=((g+=((f=((f+=((y=((y+=((v=((v+=(g^f^y)+l[13]+681279174|0)<<4|v>>>28)+g|0)^g^f)+l[0]-358537222|0)<<11|y>>>21)+v|0)^v^g)+l[3]-722521979|0)<<16|f>>>16)+y|0)^y^v)+l[6]+76029189|0)<<23|g>>>9)+f|0,g=((g+=((f=((f+=((y=((y+=((v=((v+=(g^f^y)+l[9]-640364487|0)<<4|v>>>28)+g|0)^g^f)+l[12]-421815835|0)<<11|y>>>21)+v|0)^v^g)+l[15]+530742520|0)<<16|f>>>16)+y|0)^y^v)+l[2]-995338651|0)<<23|g>>>9)+f|0,g=((g+=((y=((y+=(g^((v=((v+=(f^(g|~y))+l[0]-198630844|0)<<6|v>>>26)+g|0)|~f))+l[7]+1126891415|0)<<10|y>>>22)+v|0)^((f=((f+=(v^(y|~g))+l[14]-1416354905|0)<<15|f>>>17)+y|0)|~v))+l[5]-57434055|0)<<21|g>>>11)+f|0,g=((g+=((y=((y+=(g^((v=((v+=(f^(g|~y))+l[12]+1700485571|0)<<6|v>>>26)+g|0)|~f))+l[3]-1894986606|0)<<10|y>>>22)+v|0)^((f=((f+=(v^(y|~g))+l[10]-1051523|0)<<15|f>>>17)+y|0)|~v))+l[1]-2054922799|0)<<21|g>>>11)+f|0,g=((g+=((y=((y+=(g^((v=((v+=(f^(g|~y))+l[8]+1873313359|0)<<6|v>>>26)+g|0)|~f))+l[15]-30611744|0)<<10|y>>>22)+v|0)^((f=((f+=(v^(y|~g))+l[6]-1560198380|0)<<15|f>>>17)+y|0)|~v))+l[13]+1309151649|0)<<21|g>>>11)+f|0,g=((g+=((y=((y+=(g^((v=((v+=(f^(g|~y))+l[4]-145523070|0)<<6|v>>>26)+g|0)|~f))+l[11]-1120210379|0)<<10|y>>>22)+v|0)^((f=((f+=(v^(y|~g))+l[2]+718787259|0)<<15|f>>>17)+y|0)|~v))+l[9]-343485551|0)<<21|g>>>11)+f|0,d[0]=v+d[0]|0,d[1]=g+d[1]|0,d[2]=f+d[2]|0,d[3]=y+d[3]|0}function r(d){var l,v=[];for(l=0;l<64;l+=4)v[l>>2]=d.charCodeAt(l)+(d.charCodeAt(l+1)<<8)+(d.charCodeAt(l+2)<<16)+(d.charCodeAt(l+3)<<24);return v}function o(d){var l,v=[];for(l=0;l<64;l+=4)v[l>>2]=d[l]+(d[l+1]<<8)+(d[l+2]<<16)+(d[l+3]<<24);return v}function i(d){var l,v,g,f,y,P,D=d.length,T=[1732584193,-271733879,-1732584194,271733878];for(l=64;l<=D;l+=64)t(T,r(d.substring(l-64,l)));for(v=(d=d.substring(l-64)).length,g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l=0;l<v;l+=1)g[l>>2]|=d.charCodeAt(l)<<(l%4<<3);if(g[l>>2]|=128<<(l%4<<3),l>55)for(t(T,g),l=0;l<16;l+=1)g[l]=0;return f=(f=8*D).toString(16).match(/(.*?)(.{0,8})$/),y=parseInt(f[2],16),P=parseInt(f[1],16)||0,g[14]=y,g[15]=P,t(T,g),T}function s(d){var l,v,g,f,y,P,D=d.length,T=[1732584193,-271733879,-1732584194,271733878];for(l=64;l<=D;l+=64)t(T,o(d.subarray(l-64,l)));for(v=(d=l-64<D?d.subarray(l-64):new Uint8Array(0)).length,g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l=0;l<v;l+=1)g[l>>2]|=d[l]<<(l%4<<3);if(g[l>>2]|=128<<(l%4<<3),l>55)for(t(T,g),l=0;l<16;l+=1)g[l]=0;return f=(f=8*D).toString(16).match(/(.*?)(.{0,8})$/),y=parseInt(f[2],16),P=parseInt(f[1],16)||0,g[14]=y,g[15]=P,t(T,g),T}function c(d){var l,v="";for(l=0;l<4;l+=1)v+=e[d>>8*l+4&15]+e[d>>8*l&15];return v}function p(d){var l;for(l=0;l<d.length;l+=1)d[l]=c(d[l]);return d.join("")}function m(d){return/[\u0080-\uFFFF]/.test(d)&&(d=unescape(encodeURIComponent(d))),d}function S(d,l){var v,g=d.length,f=new ArrayBuffer(g),y=new Uint8Array(f);for(v=0;v<g;v+=1)y[v]=d.charCodeAt(v);return l?y:f}function k(d){return String.fromCharCode.apply(null,new Uint8Array(d))}function W(d,l,v){var g=new Uint8Array(d.byteLength+l.byteLength);return g.set(new Uint8Array(d)),g.set(new Uint8Array(l),d.byteLength),g}function N(d){var l,v=[],g=d.length;for(l=0;l<g-1;l+=2)v.push(parseInt(d.substr(l,2),16));return String.fromCharCode.apply(String,v)}function L(){this.reset()}return p(i("hello")),typeof ArrayBuffer>"u"||ArrayBuffer.prototype.slice||function(){function d(l,v){return(l=0|l||0)<0?Math.max(l+v,0):Math.min(l,v)}ArrayBuffer.prototype.slice=function(l,v){var g,f,y,P,D=this.byteLength,T=d(l,D),M=D;return v!==n&&(M=d(v,D)),T>M?new ArrayBuffer(0):(g=M-T,f=new ArrayBuffer(g),y=new Uint8Array(f),P=new Uint8Array(this,T,g),y.set(P),f)}}(),L.prototype.append=function(d){return this.appendBinary(m(d)),this},L.prototype.appendBinary=function(d){this._buff+=d,this._length+=d.length;var l,v=this._buff.length;for(l=64;l<=v;l+=64)t(this._hash,r(this._buff.substring(l-64,l)));return this._buff=this._buff.substring(l-64),this},L.prototype.end=function(d){var l,v,g=this._buff,f=g.length,y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(l=0;l<f;l+=1)y[l>>2]|=g.charCodeAt(l)<<(l%4<<3);return this._finish(y,f),v=p(this._hash),d&&(v=N(v)),this.reset(),v},L.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},L.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},L.prototype.setState=function(d){return this._buff=d.buff,this._length=d.length,this._hash=d.hash,this},L.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},L.prototype._finish=function(d,l){var v,g,f,y=l;if(d[y>>2]|=128<<(y%4<<3),y>55)for(t(this._hash,d),y=0;y<16;y+=1)d[y]=0;v=(v=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),g=parseInt(v[2],16),f=parseInt(v[1],16)||0,d[14]=g,d[15]=f,t(this._hash,d)},L.hash=function(d,l){return L.hashBinary(m(d),l)},L.hashBinary=function(d,l){var v=p(i(d));return l?N(v):v},L.ArrayBuffer=function(){this.reset()},L.ArrayBuffer.prototype.append=function(d){var l,v=W(this._buff.buffer,d),g=v.length;for(this._length+=d.byteLength,l=64;l<=g;l+=64)t(this._hash,o(v.subarray(l-64,l)));return this._buff=l-64<g?new Uint8Array(v.buffer.slice(l-64)):new Uint8Array(0),this},L.ArrayBuffer.prototype.end=function(d){var l,v,g=this._buff,f=g.length,y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(l=0;l<f;l+=1)y[l>>2]|=g[l]<<(l%4<<3);return this._finish(y,f),v=p(this._hash),d&&(v=N(v)),this.reset(),v},L.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},L.ArrayBuffer.prototype.getState=function(){var d=L.prototype.getState.call(this);return d.buff=k(d.buff),d},L.ArrayBuffer.prototype.setState=function(d){return d.buff=S(d.buff,!0),L.prototype.setState.call(this,d)},L.ArrayBuffer.prototype.destroy=L.prototype.destroy,L.ArrayBuffer.prototype._finish=L.prototype._finish,L.ArrayBuffer.hash=function(d,l){var v=p(s(new Uint8Array(d)));return l?N(v):v},L}()),jn.exports),Nt=_t(si);const Wt=[];class he{static addHandler(e,t,r){e.addEventListener?e.addEventListener(t,r,!1):e.attachEvent?e.attachEvent("on"+t,r):e["on"+t]=r}static removeHandler(e,t,r){e.removeEventListener?e.removeEventListener(t,r,!1):e.detachEvent?e.detachEvent("on"+t,r):delete e["on"+t]}static windowResizeHandler(e){he.addHandler(window,"resize",e)}static offWindowResizeHandler(e){he.removeHandler(window,"resize",e)}static fullscreenEnabled(){const e=window.document;return document.fullscreenEnabled||window.fullScreen||e.mozFullscreenEnabled||e.webkitIsFullScreen}static fullScreen(e,t){if(t){const r=window.document;let o=window.document.exitFullscreen||r.msExitFullscreen||r.mozCancelFullScreen||r.webkitCancelFullScreen;typeof o<"u"&&o?o.call(window.document):typeof window.ActiveXObject<"u"&&new window.ActiveXObject("WScript.Shell")?.SendKeys("{F11}")}else{let r=e;r||(r=window.document.documentElement);let o=r.requestFullScreen||r.webkitRequestFullScreen||r.mozRequestFullScreen||r.msRequestFullScreen;typeof o<"u"&&o?o.call(r):typeof window.ActiveXObject<"u"&&new window.ActiveXObject("WScript.Shell")?.SendKeys("{F11}")}}static requestFullScreen(e=window.document.documentElement){let t=e;var r=t.requestFullScreen||t.webkitRequestFullScreen||t.mozRequestFullScreen||t.msRequestFullScreen;if(r)r.call(t);else if(typeof window.ActiveXObject<"u"){var o=new window.ActiveXObject("WScript.Shell");o!==null&&o.SendKeys("{F11}")}}static exitFullScreen(){const e=window.document;var t=document.exitFullscreen||e.mozCancelFullScreen||e.webkitExitFullscreen||e.webkitExitFullscreen;if(t)t.call(document);else if(typeof window.ActiveXObject<"u"){var r=new window.ActiveXObject("WScript.Shell");r!==null&&r.SendKeys("{F11}")}}static fullScreenElement(){return window.document.fullscreenElement||window.document.webkitFullscreenElement||window.document.mozFullscreenElement||window.document.msFullscreenElement}static isFullScreen(){return!!he.fullScreenElement()}static onFullScreenChanged(e){let t;"onfullscreenchange"in window.document?t="fullscreenchange":"onwebkitfullscreenchange"in window.document?t="webkitfullscreenchange":"onmozfullscreenchange"in window.document&&(t="mozfullscreenchange"),t?document.addEventListener(t,function(){const r=he.isFullScreen();e(r)}):document.addEventListener("MSFullscreenChange",function(){const r=he.isFullScreen();e(r)})}static stringifyCircularHandler(e,t){if(typeof t=="object"&&t!==null){if(Wt.indexOf(t)!==-1)return;Wt.push(t)}return t}static jsonStringify(e){if(!e)return"";const t=JSON.stringify(e,he.stringifyCircularHandler);return Wt.length=0,t}static jsonParse(e){const t=he.jsonStringify(e);if(t.length>1)return JSON.parse(t)}static getObjectURL(e){let t;const r=window;return r.createObjcectURL!=null?t=r.createOjcectURL(e):window.URL!=null?t=window.URL.createObjectURL(e):window.webkitURL!=null&&(t=window.webkitURL.createObjectURL(e)),t}static getFileShortMD5(e,t){const r=File.prototype,o=r.slice||r.mozSlice||r.webkitSlice,i=e,s=2097152,c=new Nt.ArrayBuffer,p=new FileReader;p.onload=function(m){c.append(m.target?.result);const S=c.end();t({isOK:!0,data:S})},p.onerror=function(){t({isOK:!1,data:"计算文件简单摘要错误！"})},function(){const m=0+s>=i.size?i.size:0+s;p.readAsArrayBuffer(o.call(i,0,m))}()}static getFileMD5(e,t){const r=File.prototype,o=r.slice||r.mozSlice||r.webkitSlice,i=e,s=2097152,c=Math.ceil(i.size/s);let p=0;const m=new Nt.ArrayBuffer,S=new FileReader;function k(){const W=p*s,N=W+s>=i.size?i.size:W+s;S.readAsArrayBuffer(o.call(i,W,N))}S.onload=function(W){if(m.append(W.target?.result),p++,p<c)k();else{const N=m.end();t({isOK:!0,data:N})}},S.onerror=function(){const W=`${i.name}:计算文件简单摘要错误！`;t({isOK:!1,data:W})},k()}static MD5(e,t=!1){return Nt.hash(e,t)}static copyTextByCommand(e){return new Promise((t,r)=>{const o=document.createElement("input");o.value=e,document.body.appendChild(o),o.select(),document.execCommand("copy"),o.remove(),t(!0)})}static copyText=e=>navigator.clipboard?navigator.clipboard.writeText(e).then(function(){return!0},function(t){return!1}):he.copyTextByCommand(e);static copyElementTextByCommand(e){const t=document.createRange();t.selectNode(document.getElementById(e));const r=window.getSelection();r.rangeCount>0&&r.removeAllRanges(),r.addRange(t);try{return document.execCommand("copy"),r.removeRange(t),!0}catch{return r.removeRange(t),!1}}static copyElementText(e){if(!navigator.clipboard)return he.copyElementTextByCommand(e);const t=document.createRange();t.selectNode(document.getElementById(e));const r=window.getSelection();return r.rangeCount>0&&r.removeAllRanges(),r.addRange(t),navigator.clipboard.writeText(r).then(function(){return r.removeRange(t),!0},function(o){return r.removeRange(t),!1})}static setGrayMode(e){he.toggleClass(e,"grayMode",document.documentElement)}static toggleClass(e,t,r){const o=r||document.body;let{className:i}=o;i=i.replace(t,""),o.className=e?`${i} ${t} `:i}static setCssVar(e,t,r=document.documentElement){r.style.setProperty(e,t)}static dispatchWindowResize(){const e=new Event("resize");window.dispatchEvent(e)}static dispatchElementEvent(e,t="click",r){let o;if(o=Cr(e)?document.getElementById(e):e,o){const i=new Event(t,{bubbles:!0,cancelable:!0});r&&o.addEventListener("ev",s=>{r(s)},!1),o.dispatchEvent(i)}}static getRandomNum(e,t){var r=t-e,o=Math.random();return e+Math.round(o*r)}static merge(e={},t={}){let r,o,i,s;for(e||(e={}),o=0,i=t.length;o<i;o++)for(r in s=t[o],s)e[r]=s[r];return e}static setOptions(e,t){e.hasOwnProperty("options")||(e.options=e.options?Object.create(e.options):{});for(let r in t)e.options[r]=t[r];return e.options}static formatNum(e,t){let r=Math.pow(10,t===void 0?6:t);return Math.round(e*r)/r}static trim(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}static splitWords(e){return this.trim(e).split(/\s+/)}static emptyImageUrl(){return"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="}static debounce(e,t){let r=null;return function(){r&&clearTimeout(r),r=setTimeout(e,t)}}static throttle(e,t){let r=!0;return function(){if(!r)return!1;r=!1,setTimeout(()=>{e(),r=!0},t)}}static dataURLtoBlob(e){let t=e.split(",");if(!t||t.length===0)return;let r=t[0].match(/:(.*?);/)[1],o=atob(t[1]),i=o.length,s=new Uint8Array(i);for(;i--;)s[i]=o.charCodeAt(i);return new Blob([s],{type:r})}static getElement(e){return typeof e=="string"?document.getElementById(e):e}static getStyle(e,t){let r=e.style[t]||e.currentStyle&&e.currentStyle[t];if((!r||r==="auto")&&document.defaultView){let o=document.defaultView.getComputedStyle(e,null);r=o?o[t]:null}return r==="auto"?null:r}static create(e,t,r){let o=document.createElement(e);return o.className=t||"",r&&r.appendChild(o),o}static removeElement(e){let t=e.parentNode;t&&t.removeChild(e)}static emptyElement(e){for(;e.firstChild;)e.removeChild(e.firstChild)}static hasClass(e,t){if(e.classList!==void 0)return e.classList.contains(t);let r=this.getClass(e);return r.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(r)}static addClass(e,t){if(e.classList!==void 0){let r=this.splitWords(t);for(let o=0,i=r.length;o<i;o++)e.classList.add(r[o])}else if(!this.hasClass(e,t)){let r=this.getClass(e);this.setClass(e,(r?r+" ":"")+t)}}static removeClass(e,t){e.classList!==void 0?e.classList.remove(t):this.setClass(e,this.trim((" "+this.getClass(e)+" ").replace(" "+t+" "," ")))}static setClass(e,t){e.className.baseVal===void 0?e.className=t:e.className.baseVal=t}static getClass(e){return e.correspondingElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}static createSvgElement(e,t,r,o){let i=document.createElementNS("http://www.w3.org/2000/svg","svg:svg");i.setAttribute("class","svg-path"),i.setAttribute("width",e),i.setAttribute("height",t),i.setAttribute("viewBox",`0 0 ${e} ${t}`);let s=document.createElementNS("http://www.w3.org/2000/svg","path");return s.setAttribute("d",r),i.appendChild(s),o&&o.appendChild(i),i}static parseDom(e,t=!0,r=""){t=t??!1;let o=document.createElement("div");return o.className=r||"",o.innerHTML=e,t?o:o.childNodes}static createVideoHTML(e,t,r){let o=this.create("video",t,r),i=this.create("source","",o);i.setAttribute("src",e),i.setAttribute("type","video/map4");let s=this.create("source","",o);return s.setAttribute("src",e),s.setAttribute("type","video/quicktime"),o}static readFileBytes(e){return new Promise((t,r)=>{const o=new FileReader;o.onload=function(i){const s=o.result,c=s.indexOf("64,"),p=s.substring(c+3);t(p)},o.readAsDataURL(e)})}}class Er{static isNullOrEmpty=e=>e===null||e===""||e===void 0||e.length===0;static isNotEmpty=e=>!(e===null||e===""||e===void 0||e.length===0);static toHump(e){return e.replace(/[\-\/\_](\w)/g,(t,r)=>r.toUpperCase()).replace("views","")}}class kr{prefixKey;storage;constructor(e="",t=localStorage){this.prefixKey=e,this.storage=t}getKey(e){return`${this.prefixKey}${e}`.toUpperCase()}set(e,t,r=604800){const o=JSON.stringify({value:t,expire:r!==null?new Date().getTime()+1e3*r:null});this.storage.setItem(this.getKey(e),o)}get(e,t=null){const r=this.storage.getItem(this.getKey(e));if(r)try{const o=JSON.parse(r),{value:i,expire:s}=o;if(s===null||s>=Date.now())return i;this.remove(this.getKey(e))}catch{return t}return t}getJsonObject(e){const t=this.storage.getItem(this.getKey(e));if(t)try{const r=JSON.parse(t);if(r.expire===null||r.expire>=Date.now())return r;this.remove(this.getKey(e))}catch{return}}remove(e){this.storage.removeItem(this.getKey(e))}clear(){this.storage.clear()}setCookie(e,t,r=604800){document.cookie=`${this.getKey(e)}=${t}; Max-Age=${r}`}getCookie(e){const t=document.cookie.split("; ");for(let r=0,o=t.length;r<o;r++){const i=t[r].split("=");if(i[0]===this.getKey(e))return i[1]}return""}removeCookie(e){this.setCookie(e,1,-1)}clearCookie(){const e=document.cookie.match(/[^ =;]+(?==)/g);if(e)for(let t=e.length;t--;)document.cookie=e[t]+"=0;expire="+new Date(0).toUTCString()}}function ai(){let n=[];const e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";for(var t=0;t<36;t++){const o=Math.floor(16*Math.random());n[t]=e.substring(o,o+1)}n[14]="4";const r=3&Number(n[19])|8;return n[19]=e.substring(r,r+1),n[8]=n[13]=n[18]=n[23]="-",n.join("")}var On;function ci(n){return{all:n=n||new Map,on(e,t){const r=n.get(e);r?r.push(t):n.set(e,[t])},off(e,t){const r=n.get(e);r&&(t?r.splice(r.indexOf(t)>>>0,1):n.set(e,[]))},emit(e,t){let r=n.get(e);r&&r.slice().map(o=>{o(t)}),r=n.get("*"),r&&r.slice().map(o=>{o(e,t)})}}}(function(n){n[n.RGBA=0]="RGBA",n[n.Hex=1]="Hex",n[n.Hsla=2]="Hsla"})(On||(On={}));const Xe=ci(),ue={HproseServiceErrorEvent:"HproseServiceError",WebAPIErrorEvent:"WebAPIError",AlertInfoEvent:"AlertInfoEvent",CommonWarnEvent:"CommonWarnEvent",WidgetLoadedEvent:"WidgetLoaded",WidgetLoaded:"WidgetLoaded",WidgetUnLoadedEvent:"WidgetUnLoaded",WidgetLoadedErrorEvent:"WidgetLoadedError",WidgetVisibleChanged:"WidgetVisibleChanged",AxiosRequestErrorEvent:"AxiosRequestErrorEvent",LayoutContainerLoaded:"LayoutContainerLoaded"},Ir=(n,e)=>{const t=document.createElement("a");t.download=e,t.style.display="none";const r=new Blob([n],{type:"application/octet-stream"});t.href=URL.createObjectURL(r),document.body.appendChild(t),t.click(),document.body.removeChild(t)},li=(n,e)=>{const t=JSON.stringify(n,null,2);Ir(t,e+".json")},Cs=(n,e,t)=>{n.get(e,{responseType:"blob"}).then(function(r){Ir(r.data,t)}).catch(r=>{Xe.emit(ue.CommonWarnEvent,"下载文件报错！")})};var Hn,$t={exports:{}},zn,Un,jt,Ot=(Hn||(Hn=1,Un=$t.exports,jt=function(){var n=function(){},e="undefined",t=typeof window!==e&&typeof window.navigator!==e&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],o={},i=null;function s(N,L){var d=N[L];if(typeof d.bind=="function")return d.bind(N);try{return Function.prototype.bind.call(d,N)}catch{return function(){return Function.prototype.apply.apply(d,[N,arguments])}}}function c(){console.log&&(console.log.apply||Function.prototype.apply.apply(console.log,[console,arguments]))}function p(){for(var N=this.getLevel(),L=0;L<r.length;L++){var d=r[L];this[d]=L<N?n:this.methodFactory(d,N,this.name)}if(this.log=this.debug,typeof console===e&&N<this.levels.SILENT)return"No console available for logging"}function m(N){return function(){typeof console!==e&&(p.call(this),this[N].apply(this,arguments))}}function S(N,L,d){return function(l){return l==="debug"&&(l="log"),typeof console!==e&&(l==="trace"&&t?c:console[l]!==void 0?s(console,l):console.log!==void 0?s(console,"log"):n)}(N)||m.apply(this,arguments)}function k(N,L){var d,l,v,g=this,f="loglevel";function y(){var T;if(typeof window!==e&&f){try{T=window.localStorage[f]}catch{}if(typeof T===e)try{var M=window.document.cookie,O=encodeURIComponent(f),H=M.indexOf(O+"=");H!==-1&&(T=/^([^;]+)/.exec(M.slice(H+O.length+1))[1])}catch{}return g.levels[T]===void 0&&(T=void 0),T}}function P(T){var M=T;if(typeof M=="string"&&g.levels[M.toUpperCase()]!==void 0&&(M=g.levels[M.toUpperCase()]),typeof M=="number"&&M>=0&&M<=g.levels.SILENT)return M;throw new TypeError("log.setLevel() called with invalid level: "+T)}typeof N=="string"?f+=":"+N:typeof N=="symbol"&&(f=void 0),g.name=N,g.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},g.methodFactory=L||S,g.getLevel=function(){return v??l??d},g.setLevel=function(T,M){return v=P(T),M!==!1&&function(O){var H=(r[O]||"silent").toUpperCase();if(typeof window!==e&&f){try{return void(window.localStorage[f]=H)}catch{}try{window.document.cookie=encodeURIComponent(f)+"="+H+";"}catch{}}}(v),p.call(g)},g.setDefaultLevel=function(T){l=P(T),y()||g.setLevel(T,!1)},g.resetLevel=function(){v=null,function(){if(typeof window!==e&&f){try{window.localStorage.removeItem(f)}catch{}try{window.document.cookie=encodeURIComponent(f)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}(),p.call(g)},g.enableAll=function(T){g.setLevel(g.levels.TRACE,T)},g.disableAll=function(T){g.setLevel(g.levels.SILENT,T)},g.rebuild=function(){if(i!==g&&(d=P(i.getLevel())),p.call(g),i===g)for(var T in o)o[T].rebuild()},d=P(i?i.getLevel():"WARN");var D=y();D!=null&&(v=P(D)),p.call(g)}(i=new k).getLogger=function(N){if(typeof N!="symbol"&&typeof N!="string"||N==="")throw new TypeError("You must supply a name when creating a logger.");var L=o[N];return L||(L=o[N]=new k(N,i.methodFactory)),L};var W=typeof window!==e?window.log:void 0;return i.noConflict=function(){return typeof window!==e&&window.log===i&&(window.log=W),i},i.getLoggers=function(){return o},i.default=i,i},(zn=$t).exports?zn.exports=jt():Un.log=jt()),$t.exports);class xr{message;eventBus;constructor(e,t=void 0){e&&(this.message=e),t&&(this.eventBus=t)}msg(e,t=3,r="success"){if(this.message)if(typeof this.message=="function")this.message({type:r,message:e,duration:t});else switch(r){case"info":this.message.info(e,t);break;case"success":this.message.success(e,t);break;case"warning":this.message.warn?this.message.warn(e,t):this.message.warning&&this.message.warning(e,t);break;case"error":this.message.error(e,t)}else{switch(r){case"info":case"success":break;case"warning":break;case"error":r="dark"}this.eventBus&&this.eventBus.emit(ue.AlertInfoEvent,{type:r,info:e})}}info(e,t=3){this.msg(e,t,"info")}warn(e,t=3){this.msg(e,t,"warning")}err(e,t=3){this.msg(e,t,"error")}success(e,t=3){this.msg(e,t,"success")}}let qn=!1;const $={Config:SysConfig,EventBus:Xe,DefaultProxyClient:null,Axios:Jo,Message:new xr(void 0,Xe),LayoutMap:new Map,getLayoutManager:n=>{if(!$.WidgetConfigList||$.WidgetConfigList.length===0)return;const e=$.WidgetConfigList.find(t=>t.id===n);if(e){const t=e.layoutID;if(t&&$.LayoutMap.has(t))return $.LayoutMap.get(t)}},Logger:n=>{qn||(SysConfig.UI.ProductLog?Ot.enableAll():Ot.setDefaultLevel("warn"),qn=!0);const e=n||"default";return Ot.getLogger(e)}},Tr="access_token",Ve=new kr("user",localStorage);function We(){return Ve.get(Tr)}function Rr(){Ve.remove(Tr)}function ui(){return We()?.refresh}function Ar(n,e,t,r="json",o){const i={baseURL:$.Config.ServiceURL.DefaultWebAPI,timeout:6e4,params:n,paramsSerializer:{serialize:function(s){return Go.stringify(s,{indices:!1,arrayFormat:"repeat"})}},headers:{"Content-Type":"application/json",Authorization:"bearer "+We()?.token},responseType:r,cancelToken:o};if(t)for(let s in t)i.headers[s]=t[s];return $.SystemID&&(i.headers.sysid=$.SystemID,$.SystemGroup&&(i.headers.sysgroup=$.SystemGroup)),e&&(i.baseURL=e),i}function je(n,e,t,r,o="json",i,s){const c=Ar(t,e,r,o,i);return s&&s>=2e4&&(c.timeout=s),$.Axios?.get(n,c).catch(function(p){Lr(p,e,n,"Get")})}function Lr(n,e,t,r="Get"){const o=`${e}${t}`;if(n&&n.response){let i=!1;const s=n.response.status;switch(s){case 400:n.message="错误请求";break;case 401:n.message="未授权，请重新登录";break;case 403:n.message="拒绝访问";break;case 404:n.message="请求错误,未找到该资源";break;case 405:n.message="请求方法未允许";break;case 408:n.message="请求超时";break;case 500:const p=n.response.data;if(p){const m=p.indexOf(":"),S=p.indexOf(`
`);if(m>0&&S-m>2){const k=p.substring(m+2,S);k.indexOf("System.Exception")>0?n.message="后台服务内部出错！":(i=!0,n.message=k)}else i=!0,n.message=p}else n.message="服务器端出错";break;case 501:n.message="网络未实现";break;case 502:n.message="网络错误";break;case 503:n.message="服务不可用";break;case 504:n.message="网络超时";break;case 505:n.message="http版本不支持该请求";break;default:n.message=`连接错误${n.response.status}`}let c={address:o,code:s,isExceptionInfo:i,message:n.message,result:n.response.data};if($.EventBus.emit(ue.AxiosRequestErrorEvent,c),i)throw new Error(n.message)}else if(n?.message)throw new Error(n.message)}function hi(n,e,t,r,o,i="json",s){const c=Ar(r,e,o,i);return $.Axios?.post(n,t,c).catch(function(p){Lr(p,e,n,"Post")})}function Es(n,e){return je(n,void 0,e)}var Fn,Xn,Ht,Vn,zt,Kn,Ut,Yn,Jn,Ze={exports:{}};function di(){return Xn?Fn:(Xn=1,n=typeof window<"u"?window:Be!==void 0?Be:typeof self<"u"?self:{},Fn=n);var n}function fi(){if(Vn)return Ht;Vn=1,Ht=function(e){if(!e)return!1;var t=n.call(e);return t==="[object Function]"||typeof e=="function"&&t!=="[object RegExp]"||typeof window<"u"&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)};var n=Object.prototype.toString;return Ht}function pi(){if(Kn)return zt;Kn=1;var n=function(e){return e.replace(/^\s+|\s+$/g,"")};return zt=function(e){if(!e)return{};for(var t,r={},o=n(e).split(`
`),i=0;i<o.length;i++){var s=o[i],c=s.indexOf(":"),p=n(s.slice(0,c)).toLowerCase(),m=n(s.slice(c+1));r[p]===void 0?r[p]=m:(t=r[p],Object.prototype.toString.call(t)==="[object Array]"?r[p].push(m):r[p]=[r[p],m])}return r},zt}var gi=function(){if(Jn)return Ze.exports;Jn=1;var n=di(),e=fi(),t=pi(),r=function(){if(Yn)return Ut;Yn=1,Ut=function(){for(var p={},m=0;m<arguments.length;m++){var S=arguments[m];for(var k in S)c.call(S,k)&&(p[k]=S[k])}return p};var c=Object.prototype.hasOwnProperty;return Ut}();function o(c,p,m){var S=c;return e(p)?(m=p,typeof c=="string"&&(S={uri:c})):S=r(p,{uri:c}),S.callback=m,S}function i(c,p,m){return s(p=o(c,p,m))}function s(c){if(c.callback===void 0)throw new Error("callback argument missing");var p=!1,m=function(M,O,H){p||(p=!0,c.callback(M,O,H))};function S(){var M=void 0;if(M=d.response?d.response:d.responseText||function(O){try{if(O.responseType==="document")return O.responseXML;var H=O.responseXML&&O.responseXML.documentElement.nodeName==="parsererror";if(O.responseType===""&&!H)return O.responseXML}catch{}return null}(d),D)try{M=JSON.parse(M)}catch{}return M}function k(M){return clearTimeout(l),M instanceof Error||(M=new Error(""+(M||"Unknown XMLHttpRequest Error"))),M.statusCode=0,m(M,T)}function W(){if(!L){var M;clearTimeout(l),M=c.useXDR&&d.status===void 0?200:d.status===1223?204:d.status;var O=T,H=null;return M!==0?(O={body:S(),statusCode:M,method:g,headers:{},url:v,rawRequest:d},d.getAllResponseHeaders&&(O.headers=t(d.getAllResponseHeaders()))):H=new Error("Internal XMLHttpRequest Error"),m(H,O,O.body)}}var N,L,d=c.xhr||null;d||(d=c.cors||c.useXDR?new i.XDomainRequest:new i.XMLHttpRequest);var l,v=d.url=c.uri||c.url,g=d.method=c.method||"GET",f=c.body||c.data,y=d.headers=c.headers||{},P=!!c.sync,D=!1,T={body:void 0,headers:{},statusCode:0,method:g,url:v,rawRequest:d};if("json"in c&&c.json!==!1&&(D=!0,y.accept||y.Accept||(y.Accept="application/json"),g!=="GET"&&g!=="HEAD"&&(y["content-type"]||y["Content-Type"]||(y["Content-Type"]="application/json"),f=JSON.stringify(c.json===!0?f:c.json))),d.onreadystatechange=function(){d.readyState===4&&setTimeout(W,0)},d.onload=W,d.onerror=k,d.onprogress=function(){},d.onabort=function(){L=!0},d.ontimeout=k,d.open(g,v,!P,c.username,c.password),P||(d.withCredentials=!!c.withCredentials),!P&&c.timeout>0&&(l=setTimeout(function(){if(!L){L=!0,d.abort("timeout");var M=new Error("XMLHttpRequest timeout");M.code="ETIMEDOUT",k(M)}},c.timeout)),d.setRequestHeader)for(N in y)y.hasOwnProperty(N)&&d.setRequestHeader(N,y[N]);else if(c.headers&&!function(M){for(var O in M)if(M.hasOwnProperty(O))return!1;return!0}(c.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in c&&(d.responseType=c.responseType),"beforeSend"in c&&typeof c.beforeSend=="function"&&c.beforeSend(d),d.send(f||null),d}return Ze.exports=i,Ze.exports.default=i,i.XMLHttpRequest=n.XMLHttpRequest||function(){},i.XDomainRequest="withCredentials"in new i.XMLHttpRequest?i.XMLHttpRequest:n.XDomainRequest,function(c,p){for(var m=0;m<c.length;m++)p(c[m])}(["get","put","post","patch","head","delete"],function(c){i[c==="delete"?"del":c]=function(p,m,S){return(m=o(p,m,S)).method=c.toUpperCase(),s(m)}}),Ze.exports}();_t(gi);class dt{hproseURL;client;hproseProxy;static httpTransport;constructor(e){if(e&&!Er.isNullOrEmpty(e)){if(dt.httpTransport||(dt.httpTransport=new Qo.HttpTransport),this.client=new it.Client(e),!this.client)throw Error("Hprose Client初始化错误");this.hproseURL=e,this.init()}}init(){this.client&&this.client.useServiceAsync().then(e=>{this.hproseProxy=e}).catch(e=>{String(e).indexOf("find this method ~")>0?this.hproseProxy=this.client?.useService():Xe.emit(ue.HproseServiceErrorEvent,"初始化默认Hprose!")})}async getProxy(){if(!this.hproseProxy)try{this.client&&(this.hproseProxy=await this.client.useServiceAsync())}catch{this.hproseProxy=this.client?.useService()}return this.hproseProxy}async invoke(e,t,r){if(this.client)return await this.client.invoke(e,t,r)}encode(e,t,r){if(this.client)return this.client.codec.encode(e,t,r)}decode(e,t){if(this.client)return this.client.codec.decode(e,t)}}class mi{hproseClient;hpProxyObj;defaultContext=new it.ClientContext;constructor(e){this.hproseClient=new dt(e),this.hpProxyObj=null}getClientContext(e,t){const r={};t&&(r.requestHeaders=t);const o=We();r.httpRequestHeaders=e||{};const i=r.httpRequestHeaders;return o&&(i.token=o.token),$.SystemID&&(i.sysid=$.SystemID,$.SystemGroup&&(i.sysgroup=$.SystemGroup)),new it.ClientContext(r)}async getHproseProxy(){if(!this.hproseClient)throw new Error("HproseClient对象为构建，无法调用Hprose方法");if(!this.hpProxyObj){const e=await this.hproseClient.getProxy();this.hpProxyObj=e}return this.hpProxyObj||Xe.emit(ue.HproseServiceErrorEvent,"HproseProxy对象为空，无法调用Hprose方法！"),this.hpProxyObj}async hproseInvoke(e,t,r){if(!this.hproseClient)throw new Error("HproseClient对象为构建，无法调用Hprose方法");return await this.hproseClient.invoke(e,t,r)}async hproseInvokeContext(e,t,...r){if(!this.hproseClient)throw new Error("HproseClient对象为构建，无法调用Hprose方法");const o=We();return o&&(t||(t=new it.ClientContext({httpRequestHeaders:{token:o.token}}))),await this.hproseClient.invoke(e,r,t)}async hproseInvokeEncode(e){const t=new de.ByteStream(e).toBytes(),r=await this.hproseClient.client?.request(t,this.defaultContext);return r&&this.hproseClient.client?.codec.decode(r,this.defaultContext)}encodeRequest(e,...t){const r=this.hproseClient.client?.codec?.encode(e,t,this.defaultContext);return de.ByteStream.toString(r)}}const ks=function(n,e,t){!$.Config.DefaultHproseAPI&&$.Config.ServiceURL&&($.Config.DefaultHproseAPI=$.Config.ServiceURL.DefaultHproseAPI),$.Config.DefaultHproseAPI&&Er.isNotEmpty($.Config.DefaultHproseAPI)&&($.DefaultProxyClient=new mi($.Config.DefaultHproseAPI));const r=$.Config.UI.GrayMode;r&&he.setGrayMode(r);const o=new xr(n,$.EventBus);$.Message=o,$.SystemID=e,$.SystemGroup=t,$.EventBus.on(ue.HproseServiceErrorEvent,i=>{const s=`当前后台业务服务不可用!${i}`}),$.EventBus.on(ue.WebAPIErrorEvent,i=>{const s=`WebAPI后台服务不可用!${i}`}),$.EventBus.on(ue.AxiosRequestErrorEvent,i=>{const s=`Http请求'${i.code}'错误: ${i.message}`}),$.EventBus.on(ue.CommonWarnEvent,i=>{o.warn(i)})},Ue=gr({isLock:!1,lockTime:0});function Qt(n){Ue.isLock=n,n&&Rr()}let qt;function Fe(){clearInterval(qt),!(window.location.href.indexOf("/login")>0||Ue.isLock)&&(Qt(!1),Ue.lockTime=function(){let n=3600;return $.Config.UI?.LockTime&&$.Config.UI?.LockTime>=10&&(n=$.Config.UI.LockTime),n}(),qt=setInterval(()=>{if(Ue.lockTime--,Ue.lockTime<=0)return Qt(!0),clearInterval(qt)},1e3))}function Is(){Fe(),document.addEventListener("mousedown",Fe),document.addEventListener("mousemove",Fe)}function xs(){document.removeEventListener("mousedown",Fe),document.removeEventListener("mousemove",Fe)}function Ft(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Gn,Qn={exports:{}};/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/var Zn,vi=(Gn||(Gn=1,Qn.exports=function n(e,t,r){function o(c,p){if(!t[c]){if(!e[c]){if(!p&&Ft)return Ft(c);if(i)return i(c,!0);var m=new Error("Cannot find module '"+c+"'");throw m.code="MODULE_NOT_FOUND",m}var S=t[c]={exports:{}};e[c][0].call(S.exports,function(k){var W=e[c][1][k];return o(W||k)},S,S.exports,n,e,t,r)}return t[c].exports}for(var i=Ft,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(n,e,t){(function(r){var o,i,s=r.MutationObserver||r.WebKitMutationObserver;if(s){var c=0,p=new s(W),m=r.document.createTextNode("");p.observe(m,{characterData:!0}),o=function(){m.data=c=++c%2}}else if(r.setImmediate||r.MessageChannel===void 0)o="document"in r&&"onreadystatechange"in r.document.createElement("script")?function(){var L=r.document.createElement("script");L.onreadystatechange=function(){W(),L.onreadystatechange=null,L.parentNode.removeChild(L),L=null},r.document.documentElement.appendChild(L)}:function(){setTimeout(W,0)};else{var S=new r.MessageChannel;S.port1.onmessage=W,o=function(){S.port2.postMessage(0)}}var k=[];function W(){var L,d;i=!0;for(var l=k.length;l;){for(d=k,k=[],L=-1;++L<l;)d[L]();l=k.length}i=!1}function N(L){k.push(L)!==1||i||o()}e.exports=N}).call(this,Be!==void 0?Be:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(n,e,t){var r=n(1);function o(){}var i={},s=["REJECTED"],c=["FULFILLED"],p=["PENDING"];function m(f){if(typeof f!="function")throw new TypeError("resolver must be a function");this.state=p,this.queue=[],this.outcome=void 0,f!==o&&N(this,f)}function S(f,y,P){this.promise=f,typeof y=="function"&&(this.onFulfilled=y,this.callFulfilled=this.otherCallFulfilled),typeof P=="function"&&(this.onRejected=P,this.callRejected=this.otherCallRejected)}function k(f,y,P){r(function(){var D;try{D=y(P)}catch(T){return i.reject(f,T)}D===f?i.reject(f,new TypeError("Cannot resolve promise with itself")):i.resolve(f,D)})}function W(f){var y=f&&f.then;if(f&&(typeof f=="object"||typeof f=="function")&&typeof y=="function")return function(){y.apply(f,arguments)}}function N(f,y){var P=!1;function D(H){P||(P=!0,i.reject(f,H))}function T(H){P||(P=!0,i.resolve(f,H))}function M(){y(T,D)}var O=L(M);O.status==="error"&&D(O.value)}function L(f,y){var P={};try{P.value=f(y),P.status="success"}catch(D){P.status="error",P.value=D}return P}function d(f){return f instanceof this?f:i.resolve(new this(o),f)}function l(f){var y=new this(o);return i.reject(y,f)}function v(f){var y=this;if(Object.prototype.toString.call(f)!=="[object Array]")return this.reject(new TypeError("must be an array"));var P=f.length,D=!1;if(!P)return this.resolve([]);for(var T=new Array(P),M=0,O=-1,H=new this(o);++O<P;)A(f[O],O);return H;function A(U,F){function ae(re){T[F]=re,++M!==P||D||(D=!0,i.resolve(H,T))}y.resolve(U).then(ae,function(re){D||(D=!0,i.reject(H,re))})}}function g(f){var y=this;if(Object.prototype.toString.call(f)!=="[object Array]")return this.reject(new TypeError("must be an array"));var P=f.length,D=!1;if(!P)return this.resolve([]);for(var T=-1,M=new this(o);++T<P;)O(f[T]);return M;function O(H){y.resolve(H).then(function(A){D||(D=!0,i.resolve(M,A))},function(A){D||(D=!0,i.reject(M,A))})}}e.exports=m,m.prototype.catch=function(f){return this.then(null,f)},m.prototype.then=function(f,y){if(typeof f!="function"&&this.state===c||typeof y!="function"&&this.state===s)return this;var P=new this.constructor(o);return this.state!==p?k(P,this.state===c?f:y,this.outcome):this.queue.push(new S(P,f,y)),P},S.prototype.callFulfilled=function(f){i.resolve(this.promise,f)},S.prototype.otherCallFulfilled=function(f){k(this.promise,this.onFulfilled,f)},S.prototype.callRejected=function(f){i.reject(this.promise,f)},S.prototype.otherCallRejected=function(f){k(this.promise,this.onRejected,f)},i.resolve=function(f,y){var P=L(W,y);if(P.status==="error")return i.reject(f,P.value);var D=P.value;if(D)N(f,D);else{f.state=c,f.outcome=y;for(var T=-1,M=f.queue.length;++T<M;)f.queue[T].callFulfilled(y)}return f},i.reject=function(f,y){f.state=s,f.outcome=y;for(var P=-1,D=f.queue.length;++P<D;)f.queue[P].callRejected(y);return f},m.resolve=d,m.reject=l,m.all=v,m.race=g},{1:1}],3:[function(n,e,t){(function(r){typeof r.Promise!="function"&&(r.Promise=n(2))}).call(this,Be!==void 0?Be:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(n,e,t){var r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};function o(a,u){if(!(a instanceof u))throw new TypeError("Cannot call a class as a function")}function i(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var s=i();function c(){try{if(!s||!s.open)return!1;var a=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),u=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!a||u)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function p(a,u){a=a||[],u=u||{};try{return new Blob(a,u)}catch(w){if(w.name!=="TypeError")throw w;for(var h=new(typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder),_=0;_<a.length;_+=1)h.append(a[_]);return h.getBlob(u.type)}}typeof Promise>"u"&&n(3);var m=Promise;function S(a,u){u&&a.then(function(h){u(null,h)},function(h){u(h)})}function k(a,u,h){typeof u=="function"&&a.then(u),typeof h=="function"&&a.catch(h)}function W(a){return typeof a!="string"&&(a=String(a)),a}function N(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var L="local-forage-detect-blob-support",d=void 0,l={},v=Object.prototype.toString,g="readonly",f="readwrite";function y(a){for(var u=a.length,h=new ArrayBuffer(u),_=new Uint8Array(h),w=0;w<u;w++)_[w]=a.charCodeAt(w);return h}function P(a){return new m(function(u){var h=a.transaction(L,f),_=p([""]);h.objectStore(L).put(_,"key"),h.onabort=function(w){w.preventDefault(),w.stopPropagation(),u(!1)},h.oncomplete=function(){var w=navigator.userAgent.match(/Chrome\/(\d+)/),b=navigator.userAgent.match(/Edge\//);u(b||!w||parseInt(w[1],10)>=43)}}).catch(function(){return!1})}function D(a){return typeof d=="boolean"?m.resolve(d):P(a).then(function(u){return d=u})}function T(a){var u=l[a.name],h={};h.promise=new m(function(_,w){h.resolve=_,h.reject=w}),u.deferredOperations.push(h),u.dbReady?u.dbReady=u.dbReady.then(function(){return h.promise}):u.dbReady=h.promise}function M(a){var u=l[a.name].deferredOperations.pop();if(u)return u.resolve(),u.promise}function O(a,u){var h=l[a.name].deferredOperations.pop();if(h)return h.reject(u),h.promise}function H(a,u){return new m(function(h,_){if(l[a.name]=l[a.name]||pn(),a.db){if(!u)return h(a.db);T(a),a.db.close()}var w=[a.name];u&&w.push(a.version);var b=s.open.apply(s,w);u&&(b.onupgradeneeded=function(C){var I=b.result;try{I.createObjectStore(a.storeName),C.oldVersion<=1&&I.createObjectStore(L)}catch(x){if(x.name!=="ConstraintError")throw x}}),b.onerror=function(C){C.preventDefault(),_(b.error)},b.onsuccess=function(){var C=b.result;C.onversionchange=function(I){I.target.close()},h(C),M(a)}})}function A(a){return H(a,!1)}function U(a){return H(a,!0)}function F(a,u){if(!a.db)return!0;var h=!a.db.objectStoreNames.contains(a.storeName),_=a.version<a.db.version,w=a.version>a.db.version;if(_&&(a.version,a.version=a.db.version),w||h){if(h){var b=a.db.version+1;b>a.version&&(a.version=b)}return!0}return!1}function ae(a){return new m(function(u,h){var _=new FileReader;_.onerror=h,_.onloadend=function(w){var b=btoa(w.target.result||"");u({__local_forage_encoded_blob:!0,data:b,type:a.type})},_.readAsBinaryString(a)})}function re(a){return p([y(atob(a.data))],{type:a.type})}function ye(a){return a&&a.__local_forage_encoded_blob}function Je(a){var u=this,h=u._initReady().then(function(){var _=l[u._dbInfo.name];if(_&&_.dbReady)return _.dbReady});return k(h,a,a),h}function Ct(a){T(a);for(var u=l[a.name],h=u.forages,_=0;_<h.length;_++){var w=h[_];w._dbInfo.db&&(w._dbInfo.db.close(),w._dbInfo.db=null)}return a.db=null,A(a).then(function(b){return a.db=b,F(a)?U(a):b}).then(function(b){a.db=u.db=b;for(var C=0;C<h.length;C++)h[C]._dbInfo.db=b}).catch(function(b){throw O(a,b),b})}function ge(a,u,h,_){_===void 0&&(_=1);try{var w=a.db.transaction(a.storeName,u);h(null,w)}catch(b){if(_>0&&(!a.db||b.name==="InvalidStateError"||b.name==="NotFoundError"))return m.resolve().then(function(){if(!a.db||b.name==="NotFoundError"&&!a.db.objectStoreNames.contains(a.storeName)&&a.version<=a.db.version)return a.db&&(a.version=a.db.version+1),U(a)}).then(function(){return Ct(a).then(function(){ge(a,u,h,_-1)})}).catch(h);h(b)}}function pn(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function Fr(a){var u=this,h={db:null};if(a)for(var _ in a)h[_]=a[_];var w=l[h.name];w||(w=pn(),l[h.name]=w),w.forages.push(u),u._initReady||(u._initReady=u.ready,u.ready=Je);var b=[];function C(){return m.resolve()}for(var I=0;I<w.forages.length;I++){var x=w.forages[I];x!==u&&b.push(x._initReady().catch(C))}var R=w.forages.slice(0);return m.all(b).then(function(){return h.db=w.db,A(h)}).then(function(B){return h.db=B,F(h,u._defaultConfig.version)?U(h):B}).then(function(B){h.db=w.db=B,u._dbInfo=h;for(var j=0;j<R.length;j++){var q=R[j];q!==u&&(q._dbInfo.db=h.db,q._dbInfo.version=h.version)}})}function Xr(a,u){var h=this;a=W(a);var _=new m(function(w,b){h.ready().then(function(){ge(h._dbInfo,g,function(C,I){if(C)return b(C);try{var x=I.objectStore(h._dbInfo.storeName).get(a);x.onsuccess=function(){var R=x.result;R===void 0&&(R=null),ye(R)&&(R=re(R)),w(R)},x.onerror=function(){b(x.error)}}catch(R){b(R)}})}).catch(b)});return S(_,u),_}function Vr(a,u){var h=this,_=new m(function(w,b){h.ready().then(function(){ge(h._dbInfo,g,function(C,I){if(C)return b(C);try{var x=I.objectStore(h._dbInfo.storeName).openCursor(),R=1;x.onsuccess=function(){var B=x.result;if(B){var j=B.value;ye(j)&&(j=re(j));var q=a(j,B.key,R++);q!==void 0?w(q):B.continue()}else w()},x.onerror=function(){b(x.error)}}catch(B){b(B)}})}).catch(b)});return S(_,u),_}function Kr(a,u,h){var _=this;a=W(a);var w=new m(function(b,C){var I;_.ready().then(function(){return I=_._dbInfo,v.call(u)==="[object Blob]"?D(I.db).then(function(x){return x?u:ae(u)}):u}).then(function(x){ge(_._dbInfo,f,function(R,B){if(R)return C(R);try{var j=B.objectStore(_._dbInfo.storeName);x===null&&(x=void 0);var q=j.put(x,a);B.oncomplete=function(){x===void 0&&(x=null),b(x)},B.onabort=B.onerror=function(){var V=q.error?q.error:q.transaction.error;C(V)}}catch(V){C(V)}})}).catch(C)});return S(w,h),w}function Yr(a,u){var h=this;a=W(a);var _=new m(function(w,b){h.ready().then(function(){ge(h._dbInfo,f,function(C,I){if(C)return b(C);try{var x=I.objectStore(h._dbInfo.storeName).delete(a);I.oncomplete=function(){w()},I.onerror=function(){b(x.error)},I.onabort=function(){var R=x.error?x.error:x.transaction.error;b(R)}}catch(R){b(R)}})}).catch(b)});return S(_,u),_}function Jr(a){var u=this,h=new m(function(_,w){u.ready().then(function(){ge(u._dbInfo,f,function(b,C){if(b)return w(b);try{var I=C.objectStore(u._dbInfo.storeName).clear();C.oncomplete=function(){_()},C.onabort=C.onerror=function(){var x=I.error?I.error:I.transaction.error;w(x)}}catch(x){w(x)}})}).catch(w)});return S(h,a),h}function Gr(a){var u=this,h=new m(function(_,w){u.ready().then(function(){ge(u._dbInfo,g,function(b,C){if(b)return w(b);try{var I=C.objectStore(u._dbInfo.storeName).count();I.onsuccess=function(){_(I.result)},I.onerror=function(){w(I.error)}}catch(x){w(x)}})}).catch(w)});return S(h,a),h}function Qr(a,u){var h=this,_=new m(function(w,b){a<0?w(null):h.ready().then(function(){ge(h._dbInfo,g,function(C,I){if(C)return b(C);try{var x=I.objectStore(h._dbInfo.storeName),R=!1,B=x.openKeyCursor();B.onsuccess=function(){var j=B.result;j?a===0||R?w(j.key):(R=!0,j.advance(a)):w(null)},B.onerror=function(){b(B.error)}}catch(j){b(j)}})}).catch(b)});return S(_,u),_}function Zr(a){var u=this,h=new m(function(_,w){u.ready().then(function(){ge(u._dbInfo,g,function(b,C){if(b)return w(b);try{var I=C.objectStore(u._dbInfo.storeName).openKeyCursor(),x=[];I.onsuccess=function(){var R=I.result;R?(x.push(R.key),R.continue()):_(x)},I.onerror=function(){w(I.error)}}catch(R){w(R)}})}).catch(w)});return S(h,a),h}function eo(a,u){u=N.apply(this,arguments);var h=this.config();(a=typeof a!="function"&&a||{}).name||(a.name=a.name||h.name,a.storeName=a.storeName||h.storeName);var _,w=this;if(a.name){var b=a.name===h.name&&w._dbInfo.db?m.resolve(w._dbInfo.db):A(a).then(function(C){var I=l[a.name],x=I.forages;I.db=C;for(var R=0;R<x.length;R++)x[R]._dbInfo.db=C;return C});_=a.storeName?b.then(function(C){if(C.objectStoreNames.contains(a.storeName)){var I=C.version+1;T(a);var x=l[a.name],R=x.forages;C.close();for(var B=0;B<R.length;B++){var j=R[B];j._dbInfo.db=null,j._dbInfo.version=I}var q=new m(function(V,K){var oe=s.open(a.name,I);oe.onerror=function(be){oe.result.close(),K(be)},oe.onupgradeneeded=function(){oe.result.deleteObjectStore(a.storeName)},oe.onsuccess=function(){var be=oe.result;be.close(),V(be)}});return q.then(function(V){x.db=V;for(var K=0;K<R.length;K++){var oe=R[K];oe._dbInfo.db=V,M(oe._dbInfo)}}).catch(function(V){throw(O(a,V)||m.resolve()).catch(function(){}),V})}}):b.then(function(C){T(a);var I=l[a.name],x=I.forages;C.close();for(var R=0;R<x.length;R++)x[R]._dbInfo.db=null;var B=new m(function(j,q){var V=s.deleteDatabase(a.name);V.onerror=function(){var K=V.result;K&&K.close(),q(V.error)},V.onblocked=function(){},V.onsuccess=function(){var K=V.result;K&&K.close(),j(K)}});return B.then(function(j){I.db=j;for(var q=0;q<x.length;q++)M(x[q]._dbInfo)}).catch(function(j){throw(O(a,j)||m.resolve()).catch(function(){}),j})})}else _=m.reject("Invalid arguments");return S(_,u),_}var to={_driver:"asyncStorage",_initStorage:Fr,_support:c(),iterate:Vr,getItem:Xr,setItem:Kr,removeItem:Yr,clear:Jr,length:Gr,key:Qr,keys:Zr,dropInstance:eo};function no(){return typeof openDatabase=="function"}var Se="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ro="~~local_forage_type~",gn=/^~~local_forage_type~([^~]+)~/,Ge="__lfsc__:",Et=Ge.length,kt="arbf",It="blob",mn="si08",vn="ui08",yn="uic8",wn="si16",_n="si32",bn="ur16",Sn="ui32",Cn="fl32",En="fl64",kn=Et+kt.length,In=Object.prototype.toString;function xn(a){var u,h,_,w,b,C=.75*a.length,I=a.length,x=0;a[a.length-1]==="="&&(C--,a[a.length-2]==="="&&C--);var R=new ArrayBuffer(C),B=new Uint8Array(R);for(u=0;u<I;u+=4)h=Se.indexOf(a[u]),_=Se.indexOf(a[u+1]),w=Se.indexOf(a[u+2]),b=Se.indexOf(a[u+3]),B[x++]=h<<2|_>>4,B[x++]=(15&_)<<4|w>>2,B[x++]=(3&w)<<6|63&b;return R}function xt(a){var u,h=new Uint8Array(a),_="";for(u=0;u<h.length;u+=3)_+=Se[h[u]>>2],_+=Se[(3&h[u])<<4|h[u+1]>>4],_+=Se[(15&h[u+1])<<2|h[u+2]>>6],_+=Se[63&h[u+2]];return h.length%3==2?_=_.substring(0,_.length-1)+"=":h.length%3==1&&(_=_.substring(0,_.length-2)+"=="),_}function oo(a,u){var h="";if(a&&(h=In.call(a)),a&&(h==="[object ArrayBuffer]"||a.buffer&&In.call(a.buffer)==="[object ArrayBuffer]")){var _,w=Ge;a instanceof ArrayBuffer?(_=a,w+=kt):(_=a.buffer,h==="[object Int8Array]"?w+=mn:h==="[object Uint8Array]"?w+=vn:h==="[object Uint8ClampedArray]"?w+=yn:h==="[object Int16Array]"?w+=wn:h==="[object Uint16Array]"?w+=bn:h==="[object Int32Array]"?w+=_n:h==="[object Uint32Array]"?w+=Sn:h==="[object Float32Array]"?w+=Cn:h==="[object Float64Array]"?w+=En:u(new Error("Failed to get type for BinaryArray"))),u(w+xt(_))}else if(h==="[object Blob]"){var b=new FileReader;b.onload=function(){var C=ro+a.type+"~"+xt(this.result);u(Ge+It+C)},b.readAsArrayBuffer(a)}else try{u(JSON.stringify(a))}catch(C){u(null,C)}}function io(a){if(a.substring(0,Et)!==Ge)return JSON.parse(a);var u,h=a.substring(kn),_=a.substring(Et,kn);if(_===It&&gn.test(h)){var w=h.match(gn);u=w[1],h=h.substring(w[0].length)}var b=xn(h);switch(_){case kt:return b;case It:return p([b],{type:u});case mn:return new Int8Array(b);case vn:return new Uint8Array(b);case yn:return new Uint8ClampedArray(b);case wn:return new Int16Array(b);case bn:return new Uint16Array(b);case _n:return new Int32Array(b);case Sn:return new Uint32Array(b);case Cn:return new Float32Array(b);case En:return new Float64Array(b);default:throw new Error("Unkown type: "+_)}}var Tt={serialize:oo,deserialize:io,stringToBuffer:xn,bufferToString:xt};function Tn(a,u,h,_){a.executeSql("CREATE TABLE IF NOT EXISTS "+u.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],h,_)}function so(a){var u=this,h={db:null};if(a)for(var _ in a)h[_]=typeof a[_]!="string"?a[_].toString():a[_];var w=new m(function(b,C){try{h.db=openDatabase(h.name,String(h.version),h.description,h.size)}catch(I){return C(I)}h.db.transaction(function(I){Tn(I,h,function(){u._dbInfo=h,b()},function(x,R){C(R)})},C)});return h.serializer=Tt,w}function Ce(a,u,h,_,w,b){a.executeSql(h,_,w,function(C,I){I.code===I.SYNTAX_ERR?C.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[u.storeName],function(x,R){R.rows.length?b(x,I):Tn(x,u,function(){x.executeSql(h,_,w,b)},b)},b):b(C,I)},b)}function ao(a,u){var h=this;a=W(a);var _=new m(function(w,b){h.ready().then(function(){var C=h._dbInfo;C.db.transaction(function(I){Ce(I,C,"SELECT * FROM "+C.storeName+" WHERE key = ? LIMIT 1",[a],function(x,R){var B=R.rows.length?R.rows.item(0).value:null;B&&(B=C.serializer.deserialize(B)),w(B)},function(x,R){b(R)})})}).catch(b)});return S(_,u),_}function co(a,u){var h=this,_=new m(function(w,b){h.ready().then(function(){var C=h._dbInfo;C.db.transaction(function(I){Ce(I,C,"SELECT * FROM "+C.storeName,[],function(x,R){for(var B=R.rows,j=B.length,q=0;q<j;q++){var V=B.item(q),K=V.value;if(K&&(K=C.serializer.deserialize(K)),(K=a(K,V.key,q+1))!==void 0)return void w(K)}w()},function(x,R){b(R)})})}).catch(b)});return S(_,u),_}function Rn(a,u,h,_){var w=this;a=W(a);var b=new m(function(C,I){w.ready().then(function(){u===void 0&&(u=null);var x=u,R=w._dbInfo;R.serializer.serialize(u,function(B,j){j?I(j):R.db.transaction(function(q){Ce(q,R,"INSERT OR REPLACE INTO "+R.storeName+" (key, value) VALUES (?, ?)",[a,B],function(){C(x)},function(V,K){I(K)})},function(q){if(q.code===q.QUOTA_ERR){if(_>0)return void C(Rn.apply(w,[a,x,h,_-1]));I(q)}})})}).catch(I)});return S(b,h),b}function lo(a,u,h){return Rn.apply(this,[a,u,h,1])}function uo(a,u){var h=this;a=W(a);var _=new m(function(w,b){h.ready().then(function(){var C=h._dbInfo;C.db.transaction(function(I){Ce(I,C,"DELETE FROM "+C.storeName+" WHERE key = ?",[a],function(){w()},function(x,R){b(R)})})}).catch(b)});return S(_,u),_}function ho(a){var u=this,h=new m(function(_,w){u.ready().then(function(){var b=u._dbInfo;b.db.transaction(function(C){Ce(C,b,"DELETE FROM "+b.storeName,[],function(){_()},function(I,x){w(x)})})}).catch(w)});return S(h,a),h}function fo(a){var u=this,h=new m(function(_,w){u.ready().then(function(){var b=u._dbInfo;b.db.transaction(function(C){Ce(C,b,"SELECT COUNT(key) as c FROM "+b.storeName,[],function(I,x){var R=x.rows.item(0).c;_(R)},function(I,x){w(x)})})}).catch(w)});return S(h,a),h}function po(a,u){var h=this,_=new m(function(w,b){h.ready().then(function(){var C=h._dbInfo;C.db.transaction(function(I){Ce(I,C,"SELECT key FROM "+C.storeName+" WHERE id = ? LIMIT 1",[a+1],function(x,R){var B=R.rows.length?R.rows.item(0).key:null;w(B)},function(x,R){b(R)})})}).catch(b)});return S(_,u),_}function go(a){var u=this,h=new m(function(_,w){u.ready().then(function(){var b=u._dbInfo;b.db.transaction(function(C){Ce(C,b,"SELECT key FROM "+b.storeName,[],function(I,x){for(var R=[],B=0;B<x.rows.length;B++)R.push(x.rows.item(B).key);_(R)},function(I,x){w(x)})})}).catch(w)});return S(h,a),h}function mo(a){return new m(function(u,h){a.transaction(function(_){_.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(w,b){for(var C=[],I=0;I<b.rows.length;I++)C.push(b.rows.item(I).name);u({db:a,storeNames:C})},function(w,b){h(b)})},function(_){h(_)})})}function vo(a,u){u=N.apply(this,arguments);var h=this.config();(a=typeof a!="function"&&a||{}).name||(a.name=a.name||h.name,a.storeName=a.storeName||h.storeName);var _,w=this;return _=a.name?new m(function(b){var C;C=a.name===h.name?w._dbInfo.db:openDatabase(a.name,"","",0),a.storeName?b({db:C,storeNames:[a.storeName]}):b(mo(C))}).then(function(b){return new m(function(C,I){b.db.transaction(function(x){function R(V){return new m(function(K,oe){x.executeSql("DROP TABLE IF EXISTS "+V,[],function(){K()},function(be,Lt){oe(Lt)})})}for(var B=[],j=0,q=b.storeNames.length;j<q;j++)B.push(R(b.storeNames[j]));m.all(B).then(function(){C()}).catch(function(V){I(V)})},function(x){I(x)})})}):m.reject("Invalid arguments"),S(_,u),_}var yo={_driver:"webSQLStorage",_initStorage:so,_support:no(),iterate:co,getItem:ao,setItem:lo,removeItem:uo,clear:ho,length:fo,key:po,keys:go,dropInstance:vo};function wo(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function An(a,u){var h=a.name+"/";return a.storeName!==u.storeName&&(h+=a.storeName+"/"),h}function _o(){var a="_localforage_support_test";try{return localStorage.setItem(a,!0),localStorage.removeItem(a),!1}catch{return!0}}function bo(){return!_o()||localStorage.length>0}function So(a){var u=this,h={};if(a)for(var _ in a)h[_]=a[_];return h.keyPrefix=An(a,u._defaultConfig),bo()?(u._dbInfo=h,h.serializer=Tt,m.resolve()):m.reject()}function Co(a){var u=this,h=u.ready().then(function(){for(var _=u._dbInfo.keyPrefix,w=localStorage.length-1;w>=0;w--){var b=localStorage.key(w);b.indexOf(_)===0&&localStorage.removeItem(b)}});return S(h,a),h}function Eo(a,u){var h=this;a=W(a);var _=h.ready().then(function(){var w=h._dbInfo,b=localStorage.getItem(w.keyPrefix+a);return b&&(b=w.serializer.deserialize(b)),b});return S(_,u),_}function ko(a,u){var h=this,_=h.ready().then(function(){for(var w=h._dbInfo,b=w.keyPrefix,C=b.length,I=localStorage.length,x=1,R=0;R<I;R++){var B=localStorage.key(R);if(B.indexOf(b)===0){var j=localStorage.getItem(B);if(j&&(j=w.serializer.deserialize(j)),(j=a(j,B.substring(C),x++))!==void 0)return j}}});return S(_,u),_}function Io(a,u){var h=this,_=h.ready().then(function(){var w,b=h._dbInfo;try{w=localStorage.key(a)}catch{w=null}return w&&(w=w.substring(b.keyPrefix.length)),w});return S(_,u),_}function xo(a){var u=this,h=u.ready().then(function(){for(var _=u._dbInfo,w=localStorage.length,b=[],C=0;C<w;C++){var I=localStorage.key(C);I.indexOf(_.keyPrefix)===0&&b.push(I.substring(_.keyPrefix.length))}return b});return S(h,a),h}function To(a){var u=this.keys().then(function(h){return h.length});return S(u,a),u}function Ro(a,u){var h=this;a=W(a);var _=h.ready().then(function(){var w=h._dbInfo;localStorage.removeItem(w.keyPrefix+a)});return S(_,u),_}function Ao(a,u,h){var _=this;a=W(a);var w=_.ready().then(function(){u===void 0&&(u=null);var b=u;return new m(function(C,I){var x=_._dbInfo;x.serializer.serialize(u,function(R,B){if(B)I(B);else try{localStorage.setItem(x.keyPrefix+a,R),C(b)}catch(j){j.name!=="QuotaExceededError"&&j.name!=="NS_ERROR_DOM_QUOTA_REACHED"||I(j),I(j)}})})});return S(w,h),w}function Lo(a,u){if(u=N.apply(this,arguments),!(a=typeof a!="function"&&a||{}).name){var h=this.config();a.name=a.name||h.name,a.storeName=a.storeName||h.storeName}var _,w=this;return _=a.name?new m(function(b){a.storeName?b(An(a,w._defaultConfig)):b(a.name+"/")}).then(function(b){for(var C=localStorage.length-1;C>=0;C--){var I=localStorage.key(C);I.indexOf(b)===0&&localStorage.removeItem(I)}}):m.reject("Invalid arguments"),S(_,u),_}var Mo={_driver:"localStorageWrapper",_initStorage:So,_support:wo(),iterate:ko,getItem:Eo,setItem:Ao,removeItem:Ro,clear:Co,length:To,key:Io,keys:xo,dropInstance:Lo},Do=function(a,u){return a===u||typeof a=="number"&&typeof u=="number"&&isNaN(a)&&isNaN(u)},Po=function(a,u){for(var h=a.length,_=0;_<h;){if(Do(a[_],u))return!0;_++}return!1},Ln=Array.isArray||function(a){return Object.prototype.toString.call(a)==="[object Array]"},He={},Mn={},De={INDEXEDDB:to,WEBSQL:yo,LOCALSTORAGE:Mo},Bo=[De.INDEXEDDB._driver,De.WEBSQL._driver,De.LOCALSTORAGE._driver],Qe=["dropInstance"],Rt=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(Qe),No={description:"",driver:Bo.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function Wo(a,u){a[u]=function(){var h=arguments;return a.ready().then(function(){return a[u].apply(a,h)})}}function At(){for(var a=1;a<arguments.length;a++){var u=arguments[a];if(u)for(var h in u)u.hasOwnProperty(h)&&(Ln(u[h])?arguments[0][h]=u[h].slice():arguments[0][h]=u[h])}return arguments[0]}var $o=function(){function a(u){for(var h in o(this,a),De)if(De.hasOwnProperty(h)){var _=De[h],w=_._driver;this[h]=w,He[w]||this.defineDriver(_)}this._defaultConfig=At({},No),this._config=At({},this._defaultConfig,u),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return a.prototype.config=function(u){if((u===void 0?"undefined":r(u))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var h in u){if(h==="storeName"&&(u[h]=u[h].replace(/\W/g,"_")),h==="version"&&typeof u[h]!="number")return new Error("Database version must be a number.");this._config[h]=u[h]}return!("driver"in u)||!u.driver||this.setDriver(this._config.driver)}return typeof u=="string"?this._config[u]:this._config},a.prototype.defineDriver=function(u,h,_){var w=new m(function(b,C){try{var I=u._driver,x=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!u._driver)return void C(x);for(var R=Rt.concat("_initStorage"),B=0,j=R.length;B<j;B++){var q=R[B];if((!Po(Qe,q)||u[q])&&typeof u[q]!="function")return void C(x)}var V=function(){for(var oe=function(Oo){return function(){var Ho=new Error("Method "+Oo+" is not implemented by the current driver"),Dn=m.reject(Ho);return S(Dn,arguments[arguments.length-1]),Dn}},be=0,Lt=Qe.length;be<Lt;be++){var Mt=Qe[be];u[Mt]||(u[Mt]=oe(Mt))}};V();var K=function(oe){He[I],He[I]=u,Mn[I]=oe,b()};"_support"in u?u._support&&typeof u._support=="function"?u._support().then(K,C):K(!!u._support):K(!0)}catch(oe){C(oe)}});return k(w,h,_),w},a.prototype.driver=function(){return this._driver||null},a.prototype.getDriver=function(u,h,_){var w=He[u]?m.resolve(He[u]):m.reject(new Error("Driver not found."));return k(w,h,_),w},a.prototype.getSerializer=function(u){var h=m.resolve(Tt);return k(h,u),h},a.prototype.ready=function(u){var h=this,_=h._driverSet.then(function(){return h._ready===null&&(h._ready=h._initDriver()),h._ready});return k(_,u,u),_},a.prototype.setDriver=function(u,h,_){var w=this;Ln(u)||(u=[u]);var b=this._getSupportedDrivers(u);function C(){w._config.driver=w.driver()}function I(B){return w._extend(B),C(),w._ready=w._initStorage(w._config),w._ready}function x(B){return function(){var j=0;function q(){for(;j<B.length;){var V=B[j];return j++,w._dbInfo=null,w._ready=null,w.getDriver(V).then(I).catch(q)}C();var K=new Error("No available storage method found.");return w._driverSet=m.reject(K),w._driverSet}return q()}}var R=this._driverSet!==null?this._driverSet.catch(function(){return m.resolve()}):m.resolve();return this._driverSet=R.then(function(){var B=b[0];return w._dbInfo=null,w._ready=null,w.getDriver(B).then(function(j){w._driver=j._driver,C(),w._wrapLibraryMethodsWithReady(),w._initDriver=x(b)})}).catch(function(){C();var B=new Error("No available storage method found.");return w._driverSet=m.reject(B),w._driverSet}),k(this._driverSet,h,_),this._driverSet},a.prototype.supports=function(u){return!!Mn[u]},a.prototype._extend=function(u){At(this,u)},a.prototype._getSupportedDrivers=function(u){for(var h=[],_=0,w=u.length;_<w;_++){var b=u[_];this.supports(b)&&h.push(b)}return h},a.prototype._wrapLibraryMethodsWithReady=function(){for(var u=0,h=Rt.length;u<h;u++)Wo(this,Rt[u])},a.prototype.createInstance=function(u){return new a(u)},a}(),jo=new $o;e.exports=jo},{3:3}]},{},[4])(4)),Qn.exports);_t(vi);var er={exports:{}},yi=(Zn||(Zn=1,function(n){((e,t)=>{n.exports=t()})(0,()=>{const e=typeof window=="object"?window:this;e.HTMLElement;let t=null,r=!1;const o=e.WebStreamsPolyfill||{},i=e.isSecureContext;let s=/constructor/i.test(e.HTMLElement)||!!e.safari||!!e.WebKitPoint;const c=i||"MozAppearance"in document.documentElement.style?"iframe":"navigate",p={createWriteStream:function(S,k,W){let N={size:null,pathname:null,writableStrategy:void 0,readableStrategy:void 0},L=0,d=null,l=null,v=null;if(Number.isFinite(k)?([W,k]=[k,W],N.size=W,N.writableStrategy=k):k&&k.highWaterMark?(N.size=W,N.writableStrategy=k):N=k||{},!s){t||(t=i?m(p.mitm):function(P){const D="width=200,height=100",T=document.createDocumentFragment(),M={frame:e.open(P,"popup",D),loaded:!1,isIframe:!1,isPopup:!0,remove(){M.frame.close()},addEventListener(...H){T.addEventListener(...H)},dispatchEvent(...H){T.dispatchEvent(...H)},removeEventListener(...H){T.removeEventListener(...H)},postMessage(...H){M.frame.postMessage(...H)}},O=H=>{H.source===M.frame&&(M.loaded=!0,e.removeEventListener("message",O),M.dispatchEvent(new Event("load")))};return e.addEventListener("message",O),M}(p.mitm)),l=new MessageChannel,S=encodeURIComponent(S.replace(/\//g,":")).replace(/['()]/g,escape).replace(/\*/g,"%2A");const f={transferringReadable:r,pathname:N.pathname||Math.random().toString().slice(-6)+"/"+S,headers:{"Content-Type":"application/octet-stream; charset=utf-8","Content-Disposition":"attachment; filename*=UTF-8''"+S}};N.size&&(f.headers["Content-Length"]=N.size);const y=[f,"*",[l.port2]];if(r){const P=c==="iframe"?void 0:{transform(T,M){if(!(T instanceof Uint8Array))throw new TypeError("Can only write Uint8Arrays");L+=T.length,M.enqueue(T),d&&(location.href=d,d=null)},flush(){d&&(location.href=d)}};v=new p.TransformStream(P,N.writableStrategy,N.readableStrategy);const D=v.readable;l.port1.postMessage({readableStream:D},[D])}l.port1.onmessage=P=>{P.data.download?c==="navigate"?(t.remove(),t=null,L?location.href=P.data.download:d=P.data.download):(t.isPopup&&(t.remove(),t=null,c==="iframe"&&m(p.mitm)),m(P.data.download)):P.data.abort&&(g=[],l.port1.postMessage("abort"),l.port1.onmessage=null,l.port1.close(),l.port2.close(),l=null)},t.loaded?t.postMessage(...y):t.addEventListener("load",()=>{t.postMessage(...y)},{once:!0})}let g=[];return!s&&v&&v.writable||new p.WritableStream({write(f){if(!(f instanceof Uint8Array))throw new TypeError("Can only write Uint8Arrays");s?g.push(f):(l.port1.postMessage(f),L+=f.length,d&&(location.href=d,d=null))},close(){if(s){const f=new Blob(g,{type:"application/octet-stream; charset=utf-8"}),y=document.createElement("a");y.href=URL.createObjectURL(f),y.download=S,y.click()}else l.port1.postMessage("end")},abort(){g=[],l.port1.postMessage("abort"),l.port1.onmessage=null,l.port1.close(),l.port2.close(),l=null}},N.writableStrategy)},WritableStream:e.WritableStream||o.WritableStream,supported:!0,version:{full:"2.0.5",major:2,minor:0,dot:5},mitm:"https://jimmywarting.github.io/StreamSaver.js/mitm.html?version=2.0.0"};function m(S){if(!S)throw new Error("meh");const k=document.createElement("iframe");return k.hidden=!0,k.src=S,k.loaded=!1,k.name="iframe",k.isIframe=!0,k.postMessage=(...W)=>k.contentWindow.postMessage(...W),k.addEventListener("load",()=>{k.loaded=!0},{once:!0}),document.body.appendChild(k),k}try{new Response(new ReadableStream),i&&!("serviceWorker"in navigator)&&(s=!0)}catch{s=!0}return(S=>{try{S()}catch{}})(()=>{const{readable:S}=new TransformStream,k=new MessageChannel;k.port1.postMessage(S,[S]),k.port1.close(),k.port2.close(),r=!0,Object.defineProperty(p,"TransformStream",{configurable:!1,writable:!1,value:TransformStream})}),p})}(er)),er.exports);_t(yi);function wi(n={},e={}){let t;for(t in e)cn(e[t])?n[t]=wi(n[t],e[t]):n[t]=e[t];return n}function _i(n,e){const t=`${n}_${e}`;return he.MD5(t)}function bi(n){const e=function(c){if(!c)return;const p=c,m=[];if(p)for(let S of p){const k=Mr(S);k&&m.push(k)}return m}(n.bussinessRoutes),t=function(c){if(!c)return;const p=c;if(p&&p.length>0){const m=[];return p.forEach(S=>{const k=Dr(S);k&&m.push(k)}),m}}(n.widgetMenuConfig),r=function(c){if(c&&c.length>0){const p=[];return c.forEach(m=>{const S=function(k){return k?{id:k.id,label:k.label,layoutID:k.layoutID,container:k.container,preload:k.preload,afterid:k.afterid,bindid:k.bindid,group:k.group}:void 0}(m);S&&p.push(S)}),p}}(n.widgetConfig),o=function(c){if(c&&c.length>0)return c}(n.functionList),i=n.pkgObject.version,s=n.pkgObject.name;return{id:_i(s,i),name:$.Config.UI.SiteTitle,group:$.Config.UI.Group,product:s,version:i,routes:e,widgetMenu:t,widgets:r,functions:o}}function Mr(n){if(n){let e=0;n.meta?.hidden&&(e=1);let t={path:n.path,name:n.name,title:n.meta?.title,type:e,index:n.meta?.index};if(n.children){const r=[];for(let o of n.children){const i=Mr(o);i&&r.push(i)}r.length>0&&(t.children=r)}return t}}function Dr(n){if(!n)return;const e={name:n.name,index:n.index,path:n.path,type:n.type};return n.children&&n.children.length>0&&(e.children=[],n.children.forEach(t=>{const r=Dr(t);r&&e.children?.push(r)})),e}function Ts(n,e){const t=bi(n);li(t,e),$.Message?.msg("导出系统功能权限文件成功！")}let Pr=!0;try{String.fromCharCode.apply(String,[1,2])}catch{Pr=!1,Object.defineProperty(Array.prototype,"subarray",{value:Array.prototype.slice})}var Zt=2654435769;function Br(n,e){var t=n.length,r=t<<2;if(e){var o=n[t-1];if(o<(r-=4)-3||o>r)return null;r=o}for(var i=new Uint8Array(r),s=0;s<r;++s)i[s]=n[s>>2]>>((3&s)<<3);return i}function ft(n,e){var t,r=n.length,o=r>>2;3&r&&++o,e?(t=new Uint32Array(o+1))[o]=r:t=new Uint32Array(o);for(var i=0;i<r;++i)t[i>>2]|=n[i]<<((3&i)<<3);return t}function Te(n){return 4294967295&n}function pt(n,e,t,r,o,i){return(t>>>5^e<<2)+(e>>>3^t<<4)^(n^e)+(i[3&r^o]^t)}function Nr(n){if(n.length<16){var e=new Uint8Array(16);e.set(n),n=e}return n}function gt(n){for(var e=n.length,t=new Uint8Array(3*e),r=0,o=0;o<e;o++){var i=n.charCodeAt(o);if(i<128)t[r++]=i;else if(i<2048)t[r++]=192|i>>6,t[r++]=128|63&i;else{if(!(i<55296||i>57343)){if(o+1<e){var s=n.charCodeAt(o+1);if(i<56320&&56320<=s&&s<=57343){var c=65536+((1023&i)<<10|1023&s);t[r++]=240|c>>18,t[r++]=128|c>>12&63,t[r++]=128|c>>6&63,t[r++]=128|63&c,o++;continue}}throw new Error("Malformed string")}t[r++]=224|i>>12,t[r++]=128|i>>6&63,t[r++]=128|63&i}}return t.subarray(0,r)}function tr(n){var e=n.length;return e===0?"":e<32767?function(t,r){for(var o=new Array(r),i=0,s=0,c=t.length;i<r&&s<c;i++){var p=t[s++];switch(p>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o[i]=p;break;case 12:case 13:if(!(s<c))throw new Error("Unfinished UTF-8 octet sequence");o[i]=(31&p)<<6|63&t[s++];break;case 14:if(!(s+1<c))throw new Error("Unfinished UTF-8 octet sequence");o[i]=(15&p)<<12|(63&t[s++])<<6|63&t[s++];break;case 15:if(!(s+2<c))throw new Error("Unfinished UTF-8 octet sequence");var m=((7&p)<<18|(63&t[s++])<<12|(63&t[s++])<<6|63&t[s++])-65536;if(!(0<=m&&m<=1048575))throw new Error("Character outside valid Unicode range: 0x"+m.toString(16));o[i++]=m>>10&1023|55296,o[i]=1023&m|56320;break;default:throw new Error("Bad UTF-8 encoding 0x"+p.toString(16))}}return i<r&&(o.length=i),String.fromCharCode.apply(String,o)}(n,e):function(t,r){for(var o=[],i=new Array(32768),s=0,c=0,p=t.length;s<r&&c<p;s++){var m=t[c++];switch(m>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:i[s]=m;break;case 12:case 13:if(!(c<p))throw new Error("Unfinished UTF-8 octet sequence");i[s]=(31&m)<<6|63&t[c++];break;case 14:if(!(c+1<p))throw new Error("Unfinished UTF-8 octet sequence");i[s]=(15&m)<<12|(63&t[c++])<<6|63&t[c++];break;case 15:if(!(c+2<p))throw new Error("Unfinished UTF-8 octet sequence");var S=((7&m)<<18|(63&t[c++])<<12|(63&t[c++])<<6|63&t[c++])-65536;if(!(0<=S&&S<=1048575))throw new Error("Character outside valid Unicode range: 0x"+S.toString(16));i[s++]=S>>10&1023|55296,i[s]=1023&S|56320;break;default:throw new Error("Bad UTF-8 encoding 0x"+m.toString(16))}if(s>=32766){var k=s+1;i.length=k,o.push(String.fromCharCode.apply(String,i)),r-=k,s=-1}}return s>0&&(i.length=s,o.push(String.fromCharCode.apply(String,i))),o.join("")}(n,e)}function Si(n){var e=n.length;if(e===0)return"";var t=Pr?n:function(c){for(var p=c.length,m=new Array(c.length),S=0;S<p;++S)m[S]=c[S];return m}(n);if(e<65535)return String.fromCharCode.apply(String,t);for(var r=32767&e,o=e>>15,i=new Array(r?o+1:o),s=0;s<o;++s)i[s]=String.fromCharCode.apply(String,t.subarray(s<<15,s+1<<15));return r&&(i[o]=String.fromCharCode.apply(String,t.subarray(o<<15,e))),i.join("")}function nr(n,e){return typeof n=="string"&&(n=gt(n)),typeof e=="string"&&(e=gt(e)),n==null||n.length===0?n:Br(function(t,r){var o,i,s,c,p,m,S=t.length,k=S-1;for(i=t[k],s=0,m=0|Math.floor(6+52/S);m>0;--m){for(c=(s=Te(s+Zt))>>>2&3,p=0;p<k;++p)o=t[p+1],i=t[p]=Te(t[p]+pt(s,o,i,p,c,r));o=t[0],i=t[k]=Te(t[k]+pt(s,o,i,k,c,r))}return t}(ft(n,!0),ft(Nr(e),!1)),!1)}function rr(n,e){return typeof n=="string"&&(n=function(t){for(var r=window.atob(t),o=r.length,i=new Uint8Array(o),s=0;s<o;s++)i[s]=r.charCodeAt(s);return i}(n)),typeof e=="string"&&(e=gt(e)),n==null||n.length===0?n:Br(function(t,r){var o,i,s,c,p,m=t.length,S=m-1;for(o=t[0],s=Te(Math.floor(6+52/m)*Zt);s!==0;s=Te(s-Zt)){for(c=s>>>2&3,p=S;p>0;--p)i=t[p-1],o=t[p]=Te(t[p]-pt(s,o,i,p,c,r));i=t[S],o=t[0]=Te(t[0]-pt(s,o,i,0,c,r))}return t}(ft(n,!1),ft(Nr(e),!1)),!0)}const en={toBytes:gt,toString:tr,encrypt:nr,encryptToString:function(n,e){return window.btoa(Si(nr(n,e)))},decrypt:rr,decryptToString:function(n,e){return tr(rr(n,e))}};class Re extends Error{constructor(e,t){const r=new.target.prototype;super(`${e}: Status code '${t}'`),this.statusCode=t,this.__proto__=r}}class ln extends Error{constructor(e="A timeout occurred."){const t=new.target.prototype;super(e),this.__proto__=t}}class ve extends Error{constructor(e="An abort occurred."){const t=new.target.prototype;super(e),this.__proto__=t}}class Ci extends Error{constructor(e,t){const r=new.target.prototype;super(e),this.transport=t,this.errorType="UnsupportedTransportError",this.__proto__=r}}class Ei extends Error{constructor(e,t){const r=new.target.prototype;super(e),this.transport=t,this.errorType="DisabledTransportError",this.__proto__=r}}class ki extends Error{constructor(e,t){const r=new.target.prototype;super(e),this.transport=t,this.errorType="FailedToStartTransportError",this.__proto__=r}}class or extends Error{constructor(e){const t=new.target.prototype;super(e),this.errorType="FailedToNegotiateWithServerError",this.__proto__=t}}class Ii extends Error{constructor(e,t){const r=new.target.prototype;super(e),this.innerErrors=t,this.__proto__=r}}class Wr{constructor(e,t,r){this.statusCode=e,this.statusText=t,this.content=r}}class bt{get(e,t){return this.send({...t,method:"GET",url:e})}post(e,t){return this.send({...t,method:"POST",url:e})}delete(e,t){return this.send({...t,method:"DELETE",url:e})}getCookieString(e){return""}}var E;(function(n){n[n.Trace=0]="Trace",n[n.Debug=1]="Debug",n[n.Information=2]="Information",n[n.Warning=3]="Warning",n[n.Error=4]="Error",n[n.Critical=5]="Critical",n[n.None=6]="None"})(E||(E={}));class Ke{constructor(){}log(e,t){}}Ke.instance=new Ke;class ee{static isRequired(e,t){if(e==null)throw new Error(`The '${t}' argument is required.`)}static isNotEmpty(e,t){if(!e||e.match(/^\s*$/))throw new Error(`The '${t}' argument should not be empty.`)}static isIn(e,t,r){if(!(e in t))throw new Error(`Unknown ${r} value: ${e}.`)}}class Q{static get isBrowser(){return!Q.isNode&&typeof window=="object"&&typeof window.document=="object"}static get isWebWorker(){return!Q.isNode&&typeof self=="object"&&"importScripts"in self}static get isReactNative(){return!Q.isNode&&typeof window=="object"&&window.document===void 0}static get isNode(){return typeof process<"u"&&process.release&&process.release.name==="node"}}function Ye(n,e){let t="";return Le(n)?(t=`Binary data of length ${n.byteLength}`,e&&(t+=`. Content: '${function(r){const o=new Uint8Array(r);let i="";return o.forEach(s=>{i+=`0x${s<16?"0":""}${s.toString(16)} `}),i.substr(0,i.length-1)}(n)}'`)):typeof n=="string"&&(t=`String data of length ${n.length}`,e&&(t+=`. Content: '${n}'`)),t}function Le(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}async function $r(n,e,t,r,o,i){const s={},[c,p]=$e();s[c]=p,n.log(E.Trace,`(${e} transport) sending data. ${Ye(o,i.logMessageContent)}.`);const m=Le(o)?"arraybuffer":"text",S=await t.post(r,{content:o,headers:{...s,...i.headers},responseType:m,timeout:i.timeout,withCredentials:i.withCredentials});n.log(E.Trace,`(${e} transport) request complete. Response status: ${S.statusCode}.`)}class xi{constructor(e,t){this._subject=e,this._observer=t}dispose(){const e=this._subject.observers.indexOf(this._observer);e>-1&&this._subject.observers.splice(e,1),this._subject.observers.length===0&&this._subject.cancelCallback&&this._subject.cancelCallback().catch(t=>{})}}class mt{constructor(e){this._minLevel=e,this.out=console}log(e,t){if(e>=this._minLevel){const r=`[${new Date().toISOString()}] ${E[e]}: ${t}`;switch(e){case E.Critical:case E.Error:this.out.error(r);break;case E.Warning:this.out.warn(r);break;case E.Information:this.out.info(r);break;default:this.out.log(r)}}}}function $e(){let n="X-SignalR-User-Agent";return Q.isNode&&(n="User-Agent"),[n,Ti("8.0.7",Ri(),Li(),Ai())]}function Ti(n,e,t,r){let o="Microsoft SignalR/";const i=n.split(".");return o+=`${i[0]}.${i[1]}`,o+=` (${n}; `,o+=e&&e!==""?`${e}; `:"Unknown OS; ",o+=`${t}`,o+=r?`; ${r}`:"; Unknown Runtime Version",o+=")",o}function Ri(){if(!Q.isNode)return"";switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}}function Ai(){if(Q.isNode)return process.versions.node}function Li(){return Q.isNode?"NodeJS":"Browser"}function Xt(n){return n.stack?n.stack:n.message?n.message:`${n}`}class Mi extends bt{constructor(e){if(super(),this._logger=e,typeof fetch>"u"||Q.isNode){const t=typeof __webpack_require__=="function"?__non_webpack_require__:require;this._jar=new(t("tough-cookie")).CookieJar,typeof fetch>"u"?this._fetchType=t("node-fetch"):this._fetchType=fetch,this._fetchType=t("fetch-cookie")(this._fetchType,this._jar)}else this._fetchType=fetch.bind(function(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("could not find global")}());if(typeof AbortController>"u"){const t=typeof __webpack_require__=="function"?__non_webpack_require__:require;this._abortControllerType=t("abort-controller")}else this._abortControllerType=AbortController}async send(e){if(e.abortSignal&&e.abortSignal.aborted)throw new ve;if(!e.method)throw new Error("No method defined.");if(!e.url)throw new Error("No url defined.");const t=new this._abortControllerType;let r;e.abortSignal&&(e.abortSignal.onabort=()=>{t.abort(),r=new ve});let o,i=null;if(e.timeout){const p=e.timeout;i=setTimeout(()=>{t.abort(),this._logger.log(E.Warning,"Timeout from HTTP request."),r=new ln},p)}e.content===""&&(e.content=void 0),e.content&&(e.headers=e.headers||{},Le(e.content)?e.headers["Content-Type"]="application/octet-stream":e.headers["Content-Type"]="text/plain;charset=UTF-8");try{o=await this._fetchType(e.url,{body:e.content,cache:"no-cache",credentials:e.withCredentials===!0?"include":"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",...e.headers},method:e.method,mode:"cors",redirect:"follow",signal:t.signal})}catch(p){throw r||(this._logger.log(E.Warning,`Error from HTTP request. ${p}.`),p)}finally{i&&clearTimeout(i),e.abortSignal&&(e.abortSignal.onabort=null)}if(!o.ok){const p=await ir(o,"text");throw new Re(p||o.statusText,o.status)}const s=ir(o,e.responseType),c=await s;return new Wr(o.status,o.statusText,c)}getCookieString(e){let t="";return Q.isNode&&this._jar&&this._jar.getCookies(e,(r,o)=>t=o.join("; ")),t}}function ir(n,e){let t;switch(e){case"arraybuffer":t=n.arrayBuffer();break;case"text":default:t=n.text();break;case"blob":case"document":case"json":throw new Error(`${e} is not supported.`)}return t}class Di extends bt{constructor(e){super(),this._logger=e}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new ve):e.method?e.url?new Promise((t,r)=>{const o=new XMLHttpRequest;o.open(e.method,e.url,!0),o.withCredentials=e.withCredentials===void 0||e.withCredentials,o.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.content===""&&(e.content=void 0),e.content&&(Le(e.content)?o.setRequestHeader("Content-Type","application/octet-stream"):o.setRequestHeader("Content-Type","text/plain;charset=UTF-8"));const i=e.headers;i&&Object.keys(i).forEach(s=>{o.setRequestHeader(s,i[s])}),e.responseType&&(o.responseType=e.responseType),e.abortSignal&&(e.abortSignal.onabort=()=>{o.abort(),r(new ve)}),e.timeout&&(o.timeout=e.timeout),o.onload=()=>{e.abortSignal&&(e.abortSignal.onabort=null),o.status>=200&&o.status<300?t(new Wr(o.status,o.statusText,o.response||o.responseText)):r(new Re(o.response||o.responseText||o.statusText,o.status))},o.onerror=()=>{this._logger.log(E.Warning,`Error from HTTP request. ${o.status}: ${o.statusText}.`),r(new Re(o.statusText,o.status))},o.ontimeout=()=>{this._logger.log(E.Warning,"Timeout from HTTP request."),r(new ln)},o.send(e.content)}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}}class Pi extends bt{constructor(e){if(super(),typeof fetch<"u"||Q.isNode)this._httpClient=new Mi(e);else{if(typeof XMLHttpRequest>"u")throw new Error("No usable HttpClient found.");this._httpClient=new Di(e)}}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new ve):e.method?e.url?this._httpClient.send(e):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(e){return this._httpClient.getCookieString(e)}}class pe{static write(e){return`${e}${pe.RecordSeparator}`}static parse(e){if(e[e.length-1]!==pe.RecordSeparator)throw new Error("Message is incomplete.");const t=e.split(pe.RecordSeparator);return t.pop(),t}}pe.RecordSeparatorCode=30,pe.RecordSeparator=String.fromCharCode(pe.RecordSeparatorCode);class Bi{writeHandshakeRequest(e){return pe.write(JSON.stringify(e))}parseHandshakeResponse(e){let t,r;if(Le(e)){const s=new Uint8Array(e),c=s.indexOf(pe.RecordSeparatorCode);if(c===-1)throw new Error("Message is incomplete.");const p=c+1;t=String.fromCharCode.apply(null,Array.prototype.slice.call(s.slice(0,p))),r=s.byteLength>p?s.slice(p).buffer:null}else{const s=e,c=s.indexOf(pe.RecordSeparator);if(c===-1)throw new Error("Message is incomplete.");const p=c+1;t=s.substring(0,p),r=s.length>p?s.substring(p):null}const o=pe.parse(t),i=JSON.parse(o[0]);if(i.type)throw new Error("Expected a handshake response from the server.");return[r,i]}}var z;(function(n){n[n.Invocation=1]="Invocation",n[n.StreamItem=2]="StreamItem",n[n.Completion=3]="Completion",n[n.StreamInvocation=4]="StreamInvocation",n[n.CancelInvocation=5]="CancelInvocation",n[n.Ping=6]="Ping",n[n.Close=7]="Close",n[n.Ack=8]="Ack",n[n.Sequence=9]="Sequence"})(z||(z={}));class Ni{constructor(){this.observers=[]}next(e){for(const t of this.observers)t.next(e)}error(e){for(const t of this.observers)t.error&&t.error(e)}complete(){for(const e of this.observers)e.complete&&e.complete()}subscribe(e){return this.observers.push(e),new xi(this,e)}}class Wi{constructor(e,t,r){this._bufferSize=1e5,this._messages=[],this._totalMessageCount=0,this._waitForSequenceMessage=!1,this._nextReceivingSequenceId=1,this._latestReceivedSequenceId=0,this._bufferedByteCount=0,this._reconnectInProgress=!1,this._protocol=e,this._connection=t,this._bufferSize=r}async _send(e){const t=this._protocol.writeMessage(e);let r=Promise.resolve();if(this._isInvocationMessage(e)){this._totalMessageCount++;let o=()=>{},i=()=>{};Le(t)?this._bufferedByteCount+=t.byteLength:this._bufferedByteCount+=t.length,this._bufferedByteCount>=this._bufferSize&&(r=new Promise((s,c)=>{o=s,i=c})),this._messages.push(new $i(t,this._totalMessageCount,o,i))}try{this._reconnectInProgress||await this._connection.send(t)}catch{this._disconnected()}await r}_ack(e){let t=-1;for(let r=0;r<this._messages.length;r++){const o=this._messages[r];if(o._id<=e.sequenceId)t=r,Le(o._message)?this._bufferedByteCount-=o._message.byteLength:this._bufferedByteCount-=o._message.length,o._resolver();else{if(!(this._bufferedByteCount<this._bufferSize))break;o._resolver()}}t!==-1&&(this._messages=this._messages.slice(t+1))}_shouldProcessMessage(e){if(this._waitForSequenceMessage)return e.type===z.Sequence&&(this._waitForSequenceMessage=!1,!0);if(!this._isInvocationMessage(e))return!0;const t=this._nextReceivingSequenceId;return this._nextReceivingSequenceId++,t<=this._latestReceivedSequenceId?(t===this._latestReceivedSequenceId&&this._ackTimer(),!1):(this._latestReceivedSequenceId=t,this._ackTimer(),!0)}_resetSequence(e){e.sequenceId>this._nextReceivingSequenceId?this._connection.stop(new Error("Sequence ID greater than amount of messages we've received.")):this._nextReceivingSequenceId=e.sequenceId}_disconnected(){this._reconnectInProgress=!0,this._waitForSequenceMessage=!0}async _resend(){const e=this._messages.length!==0?this._messages[0]._id:this._totalMessageCount+1;await this._connection.send(this._protocol.writeMessage({type:z.Sequence,sequenceId:e}));const t=this._messages;for(const r of t)await this._connection.send(r._message);this._reconnectInProgress=!1}_dispose(e){e!=null||(e=new Error("Unable to reconnect to server."));for(const t of this._messages)t._rejector(e)}_isInvocationMessage(e){switch(e.type){case z.Invocation:case z.StreamItem:case z.Completion:case z.StreamInvocation:case z.CancelInvocation:return!0;case z.Close:case z.Sequence:case z.Ping:case z.Ack:return!1}}_ackTimer(){this._ackTimerHandle===void 0&&(this._ackTimerHandle=setTimeout(async()=>{try{this._reconnectInProgress||await this._connection.send(this._protocol.writeMessage({type:z.Ack,sequenceId:this._latestReceivedSequenceId}))}catch{}clearTimeout(this._ackTimerHandle),this._ackTimerHandle=void 0},1e3))}}class $i{constructor(e,t,r,o){this._message=e,this._id=t,this._resolver=r,this._rejector=o}}var J;(function(n){n.Disconnected="Disconnected",n.Connecting="Connecting",n.Connected="Connected",n.Disconnecting="Disconnecting",n.Reconnecting="Reconnecting"})(J||(J={}));class un{static create(e,t,r,o,i,s,c){return new un(e,t,r,o,i,s,c)}constructor(e,t,r,o,i,s,c){this._nextKeepAlive=0,this._freezeEventListener=()=>{this._logger.log(E.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://learn.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},ee.isRequired(e,"connection"),ee.isRequired(t,"logger"),ee.isRequired(r,"protocol"),this.serverTimeoutInMilliseconds=i??3e4,this.keepAliveIntervalInMilliseconds=s??15e3,this._statefulReconnectBufferSize=c??1e5,this._logger=t,this._protocol=r,this.connection=e,this._reconnectPolicy=o,this._handshakeProtocol=new Bi,this.connection.onreceive=p=>this._processIncomingData(p),this.connection.onclose=p=>this._connectionClosed(p),this._callbacks={},this._methods={},this._closedCallbacks=[],this._reconnectingCallbacks=[],this._reconnectedCallbacks=[],this._invocationId=0,this._receivedHandshakeResponse=!1,this._connectionState=J.Disconnected,this._connectionStarted=!1,this._cachedPingMessage=this._protocol.writeMessage({type:z.Ping})}get state(){return this._connectionState}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(e){if(this._connectionState!==J.Disconnected&&this._connectionState!==J.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!e)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=e}start(){return this._startPromise=this._startWithStateTransitions(),this._startPromise}async _startWithStateTransitions(){if(this._connectionState!==J.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));this._connectionState=J.Connecting,this._logger.log(E.Debug,"Starting HubConnection.");try{await this._startInternal(),Q.isBrowser&&window.document.addEventListener("freeze",this._freezeEventListener),this._connectionState=J.Connected,this._connectionStarted=!0,this._logger.log(E.Debug,"HubConnection connected successfully.")}catch(e){return this._connectionState=J.Disconnected,this._logger.log(E.Debug,`HubConnection failed to start successfully because of error '${e}'.`),Promise.reject(e)}}async _startInternal(){this._stopDuringStartError=void 0,this._receivedHandshakeResponse=!1;const e=new Promise((t,r)=>{this._handshakeResolver=t,this._handshakeRejecter=r});await this.connection.start(this._protocol.transferFormat);try{let t=this._protocol.version;this.connection.features.reconnect||(t=1);const r={protocol:this._protocol.name,version:t};if(this._logger.log(E.Debug,"Sending handshake request."),await this._sendMessage(this._handshakeProtocol.writeHandshakeRequest(r)),this._logger.log(E.Information,`Using HubProtocol '${this._protocol.name}'.`),this._cleanupTimeout(),this._resetTimeoutPeriod(),this._resetKeepAliveInterval(),await e,this._stopDuringStartError)throw this._stopDuringStartError;this.connection.features.reconnect&&(this._messageBuffer=new Wi(this._protocol,this.connection,this._statefulReconnectBufferSize),this.connection.features.disconnected=this._messageBuffer._disconnected.bind(this._messageBuffer),this.connection.features.resend=()=>{if(this._messageBuffer)return this._messageBuffer._resend()}),this.connection.features.inherentKeepAlive||await this._sendMessage(this._cachedPingMessage)}catch(t){throw this._logger.log(E.Debug,`Hub handshake failed with error '${t}' during start(). Stopping HubConnection.`),this._cleanupTimeout(),this._cleanupPingTimer(),await this.connection.stop(t),t}}async stop(){const e=this._startPromise;this.connection.features.reconnect=!1,this._stopPromise=this._stopInternal(),await this._stopPromise;try{await e}catch{}}_stopInternal(e){if(this._connectionState===J.Disconnected)return this._logger.log(E.Debug,`Call to HubConnection.stop(${e}) ignored because it is already in the disconnected state.`),Promise.resolve();if(this._connectionState===J.Disconnecting)return this._logger.log(E.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;const t=this._connectionState;return this._connectionState=J.Disconnecting,this._logger.log(E.Debug,"Stopping HubConnection."),this._reconnectDelayHandle?(this._logger.log(E.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this._reconnectDelayHandle),this._reconnectDelayHandle=void 0,this._completeClose(),Promise.resolve()):(t===J.Connected&&this._sendCloseMessage(),this._cleanupTimeout(),this._cleanupPingTimer(),this._stopDuringStartError=e||new ve("The connection was stopped before the hub handshake could complete."),this.connection.stop(e))}async _sendCloseMessage(){try{await this._sendWithProtocol(this._createCloseMessage())}catch{}}stream(e,...t){const[r,o]=this._replaceStreamingParams(t),i=this._createStreamInvocation(e,t,o);let s;const c=new Ni;return c.cancelCallback=()=>{const p=this._createCancelInvocation(i.invocationId);return delete this._callbacks[i.invocationId],s.then(()=>this._sendWithProtocol(p))},this._callbacks[i.invocationId]=(p,m)=>{m?c.error(m):p&&(p.type===z.Completion?p.error?c.error(new Error(p.error)):c.complete():c.next(p.item))},s=this._sendWithProtocol(i).catch(p=>{c.error(p),delete this._callbacks[i.invocationId]}),this._launchStreams(r,s),c}_sendMessage(e){return this._resetKeepAliveInterval(),this.connection.send(e)}_sendWithProtocol(e){return this._messageBuffer?this._messageBuffer._send(e):this._sendMessage(this._protocol.writeMessage(e))}send(e,...t){const[r,o]=this._replaceStreamingParams(t),i=this._sendWithProtocol(this._createInvocation(e,t,!0,o));return this._launchStreams(r,i),i}invoke(e,...t){const[r,o]=this._replaceStreamingParams(t),i=this._createInvocation(e,t,!1,o);return new Promise((s,c)=>{this._callbacks[i.invocationId]=(m,S)=>{S?c(S):m&&(m.type===z.Completion?m.error?c(new Error(m.error)):s(m.result):c(new Error(`Unexpected message type: ${m.type}`)))};const p=this._sendWithProtocol(i).catch(m=>{c(m),delete this._callbacks[i.invocationId]});this._launchStreams(r,p)})}on(e,t){e&&t&&(e=e.toLowerCase(),this._methods[e]||(this._methods[e]=[]),this._methods[e].indexOf(t)===-1&&this._methods[e].push(t))}off(e,t){if(!e)return;e=e.toLowerCase();const r=this._methods[e];if(r)if(t){const o=r.indexOf(t);o!==-1&&(r.splice(o,1),r.length===0&&delete this._methods[e])}else delete this._methods[e]}onclose(e){e&&this._closedCallbacks.push(e)}onreconnecting(e){e&&this._reconnectingCallbacks.push(e)}onreconnected(e){e&&this._reconnectedCallbacks.push(e)}_processIncomingData(e){if(this._cleanupTimeout(),this._receivedHandshakeResponse||(e=this._processHandshakeResponse(e),this._receivedHandshakeResponse=!0),e){const t=this._protocol.parseMessages(e,this._logger);for(const r of t)if(!this._messageBuffer||this._messageBuffer._shouldProcessMessage(r))switch(r.type){case z.Invocation:this._invokeClientMethod(r).catch(o=>{this._logger.log(E.Error,`Invoke client method threw error: ${Xt(o)}`)});break;case z.StreamItem:case z.Completion:{const o=this._callbacks[r.invocationId];if(o){r.type===z.Completion&&delete this._callbacks[r.invocationId];try{o(r)}catch(i){this._logger.log(E.Error,`Stream callback threw error: ${Xt(i)}`)}}break}case z.Ping:break;case z.Close:{this._logger.log(E.Information,"Close message received from server.");const o=r.error?new Error("Server returned an error on close: "+r.error):void 0;r.allowReconnect===!0?this.connection.stop(o):this._stopPromise=this._stopInternal(o);break}case z.Ack:this._messageBuffer&&this._messageBuffer._ack(r);break;case z.Sequence:this._messageBuffer&&this._messageBuffer._resetSequence(r);break;default:this._logger.log(E.Warning,`Invalid message type: ${r.type}.`)}}this._resetTimeoutPeriod()}_processHandshakeResponse(e){let t,r;try{[r,t]=this._handshakeProtocol.parseHandshakeResponse(e)}catch(o){const i="Error parsing handshake response: "+o;this._logger.log(E.Error,i);const s=new Error(i);throw this._handshakeRejecter(s),s}if(t.error){const o="Server returned handshake error: "+t.error;this._logger.log(E.Error,o);const i=new Error(o);throw this._handshakeRejecter(i),i}return this._logger.log(E.Debug,"Server handshake complete."),this._handshakeResolver(),r}_resetKeepAliveInterval(){this.connection.features.inherentKeepAlive||(this._nextKeepAlive=new Date().getTime()+this.keepAliveIntervalInMilliseconds,this._cleanupPingTimer())}_resetTimeoutPeriod(){if(!(this.connection.features&&this.connection.features.inherentKeepAlive||(this._timeoutHandle=setTimeout(()=>this.serverTimeout(),this.serverTimeoutInMilliseconds),this._pingServerHandle!==void 0))){let e=this._nextKeepAlive-new Date().getTime();e<0&&(e=0),this._pingServerHandle=setTimeout(async()=>{if(this._connectionState===J.Connected)try{await this._sendMessage(this._cachedPingMessage)}catch{this._cleanupPingTimer()}},e)}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}async _invokeClientMethod(e){const t=e.target.toLowerCase(),r=this._methods[t];if(!r)return this._logger.log(E.Warning,`No client method with the name '${t}' found.`),void(e.invocationId&&(this._logger.log(E.Warning,`No result given for '${t}' method and invocation ID '${e.invocationId}'.`),await this._sendWithProtocol(this._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null))));const o=r.slice(),i=!!e.invocationId;let s,c,p;for(const m of o)try{const S=s;s=await m.apply(this,e.arguments),i&&s&&S&&(this._logger.log(E.Error,`Multiple results provided for '${t}'. Sending error to server.`),p=this._createCompletionMessage(e.invocationId,"Client provided multiple results.",null)),c=void 0}catch(S){c=S,this._logger.log(E.Error,`A callback for the method '${t}' threw error '${S}'.`)}p?await this._sendWithProtocol(p):i?(c?p=this._createCompletionMessage(e.invocationId,`${c}`,null):s!==void 0?p=this._createCompletionMessage(e.invocationId,null,s):(this._logger.log(E.Warning,`No result given for '${t}' method and invocation ID '${e.invocationId}'.`),p=this._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null)),await this._sendWithProtocol(p)):s&&this._logger.log(E.Error,`Result given for '${t}' method but server is not expecting a result.`)}_connectionClosed(e){this._logger.log(E.Debug,`HubConnection.connectionClosed(${e}) called while in state ${this._connectionState}.`),this._stopDuringStartError=this._stopDuringStartError||e||new ve("The underlying connection was closed before the hub handshake could complete."),this._handshakeResolver&&this._handshakeResolver(),this._cancelCallbacksWithError(e||new Error("Invocation canceled due to the underlying connection being closed.")),this._cleanupTimeout(),this._cleanupPingTimer(),this._connectionState===J.Disconnecting?this._completeClose(e):this._connectionState===J.Connected&&this._reconnectPolicy?this._reconnect(e):this._connectionState===J.Connected&&this._completeClose(e)}_completeClose(e){if(this._connectionStarted){this._connectionState=J.Disconnected,this._connectionStarted=!1,this._messageBuffer&&(this._messageBuffer._dispose(e??new Error("Connection closed.")),this._messageBuffer=void 0),Q.isBrowser&&window.document.removeEventListener("freeze",this._freezeEventListener);try{this._closedCallbacks.forEach(t=>t.apply(this,[e]))}catch(t){this._logger.log(E.Error,`An onclose callback called with error '${e}' threw error '${t}'.`)}}}async _reconnect(e){const t=Date.now();let r=0,o=e!==void 0?e:new Error("Attempting to reconnect due to a unknown error."),i=this._getNextRetryDelay(r++,0,o);if(i===null)return this._logger.log(E.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),void this._completeClose(e);if(this._connectionState=J.Reconnecting,e?this._logger.log(E.Information,`Connection reconnecting because of error '${e}'.`):this._logger.log(E.Information,"Connection reconnecting."),this._reconnectingCallbacks.length!==0){try{this._reconnectingCallbacks.forEach(s=>s.apply(this,[e]))}catch(s){this._logger.log(E.Error,`An onreconnecting callback called with error '${e}' threw error '${s}'.`)}if(this._connectionState!==J.Reconnecting)return void this._logger.log(E.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.")}for(;i!==null;){if(this._logger.log(E.Information,`Reconnect attempt number ${r} will start in ${i} ms.`),await new Promise(s=>{this._reconnectDelayHandle=setTimeout(s,i)}),this._reconnectDelayHandle=void 0,this._connectionState!==J.Reconnecting)return void this._logger.log(E.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");try{if(await this._startInternal(),this._connectionState=J.Connected,this._logger.log(E.Information,"HubConnection reconnected successfully."),this._reconnectedCallbacks.length!==0)try{this._reconnectedCallbacks.forEach(s=>s.apply(this,[this.connection.connectionId]))}catch(s){this._logger.log(E.Error,`An onreconnected callback called with connectionId '${this.connection.connectionId}; threw error '${s}'.`)}return}catch(s){if(this._logger.log(E.Information,`Reconnect attempt failed because of error '${s}'.`),this._connectionState!==J.Reconnecting)return this._logger.log(E.Debug,`Connection moved to the '${this._connectionState}' from the reconnecting state during reconnect attempt. Done reconnecting.`),void(this._connectionState===J.Disconnecting&&this._completeClose());o=s instanceof Error?s:new Error(s.toString()),i=this._getNextRetryDelay(r++,Date.now()-t,o)}}this._logger.log(E.Information,`Reconnect retries have been exhausted after ${Date.now()-t} ms and ${r} failed attempts. Connection disconnecting.`),this._completeClose()}_getNextRetryDelay(e,t,r){try{return this._reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:t,previousRetryCount:e,retryReason:r})}catch(o){return this._logger.log(E.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${e}, ${t}) threw error '${o}'.`),null}}_cancelCallbacksWithError(e){const t=this._callbacks;this._callbacks={},Object.keys(t).forEach(r=>{const o=t[r];try{o(null,e)}catch(i){this._logger.log(E.Error,`Stream 'error' callback called with '${e}' threw error: ${Xt(i)}`)}})}_cleanupPingTimer(){this._pingServerHandle&&(clearTimeout(this._pingServerHandle),this._pingServerHandle=void 0)}_cleanupTimeout(){this._timeoutHandle&&clearTimeout(this._timeoutHandle)}_createInvocation(e,t,r,o){if(r)return o.length!==0?{arguments:t,streamIds:o,target:e,type:z.Invocation}:{arguments:t,target:e,type:z.Invocation};{const i=this._invocationId;return this._invocationId++,o.length!==0?{arguments:t,invocationId:i.toString(),streamIds:o,target:e,type:z.Invocation}:{arguments:t,invocationId:i.toString(),target:e,type:z.Invocation}}}_launchStreams(e,t){if(e.length!==0){t||(t=Promise.resolve());for(const r in e)e[r].subscribe({complete:()=>{t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(r)))},error:o=>{let i;i=o instanceof Error?o.message:o&&o.toString?o.toString():"Unknown error",t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(r,i)))},next:o=>{t=t.then(()=>this._sendWithProtocol(this._createStreamItemMessage(r,o)))}})}}_replaceStreamingParams(e){const t=[],r=[];for(let o=0;o<e.length;o++){const i=e[o];if(this._isObservable(i)){const s=this._invocationId;this._invocationId++,t[s]=i,r.push(s.toString()),e.splice(o,1)}}return[t,r]}_isObservable(e){return e&&e.subscribe&&typeof e.subscribe=="function"}_createStreamInvocation(e,t,r){const o=this._invocationId;return this._invocationId++,r.length!==0?{arguments:t,invocationId:o.toString(),streamIds:r,target:e,type:z.StreamInvocation}:{arguments:t,invocationId:o.toString(),target:e,type:z.StreamInvocation}}_createCancelInvocation(e){return{invocationId:e,type:z.CancelInvocation}}_createStreamItemMessage(e,t){return{invocationId:e,item:t,type:z.StreamItem}}_createCompletionMessage(e,t,r){return t?{error:t,invocationId:e,type:z.Completion}:{invocationId:e,result:r,type:z.Completion}}_createCloseMessage(){return{type:z.Close}}}const ji=[0,2e3,1e4,3e4,null];class sr{constructor(e){this._retryDelays=e!==void 0?[...e,null]:ji}nextRetryDelayInMilliseconds(e){return this._retryDelays[e.previousRetryCount]}}class Ae{}Ae.Authorization="Authorization",Ae.Cookie="Cookie";class Oi extends bt{constructor(e,t){super(),this._innerClient=e,this._accessTokenFactory=t}async send(e){let t=!0;this._accessTokenFactory&&(!this._accessToken||e.url&&e.url.indexOf("/negotiate?")>0)&&(t=!1,this._accessToken=await this._accessTokenFactory()),this._setAuthorizationHeader(e);const r=await this._innerClient.send(e);return t&&r.statusCode===401&&this._accessTokenFactory?(this._accessToken=await this._accessTokenFactory(),this._setAuthorizationHeader(e),await this._innerClient.send(e)):r}_setAuthorizationHeader(e){e.headers||(e.headers={}),this._accessToken?e.headers[Ae.Authorization]=`Bearer ${this._accessToken}`:this._accessTokenFactory&&e.headers[Ae.Authorization]&&delete e.headers[Ae.Authorization]}getCookieString(e){return this._innerClient.getCookieString(e)}}var te,se;(function(n){n[n.None=0]="None",n[n.WebSockets=1]="WebSockets",n[n.ServerSentEvents=2]="ServerSentEvents",n[n.LongPolling=4]="LongPolling"})(te||(te={})),function(n){n[n.Text=1]="Text",n[n.Binary=2]="Binary"}(se||(se={}));class Hi{constructor(){this._isAborted=!1,this.onabort=null}abort(){this._isAborted||(this._isAborted=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this._isAborted}}class ar{get pollAborted(){return this._pollAbort.aborted}constructor(e,t,r){this._httpClient=e,this._logger=t,this._pollAbort=new Hi,this._options=r,this._running=!1,this.onreceive=null,this.onclose=null}async connect(e,t){if(ee.isRequired(e,"url"),ee.isRequired(t,"transferFormat"),ee.isIn(t,se,"transferFormat"),this._url=e,this._logger.log(E.Trace,"(LongPolling transport) Connecting."),t===se.Binary&&typeof XMLHttpRequest<"u"&&typeof new XMLHttpRequest().responseType!="string")throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");const[r,o]=$e(),i={[r]:o,...this._options.headers},s={abortSignal:this._pollAbort.signal,headers:i,timeout:1e5,withCredentials:this._options.withCredentials};t===se.Binary&&(s.responseType="arraybuffer");const c=`${e}&_=${Date.now()}`;this._logger.log(E.Trace,`(LongPolling transport) polling: ${c}.`);const p=await this._httpClient.get(c,s);p.statusCode!==200?(this._logger.log(E.Error,`(LongPolling transport) Unexpected response code: ${p.statusCode}.`),this._closeError=new Re(p.statusText||"",p.statusCode),this._running=!1):this._running=!0,this._receiving=this._poll(this._url,s)}async _poll(e,t){try{for(;this._running;)try{const r=`${e}&_=${Date.now()}`;this._logger.log(E.Trace,`(LongPolling transport) polling: ${r}.`);const o=await this._httpClient.get(r,t);o.statusCode===204?(this._logger.log(E.Information,"(LongPolling transport) Poll terminated by server."),this._running=!1):o.statusCode!==200?(this._logger.log(E.Error,`(LongPolling transport) Unexpected response code: ${o.statusCode}.`),this._closeError=new Re(o.statusText||"",o.statusCode),this._running=!1):o.content?(this._logger.log(E.Trace,`(LongPolling transport) data received. ${Ye(o.content,this._options.logMessageContent)}.`),this.onreceive&&this.onreceive(o.content)):this._logger.log(E.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(r){this._running?r instanceof ln?this._logger.log(E.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this._closeError=r,this._running=!1):this._logger.log(E.Trace,`(LongPolling transport) Poll errored after shutdown: ${r.message}`)}}finally{this._logger.log(E.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this._raiseOnClose()}}async send(e){return this._running?$r(this._logger,"LongPolling",this._httpClient,this._url,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}async stop(){this._logger.log(E.Trace,"(LongPolling transport) Stopping polling."),this._running=!1,this._pollAbort.abort();try{await this._receiving,this._logger.log(E.Trace,`(LongPolling transport) sending DELETE request to ${this._url}.`);const e={},[t,r]=$e();e[t]=r;const o={headers:{...e,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials};let i;try{await this._httpClient.delete(this._url,o)}catch(s){i=s}i?i instanceof Re&&(i.statusCode===404?this._logger.log(E.Trace,"(LongPolling transport) A 404 response was returned from sending a DELETE request."):this._logger.log(E.Trace,`(LongPolling transport) Error sending a DELETE request: ${i}`)):this._logger.log(E.Trace,"(LongPolling transport) DELETE request accepted.")}finally{this._logger.log(E.Trace,"(LongPolling transport) Stop finished."),this._raiseOnClose()}}_raiseOnClose(){if(this.onclose){let e="(LongPolling transport) Firing onclose event.";this._closeError&&(e+=" Error: "+this._closeError),this._logger.log(E.Trace,e),this.onclose(this._closeError)}}}class zi{constructor(e,t,r,o){this._httpClient=e,this._accessToken=t,this._logger=r,this._options=o,this.onreceive=null,this.onclose=null}async connect(e,t){return ee.isRequired(e,"url"),ee.isRequired(t,"transferFormat"),ee.isIn(t,se,"transferFormat"),this._logger.log(E.Trace,"(SSE transport) Connecting."),this._url=e,this._accessToken&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(this._accessToken)}`),new Promise((r,o)=>{let i,s=!1;if(t===se.Text){if(Q.isBrowser||Q.isWebWorker)i=new this._options.EventSource(e,{withCredentials:this._options.withCredentials});else{const c=this._httpClient.getCookieString(e),p={};p.Cookie=c;const[m,S]=$e();p[m]=S,i=new this._options.EventSource(e,{withCredentials:this._options.withCredentials,headers:{...p,...this._options.headers}})}try{i.onmessage=c=>{if(this.onreceive)try{this._logger.log(E.Trace,`(SSE transport) data received. ${Ye(c.data,this._options.logMessageContent)}.`),this.onreceive(c.data)}catch(p){return void this._close(p)}},i.onerror=c=>{s?this._close():o(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},i.onopen=()=>{this._logger.log(E.Information,`SSE connected to ${this._url}`),this._eventSource=i,s=!0,r()}}catch(c){return void o(c)}}else o(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"))})}async send(e){return this._eventSource?$r(this._logger,"SSE",this._httpClient,this._url,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}stop(){return this._close(),Promise.resolve()}_close(e){this._eventSource&&(this._eventSource.close(),this._eventSource=void 0,this.onclose&&this.onclose(e))}}class Ui{constructor(e,t,r,o,i,s){this._logger=r,this._accessTokenFactory=t,this._logMessageContent=o,this._webSocketConstructor=i,this._httpClient=e,this.onreceive=null,this.onclose=null,this._headers=s}async connect(e,t){let r;return ee.isRequired(e,"url"),ee.isRequired(t,"transferFormat"),ee.isIn(t,se,"transferFormat"),this._logger.log(E.Trace,"(WebSockets transport) Connecting."),this._accessTokenFactory&&(r=await this._accessTokenFactory()),new Promise((o,i)=>{let s;e=e.replace(/^http/,"ws");const c=this._httpClient.getCookieString(e);let p=!1;if(Q.isNode||Q.isReactNative){const m={},[S,k]=$e();m[S]=k,r&&(m[Ae.Authorization]=`Bearer ${r}`),c&&(m[Ae.Cookie]=c),s=new this._webSocketConstructor(e,void 0,{headers:{...m,...this._headers}})}else r&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(r)}`);s||(s=new this._webSocketConstructor(e)),t===se.Binary&&(s.binaryType="arraybuffer"),s.onopen=m=>{this._logger.log(E.Information,`WebSocket connected to ${e}.`),this._webSocket=s,p=!0,o()},s.onerror=m=>{let S=null;S=typeof ErrorEvent<"u"&&m instanceof ErrorEvent?m.error:"There was an error with the transport",this._logger.log(E.Information,`(WebSockets transport) ${S}.`)},s.onmessage=m=>{if(this._logger.log(E.Trace,`(WebSockets transport) data received. ${Ye(m.data,this._logMessageContent)}.`),this.onreceive)try{this.onreceive(m.data)}catch(S){return void this._close(S)}},s.onclose=m=>{if(p)this._close(m);else{let S=null;S=typeof ErrorEvent<"u"&&m instanceof ErrorEvent?m.error:"WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",i(new Error(S))}}})}send(e){return this._webSocket&&this._webSocket.readyState===this._webSocketConstructor.OPEN?(this._logger.log(E.Trace,`(WebSockets transport) sending data. ${Ye(e,this._logMessageContent)}.`),this._webSocket.send(e),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this._webSocket&&this._close(void 0),Promise.resolve()}_close(e){this._webSocket&&(this._webSocket.onclose=()=>{},this._webSocket.onmessage=()=>{},this._webSocket.onerror=()=>{},this._webSocket.close(),this._webSocket=void 0),this._logger.log(E.Trace,"(WebSockets transport) socket closed."),this.onclose&&(!this._isCloseEvent(e)||e.wasClean!==!1&&e.code===1e3?e instanceof Error?this.onclose(e):this.onclose():this.onclose(new Error(`WebSocket closed with status code: ${e.code} (${e.reason||"no reason given"}).`)))}_isCloseEvent(e){return e&&typeof e.wasClean=="boolean"&&typeof e.code=="number"}}class qi{constructor(e,t={}){var r;if(this._stopPromiseResolver=()=>{},this.features={},this._negotiateVersion=1,ee.isRequired(e,"url"),this._logger=(r=t.logger)===void 0?new mt(E.Information):r===null?Ke.instance:r.log!==void 0?r:new mt(r),this.baseUrl=this._resolveUrl(e),(t=t||{}).logMessageContent=t.logMessageContent!==void 0&&t.logMessageContent,typeof t.withCredentials!="boolean"&&t.withCredentials!==void 0)throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");t.withCredentials=t.withCredentials===void 0||t.withCredentials,t.timeout=t.timeout===void 0?1e5:t.timeout;let o=null,i=null;if(Q.isNode&&typeof require<"u"){const s=typeof __webpack_require__=="function"?__non_webpack_require__:require;o=s("ws"),i=s("eventsource")}Q.isNode||typeof WebSocket>"u"||t.WebSocket?Q.isNode&&!t.WebSocket&&o&&(t.WebSocket=o):t.WebSocket=WebSocket,Q.isNode||typeof EventSource>"u"||t.EventSource?Q.isNode&&!t.EventSource&&i!==void 0&&(t.EventSource=i):t.EventSource=EventSource,this._httpClient=new Oi(t.httpClient||new Pi(this._logger),t.accessTokenFactory),this._connectionState="Disconnected",this._connectionStarted=!1,this._options=t,this.onreceive=null,this.onclose=null}async start(e){if(e=e||se.Binary,ee.isIn(e,se,"transferFormat"),this._logger.log(E.Debug,`Starting connection with transfer format '${se[e]}'.`),this._connectionState!=="Disconnected")return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(this._connectionState="Connecting",this._startInternalPromise=this._startInternal(e),await this._startInternalPromise,this._connectionState==="Disconnecting"){const t="Failed to start the HttpConnection before stop() was called.";return this._logger.log(E.Error,t),await this._stopPromise,Promise.reject(new ve(t))}if(this._connectionState!=="Connected"){const t="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return this._logger.log(E.Error,t),Promise.reject(new ve(t))}this._connectionStarted=!0}send(e){return this._connectionState!=="Connected"?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this._sendQueue||(this._sendQueue=new hn(this.transport)),this._sendQueue.send(e))}async stop(e){return this._connectionState==="Disconnected"?(this._logger.log(E.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnected state.`),Promise.resolve()):this._connectionState==="Disconnecting"?(this._logger.log(E.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise):(this._connectionState="Disconnecting",this._stopPromise=new Promise(t=>{this._stopPromiseResolver=t}),await this._stopInternal(e),void await this._stopPromise)}async _stopInternal(e){this._stopError=e;try{await this._startInternalPromise}catch{}if(this.transport){try{await this.transport.stop()}catch(t){this._logger.log(E.Error,`HttpConnection.transport.stop() threw error '${t}'.`),this._stopConnection()}this.transport=void 0}else this._logger.log(E.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")}async _startInternal(e){let t=this.baseUrl;this._accessTokenFactory=this._options.accessTokenFactory,this._httpClient._accessTokenFactory=this._accessTokenFactory;try{if(this._options.skipNegotiation){if(this._options.transport!==te.WebSockets)throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");this.transport=this._constructTransport(te.WebSockets),await this._startTransport(t,e)}else{let r=null,o=0;do{if(r=await this._getNegotiationResponse(t),this._connectionState==="Disconnecting"||this._connectionState==="Disconnected")throw new ve("The connection was stopped during negotiation.");if(r.error)throw new Error(r.error);if(r.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(r.url&&(t=r.url),r.accessToken){const i=r.accessToken;this._accessTokenFactory=()=>i,this._httpClient._accessToken=i,this._httpClient._accessTokenFactory=void 0}o++}while(r.url&&o<100);if(o===100&&r.url)throw new Error("Negotiate redirection limit exceeded.");await this._createTransport(t,this._options.transport,r,e)}this.transport instanceof ar&&(this.features.inherentKeepAlive=!0),this._connectionState==="Connecting"&&(this._logger.log(E.Debug,"The HttpConnection connected successfully."),this._connectionState="Connected")}catch(r){return this._logger.log(E.Error,"Failed to start the connection: "+r),this._connectionState="Disconnected",this.transport=void 0,this._stopPromiseResolver(),Promise.reject(r)}}async _getNegotiationResponse(e){const t={},[r,o]=$e();t[r]=o;const i=this._resolveNegotiateUrl(e);this._logger.log(E.Debug,`Sending negotiation request: ${i}.`);try{const s=await this._httpClient.post(i,{content:"",headers:{...t,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials});if(s.statusCode!==200)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${s.statusCode}'`));const c=JSON.parse(s.content);return(!c.negotiateVersion||c.negotiateVersion<1)&&(c.connectionToken=c.connectionId),c.useStatefulReconnect&&this._options._useStatefulReconnect!==!0?Promise.reject(new or("Client didn't negotiate Stateful Reconnect but the server did.")):c}catch(s){let c="Failed to complete negotiation with the server: "+s;return s instanceof Re&&s.statusCode===404&&(c+=" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),this._logger.log(E.Error,c),Promise.reject(new or(c))}}_createConnectUrl(e,t){return t?e+(e.indexOf("?")===-1?"?":"&")+`id=${t}`:e}async _createTransport(e,t,r,o){let i=this._createConnectUrl(e,r.connectionToken);if(this._isITransport(t))return this._logger.log(E.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=t,await this._startTransport(i,o),void(this.connectionId=r.connectionId);const s=[],c=r.availableTransports||[];let p=r;for(const m of c){const S=this._resolveTransportOrError(m,t,o,p?.useStatefulReconnect===!0);if(S instanceof Error)s.push(`${m.transport} failed:`),s.push(S);else if(this._isITransport(S)){if(this.transport=S,!p){try{p=await this._getNegotiationResponse(e)}catch(k){return Promise.reject(k)}i=this._createConnectUrl(e,p.connectionToken)}try{return await this._startTransport(i,o),void(this.connectionId=p.connectionId)}catch(k){if(this._logger.log(E.Error,`Failed to start the transport '${m.transport}': ${k}`),p=void 0,s.push(new ki(`${m.transport} failed: ${k}`,te[m.transport])),this._connectionState!=="Connecting"){const W="Failed to select transport before stop() was called.";return this._logger.log(E.Debug,W),Promise.reject(new ve(W))}}}}return s.length>0?Promise.reject(new Ii(`Unable to connect to the server with any of the available transports. ${s.join(" ")}`,s)):Promise.reject(new Error("None of the transports supported by the client are supported by the server."))}_constructTransport(e){switch(e){case te.WebSockets:if(!this._options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new Ui(this._httpClient,this._accessTokenFactory,this._logger,this._options.logMessageContent,this._options.WebSocket,this._options.headers||{});case te.ServerSentEvents:if(!this._options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new zi(this._httpClient,this._httpClient._accessToken,this._logger,this._options);case te.LongPolling:return new ar(this._httpClient,this._logger,this._options);default:throw new Error(`Unknown transport: ${e}.`)}}_startTransport(e,t){return this.transport.onreceive=this.onreceive,this.features.reconnect?this.transport.onclose=async r=>{let o=!1;if(this.features.reconnect){try{this.features.disconnected(),await this.transport.connect(e,t),await this.features.resend()}catch{o=!0}o&&this._stopConnection(r)}else this._stopConnection(r)}:this.transport.onclose=r=>this._stopConnection(r),this.transport.connect(e,t)}_resolveTransportOrError(e,t,r,o){const i=te[e.transport];if(i==null)return this._logger.log(E.Debug,`Skipping transport '${e.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${e.transport}' because it is not supported by this client.`);if(!function(s,c){return!s||!!(c&s)}(t,i))return this._logger.log(E.Debug,`Skipping transport '${te[i]}' because it was disabled by the client.`),new Ei(`'${te[i]}' is disabled by the client.`,i);{if(!(e.transferFormats.map(s=>se[s]).indexOf(r)>=0))return this._logger.log(E.Debug,`Skipping transport '${te[i]}' because it does not support the requested transfer format '${se[r]}'.`),new Error(`'${te[i]}' does not support ${se[r]}.`);if(i===te.WebSockets&&!this._options.WebSocket||i===te.ServerSentEvents&&!this._options.EventSource)return this._logger.log(E.Debug,`Skipping transport '${te[i]}' because it is not supported in your environment.'`),new Ci(`'${te[i]}' is not supported in your environment.`,i);this._logger.log(E.Debug,`Selecting transport '${te[i]}'.`);try{return this.features.reconnect=i===te.WebSockets?o:void 0,this._constructTransport(i)}catch(s){return s}}}_isITransport(e){return e&&typeof e=="object"&&"connect"in e}_stopConnection(e){if(this._logger.log(E.Debug,`HttpConnection.stopConnection(${e}) called while in state ${this._connectionState}.`),this.transport=void 0,e=this._stopError||e,this._stopError=void 0,this._connectionState!=="Disconnected"){if(this._connectionState==="Connecting")throw this._logger.log(E.Warning,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${e}) was called while the connection is still in the connecting state.`);if(this._connectionState==="Disconnecting"&&this._stopPromiseResolver(),e?this._logger.log(E.Error,`Connection disconnected with error '${e}'.`):this._logger.log(E.Information,"Connection disconnected."),this._sendQueue&&(this._sendQueue.stop().catch(t=>{this._logger.log(E.Error,`TransportSendQueue.stop() threw error '${t}'.`)}),this._sendQueue=void 0),this.connectionId=void 0,this._connectionState="Disconnected",this._connectionStarted){this._connectionStarted=!1;try{this.onclose&&this.onclose(e)}catch(t){this._logger.log(E.Error,`HttpConnection.onclose(${e}) threw error '${t}'.`)}}}else this._logger.log(E.Debug,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is already in the disconnected state.`)}_resolveUrl(e){if(e.lastIndexOf("https://",0)===0||e.lastIndexOf("http://",0)===0)return e;if(!Q.isBrowser)throw new Error(`Cannot resolve '${e}'.`);const t=window.document.createElement("a");return t.href=e,this._logger.log(E.Information,`Normalizing '${e}' to '${t.href}'.`),t.href}_resolveNegotiateUrl(e){const t=new URL(e);t.pathname.endsWith("/")?t.pathname+="negotiate":t.pathname+="/negotiate";const r=new URLSearchParams(t.searchParams);return r.has("negotiateVersion")||r.append("negotiateVersion",this._negotiateVersion.toString()),r.has("useStatefulReconnect")?r.get("useStatefulReconnect")==="true"&&(this._options._useStatefulReconnect=!0):this._options._useStatefulReconnect===!0&&r.append("useStatefulReconnect","true"),t.search=r.toString(),t.toString()}}class hn{constructor(e){this._transport=e,this._buffer=[],this._executing=!0,this._sendBufferedData=new et,this._transportResult=new et,this._sendLoopPromise=this._sendLoop()}send(e){return this._bufferData(e),this._transportResult||(this._transportResult=new et),this._transportResult.promise}stop(){return this._executing=!1,this._sendBufferedData.resolve(),this._sendLoopPromise}_bufferData(e){if(this._buffer.length&&typeof this._buffer[0]!=typeof e)throw new Error(`Expected data to be of type ${typeof this._buffer} but was of type ${typeof e}`);this._buffer.push(e),this._sendBufferedData.resolve()}async _sendLoop(){for(;;){if(await this._sendBufferedData.promise,!this._executing){this._transportResult&&this._transportResult.reject("Connection stopped.");break}this._sendBufferedData=new et;const e=this._transportResult;this._transportResult=void 0;const t=typeof this._buffer[0]=="string"?this._buffer.join(""):hn._concatBuffers(this._buffer);this._buffer.length=0;try{await this._transport.send(t),e.resolve()}catch(r){e.reject(r)}}}static _concatBuffers(e){const t=e.map(i=>i.byteLength).reduce((i,s)=>i+s),r=new Uint8Array(t);let o=0;for(const i of e)r.set(new Uint8Array(i),o),o+=i.byteLength;return r.buffer}}class et{constructor(){this.promise=new Promise((e,t)=>[this._resolver,this._rejecter]=[e,t])}resolve(){this._resolver()}reject(e){this._rejecter(e)}}class Fi{constructor(){this.name="json",this.version=2,this.transferFormat=se.Text}parseMessages(e,t){if(typeof e!="string")throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!e)return[];t===null&&(t=Ke.instance);const r=pe.parse(e),o=[];for(const i of r){const s=JSON.parse(i);if(typeof s.type!="number")throw new Error("Invalid payload.");switch(s.type){case z.Invocation:this._isInvocationMessage(s);break;case z.StreamItem:this._isStreamItemMessage(s);break;case z.Completion:this._isCompletionMessage(s);break;case z.Ping:case z.Close:break;case z.Ack:this._isAckMessage(s);break;case z.Sequence:this._isSequenceMessage(s);break;default:t.log(E.Information,"Unknown message type '"+s.type+"' ignored.");continue}o.push(s)}return o}writeMessage(e){return pe.write(JSON.stringify(e))}_isInvocationMessage(e){this._assertNotEmptyString(e.target,"Invalid payload for Invocation message."),e.invocationId!==void 0&&this._assertNotEmptyString(e.invocationId,"Invalid payload for Invocation message.")}_isStreamItemMessage(e){if(this._assertNotEmptyString(e.invocationId,"Invalid payload for StreamItem message."),e.item===void 0)throw new Error("Invalid payload for StreamItem message.")}_isCompletionMessage(e){if(e.result&&e.error)throw new Error("Invalid payload for Completion message.");!e.result&&e.error&&this._assertNotEmptyString(e.error,"Invalid payload for Completion message."),this._assertNotEmptyString(e.invocationId,"Invalid payload for Completion message.")}_isAckMessage(e){if(typeof e.sequenceId!="number")throw new Error("Invalid SequenceId for Ack message.")}_isSequenceMessage(e){if(typeof e.sequenceId!="number")throw new Error("Invalid SequenceId for Sequence message.")}_assertNotEmptyString(e,t){if(typeof e!="string"||e==="")throw new Error(t)}}const Xi={trace:E.Trace,debug:E.Debug,info:E.Information,information:E.Information,warn:E.Warning,warning:E.Warning,error:E.Error,critical:E.Critical,none:E.None};class Vi{configureLogging(e){if(ee.isRequired(e,"logging"),e.log!==void 0)this.logger=e;else if(typeof e=="string"){const t=function(r){const o=Xi[r.toLowerCase()];if(o!==void 0)return o;throw new Error(`Unknown log level: ${r}`)}(e);this.logger=new mt(t)}else this.logger=new mt(e);return this}withUrl(e,t){return ee.isRequired(e,"url"),ee.isNotEmpty(e,"url"),this.url=e,this.httpConnectionOptions=typeof t=="object"?{...this.httpConnectionOptions,...t}:{...this.httpConnectionOptions,transport:t},this}withHubProtocol(e){return ee.isRequired(e,"protocol"),this.protocol=e,this}withAutomaticReconnect(e){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return e?Array.isArray(e)?this.reconnectPolicy=new sr(e):this.reconnectPolicy=e:this.reconnectPolicy=new sr,this}withServerTimeout(e){return ee.isRequired(e,"milliseconds"),this._serverTimeoutInMilliseconds=e,this}withKeepAliveInterval(e){return ee.isRequired(e,"milliseconds"),this._keepAliveIntervalInMilliseconds=e,this}withStatefulReconnect(e){return this.httpConnectionOptions===void 0&&(this.httpConnectionOptions={}),this.httpConnectionOptions._useStatefulReconnect=!0,this._statefulReconnectBufferSize=e?.bufferSize,this}build(){const e=this.httpConnectionOptions||{};if(e.logger===void 0&&(e.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");const t=new qi(this.url,e);return un.create(t,this.logger||Ke.instance,this.protocol||new Fi,this.reconnectPolicy,this._serverTimeoutInMilliseconds,this._keepAliveIntervalInMilliseconds,this._statefulReconnectBufferSize)}}function Rs(n){const e=new Vi().configureLogging(E.Information).withUrl(n).withAutomaticReconnect({nextRetryDelayInMilliseconds:()=>5e3}).build();return e.keepAliveIntervalInMilliseconds=15e3,e.serverTimeoutInMilliseconds=18e5,e.start().then(()=>{$.Logger().info("启动SignalR连接！")}),e.onclose(async()=>{$.Logger().info("断开SignalR连接!")}),e.onreconnecting(()=>{$.Logger().warn("SignalR服务已断线，重连中...！")}),e.onreconnected(()=>{$.Logger().warn("SignalR重连成功!")}),e}const tn=new Set;function cr(n){return n!==null?parseFloat(n):0}function tt(n){const e=window.getComputedStyle(n),t=Math.ceil([e.paddingLeft,e.width,e.paddingRight].map(cr).reduce((o,i)=>o+i)),r=Math.ceil([e.paddingTop,e.height,e.paddingBottom].map(cr).reduce((o,i)=>o+i));return{width:t,height:r}}class Ki{width;height;constructor(e,t){this.width=e,this.height=t}}function Yi(n){const e=n.windowEl;if(e){const t=parseFloat(e.style.left||"NaN"),r=parseFloat(e.style.top||"NaN");if(!isNaN(t)&&!isNaN(r))return{left:t,top:r}}return null}function Ji(n,e,t,r){const o=n-t,i=e-r;return o*o+i*i}window.addEventListener("resize",n=>{tn.forEach(e=>{e&&ii(e.fixPosition)&&e.fixPosition()})});const nt=[];var lr=Me({name:"VWindow",props:{windowStyle:{type:Object,required:!0},isOpen:{type:Boolean,required:!1,default:!0},title:{type:String,required:!0,default:""},closeButton:{type:Boolean,required:!1,default:!0},resizable:{type:Boolean,required:!1,default:!1},isScrollable:{type:Boolean,required:!1,default:!1},padding:{type:Number,required:!1,default:8},activateWhenOpen:{type:Boolean,required:!1,default:!0},positionHint:{type:String,required:!1,default:""},zGroup:{type:Number,required:!1,default:1},overflow:{type:String,required:!1,default:"visible"},minWidth:{type:Number,required:!1,default:1},minHeight:{type:Number,required:!1,default:0},maxWidth:{type:Number,required:!1,default:0},maxHeight:{type:Number,required:!1,default:0},height:{type:Number,required:!1},width:{type:Number,required:!1},top:{type:Number,required:!1},left:{type:Number,required:!1}},components:{myButton:lt},setup(n,{emit:e}){const t=Yo();if(!t)return;const{proxy:r}=t;let o=0,i,s,c;const p=Y(n.isOpen),m=()=>{nt.push(r),c=new ei(n.zGroup,S),n.isOpen&&function(D){_r(()=>{o++==0&&(g(r),function(){const T=k.value,{width:M,height:O}=Gt(T);let H,A;if(n.left!==void 0!=(n.top!==void 0))throw new Error("Either of left or top is specified. Both must be set or not set.");if(typeof n.left=="number")H=n.left,A=n.top;else{const U=n.positionHint||"auto";switch(U){case"auto":{let F=20,ae=50,re=0;do{if(nt.every(ye=>{if(!ye.isOpen||r==ye)return!0;const Je=Yi(ye);if(Je==null)return!0;const{left:Ct,top:ge}=Je;return Ji(Ct,ge,F,ae)>16}))break;F=(F+40)%(window.innerWidth-200),ae=(ae+40)%(window.innerHeight-200)}while(++re<100);H=F,A=ae}break;case"center":H=(window.innerWidth-M)/2,A=(window.innerHeight-O)/2;break;default:try{const F=U.split("/").map(Number);if(F.length!=2)throw null;const[ae,re]=F;if(!isFinite(ae)||!isFinite(re))throw null;H=ae>=0?ae:window.innerWidth-M+ae,A=re>=0?re:window.innerHeight-O+re}catch{throw new Error(`invalid position string: ${U}`)}}}T&&(T.style.left=`${H}px`,T.style.top=`${A}px`)}()),n.resizable&&f(),P(),i=new Zo(W.value,k.value,{onMove:()=>P(),onMoveStart:()=>e("move-start"),onMoveEnd:()=>e("move-end")}),n.resizable&&function(){const{height:T}=Gt(W.value);s=new ni(k.value,{onResize:()=>f(),onResizeStart:()=>e("resize-start"),onResizeEnd:()=>e("resize-end"),minWidth:n.minWidth,minHeight:n.minHeight+T,maxWidth:n.maxWidth,maxHeight:n.maxHeight?n.maxHeight+T:void 0})}()}),n.activateWhenOpen&&L()}(),tn.add(r)};function S(D){d.value.zIndex=`${D}`}const k=Y(null),W=Y(null),N=Y(null);function L(){c.raise(),e("activate")}const d=Y({...n.windowStyle.window,zIndex:"auto",overflow:n.overflow}),l=Ne(()=>n.windowStyle.titlebar),v=Ne(()=>{const D={...n.windowStyle.content};return n.resizable?D.padding="0":n.padding!=null&&(D.padding=`${n.padding}px`),n.isScrollable&&(D.overflow="auto"),D});function g(D){const{width:T,height:M,top:O,left:H}=D,A=k;if(A&&T!=null&&(A.value.style.width=`${T}px`),M!=null){const U=W.value;if(U){const F=tt(U).height;A.value.style.height=`${M+F}px`}}A&&H!=null&&(A.value.style.left=`${H}px`),A&&O!=null&&(A.value.style.top=`${O}px`)}function f(D=!0){const T=k.value,M=W.value,O=N.value;if(O&&T&&M){const{width:H,height:A}=tt(O),{width:U,height:F}=tt(T),ae=tt(M).height,re=U-(O.offsetWidth-H),ye=F-ae-(O.offsetHeight-A);O.style.width=`${re}px`,O.style.height=`${ye}px`,y(),e("resize",new Ki(re,ye)),D&&(e("update:width",re),e("update:height",ye))}}function y(){const D=k.value;if(D){const T=D.getBoundingClientRect();T.left<0&&(d.value.left="0px"),T.top<0&&(d.value.top="0px"),T.right>window.innerWidth&&(d.value.left=window.innerWidth-T.width+"px"),T.bottom>window.innerHeight&&(d.value.top=window.innerHeight-T.height+"px")}}function P(D=!0){y();const T=k.value;if(T){const{left:M,top:O}=T.getBoundingClientRect();D&&(e("update:left",M),e("update:top",O))}}return xe(()=>n.isOpen,D=>{p.value=D}),xe(()=>n.zGroup,D=>{c.group=D}),xe(()=>n.width,D=>{g({width:D}),f(!1)}),xe(()=>n.height,D=>{g({height:D}),f(!1)}),sn(()=>{m()}),Vo(()=>{tn.delete(this),c.unregister(),s&&s.teardown(),i&&i.teardown(),nt.splice(nt.indexOf(r),1)}),{isOpen:p,windowEl:k,titlebar:W,content:N,activate:L,styleWindow:d,styleTitlebar:l,styleContent:v,closeButtonClick:function(){p.value=!1,e("closebuttonclick")},fixPosition:y}}});const Gi={class:"title"};var ur;lr.render=function(n,e,t,r,o,i){const s=yt("myButton");return X(),Z(mr,{name:"fade",onAfterLeave:e[2]||(e[2]=c=>n.$emit("close")),onAfterEnter:e[3]||(e[3]=c=>n.$emit("open")),persisted:""},{default:_e(()=>[vr(G("div",{class:"window",style:me(n.styleWindow),ref:"windowEl",onMousedown:e[0]||(e[0]=(...c)=>n.activate&&n.activate(...c)),onTouchstart:e[1]||(e[1]=(...c)=>n.activate&&n.activate(...c))},[G("div",{class:"titlebar",style:me(n.styleTitlebar),ref:"titlebar"},[G("div",Gi,[n.$slots.title?ie(n.$slots,"title",{key:0}):(X(),fe(ke,{key:1},[Jt(on(n.title),1)],64))]),n.closeButton?(X(),Z(s,{key:0,windowStyle:n.windowStyle,onClick:n.closeButtonClick},{default:_e(()=>e[4]||(e[4]=[Jt("×")])),_:1},8,["windowStyle","onClick"])):ne("v-if",!0)],4),G("div",{class:"content",style:me(n.styleContent),ref:"content"},[ie(n.$slots,"default")],4)],36),[[yr,n.isOpen]])]),_:3})},lr.__file="src/controls/vuewindow/window/index.vue",function(n){n[n.StyleBlack=0]="StyleBlack",n[n.StyleWhite=1]="StyleWhite",n[n.StyleMetal=2]="StyleMetal",n[n.StyleGrayblue=3]="StyleGrayblue"}(ur||(ur={}));var le;(function(n){n[n.top=0]="top",n[n.bottom=1]="bottom",n[n.centerBack=2]="centerBack",n[n.centerMain=3]="centerMain",n[n.centerFront=4]="centerFront",n[n.left=5]="left",n[n.right=6]="right"})(le||(le={}));class Qi{layoutState;layoutMap=new Map;preConditionMap=new Map;widgetsLoadedSet=new Set;widgetConfig=new Array;_LayoutID;_mapItemRefs;constructor(e,t,r,o){this.layoutState=e,this._LayoutID=r,this._mapItemRefs=o,t.forEach(i=>{if(i.layoutID===r&&(this.widgetConfig.push(i),i.afterid))if(this.preConditionMap.has(i.afterid))this.preConditionMap.get(i.afterid)?.add(i);else{const s=new Set;s.add(i),this.preConditionMap.set(i.afterid,s)}})}getLayoutID(){return this._LayoutID}getWidgetConfig(){return this.widgetConfig}preloadWidgets(){this.widgetConfig.filter(e=>e.preload&&!e.afterid).forEach(e=>{this._loadWidget(e)})}async loadWidget(e){if(!e)return;let t;if(cn(e)?t=e:Cr(e)&&(t=this.widgetConfig.find(r=>r.id===e)),t){if(t.afterid){if(this.isWidgetLoaded(t.afterid))return this._loadWidget(t);{let r=function(c){c.layoutID===o._LayoutID&&c.widgetID===i&&(o._loadWidget(s),$.EventBus.off(ue.WidgetLoadedEvent,r))};const o=this,i=t.afterid,s=t;return $.EventBus.on(ue.WidgetLoadedEvent,r),this.loadWidget(t.afterid)}}return this._loadWidget(t)}}loadOtherDependenceWidgets(e){this.preConditionMap.has(e)&&this.preConditionMap.get(e)?.forEach(t=>{t.preload&&this._loadWidget(t)})}_loadWidget(e){if(!this.widgetsLoadedSet.has(e.id))return e.component?e.component().then(t=>{if(t.default){const r=Ko(t.default);e.layout&&(r.style=e.layout),e.cssClass&&(r.cssClass=e.cssClass),this.getContainerComponents(e.container).value.set(e.id,r),this.widgetsLoadedSet.add(e.id),_r().then(()=>{$.EventBus.emit(ue.WidgetLoadedEvent,{layoutID:this._LayoutID,widgetID:e.id}),this.loadOtherDependenceWidgets(e.id)})}}).catch(t=>{$.Logger().error("加载Widget失败！",e),$.EventBus.emit(ue.WidgetLoadedErrorEvent,e)}):void 0;this.changeWidgetVisible(e.id,!0)}hasDependentWidgets(e){let t=!1;if(this.preConditionMap.has(e)){const r=this.preConditionMap.get(e);if(r){for(const o of r)if(this.isWidgetLoaded(o.id)){t=!0;break}}}return t}unloadWidget(e){if(!e||!this.isWidgetLoaded(e))return;const t=this.widgetConfig.find(r=>r.id===e);if(t){if(this.preConditionMap.has(e)){const r=this.preConditionMap.get(e);if(r)for(const o of r)this.unloadWidget(o.id)}this.getContainerComponents(t.container).value.delete(e),this.widgetsLoadedSet.delete(e),this._mapItemRefs&&this._mapItemRefs.delete(e),$.EventBus.emit(ue.WidgetUnLoadedEvent,{layoutID:this._LayoutID,widgetID:e})}}isWidgetLoaded(e){return this.widgetsLoadedSet.has(e)}splitTwoContainer(e=!1){const t=this.layoutState.centerMainContainer,r=this.layoutState.centerBackContainer;e?(t&&(t.style.left="0",t.style.width="100%"),r&&(r.style.width="100%")):(t&&(t.style.left="50%",t.style.width="50%"),r&&(r.style.width="50%"))}getLayoutContainer(e){switch(e){case le.top:return this.layoutState.topContainer;case le.bottom:return this.layoutState.bottomContainer;case le.left:return this.layoutState.leftContainer;case le.right:return this.layoutState.rightContainer;case le.centerBack:return this.layoutState.centerBackContainer;case le.centerMain:return this.layoutState.centerMainContainer;case le.centerFront:return this.layoutState.centerFrontContainer}}changeContainerVisible(e,t=!1){const r=this.getLayoutContainer(e);r&&(r.style.visibility=t?"visible":"hidden")}changeWidgetVisible(e,t=!1){const r=this.getWidgetComponent(e);r&&r.changeVisible&&r.changeVisible(t)}isWidgetVisible(e){const t=this.getWidgetComponent(e);return!!t&&(!t.isShow||t.isShow.value)}getWidgetComponent(e){if(this.widgetsLoadedSet.has(e)&&this._mapItemRefs)return this._mapItemRefs.get(e)}getWigetItem(e){return this.widgetConfig.find(t=>t.id===e)}getGroupWigetItems(e){return this.widgetConfig.filter(t=>t.group===e)}getContainerComponents(e){if(this.layoutMap.has(e))return this.layoutMap.get(e);{const t=Y(new Map);return this.layoutMap.set(e,t),t}}getWidgetLoadedIDList(){const e=[];return this.widgetsLoadedSet.forEach(t=>{e.push(t)}),e}unloadAllWidgets(e){const t=[];this.widgetsLoadedSet.forEach(r=>{e&&e.length>0?e.findIndex(o=>o===r)<0&&t.push(r):t.push(r)}),t.forEach(r=>this.unloadWidget(r))}unloadWidgets(e){e&&e.length>0&&e.forEach(t=>{this.unloadWidget(t)})}static getLayoutManager(e,t){if(t){const r=t.find(o=>o.id===e);if(r&&r.layoutID)return $.LayoutMap.get(r.layoutID)}}}var vt=Me({name:"SuspenseWithError",setup(){const n=Y(null);return Uo(e=>(n.value="当前页面存在问题，无法渲染……",!0)),{error:n}}});vt.render=function(n,e,t,r,o,i){return n.error?ie(n.$slots,"error",{key:0},()=>[Jt(on(n.error),1)]):(X(),Z(zo,{key:1},{default:_e(()=>[ie(n.$slots,"default")]),fallback:_e(()=>[ie(n.$slots,"fallback")]),_:3}))},vt.__file="src/controls/routertransition/SuspenseWithError.vue";var jr=Me({name:"RouterTransition",__name:"RouterTransition",setup:n=>(e,t)=>{const r=yt("router-view");return X(),Z(vt,null,{default:_e(()=>[ht(r,null,{default:_e(({Component:o,route:i})=>[ne(" <transition> "),(X(),Z(wr,null,[i.meta.keepAlive?(X(),Z(we(o),{key:i.name})):ne("v-if",!0)],1024)),i.meta.keepAlive?ne("v-if",!0):(X(),Z(we(o),{key:i.name})),ne(" </transition> ")]),_:1})]),_:1})}});jr.__file="src/controls/routertransition/RouterTransition.vue";var Vt=Me({name:"LayoutContainer",props:{widgetConfig:{type:Array,required:!0,default:()=>[]},layoutID:{type:String,default:void 0},layoutStyle:{type:Object},enableRouterView:{type:Boolean,default:!0}},emits:["containerLoaded"],components:{RouterTransition:jr},setup(n,{attrs:e,slots:t,emit:r}){const o=n.layoutID,i=Y(n.enableRouterView);xe(()=>n.enableRouterView,()=>{i.value=n.enableRouterView});const s=gr({topContainer:void 0,centerBackContainer:void 0,centerMainContainer:void 0,centerFrontContainer:void 0,bottomContainer:void 0,leftContainer:void 0,rightContainer:void 0}),c=new Map,p=new Qi(s,n.widgetConfig,o,c),m=d(le.top),S=d(le.centerBack),k=d(le.centerFront),W=d(le.left),N=d(le.right),L=d(le.bottom);function d(v){return p?.getContainerComponents(v)}const l=Ne(()=>n.layoutStyle);return sn(()=>{p&&(o?$.LayoutMap.set(o,p):($.LayoutManager=p,$.LayoutMap.set("",p)),p.preloadWidgets(),r("containerLoaded",{layoutID:o,layoutManager:p}),$.EventBus.emit(ue.LayoutContainerLoaded,{layoutID:o,layoutManager:p}))}),{...qo(s),topContainerComponents:m,centerbackComponents:S,centerfrontComponents:k,leftContainerComponents:W,rightContainerComponents:N,bottomContainerComponents:L,containerStyle:l,isEnableRouterView:i,setItemRef:(v,g)=>{v&&c.set(g,v)}}}});const Zi={ref:"topContainer",class:"topContainer"},es={key:0,ref:"centerMainContainer",class:"centerdiv mainContainer"},ts={ref:"centerBackContainer",class:"centerdiv backContainer"},ns={ref:"centerFrontContainer",class:"centerdiv centerFrontContainer"},rs={ref:"leftContainer",class:"leftContainer"},os={ref:"rightContainer",class:"rightContainer"},is={ref:"bottomContainer",class:"bottomContainer"};Vt.render=function(n,e,t,r,o,i){const s=yt("router-transition");return X(),fe("div",{class:"layoutContainer",style:me(n.containerStyle)},[G("div",Zi,[ie(n.$slots,"top"),(X(!0),fe(ke,null,Pe(n.topContainerComponents,([c,p])=>(X(),Z(we(p),{ref_for:!0,ref:m=>n.setItemRef(m,c),key:c,style:me(p.style),class:Ie(p.cssClass)},null,8,["style","class"]))),128))],512),G("div",null,[ne(" 主要容器-底部 "),n.isEnableRouterView?(X(),fe("div",es,[ie(n.$slots,"main",{},()=>[ht(s)])],512)):ne("v-if",!0),ne(" 上一层-主容器 "),G("div",ts,[ie(n.$slots,"back"),(X(!0),fe(ke,null,Pe(n.centerbackComponents,([c,p])=>(X(),Z(we(p),{ref_for:!0,ref:m=>n.setItemRef(m,c),key:c,style:me(p.style),class:Ie(p.cssClass)},null,8,["style","class"]))),128))],512),ne(" 最上浮动-主容器 "),G("div",ns,[ie(n.$slots,"front"),(X(!0),fe(ke,null,Pe(n.centerfrontComponents,([c,p])=>(X(),Z(we(p),{ref_for:!0,ref:m=>n.setItemRef(m,c),key:c,style:me(p.style),class:Ie(p.cssClass)},null,8,["style","class"]))),128))],512),G("div",rs,[ie(n.$slots,"left"),(X(!0),fe(ke,null,Pe(n.leftContainerComponents,([c,p])=>(X(),Z(we(p),{ref_for:!0,ref:m=>n.setItemRef(m,c),key:c,style:me(p.style),class:Ie(p.cssClass)},null,8,["style","class"]))),128))],512),G("div",os,[ie(n.$slots,"right"),(X(!0),fe(ke,null,Pe(n.rightContainerComponents,([c,p])=>(X(),Z(we(p),{ref_for:!0,ref:m=>n.setItemRef(m,c),key:c,style:me(p.style),class:Ie(p.cssClass)},null,8,["style","class"]))),128))],512)]),G("div",is,[ie(n.$slots,"bottom"),(X(!0),fe(ke,null,Pe(n.bottomContainerComponents,([c,p])=>(X(),Z(we(p),{ref_for:!0,ref:m=>n.setItemRef(m,c),key:c,style:me(p.style),class:Ie(p.cssClass)},null,8,["style","class"]))),128))],512),ne(" 增加默认插槽 "),ie(n.$slots,"default")],4)},Vt.__scopeId="data-v-4d081e5c",Vt.__file="src/controls/layoutcontainer/layout.vue";var ss=Me({name:"RouterTransition",__name:"RouterTransitionAnimate",props:{enterActive:{type:String,required:!1,default:"animated fadeIn"},leaveActive:{type:String,required:!1,default:"animated fadeOut"}},setup:n=>(e,t)=>{const r=yt("router-view");return X(),Z(vt,null,{default:_e(()=>[ht(r,null,{default:_e(({Component:o,route:i})=>[ht(Fo,{appear:"","enter-active-class":e.enterActive,"leave-active-class":e.leaveActive},{default:_e(()=>[(X(),Z(wr,null,[i.meta.keepAlive?(X(),Z(we(o),{key:i.name})):ne("v-if",!0)],1024)),i.meta.keepAlive?ne("v-if",!0):(X(),Z(we(o),{key:i.name}))]),_:2},1032,["enter-active-class","leave-active-class"])]),_:1})]),_:1})}});ss.__file="src/controls/routertransition/RouterTransitionAnimate.vue";const ze=new Map,ut=Y(new Map);class rt{static addWindowPanel(e){ze.set(e.id,e)}static removeWindowPanel(e){ze.has(e)&&(ze.delete(e),ut.value.delete(e))}static minimizeWindowPanel(e){ze.has(e)&&ut.value.set(e,-1)}static openWindowPanel(e){ze.has(e)&&ut.value.set(e,1)}}const as=["src"],cs={key:1,class:"paneltitle"},ls={class:"dragPanelBar"},us={class:"dragPanelContent"},hs={class:"drag-pointer-group"};var hr=Me({__name:"XWindow",props:{top:{type:[String,Number],default:0},left:{type:[String,Number],default:0},nWidth:{type:[String,Number],default:"300px"},nHeight:{type:[String,Number],default:"400px"},icon:{type:String,default:"img/logo.png"},title:{type:String,default:""},titleHeight:{type:[String,Number],default:"40px"},hasMin:{type:Boolean,default:!0},hasMax:{type:Boolean,default:!1},hasClose:{type:Boolean,default:!0},isDark:{type:Boolean,default:!1},pid:{type:String,default:""},tag:{type:[String,Array,Object,Number],default:""}},emits:["close","open","loaded","minimize"],setup(n,{expose:e,emit:t}){const r=ai(),o=n,i=t,s=Y(),c=Y(),p=Ne(()=>o.isDark),m=Y({x:0,y:0}),S=250,k=100,W=Y({width:0,height:0}),N=A=>{s.value&&(s.value.style.left=`${A.x}px`,s.value.style.top=`${A.y}px`)};xe(()=>m.value,A=>{N(A)});const L=A=>{s.value&&(s.value.style.width=`${A.width}px`,s.value.style.height=`${A.height}px`)};xe(()=>W.value,A=>{L(A)});const d={eventListenerController:null,startingEdges:null,newEdges:null,clickStart:null,mount:()=>{Object.entries(d.refs).forEach(([A,U])=>{U.value&&U.value.addEventListener("mousedown",F=>{d.mouseDown(F,A)})})},mouseDown:(A,U)=>{A.button==0&&(A.preventDefault(),d.startingEdges={left:m.value.x,top:m.value.y,right:m.value.x+W.value.width,bottom:m.value.y+W.value.height},d.newEdges={...d.startingEdges},d.clickStart={x:A.clientX,y:A.clientY},d.eventListenerController=new AbortController,document.addEventListener("mousemove",F=>{d.mouseMove(F,U)},{signal:d.eventListenerController.signal}),document.addEventListener("mouseup",F=>{d.mouseUp(F,U)},{signal:d.eventListenerController.signal}))},mouseMove:(A,U)=>{if(d.startingEdges!=null&&d.newEdges!=null&&d.clickStart!=null&&d.refs[U].value){if(A.preventDefault(),U.toLowerCase().includes("north")){d.newEdges.top=Math.max(d.startingEdges.top+A.clientY-d.clickStart.y,0);const F=d.newEdges.bottom-d.newEdges.top-k;F<0&&(d.newEdges.top+=F)}else U.toLowerCase().includes("south")&&(d.newEdges.bottom=Math.min(d.startingEdges.bottom+A.clientY-d.clickStart.y,document.body.clientHeight));if(U.toLowerCase().includes("west")){d.newEdges.left=Math.max(d.startingEdges.left+A.clientX-d.clickStart.x,0);const F=d.newEdges.right-d.newEdges.left-S;F<0&&(d.newEdges.left+=F)}else U.toLowerCase().includes("east")&&(d.newEdges.right=Math.min(d.startingEdges.right+A.clientX-d.clickStart.x,document.body.clientWidth));d.update()}},update:()=>{d.newEdges==null||d.startingEdges==null||(m.value={x:Math.max(d.newEdges.left,0),y:Math.max(d.newEdges.top,0)},W.value={width:Math.min(Math.max(d.newEdges.right-d.newEdges.left,S),document.body.clientWidth),height:Math.min(Math.max(d.newEdges.bottom-d.newEdges.top,k),document.body.clientHeight)})},mouseUp:(A,U)=>{A.button!=0||d.startingEdges==null||(A.preventDefault(),d.startingEdges=null,d.newEdges=null,d.clickStart=null,d.eventListenerController&&(d.eventListenerController.abort(),d.eventListenerController=null))},refs:{northWest:Y(null),north:Y(null),northEast:Y(null),west:Y(null),east:Y(null),southWest:Y(null),south:Y(null),southEast:Y(null)}},l={startingMouse:null,startingPosition:null,mouseDown:A=>{A.button==0&&(A.preventDefault(),l.startingMouse={x:A.clientX,y:A.clientY},l.startingPosition=m.value,document.addEventListener("mousemove",l.mouseMove),document.addEventListener("mouseup",l.mouseUp))},mouseMove:A=>{!l.startingMouse||!l.startingPosition||(A.preventDefault(),m.value={x:Math.min(Math.max(l.startingPosition.x+A.clientX-l.startingMouse.x,0),document.body.clientWidth-W.value.width),y:Math.min(Math.max(l.startingPosition.y+A.clientY-l.startingMouse.y,0),document.body.clientHeight-W.value.height)})},mouseUp:A=>{A.button!=0||!l.startingMouse||!l.startingPosition||(A.preventDefault(),l.startingMouse=null,l.startingPosition=null,document.removeEventListener("mousemove",l.mouseMove),document.removeEventListener("mouseup",l.mouseUp))}};function v(A){return{id:r,icon:o.icon,title:o.title,pid:o.pid,data:A??o.tag}}const g=Ne(()=>ut.value.get(r)!==-1),f=Y(!1),y=Y(!0);function P(){i("minimize",v()),rt.minimizeWindowPanel(r)}function D(){f.value=!f.value}function T(){i("close",v(!1)),rt.removeWindowPanel(r),y.value=!1}const M=Ne(()=>f.value?"heroicons-outline:square-2-stack":"ant-design:border-outlined"),O={id:r,isShow:g,close:T,open:function(){i("open",v(!0)),y.value=!0},showHidePanel:P};function H(A){if(Wn(A))return A;{const U=Number(A);if(U==U)return U;if(A.endsWith("px")){const F=A.substring(0,A.length-2);return Number(F)}if(A.endsWith("%")){const F=A.substring(0,A.length-1);return Number(F)/100*document.body.clientWidth}return 300}}return e(O),sn(()=>{(function(){let A=90;if(o.hasMin||(A-=30),o.hasMax||(A-=30),o.hasClose||(A-=30),he.setCssVar("--right-bar-width",A+"px",c.value),!c.value)return;const U=Wn(o.titleHeight)?o.titleHeight+"px":o.titleHeight;c.value.style.height=U,c.value.style.lineHeight=U})(),function(){const A=v(O);rt.addWindowPanel(A),i("loaded",A)}(),m.value.x=H(o.left),m.value.y=H(o.top),N(m.value),W.value={width:H(o.nWidth),height:H(o.nHeight)},L(W.value),d.mount()}),Xo(()=>{rt.removeWindowPanel(r)}),(A,U)=>(X(),Z(mr,{appear:"","enter-active-class":"animated zoomIn","leave-active-class":"animated zoomOut"},{default:_e(()=>[y.value?vr((X(),fe("div",{key:0,ref_key:"dragPanelRef",ref:s,class:Ie(["dragWindowPanel",{maxPanel:f.value,dragWindowPanel_dark:p.value}])},[G("div",{class:"dragPanelTitle",ref_key:"dragPanelTitleRef",ref:c,onMousedown:U[0]||(U[0]=(...F)=>l.mouseDown&&l.mouseDown(...F))},[ie(A.$slots,"title",{},()=>[o.icon?(X(),fe("img",{key:0,src:o.icon,width:"24",height:"24"},null,8,as)):ne("v-if",!0),o.title?(X(),fe("span",cs,on(o.title),1)):ne("v-if",!0)]),G("div",ls,[n.hasMin?(X(),Z(Dt(Pt),{key:0,icon:"ant-design:minus-outlined",onClick:P})):ne("v-if",!0),n.hasMax?(X(),Z(Dt(Pt),{key:1,icon:M.value,onClick:D},null,8,["icon"])):ne("v-if",!0),n.hasClose?(X(),Z(Dt(Pt),{key:2,icon:"ant-design:close-outlined",onClick:T})):ne("v-if",!0)])],544),G("div",us,[ie(A.$slots,"default")]),G("div",hs,[G("div",{class:"cursor-nw-resize",ref:d.refs.northWest},null,512),G("div",{class:"cursor-n-resize",ref:d.refs.north},null,512),G("div",{class:"cursor-ne-resize",ref:d.refs.northEast},null,512),G("div",{class:"cursor-w-resize",ref:d.refs.west},null,512),U[1]||(U[1]=G("span",{style:{"pointer-events":"all",visibility:"hidden"}},null,-1)),G("div",{class:"cursor-e-resize",ref:d.refs.east},null,512),G("div",{class:"cursor-sw-resize",ref:d.refs.southWest},null,512),G("div",{class:"cursor-s-resize",ref:d.refs.south},null,512),G("div",{class:"cursor-se-resize",ref:d.refs.southEast},null,512)])],2)),[[yr,g.value]]):ne("v-if",!0)]),_:3}))}});function As(n){return n==null||n===""?n:new de.Reader(new de.ByteStream(n)).deserialize()}hr.__scopeId="data-v-39ea9741",hr.__file="src/controls/xwindow/XWindow.vue";class Or{debug=!1;simple=!1;utc=!1;longType="number";dictType="object";nullType=void 0;static Instance=new Or;textEncoder=new TextEncoder;textDecoder=new TextDecoder;constructor(){}encodeResponse(e,t={}){var r=new de.ByteStream,o=new de.Writer(r,this.simple,this.utc),i=t;this.simple;var s=0;for(var c in i)s++;s>0&&(r.writeByte(72),o.serialize(i),o.reset()),e instanceof Error?(r.writeByte(69),o.serialize(this.debug&&e.stack?e.stack:e.message)):(r.writeByte(82),o.serialize(e)),r.writeByte(122);const p=r.takeBytes();return this.textDecoder.decode(p)}decodeRequest(e,t={}){const r=this.textEncoder.encode(e);if(r.length===0)return["~",[]];var o=new de.ByteStream(r),i=new de.Reader(o,!1);i.longType=this.longType,i.dictType=this.dictType;var s=o.readByte();if(s===72){var c=i.deserialize(this.nullType);for(var p in c)t[p]=c[p];i.reset(),s=o.readByte()}switch(s){case 67:return[i.deserialize(String),this.decodeArguments(i)];case 122:return["~",[]];default:throw new Error(`Invalid request:\r
`+o.toString())}}decodeArguments(e){var t=e.stream;let r=[];if(t.readByte()===97){e.reset();var o=de.ValueReader.readCount(t);const s=new Array(o).fill(this.nullType);r=new Array(o),e.addReference(r);for(var i=0;i<o;++i)r[i]=e.deserialize(s[i]);t.readByte()}return r}encodeRequest(e,t,r={}){var o=new de.ByteStream,i=new de.Writer(o,this.simple,this.utc),s=r;this.simple&&(s.simple=!0);var c=0;for(var p in s)c++;c>0&&(o.writeByte(72),i.serialize(s),i.reset()),o.writeByte(67),i.serialize(e),t.length>0&&(i.reset(),i.serialize(t)),o.writeByte(122);const m=o.takeBytes();return this.textDecoder.decode(m)}decodeResponse(e,t={}){const r=this.textEncoder.encode(e);var o=new de.ByteStream(r),i=new de.Reader(o,!1);i.longType=this.longType,i.dictType=this.dictType;var s=o.readByte();if(s===72){var c=i.deserialize();for(var p in c)t[p]=c[p];i.reset(),s=o.readByte()}switch(s){case 82:return t.simple&&(i.simple=!0),i.deserialize();case 69:throw new Error(i.deserialize(String));case 122:return;default:throw new Error(`Invalid response:\r
`+o.toString())}}}const dr=5e3,ds=36e5,Oe={Login:"/api/User/Login",ChangeMyPwd:"/api/User/ChangeMyPwd",Logout:"/api/Check/ExitLogin",RefreshToken:"/api/Check/RefreshToken",CheckToken:"/api/Check/CheckToken",GetSystemRights:"/api/System/GetSystem"},nn="access_token",fs=$.Config.ServiceURL.LoginAuthURL;function fr(){const n=ui();n&&je(Oe.RefreshToken,fs,{refreshToken:n}).then(e=>{Hr(e.data)})}function ps(){const n=Ve.getJsonObject(nn);if(!n)return;const e=new Date().getTime(),t=new Date(n.expire).getTime()-e;t>0&&(t<=dr?fr():setTimeout(fr,t-dr))}function Hr(n){const e=new Date().getTime();let t=new Date(n.accessToken.expires).getTime()-e;if((t>=ds||t<-6e5)&&(t=18e5),t>0){let r=We();r?(r.token=n.accessToken.tokenContent,r.expire=n.accessToken.expires,r.refresh=n.refreshToken.tokenContent):r={token:n.accessToken.tokenContent,expire:n.accessToken.expires,refresh:n.refreshToken.tokenContent},Ve.set(nn,r,t/1e3),ps()}else Ve.remove(nn)}const rn="Wm314243",St=$.Config.ServiceURL.LoginAuthURL;async function Ls(n){const e={username:n.username,pwd:en.encryptToString(n.pwd,rn)},t=(await je(Oe.Login,St,e))?.data;return t&&(Hr(t.doubletoken),Qt(!1)),t}function Ms(n){const e={oldpwd:en.encryptToString(n.oldpwd,rn),newpwd:en.encryptToString(n.newpwd,rn)};return je(Oe.ChangeMyPwd,St,e)}function Ds(){const n=We();n&&(hi(Oe.Logout,St,{token:n.token,reftoken:n.refresh}),Rr())}function Ps(n){return je(Oe.CheckToken,St,{token:n})}const dn="ROLE_SYSTEM_RIGHT",fn=new kr("",sessionStorage);function gs(){return fn.get(dn)}function pr(n){fn.set(dn,n)}function ms(){fn.remove(dn)}function qe(n){if(n)for(let e=0;e<n.length;e++){const t=n[e];t.children&&t.children.length>0?(qe(t.children),t.children.length===0&&(n.splice(e,1),e--)):t.selected||(n.splice(e,1),e--)}}function zr(n,e,t="name"){n&&e&&n.forEach(r=>{const o=e.find(i=>i[t]===r[t]);o&&(r.children?o.children&&zr(r.children,o.children,t):(!o.children||o.children.length===0)&&o.selected&&(r.selected=o.selected))})}function ot(n,e,t,r="name"){const o=n[t],i=e[t];o?i&&zr(o,i,r):i&&(n[t]=i)}function vs(n){if(n&&n.length>0){const e=n.length;let t,r=!1;if(e>0){r=cn(n[0]);const o=r?n[0]:JSON.parse(n[0]);if(e>1)for(let i=1;i<n.length;i++){const s=n[i],c=r?s:JSON.parse(s);ot(o,c,"routes","name"),ot(o,c,"widgetMenu","name"),ot(o,c,"widgets","id"),ot(o,c,"functions","id")}t=o}return t&&(qe(t.routes),qe(t.widgetMenu),qe(t.widgets),qe(t.functions)),t}}const Kt=[],Yt=[];function Ur(){return gs()}async function Bs(n,e=!1){ms();const t=Oe.GetSystemRights,r=$.Config.ServiceURL.LoginAuthURL,o=await je(t,r,{systemid:n});if(!o||!o.data)return void $.Message?.warn("无法获取功能授权列表！");const i=o.data;if(i&&i.length>0){if(e){const s=JSON.parse(i[0]);return pr(s),s}{const s=vs(i);return pr(s),s}}}function qr(n,e){const t={...n};return t.meta||(t.meta={}),e.index!=null&&(t.meta.index=e.index),e.title!=null&&(t.meta.title=e.title),n.children&&(t.children=[],e.children&&e.children.forEach(r=>{const o=n.children?.find(i=>i.path===r.path);if(o){const i=qr(o,r);i&&t.children?.push(i)}})),t}function Ns(n,e=2){if(e===0)return n;const t=Ur();return t&&t.routes?(Yt.length>0||n.forEach(r=>{const o=t.routes?.find(i=>i.name===r.name);if(o){const i=qr(r,o);i&&Yt.push(i)}}),Yt):void 0}function Ws(n,e=2){if(e===0)return n;const t=Ur();return t&&t.widgets?(Kt.length>0||n?.forEach(r=>{t.widgets?.find(o=>o.id===r.id)&&Kt.push(r)}),Kt):void 0}export{Cs as A,$ as B,As as C,We as D,Ms as I,Is as J,ai as L,Bs as M,Vt as N,Ps as P,Ds as R,je as S,ks as V,xs as Y,wi as a,kr as b,ps as c,le as d,Ws as e,Ns as f,hr as g,he as h,Ur as i,Hr as j,Es as k,Ts as l,Wn as m,rt as o,ue as s,Rs as t,Ls as x,Ss as y,ms as z};
