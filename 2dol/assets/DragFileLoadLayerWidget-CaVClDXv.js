import{H as u,ab as o}from"./vendor-BjjxFmO4.js";import{G as f,a as S,b as g}from"./ol-exp-BZzGrai6.js";import{F as c,c as G,n as F,f as x}from"./xframelib-exp-B5TZbF78.js";import{d as M,b,O as H,S as N,U as O,c as h}from"./@vue-exp-18LRBxdm.js";import"./axios-exp-C7rfqWEd.js";import"./@iconify/vue-exp-C65O8cJc.js";const I={class:"row justify-center"},W=M({__name:"DragFileLoadLayerWidget",setup(v){const{importContent:w,exportDatasetAsGeoJSON:d,setDatasetCrsInfo:y,exportFileContent:A,importGeoJSON:j}=o.internal;let r;async function D(e){if(!(!e||e.length===0)){e.length;const a=Array.from(e),t=await o.import2DFiles(a);if(t&&t.length>0){const n=c.XMap,i=n.MapView.getProjection();t.forEach(p=>{const l=d(p.dataset,{}),s=new f().readFeatures(l,{dataProjection:"EPSG:4326",featureProjection:i}),m=new S({features:s});r=new g({source:m}),r&&n.map.addLayer(r)})}}}async function E(e){if(F(e))c.Message.info(e);else if(Array.isArray(e)){const a=e;if(a.length===0)return;const t=await o.import2DFiles(a);t&&t.length>0&&t.forEach(n=>{const i=d(n.dataset,{}),p=new f().readFeatures(i,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"}),l=new S({features:p}),s=new g({source:l});s&&c.XMap.map.addLayer(s)})}}async function P(){if(!r)return;const e=r.getSource()?.getFeatures(),a=new f().writeFeatures(e),t=j(a,{});await o.transformDataset(t,"EPSG:3857","EPSG:4326"),t&&o.saveDataset(t,"shapefile",!0,"4326.zip")}async function _(){const e=await x("SampleData/china.json"),a=w({json:{filename:"china.json",content:JSON.stringify(e.data)}});y(a,{prj:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137,298.257223563]],PRIMEM["Greenwich",0],UNIT["Degree",0.017453292519943295]]'}),o.saveDataset(a,"shapefile")}return b(()=>{c.XMap&&(G.bindDropFileHanlder("map",D),G.onPasteHandler(E))}),(e,a)=>(H(),N("div",I,[a[0]||(a[0]=O("span",{style:{"z-index":"100"}},"拖拽文件，添加对应图层到地图上",-1)),h(u,{color:"primary",label:"导出SHP",onClick:_}),h(u,{color:"primary",label:"导出矢量图层为json",onClick:P})]))}});export{W as default};
