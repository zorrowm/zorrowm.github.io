import{d as M,e as I,r as f,b as h,B,O as E,S as L,U as s,D as v,ad as w,Z as O}from"./@vue-exp-DhuHfG86.js";import{O as R,d as U,u as D,g as C,k as _,f as F}from"./index-9YwdlOdB.js";import{F as o,w as H,b as V}from"./xframelib-exp-DUbArU78.js";import{b as $}from"./vue-router-exp-CLDoDjFh.js";import{as as q,aq as K}from"./vendor-DEnSXaZk.js";import{S as N}from"./SystemsEvent-DUQCZw_Q.js";import"./monaco-editor-exp-BNK_u0iZ.js";import"./ol-exp-DNVUl0aT.js";import"./axios-exp-C7rfqWEd.js";import"./@iconify/vue-exp-DcFsj1aI.js";const T={class:"container",style:{height:"500px"}},j={class:"login"},Z={class:"login-center clearfix"},z={class:"login-center-input"},A={class:"login-center clearfix"},G={class:"login-center-input"},y="loginIFrame",re=M({name:"loginIFrame",__name:"loginModal",props:{data:q([Object]).def({}),extra:K().isRequired},setup(J){const x=$(),t=I({username:"",password:""}),i=f(),l=f();function d(){i.value&&(i.value.placeholder="请输入账号"),l.value&&(l.value.placeholder="请输入密码")}let r=!0;const m=async()=>{if(!r){o.Logger().debug("频繁点击登录******");return}if(r=!1,t.username.trim()===""||t.password.trim()=="")return setTimeout(()=>{r=!0},2e3),o.Message?.warn("用户名或密码不能为空！");let a={username:t.username.trim(),pwd:t.password.trim()};const e=await H(a).catch(n=>{o.Message?.warn(`登录失败:${n.message}!`),r=!0});e&&await S(e)};async function S(a){const e=D();e.init(a),o.User=e.id;const n=C(),b=e.DefaultMaxRoleLevel===0;let g=!0;const c=await V(n,b).catch(u=>{g=!1,o.Message?.err("该系统未注册！")});if(r=!0,!!g){if(o.Logger().debug(c,"登录后的系统权限"),c){const u=_();o.Logger().debug(u,"系统路由权限"),u?.forEach(k=>{x.addRoute(k)})}else{o.Message?.warn(t.username+"无系统权限，无法登录！");return}F(N.UserLoginSuccess,void 0)}}function p(a){}return h(()=>{R(y,p)}),B(()=>{U(y,p)}),(a,e)=>(E(),L("div",T,[s("div",j,[e[8]||(e[8]=s("div",{class:"login-top"},"用户登录",-1)),s("div",Z,[e[5]||(e[5]=s("div",{class:"login-center-img"},[s("img",{src:"img/login/name.png"})],-1)),s("div",z,[v(s("input",{ref_key:"nameInput",ref:i,"onUpdate:modelValue":e[0]||(e[0]=n=>t.username=n),type:"text",placeholder:"请输入账号",onfocus:"this.placeholder=''",onBlur:e[1]||(e[1]=n=>d())},null,544),[[w,t.username]]),e[4]||(e[4]=s("div",{class:"login-center-input-text"},"账号",-1))])]),s("div",A,[e[7]||(e[7]=s("div",{class:"login-center-img"},[s("img",{src:"img/login/password.png"})],-1)),s("div",G,[v(s("input",{ref_key:"pwdInput",ref:l,"onUpdate:modelValue":e[2]||(e[2]=n=>t.password=n),type:"password",placeholder:"请输入密码",onfocus:"this.placeholder=''",onBlur:e[3]||(e[3]=n=>d()),onKeyup:O(m,["enter"])},null,544),[[w,t.password]]),e[6]||(e[6]=s("div",{class:"login-center-input-text"},"密码",-1))])]),s("div",{class:"login-button",onClick:m},"登录")])]))}});export{re as default};
