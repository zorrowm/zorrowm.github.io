import{Y as k,X as B}from"./vendor-BjjxFmO4.js";import{d as I,r as m,a as D,w as O,b as R,B as U,O as u,S as p,c as d,C as v,W as f,D as X,K as E,U as G,P as q,F as z}from"./@vue-exp-18LRBxdm.js";import{F as l,Q,f as A}from"./xframelib-exp-B5TZbF78.js";import{A as F,U as N,R as P,M as Y}from"./xgis-ol-exp-CshjZaOS.js";import{b as Z}from"./vue-router-exp-CvNwyAs-.js";import{M as j}from"./MultiService-mSSu8pmF.js";import{S as K}from"./index-wDZCrNO2.js";import{_ as $}from"./index-Dxssf89i.js";import"./ol-exp-BZzGrai6.js";import"./axios-exp-C7rfqWEd.js";import"./@iconify/vue-exp-C65O8cJc.js";import"./monaco-editor-exp-BNK_u0iZ.js";const H={key:0,id:"map2",class:"mapstyle"},J={key:0,class:"rightOptionList"},ee={class:"layerTreeContainer"},ae=I({__name:"TwoXMapWidget",setup(te){const s=m(),y=m(!0),x=B(),w=[{},{id:"pasteLoad",label:"粘贴（加载图层）",icon:"ic:round-content-paste-go"}];async function T(t){t.id==="pasteLoad"&&x.dialog({title:"粘贴确认",message:`<ul style="margin-left:10px;">
            <li>影像服务名（例如：m:GuLangYu、s:test1）;</li> 
          </ul> `,html:!0,cancel:!0,persistent:!0}).onOk(async()=>{try{const e=await navigator.clipboard.readText();if(!e)return;e[1]===":"?g(e):Q(e)}catch(e){l.Message.err("读取拷贝数据错误",e)}}).onCancel(()=>{}).onDismiss(()=>{})}const _=D(()=>s.value?.mapMenuState.layerTree),b=Z();let a,r,M="";const o=m([]),n=m("");O(()=>n.value,(t,e)=>{a&&(t&&a.LayerManager.changeLayerVisible("s:"+t,!0),e&&a.LayerManager.changeLayerVisible("s:"+e,!1))});const C=new j(K.ImageAdminClient);function g(t){if(!t)return;let e;A(l.Config.ServiceURL.WMTSService+"/GetServiceBrowse",{layer:t}).then(c=>{if(c.status===200){if(e=c.data,t.startsWith("m:")){o.value.length=0,n.value="";const V=t.substring(2);C.GetMultiServiceRelServiceList(V,0,0).then(h=>{h.arrayList.forEach(i=>{o.value.push({label:i.servicealias??i.servicename,value:i.servicename});const W="s:"+i.servicename,L={...e};L.name=i.servicename,a.WMTSTool.addWMTSLayerSelf(L,W)}),o.value.length>0&&(n.value=o.value[o.value.length-1].value)}).catch(h=>{})}else a.WMTSTool.addWMTSLayerSelf(e,t);const S=e.bounds;S?a.zoomToExtent(S):a.zoomToCenter(e.center,e.level??5)}})}return R(()=>{r=document.getElementById("map"),r.style.left="50%",r.style.width="50%",a=new F("map2","map",!0),a.initMapView({zoom:5,center:[116.46229441189399,40.24876149],minZoom:1,maxZoom:22,projection:"EPSG:3857"}),a.addOnlineLayer("vec_w"),a.addOnlineLayer("cva_w"),a.enableMapSyncView(),s.value=a,y.value=!!a.LayerManager,l.XMap2=a,l.XMap.enableMapSyncView();const e=b.query.layer;e&&(M=e),g(M)}),U(()=>{r&&(r.style.left="0",r.style.width="100%"),a&&a.disableMapSyncView();const t=l.XMap;t&&t.disableMapSyncView()}),(t,e)=>(u(),p(z,null,[s.value?(u(),p("div",H,[d(v(N),{xmap:s.value,hasLayerTree:y.value,class:"q-gutter-y-xs xmap-zoombar"},null,8,["xmap","hasLayerTree"]),d(v(P),{xmap:s.value,target:"map2",moreMenuList:w,onItemClicked:T},null,8,["xmap"]),o.value.length>0?(u(),p("div",J,[d(k,{modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=c=>n.value=c),options:o.value,color:"primary"},null,8,["modelValue","options"])])):f("",!0)])):f("",!0),X(G("div",ee,[s.value?(u(),q(v(Y),{key:0,xmap:s.value},null,8,["xmap"])):f("",!0)],512),[[E,_.value]])],64))}}),ye=$(ae,[["__scopeId","data-v-235735eb"]]);export{ye as default};
