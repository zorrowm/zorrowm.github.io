import{Y as D}from"./vendor-BjjxFmO4.js";import{b}from"./vue-router-exp-CvNwyAs-.js";import{F as c,f as y}from"./xframelib-exp-B5TZbF78.js";import{T as u,r as l,a as j,D as P}from"./xgis-ol-exp-CshjZaOS.js";import{M as U}from"./MultiService-mSSu8pmF.js";import{S as B}from"./index-wDZCrNO2.js";import{d as I,e as x,r as O,w as A,b as N,B as k,O as f,S as V,U as d,a2 as v,W,P as z}from"./@vue-exp-18LRBxdm.js";import{_ as G}from"./index-Dxssf89i.js";import"./ol-exp-BZzGrai6.js";import"./axios-exp-C7rfqWEd.js";import"./@iconify/vue-exp-C65O8cJc.js";import"./monaco-editor-exp-BNK_u0iZ.js";const Y={class:"rightOptionList"},Q={key:0,class:"layer_info"},X=I({__name:"QueryLayerLoadWidget",setup(Z){const C=b();let t;const o=x({name:"",rule:"",projection:""}),i=O([]),s=O("");A(()=>s.value,(a,e)=>{t&&(a&&t.LayerManager.changeLayerVisible("s:"+a,!0),e&&t.LayerManager.changeLayerVisible("s:"+e,!1))});function L(a){if(!a||a.length<=2||a[1]!=":")return;let e;const n=new U(B.ImageAdminClient);y(c.Config.ServiceURL.WMTSService+"/GetServiceBrowse",{layer:a}).then(r=>{if(r.status===200){if(e=r.data,o.name=e.name,o.projection=e.prjInfo?.epsg??"EPSG:3857",o.rule=e.tileSchema?.rule??"W",a.startsWith("m:")){i.value.length=0,s.value="";const w=a.substring(2);n.GetMultiServiceRelServiceList(w,0,0).then(g=>{g.arrayList.forEach(m=>{i.value.push({label:m.servicealias??m.servicename,value:m.servicename});const R="s:"+m.servicename,h={...e};h.name=m.servicename,t.WMTSTool.addWMTSLayerSelf(h,R)}),i.value.length>0&&(s.value=i.value[i.value.length-1].value)}).catch(g=>{})}else t.WMTSTool.addWMTSLayerSelf(e,a);const T=e.bounds;T?t.zoomToExtent(T):t.zoomToCenter(e.center,e.level??5)}})}function S(a){if(t&&a.mapID===t.target){const e=a.data.layer;e&&L(e)}}async function E(a){if(t&&a.mapID===t.target){const e=a.data;if(e.mvtURL||e.mapURL){const n=e.mvtURL||e.mapURL,r=await y(n);r.data&&(e.mvtURL?M(r.data):e.mapURL&&_(r.data))}else(e.mapJSON||e.mvtJSON)&&(e.mvtJSON?M(e.mvtJSON):e.mapJSON&&_(e.mapJSON))}}let p;function M(a){o.rule=a.tileSchema?.rule??"W",o.name=a.name;const e=l.getProjection(a.prjInfo),n=c.XMap;p||(p=new P(n)),p.addVTLayer(a),n.MapView.setZoom(a.center[2]);let r=l.fromLonLatCoordinate([a.center[0],a.center[1]],e);n.MapView.setCenter(r)}function _(a){o.rule=a.tileSchema?.rule??"W",o.name=a.name;const e=c.XMap;j(e.map,a).then(n=>{const r=e.MapView.getProjection();a.zoom,e.MapView.setZoom(a.zoom),a.center?e.MapView.setCenter(l.fromLonLatCoordinate(a.center,r)):e.MapView.setCenter(l.fromLonLatCoordinate(a.center,r))})}return N(()=>{t=c.XMap;const a=C.query.layer;a&&L(a),t.mapEventBus.eventOn(u.PASTE_LAYER_LOAD_WMTS,S),t.mapEventBus.eventOn(u.PASTE_LAYER_LOAD_MVT,E)}),k(()=>{t&&t.mapEventBus.eventOff(u.PASTE_LAYER_LOAD_WMTS,S)}),(a,e)=>(f(),V("div",Y,[o.name?(f(),V("ul",Q,[d("li",null," 图层名："+v(o.name),1),d("li",null," 切片方案："+v(o.rule),1),d("li",null," 坐标系："+v(o.projection),1)])):W("",!0),i.value.length>0?(f(),z(D,{key:1,class:"radioOption",modelValue:s.value,"onUpdate:modelValue":e[0]||(e[0]=n=>s.value=n),options:i.value,color:"primary"},null,8,["modelValue","options"])):W("",!0)]))}}),se=G(X,[["__scopeId","data-v-c51622b1"]]);export{se as default};
