import{F as s,Q as g,Z as d}from"./xframelib-exp-B5TZbF78.js";import{R as v,T as o}from"./xgis-ol-exp-CshjZaOS.js";import{X as _}from"./vendor-BjjxFmO4.js";import{d as f,r as l,b as A,O as E,P as L,C as M,W as y,A as x}from"./@vue-exp-18LRBxdm.js";import{_ as T}from"./index-Dxssf89i.js";import"./axios-exp-C7rfqWEd.js";import"./@iconify/vue-exp-C65O8cJc.js";import"./ol-exp-BZzGrai6.js";import"./monaco-editor-exp-BNK_u0iZ.js";import"./vue-router-exp-CvNwyAs-.js";const w=f({__name:"MapContextMenuWidget",setup(O){const i=l(s.XMap),m=[{},{id:"basicLayerManagerWidget",label:"在线底图管理",icon:"ic:baseline-layers",tag:"widget"},{},{id:"pasteLoad",label:"粘贴（加载影像或矢量图层）",icon:"ic:round-content-paste-go"},{id:"wmtsLoadPanelWidget",label:"OGC WMTS服务加载",icon:"gis:wmts",tag:"widget"},{id:"mvtLoadPanelWidget",label:"MVT矢量切片加载",icon:"gis:mvt",tag:"widget"}],r=l("map"),c=x(),p=_();async function u(n){if(n.tag==="widget"&&n.id){const e=c?.proxy?.$options.layoutID;s.LayoutMap.get(e)?.loadWidget(n.id)}else n.id==="pasteLoad"&&p.dialog({title:"粘贴确认",message:`<ul style="margin-left:10px;">
            <li>影像服务名（例如：m:GuLangYu、s:test1）;</li>
            <li>矢量切片服务tileJson元数据或URL;</li>
            <li>电子地图styleJson元数据或URL;</li>
          </ul> `,html:!0,cancel:!0,persistent:!0}).onOk(async()=>{try{const e=await navigator.clipboard.readText();if(!e)return;const t=i.value;if(e[1]===":")t.mapEventBus.eventEmit(o.PASTE_LAYER_LOAD_WMTS,t.newEvtArgs({layer:e}));else if(g(e))e.indexOf("/tile.json")>0?t.mapEventBus.eventEmit(o.PASTE_LAYER_LOAD_MVT,t.newEvtArgs({mvtURL:e})):e.indexOf("/style.json")>0?t.mapEventBus.eventEmit(o.PASTE_LAYER_LOAD_MVT,t.newEvtArgs({mapURL:e})):s.Message.warn("不是正确的矢量元数据URL!");else if(d(e)){const a=JSON.parse(e);a&&(a.version&&a.sources&&Array.isArray(a.layers)&&a.layers.length>0?t.mapEventBus.eventEmit(o.PASTE_LAYER_LOAD_MVT,t.newEvtArgs({mapJSON:a})):a.tilejson&&a.tileSchema&&a.prjInfo&&Array.isArray(a.vector_layers)?t.mapEventBus.eventEmit(o.PASTE_LAYER_LOAD_MVT,t.newEvtArgs({mvtJSON:a})):s.Message.warn("不是正确的矢量或地图元数据!"))}}catch(e){s.Message.err("读取拷贝数据错误:"+e.Message)}}).onCancel(()=>{})}return A(()=>{i.value=s.XMap,r.value=s.XMap.target}),(n,e)=>i.value?(E(),L(M(v),{key:0,xmap:i.value,target:r.value,moreMenuList:m,onItemClicked:u},null,8,["xmap","target"])):y("",!0)}}),I=T(w,[["__scopeId","data-v-bca91355"]]);export{I as default};
