import{K as S,$ as s}from"./vendor-DEnSXaZk.js";import{G as u,a as D,B as v,b as G}from"./ol-exp-DNVUl0aT.js";import{F as m,c as w,m as N,h as O,g as C}from"./xframelib-exp-DUbArU78.js";import{r as H}from"./xgis-ol-exp-B_x7d6gL.js";import{d as L,b as V,O as A,S as T,a6 as k,c as E}from"./@vue-exp-DhuHfG86.js";import"./axios-exp-C7rfqWEd.js";import"./@iconify/vue-exp-DcFsj1aI.js";const $=L({__name:"DragFileLoadLayerWidget",setup(B){const{importContent:h,exportDatasetAsGeoJSON:y,setDatasetCrsInfo:j,exportFileContent:J,importGeoJSON:P}=s.internal;let r;async function x(e){if(!(!e||e.length===0)){e.length;const t=Array.from(e),a=await s.import2DFiles(t);if(a&&a.length>0){const o=m.XMap,c=o.MapView.getProjection();a.forEach(i=>{const f=y(i.dataset,{}),d=new u().readFeatures(f,{dataProjection:"EPSG:4326",featureProjection:c}),l=new D({features:d}),p=l.getExtent(),g=H.getExtentFromTransform(p,c,"EPSG:4326"),M=v(g),n=i.dataset.layers[0]?.name??N();if(r=new G({source:l,properties:{center:M,bounds:g,lyrID:n,lyrName:n,lyrType:"vector",lyrGroup:n}}),r){o.map.addLayer(r);const b={id:n,name:n,alias:"",group:n,minZoom:1,maxZoom:24,visible:!0,opacity:1,type:"vector"};o.registerLayer(r,b)}})}}}async function F(e){if(O(e))m.Message.info(e);else if(Array.isArray(e)){const t=e;if(t.length===0)return;const a=await s.import2DFiles(t);if(a&&a.length>0){const o=m.XMap,c=o.MapView.getProjection();a.forEach(i=>{const f=y(i.dataset,{}),d=new u().readFeatures(f,{dataProjection:"EPSG:4326",featureProjection:c}),l=new D({features:d}),p=new G({source:l});p&&o.map.addLayer(p)})}}}async function I(){if(!r)return;const e=r.getSource()?.getFeatures(),t=new u().writeFeatures(e),a=P(t,{});await s.transformDataset(a,"EPSG:3857","EPSG:4326"),a&&s.saveDataset(a,"shapefile",!0,"4326.zip")}async function _(){const e=await C("SampleData/china.json"),t=h({json:{filename:"china.json",content:JSON.stringify(e.data)}});j(t,{prj:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137,298.257223563]],PRIMEM["Greenwich",0],UNIT["Degree",0.017453292519943295]]'}),s.saveDataset(t,"shapefile")}return V(()=>{m.XMap&&(w.bindDropFileHanlder("map",x),w.onPasteHandler(F))}),(e,t)=>(A(),T("div",null,[t[0]||(t[0]=k(" 拖拽文件，添加对应图层到地图上 ")),E(S,{color:"primary",label:"导出SHP",onClick:_}),E(S,{color:"primary",label:"导出矢量图层为json",onClick:I})]))}});export{$ as default};
