import{Y as Z,ag as b,a6 as C,H as V,ah as J}from"./vendor-BjjxFmO4.js";import{v as _,F as m,h as ee,f as I}from"./xframelib-exp-B5TZbF78.js";import{r as v}from"./xgis-ol-exp-CshjZaOS.js";import{S as te}from"./index-wDZCrNO2.js";import{d as le,r as c,O as oe,P as ie,_ as S,U as y,c as u,a6 as P,C as ae,A as ne}from"./@vue-exp-18LRBxdm.js";import{_ as se}from"./index-Dxssf89i.js";import"./ol-exp-BZzGrai6.js";import"./axios-exp-C7rfqWEd.js";import"./@iconify/vue-exp-C65O8cJc.js";import"./monaco-editor-exp-BNK_u0iZ.js";import"./vue-router-exp-CvNwyAs-.js";class j{hproseProxyClient;constructor(o){o===void 0?this.hproseProxyClient=_.getDefaultClient():this.hproseProxyClient=o}async ExistTileGridsetRule(o,a,i){const n=await this.hproseProxyClient.getHproseProxy(),t=this.hproseProxyClient.getClientContext(a,i);return await n.ExistTileGridsetRule(o,t)}async AddTileGridsetRule(o,a,i,n){const t=await this.hproseProxyClient.getHproseProxy(),s=this.hproseProxyClient.getClientContext(i,n);return await t.AddTileGridsetRule(o,a,s)}async UpdateTileGridsetRule(o,a,i,n){const t=await this.hproseProxyClient.getHproseProxy(),s=this.hproseProxyClient.getClientContext(i,n);return await t.UpdateTileGridsetRule(o,a,s)}async DeleteTileGridsetRule(o,a,i){const n=await this.hproseProxyClient.getHproseProxy(),t=this.hproseProxyClient.getClientContext(a,i);return await n.DeleteTileGridsetRule(o,t)}async GetTileGridsetRuleList(o,a,i,n,t,s){const r=await this.hproseProxyClient.getHproseProxy(),d=this.hproseProxyClient.getClientContext(t,s);return await r.GetTileGridsetRuleList(o,a,i,n,d)}async GetTileGridsetRuleByRuleid(o,a,i){const n=await this.hproseProxyClient.getHproseProxy(),t=this.hproseProxyClient.getClientContext(a,i);return await n.GetTileGridsetRuleByRuleid(o,t)}async GetListOfMembersUsingRule(o,a,i,n,t,s){const r=await this.hproseProxyClient.getHproseProxy(),d=this.hproseProxyClient.getClientContext(t,s);return await r.GetListOfMembersUsingRule(o,a,i,n,d)}async GetListOfMembersUsingRuleToString(o,a,i,n,t,s){const r=await this.hproseProxyClient.getHproseProxy(),d=this.hproseProxyClient.getClientContext(t,s);return await r.GetListOfMembersUsingRuleToString(o,a,i,n,d)}async GetTileGridsetRuleByRuleId(o,a,i){const n=await this.hproseProxyClient.getHproseProxy(),t=this.hproseProxyClient.getClientContext(a,i);return await n.GetTileGridsetRuleByRuleId(o,t)}async GetRuleinfoByRuleID(o,a,i){const n=await this.hproseProxyClient.getHproseProxy(),t=this.hproseProxyClient.getClientContext(a,i);return await n.GetRuleinfoByRuleID(o,t)}async CalculateTilerulematrixByLevel(o,a,i,n,t,s,r,d,g,T,f){const M=await this.hproseProxyClient.getHproseProxy(),w=this.hproseProxyClient.getClientContext(T,f);return await M.CalculateTilerulematrixByLevel(o,a,i,n,t,s,r,d,g,w)}async CalculateTilerulematrixList(o,a,i,n,t,s,r,d,g,T){const f=await this.hproseProxyClient.getHproseProxy(),M=this.hproseProxyClient.getClientContext(g,T);return await f.CalculateTilerulematrixList(o,a,i,n,t,s,r,d,M)}async GetTilematrixListByRule(o,a,i){const n=await this.hproseProxyClient.getHproseProxy(),t=this.hproseProxyClient.getClientContext(a,i);return await n.GetTilematrixListByRule(o,t)}async GetBoundsbyEPSG(o,a,i){const n=await this.hproseProxyClient.getHproseProxy(),t=this.hproseProxyClient.getClientContext(a,i);return await n.GetBoundsbyEPSG(o,t)}async GetEpsgCodeList(o,a,i,n,t){const s=await this.hproseProxyClient.getHproseProxy(),r=this.hproseProxyClient.getClientContext(n,t);return await s.GetEpsgCodeList(o,a,i,r)}}new j;const re={class:"q-gutter-y-md loadWMTSPanel"},ue=le({__name:"WMTSLoadPanelWidget",setup(E){const o=c("GetServiceBrowse"),a=c(m.Config.ServiceURL.WMTSService??"https://gis-image.digsur.com/IMGWMTS"),i=c("s:test1");function n(){if(!i.value){m.Message.warn("影像服务名不能为空！");return}if(m.XMap){const p=m.XMap,e=i.value;I(a.value+"/GetServiceBrowse",{layer:e}).then(l=>{if(l.status===200){const G=l.data;p.WMTSTool.addWMTSLayerSelf(G,e);const W=G.bounds;p.zoomToExtent(W)}}).catch(l=>{m.Message.warn(`请求服务${e}元数据失败`,l.Message)})}}const t=c(m.Config.ServiceURL.WMTSService),s=c(""),r=c("C"),d=c("default"),g=c("image/jpeg"),T=c(1),f=c(18);function M(){if(!t.value||!s.value||!r.value){m.Message.warn("图层名等参数不能为空！");return}if(m.XMap){const p=m.XMap;let e,l;const G=r.value.toLocaleLowerCase();G==="c"?(e=v.getTDTTileGrid(!1),l=v.getProjection({epsg:"EPSG:4490",prjExtent:[-180,-90,180,90]}),p.WMTSTool.addWMTSLayer(s.value,r.value,t.value,e,l,d.value,"KVP",g.value)):G==="w"?(e=v.getTDTTileGrid(!0),l=v.getProjection({epsg:"EPSG:3857"}),p.WMTSTool.addWMTSLayer(s.value,r.value,t.value,e,l,d.value,"KVP",g.value)):new j(te.ImageAdminClient).GetTileGridsetRuleByRuleid(r.value).then(async x=>{if(!x||!x.rule){m.Message.warn(`矩阵集名错误：${r.value}`);return}const L=x.tilerule.epsg,B=x.tilerule.boundingBoxMinX,D=x.tilerule.boundingBoxMinY,k=x.tilerule.boundingBoxMaxX,U=x.tilerule.boundingBoxMaxY,N=x.tilerule.tileheight,Q=x.tilerule.tilewidth,H={};for(let h=0;h<x.tilerulematrixs.length;h++){const K=x.tilerulematrixs[h].level,z=x.tilerulematrixs[h].resolutions;H[K]=z}const Y=await I("https://epsg.gis.digsur.com/#/epsg/"+L),A={epsg:"EPSG:"+L,proj4:Y.proj4,prjExtent:[B,D,k,U]},F=v.getProjection(A),$={rule:r.value,origin:[B,U],tileSize:[Q,N],resolutions:H},q=v.createWMTSTileGrid($);p.WMTSTool.addWMTSLayer(s.value,r.value,t.value,q,F,d.value,"KVP",g.value)})}}async function w(){const p=await v.getWMTSCapabilities(t.value,s.value),e=await v.getXMLOptionsFromCapabilities(p,!0);e&&m.XMap.WMTSTool.addWMTSLayerByXMLOptions(e)}const R=ne();function O(p){p.id}function X(p){const e=R?.proxy?.$options.id,l=R?.proxy?.$options.layoutID;e&&m.LayoutMap.get(l)?.unloadWidget(e)}return(p,e)=>(oe(),ie(ae(ee),{isDark:!1,top:"0px",left:"10px",nWidth:"550px",hHeight:"250px",title:"添加WMTS服务",icon:"img/basicimage/arcgis_img.png",onLoaded:O,onClose:X},{default:S(()=>[y("div",re,[u(Z,{modelValue:o.value,"onUpdate:modelValue":e[0]||(e[0]=l=>o.value=l),inline:"",options:[{label:"影像平台服务名",value:"GetServiceBrowse"},{label:"通过GetCapabilities",value:"getCapabilities"},{label:"URL和参数",value:"URL"}]},null,8,["modelValue"]),u(J,{modelValue:o.value,"onUpdate:modelValue":e[12]||(e[12]=l=>o.value=l),animated:"",class:"shadow-2 rounded-borders"},{default:S(()=>[u(b,{name:"GetServiceBrowse"},{default:S(()=>[e[13]||(e[13]=y("div",{class:"info-title"},"只支持影像平台，输入发布的影像服务名",-1)),y("div",null,[u(C,{filled:"",modelValue:i.value,"onUpdate:modelValue":e[1]||(e[1]=l=>i.value=l),label:"输入服务名"},null,8,["modelValue"]),u(C,{filled:"",modelValue:a.value,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value=l),label:"影像平台服务地址（默认）"},null,8,["modelValue"]),u(V,{color:"primary",label:"添加影像WMTS",onClick:n})])]),_:1}),u(b,{name:"getCapabilities"},{default:S(()=>[e[14]||(e[14]=y("div",{class:"info-title"},[P("通过OGC标准WMTS的GetCapabilitis元数据加载图层"),y("br"),P(" https://image.gis.digsur.com/IMGWMTS?layer=s:test1&Service=WMTS&Request=GetCapbilities ")],-1)),y("div",null,[u(C,{filled:"",modelValue:t.value,"onUpdate:modelValue":e[3]||(e[3]=l=>t.value=l),label:"影像平台服务地址（默认）"},null,8,["modelValue"]),u(C,{filled:"",modelValue:s.value,"onUpdate:modelValue":e[4]||(e[4]=l=>s.value=l),label:"输入图层名"},null,8,["modelValue"]),u(V,{color:"primary",label:"添加WMTS",onClick:w})])]),_:1}),u(b,{name:"URL"},{default:S(()=>[e[15]||(e[15]=y("div",{class:"info-title"},[P("输入OGC WMTS参数，构建例如："),y("br"),P(" https://image.gis.digsur.com/IMGWMTS?layer=s:test1&style=default&tilematrixset=C"),y("br"),P("&Service=WMTS&Request=GetTile&Version=1.0.0&Format=image/jpeg"),y("br"),P("&TileMatrix=10&TileCol=843&TileRow=142&threshold=100 ")],-1)),y("div",null,[u(C,{filled:"",modelValue:t.value,"onUpdate:modelValue":e[5]||(e[5]=l=>t.value=l),label:"影像平台服务地址（默认Global.Config.ServiceURL.WMTSService）"},null,8,["modelValue"]),u(C,{filled:"",modelValue:s.value,"onUpdate:modelValue":e[6]||(e[6]=l=>s.value=l),label:"图层名"},null,8,["modelValue"]),u(C,{filled:"",modelValue:r.value,"onUpdate:modelValue":e[7]||(e[7]=l=>r.value=l),label:"瓦片矩阵集（例如：C/W）"},null,8,["modelValue"]),u(C,{filled:"",modelValue:d.value,"onUpdate:modelValue":e[8]||(e[8]=l=>d.value=l),label:"样式名,默认为default"},null,8,["modelValue"]),u(C,{filled:"",modelValue:g.value,"onUpdate:modelValue":e[9]||(e[9]=l=>g.value=l),label:"Format,默认为image/jpeg"},null,8,["modelValue"]),u(C,{modelValue:T.value,"onUpdate:modelValue":e[10]||(e[10]=l=>T.value=l),modelModifiers:{number:!0},type:"number",filled:"",label:"最小级别,默认为1"},null,8,["modelValue"]),u(C,{modelValue:f.value,"onUpdate:modelValue":e[11]||(e[11]=l=>f.value=l),modelModifiers:{number:!0},type:"number",filled:"",label:"最大级别,默认为18"},null,8,["modelValue"]),u(V,{color:"primary",label:"添加WMTS",onClick:M})])]),_:1})]),_:1},8,["modelValue"])])]),_:1}))}}),Pe=se(ue,[["__scopeId","data-v-a1e70aa3"]]);export{Pe as default};
