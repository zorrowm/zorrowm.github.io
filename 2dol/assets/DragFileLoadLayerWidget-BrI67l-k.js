import{K as u,$ as o}from"./vendor-DEnSXaZk.js";import{G as f,a as S,b as g}from"./ol-exp-DNVUl0aT.js";import{F as c,c as h,h as F,g as x}from"./xframelib-exp-DUbArU78.js";import{d as M,b as N,O,S as b,U as H,c as G}from"./@vue-exp-DhuHfG86.js";import"./axios-exp-C7rfqWEd.js";import"./@iconify/vue-exp-DcFsj1aI.js";const I={class:"row justify-center"},W=M({__name:"DragFileLoadLayerWidget",setup(v){const{importContent:w,exportDatasetAsGeoJSON:d,setDatasetCrsInfo:y,exportFileContent:A,importGeoJSON:j}=o.internal;let r;async function D(e){if(!(!e||e.length===0)){e.length;const t=Array.from(e),a=await o.import2DFiles(t);if(a&&a.length>0){const n=c.XMap,i=n.MapView.getProjection();a.forEach(p=>{const l=d(p.dataset,{}),s=new f().readFeatures(l,{dataProjection:"EPSG:4326",featureProjection:i}),m=new S({features:s});r=new g({source:m}),r&&n.map.addLayer(r)})}}}async function E(e){if(F(e))c.Message.info(e);else if(Array.isArray(e)){const t=e;if(t.length===0)return;const a=await o.import2DFiles(t);a&&a.length>0&&a.forEach(n=>{const i=d(n.dataset,{}),p=new f().readFeatures(i,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"}),l=new S({features:p}),s=new g({source:l});s&&c.XMap.map.addLayer(s)})}}async function P(){if(!r)return;const e=r.getSource()?.getFeatures(),t=new f().writeFeatures(e),a=j(t,{});await o.transformDataset(a,"EPSG:3857","EPSG:4326"),a&&o.saveDataset(a,"shapefile",!0,"4326.zip")}async function _(){const e=await x("SampleData/china.json"),t=w({json:{filename:"china.json",content:JSON.stringify(e.data)}});y(t,{prj:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137,298.257223563]],PRIMEM["Greenwich",0],UNIT["Degree",0.017453292519943295]]'}),o.saveDataset(t,"shapefile")}return N(()=>{c.XMap&&(h.bindDropFileHanlder("map",D),h.onPasteHandler(E))}),(e,t)=>(O(),b("div",I,[t[0]||(t[0]=H("span",{style:{"z-index":"100"}},"拖拽文件，添加对应图层到地图上",-1)),G(u,{color:"primary",label:"导出SHP",onClick:_}),G(u,{color:"primary",label:"导出矢量图层为json",onClick:P})]))}});export{W as default};
