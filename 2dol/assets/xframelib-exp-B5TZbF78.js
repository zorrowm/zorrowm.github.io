import{S as pe,V as ae,X as ve,a3 as Vn,e as Mr,P as ee,E as Dr,_ as be,a4 as ii,U as Q,F as Te,a5 as We,W as re,r as Y,d as Be,O as X,D as Lr,K as Ar,a6 as ln,a2 as wn,a7 as si,c as _t,L as Pr,a8 as _e,w as Me,a as He,b as _n,y as ai,Y as Re,I as ci,B as li,C as Ot,o as ui,R as It,m as hi,n as Br,A as di}from"./@vue-exp-18LRBxdm.js";import{a as fi}from"./axios-exp-C7rfqWEd.js";import{f as fe,g as ft,h as pi,i as gi}from"./vendor-BjjxFmO4.js";import{I as Ft}from"./@iconify/vue-exp-C65O8cJc.js";function Xt(n){return window.TouchEvent&&n instanceof TouchEvent}class ue{e;constructor(e){this.e=e}stopPropagation(){this.e.stopPropagation()}preventDefault(){this.e.preventDefault()}get clientX(){return Xt(this.e)?(this.e.type==="touchend"?this.e.changedTouches:this.e.touches).item(0).clientX:this.e.clientX}get clientY(){return Xt(this.e)?(this.e.type==="touchend"?this.e.changedTouches:this.e.touches).item(0).clientY:this.e.clientY}get clientCoord(){return new bn(this.clientX,this.clientY)}static bindDown(e,t,r,o=!1){const i=c=>{t(new ue(c))},s=c=>{c.touches.length===1&&t(new ue(c)),c.touches.length>1&&r&&r(new ue(c))};return e.addEventListener("mousedown",i,o),e.addEventListener("touchstart",s,o),()=>{e.removeEventListener("mousedown",i,o),e.removeEventListener("touchstart",s,o)}}static bindMove(e,t,r=!1){const o=s=>{t(new ue(s))},i=s=>{s.touches.length===1&&t(new ue(s))};return e.addEventListener("mousemove",o,r),e.addEventListener("touchmove",i,r),()=>{e.removeEventListener("mousemove",o,r),e.removeEventListener("touchmove",i,r)}}static bindUp(e,t,r=!1){const o=s=>{t(new ue(s))},i=s=>{s.touches.length===0&&t(new ue(s))};return e.addEventListener("mouseup",o,r),e.addEventListener("touchend",i,r),()=>{e.removeEventListener("mouseup",o,r),e.removeEventListener("touchend",i,r)}}originalEvent({mouse:e,touch:t}){Xt(this.e)?t&&t(this.e):e&&e(this.e)}}class bn{x;y;constructor(e,t){this.x=e,this.y=t}clone(){return new bn(this.x,this.y)}}class mi{handle;container;options;unbindDown;unbindMove;unbindUp;constructor(e,t,r={}){this.handle=e,this.container=t,this.options=r,e&&(this.unbindDown=ue.bindDown(e,this.mousedown),e.classList.add("draggable-handle"))}teardown(){this.handle?.classList.remove("draggable-handle"),this.unbindDown&&this.unbindDown(),this.unbindUp&&this.unbindUp(),this.unbindMove&&this.unbindMove()}offsetX;offsetY;mousedown=e=>{e.preventDefault(),this.handle&&(this.offsetX=e.clientX,this.offsetY=e.clientY),this.options.onMoveStart&&this.options.onMoveStart(),this.unbindMove=ue.bindMove(document,this.mousemove),this.unbindUp=ue.bindUp(document,this.mouseup)};mousemove=e=>{this.container&&(this.container.style.left=`calc(${e.clientX-this.offsetX}px + ${this.container.style.left})`,this.container.style.top=`calc(${e.clientY-this.offsetY}px + ${this.container.style.top})`,this.offsetX=e.clientX,this.offsetY=e.clientY),this.options.onMove&&this.options.onMove()};mouseup=e=>{this.options.onMoveEnd&&this.options.onMoveEnd(),this.unbindUp(),this.unbindMove(),this.unbindUp=this.unbindMove=void 0}}class vi{_group;onChange;zIndex;constructor(e,t){this._group=e,this.onChange=t,this.a(r=>r.push(this))}set group(e){this._group=e;const t=gt(this._group),r=gt(e);t.splice(t.indexOf(this),1),r.push(this),Yn()}get group(){return this._group}unregister(){this.a(e=>e.splice(e.indexOf(this),1))}raise(){this.a(e=>{e.splice(e.indexOf(this),1),e.push(this)})}a(e){e(gt(this._group)),Yn()}}const pt=new Map,yi=0;function gt(n){return pt.has(n)||pt.set(n,[]),pt.get(n)}function Nr(n,e){return n>e?-Nr(e,n):n<0&&e>=0?1:n-e}function Yn(){let n=yi;for(const e of function(t){const r=[];return t.forEach((o,i)=>r.push(i)),r}(pt).sort(Nr))for(const t of gt(e))n!=t.zIndex&&(t.zIndex=n,t.onChange(n)),n++}function un(n){if(n){const{width:e,height:t}=n.style;n.style.width="auto",n.style.height="auto";const r=mt(n);return n.style.width=e,n.style.height=t,r}return{width:0,height:0,top:0,left:0,bottom:0,right:0}}function mt(n){const e=n.getBoundingClientRect(),t=e.width,r=e.height,o=e.top,i=e.left;return{width:t,height:r,top:o,left:i,bottom:o+r,right:i+t}}class wi{container;options;handles;constructor(e,t){if(this.container=e,this.options=t,e&&t){this.handles=Wr.map(d=>new d(e,this));const{width:r,height:o}=un(e),i=t.maxWidth||window.innerWidth,s=t.maxHeight||window.innerHeight;let c=!1;(r<t.minWidth||r>i)&&(e.style.width=`${Jn(r,t.minWidth,i)}px`,c=!0),(o<t.minHeight||o>s)&&(e.style.height=`${Jn(o,t.minHeight,s)}px`,c=!0),c&&t.onResize&&t.onResize()}}teardown(){this.handles?.forEach(e=>e.teardown())}}const Wr=[];class ke{container;helper;handle;handleSize=8;unbindDown;unbindMove;unbindUp;constructor(e,t){this.container=e,this.helper=t,this.handle=this.createHandleElement(),this.unbindDown=ue.bindDown(this.handle,this.mousedown)}teardown(){this.unbindDown(),this.unbindUp&&this.unbindUp(),this.unbindMove&&this.unbindMove(),this.handle.parentElement.removeChild(this.handle)}x0;y0;left0;top0;width0;height0;mousedown=e=>{e.preventDefault(),e.stopPropagation();const{left:t,top:r,width:o,height:i}=mt(this.container);this.x0=e.clientX,this.y0=e.clientY,this.left0=t,this.top0=r,this.width0=o,this.height0=i,this.calcSafeBoundaries(),this.helper.options&&this.helper.options.onResizeStart&&this.helper.options.onResizeStart(),this.unbindMove=ue.bindMove(document,this.mousemove),this.unbindUp=ue.bindUp(document,this.mouseup)};minLeft;maxLeft;minRight;maxRight;minTop;maxTop;minBottom;maxBottom;calcSafeBoundaries(){if(!this.helper.options)return;const{left:e,top:t,right:r,bottom:o}=mt(this.container),i=this.helper.options,s=i.maxWidth||window.innerWidth,c=i.maxHeight||window.innerHeight;this.minLeft=Math.max(r-s,0),this.maxLeft=r-i.minWidth,this.minRight=e+i.minWidth,this.maxRight=Math.min(e+s,window.innerWidth),this.minTop=Math.max(o-c,0),this.maxTop=o-i.minHeight,this.minBottom=t+i.minHeight,this.maxBottom=Math.min(t+c,window.innerHeight)}mousemove=e=>{e.preventDefault(),e.stopPropagation(),this.setPosition(e),this.fixPosition(),this.helper.options&&this.helper.options.onResize&&this.helper.options.onResize()};fixPosition(){const{width:e,height:t,left:r,top:o,right:i,bottom:s}=mt(this.container),c=this.helper.options;c&&(r<this.minLeft?(this.container.style.width=e+r-this.minLeft+"px",this.container.style.left=`${this.minLeft}px`):r>this.maxLeft?(this.container.style.width=`${c.minWidth}px`,this.container.style.left=`${this.maxLeft}px`):i<this.minRight?this.container.style.width=`${c.minWidth}px`:i>this.maxRight&&(this.container.style.width=this.maxRight-r+"px"),o<this.minTop?(this.container.style.height=t+o-this.minTop+"px",this.container.style.top=`${this.minTop}px`):o>this.maxTop?(this.container.style.height=`${c.minHeight}px`,this.container.style.top=`${this.maxTop}px`):s<this.minBottom?this.container.style.height=`${c.minHeight}px`:s>this.maxBottom&&(this.container.style.height=this.maxBottom-o+"px"))}mouseup=e=>{e.preventDefault(),e.stopPropagation(),this.helper.options&&this.helper.options.onResizeEnd&&this.helper.options.onResizeEnd(),this.unbindUp(),this.unbindMove(),this.unbindUp=this.unbindMove=void 0};createHandleElement(){const e=document.createElement("div"),t=e.style;return t.position="absolute",this.applyStyle(t),this.container.appendChild(e),e}}function Jn(n,e,t){return n<e?e:n>t?t:n}Wr.push(class extends ke{setPosition(n){this.container.style.width=this.width0+n.clientX-this.x0+"px",this.container.style.height=this.height0+n.clientY-this.y0+"px"}applyStyle(n){n.width=2*this.handleSize+"px",n.height=2*this.handleSize+"px",n.right=-this.handleSize+"px",n.bottom=-this.handleSize+"px",n.cursor="nwse-resize"}},class extends ke{setPosition(n){this.container.style.height=this.height0+n.clientY-this.y0+"px"}applyStyle(n){n.right=`${this.handleSize}px`,n.left=`${this.handleSize}px`,n.height=2*this.handleSize+"px",n.bottom=-this.handleSize+"px",n.cursor="ns-resize"}},class extends ke{setPosition(n){this.container.style.left=this.left0+n.clientX-this.x0+"px",this.container.style.width=this.width0-(n.clientX-this.x0)+"px",this.container.style.height=this.height0+n.clientY-this.y0+"px"}applyStyle(n){n.left=-this.handleSize+"px",n.bottom=-this.handleSize+"px",n.width=2*this.handleSize+"px",n.height=2*this.handleSize+"px",n.cursor="nesw-resize"}},class extends ke{setPosition(n){this.container.style.left=this.left0+n.clientX-this.x0+"px",this.container.style.width=this.width0-(n.clientX-this.x0)+"px"}applyStyle(n){n.left=-this.handleSize+"px",n.bottom=`${this.handleSize}px`,n.width=2*this.handleSize+"px",n.top=`${this.handleSize}px`,n.cursor="ew-resize"}},class extends ke{setPosition(n){this.container.style.left=this.left0+n.clientX-this.x0+"px",this.container.style.width=this.width0-(n.clientX-this.x0)+"px",this.container.style.top=this.top0+n.clientY-this.y0+"px",this.container.style.height=this.height0-(n.clientY-this.y0)+"px"}applyStyle(n){n.left=-this.handleSize+"px",n.top=-this.handleSize+"px",n.width=2*this.handleSize+"px",n.height=2*this.handleSize+"px",n.cursor="nwse-resize"}},class extends ke{setPosition(n){this.container.style.top=this.top0+n.clientY-this.y0+"px",this.container.style.height=this.height0-(n.clientY-this.y0)+"px"}applyStyle(n){n.left=`${this.handleSize}px`,n.right=`${this.handleSize}px`,n.height=2*this.handleSize+"px",n.top=-this.handleSize+"px",n.cursor="ns-resize"}},class extends ke{setPosition(n){this.container.style.top=this.top0+n.clientY-this.y0+"px",this.container.style.height=this.height0-(n.clientY-this.y0)+"px",this.container.style.width=this.width0+n.clientX-this.x0+"px"}applyStyle(n){n.right=-this.handleSize+"px",n.top=-this.handleSize+"px",n.height=2*this.handleSize+"px",n.width=2*this.handleSize+"px",n.cursor="nesw-resize"}},class extends ke{setPosition(n){this.container.style.width=this.width0+n.clientX-this.x0+"px"}applyStyle(n){n.right=-this.handleSize+"px",n.top=`${this.handleSize}px`,n.bottom=`${this.handleSize}px`,n.width=2*this.handleSize+"px",n.cursor="ew-resize"}});var vt=Be({name:"",props:{disabled:{type:Boolean,default:!1},windowStyle:{type:Object,required:!0}},components:{},setup(n){const e=Y(!1),t=Y(!1);return{hover:e,active:t,style:function(){let r=n.windowStyle.button;return e.value&&(r={...r,...this.windowStyle.buttonHover}),t.value&&(r={...r,...this.windowStyle.buttonActive}),r},mouseup:function(r){this.active&&this.$emit("click")},mousedown:function(r){r.preventDefault(),t.value=!0;const o=ue.bindUp(document,()=>{t.value=!1,o()})}}}});const _i=["disabled"];vt.render=function(n,e,t,r,o,i){return X(),pe("div",{class:"btn",style:ve(n.style()),onMouseenter:e[0]||(e[0]=s=>n.hover=!0),onMouseleave:e[1]||(e[1]=s=>n.hover=!1),onMousedown:e[2]||(e[2]=Vn((...s)=>n.mousedown&&n.mousedown(...s),["stop"])),onTouchstart:e[3]||(e[3]=Vn((...s)=>n.mousedown&&n.mousedown(...s),["stop"])),onMouseup:e[4]||(e[4]=(...s)=>n.mouseup&&n.mouseup(...s)),onTouchend:e[5]||(e[5]=(...s)=>n.mouseup&&n.mouseup(...s)),disabled:n.disabled},[ae(n.$slots,"default")],44,_i)},vt.__scopeId="data-v-71662210",vt.__file="src/controls/vuewindow/window/Button.vue";var $e=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Tt(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Gn,Qn={exports:{}},bi=(Gn||(Gn=1,Qn.exports=function(n){var e=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function t(f,l){var v=f[0],m=f[1],p=f[2],y=f[3];m=((m+=((p=((p+=((y=((y+=((v=((v+=(m&p|~m&y)+l[0]-680876936|0)<<7|v>>>25)+m|0)&m|~v&p)+l[1]-389564586|0)<<12|y>>>20)+v|0)&v|~y&m)+l[2]+606105819|0)<<17|p>>>15)+y|0)&y|~p&v)+l[3]-1044525330|0)<<22|m>>>10)+p|0,m=((m+=((p=((p+=((y=((y+=((v=((v+=(m&p|~m&y)+l[4]-176418897|0)<<7|v>>>25)+m|0)&m|~v&p)+l[5]+1200080426|0)<<12|y>>>20)+v|0)&v|~y&m)+l[6]-1473231341|0)<<17|p>>>15)+y|0)&y|~p&v)+l[7]-45705983|0)<<22|m>>>10)+p|0,m=((m+=((p=((p+=((y=((y+=((v=((v+=(m&p|~m&y)+l[8]+1770035416|0)<<7|v>>>25)+m|0)&m|~v&p)+l[9]-1958414417|0)<<12|y>>>20)+v|0)&v|~y&m)+l[10]-42063|0)<<17|p>>>15)+y|0)&y|~p&v)+l[11]-1990404162|0)<<22|m>>>10)+p|0,m=((m+=((p=((p+=((y=((y+=((v=((v+=(m&p|~m&y)+l[12]+1804603682|0)<<7|v>>>25)+m|0)&m|~v&p)+l[13]-40341101|0)<<12|y>>>20)+v|0)&v|~y&m)+l[14]-1502002290|0)<<17|p>>>15)+y|0)&y|~p&v)+l[15]+1236535329|0)<<22|m>>>10)+p|0,m=((m+=((p=((p+=((y=((y+=((v=((v+=(m&y|p&~y)+l[1]-165796510|0)<<5|v>>>27)+m|0)&p|m&~p)+l[6]-1069501632|0)<<9|y>>>23)+v|0)&m|v&~m)+l[11]+643717713|0)<<14|p>>>18)+y|0)&v|y&~v)+l[0]-373897302|0)<<20|m>>>12)+p|0,m=((m+=((p=((p+=((y=((y+=((v=((v+=(m&y|p&~y)+l[5]-701558691|0)<<5|v>>>27)+m|0)&p|m&~p)+l[10]+38016083|0)<<9|y>>>23)+v|0)&m|v&~m)+l[15]-660478335|0)<<14|p>>>18)+y|0)&v|y&~v)+l[4]-405537848|0)<<20|m>>>12)+p|0,m=((m+=((p=((p+=((y=((y+=((v=((v+=(m&y|p&~y)+l[9]+568446438|0)<<5|v>>>27)+m|0)&p|m&~p)+l[14]-1019803690|0)<<9|y>>>23)+v|0)&m|v&~m)+l[3]-187363961|0)<<14|p>>>18)+y|0)&v|y&~v)+l[8]+1163531501|0)<<20|m>>>12)+p|0,m=((m+=((p=((p+=((y=((y+=((v=((v+=(m&y|p&~y)+l[13]-1444681467|0)<<5|v>>>27)+m|0)&p|m&~p)+l[2]-51403784|0)<<9|y>>>23)+v|0)&m|v&~m)+l[7]+1735328473|0)<<14|p>>>18)+y|0)&v|y&~v)+l[12]-1926607734|0)<<20|m>>>12)+p|0,m=((m+=((p=((p+=((y=((y+=((v=((v+=(m^p^y)+l[5]-378558|0)<<4|v>>>28)+m|0)^m^p)+l[8]-2022574463|0)<<11|y>>>21)+v|0)^v^m)+l[11]+1839030562|0)<<16|p>>>16)+y|0)^y^v)+l[14]-35309556|0)<<23|m>>>9)+p|0,m=((m+=((p=((p+=((y=((y+=((v=((v+=(m^p^y)+l[1]-1530992060|0)<<4|v>>>28)+m|0)^m^p)+l[4]+1272893353|0)<<11|y>>>21)+v|0)^v^m)+l[7]-155497632|0)<<16|p>>>16)+y|0)^y^v)+l[10]-1094730640|0)<<23|m>>>9)+p|0,m=((m+=((p=((p+=((y=((y+=((v=((v+=(m^p^y)+l[13]+681279174|0)<<4|v>>>28)+m|0)^m^p)+l[0]-358537222|0)<<11|y>>>21)+v|0)^v^m)+l[3]-722521979|0)<<16|p>>>16)+y|0)^y^v)+l[6]+76029189|0)<<23|m>>>9)+p|0,m=((m+=((p=((p+=((y=((y+=((v=((v+=(m^p^y)+l[9]-640364487|0)<<4|v>>>28)+m|0)^m^p)+l[12]-421815835|0)<<11|y>>>21)+v|0)^v^m)+l[15]+530742520|0)<<16|p>>>16)+y|0)^y^v)+l[2]-995338651|0)<<23|m>>>9)+p|0,m=((m+=((y=((y+=(m^((v=((v+=(p^(m|~y))+l[0]-198630844|0)<<6|v>>>26)+m|0)|~p))+l[7]+1126891415|0)<<10|y>>>22)+v|0)^((p=((p+=(v^(y|~m))+l[14]-1416354905|0)<<15|p>>>17)+y|0)|~v))+l[5]-57434055|0)<<21|m>>>11)+p|0,m=((m+=((y=((y+=(m^((v=((v+=(p^(m|~y))+l[12]+1700485571|0)<<6|v>>>26)+m|0)|~p))+l[3]-1894986606|0)<<10|y>>>22)+v|0)^((p=((p+=(v^(y|~m))+l[10]-1051523|0)<<15|p>>>17)+y|0)|~v))+l[1]-2054922799|0)<<21|m>>>11)+p|0,m=((m+=((y=((y+=(m^((v=((v+=(p^(m|~y))+l[8]+1873313359|0)<<6|v>>>26)+m|0)|~p))+l[15]-30611744|0)<<10|y>>>22)+v|0)^((p=((p+=(v^(y|~m))+l[6]-1560198380|0)<<15|p>>>17)+y|0)|~v))+l[13]+1309151649|0)<<21|m>>>11)+p|0,m=((m+=((y=((y+=(m^((v=((v+=(p^(m|~y))+l[4]-145523070|0)<<6|v>>>26)+m|0)|~p))+l[11]-1120210379|0)<<10|y>>>22)+v|0)^((p=((p+=(v^(y|~m))+l[2]+718787259|0)<<15|p>>>17)+y|0)|~v))+l[9]-343485551|0)<<21|m>>>11)+p|0,f[0]=v+f[0]|0,f[1]=m+f[1]|0,f[2]=p+f[2]|0,f[3]=y+f[3]|0}function r(f){var l,v=[];for(l=0;l<64;l+=4)v[l>>2]=f.charCodeAt(l)+(f.charCodeAt(l+1)<<8)+(f.charCodeAt(l+2)<<16)+(f.charCodeAt(l+3)<<24);return v}function o(f){var l,v=[];for(l=0;l<64;l+=4)v[l>>2]=f[l]+(f[l+1]<<8)+(f[l+2]<<16)+(f[l+3]<<24);return v}function i(f){var l,v,m,p,y,P,A=f.length,T=[1732584193,-271733879,-1732584194,271733878];for(l=64;l<=A;l+=64)t(T,r(f.substring(l-64,l)));for(v=(f=f.substring(l-64)).length,m=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l=0;l<v;l+=1)m[l>>2]|=f.charCodeAt(l)<<(l%4<<3);if(m[l>>2]|=128<<(l%4<<3),l>55)for(t(T,m),l=0;l<16;l+=1)m[l]=0;return p=(p=8*A).toString(16).match(/(.*?)(.{0,8})$/),y=parseInt(p[2],16),P=parseInt(p[1],16)||0,m[14]=y,m[15]=P,t(T,m),T}function s(f){var l,v,m,p,y,P,A=f.length,T=[1732584193,-271733879,-1732584194,271733878];for(l=64;l<=A;l+=64)t(T,o(f.subarray(l-64,l)));for(v=(f=l-64<A?f.subarray(l-64):new Uint8Array(0)).length,m=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l=0;l<v;l+=1)m[l>>2]|=f[l]<<(l%4<<3);if(m[l>>2]|=128<<(l%4<<3),l>55)for(t(T,m),l=0;l<16;l+=1)m[l]=0;return p=(p=8*A).toString(16).match(/(.*?)(.{0,8})$/),y=parseInt(p[2],16),P=parseInt(p[1],16)||0,m[14]=y,m[15]=P,t(T,m),T}function c(f){var l,v="";for(l=0;l<4;l+=1)v+=e[f>>8*l+4&15]+e[f>>8*l&15];return v}function d(f){var l;for(l=0;l<f.length;l+=1)f[l]=c(f[l]);return f.join("")}function g(f){return/[\u0080-\uFFFF]/.test(f)&&(f=unescape(encodeURIComponent(f))),f}function S(f,l){var v,m=f.length,p=new ArrayBuffer(m),y=new Uint8Array(p);for(v=0;v<m;v+=1)y[v]=f.charCodeAt(v);return l?y:p}function k(f){return String.fromCharCode.apply(null,new Uint8Array(f))}function W(f,l,v){var m=new Uint8Array(f.byteLength+l.byteLength);return m.set(new Uint8Array(f)),m.set(new Uint8Array(l),f.byteLength),m}function N(f){var l,v=[],m=f.length;for(l=0;l<m-1;l+=2)v.push(parseInt(f.substr(l,2),16));return String.fromCharCode.apply(String,v)}function D(){this.reset()}return d(i("hello")),typeof ArrayBuffer>"u"||ArrayBuffer.prototype.slice||function(){function f(l,v){return(l=0|l||0)<0?Math.max(l+v,0):Math.min(l,v)}ArrayBuffer.prototype.slice=function(l,v){var m,p,y,P,A=this.byteLength,T=f(l,A),L=A;return v!==n&&(L=f(v,A)),T>L?new ArrayBuffer(0):(m=L-T,p=new ArrayBuffer(m),y=new Uint8Array(p),P=new Uint8Array(this,T,m),y.set(P),p)}}(),D.prototype.append=function(f){return this.appendBinary(g(f)),this},D.prototype.appendBinary=function(f){this._buff+=f,this._length+=f.length;var l,v=this._buff.length;for(l=64;l<=v;l+=64)t(this._hash,r(this._buff.substring(l-64,l)));return this._buff=this._buff.substring(l-64),this},D.prototype.end=function(f){var l,v,m=this._buff,p=m.length,y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(l=0;l<p;l+=1)y[l>>2]|=m.charCodeAt(l)<<(l%4<<3);return this._finish(y,p),v=d(this._hash),f&&(v=N(v)),this.reset(),v},D.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},D.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},D.prototype.setState=function(f){return this._buff=f.buff,this._length=f.length,this._hash=f.hash,this},D.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},D.prototype._finish=function(f,l){var v,m,p,y=l;if(f[y>>2]|=128<<(y%4<<3),y>55)for(t(this._hash,f),y=0;y<16;y+=1)f[y]=0;v=(v=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),m=parseInt(v[2],16),p=parseInt(v[1],16)||0,f[14]=m,f[15]=p,t(this._hash,f)},D.hash=function(f,l){return D.hashBinary(g(f),l)},D.hashBinary=function(f,l){var v=d(i(f));return l?N(v):v},D.ArrayBuffer=function(){this.reset()},D.ArrayBuffer.prototype.append=function(f){var l,v=W(this._buff.buffer,f),m=v.length;for(this._length+=f.byteLength,l=64;l<=m;l+=64)t(this._hash,o(v.subarray(l-64,l)));return this._buff=l-64<m?new Uint8Array(v.buffer.slice(l-64)):new Uint8Array(0),this},D.ArrayBuffer.prototype.end=function(f){var l,v,m=this._buff,p=m.length,y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(l=0;l<p;l+=1)y[l>>2]|=m[l]<<(l%4<<3);return this._finish(y,p),v=d(this._hash),f&&(v=N(v)),this.reset(),v},D.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},D.ArrayBuffer.prototype.getState=function(){var f=D.prototype.getState.call(this);return f.buff=k(f.buff),f},D.ArrayBuffer.prototype.setState=function(f){return f.buff=S(f.buff,!0),D.prototype.setState.call(this,f)},D.ArrayBuffer.prototype.destroy=D.prototype.destroy,D.ArrayBuffer.prototype._finish=D.prototype._finish,D.ArrayBuffer.hash=function(f,l){var v=d(s(new Uint8Array(f)));return l?N(v):v},D}()),Qn.exports),Kt=Tt(bi);const $r=Object.prototype.toString;function Rt(n,e){return $r.call(n)===`[object ${e}]`}function Si(n){return Rt(n,"Function")}const Mt=n=>n!=null&&n!==null&&Rt(n,"Object");function Zn(n){return Rt(n,"Number")}function yt(n){return Rt(n,"String")}function Ci(n){return n&&Array.isArray(n)}const Ei=n=>$r.call(n).startsWith("[object HTML")&&!!n.tagName,ki=n=>/^(https?|ftp):\/\/([a-zA-Z0-9.-]+(:[a-zA-Z0-9.&%$-]+)*@)*((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])){3}|([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+\.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{2}))(:[0-9]+)*(\/($|[a-zA-Z0-9.,?'\\+&%$#=~_-]+))*$/.test(n);function xi(n){return/^\s*[{[]/.test(String(n))}function Ii(n){return n.includes("<kml ")&&n.includes('xmlns="http://www.opengis.net/kml/')}const Vt=[];let ot;class se{static addHandler(e,t,r){e.addEventListener?e.addEventListener(t,r,!1):e.attachEvent?e.attachEvent("on"+t,r):e["on"+t]=r}static removeHandler(e,t,r){e.removeEventListener?e.removeEventListener(t,r,!1):e.detachEvent?e.detachEvent("on"+t,r):delete e["on"+t]}static windowResizeHandler(e){se.addHandler(window,"resize",e)}static offWindowResizeHandler(e){se.removeHandler(window,"resize",e)}static fullscreenEnabled(){const e=window.document;return document.fullscreenEnabled||window.fullScreen||e.mozFullscreenEnabled||e.webkitIsFullScreen}static fullScreen(e,t){if(t){const r=window.document;let o=window.document.exitFullscreen||r.msExitFullscreen||r.mozCancelFullScreen||r.webkitCancelFullScreen;typeof o<"u"&&o?o.call(window.document):typeof window.ActiveXObject<"u"&&new window.ActiveXObject("WScript.Shell")?.SendKeys("{F11}")}else{let r=e;r||(r=window.document.documentElement);let o=r.requestFullScreen||r.webkitRequestFullScreen||r.mozRequestFullScreen||r.msRequestFullScreen;typeof o<"u"&&o?o.call(r):typeof window.ActiveXObject<"u"&&new window.ActiveXObject("WScript.Shell")?.SendKeys("{F11}")}}static requestFullScreen(e=window.document.documentElement){let t=e;var r=t.requestFullScreen||t.webkitRequestFullScreen||t.mozRequestFullScreen||t.msRequestFullScreen;if(r)r.call(t);else if(typeof window.ActiveXObject<"u"){var o=new window.ActiveXObject("WScript.Shell");o!==null&&o.SendKeys("{F11}")}}static exitFullScreen(){const e=window.document;var t=document.exitFullscreen||e.mozCancelFullScreen||e.webkitExitFullscreen||e.webkitExitFullscreen;if(t)t.call(document);else if(typeof window.ActiveXObject<"u"){var r=new window.ActiveXObject("WScript.Shell");r!==null&&r.SendKeys("{F11}")}}static fullScreenElement(){return window.document.fullscreenElement||window.document.webkitFullscreenElement||window.document.mozFullscreenElement||window.document.msFullscreenElement}static isFullScreen(){return!!se.fullScreenElement()}static onFullScreenChanged(e){let t;"onfullscreenchange"in window.document?t="fullscreenchange":"onwebkitfullscreenchange"in window.document?t="webkitfullscreenchange":"onmozfullscreenchange"in window.document&&(t="mozfullscreenchange"),t?document.addEventListener(t,function(){const r=se.isFullScreen();e(r)}):document.addEventListener("MSFullscreenChange",function(){const r=se.isFullScreen();e(r)})}static stringifyCircularHandler(e,t){if(typeof t=="object"&&t!==null){if(Vt.indexOf(t)!==-1)return;Vt.push(t)}return t}static jsonStringify(e){if(!e)return"";const t=JSON.stringify(e,se.stringifyCircularHandler);return Vt.length=0,t}static jsonParse(e){const t=se.jsonStringify(e);if(t.length>1)return JSON.parse(t)}static getObjectURL(e){let t;const r=window;return r.createObjcectURL!=null?t=r.createOjcectURL(e):window.URL!=null?t=window.URL.createObjectURL(e):window.webkitURL!=null&&(t=window.webkitURL.createObjectURL(e)),t}static getFileShortMD5(e,t){const r=File.prototype,o=r.slice||r.mozSlice||r.webkitSlice,i=e,s=2097152,c=new Kt.ArrayBuffer,d=new FileReader;d.onload=function(g){c.append(g.target?.result);const S=c.end();t({isOK:!0,data:S})},d.onerror=function(){t({isOK:!1,data:"计算文件简单摘要错误！"})},function(){const g=0+s>=i.size?i.size:0+s;d.readAsArrayBuffer(o.call(i,0,g))}()}static getFileMD5(e,t){const r=File.prototype,o=r.slice||r.mozSlice||r.webkitSlice,i=e,s=2097152,c=Math.ceil(i.size/s);let d=0;const g=new Kt.ArrayBuffer,S=new FileReader;function k(){const W=d*s,N=W+s>=i.size?i.size:W+s;S.readAsArrayBuffer(o.call(i,W,N))}S.onload=function(W){if(g.append(W.target?.result),d++,d<c)k();else{const N=g.end();t({isOK:!0,data:N})}},S.onerror=function(){const W=`${i.name}:计算文件简单摘要错误！`;t({isOK:!1,data:W})},k()}static MD5(e,t=!1){return Kt.hash(e,t)}static copyTextByCommand(e){return new Promise((t,r)=>{const o=document.createElement("input");o.value=e,document.body.appendChild(o),o.select(),document.execCommand("copy"),o.remove(),t(!0)})}static copyText=e=>navigator.clipboard?navigator.clipboard.writeText(e).then(function(){return!0},function(t){return!1}):se.copyTextByCommand(e);static copyElementTextByCommand(e){const t=document.createRange();t.selectNode(document.getElementById(e));const r=window.getSelection();r.rangeCount>0&&r.removeAllRanges(),r.addRange(t);try{return document.execCommand("copy"),r.removeRange(t),!0}catch{return r.removeRange(t),!1}}static copyElementText(e){if(!navigator.clipboard)return se.copyElementTextByCommand(e);const t=document.createRange();t.selectNode(document.getElementById(e));const r=window.getSelection();return r.rangeCount>0&&r.removeAllRanges(),r.addRange(t),navigator.clipboard.writeText(r).then(function(){return r.removeRange(t),!0},function(o){return r.removeRange(t),!1})}static setGrayMode(e){se.toggleClass(e,"grayMode",document.documentElement)}static toggleClass(e,t,r){const o=r||document.body;let{className:i}=o;i=i.replace(t,""),o.className=e?`${i} ${t} `:i}static setCssVar(e,t,r=document.documentElement){r.style.setProperty(e,t)}static dispatchWindowResize(){const e=new Event("resize");window.dispatchEvent(e)}static dispatchElementEvent(e,t="click",r){let o;if(o=yt(e)?document.getElementById(e):e,o){const i=new Event(t,{bubbles:!0,cancelable:!0});r&&o.addEventListener("ev",s=>{r(s)},!1),o.dispatchEvent(i)}}static getRandomNum(e,t){var r=t-e,o=Math.random();return e+Math.round(o*r)}static merge(e={},t={}){let r,o,i,s;for(e||(e={}),o=0,i=t.length;o<i;o++)for(r in s=t[o],s)e[r]=s[r];return e}static setOptions(e,t){e.hasOwnProperty("options")||(e.options=e.options?Object.create(e.options):{});for(let r in t)e.options[r]=t[r];return e.options}static formatNum(e,t){let r=Math.pow(10,t===void 0?6:t);return Math.round(e*r)/r}static trim(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}static splitWords(e){return this.trim(e).split(/\s+/)}static emptyImageUrl(){return"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="}static debounce(e,t){let r=null;return function(){r&&clearTimeout(r),r=setTimeout(e,t)}}static throttle(e,t){let r=!0;return function(){if(!r)return!1;r=!1,setTimeout(()=>{e(),r=!0},t)}}static dataURLtoBlob(e){let t=e.split(",");if(!t||t.length===0)return;let r=t[0].match(/:(.*?);/)[1],o=atob(t[1]),i=o.length,s=new Uint8Array(i);for(;i--;)s[i]=o.charCodeAt(i);return new Blob([s],{type:r})}static getElement(e){return typeof e=="string"?document.getElementById(e):e}static getStyle(e,t){let r=e.style[t]||e.currentStyle&&e.currentStyle[t];if((!r||r==="auto")&&document.defaultView){let o=document.defaultView.getComputedStyle(e,null);r=o?o[t]:null}return r==="auto"?null:r}static create(e,t,r){let o=document.createElement(e);return o.className=t||"",r&&r.appendChild(o),o}static removeElement(e){let t=e.parentNode;t&&t.removeChild(e)}static emptyElement(e){for(;e.firstChild;)e.removeChild(e.firstChild)}static hasClass(e,t){if(e.classList!==void 0)return e.classList.contains(t);let r=this.getClass(e);return r.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(r)}static addClass(e,t){if(e.classList!==void 0){let r=this.splitWords(t);for(let o=0,i=r.length;o<i;o++)e.classList.add(r[o])}else if(!this.hasClass(e,t)){let r=this.getClass(e);this.setClass(e,(r?r+" ":"")+t)}}static removeClass(e,t){e.classList!==void 0?e.classList.remove(t):this.setClass(e,this.trim((" "+this.getClass(e)+" ").replace(" "+t+" "," ")))}static setClass(e,t){e.className.baseVal===void 0?e.className=t:e.className.baseVal=t}static getClass(e){return e.correspondingElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}static createSvgElement(e,t,r,o){let i=document.createElementNS("http://www.w3.org/2000/svg","svg:svg");i.setAttribute("class","svg-path"),i.setAttribute("width",e),i.setAttribute("height",t),i.setAttribute("viewBox",`0 0 ${e} ${t}`);let s=document.createElementNS("http://www.w3.org/2000/svg","path");return s.setAttribute("d",r),i.appendChild(s),o&&o.appendChild(i),i}static parseDom(e,t=!0,r=""){t=t??!1;let o=document.createElement("div");return o.className=r||"",o.innerHTML=e,t?o:o.childNodes}static createVideoHTML(e,t,r){let o=this.create("video",t,r),i=this.create("source","",o);i.setAttribute("src",e),i.setAttribute("type","video/map4");let s=this.create("source","",o);return s.setAttribute("src",e),s.setAttribute("type","video/quicktime"),o}static readFilePromise(e,t="ArrayBuffer",r="UTF-8"){return new Promise((o,i)=>{const s=new FileReader;switch(t){case"ArrayBuffer":s.readAsArrayBuffer(e);break;case"Text":s.readAsText(e,r);break;case"BinaryString":s.readAsBinaryString(e);break;case"DataURL":case"FileBytes":s.readAsDataURL(e)}s.onload=function(){if(s.result)if(t==="FileBytes"){const c=s.result,d=c.indexOf("64,"),g=c.substring(d+3);o(g)}else o(s.result);else i(s)},s.onerror=function(){i(s)}})}static readFileBytes(e){return this.readFilePromise(e,"FileBytes")}static promisify(e,...t){return function(){return new Promise((r,o)=>{t.push(function(i,s){i?o(i):r(s)}),e.apply(this,t)})}}static wait(e){return new Promise(t=>setTimeout(t,e))}static blockEvent(e){e.preventDefault(),e.stopPropagation()}static bindDropFileHanlder(e,t){if(!e)throw Error("传入Element对象不能为空！");let r;if(yt(e)){let o=document.getElementById(e);if(o)r=o;else{const i=document.getElementsByClassName(e);if(!i||i.length==0)throw Error("未找到对应id或类名的HtmlElement对象！");o=i[0],r=o}}else{if(!Ei(e))throw Error("ele参数只能为string 或 Element对象！");r=e}r&&(r.addEventListener("dragenter",this.blockEvent,!1),r.addEventListener("dragover",this.blockEvent,!1),r.addEventListener("drop",function(o){se.blockEvent(o),t(o.dataTransfer.files)},!1))}static getInputElement(){var e=document.activeElement;return!e||e.tagName!="INPUT"&&e.contentEditable!="true"?null:e}static guessPasteTextToFileName(e,t){let r,o=t;return yt(e)?o=(xi(e)?"json":Ii(e)&&"kml")||"text":(Mt(e)&&e.type||Ci(e))&&(o="json"),o=="text"?r="pasted.txt":o=="kml"?r="pasted.kml":o=="json"&&(r="pasted.json"),r}static pasteEventHanlder(e,t){const r=this;if(r.getInputElement())return;r.blockEvent(e);const o=e.clipboardData,i=Array.from(o.types||[]).join(","),s=Array.from(o.items||[]);let c;if(i.includes("text/plain")){const d=o.getData("text/plain");if(d[1]===":"||ki(d))return t(d);const g=r.guessPasteTextToFileName(d);if(!g||g==="pasted.txt")return t(d);{const S=new Blob([d]);c=[new File([S],g)]}}else c=s.map(function(d){return d.kind=="file"?d.getAsFile():null});c=c.filter(Boolean),c.length?t(c):t(void 0)}static onPasteHandler(e){const t=this;ot=r=>{t.pasteEventHanlder(r,e)},se.addHandler(document,"paste",ot)}static offPasteHandler(){ot&&se.removeHandler(document,"paste",ot)}}class jr{static isNullOrEmpty=e=>e===null||e===""||e===void 0||e.length===0;static isNotEmpty=e=>!(e===null||e===""||e===void 0||e.length===0);static toHump(e){return e.replace(/[\-\/\_](\w)/g,(t,r)=>r.toUpperCase()).replace("views","")}static getFileName(e){const t=e.lastIndexOf("/")+1;let r=e.substring(t);return r=decodeURI(r.split("?")[0]),r}}class Hr{prefixKey;storage;constructor(e="",t=localStorage){this.prefixKey=e,this.storage=t}getKey(e){return`${this.prefixKey}${e}`.toUpperCase()}set(e,t,r=604800){const o=JSON.stringify({value:t,expire:r!==null?new Date().getTime()+1e3*r:null});this.storage.setItem(this.getKey(e),o)}get(e,t=null){const r=this.storage.getItem(this.getKey(e));if(r)try{const o=JSON.parse(r),{value:i,expire:s}=o;if(s===null||s>=Date.now())return i;this.remove(this.getKey(e))}catch{return t}return t}getJsonObject(e){const t=this.storage.getItem(this.getKey(e));if(t)try{const r=JSON.parse(t);if(r.expire===null||r.expire>=Date.now())return r;this.remove(this.getKey(e))}catch{return}}remove(e){this.storage.removeItem(this.getKey(e))}clear(){this.storage.clear()}setCookie(e,t,r=604800){document.cookie=`${this.getKey(e)}=${t}; Max-Age=${r}`}getCookie(e){const t=document.cookie.split("; ");for(let r=0,o=t.length;r<o;r++){const i=t[r].split("=");if(i[0]===this.getKey(e))return i[1]}return""}removeCookie(e){this.setCookie(e,1,-1)}clearCookie(){const e=document.cookie.match(/[^ =;]+(?==)/g);if(e)for(let t=e.length;t--;)document.cookie=e[t]+"=0;expire="+new Date(0).toUTCString()}}function Ti(){let n=[];const e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";for(var t=0;t<36;t++){const o=Math.floor(16*Math.random());n[t]=e.substring(o,o+1)}n[14]="4";const r=3&Number(n[19])|8;return n[19]=e.substring(r,r+1),n[8]=n[13]=n[18]=n[23]="-",n.join("")}var et=Uint8Array,je=Uint16Array,Ri=Int32Array,Mi=new et([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Di=new et([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ur=function(n,e){for(var t=new je(31),r=0;r<31;++r)t[r]=e+=1<<n[r-1];var o=new Ri(t[30]);for(r=1;r<30;++r)for(var i=t[r];i<t[r+1];++i)o[i]=i-t[r]<<5|r;return{b:t,r:o}},zr=Ur(Mi,2),Li=zr.b,Ai=zr.r;Li[28]=258,Ai[258]=28;for(var er=Ur(Di,0),Js=er.b,Gs=er.r,hn=new je(32768),J=0;J<32768;++J){var Ie=(43690&J)>>1|(21845&J)<<1;Ie=(61680&(Ie=(52428&Ie)>>2|(13107&Ie)<<2))>>4|(3855&Ie)<<4,hn[J]=((65280&Ie)>>8|(255&Ie)<<8)>>1}var Dt=function(n,e,t){for(var r=n.length,o=0,i=new je(e);o<r;++o)n[o]&&++i[n[o]-1];var s,c=new je(e);for(o=1;o<e;++o)c[o]=c[o-1]+i[o-1]<<1;if(t){s=new je(1<<e);var d=15-e;for(o=0;o<r;++o)if(n[o])for(var g=o<<4|n[o],S=e-n[o],k=c[n[o]-1]++<<S,W=k|(1<<S)-1;k<=W;++k)s[hn[k]>>d]=g}else for(s=new je(r),o=0;o<r;++o)n[o]&&(s[o]=hn[c[n[o]-1]++]>>15-n[o]);return s},qe=new et(288);for(J=0;J<144;++J)qe[J]=8;for(J=144;J<256;++J)qe[J]=9;for(J=256;J<280;++J)qe[J]=7;for(J=280;J<288;++J)qe[J]=8;var Sn=new et(32);for(J=0;J<32;++J)Sn[J]=5;Dt(qe,9,0);Dt(qe,9,1);Dt(Sn,5,0);Dt(Sn,5,1);var Pi=new et(0);(function(){for(var n=new Int32Array(256),e=0;e<256;++e){for(var t=e,r=9;--r;)t=(1&t&&-306674912)^t>>>1;n[e]=t}return n})();typeof TextEncoder<"u"&&new TextEncoder;var Bi=typeof TextDecoder<"u"&&new TextDecoder;try{Bi.decode(Pi,{stream:!0})}catch{}function Ni(n){return{all:n=n||new Map,on(e,t){const r=n.get(e);r?r.push(t):n.set(e,[t])},off(e,t){const r=n.get(e);r&&(t?r.splice(r.indexOf(t)>>>0,1):n.set(e,[]))},emit(e,t){let r=n.get(e);r&&r.slice().map(o=>{o(t)}),r=n.get("*"),r&&r.slice().map(o=>{o(e,t)})}}}const Je=Ni(),de={HproseServiceErrorEvent:"HproseServiceError",WebAPIErrorEvent:"WebAPIError",AlertInfoEvent:"AlertInfoEvent",CommonWarnEvent:"CommonWarnEvent",WidgetLoadedEvent:"WidgetLoaded",WidgetLoaded:"WidgetLoaded",WidgetToUnloadEvent:"WidgetToUnloadEvent",WidgetUnLoadedEvent:"WidgetUnLoaded",WidgetLoadedErrorEvent:"WidgetLoadedError",WidgetVisibleChanged:"WidgetVisibleChanged",AxiosRequestErrorEvent:"AxiosRequestErrorEvent",LayoutContainerLoaded:"LayoutContainerLoaded"},qr=(n,e)=>{Wi(n,e)};function Wi(n,e){const t=window.URL||window.webkitURL||window,r=new Blob([n]),o=t.createObjectURL(r),i=document.createElement("a");i.href=o,i.download=e,document.body.appendChild(i),i.click(),t.revokeObjectURL(o),setTimeout(function(){t.revokeObjectURL(o),document.body.removeChild(i)},400)}const $i=(n,e)=>{const t=JSON.stringify(n,null,2);qr(t,e+".json")},Qs=(n,e,t)=>{n.get(e,{responseType:"blob"}).then(function(r){qr(r.data,t)}).catch(r=>{Je.emit(de.CommonWarnEvent,"下载文件报错！")})};var tr;(function(n){n[n.RGBA=0]="RGBA",n[n.Hex=1]="Hex",n[n.Hsla=2]="Hsla"})(tr||(tr={}));var nr,Yt={exports:{}},rr,or,Jt,Gt=(nr||(nr=1,or=Yt.exports,Jt=function(){var n=function(){},e="undefined",t=typeof window!==e&&typeof window.navigator!==e&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],o={},i=null;function s(N,D){var f=N[D];if(typeof f.bind=="function")return f.bind(N);try{return Function.prototype.bind.call(f,N)}catch{return function(){return Function.prototype.apply.apply(f,[N,arguments])}}}function c(){console.log&&(console.log.apply||Function.prototype.apply.apply(console.log,[console,arguments]))}function d(){for(var N=this.getLevel(),D=0;D<r.length;D++){var f=r[D];this[f]=D<N?n:this.methodFactory(f,N,this.name)}if(this.log=this.debug,typeof console===e&&N<this.levels.SILENT)return"No console available for logging"}function g(N){return function(){typeof console!==e&&(d.call(this),this[N].apply(this,arguments))}}function S(N,D,f){return function(l){return l==="debug"&&(l="log"),typeof console!==e&&(l==="trace"&&t?c:console[l]!==void 0?s(console,l):console.log!==void 0?s(console,"log"):n)}(N)||g.apply(this,arguments)}function k(N,D){var f,l,v,m=this,p="loglevel";function y(){var T;if(typeof window!==e&&p){try{T=window.localStorage[p]}catch{}if(typeof T===e)try{var L=window.document.cookie,H=encodeURIComponent(p),U=L.indexOf(H+"=");U!==-1&&(T=/^([^;]+)/.exec(L.slice(U+H.length+1))[1])}catch{}return m.levels[T]===void 0&&(T=void 0),T}}function P(T){var L=T;if(typeof L=="string"&&m.levels[L.toUpperCase()]!==void 0&&(L=m.levels[L.toUpperCase()]),typeof L=="number"&&L>=0&&L<=m.levels.SILENT)return L;throw new TypeError("log.setLevel() called with invalid level: "+T)}typeof N=="string"?p+=":"+N:typeof N=="symbol"&&(p=void 0),m.name=N,m.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},m.methodFactory=D||S,m.getLevel=function(){return v??l??f},m.setLevel=function(T,L){return v=P(T),L!==!1&&function(H){var U=(r[H]||"silent").toUpperCase();if(typeof window!==e&&p){try{return void(window.localStorage[p]=U)}catch{}try{window.document.cookie=encodeURIComponent(p)+"="+U+";"}catch{}}}(v),d.call(m)},m.setDefaultLevel=function(T){l=P(T),y()||m.setLevel(T,!1)},m.resetLevel=function(){v=null,function(){if(typeof window!==e&&p){try{window.localStorage.removeItem(p)}catch{}try{window.document.cookie=encodeURIComponent(p)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}(),d.call(m)},m.enableAll=function(T){m.setLevel(m.levels.TRACE,T)},m.disableAll=function(T){m.setLevel(m.levels.SILENT,T)},m.rebuild=function(){if(i!==m&&(f=P(i.getLevel())),d.call(m),i===m)for(var T in o)o[T].rebuild()},f=P(i?i.getLevel():"WARN");var A=y();A!=null&&(v=P(A)),d.call(m)}(i=new k).getLogger=function(N){if(typeof N!="symbol"&&typeof N!="string"||N==="")throw new TypeError("You must supply a name when creating a logger.");var D=o[N];return D||(D=o[N]=new k(N,i.methodFactory)),D};var W=typeof window!==e?window.log:void 0;return i.noConflict=function(){return typeof window!==e&&window.log===i&&(window.log=W),i},i.getLoggers=function(){return o},i.default=i,i},(rr=Yt).exports?rr.exports=Jt():or.log=Jt()),Yt.exports);class Or{message;eventBus;constructor(e,t=void 0){e&&(this.message=e),t&&(this.eventBus=t)}msg(e,t=3,r="success"){if(this.message)if(typeof this.message=="function")this.message({type:r,message:e,duration:t});else switch(r){case"info":this.message.info(e,t);break;case"success":this.message.success(e,t);break;case"warning":this.message.warn?this.message.warn(e,t):this.message.warning&&this.message.warning(e,t);break;case"error":this.message.error(e,t)}else{switch(r){case"info":case"success":break;case"warning":break;case"error":r="dark"}this.eventBus&&this.eventBus.emit(de.AlertInfoEvent,{type:r,info:e})}}info(e,t=3){this.msg(e,t,"info")}warn(e,t=3){this.msg(e,t,"warning")}err(e,t=3){this.msg(e,t,"error")}success(e,t=3){this.msg(e,t,"success")}}let ir=!1;Function.prototype.promise=function(...n){const e=this;return function(){const t=n||[];return new Promise((r,o)=>{t.push(function(i,s){i?o(i):r(s)}),e.apply(e,n)})}()};const $={Config:SysConfig,EventBus:Je,DefaultProxyClient:null,Axios:fi,Message:new Or(void 0,Je),LayoutMap:new Map,getLayoutManager:n=>{if(!$.WidgetConfigList||$.WidgetConfigList.length===0)return;const e=$.WidgetConfigList.find(t=>t.id===n);if(e){const t=e.layoutID;if(t&&$.LayoutMap.has(t))return $.LayoutMap.get(t)}},Logger:n=>{ir||(SysConfig.UI.ProductLog?Gt.enableAll():Gt.setDefaultLevel("warn"),ir=!0);const e=n||"default";return Gt.getLogger(e)}},Fr="access_token",Ge=new Hr("user",localStorage);function Ue(){return Ge.get(Fr)}function Xr(){Ge.remove(Fr)}function ji(){return Ue()?.refresh}function Kr(n,e,t,r="json",o){const i={baseURL:$.Config.ServiceURL.DefaultWebAPI,timeout:6e4,params:n,paramsSerializer:{serialize:function(s){return gi.stringify(s,{indices:!1,arrayFormat:"repeat"})}},headers:{"Content-Type":"application/json",Authorization:"bearer "+Ue()?.token},responseType:r,cancelToken:o};return $.SystemID&&(i.headers.sysid=$.SystemID,$.SystemGroup&&(i.headers.sysgroup=$.SystemGroup)),e!==void 0&&(i.baseURL=e),i}function xe(n,e,t,r,o="json",i,s){const c=Kr(t,e,r,o,i);return $.Axios?.get(n,c).catch(function(d){Vr(d,c.baseURL,n,"Get")})}function Vr(n,e,t,r="Get"){const o=`${e}${t}`;if(n&&n.response){let i=!1;const s=n.response.status;switch(s){case 400:n.message="错误请求";break;case 401:n.message="未授权，请重新登录";break;case 403:n.message="拒绝访问";break;case 404:n.message="请求错误,未找到该资源";break;case 405:n.message="请求方法未允许";break;case 408:n.message="请求超时";break;case 500:const d=n.response.data;if(d){const g=d.indexOf(":"),S=d.indexOf(`
`);if(g>0&&S-g>2){const k=d.substring(g+2,S);k.indexOf("System.Exception")>0?n.message="后台服务内部出错！":(i=!0,n.message=k)}else i=!0,n.message=d}else n.message="服务器端出错";break;case 501:n.message="网络未实现";break;case 502:n.message="网络错误";break;case 503:n.message="服务不可用";break;case 504:n.message="网络超时";break;case 505:n.message="http版本不支持该请求";break;default:n.message=`连接错误${n.response.status}`}let c={address:o,code:s,isExceptionInfo:i,message:n.message,result:n.response.data};if($.EventBus.emit(de.AxiosRequestErrorEvent,c),i)throw new Error(n.message)}else if(n?.message)throw new Error(n.message)}function Hi(n,e,t,r,o,i="json",s){const c=Kr(r,e,o,i);return $.Axios?.post(n,t,c).catch(function(d){Vr(d,e,n,"Post")})}function Zs(n,e,t=!1){return n.startsWith("http")?xe("",n,e):t||e?xe(n,void 0,e):xe(n,"",void 0)}var sr,ar,Qt,cr,Zt,lr,en,ur,hr,it={exports:{}};function Ui(){return ar?sr:(ar=1,n=typeof window<"u"?window:$e!==void 0?$e:typeof self<"u"?self:{},sr=n);var n}function zi(){if(cr)return Qt;cr=1,Qt=function(e){if(!e)return!1;var t=n.call(e);return t==="[object Function]"||typeof e=="function"&&t!=="[object RegExp]"||typeof window<"u"&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)};var n=Object.prototype.toString;return Qt}function qi(){if(lr)return Zt;lr=1;var n=function(e){return e.replace(/^\s+|\s+$/g,"")};return Zt=function(e){if(!e)return{};for(var t,r={},o=n(e).split(`
`),i=0;i<o.length;i++){var s=o[i],c=s.indexOf(":"),d=n(s.slice(0,c)).toLowerCase(),g=n(s.slice(c+1));r[d]===void 0?r[d]=g:(t=r[d],Object.prototype.toString.call(t)==="[object Array]"?r[d].push(g):r[d]=[r[d],g])}return r},Zt}var Oi=function(){if(hr)return it.exports;hr=1;var n=Ui(),e=zi(),t=qi(),r=function(){if(ur)return en;ur=1,en=function(){for(var d={},g=0;g<arguments.length;g++){var S=arguments[g];for(var k in S)c.call(S,k)&&(d[k]=S[k])}return d};var c=Object.prototype.hasOwnProperty;return en}();function o(c,d,g){var S=c;return e(d)?(g=d,typeof c=="string"&&(S={uri:c})):S=r(d,{uri:c}),S.callback=g,S}function i(c,d,g){return s(d=o(c,d,g))}function s(c){if(c.callback===void 0)throw new Error("callback argument missing");var d=!1,g=function(L,H,U){d||(d=!0,c.callback(L,H,U))};function S(){var L=void 0;if(L=f.response?f.response:f.responseText||function(H){try{if(H.responseType==="document")return H.responseXML;var U=H.responseXML&&H.responseXML.documentElement.nodeName==="parsererror";if(H.responseType===""&&!U)return H.responseXML}catch{}return null}(f),A)try{L=JSON.parse(L)}catch{}return L}function k(L){return clearTimeout(l),L instanceof Error||(L=new Error(""+(L||"Unknown XMLHttpRequest Error"))),L.statusCode=0,g(L,T)}function W(){if(!D){var L;clearTimeout(l),L=c.useXDR&&f.status===void 0?200:f.status===1223?204:f.status;var H=T,U=null;return L!==0?(H={body:S(),statusCode:L,method:m,headers:{},url:v,rawRequest:f},f.getAllResponseHeaders&&(H.headers=t(f.getAllResponseHeaders()))):U=new Error("Internal XMLHttpRequest Error"),g(U,H,H.body)}}var N,D,f=c.xhr||null;f||(f=c.cors||c.useXDR?new i.XDomainRequest:new i.XMLHttpRequest);var l,v=f.url=c.uri||c.url,m=f.method=c.method||"GET",p=c.body||c.data,y=f.headers=c.headers||{},P=!!c.sync,A=!1,T={body:void 0,headers:{},statusCode:0,method:m,url:v,rawRequest:f};if("json"in c&&c.json!==!1&&(A=!0,y.accept||y.Accept||(y.Accept="application/json"),m!=="GET"&&m!=="HEAD"&&(y["content-type"]||y["Content-Type"]||(y["Content-Type"]="application/json"),p=JSON.stringify(c.json===!0?p:c.json))),f.onreadystatechange=function(){f.readyState===4&&setTimeout(W,0)},f.onload=W,f.onerror=k,f.onprogress=function(){},f.onabort=function(){D=!0},f.ontimeout=k,f.open(m,v,!P,c.username,c.password),P||(f.withCredentials=!!c.withCredentials),!P&&c.timeout>0&&(l=setTimeout(function(){if(!D){D=!0,f.abort("timeout");var L=new Error("XMLHttpRequest timeout");L.code="ETIMEDOUT",k(L)}},c.timeout)),f.setRequestHeader)for(N in y)y.hasOwnProperty(N)&&f.setRequestHeader(N,y[N]);else if(c.headers&&!function(L){for(var H in L)if(L.hasOwnProperty(H))return!1;return!0}(c.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in c&&(f.responseType=c.responseType),"beforeSend"in c&&typeof c.beforeSend=="function"&&c.beforeSend(f),f.send(p||null),f}return it.exports=i,it.exports.default=i,i.XMLHttpRequest=n.XMLHttpRequest||function(){},i.XDomainRequest="withCredentials"in new i.XMLHttpRequest?i.XMLHttpRequest:n.XDomainRequest,function(c,d){for(var g=0;g<c.length;g++)d(c[g])}(["get","put","post","patch","head","delete"],function(c){i[c==="delete"?"del":c]=function(d,g,S){return(g=o(d,g,S)).method=c.toUpperCase(),s(g)}}),it.exports}();Tt(Oi);const ea=new class{hasClass(n,e){return n.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)"))}addClass(n,e){this.hasClass(n,e)||(n.className+=" "+e)}removeClass(n,e){if(this.hasClass(n,e)){const t=new RegExp("(\\s|^)"+e+"(\\s|$)");n.className=n.className.replace(t," ")}}toggleClass(n,e){this.hasClass(n,e)?this.removeClass(n,e):this.addClass(n,e)}setCSSProperty(n,e,t){n?.style.setProperty(e,t)}};class bt{hproseURL;client;hproseProxy;static httpTransport;constructor(e){if(e&&!jr.isNullOrEmpty(e)){if(bt.httpTransport||(bt.httpTransport=new pi.HttpTransport),this.client=new ft.Client(e),!this.client)throw Error("Hprose Client初始化错误");this.hproseURL=e,this.init()}}init(){this.client&&this.client.useServiceAsync().then(e=>{this.hproseProxy=e}).catch(e=>{String(e).indexOf("find this method ~")>0?this.hproseProxy=this.client?.useService():Je.emit(de.HproseServiceErrorEvent,"初始化默认Hprose!")})}async getProxy(){if(!this.hproseProxy)try{this.client&&(this.hproseProxy=await this.client.useServiceAsync())}catch{this.hproseProxy=this.client?.useService()}return this.hproseProxy}async invoke(e,t,r){if(this.client)return await this.client.invoke(e,t,r)}encode(e,t,r){if(this.client)return this.client.codec.encode(e,t,r)}decode(e,t){if(this.client)return this.client.codec.decode(e,t)}}class dn{hproseClient;hpProxyObj;defaultContext=new ft.ClientContext;constructor(e){this.hproseClient=new bt(e),this.hpProxyObj=null}getClientContext(e,t){const r={};t&&(r.requestHeaders=t);const o=Ue();r.httpRequestHeaders=e||{};const i=r.httpRequestHeaders;return o&&(i.token=o.token),$.SystemID&&(i.sysid=$.SystemID,$.SystemGroup&&(i.sysgroup=$.SystemGroup)),new ft.ClientContext(r)}async getHproseProxy(){if(!this.hproseClient)throw new Error("HproseClient对象为构建，无法调用Hprose方法");if(!this.hpProxyObj){const e=await this.hproseClient.getProxy();this.hpProxyObj=e}return this.hpProxyObj||Je.emit(de.HproseServiceErrorEvent,"HproseProxy对象为空，无法调用Hprose方法！"),this.hpProxyObj}async hproseInvoke(e,t,r){if(!this.hproseClient)throw new Error("HproseClient对象为构建，无法调用Hprose方法");return await this.hproseClient.invoke(e,t,r)}async hproseInvokeContext(e,t,...r){if(!this.hproseClient)throw new Error("HproseClient对象为构建，无法调用Hprose方法");const o=Ue();return o&&(t||(t=new ft.ClientContext({httpRequestHeaders:{token:o.token}}))),await this.hproseClient.invoke(e,r,t)}async hproseInvokeEncode(e){const t=new fe.ByteStream(e).toBytes(),r=await this.hproseClient.client?.request(t,this.defaultContext);return r&&this.hproseClient.client?.codec.decode(r,this.defaultContext)}encodeRequest(e,...t){const r=this.hproseClient.client?.codec?.encode(e,t,this.defaultContext);return fe.ByteStream.toString(r)}}const ta=function(n,e,t){!$.Config.DefaultHproseAPI&&$.Config.ServiceURL&&($.Config.DefaultHproseAPI=$.Config.ServiceURL.DefaultHproseAPI),$.Config.DefaultHproseAPI&&jr.isNotEmpty($.Config.DefaultHproseAPI)&&($.DefaultProxyClient=new dn($.Config.DefaultHproseAPI));const r=$.Config.UI.GrayMode;r&&se.setGrayMode(r);const o=new Or(n,$.EventBus);$.Message=o,$.SystemID=e,$.SystemGroup=t,$.EventBus.on(de.HproseServiceErrorEvent,i=>{const s=`当前后台业务服务不可用!${i}`}),$.EventBus.on(de.WebAPIErrorEvent,i=>{const s=`WebAPI后台服务不可用!${i}`}),$.EventBus.on(de.AxiosRequestErrorEvent,i=>{const s=`Http请求'${i.code}'错误: ${i.message}`}),$.EventBus.on(de.CommonWarnEvent,i=>{o.warn(i)})},Ke=Mr({isLock:!1,lockTime:0});function fn(n){Ke.isLock=n,n&&Xr()}let tn;function Ye(){clearInterval(tn),!(window.location.href.indexOf("/login")>0||Ke.isLock)&&(fn(!1),Ke.lockTime=function(){let n=3600;return $.Config.UI?.LockTime&&$.Config.UI?.LockTime>=10&&(n=$.Config.UI.LockTime),n}(),tn=setInterval(()=>{if(Ke.lockTime--,Ke.lockTime<=0)return fn(!0),clearInterval(tn)},1e3))}function na(){Ye(),document.addEventListener("mousedown",Ye),document.addEventListener("mousemove",Ye)}function ra(){document.removeEventListener("mousedown",Ye),document.removeEventListener("mousemove",Ye)}function nn(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var dr,fr={exports:{}};/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/var pr,Fi=(dr||(dr=1,fr.exports=function n(e,t,r){function o(c,d){if(!t[c]){if(!e[c]){if(!d&&nn)return nn(c);if(i)return i(c,!0);var g=new Error("Cannot find module '"+c+"'");throw g.code="MODULE_NOT_FOUND",g}var S=t[c]={exports:{}};e[c][0].call(S.exports,function(k){var W=e[c][1][k];return o(W||k)},S,S.exports,n,e,t,r)}return t[c].exports}for(var i=nn,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(n,e,t){(function(r){var o,i,s=r.MutationObserver||r.WebKitMutationObserver;if(s){var c=0,d=new s(W),g=r.document.createTextNode("");d.observe(g,{characterData:!0}),o=function(){g.data=c=++c%2}}else if(r.setImmediate||r.MessageChannel===void 0)o="document"in r&&"onreadystatechange"in r.document.createElement("script")?function(){var D=r.document.createElement("script");D.onreadystatechange=function(){W(),D.onreadystatechange=null,D.parentNode.removeChild(D),D=null},r.document.documentElement.appendChild(D)}:function(){setTimeout(W,0)};else{var S=new r.MessageChannel;S.port1.onmessage=W,o=function(){S.port2.postMessage(0)}}var k=[];function W(){var D,f;i=!0;for(var l=k.length;l;){for(f=k,k=[],D=-1;++D<l;)f[D]();l=k.length}i=!1}function N(D){k.push(D)!==1||i||o()}e.exports=N}).call(this,$e!==void 0?$e:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(n,e,t){var r=n(1);function o(){}var i={},s=["REJECTED"],c=["FULFILLED"],d=["PENDING"];function g(p){if(typeof p!="function")throw new TypeError("resolver must be a function");this.state=d,this.queue=[],this.outcome=void 0,p!==o&&N(this,p)}function S(p,y,P){this.promise=p,typeof y=="function"&&(this.onFulfilled=y,this.callFulfilled=this.otherCallFulfilled),typeof P=="function"&&(this.onRejected=P,this.callRejected=this.otherCallRejected)}function k(p,y,P){r(function(){var A;try{A=y(P)}catch(T){return i.reject(p,T)}A===p?i.reject(p,new TypeError("Cannot resolve promise with itself")):i.resolve(p,A)})}function W(p){var y=p&&p.then;if(p&&(typeof p=="object"||typeof p=="function")&&typeof y=="function")return function(){y.apply(p,arguments)}}function N(p,y){var P=!1;function A(U){P||(P=!0,i.reject(p,U))}function T(U){P||(P=!0,i.resolve(p,U))}function L(){y(T,A)}var H=D(L);H.status==="error"&&A(H.value)}function D(p,y){var P={};try{P.value=p(y),P.status="success"}catch(A){P.status="error",P.value=A}return P}function f(p){return p instanceof this?p:i.resolve(new this(o),p)}function l(p){var y=new this(o);return i.reject(y,p)}function v(p){var y=this;if(Object.prototype.toString.call(p)!=="[object Array]")return this.reject(new TypeError("must be an array"));var P=p.length,A=!1;if(!P)return this.resolve([]);for(var T=new Array(P),L=0,H=-1,U=new this(o);++H<P;)M(p[H],H);return U;function M(q,F){function le(oe){T[F]=oe,++L!==P||A||(A=!0,i.resolve(U,T))}y.resolve(q).then(le,function(oe){A||(A=!0,i.reject(U,oe))})}}function m(p){var y=this;if(Object.prototype.toString.call(p)!=="[object Array]")return this.reject(new TypeError("must be an array"));var P=p.length,A=!1;if(!P)return this.resolve([]);for(var T=-1,L=new this(o);++T<P;)H(p[T]);return L;function H(U){y.resolve(U).then(function(M){A||(A=!0,i.resolve(L,M))},function(M){A||(A=!0,i.reject(L,M))})}}e.exports=g,g.prototype.catch=function(p){return this.then(null,p)},g.prototype.then=function(p,y){if(typeof p!="function"&&this.state===c||typeof y!="function"&&this.state===s)return this;var P=new this.constructor(o);return this.state!==d?k(P,this.state===c?p:y,this.outcome):this.queue.push(new S(P,p,y)),P},S.prototype.callFulfilled=function(p){i.resolve(this.promise,p)},S.prototype.otherCallFulfilled=function(p){k(this.promise,this.onFulfilled,p)},S.prototype.callRejected=function(p){i.reject(this.promise,p)},S.prototype.otherCallRejected=function(p){k(this.promise,this.onRejected,p)},i.resolve=function(p,y){var P=D(W,y);if(P.status==="error")return i.reject(p,P.value);var A=P.value;if(A)N(p,A);else{p.state=c,p.outcome=y;for(var T=-1,L=p.queue.length;++T<L;)p.queue[T].callFulfilled(y)}return p},i.reject=function(p,y){p.state=s,p.outcome=y;for(var P=-1,A=p.queue.length;++P<A;)p.queue[P].callRejected(y);return p},g.resolve=f,g.reject=l,g.all=v,g.race=m},{1:1}],3:[function(n,e,t){(function(r){typeof r.Promise!="function"&&(r.Promise=n(2))}).call(this,$e!==void 0?$e:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(n,e,t){var r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};function o(a,u){if(!(a instanceof u))throw new TypeError("Cannot call a class as a function")}function i(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var s=i();function c(){try{if(!s||!s.open)return!1;var a=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),u=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!a||u)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function d(a,u){a=a||[],u=u||{};try{return new Blob(a,u)}catch(w){if(w.name!=="TypeError")throw w;for(var h=new(typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder),_=0;_<a.length;_+=1)h.append(a[_]);return h.getBlob(u.type)}}typeof Promise>"u"&&n(3);var g=Promise;function S(a,u){u&&a.then(function(h){u(null,h)},function(h){u(h)})}function k(a,u,h){typeof u=="function"&&a.then(u),typeof h=="function"&&a.catch(h)}function W(a){return typeof a!="string"&&(a=String(a)),a}function N(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var D="local-forage-detect-blob-support",f=void 0,l={},v=Object.prototype.toString,m="readonly",p="readwrite";function y(a){for(var u=a.length,h=new ArrayBuffer(u),_=new Uint8Array(h),w=0;w<u;w++)_[w]=a.charCodeAt(w);return h}function P(a){return new g(function(u){var h=a.transaction(D,p),_=d([""]);h.objectStore(D).put(_,"key"),h.onabort=function(w){w.preventDefault(),w.stopPropagation(),u(!1)},h.oncomplete=function(){var w=navigator.userAgent.match(/Chrome\/(\d+)/),b=navigator.userAgent.match(/Edge\//);u(b||!w||parseInt(w[1],10)>=43)}}).catch(function(){return!1})}function A(a){return typeof f=="boolean"?g.resolve(f):P(a).then(function(u){return f=u})}function T(a){var u=l[a.name],h={};h.promise=new g(function(_,w){h.resolve=_,h.reject=w}),u.deferredOperations.push(h),u.dbReady?u.dbReady=u.dbReady.then(function(){return h.promise}):u.dbReady=h.promise}function L(a){var u=l[a.name].deferredOperations.pop();if(u)return u.resolve(),u.promise}function H(a,u){var h=l[a.name].deferredOperations.pop();if(h)return h.reject(u),h.promise}function U(a,u){return new g(function(h,_){if(l[a.name]=l[a.name]||Tn(),a.db){if(!u)return h(a.db);T(a),a.db.close()}var w=[a.name];u&&w.push(a.version);var b=s.open.apply(s,w);u&&(b.onupgradeneeded=function(C){var x=b.result;try{x.createObjectStore(a.storeName),C.oldVersion<=1&&x.createObjectStore(D)}catch(I){if(I.name!=="ConstraintError")throw I}}),b.onerror=function(C){C.preventDefault(),_(b.error)},b.onsuccess=function(){var C=b.result;C.onversionchange=function(x){x.target.close()},h(C),L(a)}})}function M(a){return U(a,!1)}function q(a){return U(a,!0)}function F(a,u){if(!a.db)return!0;var h=!a.db.objectStoreNames.contains(a.storeName),_=a.version<a.db.version,w=a.version>a.db.version;if(_&&(a.version,a.version=a.db.version),w||h){if(h){var b=a.db.version+1;b>a.version&&(a.version=b)}return!0}return!1}function le(a){return new g(function(u,h){var _=new FileReader;_.onerror=h,_.onloadend=function(w){var b=btoa(w.target.result||"");u({__local_forage_encoded_blob:!0,data:b,type:a.type})},_.readAsBinaryString(a)})}function oe(a){return d([y(atob(a.data))],{type:a.type})}function we(a){return a&&a.__local_forage_encoded_blob}function tt(a){var u=this,h=u._initReady().then(function(){var _=l[u._dbInfo.name];if(_&&_.dbReady)return _.dbReady});return k(h,a,a),h}function Pt(a){T(a);for(var u=l[a.name],h=u.forages,_=0;_<h.length;_++){var w=h[_];w._dbInfo.db&&(w._dbInfo.db.close(),w._dbInfo.db=null)}return a.db=null,M(a).then(function(b){return a.db=b,F(a)?q(a):b}).then(function(b){a.db=u.db=b;for(var C=0;C<h.length;C++)h[C]._dbInfo.db=b}).catch(function(b){throw H(a,b),b})}function me(a,u,h,_){_===void 0&&(_=1);try{var w=a.db.transaction(a.storeName,u);h(null,w)}catch(b){if(_>0&&(!a.db||b.name==="InvalidStateError"||b.name==="NotFoundError"))return g.resolve().then(function(){if(!a.db||b.name==="NotFoundError"&&!a.db.objectStoreNames.contains(a.storeName)&&a.version<=a.db.version)return a.db&&(a.version=a.db.version+1),q(a)}).then(function(){return Pt(a).then(function(){me(a,u,h,_-1)})}).catch(h);h(b)}}function Tn(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function co(a){var u=this,h={db:null};if(a)for(var _ in a)h[_]=a[_];var w=l[h.name];w||(w=Tn(),l[h.name]=w),w.forages.push(u),u._initReady||(u._initReady=u.ready,u.ready=tt);var b=[];function C(){return g.resolve()}for(var x=0;x<w.forages.length;x++){var I=w.forages[x];I!==u&&b.push(I._initReady().catch(C))}var R=w.forages.slice(0);return g.all(b).then(function(){return h.db=w.db,M(h)}).then(function(B){return h.db=B,F(h,u._defaultConfig.version)?q(h):B}).then(function(B){h.db=w.db=B,u._dbInfo=h;for(var j=0;j<R.length;j++){var O=R[j];O!==u&&(O._dbInfo.db=h.db,O._dbInfo.version=h.version)}})}function lo(a,u){var h=this;a=W(a);var _=new g(function(w,b){h.ready().then(function(){me(h._dbInfo,m,function(C,x){if(C)return b(C);try{var I=x.objectStore(h._dbInfo.storeName).get(a);I.onsuccess=function(){var R=I.result;R===void 0&&(R=null),we(R)&&(R=oe(R)),w(R)},I.onerror=function(){b(I.error)}}catch(R){b(R)}})}).catch(b)});return S(_,u),_}function uo(a,u){var h=this,_=new g(function(w,b){h.ready().then(function(){me(h._dbInfo,m,function(C,x){if(C)return b(C);try{var I=x.objectStore(h._dbInfo.storeName).openCursor(),R=1;I.onsuccess=function(){var B=I.result;if(B){var j=B.value;we(j)&&(j=oe(j));var O=a(j,B.key,R++);O!==void 0?w(O):B.continue()}else w()},I.onerror=function(){b(I.error)}}catch(B){b(B)}})}).catch(b)});return S(_,u),_}function ho(a,u,h){var _=this;a=W(a);var w=new g(function(b,C){var x;_.ready().then(function(){return x=_._dbInfo,v.call(u)==="[object Blob]"?A(x.db).then(function(I){return I?u:le(u)}):u}).then(function(I){me(_._dbInfo,p,function(R,B){if(R)return C(R);try{var j=B.objectStore(_._dbInfo.storeName);I===null&&(I=void 0);var O=j.put(I,a);B.oncomplete=function(){I===void 0&&(I=null),b(I)},B.onabort=B.onerror=function(){var K=O.error?O.error:O.transaction.error;C(K)}}catch(K){C(K)}})}).catch(C)});return S(w,h),w}function fo(a,u){var h=this;a=W(a);var _=new g(function(w,b){h.ready().then(function(){me(h._dbInfo,p,function(C,x){if(C)return b(C);try{var I=x.objectStore(h._dbInfo.storeName).delete(a);x.oncomplete=function(){w()},x.onerror=function(){b(I.error)},x.onabort=function(){var R=I.error?I.error:I.transaction.error;b(R)}}catch(R){b(R)}})}).catch(b)});return S(_,u),_}function po(a){var u=this,h=new g(function(_,w){u.ready().then(function(){me(u._dbInfo,p,function(b,C){if(b)return w(b);try{var x=C.objectStore(u._dbInfo.storeName).clear();C.oncomplete=function(){_()},C.onabort=C.onerror=function(){var I=x.error?x.error:x.transaction.error;w(I)}}catch(I){w(I)}})}).catch(w)});return S(h,a),h}function go(a){var u=this,h=new g(function(_,w){u.ready().then(function(){me(u._dbInfo,m,function(b,C){if(b)return w(b);try{var x=C.objectStore(u._dbInfo.storeName).count();x.onsuccess=function(){_(x.result)},x.onerror=function(){w(x.error)}}catch(I){w(I)}})}).catch(w)});return S(h,a),h}function mo(a,u){var h=this,_=new g(function(w,b){a<0?w(null):h.ready().then(function(){me(h._dbInfo,m,function(C,x){if(C)return b(C);try{var I=x.objectStore(h._dbInfo.storeName),R=!1,B=I.openKeyCursor();B.onsuccess=function(){var j=B.result;j?a===0||R?w(j.key):(R=!0,j.advance(a)):w(null)},B.onerror=function(){b(B.error)}}catch(j){b(j)}})}).catch(b)});return S(_,u),_}function vo(a){var u=this,h=new g(function(_,w){u.ready().then(function(){me(u._dbInfo,m,function(b,C){if(b)return w(b);try{var x=C.objectStore(u._dbInfo.storeName).openKeyCursor(),I=[];x.onsuccess=function(){var R=x.result;R?(I.push(R.key),R.continue()):_(I)},x.onerror=function(){w(x.error)}}catch(R){w(R)}})}).catch(w)});return S(h,a),h}function yo(a,u){u=N.apply(this,arguments);var h=this.config();(a=typeof a!="function"&&a||{}).name||(a.name=a.name||h.name,a.storeName=a.storeName||h.storeName);var _,w=this;if(a.name){var b=a.name===h.name&&w._dbInfo.db?g.resolve(w._dbInfo.db):M(a).then(function(C){var x=l[a.name],I=x.forages;x.db=C;for(var R=0;R<I.length;R++)I[R]._dbInfo.db=C;return C});_=a.storeName?b.then(function(C){if(C.objectStoreNames.contains(a.storeName)){var x=C.version+1;T(a);var I=l[a.name],R=I.forages;C.close();for(var B=0;B<R.length;B++){var j=R[B];j._dbInfo.db=null,j._dbInfo.version=x}var O=new g(function(K,V){var ie=s.open(a.name,x);ie.onerror=function(Se){ie.result.close(),V(Se)},ie.onupgradeneeded=function(){ie.result.deleteObjectStore(a.storeName)},ie.onsuccess=function(){var Se=ie.result;Se.close(),K(Se)}});return O.then(function(K){I.db=K;for(var V=0;V<R.length;V++){var ie=R[V];ie._dbInfo.db=K,L(ie._dbInfo)}}).catch(function(K){throw(H(a,K)||g.resolve()).catch(function(){}),K})}}):b.then(function(C){T(a);var x=l[a.name],I=x.forages;C.close();for(var R=0;R<I.length;R++)I[R]._dbInfo.db=null;var B=new g(function(j,O){var K=s.deleteDatabase(a.name);K.onerror=function(){var V=K.result;V&&V.close(),O(K.error)},K.onblocked=function(){},K.onsuccess=function(){var V=K.result;V&&V.close(),j(V)}});return B.then(function(j){x.db=j;for(var O=0;O<I.length;O++)L(I[O]._dbInfo)}).catch(function(j){throw(H(a,j)||g.resolve()).catch(function(){}),j})})}else _=g.reject("Invalid arguments");return S(_,u),_}var wo={_driver:"asyncStorage",_initStorage:co,_support:c(),iterate:uo,getItem:lo,setItem:ho,removeItem:fo,clear:po,length:go,key:mo,keys:vo,dropInstance:yo};function _o(){return typeof openDatabase=="function"}var Ce="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bo="~~local_forage_type~",Rn=/^~~local_forage_type~([^~]+)~/,nt="__lfsc__:",Bt=nt.length,Nt="arbf",Wt="blob",Mn="si08",Dn="ui08",Ln="uic8",An="si16",Pn="si32",Bn="ur16",Nn="ui32",Wn="fl32",$n="fl64",jn=Bt+Nt.length,Hn=Object.prototype.toString;function Un(a){var u,h,_,w,b,C=.75*a.length,x=a.length,I=0;a[a.length-1]==="="&&(C--,a[a.length-2]==="="&&C--);var R=new ArrayBuffer(C),B=new Uint8Array(R);for(u=0;u<x;u+=4)h=Ce.indexOf(a[u]),_=Ce.indexOf(a[u+1]),w=Ce.indexOf(a[u+2]),b=Ce.indexOf(a[u+3]),B[I++]=h<<2|_>>4,B[I++]=(15&_)<<4|w>>2,B[I++]=(3&w)<<6|63&b;return R}function $t(a){var u,h=new Uint8Array(a),_="";for(u=0;u<h.length;u+=3)_+=Ce[h[u]>>2],_+=Ce[(3&h[u])<<4|h[u+1]>>4],_+=Ce[(15&h[u+1])<<2|h[u+2]>>6],_+=Ce[63&h[u+2]];return h.length%3==2?_=_.substring(0,_.length-1)+"=":h.length%3==1&&(_=_.substring(0,_.length-2)+"=="),_}function So(a,u){var h="";if(a&&(h=Hn.call(a)),a&&(h==="[object ArrayBuffer]"||a.buffer&&Hn.call(a.buffer)==="[object ArrayBuffer]")){var _,w=nt;a instanceof ArrayBuffer?(_=a,w+=Nt):(_=a.buffer,h==="[object Int8Array]"?w+=Mn:h==="[object Uint8Array]"?w+=Dn:h==="[object Uint8ClampedArray]"?w+=Ln:h==="[object Int16Array]"?w+=An:h==="[object Uint16Array]"?w+=Bn:h==="[object Int32Array]"?w+=Pn:h==="[object Uint32Array]"?w+=Nn:h==="[object Float32Array]"?w+=Wn:h==="[object Float64Array]"?w+=$n:u(new Error("Failed to get type for BinaryArray"))),u(w+$t(_))}else if(h==="[object Blob]"){var b=new FileReader;b.onload=function(){var C=bo+a.type+"~"+$t(this.result);u(nt+Wt+C)},b.readAsArrayBuffer(a)}else try{u(JSON.stringify(a))}catch(C){u(null,C)}}function Co(a){if(a.substring(0,Bt)!==nt)return JSON.parse(a);var u,h=a.substring(jn),_=a.substring(Bt,jn);if(_===Wt&&Rn.test(h)){var w=h.match(Rn);u=w[1],h=h.substring(w[0].length)}var b=Un(h);switch(_){case Nt:return b;case Wt:return d([b],{type:u});case Mn:return new Int8Array(b);case Dn:return new Uint8Array(b);case Ln:return new Uint8ClampedArray(b);case An:return new Int16Array(b);case Bn:return new Uint16Array(b);case Pn:return new Int32Array(b);case Nn:return new Uint32Array(b);case Wn:return new Float32Array(b);case $n:return new Float64Array(b);default:throw new Error("Unkown type: "+_)}}var jt={serialize:So,deserialize:Co,stringToBuffer:Un,bufferToString:$t};function zn(a,u,h,_){a.executeSql("CREATE TABLE IF NOT EXISTS "+u.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],h,_)}function Eo(a){var u=this,h={db:null};if(a)for(var _ in a)h[_]=typeof a[_]!="string"?a[_].toString():a[_];var w=new g(function(b,C){try{h.db=openDatabase(h.name,String(h.version),h.description,h.size)}catch(x){return C(x)}h.db.transaction(function(x){zn(x,h,function(){u._dbInfo=h,b()},function(I,R){C(R)})},C)});return h.serializer=jt,w}function Ee(a,u,h,_,w,b){a.executeSql(h,_,w,function(C,x){x.code===x.SYNTAX_ERR?C.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[u.storeName],function(I,R){R.rows.length?b(I,x):zn(I,u,function(){I.executeSql(h,_,w,b)},b)},b):b(C,x)},b)}function ko(a,u){var h=this;a=W(a);var _=new g(function(w,b){h.ready().then(function(){var C=h._dbInfo;C.db.transaction(function(x){Ee(x,C,"SELECT * FROM "+C.storeName+" WHERE key = ? LIMIT 1",[a],function(I,R){var B=R.rows.length?R.rows.item(0).value:null;B&&(B=C.serializer.deserialize(B)),w(B)},function(I,R){b(R)})})}).catch(b)});return S(_,u),_}function xo(a,u){var h=this,_=new g(function(w,b){h.ready().then(function(){var C=h._dbInfo;C.db.transaction(function(x){Ee(x,C,"SELECT * FROM "+C.storeName,[],function(I,R){for(var B=R.rows,j=B.length,O=0;O<j;O++){var K=B.item(O),V=K.value;if(V&&(V=C.serializer.deserialize(V)),(V=a(V,K.key,O+1))!==void 0)return void w(V)}w()},function(I,R){b(R)})})}).catch(b)});return S(_,u),_}function qn(a,u,h,_){var w=this;a=W(a);var b=new g(function(C,x){w.ready().then(function(){u===void 0&&(u=null);var I=u,R=w._dbInfo;R.serializer.serialize(u,function(B,j){j?x(j):R.db.transaction(function(O){Ee(O,R,"INSERT OR REPLACE INTO "+R.storeName+" (key, value) VALUES (?, ?)",[a,B],function(){C(I)},function(K,V){x(V)})},function(O){if(O.code===O.QUOTA_ERR){if(_>0)return void C(qn.apply(w,[a,I,h,_-1]));x(O)}})})}).catch(x)});return S(b,h),b}function Io(a,u,h){return qn.apply(this,[a,u,h,1])}function To(a,u){var h=this;a=W(a);var _=new g(function(w,b){h.ready().then(function(){var C=h._dbInfo;C.db.transaction(function(x){Ee(x,C,"DELETE FROM "+C.storeName+" WHERE key = ?",[a],function(){w()},function(I,R){b(R)})})}).catch(b)});return S(_,u),_}function Ro(a){var u=this,h=new g(function(_,w){u.ready().then(function(){var b=u._dbInfo;b.db.transaction(function(C){Ee(C,b,"DELETE FROM "+b.storeName,[],function(){_()},function(x,I){w(I)})})}).catch(w)});return S(h,a),h}function Mo(a){var u=this,h=new g(function(_,w){u.ready().then(function(){var b=u._dbInfo;b.db.transaction(function(C){Ee(C,b,"SELECT COUNT(key) as c FROM "+b.storeName,[],function(x,I){var R=I.rows.item(0).c;_(R)},function(x,I){w(I)})})}).catch(w)});return S(h,a),h}function Do(a,u){var h=this,_=new g(function(w,b){h.ready().then(function(){var C=h._dbInfo;C.db.transaction(function(x){Ee(x,C,"SELECT key FROM "+C.storeName+" WHERE id = ? LIMIT 1",[a+1],function(I,R){var B=R.rows.length?R.rows.item(0).key:null;w(B)},function(I,R){b(R)})})}).catch(b)});return S(_,u),_}function Lo(a){var u=this,h=new g(function(_,w){u.ready().then(function(){var b=u._dbInfo;b.db.transaction(function(C){Ee(C,b,"SELECT key FROM "+b.storeName,[],function(x,I){for(var R=[],B=0;B<I.rows.length;B++)R.push(I.rows.item(B).key);_(R)},function(x,I){w(I)})})}).catch(w)});return S(h,a),h}function Ao(a){return new g(function(u,h){a.transaction(function(_){_.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(w,b){for(var C=[],x=0;x<b.rows.length;x++)C.push(b.rows.item(x).name);u({db:a,storeNames:C})},function(w,b){h(b)})},function(_){h(_)})})}function Po(a,u){u=N.apply(this,arguments);var h=this.config();(a=typeof a!="function"&&a||{}).name||(a.name=a.name||h.name,a.storeName=a.storeName||h.storeName);var _,w=this;return _=a.name?new g(function(b){var C;C=a.name===h.name?w._dbInfo.db:openDatabase(a.name,"","",0),a.storeName?b({db:C,storeNames:[a.storeName]}):b(Ao(C))}).then(function(b){return new g(function(C,x){b.db.transaction(function(I){function R(K){return new g(function(V,ie){I.executeSql("DROP TABLE IF EXISTS "+K,[],function(){V()},function(Se,zt){ie(zt)})})}for(var B=[],j=0,O=b.storeNames.length;j<O;j++)B.push(R(b.storeNames[j]));g.all(B).then(function(){C()}).catch(function(K){x(K)})},function(I){x(I)})})}):g.reject("Invalid arguments"),S(_,u),_}var Bo={_driver:"webSQLStorage",_initStorage:Eo,_support:_o(),iterate:xo,getItem:ko,setItem:Io,removeItem:To,clear:Ro,length:Mo,key:Do,keys:Lo,dropInstance:Po};function No(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function On(a,u){var h=a.name+"/";return a.storeName!==u.storeName&&(h+=a.storeName+"/"),h}function Wo(){var a="_localforage_support_test";try{return localStorage.setItem(a,!0),localStorage.removeItem(a),!1}catch{return!0}}function $o(){return!Wo()||localStorage.length>0}function jo(a){var u=this,h={};if(a)for(var _ in a)h[_]=a[_];return h.keyPrefix=On(a,u._defaultConfig),$o()?(u._dbInfo=h,h.serializer=jt,g.resolve()):g.reject()}function Ho(a){var u=this,h=u.ready().then(function(){for(var _=u._dbInfo.keyPrefix,w=localStorage.length-1;w>=0;w--){var b=localStorage.key(w);b.indexOf(_)===0&&localStorage.removeItem(b)}});return S(h,a),h}function Uo(a,u){var h=this;a=W(a);var _=h.ready().then(function(){var w=h._dbInfo,b=localStorage.getItem(w.keyPrefix+a);return b&&(b=w.serializer.deserialize(b)),b});return S(_,u),_}function zo(a,u){var h=this,_=h.ready().then(function(){for(var w=h._dbInfo,b=w.keyPrefix,C=b.length,x=localStorage.length,I=1,R=0;R<x;R++){var B=localStorage.key(R);if(B.indexOf(b)===0){var j=localStorage.getItem(B);if(j&&(j=w.serializer.deserialize(j)),(j=a(j,B.substring(C),I++))!==void 0)return j}}});return S(_,u),_}function qo(a,u){var h=this,_=h.ready().then(function(){var w,b=h._dbInfo;try{w=localStorage.key(a)}catch{w=null}return w&&(w=w.substring(b.keyPrefix.length)),w});return S(_,u),_}function Oo(a){var u=this,h=u.ready().then(function(){for(var _=u._dbInfo,w=localStorage.length,b=[],C=0;C<w;C++){var x=localStorage.key(C);x.indexOf(_.keyPrefix)===0&&b.push(x.substring(_.keyPrefix.length))}return b});return S(h,a),h}function Fo(a){var u=this.keys().then(function(h){return h.length});return S(u,a),u}function Xo(a,u){var h=this;a=W(a);var _=h.ready().then(function(){var w=h._dbInfo;localStorage.removeItem(w.keyPrefix+a)});return S(_,u),_}function Ko(a,u,h){var _=this;a=W(a);var w=_.ready().then(function(){u===void 0&&(u=null);var b=u;return new g(function(C,x){var I=_._dbInfo;I.serializer.serialize(u,function(R,B){if(B)x(B);else try{localStorage.setItem(I.keyPrefix+a,R),C(b)}catch(j){j.name!=="QuotaExceededError"&&j.name!=="NS_ERROR_DOM_QUOTA_REACHED"||x(j),x(j)}})})});return S(w,h),w}function Vo(a,u){if(u=N.apply(this,arguments),!(a=typeof a!="function"&&a||{}).name){var h=this.config();a.name=a.name||h.name,a.storeName=a.storeName||h.storeName}var _,w=this;return _=a.name?new g(function(b){a.storeName?b(On(a,w._defaultConfig)):b(a.name+"/")}).then(function(b){for(var C=localStorage.length-1;C>=0;C--){var x=localStorage.key(C);x.indexOf(b)===0&&localStorage.removeItem(x)}}):g.reject("Invalid arguments"),S(_,u),_}var Yo={_driver:"localStorageWrapper",_initStorage:jo,_support:No(),iterate:zo,getItem:Uo,setItem:Ko,removeItem:Xo,clear:Ho,length:Fo,key:qo,keys:Oo,dropInstance:Vo},Jo=function(a,u){return a===u||typeof a=="number"&&typeof u=="number"&&isNaN(a)&&isNaN(u)},Go=function(a,u){for(var h=a.length,_=0;_<h;){if(Jo(a[_],u))return!0;_++}return!1},Fn=Array.isArray||function(a){return Object.prototype.toString.call(a)==="[object Array]"},Fe={},Xn={},Ne={INDEXEDDB:wo,WEBSQL:Bo,LOCALSTORAGE:Yo},Qo=[Ne.INDEXEDDB._driver,Ne.WEBSQL._driver,Ne.LOCALSTORAGE._driver],rt=["dropInstance"],Ht=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(rt),Zo={description:"",driver:Qo.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function ei(a,u){a[u]=function(){var h=arguments;return a.ready().then(function(){return a[u].apply(a,h)})}}function Ut(){for(var a=1;a<arguments.length;a++){var u=arguments[a];if(u)for(var h in u)u.hasOwnProperty(h)&&(Fn(u[h])?arguments[0][h]=u[h].slice():arguments[0][h]=u[h])}return arguments[0]}var ti=function(){function a(u){for(var h in o(this,a),Ne)if(Ne.hasOwnProperty(h)){var _=Ne[h],w=_._driver;this[h]=w,Fe[w]||this.defineDriver(_)}this._defaultConfig=Ut({},Zo),this._config=Ut({},this._defaultConfig,u),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return a.prototype.config=function(u){if((u===void 0?"undefined":r(u))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var h in u){if(h==="storeName"&&(u[h]=u[h].replace(/\W/g,"_")),h==="version"&&typeof u[h]!="number")return new Error("Database version must be a number.");this._config[h]=u[h]}return!("driver"in u)||!u.driver||this.setDriver(this._config.driver)}return typeof u=="string"?this._config[u]:this._config},a.prototype.defineDriver=function(u,h,_){var w=new g(function(b,C){try{var x=u._driver,I=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!u._driver)return void C(I);for(var R=Ht.concat("_initStorage"),B=0,j=R.length;B<j;B++){var O=R[B];if((!Go(rt,O)||u[O])&&typeof u[O]!="function")return void C(I)}var K=function(){for(var ie=function(ri){return function(){var oi=new Error("Method "+ri+" is not implemented by the current driver"),Kn=g.reject(oi);return S(Kn,arguments[arguments.length-1]),Kn}},Se=0,zt=rt.length;Se<zt;Se++){var qt=rt[Se];u[qt]||(u[qt]=ie(qt))}};K();var V=function(ie){Fe[x],Fe[x]=u,Xn[x]=ie,b()};"_support"in u?u._support&&typeof u._support=="function"?u._support().then(V,C):V(!!u._support):V(!0)}catch(ie){C(ie)}});return k(w,h,_),w},a.prototype.driver=function(){return this._driver||null},a.prototype.getDriver=function(u,h,_){var w=Fe[u]?g.resolve(Fe[u]):g.reject(new Error("Driver not found."));return k(w,h,_),w},a.prototype.getSerializer=function(u){var h=g.resolve(jt);return k(h,u),h},a.prototype.ready=function(u){var h=this,_=h._driverSet.then(function(){return h._ready===null&&(h._ready=h._initDriver()),h._ready});return k(_,u,u),_},a.prototype.setDriver=function(u,h,_){var w=this;Fn(u)||(u=[u]);var b=this._getSupportedDrivers(u);function C(){w._config.driver=w.driver()}function x(B){return w._extend(B),C(),w._ready=w._initStorage(w._config),w._ready}function I(B){return function(){var j=0;function O(){for(;j<B.length;){var K=B[j];return j++,w._dbInfo=null,w._ready=null,w.getDriver(K).then(x).catch(O)}C();var V=new Error("No available storage method found.");return w._driverSet=g.reject(V),w._driverSet}return O()}}var R=this._driverSet!==null?this._driverSet.catch(function(){return g.resolve()}):g.resolve();return this._driverSet=R.then(function(){var B=b[0];return w._dbInfo=null,w._ready=null,w.getDriver(B).then(function(j){w._driver=j._driver,C(),w._wrapLibraryMethodsWithReady(),w._initDriver=I(b)})}).catch(function(){C();var B=new Error("No available storage method found.");return w._driverSet=g.reject(B),w._driverSet}),k(this._driverSet,h,_),this._driverSet},a.prototype.supports=function(u){return!!Xn[u]},a.prototype._extend=function(u){Ut(this,u)},a.prototype._getSupportedDrivers=function(u){for(var h=[],_=0,w=u.length;_<w;_++){var b=u[_];this.supports(b)&&h.push(b)}return h},a.prototype._wrapLibraryMethodsWithReady=function(){for(var u=0,h=Ht.length;u<h;u++)ei(this,Ht[u])},a.prototype.createInstance=function(u){return new a(u)},a}(),ni=new ti;e.exports=ni},{3:3}]},{},[4])(4)),fr.exports);Tt(Fi);var gr={exports:{}},Xi=(pr||(pr=1,function(n){((e,t)=>{n.exports=t()})(0,()=>{const e=typeof window=="object"?window:this;e.HTMLElement;let t=null,r=!1;const o=e.WebStreamsPolyfill||{},i=e.isSecureContext;let s=/constructor/i.test(e.HTMLElement)||!!e.safari||!!e.WebKitPoint;const c=i||"MozAppearance"in document.documentElement.style?"iframe":"navigate",d={createWriteStream:function(S,k,W){let N={size:null,pathname:null,writableStrategy:void 0,readableStrategy:void 0},D=0,f=null,l=null,v=null;if(Number.isFinite(k)?([W,k]=[k,W],N.size=W,N.writableStrategy=k):k&&k.highWaterMark?(N.size=W,N.writableStrategy=k):N=k||{},!s){t||(t=i?g(d.mitm):function(P){const A="width=200,height=100",T=document.createDocumentFragment(),L={frame:e.open(P,"popup",A),loaded:!1,isIframe:!1,isPopup:!0,remove(){L.frame.close()},addEventListener(...U){T.addEventListener(...U)},dispatchEvent(...U){T.dispatchEvent(...U)},removeEventListener(...U){T.removeEventListener(...U)},postMessage(...U){L.frame.postMessage(...U)}},H=U=>{U.source===L.frame&&(L.loaded=!0,e.removeEventListener("message",H),L.dispatchEvent(new Event("load")))};return e.addEventListener("message",H),L}(d.mitm)),l=new MessageChannel,S=encodeURIComponent(S.replace(/\//g,":")).replace(/['()]/g,escape).replace(/\*/g,"%2A");const p={transferringReadable:r,pathname:N.pathname||Math.random().toString().slice(-6)+"/"+S,headers:{"Content-Type":"application/octet-stream; charset=utf-8","Content-Disposition":"attachment; filename*=UTF-8''"+S}};N.size&&(p.headers["Content-Length"]=N.size);const y=[p,"*",[l.port2]];if(r){const P=c==="iframe"?void 0:{transform(T,L){if(!(T instanceof Uint8Array))throw new TypeError("Can only write Uint8Arrays");D+=T.length,L.enqueue(T),f&&(location.href=f,f=null)},flush(){f&&(location.href=f)}};v=new d.TransformStream(P,N.writableStrategy,N.readableStrategy);const A=v.readable;l.port1.postMessage({readableStream:A},[A])}l.port1.onmessage=P=>{P.data.download?c==="navigate"?(t.remove(),t=null,D?location.href=P.data.download:f=P.data.download):(t.isPopup&&(t.remove(),t=null,c==="iframe"&&g(d.mitm)),g(P.data.download)):P.data.abort&&(m=[],l.port1.postMessage("abort"),l.port1.onmessage=null,l.port1.close(),l.port2.close(),l=null)},t.loaded?t.postMessage(...y):t.addEventListener("load",()=>{t.postMessage(...y)},{once:!0})}let m=[];return!s&&v&&v.writable||new d.WritableStream({write(p){if(!(p instanceof Uint8Array))throw new TypeError("Can only write Uint8Arrays");s?m.push(p):(l.port1.postMessage(p),D+=p.length,f&&(location.href=f,f=null))},close(){if(s){const p=new Blob(m,{type:"application/octet-stream; charset=utf-8"}),y=document.createElement("a");y.href=URL.createObjectURL(p),y.download=S,y.click()}else l.port1.postMessage("end")},abort(){m=[],l.port1.postMessage("abort"),l.port1.onmessage=null,l.port1.close(),l.port2.close(),l=null}},N.writableStrategy)},WritableStream:e.WritableStream||o.WritableStream,supported:!0,version:{full:"2.0.5",major:2,minor:0,dot:5},mitm:"https://jimmywarting.github.io/StreamSaver.js/mitm.html?version=2.0.0"};function g(S){if(!S)throw new Error("meh");const k=document.createElement("iframe");return k.hidden=!0,k.src=S,k.loaded=!1,k.name="iframe",k.isIframe=!0,k.postMessage=(...W)=>k.contentWindow.postMessage(...W),k.addEventListener("load",()=>{k.loaded=!0},{once:!0}),document.body.appendChild(k),k}try{new Response(new ReadableStream),i&&!("serviceWorker"in navigator)&&(s=!0)}catch{s=!0}return(S=>{try{S()}catch{}})(()=>{const{readable:S}=new TransformStream,k=new MessageChannel;k.port1.postMessage(S,[S]),k.port1.close(),k.port2.close(),r=!0,Object.defineProperty(d,"TransformStream",{configurable:!1,writable:!1,value:TransformStream})}),d})}(gr)),gr.exports);Tt(Xi);function Ki(n={},e={}){let t;for(t in e)Mt(e[t])?n[t]=Ki(n[t],e[t]):n[t]=e[t];return n}function Vi(n,e){const t=`${n}_${e}`;return se.MD5(t)}function Yi(n){const e=function(c){if(!c)return;const d=c,g=[];if(d)for(let S of d){const k=Yr(S);k&&g.push(k)}return g}(n.bussinessRoutes),t=function(c){if(!c)return;const d=c;if(d&&d.length>0){const g=[];return d.forEach(S=>{const k=Jr(S);k&&g.push(k)}),g}}(n.widgetMenuConfig),r=function(c){if(c&&c.length>0){const d=[];return c.forEach(g=>{const S=function(k){return k?{id:k.id,label:k.label,layoutID:k.layoutID,container:k.container,preload:k.preload,afterid:k.afterid,bindid:k.bindid,group:k.group}:void 0}(g);S&&d.push(S)}),d}}(n.widgetConfig),o=function(c){if(c&&c.length>0)return c}(n.functionList),i=n.pkgObject.version,s=n.pkgObject.name;return{id:Vi(s,i),name:$.Config.UI.SiteTitle,group:$.Config.UI.Group,product:s,version:i,routes:e,widgetMenu:t,widgets:r,functions:o}}function Yr(n){if(n){let e=0;n.meta?.hidden&&(e=1);let t={path:n.path,name:n.name,title:n.meta?.title,type:e,index:n.meta?.index};if(n.children){const r=[];for(let o of n.children){const i=Yr(o);i&&r.push(i)}r.length>0&&(t.children=r)}return t}}function Jr(n){if(!n)return;const e={name:n.name,index:n.index,path:n.path,type:n.type};return n.children&&n.children.length>0&&(e.children=[],n.children.forEach(t=>{const r=Jr(t);r&&e.children?.push(r)})),e}function oa(n,e){const t=Yi(n);$i(t,e),$.Message?.msg("导出系统功能权限文件成功！")}let Gr=!0;try{String.fromCharCode.apply(String,[1,2])}catch{Gr=!1,Object.defineProperty(Array.prototype,"subarray",{value:Array.prototype.slice})}var pn=2654435769;function Qr(n,e){var t=n.length,r=t<<2;if(e){var o=n[t-1];if(o<(r-=4)-3||o>r)return null;r=o}for(var i=new Uint8Array(r),s=0;s<r;++s)i[s]=n[s>>2]>>((3&s)<<3);return i}function St(n,e){var t,r=n.length,o=r>>2;3&r&&++o,e?(t=new Uint32Array(o+1))[o]=r:t=new Uint32Array(o);for(var i=0;i<r;++i)t[i>>2]|=n[i]<<((3&i)<<3);return t}function De(n){return 4294967295&n}function Ct(n,e,t,r,o,i){return(t>>>5^e<<2)+(e>>>3^t<<4)^(n^e)+(i[3&r^o]^t)}function Zr(n){if(n.length<16){var e=new Uint8Array(16);e.set(n),n=e}return n}function Et(n){for(var e=n.length,t=new Uint8Array(3*e),r=0,o=0;o<e;o++){var i=n.charCodeAt(o);if(i<128)t[r++]=i;else if(i<2048)t[r++]=192|i>>6,t[r++]=128|63&i;else{if(!(i<55296||i>57343)){if(o+1<e){var s=n.charCodeAt(o+1);if(i<56320&&56320<=s&&s<=57343){var c=65536+((1023&i)<<10|1023&s);t[r++]=240|c>>18,t[r++]=128|c>>12&63,t[r++]=128|c>>6&63,t[r++]=128|63&c,o++;continue}}throw new Error("Malformed string")}t[r++]=224|i>>12,t[r++]=128|i>>6&63,t[r++]=128|63&i}}return t.subarray(0,r)}function mr(n){var e=n.length;return e===0?"":e<32767?function(t,r){for(var o=new Array(r),i=0,s=0,c=t.length;i<r&&s<c;i++){var d=t[s++];switch(d>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o[i]=d;break;case 12:case 13:if(!(s<c))throw new Error("Unfinished UTF-8 octet sequence");o[i]=(31&d)<<6|63&t[s++];break;case 14:if(!(s+1<c))throw new Error("Unfinished UTF-8 octet sequence");o[i]=(15&d)<<12|(63&t[s++])<<6|63&t[s++];break;case 15:if(!(s+2<c))throw new Error("Unfinished UTF-8 octet sequence");var g=((7&d)<<18|(63&t[s++])<<12|(63&t[s++])<<6|63&t[s++])-65536;if(!(0<=g&&g<=1048575))throw new Error("Character outside valid Unicode range: 0x"+g.toString(16));o[i++]=g>>10&1023|55296,o[i]=1023&g|56320;break;default:throw new Error("Bad UTF-8 encoding 0x"+d.toString(16))}}return i<r&&(o.length=i),String.fromCharCode.apply(String,o)}(n,e):function(t,r){for(var o=[],i=new Array(32768),s=0,c=0,d=t.length;s<r&&c<d;s++){var g=t[c++];switch(g>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:i[s]=g;break;case 12:case 13:if(!(c<d))throw new Error("Unfinished UTF-8 octet sequence");i[s]=(31&g)<<6|63&t[c++];break;case 14:if(!(c+1<d))throw new Error("Unfinished UTF-8 octet sequence");i[s]=(15&g)<<12|(63&t[c++])<<6|63&t[c++];break;case 15:if(!(c+2<d))throw new Error("Unfinished UTF-8 octet sequence");var S=((7&g)<<18|(63&t[c++])<<12|(63&t[c++])<<6|63&t[c++])-65536;if(!(0<=S&&S<=1048575))throw new Error("Character outside valid Unicode range: 0x"+S.toString(16));i[s++]=S>>10&1023|55296,i[s]=1023&S|56320;break;default:throw new Error("Bad UTF-8 encoding 0x"+g.toString(16))}if(s>=32766){var k=s+1;i.length=k,o.push(String.fromCharCode.apply(String,i)),r-=k,s=-1}}return s>0&&(i.length=s,o.push(String.fromCharCode.apply(String,i))),o.join("")}(n,e)}function Ji(n){var e=n.length;if(e===0)return"";var t=Gr?n:function(c){for(var d=c.length,g=new Array(c.length),S=0;S<d;++S)g[S]=c[S];return g}(n);if(e<65535)return String.fromCharCode.apply(String,t);for(var r=32767&e,o=e>>15,i=new Array(r?o+1:o),s=0;s<o;++s)i[s]=String.fromCharCode.apply(String,t.subarray(s<<15,s+1<<15));return r&&(i[o]=String.fromCharCode.apply(String,t.subarray(o<<15,e))),i.join("")}function vr(n,e){return typeof n=="string"&&(n=Et(n)),typeof e=="string"&&(e=Et(e)),n==null||n.length===0?n:Qr(function(t,r){var o,i,s,c,d,g,S=t.length,k=S-1;for(i=t[k],s=0,g=0|Math.floor(6+52/S);g>0;--g){for(c=(s=De(s+pn))>>>2&3,d=0;d<k;++d)o=t[d+1],i=t[d]=De(t[d]+Ct(s,o,i,d,c,r));o=t[0],i=t[k]=De(t[k]+Ct(s,o,i,k,c,r))}return t}(St(n,!0),St(Zr(e),!1)),!1)}function yr(n,e){return typeof n=="string"&&(n=function(t){for(var r=window.atob(t),o=r.length,i=new Uint8Array(o),s=0;s<o;s++)i[s]=r.charCodeAt(s);return i}(n)),typeof e=="string"&&(e=Et(e)),n==null||n.length===0?n:Qr(function(t,r){var o,i,s,c,d,g=t.length,S=g-1;for(o=t[0],s=De(Math.floor(6+52/g)*pn);s!==0;s=De(s-pn)){for(c=s>>>2&3,d=S;d>0;--d)i=t[d-1],o=t[d]=De(t[d]-Ct(s,o,i,d,c,r));i=t[S],o=t[0]=De(t[0]-Ct(s,o,i,0,c,r))}return t}(St(n,!1),St(Zr(e),!1)),!0)}const gn={toBytes:Et,toString:mr,encrypt:vr,encryptToString:function(n,e){return window.btoa(Ji(vr(n,e)))},decrypt:yr,decryptToString:function(n,e){return mr(yr(n,e))}};class Le extends Error{constructor(e,t){const r=new.target.prototype;super(`${e}: Status code '${t}'`),this.statusCode=t,this.__proto__=r}}class Cn extends Error{constructor(e="A timeout occurred."){const t=new.target.prototype;super(e),this.__proto__=t}}class ye extends Error{constructor(e="An abort occurred."){const t=new.target.prototype;super(e),this.__proto__=t}}class Gi extends Error{constructor(e,t){const r=new.target.prototype;super(e),this.transport=t,this.errorType="UnsupportedTransportError",this.__proto__=r}}class Qi extends Error{constructor(e,t){const r=new.target.prototype;super(e),this.transport=t,this.errorType="DisabledTransportError",this.__proto__=r}}class Zi extends Error{constructor(e,t){const r=new.target.prototype;super(e),this.transport=t,this.errorType="FailedToStartTransportError",this.__proto__=r}}class wr extends Error{constructor(e){const t=new.target.prototype;super(e),this.errorType="FailedToNegotiateWithServerError",this.__proto__=t}}class es extends Error{constructor(e,t){const r=new.target.prototype;super(e),this.innerErrors=t,this.__proto__=r}}class eo{constructor(e,t,r){this.statusCode=e,this.statusText=t,this.content=r}}class Lt{get(e,t){return this.send({...t,method:"GET",url:e})}post(e,t){return this.send({...t,method:"POST",url:e})}delete(e,t){return this.send({...t,method:"DELETE",url:e})}getCookieString(e){return""}}var E;(function(n){n[n.Trace=0]="Trace",n[n.Debug=1]="Debug",n[n.Information=2]="Information",n[n.Warning=3]="Warning",n[n.Error=4]="Error",n[n.Critical=5]="Critical",n[n.None=6]="None"})(E||(E={}));class Qe{constructor(){}log(e,t){}}Qe.instance=new Qe;class te{static isRequired(e,t){if(e==null)throw new Error(`The '${t}' argument is required.`)}static isNotEmpty(e,t){if(!e||e.match(/^\s*$/))throw new Error(`The '${t}' argument should not be empty.`)}static isIn(e,t,r){if(!(e in t))throw new Error(`Unknown ${r} value: ${e}.`)}}class Z{static get isBrowser(){return!Z.isNode&&typeof window=="object"&&typeof window.document=="object"}static get isWebWorker(){return!Z.isNode&&typeof self=="object"&&"importScripts"in self}static get isReactNative(){return!Z.isNode&&typeof window=="object"&&window.document===void 0}static get isNode(){return typeof process<"u"&&process.release&&process.release.name==="node"}}function Ze(n,e){let t="";return Pe(n)?(t=`Binary data of length ${n.byteLength}`,e&&(t+=`. Content: '${function(r){const o=new Uint8Array(r);let i="";return o.forEach(s=>{i+=`0x${s<16?"0":""}${s.toString(16)} `}),i.substr(0,i.length-1)}(n)}'`)):typeof n=="string"&&(t=`String data of length ${n.length}`,e&&(t+=`. Content: '${n}'`)),t}function Pe(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}async function to(n,e,t,r,o,i){const s={},[c,d]=ze();s[c]=d,n.log(E.Trace,`(${e} transport) sending data. ${Ze(o,i.logMessageContent)}.`);const g=Pe(o)?"arraybuffer":"text",S=await t.post(r,{content:o,headers:{...s,...i.headers},responseType:g,timeout:i.timeout,withCredentials:i.withCredentials});n.log(E.Trace,`(${e} transport) request complete. Response status: ${S.statusCode}.`)}class ts{constructor(e,t){this._subject=e,this._observer=t}dispose(){const e=this._subject.observers.indexOf(this._observer);e>-1&&this._subject.observers.splice(e,1),this._subject.observers.length===0&&this._subject.cancelCallback&&this._subject.cancelCallback().catch(t=>{})}}class kt{constructor(e){this._minLevel=e,this.out=console}log(e,t){if(e>=this._minLevel){const r=`[${new Date().toISOString()}] ${E[e]}: ${t}`;switch(e){case E.Critical:case E.Error:this.out.error(r);break;case E.Warning:this.out.warn(r);break;case E.Information:this.out.info(r);break;default:this.out.log(r)}}}}function ze(){let n="X-SignalR-User-Agent";return Z.isNode&&(n="User-Agent"),[n,ns("8.0.7",rs(),is(),os())]}function ns(n,e,t,r){let o="Microsoft SignalR/";const i=n.split(".");return o+=`${i[0]}.${i[1]}`,o+=` (${n}; `,o+=e&&e!==""?`${e}; `:"Unknown OS; ",o+=`${t}`,o+=r?`; ${r}`:"; Unknown Runtime Version",o+=")",o}function rs(){if(!Z.isNode)return"";switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}}function os(){if(Z.isNode)return process.versions.node}function is(){return Z.isNode?"NodeJS":"Browser"}function rn(n){return n.stack?n.stack:n.message?n.message:`${n}`}class ss extends Lt{constructor(e){if(super(),this._logger=e,typeof fetch>"u"||Z.isNode){const t=typeof __webpack_require__=="function"?__non_webpack_require__:require;this._jar=new(t("tough-cookie")).CookieJar,typeof fetch>"u"?this._fetchType=t("node-fetch"):this._fetchType=fetch,this._fetchType=t("fetch-cookie")(this._fetchType,this._jar)}else this._fetchType=fetch.bind(function(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("could not find global")}());if(typeof AbortController>"u"){const t=typeof __webpack_require__=="function"?__non_webpack_require__:require;this._abortControllerType=t("abort-controller")}else this._abortControllerType=AbortController}async send(e){if(e.abortSignal&&e.abortSignal.aborted)throw new ye;if(!e.method)throw new Error("No method defined.");if(!e.url)throw new Error("No url defined.");const t=new this._abortControllerType;let r;e.abortSignal&&(e.abortSignal.onabort=()=>{t.abort(),r=new ye});let o,i=null;if(e.timeout){const d=e.timeout;i=setTimeout(()=>{t.abort(),this._logger.log(E.Warning,"Timeout from HTTP request."),r=new Cn},d)}e.content===""&&(e.content=void 0),e.content&&(e.headers=e.headers||{},Pe(e.content)?e.headers["Content-Type"]="application/octet-stream":e.headers["Content-Type"]="text/plain;charset=UTF-8");try{o=await this._fetchType(e.url,{body:e.content,cache:"no-cache",credentials:e.withCredentials===!0?"include":"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",...e.headers},method:e.method,mode:"cors",redirect:"follow",signal:t.signal})}catch(d){throw r||(this._logger.log(E.Warning,`Error from HTTP request. ${d}.`),d)}finally{i&&clearTimeout(i),e.abortSignal&&(e.abortSignal.onabort=null)}if(!o.ok){const d=await _r(o,"text");throw new Le(d||o.statusText,o.status)}const s=_r(o,e.responseType),c=await s;return new eo(o.status,o.statusText,c)}getCookieString(e){let t="";return Z.isNode&&this._jar&&this._jar.getCookies(e,(r,o)=>t=o.join("; ")),t}}function _r(n,e){let t;switch(e){case"arraybuffer":t=n.arrayBuffer();break;case"text":default:t=n.text();break;case"blob":case"document":case"json":throw new Error(`${e} is not supported.`)}return t}class as extends Lt{constructor(e){super(),this._logger=e}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new ye):e.method?e.url?new Promise((t,r)=>{const o=new XMLHttpRequest;o.open(e.method,e.url,!0),o.withCredentials=e.withCredentials===void 0||e.withCredentials,o.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.content===""&&(e.content=void 0),e.content&&(Pe(e.content)?o.setRequestHeader("Content-Type","application/octet-stream"):o.setRequestHeader("Content-Type","text/plain;charset=UTF-8"));const i=e.headers;i&&Object.keys(i).forEach(s=>{o.setRequestHeader(s,i[s])}),e.responseType&&(o.responseType=e.responseType),e.abortSignal&&(e.abortSignal.onabort=()=>{o.abort(),r(new ye)}),e.timeout&&(o.timeout=e.timeout),o.onload=()=>{e.abortSignal&&(e.abortSignal.onabort=null),o.status>=200&&o.status<300?t(new eo(o.status,o.statusText,o.response||o.responseText)):r(new Le(o.response||o.responseText||o.statusText,o.status))},o.onerror=()=>{this._logger.log(E.Warning,`Error from HTTP request. ${o.status}: ${o.statusText}.`),r(new Le(o.statusText,o.status))},o.ontimeout=()=>{this._logger.log(E.Warning,"Timeout from HTTP request."),r(new Cn)},o.send(e.content)}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}}class cs extends Lt{constructor(e){if(super(),typeof fetch<"u"||Z.isNode)this._httpClient=new ss(e);else{if(typeof XMLHttpRequest>"u")throw new Error("No usable HttpClient found.");this._httpClient=new as(e)}}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new ye):e.method?e.url?this._httpClient.send(e):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(e){return this._httpClient.getCookieString(e)}}class ge{static write(e){return`${e}${ge.RecordSeparator}`}static parse(e){if(e[e.length-1]!==ge.RecordSeparator)throw new Error("Message is incomplete.");const t=e.split(ge.RecordSeparator);return t.pop(),t}}ge.RecordSeparatorCode=30,ge.RecordSeparator=String.fromCharCode(ge.RecordSeparatorCode);class ls{writeHandshakeRequest(e){return ge.write(JSON.stringify(e))}parseHandshakeResponse(e){let t,r;if(Pe(e)){const s=new Uint8Array(e),c=s.indexOf(ge.RecordSeparatorCode);if(c===-1)throw new Error("Message is incomplete.");const d=c+1;t=String.fromCharCode.apply(null,Array.prototype.slice.call(s.slice(0,d))),r=s.byteLength>d?s.slice(d).buffer:null}else{const s=e,c=s.indexOf(ge.RecordSeparator);if(c===-1)throw new Error("Message is incomplete.");const d=c+1;t=s.substring(0,d),r=s.length>d?s.substring(d):null}const o=ge.parse(t),i=JSON.parse(o[0]);if(i.type)throw new Error("Expected a handshake response from the server.");return[r,i]}}var z;(function(n){n[n.Invocation=1]="Invocation",n[n.StreamItem=2]="StreamItem",n[n.Completion=3]="Completion",n[n.StreamInvocation=4]="StreamInvocation",n[n.CancelInvocation=5]="CancelInvocation",n[n.Ping=6]="Ping",n[n.Close=7]="Close",n[n.Ack=8]="Ack",n[n.Sequence=9]="Sequence"})(z||(z={}));class us{constructor(){this.observers=[]}next(e){for(const t of this.observers)t.next(e)}error(e){for(const t of this.observers)t.error&&t.error(e)}complete(){for(const e of this.observers)e.complete&&e.complete()}subscribe(e){return this.observers.push(e),new ts(this,e)}}class hs{constructor(e,t,r){this._bufferSize=1e5,this._messages=[],this._totalMessageCount=0,this._waitForSequenceMessage=!1,this._nextReceivingSequenceId=1,this._latestReceivedSequenceId=0,this._bufferedByteCount=0,this._reconnectInProgress=!1,this._protocol=e,this._connection=t,this._bufferSize=r}async _send(e){const t=this._protocol.writeMessage(e);let r=Promise.resolve();if(this._isInvocationMessage(e)){this._totalMessageCount++;let o=()=>{},i=()=>{};Pe(t)?this._bufferedByteCount+=t.byteLength:this._bufferedByteCount+=t.length,this._bufferedByteCount>=this._bufferSize&&(r=new Promise((s,c)=>{o=s,i=c})),this._messages.push(new ds(t,this._totalMessageCount,o,i))}try{this._reconnectInProgress||await this._connection.send(t)}catch{this._disconnected()}await r}_ack(e){let t=-1;for(let r=0;r<this._messages.length;r++){const o=this._messages[r];if(o._id<=e.sequenceId)t=r,Pe(o._message)?this._bufferedByteCount-=o._message.byteLength:this._bufferedByteCount-=o._message.length,o._resolver();else{if(!(this._bufferedByteCount<this._bufferSize))break;o._resolver()}}t!==-1&&(this._messages=this._messages.slice(t+1))}_shouldProcessMessage(e){if(this._waitForSequenceMessage)return e.type===z.Sequence&&(this._waitForSequenceMessage=!1,!0);if(!this._isInvocationMessage(e))return!0;const t=this._nextReceivingSequenceId;return this._nextReceivingSequenceId++,t<=this._latestReceivedSequenceId?(t===this._latestReceivedSequenceId&&this._ackTimer(),!1):(this._latestReceivedSequenceId=t,this._ackTimer(),!0)}_resetSequence(e){e.sequenceId>this._nextReceivingSequenceId?this._connection.stop(new Error("Sequence ID greater than amount of messages we've received.")):this._nextReceivingSequenceId=e.sequenceId}_disconnected(){this._reconnectInProgress=!0,this._waitForSequenceMessage=!0}async _resend(){const e=this._messages.length!==0?this._messages[0]._id:this._totalMessageCount+1;await this._connection.send(this._protocol.writeMessage({type:z.Sequence,sequenceId:e}));const t=this._messages;for(const r of t)await this._connection.send(r._message);this._reconnectInProgress=!1}_dispose(e){e!=null||(e=new Error("Unable to reconnect to server."));for(const t of this._messages)t._rejector(e)}_isInvocationMessage(e){switch(e.type){case z.Invocation:case z.StreamItem:case z.Completion:case z.StreamInvocation:case z.CancelInvocation:return!0;case z.Close:case z.Sequence:case z.Ping:case z.Ack:return!1}}_ackTimer(){this._ackTimerHandle===void 0&&(this._ackTimerHandle=setTimeout(async()=>{try{this._reconnectInProgress||await this._connection.send(this._protocol.writeMessage({type:z.Ack,sequenceId:this._latestReceivedSequenceId}))}catch{}clearTimeout(this._ackTimerHandle),this._ackTimerHandle=void 0},1e3))}}class ds{constructor(e,t,r,o){this._message=e,this._id=t,this._resolver=r,this._rejector=o}}var G;(function(n){n.Disconnected="Disconnected",n.Connecting="Connecting",n.Connected="Connected",n.Disconnecting="Disconnecting",n.Reconnecting="Reconnecting"})(G||(G={}));class En{static create(e,t,r,o,i,s,c){return new En(e,t,r,o,i,s,c)}constructor(e,t,r,o,i,s,c){this._nextKeepAlive=0,this._freezeEventListener=()=>{this._logger.log(E.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://learn.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},te.isRequired(e,"connection"),te.isRequired(t,"logger"),te.isRequired(r,"protocol"),this.serverTimeoutInMilliseconds=i??3e4,this.keepAliveIntervalInMilliseconds=s??15e3,this._statefulReconnectBufferSize=c??1e5,this._logger=t,this._protocol=r,this.connection=e,this._reconnectPolicy=o,this._handshakeProtocol=new ls,this.connection.onreceive=d=>this._processIncomingData(d),this.connection.onclose=d=>this._connectionClosed(d),this._callbacks={},this._methods={},this._closedCallbacks=[],this._reconnectingCallbacks=[],this._reconnectedCallbacks=[],this._invocationId=0,this._receivedHandshakeResponse=!1,this._connectionState=G.Disconnected,this._connectionStarted=!1,this._cachedPingMessage=this._protocol.writeMessage({type:z.Ping})}get state(){return this._connectionState}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(e){if(this._connectionState!==G.Disconnected&&this._connectionState!==G.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!e)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=e}start(){return this._startPromise=this._startWithStateTransitions(),this._startPromise}async _startWithStateTransitions(){if(this._connectionState!==G.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));this._connectionState=G.Connecting,this._logger.log(E.Debug,"Starting HubConnection.");try{await this._startInternal(),Z.isBrowser&&window.document.addEventListener("freeze",this._freezeEventListener),this._connectionState=G.Connected,this._connectionStarted=!0,this._logger.log(E.Debug,"HubConnection connected successfully.")}catch(e){return this._connectionState=G.Disconnected,this._logger.log(E.Debug,`HubConnection failed to start successfully because of error '${e}'.`),Promise.reject(e)}}async _startInternal(){this._stopDuringStartError=void 0,this._receivedHandshakeResponse=!1;const e=new Promise((t,r)=>{this._handshakeResolver=t,this._handshakeRejecter=r});await this.connection.start(this._protocol.transferFormat);try{let t=this._protocol.version;this.connection.features.reconnect||(t=1);const r={protocol:this._protocol.name,version:t};if(this._logger.log(E.Debug,"Sending handshake request."),await this._sendMessage(this._handshakeProtocol.writeHandshakeRequest(r)),this._logger.log(E.Information,`Using HubProtocol '${this._protocol.name}'.`),this._cleanupTimeout(),this._resetTimeoutPeriod(),this._resetKeepAliveInterval(),await e,this._stopDuringStartError)throw this._stopDuringStartError;this.connection.features.reconnect&&(this._messageBuffer=new hs(this._protocol,this.connection,this._statefulReconnectBufferSize),this.connection.features.disconnected=this._messageBuffer._disconnected.bind(this._messageBuffer),this.connection.features.resend=()=>{if(this._messageBuffer)return this._messageBuffer._resend()}),this.connection.features.inherentKeepAlive||await this._sendMessage(this._cachedPingMessage)}catch(t){throw this._logger.log(E.Debug,`Hub handshake failed with error '${t}' during start(). Stopping HubConnection.`),this._cleanupTimeout(),this._cleanupPingTimer(),await this.connection.stop(t),t}}async stop(){const e=this._startPromise;this.connection.features.reconnect=!1,this._stopPromise=this._stopInternal(),await this._stopPromise;try{await e}catch{}}_stopInternal(e){if(this._connectionState===G.Disconnected)return this._logger.log(E.Debug,`Call to HubConnection.stop(${e}) ignored because it is already in the disconnected state.`),Promise.resolve();if(this._connectionState===G.Disconnecting)return this._logger.log(E.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;const t=this._connectionState;return this._connectionState=G.Disconnecting,this._logger.log(E.Debug,"Stopping HubConnection."),this._reconnectDelayHandle?(this._logger.log(E.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this._reconnectDelayHandle),this._reconnectDelayHandle=void 0,this._completeClose(),Promise.resolve()):(t===G.Connected&&this._sendCloseMessage(),this._cleanupTimeout(),this._cleanupPingTimer(),this._stopDuringStartError=e||new ye("The connection was stopped before the hub handshake could complete."),this.connection.stop(e))}async _sendCloseMessage(){try{await this._sendWithProtocol(this._createCloseMessage())}catch{}}stream(e,...t){const[r,o]=this._replaceStreamingParams(t),i=this._createStreamInvocation(e,t,o);let s;const c=new us;return c.cancelCallback=()=>{const d=this._createCancelInvocation(i.invocationId);return delete this._callbacks[i.invocationId],s.then(()=>this._sendWithProtocol(d))},this._callbacks[i.invocationId]=(d,g)=>{g?c.error(g):d&&(d.type===z.Completion?d.error?c.error(new Error(d.error)):c.complete():c.next(d.item))},s=this._sendWithProtocol(i).catch(d=>{c.error(d),delete this._callbacks[i.invocationId]}),this._launchStreams(r,s),c}_sendMessage(e){return this._resetKeepAliveInterval(),this.connection.send(e)}_sendWithProtocol(e){return this._messageBuffer?this._messageBuffer._send(e):this._sendMessage(this._protocol.writeMessage(e))}send(e,...t){const[r,o]=this._replaceStreamingParams(t),i=this._sendWithProtocol(this._createInvocation(e,t,!0,o));return this._launchStreams(r,i),i}invoke(e,...t){const[r,o]=this._replaceStreamingParams(t),i=this._createInvocation(e,t,!1,o);return new Promise((s,c)=>{this._callbacks[i.invocationId]=(g,S)=>{S?c(S):g&&(g.type===z.Completion?g.error?c(new Error(g.error)):s(g.result):c(new Error(`Unexpected message type: ${g.type}`)))};const d=this._sendWithProtocol(i).catch(g=>{c(g),delete this._callbacks[i.invocationId]});this._launchStreams(r,d)})}on(e,t){e&&t&&(e=e.toLowerCase(),this._methods[e]||(this._methods[e]=[]),this._methods[e].indexOf(t)===-1&&this._methods[e].push(t))}off(e,t){if(!e)return;e=e.toLowerCase();const r=this._methods[e];if(r)if(t){const o=r.indexOf(t);o!==-1&&(r.splice(o,1),r.length===0&&delete this._methods[e])}else delete this._methods[e]}onclose(e){e&&this._closedCallbacks.push(e)}onreconnecting(e){e&&this._reconnectingCallbacks.push(e)}onreconnected(e){e&&this._reconnectedCallbacks.push(e)}_processIncomingData(e){if(this._cleanupTimeout(),this._receivedHandshakeResponse||(e=this._processHandshakeResponse(e),this._receivedHandshakeResponse=!0),e){const t=this._protocol.parseMessages(e,this._logger);for(const r of t)if(!this._messageBuffer||this._messageBuffer._shouldProcessMessage(r))switch(r.type){case z.Invocation:this._invokeClientMethod(r).catch(o=>{this._logger.log(E.Error,`Invoke client method threw error: ${rn(o)}`)});break;case z.StreamItem:case z.Completion:{const o=this._callbacks[r.invocationId];if(o){r.type===z.Completion&&delete this._callbacks[r.invocationId];try{o(r)}catch(i){this._logger.log(E.Error,`Stream callback threw error: ${rn(i)}`)}}break}case z.Ping:break;case z.Close:{this._logger.log(E.Information,"Close message received from server.");const o=r.error?new Error("Server returned an error on close: "+r.error):void 0;r.allowReconnect===!0?this.connection.stop(o):this._stopPromise=this._stopInternal(o);break}case z.Ack:this._messageBuffer&&this._messageBuffer._ack(r);break;case z.Sequence:this._messageBuffer&&this._messageBuffer._resetSequence(r);break;default:this._logger.log(E.Warning,`Invalid message type: ${r.type}.`)}}this._resetTimeoutPeriod()}_processHandshakeResponse(e){let t,r;try{[r,t]=this._handshakeProtocol.parseHandshakeResponse(e)}catch(o){const i="Error parsing handshake response: "+o;this._logger.log(E.Error,i);const s=new Error(i);throw this._handshakeRejecter(s),s}if(t.error){const o="Server returned handshake error: "+t.error;this._logger.log(E.Error,o);const i=new Error(o);throw this._handshakeRejecter(i),i}return this._logger.log(E.Debug,"Server handshake complete."),this._handshakeResolver(),r}_resetKeepAliveInterval(){this.connection.features.inherentKeepAlive||(this._nextKeepAlive=new Date().getTime()+this.keepAliveIntervalInMilliseconds,this._cleanupPingTimer())}_resetTimeoutPeriod(){if(!(this.connection.features&&this.connection.features.inherentKeepAlive||(this._timeoutHandle=setTimeout(()=>this.serverTimeout(),this.serverTimeoutInMilliseconds),this._pingServerHandle!==void 0))){let e=this._nextKeepAlive-new Date().getTime();e<0&&(e=0),this._pingServerHandle=setTimeout(async()=>{if(this._connectionState===G.Connected)try{await this._sendMessage(this._cachedPingMessage)}catch{this._cleanupPingTimer()}},e)}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}async _invokeClientMethod(e){const t=e.target.toLowerCase(),r=this._methods[t];if(!r)return this._logger.log(E.Warning,`No client method with the name '${t}' found.`),void(e.invocationId&&(this._logger.log(E.Warning,`No result given for '${t}' method and invocation ID '${e.invocationId}'.`),await this._sendWithProtocol(this._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null))));const o=r.slice(),i=!!e.invocationId;let s,c,d;for(const g of o)try{const S=s;s=await g.apply(this,e.arguments),i&&s&&S&&(this._logger.log(E.Error,`Multiple results provided for '${t}'. Sending error to server.`),d=this._createCompletionMessage(e.invocationId,"Client provided multiple results.",null)),c=void 0}catch(S){c=S,this._logger.log(E.Error,`A callback for the method '${t}' threw error '${S}'.`)}d?await this._sendWithProtocol(d):i?(c?d=this._createCompletionMessage(e.invocationId,`${c}`,null):s!==void 0?d=this._createCompletionMessage(e.invocationId,null,s):(this._logger.log(E.Warning,`No result given for '${t}' method and invocation ID '${e.invocationId}'.`),d=this._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null)),await this._sendWithProtocol(d)):s&&this._logger.log(E.Error,`Result given for '${t}' method but server is not expecting a result.`)}_connectionClosed(e){this._logger.log(E.Debug,`HubConnection.connectionClosed(${e}) called while in state ${this._connectionState}.`),this._stopDuringStartError=this._stopDuringStartError||e||new ye("The underlying connection was closed before the hub handshake could complete."),this._handshakeResolver&&this._handshakeResolver(),this._cancelCallbacksWithError(e||new Error("Invocation canceled due to the underlying connection being closed.")),this._cleanupTimeout(),this._cleanupPingTimer(),this._connectionState===G.Disconnecting?this._completeClose(e):this._connectionState===G.Connected&&this._reconnectPolicy?this._reconnect(e):this._connectionState===G.Connected&&this._completeClose(e)}_completeClose(e){if(this._connectionStarted){this._connectionState=G.Disconnected,this._connectionStarted=!1,this._messageBuffer&&(this._messageBuffer._dispose(e??new Error("Connection closed.")),this._messageBuffer=void 0),Z.isBrowser&&window.document.removeEventListener("freeze",this._freezeEventListener);try{this._closedCallbacks.forEach(t=>t.apply(this,[e]))}catch(t){this._logger.log(E.Error,`An onclose callback called with error '${e}' threw error '${t}'.`)}}}async _reconnect(e){const t=Date.now();let r=0,o=e!==void 0?e:new Error("Attempting to reconnect due to a unknown error."),i=this._getNextRetryDelay(r++,0,o);if(i===null)return this._logger.log(E.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),void this._completeClose(e);if(this._connectionState=G.Reconnecting,e?this._logger.log(E.Information,`Connection reconnecting because of error '${e}'.`):this._logger.log(E.Information,"Connection reconnecting."),this._reconnectingCallbacks.length!==0){try{this._reconnectingCallbacks.forEach(s=>s.apply(this,[e]))}catch(s){this._logger.log(E.Error,`An onreconnecting callback called with error '${e}' threw error '${s}'.`)}if(this._connectionState!==G.Reconnecting)return void this._logger.log(E.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.")}for(;i!==null;){if(this._logger.log(E.Information,`Reconnect attempt number ${r} will start in ${i} ms.`),await new Promise(s=>{this._reconnectDelayHandle=setTimeout(s,i)}),this._reconnectDelayHandle=void 0,this._connectionState!==G.Reconnecting)return void this._logger.log(E.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");try{if(await this._startInternal(),this._connectionState=G.Connected,this._logger.log(E.Information,"HubConnection reconnected successfully."),this._reconnectedCallbacks.length!==0)try{this._reconnectedCallbacks.forEach(s=>s.apply(this,[this.connection.connectionId]))}catch(s){this._logger.log(E.Error,`An onreconnected callback called with connectionId '${this.connection.connectionId}; threw error '${s}'.`)}return}catch(s){if(this._logger.log(E.Information,`Reconnect attempt failed because of error '${s}'.`),this._connectionState!==G.Reconnecting)return this._logger.log(E.Debug,`Connection moved to the '${this._connectionState}' from the reconnecting state during reconnect attempt. Done reconnecting.`),void(this._connectionState===G.Disconnecting&&this._completeClose());o=s instanceof Error?s:new Error(s.toString()),i=this._getNextRetryDelay(r++,Date.now()-t,o)}}this._logger.log(E.Information,`Reconnect retries have been exhausted after ${Date.now()-t} ms and ${r} failed attempts. Connection disconnecting.`),this._completeClose()}_getNextRetryDelay(e,t,r){try{return this._reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:t,previousRetryCount:e,retryReason:r})}catch(o){return this._logger.log(E.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${e}, ${t}) threw error '${o}'.`),null}}_cancelCallbacksWithError(e){const t=this._callbacks;this._callbacks={},Object.keys(t).forEach(r=>{const o=t[r];try{o(null,e)}catch(i){this._logger.log(E.Error,`Stream 'error' callback called with '${e}' threw error: ${rn(i)}`)}})}_cleanupPingTimer(){this._pingServerHandle&&(clearTimeout(this._pingServerHandle),this._pingServerHandle=void 0)}_cleanupTimeout(){this._timeoutHandle&&clearTimeout(this._timeoutHandle)}_createInvocation(e,t,r,o){if(r)return o.length!==0?{arguments:t,streamIds:o,target:e,type:z.Invocation}:{arguments:t,target:e,type:z.Invocation};{const i=this._invocationId;return this._invocationId++,o.length!==0?{arguments:t,invocationId:i.toString(),streamIds:o,target:e,type:z.Invocation}:{arguments:t,invocationId:i.toString(),target:e,type:z.Invocation}}}_launchStreams(e,t){if(e.length!==0){t||(t=Promise.resolve());for(const r in e)e[r].subscribe({complete:()=>{t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(r)))},error:o=>{let i;i=o instanceof Error?o.message:o&&o.toString?o.toString():"Unknown error",t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(r,i)))},next:o=>{t=t.then(()=>this._sendWithProtocol(this._createStreamItemMessage(r,o)))}})}}_replaceStreamingParams(e){const t=[],r=[];for(let o=0;o<e.length;o++){const i=e[o];if(this._isObservable(i)){const s=this._invocationId;this._invocationId++,t[s]=i,r.push(s.toString()),e.splice(o,1)}}return[t,r]}_isObservable(e){return e&&e.subscribe&&typeof e.subscribe=="function"}_createStreamInvocation(e,t,r){const o=this._invocationId;return this._invocationId++,r.length!==0?{arguments:t,invocationId:o.toString(),streamIds:r,target:e,type:z.StreamInvocation}:{arguments:t,invocationId:o.toString(),target:e,type:z.StreamInvocation}}_createCancelInvocation(e){return{invocationId:e,type:z.CancelInvocation}}_createStreamItemMessage(e,t){return{invocationId:e,item:t,type:z.StreamItem}}_createCompletionMessage(e,t,r){return t?{error:t,invocationId:e,type:z.Completion}:{invocationId:e,result:r,type:z.Completion}}_createCloseMessage(){return{type:z.Close}}}const fs=[0,2e3,1e4,3e4,null];class br{constructor(e){this._retryDelays=e!==void 0?[...e,null]:fs}nextRetryDelayInMilliseconds(e){return this._retryDelays[e.previousRetryCount]}}class Ae{}Ae.Authorization="Authorization",Ae.Cookie="Cookie";class ps extends Lt{constructor(e,t){super(),this._innerClient=e,this._accessTokenFactory=t}async send(e){let t=!0;this._accessTokenFactory&&(!this._accessToken||e.url&&e.url.indexOf("/negotiate?")>0)&&(t=!1,this._accessToken=await this._accessTokenFactory()),this._setAuthorizationHeader(e);const r=await this._innerClient.send(e);return t&&r.statusCode===401&&this._accessTokenFactory?(this._accessToken=await this._accessTokenFactory(),this._setAuthorizationHeader(e),await this._innerClient.send(e)):r}_setAuthorizationHeader(e){e.headers||(e.headers={}),this._accessToken?e.headers[Ae.Authorization]=`Bearer ${this._accessToken}`:this._accessTokenFactory&&e.headers[Ae.Authorization]&&delete e.headers[Ae.Authorization]}getCookieString(e){return this._innerClient.getCookieString(e)}}var ne,ce;(function(n){n[n.None=0]="None",n[n.WebSockets=1]="WebSockets",n[n.ServerSentEvents=2]="ServerSentEvents",n[n.LongPolling=4]="LongPolling"})(ne||(ne={})),function(n){n[n.Text=1]="Text",n[n.Binary=2]="Binary"}(ce||(ce={}));class gs{constructor(){this._isAborted=!1,this.onabort=null}abort(){this._isAborted||(this._isAborted=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this._isAborted}}class Sr{get pollAborted(){return this._pollAbort.aborted}constructor(e,t,r){this._httpClient=e,this._logger=t,this._pollAbort=new gs,this._options=r,this._running=!1,this.onreceive=null,this.onclose=null}async connect(e,t){if(te.isRequired(e,"url"),te.isRequired(t,"transferFormat"),te.isIn(t,ce,"transferFormat"),this._url=e,this._logger.log(E.Trace,"(LongPolling transport) Connecting."),t===ce.Binary&&typeof XMLHttpRequest<"u"&&typeof new XMLHttpRequest().responseType!="string")throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");const[r,o]=ze(),i={[r]:o,...this._options.headers},s={abortSignal:this._pollAbort.signal,headers:i,timeout:1e5,withCredentials:this._options.withCredentials};t===ce.Binary&&(s.responseType="arraybuffer");const c=`${e}&_=${Date.now()}`;this._logger.log(E.Trace,`(LongPolling transport) polling: ${c}.`);const d=await this._httpClient.get(c,s);d.statusCode!==200?(this._logger.log(E.Error,`(LongPolling transport) Unexpected response code: ${d.statusCode}.`),this._closeError=new Le(d.statusText||"",d.statusCode),this._running=!1):this._running=!0,this._receiving=this._poll(this._url,s)}async _poll(e,t){try{for(;this._running;)try{const r=`${e}&_=${Date.now()}`;this._logger.log(E.Trace,`(LongPolling transport) polling: ${r}.`);const o=await this._httpClient.get(r,t);o.statusCode===204?(this._logger.log(E.Information,"(LongPolling transport) Poll terminated by server."),this._running=!1):o.statusCode!==200?(this._logger.log(E.Error,`(LongPolling transport) Unexpected response code: ${o.statusCode}.`),this._closeError=new Le(o.statusText||"",o.statusCode),this._running=!1):o.content?(this._logger.log(E.Trace,`(LongPolling transport) data received. ${Ze(o.content,this._options.logMessageContent)}.`),this.onreceive&&this.onreceive(o.content)):this._logger.log(E.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(r){this._running?r instanceof Cn?this._logger.log(E.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this._closeError=r,this._running=!1):this._logger.log(E.Trace,`(LongPolling transport) Poll errored after shutdown: ${r.message}`)}}finally{this._logger.log(E.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this._raiseOnClose()}}async send(e){return this._running?to(this._logger,"LongPolling",this._httpClient,this._url,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}async stop(){this._logger.log(E.Trace,"(LongPolling transport) Stopping polling."),this._running=!1,this._pollAbort.abort();try{await this._receiving,this._logger.log(E.Trace,`(LongPolling transport) sending DELETE request to ${this._url}.`);const e={},[t,r]=ze();e[t]=r;const o={headers:{...e,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials};let i;try{await this._httpClient.delete(this._url,o)}catch(s){i=s}i?i instanceof Le&&(i.statusCode===404?this._logger.log(E.Trace,"(LongPolling transport) A 404 response was returned from sending a DELETE request."):this._logger.log(E.Trace,`(LongPolling transport) Error sending a DELETE request: ${i}`)):this._logger.log(E.Trace,"(LongPolling transport) DELETE request accepted.")}finally{this._logger.log(E.Trace,"(LongPolling transport) Stop finished."),this._raiseOnClose()}}_raiseOnClose(){if(this.onclose){let e="(LongPolling transport) Firing onclose event.";this._closeError&&(e+=" Error: "+this._closeError),this._logger.log(E.Trace,e),this.onclose(this._closeError)}}}class ms{constructor(e,t,r,o){this._httpClient=e,this._accessToken=t,this._logger=r,this._options=o,this.onreceive=null,this.onclose=null}async connect(e,t){return te.isRequired(e,"url"),te.isRequired(t,"transferFormat"),te.isIn(t,ce,"transferFormat"),this._logger.log(E.Trace,"(SSE transport) Connecting."),this._url=e,this._accessToken&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(this._accessToken)}`),new Promise((r,o)=>{let i,s=!1;if(t===ce.Text){if(Z.isBrowser||Z.isWebWorker)i=new this._options.EventSource(e,{withCredentials:this._options.withCredentials});else{const c=this._httpClient.getCookieString(e),d={};d.Cookie=c;const[g,S]=ze();d[g]=S,i=new this._options.EventSource(e,{withCredentials:this._options.withCredentials,headers:{...d,...this._options.headers}})}try{i.onmessage=c=>{if(this.onreceive)try{this._logger.log(E.Trace,`(SSE transport) data received. ${Ze(c.data,this._options.logMessageContent)}.`),this.onreceive(c.data)}catch(d){return void this._close(d)}},i.onerror=c=>{s?this._close():o(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},i.onopen=()=>{this._logger.log(E.Information,`SSE connected to ${this._url}`),this._eventSource=i,s=!0,r()}}catch(c){return void o(c)}}else o(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"))})}async send(e){return this._eventSource?to(this._logger,"SSE",this._httpClient,this._url,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}stop(){return this._close(),Promise.resolve()}_close(e){this._eventSource&&(this._eventSource.close(),this._eventSource=void 0,this.onclose&&this.onclose(e))}}class vs{constructor(e,t,r,o,i,s){this._logger=r,this._accessTokenFactory=t,this._logMessageContent=o,this._webSocketConstructor=i,this._httpClient=e,this.onreceive=null,this.onclose=null,this._headers=s}async connect(e,t){let r;return te.isRequired(e,"url"),te.isRequired(t,"transferFormat"),te.isIn(t,ce,"transferFormat"),this._logger.log(E.Trace,"(WebSockets transport) Connecting."),this._accessTokenFactory&&(r=await this._accessTokenFactory()),new Promise((o,i)=>{let s;e=e.replace(/^http/,"ws");const c=this._httpClient.getCookieString(e);let d=!1;if(Z.isNode||Z.isReactNative){const g={},[S,k]=ze();g[S]=k,r&&(g[Ae.Authorization]=`Bearer ${r}`),c&&(g[Ae.Cookie]=c),s=new this._webSocketConstructor(e,void 0,{headers:{...g,...this._headers}})}else r&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(r)}`);s||(s=new this._webSocketConstructor(e)),t===ce.Binary&&(s.binaryType="arraybuffer"),s.onopen=g=>{this._logger.log(E.Information,`WebSocket connected to ${e}.`),this._webSocket=s,d=!0,o()},s.onerror=g=>{let S=null;S=typeof ErrorEvent<"u"&&g instanceof ErrorEvent?g.error:"There was an error with the transport",this._logger.log(E.Information,`(WebSockets transport) ${S}.`)},s.onmessage=g=>{if(this._logger.log(E.Trace,`(WebSockets transport) data received. ${Ze(g.data,this._logMessageContent)}.`),this.onreceive)try{this.onreceive(g.data)}catch(S){return void this._close(S)}},s.onclose=g=>{if(d)this._close(g);else{let S=null;S=typeof ErrorEvent<"u"&&g instanceof ErrorEvent?g.error:"WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",i(new Error(S))}}})}send(e){return this._webSocket&&this._webSocket.readyState===this._webSocketConstructor.OPEN?(this._logger.log(E.Trace,`(WebSockets transport) sending data. ${Ze(e,this._logMessageContent)}.`),this._webSocket.send(e),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this._webSocket&&this._close(void 0),Promise.resolve()}_close(e){this._webSocket&&(this._webSocket.onclose=()=>{},this._webSocket.onmessage=()=>{},this._webSocket.onerror=()=>{},this._webSocket.close(),this._webSocket=void 0),this._logger.log(E.Trace,"(WebSockets transport) socket closed."),this.onclose&&(!this._isCloseEvent(e)||e.wasClean!==!1&&e.code===1e3?e instanceof Error?this.onclose(e):this.onclose():this.onclose(new Error(`WebSocket closed with status code: ${e.code} (${e.reason||"no reason given"}).`)))}_isCloseEvent(e){return e&&typeof e.wasClean=="boolean"&&typeof e.code=="number"}}class ys{constructor(e,t={}){var r;if(this._stopPromiseResolver=()=>{},this.features={},this._negotiateVersion=1,te.isRequired(e,"url"),this._logger=(r=t.logger)===void 0?new kt(E.Information):r===null?Qe.instance:r.log!==void 0?r:new kt(r),this.baseUrl=this._resolveUrl(e),(t=t||{}).logMessageContent=t.logMessageContent!==void 0&&t.logMessageContent,typeof t.withCredentials!="boolean"&&t.withCredentials!==void 0)throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");t.withCredentials=t.withCredentials===void 0||t.withCredentials,t.timeout=t.timeout===void 0?1e5:t.timeout;let o=null,i=null;if(Z.isNode&&typeof require<"u"){const s=typeof __webpack_require__=="function"?__non_webpack_require__:require;o=s("ws"),i=s("eventsource")}Z.isNode||typeof WebSocket>"u"||t.WebSocket?Z.isNode&&!t.WebSocket&&o&&(t.WebSocket=o):t.WebSocket=WebSocket,Z.isNode||typeof EventSource>"u"||t.EventSource?Z.isNode&&!t.EventSource&&i!==void 0&&(t.EventSource=i):t.EventSource=EventSource,this._httpClient=new ps(t.httpClient||new cs(this._logger),t.accessTokenFactory),this._connectionState="Disconnected",this._connectionStarted=!1,this._options=t,this.onreceive=null,this.onclose=null}async start(e){if(e=e||ce.Binary,te.isIn(e,ce,"transferFormat"),this._logger.log(E.Debug,`Starting connection with transfer format '${ce[e]}'.`),this._connectionState!=="Disconnected")return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(this._connectionState="Connecting",this._startInternalPromise=this._startInternal(e),await this._startInternalPromise,this._connectionState==="Disconnecting"){const t="Failed to start the HttpConnection before stop() was called.";return this._logger.log(E.Error,t),await this._stopPromise,Promise.reject(new ye(t))}if(this._connectionState!=="Connected"){const t="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return this._logger.log(E.Error,t),Promise.reject(new ye(t))}this._connectionStarted=!0}send(e){return this._connectionState!=="Connected"?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this._sendQueue||(this._sendQueue=new kn(this.transport)),this._sendQueue.send(e))}async stop(e){return this._connectionState==="Disconnected"?(this._logger.log(E.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnected state.`),Promise.resolve()):this._connectionState==="Disconnecting"?(this._logger.log(E.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise):(this._connectionState="Disconnecting",this._stopPromise=new Promise(t=>{this._stopPromiseResolver=t}),await this._stopInternal(e),void await this._stopPromise)}async _stopInternal(e){this._stopError=e;try{await this._startInternalPromise}catch{}if(this.transport){try{await this.transport.stop()}catch(t){this._logger.log(E.Error,`HttpConnection.transport.stop() threw error '${t}'.`),this._stopConnection()}this.transport=void 0}else this._logger.log(E.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")}async _startInternal(e){let t=this.baseUrl;this._accessTokenFactory=this._options.accessTokenFactory,this._httpClient._accessTokenFactory=this._accessTokenFactory;try{if(this._options.skipNegotiation){if(this._options.transport!==ne.WebSockets)throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");this.transport=this._constructTransport(ne.WebSockets),await this._startTransport(t,e)}else{let r=null,o=0;do{if(r=await this._getNegotiationResponse(t),this._connectionState==="Disconnecting"||this._connectionState==="Disconnected")throw new ye("The connection was stopped during negotiation.");if(r.error)throw new Error(r.error);if(r.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(r.url&&(t=r.url),r.accessToken){const i=r.accessToken;this._accessTokenFactory=()=>i,this._httpClient._accessToken=i,this._httpClient._accessTokenFactory=void 0}o++}while(r.url&&o<100);if(o===100&&r.url)throw new Error("Negotiate redirection limit exceeded.");await this._createTransport(t,this._options.transport,r,e)}this.transport instanceof Sr&&(this.features.inherentKeepAlive=!0),this._connectionState==="Connecting"&&(this._logger.log(E.Debug,"The HttpConnection connected successfully."),this._connectionState="Connected")}catch(r){return this._logger.log(E.Error,"Failed to start the connection: "+r),this._connectionState="Disconnected",this.transport=void 0,this._stopPromiseResolver(),Promise.reject(r)}}async _getNegotiationResponse(e){const t={},[r,o]=ze();t[r]=o;const i=this._resolveNegotiateUrl(e);this._logger.log(E.Debug,`Sending negotiation request: ${i}.`);try{const s=await this._httpClient.post(i,{content:"",headers:{...t,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials});if(s.statusCode!==200)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${s.statusCode}'`));const c=JSON.parse(s.content);return(!c.negotiateVersion||c.negotiateVersion<1)&&(c.connectionToken=c.connectionId),c.useStatefulReconnect&&this._options._useStatefulReconnect!==!0?Promise.reject(new wr("Client didn't negotiate Stateful Reconnect but the server did.")):c}catch(s){let c="Failed to complete negotiation with the server: "+s;return s instanceof Le&&s.statusCode===404&&(c+=" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),this._logger.log(E.Error,c),Promise.reject(new wr(c))}}_createConnectUrl(e,t){return t?e+(e.indexOf("?")===-1?"?":"&")+`id=${t}`:e}async _createTransport(e,t,r,o){let i=this._createConnectUrl(e,r.connectionToken);if(this._isITransport(t))return this._logger.log(E.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=t,await this._startTransport(i,o),void(this.connectionId=r.connectionId);const s=[],c=r.availableTransports||[];let d=r;for(const g of c){const S=this._resolveTransportOrError(g,t,o,d?.useStatefulReconnect===!0);if(S instanceof Error)s.push(`${g.transport} failed:`),s.push(S);else if(this._isITransport(S)){if(this.transport=S,!d){try{d=await this._getNegotiationResponse(e)}catch(k){return Promise.reject(k)}i=this._createConnectUrl(e,d.connectionToken)}try{return await this._startTransport(i,o),void(this.connectionId=d.connectionId)}catch(k){if(this._logger.log(E.Error,`Failed to start the transport '${g.transport}': ${k}`),d=void 0,s.push(new Zi(`${g.transport} failed: ${k}`,ne[g.transport])),this._connectionState!=="Connecting"){const W="Failed to select transport before stop() was called.";return this._logger.log(E.Debug,W),Promise.reject(new ye(W))}}}}return s.length>0?Promise.reject(new es(`Unable to connect to the server with any of the available transports. ${s.join(" ")}`,s)):Promise.reject(new Error("None of the transports supported by the client are supported by the server."))}_constructTransport(e){switch(e){case ne.WebSockets:if(!this._options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new vs(this._httpClient,this._accessTokenFactory,this._logger,this._options.logMessageContent,this._options.WebSocket,this._options.headers||{});case ne.ServerSentEvents:if(!this._options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new ms(this._httpClient,this._httpClient._accessToken,this._logger,this._options);case ne.LongPolling:return new Sr(this._httpClient,this._logger,this._options);default:throw new Error(`Unknown transport: ${e}.`)}}_startTransport(e,t){return this.transport.onreceive=this.onreceive,this.features.reconnect?this.transport.onclose=async r=>{let o=!1;if(this.features.reconnect){try{this.features.disconnected(),await this.transport.connect(e,t),await this.features.resend()}catch{o=!0}o&&this._stopConnection(r)}else this._stopConnection(r)}:this.transport.onclose=r=>this._stopConnection(r),this.transport.connect(e,t)}_resolveTransportOrError(e,t,r,o){const i=ne[e.transport];if(i==null)return this._logger.log(E.Debug,`Skipping transport '${e.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${e.transport}' because it is not supported by this client.`);if(!function(s,c){return!s||!!(c&s)}(t,i))return this._logger.log(E.Debug,`Skipping transport '${ne[i]}' because it was disabled by the client.`),new Qi(`'${ne[i]}' is disabled by the client.`,i);{if(!(e.transferFormats.map(s=>ce[s]).indexOf(r)>=0))return this._logger.log(E.Debug,`Skipping transport '${ne[i]}' because it does not support the requested transfer format '${ce[r]}'.`),new Error(`'${ne[i]}' does not support ${ce[r]}.`);if(i===ne.WebSockets&&!this._options.WebSocket||i===ne.ServerSentEvents&&!this._options.EventSource)return this._logger.log(E.Debug,`Skipping transport '${ne[i]}' because it is not supported in your environment.'`),new Gi(`'${ne[i]}' is not supported in your environment.`,i);this._logger.log(E.Debug,`Selecting transport '${ne[i]}'.`);try{return this.features.reconnect=i===ne.WebSockets?o:void 0,this._constructTransport(i)}catch(s){return s}}}_isITransport(e){return e&&typeof e=="object"&&"connect"in e}_stopConnection(e){if(this._logger.log(E.Debug,`HttpConnection.stopConnection(${e}) called while in state ${this._connectionState}.`),this.transport=void 0,e=this._stopError||e,this._stopError=void 0,this._connectionState!=="Disconnected"){if(this._connectionState==="Connecting")throw this._logger.log(E.Warning,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${e}) was called while the connection is still in the connecting state.`);if(this._connectionState==="Disconnecting"&&this._stopPromiseResolver(),e?this._logger.log(E.Error,`Connection disconnected with error '${e}'.`):this._logger.log(E.Information,"Connection disconnected."),this._sendQueue&&(this._sendQueue.stop().catch(t=>{this._logger.log(E.Error,`TransportSendQueue.stop() threw error '${t}'.`)}),this._sendQueue=void 0),this.connectionId=void 0,this._connectionState="Disconnected",this._connectionStarted){this._connectionStarted=!1;try{this.onclose&&this.onclose(e)}catch(t){this._logger.log(E.Error,`HttpConnection.onclose(${e}) threw error '${t}'.`)}}}else this._logger.log(E.Debug,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is already in the disconnected state.`)}_resolveUrl(e){if(e.lastIndexOf("https://",0)===0||e.lastIndexOf("http://",0)===0)return e;if(!Z.isBrowser)throw new Error(`Cannot resolve '${e}'.`);const t=window.document.createElement("a");return t.href=e,this._logger.log(E.Information,`Normalizing '${e}' to '${t.href}'.`),t.href}_resolveNegotiateUrl(e){const t=new URL(e);t.pathname.endsWith("/")?t.pathname+="negotiate":t.pathname+="/negotiate";const r=new URLSearchParams(t.searchParams);return r.has("negotiateVersion")||r.append("negotiateVersion",this._negotiateVersion.toString()),r.has("useStatefulReconnect")?r.get("useStatefulReconnect")==="true"&&(this._options._useStatefulReconnect=!0):this._options._useStatefulReconnect===!0&&r.append("useStatefulReconnect","true"),t.search=r.toString(),t.toString()}}class kn{constructor(e){this._transport=e,this._buffer=[],this._executing=!0,this._sendBufferedData=new st,this._transportResult=new st,this._sendLoopPromise=this._sendLoop()}send(e){return this._bufferData(e),this._transportResult||(this._transportResult=new st),this._transportResult.promise}stop(){return this._executing=!1,this._sendBufferedData.resolve(),this._sendLoopPromise}_bufferData(e){if(this._buffer.length&&typeof this._buffer[0]!=typeof e)throw new Error(`Expected data to be of type ${typeof this._buffer} but was of type ${typeof e}`);this._buffer.push(e),this._sendBufferedData.resolve()}async _sendLoop(){for(;;){if(await this._sendBufferedData.promise,!this._executing){this._transportResult&&this._transportResult.reject("Connection stopped.");break}this._sendBufferedData=new st;const e=this._transportResult;this._transportResult=void 0;const t=typeof this._buffer[0]=="string"?this._buffer.join(""):kn._concatBuffers(this._buffer);this._buffer.length=0;try{await this._transport.send(t),e.resolve()}catch(r){e.reject(r)}}}static _concatBuffers(e){const t=e.map(i=>i.byteLength).reduce((i,s)=>i+s),r=new Uint8Array(t);let o=0;for(const i of e)r.set(new Uint8Array(i),o),o+=i.byteLength;return r.buffer}}class st{constructor(){this.promise=new Promise((e,t)=>[this._resolver,this._rejecter]=[e,t])}resolve(){this._resolver()}reject(e){this._rejecter(e)}}class ws{constructor(){this.name="json",this.version=2,this.transferFormat=ce.Text}parseMessages(e,t){if(typeof e!="string")throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!e)return[];t===null&&(t=Qe.instance);const r=ge.parse(e),o=[];for(const i of r){const s=JSON.parse(i);if(typeof s.type!="number")throw new Error("Invalid payload.");switch(s.type){case z.Invocation:this._isInvocationMessage(s);break;case z.StreamItem:this._isStreamItemMessage(s);break;case z.Completion:this._isCompletionMessage(s);break;case z.Ping:case z.Close:break;case z.Ack:this._isAckMessage(s);break;case z.Sequence:this._isSequenceMessage(s);break;default:t.log(E.Information,"Unknown message type '"+s.type+"' ignored.");continue}o.push(s)}return o}writeMessage(e){return ge.write(JSON.stringify(e))}_isInvocationMessage(e){this._assertNotEmptyString(e.target,"Invalid payload for Invocation message."),e.invocationId!==void 0&&this._assertNotEmptyString(e.invocationId,"Invalid payload for Invocation message.")}_isStreamItemMessage(e){if(this._assertNotEmptyString(e.invocationId,"Invalid payload for StreamItem message."),e.item===void 0)throw new Error("Invalid payload for StreamItem message.")}_isCompletionMessage(e){if(e.result&&e.error)throw new Error("Invalid payload for Completion message.");!e.result&&e.error&&this._assertNotEmptyString(e.error,"Invalid payload for Completion message."),this._assertNotEmptyString(e.invocationId,"Invalid payload for Completion message.")}_isAckMessage(e){if(typeof e.sequenceId!="number")throw new Error("Invalid SequenceId for Ack message.")}_isSequenceMessage(e){if(typeof e.sequenceId!="number")throw new Error("Invalid SequenceId for Sequence message.")}_assertNotEmptyString(e,t){if(typeof e!="string"||e==="")throw new Error(t)}}const _s={trace:E.Trace,debug:E.Debug,info:E.Information,information:E.Information,warn:E.Warning,warning:E.Warning,error:E.Error,critical:E.Critical,none:E.None};class bs{configureLogging(e){if(te.isRequired(e,"logging"),e.log!==void 0)this.logger=e;else if(typeof e=="string"){const t=function(r){const o=_s[r.toLowerCase()];if(o!==void 0)return o;throw new Error(`Unknown log level: ${r}`)}(e);this.logger=new kt(t)}else this.logger=new kt(e);return this}withUrl(e,t){return te.isRequired(e,"url"),te.isNotEmpty(e,"url"),this.url=e,this.httpConnectionOptions=typeof t=="object"?{...this.httpConnectionOptions,...t}:{...this.httpConnectionOptions,transport:t},this}withHubProtocol(e){return te.isRequired(e,"protocol"),this.protocol=e,this}withAutomaticReconnect(e){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return e?Array.isArray(e)?this.reconnectPolicy=new br(e):this.reconnectPolicy=e:this.reconnectPolicy=new br,this}withServerTimeout(e){return te.isRequired(e,"milliseconds"),this._serverTimeoutInMilliseconds=e,this}withKeepAliveInterval(e){return te.isRequired(e,"milliseconds"),this._keepAliveIntervalInMilliseconds=e,this}withStatefulReconnect(e){return this.httpConnectionOptions===void 0&&(this.httpConnectionOptions={}),this.httpConnectionOptions._useStatefulReconnect=!0,this._statefulReconnectBufferSize=e?.bufferSize,this}build(){const e=this.httpConnectionOptions||{};if(e.logger===void 0&&(e.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");const t=new ys(this.url,e);return En.create(t,this.logger||Qe.instance,this.protocol||new ws,this.reconnectPolicy,this._serverTimeoutInMilliseconds,this._keepAliveIntervalInMilliseconds,this._statefulReconnectBufferSize)}}function ia(n){const e=new bs().configureLogging(E.Information).withUrl(n).withAutomaticReconnect({nextRetryDelayInMilliseconds:()=>5e3}).build();return e.keepAliveIntervalInMilliseconds=15e3,e.serverTimeoutInMilliseconds=18e5,e.start().then(()=>{$.Logger().info("启动SignalR连接！")}),e.onclose(async()=>{$.Logger().info("断开SignalR连接!")}),e.onreconnecting(()=>{$.Logger().warn("SignalR服务已断线，重连中...！")}),e.onreconnected(()=>{$.Logger().warn("SignalR重连成功!")}),e}const mn=new Set;function Cr(n){return n!==null?parseFloat(n):0}function at(n){const e=window.getComputedStyle(n),t=Math.ceil([e.paddingLeft,e.width,e.paddingRight].map(Cr).reduce((o,i)=>o+i)),r=Math.ceil([e.paddingTop,e.height,e.paddingBottom].map(Cr).reduce((o,i)=>o+i));return{width:t,height:r}}class Ss{width;height;constructor(e,t){this.width=e,this.height=t}}function Cs(n){const e=n.windowEl;if(e){const t=parseFloat(e.style.left||"NaN"),r=parseFloat(e.style.top||"NaN");if(!isNaN(t)&&!isNaN(r))return{left:t,top:r}}return null}function Es(n,e,t,r){const o=n-t,i=e-r;return o*o+i*i}window.addEventListener("resize",n=>{mn.forEach(e=>{e&&Si(e.fixPosition)&&e.fixPosition()})});const ct=[];var Er=Be({name:"VWindow",props:{windowStyle:{type:Object,required:!0},isOpen:{type:Boolean,required:!1,default:!0},title:{type:String,required:!0,default:""},closeButton:{type:Boolean,required:!1,default:!0},resizable:{type:Boolean,required:!1,default:!1},isScrollable:{type:Boolean,required:!1,default:!1},padding:{type:Number,required:!1,default:8},activateWhenOpen:{type:Boolean,required:!1,default:!0},positionHint:{type:String,required:!1,default:""},zGroup:{type:Number,required:!1,default:1},overflow:{type:String,required:!1,default:"visible"},minWidth:{type:Number,required:!1,default:1},minHeight:{type:Number,required:!1,default:0},maxWidth:{type:Number,required:!1,default:0},maxHeight:{type:Number,required:!1,default:0},height:{type:Number,required:!1},width:{type:Number,required:!1},top:{type:Number,required:!1},left:{type:Number,required:!1}},components:{myButton:vt},setup(n,{emit:e}){const t=di();if(!t)return;const{proxy:r}=t;let o=0,i,s,c;const d=Y(n.isOpen),g=()=>{ct.push(r),c=new vi(n.zGroup,S),n.isOpen&&function(A){Br(()=>{o++==0&&(m(r),function(){const T=k.value,{width:L,height:H}=un(T);let U,M;if(n.left!==void 0!=(n.top!==void 0))throw new Error("Either of left or top is specified. Both must be set or not set.");if(typeof n.left=="number")U=n.left,M=n.top;else{const q=n.positionHint||"auto";switch(q){case"auto":{let F=20,le=50,oe=0;do{if(ct.every(we=>{if(!we.isOpen||r==we)return!0;const tt=Cs(we);if(tt==null)return!0;const{left:Pt,top:me}=tt;return Es(Pt,me,F,le)>16}))break;F=(F+40)%(window.innerWidth-200),le=(le+40)%(window.innerHeight-200)}while(++oe<100);U=F,M=le}break;case"center":U=(window.innerWidth-L)/2,M=(window.innerHeight-H)/2;break;default:try{const F=q.split("/").map(Number);if(F.length!=2)throw null;const[le,oe]=F;if(!isFinite(le)||!isFinite(oe))throw null;U=le>=0?le:window.innerWidth-L+le,M=oe>=0?oe:window.innerHeight-H+oe}catch{throw new Error(`invalid position string: ${q}`)}}}T&&(T.style.left=`${U}px`,T.style.top=`${M}px`)}()),n.resizable&&p(),P(),i=new mi(W.value,k.value,{onMove:()=>P(),onMoveStart:()=>e("move-start"),onMoveEnd:()=>e("move-end")}),n.resizable&&function(){const{height:T}=un(W.value);s=new wi(k.value,{onResize:()=>p(),onResizeStart:()=>e("resize-start"),onResizeEnd:()=>e("resize-end"),minWidth:n.minWidth,minHeight:n.minHeight+T,maxWidth:n.maxWidth,maxHeight:n.maxHeight?n.maxHeight+T:void 0})}()}),n.activateWhenOpen&&D()}(),mn.add(r)};function S(A){f.value.zIndex=`${A}`}const k=Y(null),W=Y(null),N=Y(null);function D(){c.raise(),e("activate")}const f=Y({...n.windowStyle.window,zIndex:"auto",overflow:n.overflow}),l=He(()=>n.windowStyle.titlebar),v=He(()=>{const A={...n.windowStyle.content};return n.resizable?A.padding="0":n.padding!=null&&(A.padding=`${n.padding}px`),n.isScrollable&&(A.overflow="auto"),A});function m(A){const{width:T,height:L,top:H,left:U}=A,M=k;if(M&&T!=null&&(M.value.style.width=`${T}px`),L!=null){const q=W.value;if(q){const F=at(q).height;M.value.style.height=`${L+F}px`}}M&&U!=null&&(M.value.style.left=`${U}px`),M&&H!=null&&(M.value.style.top=`${H}px`)}function p(A=!0){const T=k.value,L=W.value,H=N.value;if(H&&T&&L){const{width:U,height:M}=at(H),{width:q,height:F}=at(T),le=at(L).height,oe=q-(H.offsetWidth-U),we=F-le-(H.offsetHeight-M);H.style.width=`${oe}px`,H.style.height=`${we}px`,y(),e("resize",new Ss(oe,we)),A&&(e("update:width",oe),e("update:height",we))}}function y(){const A=k.value;if(A){const T=A.getBoundingClientRect();T.left<0&&(f.value.left="0px"),T.top<0&&(f.value.top="0px"),T.right>window.innerWidth&&(f.value.left=window.innerWidth-T.width+"px"),T.bottom>window.innerHeight&&(f.value.top=window.innerHeight-T.height+"px")}}function P(A=!0){y();const T=k.value;if(T){const{left:L,top:H}=T.getBoundingClientRect();A&&(e("update:left",L),e("update:top",H))}}return Me(()=>n.isOpen,A=>{d.value=A}),Me(()=>n.zGroup,A=>{c.group=A}),Me(()=>n.width,A=>{m({width:A}),p(!1)}),Me(()=>n.height,A=>{m({height:A}),p(!1)}),_n(()=>{g()}),ui(()=>{mn.delete(this),c.unregister(),s&&s.teardown(),i&&i.teardown(),ct.splice(ct.indexOf(r),1)}),{isOpen:d,windowEl:k,titlebar:W,content:N,activate:D,styleWindow:f,styleTitlebar:l,styleContent:v,closeButtonClick:function(){d.value=!1,e("closebuttonclick")},fixPosition:y}}});const ks={class:"title"};var kr;Er.render=function(n,e,t,r,o,i){const s=It("myButton");return X(),ee(Dr,{name:"fade",onAfterLeave:e[2]||(e[2]=c=>n.$emit("close")),onAfterEnter:e[3]||(e[3]=c=>n.$emit("open")),persisted:""},{default:be(()=>[Lr(Q("div",{class:"window",style:ve(n.styleWindow),ref:"windowEl",onMousedown:e[0]||(e[0]=(...c)=>n.activate&&n.activate(...c)),onTouchstart:e[1]||(e[1]=(...c)=>n.activate&&n.activate(...c))},[Q("div",{class:"titlebar",style:ve(n.styleTitlebar),ref:"titlebar"},[Q("div",ks,[n.$slots.title?ae(n.$slots,"title",{key:0}):(X(),pe(Te,{key:1},[ln(wn(n.title),1)],64))]),n.closeButton?(X(),ee(s,{key:0,windowStyle:n.windowStyle,onClick:n.closeButtonClick},{default:be(()=>e[4]||(e[4]=[ln("×")])),_:1},8,["windowStyle","onClick"])):re("v-if",!0)],4),Q("div",{class:"content",style:ve(n.styleContent),ref:"content"},[ae(n.$slots,"default")],4)],36),[[Ar,n.isOpen]])]),_:3})},Er.__file="src/controls/vuewindow/window/index.vue",function(n){n[n.StyleBlack=0]="StyleBlack",n[n.StyleWhite=1]="StyleWhite",n[n.StyleMetal=2]="StyleMetal",n[n.StyleGrayblue=3]="StyleGrayblue"}(kr||(kr={}));var he;(function(n){n[n.top=0]="top",n[n.bottom=1]="bottom",n[n.centerBack=2]="centerBack",n[n.centerMain=3]="centerMain",n[n.centerFront=4]="centerFront",n[n.left=5]="left",n[n.right=6]="right"})(he||(he={}));class xs{layoutState;layoutMap=new Map;preConditionMap=new Map;widgetsLoadedSet=new Set;widgetConfig=new Array;_LayoutID;_mapItemRefs;constructor(e,t,r,o){this.layoutState=e,this._LayoutID=r,this._mapItemRefs=o,t.forEach(i=>{if(i.layoutID===r&&(this.widgetConfig.push(i),i.afterid))if(this.preConditionMap.has(i.afterid))this.preConditionMap.get(i.afterid)?.add(i);else{const s=new Set;s.add(i),this.preConditionMap.set(i.afterid,s)}})}getLayoutID(){return this._LayoutID}getWidgetConfig(){return this.widgetConfig}preloadWidgets(){this.widgetConfig.filter(e=>e.preload&&!e.afterid).forEach(e=>{this._loadWidget(e)})}async loadWidget(e){if(!e)return;let t;if(Mt(e)?t=e:yt(e)&&(t=this.widgetConfig.find(r=>r.id===e)),t){if(t.afterid){if(this.isWidgetLoaded(t.afterid))return this._loadWidget(t);{let r=function(c){c.layoutID===o._LayoutID&&c.widgetID===i&&(o._loadWidget(s),$.EventBus.off(de.WidgetLoadedEvent,r))};const o=this,i=t.afterid,s=t;return $.EventBus.on(de.WidgetLoadedEvent,r),this.loadWidget(t.afterid)}}return this._loadWidget(t)}}loadOtherDependenceWidgets(e){this.preConditionMap.has(e)&&this.preConditionMap.get(e)?.forEach(t=>{t.preload&&this._loadWidget(t)})}_loadWidget(e){if(!this.widgetsLoadedSet.has(e.id))return e.component?e.component().then(t=>{if(t.default){const r=hi(t.default);r.id=e.id,e.layout&&(r.style=e.layout),e.cssClass&&(r.cssClass=e.cssClass),e.layoutID&&(r.layoutID=e.layoutID),e.label&&(r.label=e.label),e.jsURL&&(r.jsURL=e.jsURL),e.cssURL&&(r.cssURL=e.cssURL),this.getContainerComponents(e.container).value.set(e.id,r),this.widgetsLoadedSet.add(e.id),Br().then(()=>{$.EventBus.emit(de.WidgetLoadedEvent,{layoutID:this._LayoutID,widgetID:e.id}),this.loadOtherDependenceWidgets(e.id)})}}).catch(t=>{$.Logger().error("加载Widget失败！",e,t),$.EventBus.emit(de.WidgetLoadedErrorEvent,e)}):void 0;this.changeWidgetVisible(e.id,!0)}hasDependentWidgets(e){let t=!1;if(this.preConditionMap.has(e)){const r=this.preConditionMap.get(e);if(r){for(const o of r)if(this.isWidgetLoaded(o.id)){t=!0;break}}}return t}unloadWidget(e){if(!e||!this.isWidgetLoaded(e))return;const t=this.widgetConfig.find(r=>r.id===e);if(t){if(this.preConditionMap.has(e)){const r=this.preConditionMap.get(e);if(r)for(const o of r)this.unloadWidget(o.id)}this.getContainerComponents(t.container).value.delete(e),this.widgetsLoadedSet.delete(e),this._mapItemRefs&&this._mapItemRefs.delete(e),$.EventBus.emit(de.WidgetUnLoadedEvent,{layoutID:this._LayoutID,widgetID:e})}}isWidgetLoaded(e){return this.widgetsLoadedSet.has(e)}splitTwoContainer(e=!1){const t=this.layoutState.centerMainContainer,r=this.layoutState.centerBackContainer;e?(t&&(t.style.left="0",t.style.width="100%"),r&&(r.style.width="100%")):(t&&(t.style.left="50%",t.style.width="50%"),r&&(r.style.width="50%"))}getLayoutContainer(e){switch(e){case he.top:return this.layoutState.topContainer;case he.bottom:return this.layoutState.bottomContainer;case he.left:return this.layoutState.leftContainer;case he.right:return this.layoutState.rightContainer;case he.centerBack:return this.layoutState.centerBackContainer;case he.centerMain:return this.layoutState.centerMainContainer;case he.centerFront:return this.layoutState.centerFrontContainer}}changeContainerVisible(e,t=!1){const r=this.getLayoutContainer(e);r&&(r.style.visibility=t?"visible":"hidden")}changeWidgetVisible(e,t=!1){const r=this.getWidgetComponent(e);r&&r.changeVisible&&r.changeVisible(t)}isWidgetVisible(e){const t=this.getWidgetComponent(e);return!!t&&(!t.isShow||t.isShow.value)}getWidgetComponent(e){if(this.widgetsLoadedSet.has(e)&&this._mapItemRefs)return this._mapItemRefs.get(e)}getWigetItem(e){return this.widgetConfig.find(t=>t.id===e)}getGroupWigetItems(e){return this.widgetConfig.filter(t=>t.group===e)}getContainerComponents(e){if(this.layoutMap.has(e))return this.layoutMap.get(e);{const t=Y(new Map);return this.layoutMap.set(e,t),t}}getWidgetLoadedIDList(){const e=[];return this.widgetsLoadedSet.forEach(t=>{e.push(t)}),e}unloadAllWidgets(e){const t=[];this.widgetsLoadedSet.forEach(r=>{e&&e.length>0?e.findIndex(o=>o===r)<0&&t.push(r):t.push(r)}),t.forEach(r=>this.unloadWidget(r))}unloadWidgets(e){e&&e.length>0&&e.forEach(t=>{this.unloadWidget(t)})}static getLayoutManager(e,t){if(t){const r=t.find(o=>o.id===e);if(r&&r.layoutID)return $.LayoutMap.get(r.layoutID)}}}var xt=Be({name:"SuspenseWithError",setup(){const n=Y(null);return si(e=>(n.value="当前页面存在问题，无法渲染……",!0)),{error:n}}});xt.render=function(n,e,t,r,o,i){return n.error?ae(n.$slots,"error",{key:0},()=>[ln(wn(n.error),1)]):(X(),ee(ii,{key:1},{default:be(()=>[ae(n.$slots,"default")]),fallback:be(()=>[ae(n.$slots,"fallback")]),_:3}))},xt.__file="src/controls/routertransition/SuspenseWithError.vue";var no=Be({name:"RouterTransition",__name:"RouterTransition",setup:n=>(e,t)=>{const r=It("router-view");return X(),ee(xt,null,{default:be(()=>[_t(r,null,{default:be(({Component:o,route:i})=>[re(" <transition> "),(X(),ee(Pr,null,[i.meta.keepAlive?(X(),ee(_e(o),{key:i.name})):re("v-if",!0)],1024)),i.meta.keepAlive?re("v-if",!0):(X(),ee(_e(o),{key:i.name})),re(" </transition> ")]),_:1})]),_:1})}});no.__file="src/controls/routertransition/RouterTransition.vue";var on=Be({name:"LayoutContainer",props:{widgetConfig:{type:Array,required:!0,default:()=>[]},layoutID:{type:String,default:void 0},layoutStyle:{type:Object},enableRouterView:{type:Boolean,default:!0}},emits:["containerLoaded"],components:{RouterTransition:no},setup(n,{attrs:e,slots:t,emit:r}){const o=n.layoutID,i=Y(n.enableRouterView);Me(()=>n.enableRouterView,()=>{i.value=n.enableRouterView});const s=Mr({topContainer:void 0,centerBackContainer:void 0,centerMainContainer:void 0,centerFrontContainer:void 0,bottomContainer:void 0,leftContainer:void 0,rightContainer:void 0}),c=new Map,d=new xs(s,n.widgetConfig,o,c),g=f(he.top),S=f(he.centerBack),k=f(he.centerFront),W=f(he.left),N=f(he.right),D=f(he.bottom);function f(v){return d?.getContainerComponents(v)}const l=He(()=>n.layoutStyle);return _n(()=>{d&&(o?$.LayoutMap.set(o,d):($.LayoutManager=d,$.LayoutMap.set("",d)),d.preloadWidgets(),r("containerLoaded",{layoutID:o,layoutManager:d}),$.EventBus.emit(de.LayoutContainerLoaded,{layoutID:o,layoutManager:d}))}),{...ai(s),topContainerComponents:g,centerbackComponents:S,centerfrontComponents:k,leftContainerComponents:W,rightContainerComponents:N,bottomContainerComponents:D,containerStyle:l,isEnableRouterView:i,setItemRef:(v,m)=>{v&&c.set(m,v)}}}});const Is={ref:"topContainer",class:"topContainer"},Ts={key:0,ref:"centerMainContainer",class:"centerdiv mainContainer"},Rs={ref:"centerBackContainer",class:"centerdiv backContainer"},Ms={ref:"centerFrontContainer",class:"centerdiv centerFrontContainer"},Ds={ref:"leftContainer",class:"leftContainer"},Ls={ref:"rightContainer",class:"rightContainer"},As={ref:"bottomContainer",class:"bottomContainer"};on.render=function(n,e,t,r,o,i){const s=It("router-transition");return X(),pe("div",{class:"layoutContainer",style:ve(n.containerStyle)},[Q("div",Is,[ae(n.$slots,"top"),(X(!0),pe(Te,null,We(n.topContainerComponents,([c,d])=>(X(),ee(_e(d),{ref_for:!0,ref:g=>n.setItemRef(g,c),key:c,style:ve(d.style),class:Re(d.cssClass)},null,8,["style","class"]))),128))],512),Q("div",null,[re(" 主要容器-底部 "),n.isEnableRouterView?(X(),pe("div",Ts,[ae(n.$slots,"main",{},()=>[_t(s)])],512)):re("v-if",!0),re(" 上一层-主容器 "),Q("div",Rs,[ae(n.$slots,"back"),(X(!0),pe(Te,null,We(n.centerbackComponents,([c,d])=>(X(),ee(_e(d),{ref_for:!0,ref:g=>n.setItemRef(g,c),key:c,style:ve(d.style),class:Re(d.cssClass)},null,8,["style","class"]))),128))],512),re(" 最上浮动-主容器 "),Q("div",Ms,[ae(n.$slots,"front"),(X(!0),pe(Te,null,We(n.centerfrontComponents,([c,d])=>(X(),ee(_e(d),{ref_for:!0,ref:g=>n.setItemRef(g,c),key:c,style:ve(d.style),class:Re(d.cssClass)},null,8,["style","class"]))),128))],512),Q("div",Ds,[ae(n.$slots,"left"),(X(!0),pe(Te,null,We(n.leftContainerComponents,([c,d])=>(X(),ee(_e(d),{ref_for:!0,ref:g=>n.setItemRef(g,c),key:c,style:ve(d.style),class:Re(d.cssClass)},null,8,["style","class"]))),128))],512),Q("div",Ls,[ae(n.$slots,"right"),(X(!0),pe(Te,null,We(n.rightContainerComponents,([c,d])=>(X(),ee(_e(d),{ref_for:!0,ref:g=>n.setItemRef(g,c),key:c,style:ve(d.style),class:Re(d.cssClass)},null,8,["style","class"]))),128))],512)]),Q("div",As,[ae(n.$slots,"bottom"),(X(!0),pe(Te,null,We(n.bottomContainerComponents,([c,d])=>(X(),ee(_e(d),{ref_for:!0,ref:g=>n.setItemRef(g,c),key:c,style:ve(d.style),class:Re(d.cssClass)},null,8,["style","class"]))),128))],512),re(" 增加默认插槽 "),ae(n.$slots,"default")],4)},on.__scopeId="data-v-4d081e5c",on.__file="src/controls/layoutcontainer/layout.vue";var Ps=Be({name:"RouterTransition",__name:"RouterTransitionAnimate",props:{enterActive:{type:String,required:!1,default:"animated fadeIn"},leaveActive:{type:String,required:!1,default:"animated fadeOut"}},setup:n=>(e,t)=>{const r=It("router-view");return X(),ee(xt,null,{default:be(()=>[_t(r,null,{default:be(({Component:o,route:i})=>[_t(ci,{appear:"","enter-active-class":e.enterActive,"leave-active-class":e.leaveActive},{default:be(()=>[(X(),ee(Pr,null,[i.meta.keepAlive?(X(),ee(_e(o),{key:i.name})):re("v-if",!0)],1024)),i.meta.keepAlive?re("v-if",!0):(X(),ee(_e(o),{key:i.name}))]),_:2},1032,["enter-active-class","leave-active-class"])]),_:1})]),_:1})}});Ps.__file="src/controls/routertransition/RouterTransitionAnimate.vue";const Xe=new Map,wt=Y(new Map);class lt{static addWindowPanel(e){Xe.set(e.id,e)}static removeWindowPanel(e){Xe.has(e)&&(Xe.delete(e),wt.value.delete(e))}static minimizeWindowPanel(e){Xe.has(e)&&wt.value.set(e,-1)}static openWindowPanel(e){Xe.has(e)&&wt.value.set(e,1)}}const Bs=["src"],Ns={key:1,class:"paneltitle"},Ws={class:"dragPanelBar"},$s={class:"dragPanelContent"},js={class:"drag-pointer-group"};var xr=Be({__name:"XWindow",props:{top:{type:[String,Number],default:0},left:{type:[String,Number],default:0},nWidth:{type:[String,Number],default:"300px"},nHeight:{type:[String,Number],default:"400px"},icon:{type:String,default:"img/logo.png"},title:{type:String,default:""},titleHeight:{type:[String,Number],default:"40px"},hasMin:{type:Boolean,default:!0},hasMax:{type:Boolean,default:!1},hasClose:{type:Boolean,default:!0},isDark:{type:Boolean,default:!1},pid:{type:String,default:""},tag:{type:[String,Array,Object,Number],default:""}},emits:["close","open","loaded","minimize"],setup(n,{expose:e,emit:t}){const r=Ti(),o=n,i=t,s=Y(),c=Y(),d=He(()=>o.isDark),g=Y({x:0,y:0}),S=250,k=100,W=Y({width:0,height:0}),N=M=>{s.value&&(s.value.style.left=`${M.x}px`,s.value.style.top=`${M.y}px`)};Me(()=>g.value,M=>{N(M)});const D=M=>{s.value&&(s.value.style.width=`${M.width}px`,s.value.style.height=`${M.height}px`)};Me(()=>W.value,M=>{D(M)});const f={eventListenerController:null,startingEdges:null,newEdges:null,clickStart:null,mount:()=>{Object.entries(f.refs).forEach(([M,q])=>{q.value&&q.value.addEventListener("mousedown",F=>{f.mouseDown(F,M)})})},mouseDown:(M,q)=>{M.button==0&&(M.preventDefault(),f.startingEdges={left:g.value.x,top:g.value.y,right:g.value.x+W.value.width,bottom:g.value.y+W.value.height},f.newEdges={...f.startingEdges},f.clickStart={x:M.clientX,y:M.clientY},f.eventListenerController=new AbortController,document.addEventListener("mousemove",F=>{f.mouseMove(F,q)},{signal:f.eventListenerController.signal}),document.addEventListener("mouseup",F=>{f.mouseUp(F,q)},{signal:f.eventListenerController.signal}))},mouseMove:(M,q)=>{if(f.startingEdges!=null&&f.newEdges!=null&&f.clickStart!=null&&f.refs[q].value){if(M.preventDefault(),q.toLowerCase().includes("north")){f.newEdges.top=Math.max(f.startingEdges.top+M.clientY-f.clickStart.y,0);const F=f.newEdges.bottom-f.newEdges.top-k;F<0&&(f.newEdges.top+=F)}else q.toLowerCase().includes("south")&&(f.newEdges.bottom=Math.min(f.startingEdges.bottom+M.clientY-f.clickStart.y,document.body.clientHeight));if(q.toLowerCase().includes("west")){f.newEdges.left=Math.max(f.startingEdges.left+M.clientX-f.clickStart.x,0);const F=f.newEdges.right-f.newEdges.left-S;F<0&&(f.newEdges.left+=F)}else q.toLowerCase().includes("east")&&(f.newEdges.right=Math.min(f.startingEdges.right+M.clientX-f.clickStart.x,document.body.clientWidth));f.update()}},update:()=>{f.newEdges==null||f.startingEdges==null||(g.value={x:Math.max(f.newEdges.left,0),y:Math.max(f.newEdges.top,0)},W.value={width:Math.min(Math.max(f.newEdges.right-f.newEdges.left,S),document.body.clientWidth),height:Math.min(Math.max(f.newEdges.bottom-f.newEdges.top,k),document.body.clientHeight)})},mouseUp:(M,q)=>{M.button!=0||f.startingEdges==null||(M.preventDefault(),f.startingEdges=null,f.newEdges=null,f.clickStart=null,f.eventListenerController&&(f.eventListenerController.abort(),f.eventListenerController=null))},refs:{northWest:Y(null),north:Y(null),northEast:Y(null),west:Y(null),east:Y(null),southWest:Y(null),south:Y(null),southEast:Y(null)}},l={startingMouse:null,startingPosition:null,mouseDown:M=>{M.button==0&&(M.preventDefault(),l.startingMouse={x:M.clientX,y:M.clientY},l.startingPosition=g.value,document.addEventListener("mousemove",l.mouseMove),document.addEventListener("mouseup",l.mouseUp))},mouseMove:M=>{!l.startingMouse||!l.startingPosition||(M.preventDefault(),g.value={x:Math.min(Math.max(l.startingPosition.x+M.clientX-l.startingMouse.x,0),document.body.clientWidth-W.value.width),y:Math.min(Math.max(l.startingPosition.y+M.clientY-l.startingMouse.y,0),document.body.clientHeight-W.value.height)})},mouseUp:M=>{M.button!=0||!l.startingMouse||!l.startingPosition||(M.preventDefault(),l.startingMouse=null,l.startingPosition=null,document.removeEventListener("mousemove",l.mouseMove),document.removeEventListener("mouseup",l.mouseUp))}};function v(M){return{id:r,icon:o.icon,title:o.title,pid:o.pid,data:M??o.tag}}const m=He(()=>wt.value.get(r)!==-1),p=Y(!1),y=Y(!0);function P(){i("minimize",v()),lt.minimizeWindowPanel(r)}function A(){p.value=!p.value}function T(){i("close",v(!1)),lt.removeWindowPanel(r),y.value=!1}const L=He(()=>p.value?"heroicons-outline:square-2-stack":"ant-design:border-outlined"),H={id:r,isShow:m,close:T,open:function(){i("open",v(!0)),y.value=!0},showHidePanel:P};function U(M){if(Zn(M))return M;{const q=Number(M);if(q==q)return q;if(M.endsWith("px")){const F=M.substring(0,M.length-2);return Number(F)}if(M.endsWith("%")){const F=M.substring(0,M.length-1);return Number(F)/100*document.body.clientWidth}return 300}}return e(H),_n(()=>{(function(){let M=90;if(o.hasMin||(M-=30),o.hasMax||(M-=30),o.hasClose||(M-=30),se.setCssVar("--right-bar-width",M+"px",c.value),!c.value)return;const q=Zn(o.titleHeight)?o.titleHeight+"px":o.titleHeight;c.value.style.height=q,c.value.style.lineHeight=q})(),function(){const M=v(H);lt.addWindowPanel(M),i("loaded",M)}(),g.value.x=U(o.left),g.value.y=U(o.top),N(g.value),W.value={width:U(o.nWidth),height:U(o.nHeight)},D(W.value),f.mount()}),li(()=>{lt.removeWindowPanel(r)}),(M,q)=>(X(),ee(Dr,{appear:"","enter-active-class":"animated zoomIn","leave-active-class":"animated zoomOut"},{default:be(()=>[y.value?Lr((X(),pe("div",{key:0,ref_key:"dragPanelRef",ref:s,class:Re(["dragWindowPanel",{maxPanel:p.value,dragWindowPanel_dark:d.value}])},[Q("div",{class:"dragPanelTitle",ref_key:"dragPanelTitleRef",ref:c,onMousedown:q[0]||(q[0]=(...F)=>l.mouseDown&&l.mouseDown(...F))},[ae(M.$slots,"title",{},()=>[o.icon?(X(),pe("img",{key:0,src:o.icon,width:"24",height:"24"},null,8,Bs)):re("v-if",!0),o.title?(X(),pe("span",Ns,wn(o.title),1)):re("v-if",!0)]),Q("div",Ws,[n.hasMin?(X(),ee(Ot(Ft),{key:0,icon:"ant-design:minus-outlined",onClick:P})):re("v-if",!0),n.hasMax?(X(),ee(Ot(Ft),{key:1,icon:L.value,onClick:A},null,8,["icon"])):re("v-if",!0),n.hasClose?(X(),ee(Ot(Ft),{key:2,icon:"ant-design:close-outlined",onClick:T})):re("v-if",!0)])],544),Q("div",$s,[ae(M.$slots,"default")]),Q("div",js,[Q("div",{class:"cursor-nw-resize",ref:f.refs.northWest},null,512),Q("div",{class:"cursor-n-resize",ref:f.refs.north},null,512),Q("div",{class:"cursor-ne-resize",ref:f.refs.northEast},null,512),Q("div",{class:"cursor-w-resize",ref:f.refs.west},null,512),q[1]||(q[1]=Q("span",{style:{"pointer-events":"all",visibility:"hidden"}},null,-1)),Q("div",{class:"cursor-e-resize",ref:f.refs.east},null,512),Q("div",{class:"cursor-sw-resize",ref:f.refs.southWest},null,512),Q("div",{class:"cursor-s-resize",ref:f.refs.south},null,512),Q("div",{class:"cursor-se-resize",ref:f.refs.southEast},null,512)])],2)),[[Ar,m.value]]):re("v-if",!0)]),_:3}))}});function sa(n){return n==null||n===""?n:new fe.Reader(new fe.ByteStream(n)).deserialize()}xr.__scopeId="data-v-39ea9741",xr.__file="src/controls/xwindow/XWindow.vue";class ro{debug=!1;simple=!1;utc=!1;longType="number";dictType="object";nullType=void 0;static Instance=new ro;textEncoder=new TextEncoder;textDecoder=new TextDecoder;constructor(){}encodeResponse(e,t={}){var r=new fe.ByteStream,o=new fe.Writer(r,this.simple,this.utc),i=t;this.simple;var s=0;for(var c in i)s++;s>0&&(r.writeByte(72),o.serialize(i),o.reset()),e instanceof Error?(r.writeByte(69),o.serialize(this.debug&&e.stack?e.stack:e.message)):(r.writeByte(82),o.serialize(e)),r.writeByte(122);const d=r.takeBytes();return this.textDecoder.decode(d)}decodeRequest(e,t={}){const r=this.textEncoder.encode(e);if(r.length===0)return["~",[]];var o=new fe.ByteStream(r),i=new fe.Reader(o,!1);i.longType=this.longType,i.dictType=this.dictType;var s=o.readByte();if(s===72){var c=i.deserialize(this.nullType);for(var d in c)t[d]=c[d];i.reset(),s=o.readByte()}switch(s){case 67:return[i.deserialize(String),this.decodeArguments(i)];case 122:return["~",[]];default:throw new Error(`Invalid request:\r
`+o.toString())}}decodeArguments(e){var t=e.stream;let r=[];if(t.readByte()===97){e.reset();var o=fe.ValueReader.readCount(t);const s=new Array(o).fill(this.nullType);r=new Array(o),e.addReference(r);for(var i=0;i<o;++i)r[i]=e.deserialize(s[i]);t.readByte()}return r}encodeRequest(e,t,r={}){var o=new fe.ByteStream,i=new fe.Writer(o,this.simple,this.utc),s=r;this.simple&&(s.simple=!0);var c=0;for(var d in s)c++;c>0&&(o.writeByte(72),i.serialize(s),i.reset()),o.writeByte(67),i.serialize(e),t.length>0&&(i.reset(),i.serialize(t)),o.writeByte(122);const g=o.takeBytes();return this.textDecoder.decode(g)}decodeResponse(e,t={}){const r=this.textEncoder.encode(e);var o=new fe.ByteStream(r),i=new fe.Reader(o,!1);i.longType=this.longType,i.dictType=this.dictType;var s=o.readByte();if(s===72){var c=i.deserialize();for(var d in c)t[d]=c[d];i.reset(),s=o.readByte()}switch(s){case 82:return t.simple&&(i.simple=!0),i.deserialize();case 69:throw new Error(i.deserialize(String));case 122:return;default:throw new Error(`Invalid response:\r
`+o.toString())}}}const ut=new Map,sn=new Map;let ht;const aa={getDefaultClient(){if(ht||(ht=new dn(SysConfig.DefaultHproseAPI)),!ht)throw Error("HproseProxy对象为空");return ht},registerHprose(n,e){const t=sn.get(n);if(!t){const r=new dn(e);ut.set(n,r)}return t},getHprose:n=>sn?.get(n),getProxyHprose:n=>ut.get(n),unregisterHprose(n){ut.get(n)&&(sn.delete(n),ut.delete(n))}},Ir=5e3,Hs=36e5,Oe={Login:"/api/User/Login",ChangeMyPwd:"/api/User/ChangeMyPwd",Logout:"/api/Check/ExitLogin",RefreshToken:"/api/Check/RefreshToken",CheckToken:"/api/Check/CheckToken",GetSystemRights:"/api/System/GetSystem"},vn="access_token",Us=$.Config.ServiceURL.LoginAuthURL;function Tr(){const n=ji();n&&xe(Oe.RefreshToken,Us,{refreshToken:n}).then(e=>{oo(e.data)})}function zs(){const n=Ge.getJsonObject(vn);if(!n)return;const e=new Date().getTime(),t=new Date(n.expire).getTime()-e;t>0&&(t<=Ir?Tr():setTimeout(Tr,t-Ir))}function oo(n){const e=new Date().getTime();let t=new Date(n.accessToken.expires).getTime()-e;if((t>=Hs||t<-6e5)&&(t=18e5),t>0){let r=Ue();r?(r.token=n.accessToken.tokenContent,r.expire=n.accessToken.expires,r.refresh=n.refreshToken.tokenContent):r={token:n.accessToken.tokenContent,expire:n.accessToken.expires,refresh:n.refreshToken.tokenContent},Ge.set(vn,r,t/1e3),zs()}else Ge.remove(vn)}const yn="Wm314243",At=$.Config.ServiceURL.LoginAuthURL;async function ca(n){const e={username:n.username,pwd:gn.encryptToString(n.pwd,yn)},t=(await xe(Oe.Login,At,e))?.data;return t&&(oo(t.doubletoken),fn(!1)),t}function la(n){const e={oldpwd:gn.encryptToString(n.oldpwd,yn),newpwd:gn.encryptToString(n.newpwd,yn)};return xe(Oe.ChangeMyPwd,At,e)}function ua(){const n=Ue();n&&(Hi(Oe.Logout,At,{token:n.token,reftoken:n.refresh}),Xr())}function ha(n){return xe(Oe.CheckToken,At,{token:n})}const xn="ROLE_SYSTEM_RIGHT",In=new Hr("",sessionStorage);function qs(){return In.get(xn)}function Rr(n){In.set(xn,n)}function Os(){In.remove(xn)}function Ve(n){if(n)for(let e=0;e<n.length;e++){const t=n[e];t.children&&t.children.length>0?(Ve(t.children),t.children.length===0&&(n.splice(e,1),e--)):t.selected||(n.splice(e,1),e--)}}function io(n,e,t="name"){n&&e&&n.forEach(r=>{const o=e.find(i=>i[t]===r[t]);o&&(r.children?o.children&&io(r.children,o.children,t):(!o.children||o.children.length===0)&&o.selected&&(r.selected=o.selected))})}function dt(n,e,t,r="name"){const o=n[t],i=e[t];o?i&&io(o,i,r):i&&(n[t]=i)}function Fs(n){if(n&&n.length>0){const e=n.length;let t,r=!1;if(e>0){r=Mt(n[0]);const o=r?n[0]:JSON.parse(n[0]);if(e>1)for(let i=1;i<n.length;i++){const s=n[i],c=r?s:JSON.parse(s);dt(o,c,"routes","name"),dt(o,c,"widgetMenu","name"),dt(o,c,"widgets","id"),dt(o,c,"functions","id")}t=o}return t&&(Ve(t.routes),Ve(t.widgetMenu),Ve(t.widgets),Ve(t.functions)),t}}const an=[],cn=[];function so(){return qs()}async function da(n,e=!1){Os();const t=Oe.GetSystemRights,r=$.Config.ServiceURL.LoginAuthURL,o=await xe(t,r,{systemid:n});if(!o||!o.data)return void $.Message?.warn("无法获取功能授权列表！");const i=o.data;if(i&&i.length>0){if(e){const s=JSON.parse(i[0]);return Rr(s),s}{const s=Fs(i);return Rr(s),s}}}function ao(n,e){const t={...n};return t.meta||(t.meta={}),e.index!=null&&(t.meta.index=e.index),e.title!=null&&(t.meta.title=e.title),n.children&&(t.children=[],e.children&&e.children.forEach(r=>{const o=n.children?.find(i=>i.path===r.path);if(o){const i=ao(o,r);i&&t.children?.push(i)}})),t}function fa(n,e=2){if(e===0)return n;const t=so();return t&&t.routes?(cn.length>0||n.forEach(r=>{const o=t.routes?.find(i=>i.name===r.name);if(o){const i=ao(r,o);i&&cn.push(i)}}),cn):void 0}function pa(n,e=2){if(e===0)return n;const t=so();return t&&t.widgets?(an.length>0||n?.forEach(r=>{t.widgets?.find(o=>o.id===r.id)&&an.push(r)}),an):void 0}export{ha as C,xe as D,zs as E,$ as F,lt as G,na as H,pa as I,so as K,Wi as M,ki as Q,ua as S,ta as U,ia as V,ea as W,xi as Z,Ue as a,da as b,se as c,he as d,on as e,Zs as f,Ti as g,xr as h,oo as i,ra as j,fa as k,Ke as l,dn as m,yt as n,sa as o,Zn as p,Qs as q,oa as r,la as s,Ki as t,Hr as u,aa as v,ca as w,Os as x,de as y};
