import{O as W}from"./vendor-DEnSXaZk.js";import{d as I,r as m,a as B,w as O,b as R,B as U,O as g,S as h,U as L,c as p,C as u,W as k,D,K as E,F as X}from"./@vue-exp-DhuHfG86.js";import{F as r,Q as z,g as G}from"./xframelib-exp-DUbArU78.js";import{A as q,U as A,R as F,M as N}from"./xgis-ol-exp-B_x7d6gL.js";import{u as Q}from"./vue-router-exp-CLDoDjFh.js";import{M as Z}from"./MultiService-BXyHVpPA.js";import{S as j}from"./index-1r0G7BfX.js";import{_ as K}from"./index-9YwdlOdB.js";import"./ol-exp-DNVUl0aT.js";import"./axios-exp-C7rfqWEd.js";import"./@iconify/vue-exp-DcFsj1aI.js";import"./monaco-editor-exp-BNK_u0iZ.js";const P={id:"map2",class:"mapstyle"},H={key:0,class:"rightOptionList"},J={class:"layerTreeContainer"},Y=I({__name:"TwoXMapWidget",setup($){const n=m(),d=m(!0),x=[{},{id:"pasteLoad",label:"粘贴（加载图层）",icon:"ic:round-content-paste-go"}];async function w(t){if(t.id==="pasteLoad")try{const e=await navigator.clipboard.readText();if(!e)return;e[1]===":"?f(e):z(e)}catch(e){r.Message.err("读取拷贝数据错误",e)}r.Message.info("点击了菜单："+t.label)}const T=B(()=>n.value?.mapMenuState.layerTree),_=Q();let a,s,v="";const o=m([]),i=m("");O(()=>i.value,(t,e)=>{a&&(t&&a.LayerManager.changeLayerVisible("s:"+t,!0),e&&a.LayerManager.changeLayerVisible("s:"+e,!1))});const b=new Z(j.ImageAdminClient);function f(t){if(!t)return;let e;G(r.Config.ServiceURL.WMTSService+"/GetServiceBrowse",{layer:t}).then(c=>{if(c.status===200){if(e=c.data,t.startsWith("m:")){o.value.length=0,i.value="";const C=t.substring(2);b.GetMultiServiceRelServiceList(C,0,0).then(M=>{M.arrayList.forEach(l=>{o.value.push({label:l.servicealias??l.servicename,value:l.servicename});const V="s:"+l.servicename,S={...e};S.name=l.servicename,a.WMTSTool.addWMTSLayerSelf(S,V)}),o.value.length>0&&(i.value=o.value[o.value.length-1].value)}).catch(M=>{})}else a.WMTSTool.addWMTSLayerSelf(e,t);const y=e.bounds;y?a.zoomToExtent(y):a.zoomToCenter(e.center,e.level??5)}})}return R(()=>{s=document.getElementById("map"),s.style.left="50%",s.style.width="50%",a=new q("map2","map",!0),a.initMapView({zoom:5,center:[116.46229441189399,40.24876149],minZoom:1,maxZoom:22,projection:"EPSG:3857"}),a.addOnlineLayer("vec_w"),a.addOnlineLayer("cva_w"),a.enableMapSyncView(),n.value=a,d.value=!!a.LayerManager,r.XMap2=a,r.XMap.enableMapSyncView();const e=_.query.layer;e&&(v=e),f(v)}),U(()=>{s&&(s.style.left="0",s.style.width="100%"),a&&a.disableMapSyncView();const t=r.XMap;t&&t.disableMapSyncView()}),(t,e)=>(g(),h(X,null,[L("div",P,[p(u(A),{xmap:n.value,hasLayerTree:d.value,class:"q-gutter-y-xs xmap-zoombar"},null,8,["xmap","hasLayerTree"]),p(u(F),{xmap:n.value,target:"map2",moreMenuList:x,onItemClicked:w},null,8,["xmap"]),o.value.length>0?(g(),h("div",H,[p(W,{modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=c=>i.value=c),options:o.value,color:"primary"},null,8,["modelValue","options"])])):k("",!0)]),D(L("div",J,[p(u(N),{xmap:n.value},null,8,["xmap"])],512),[[E,T.value]])],64))}}),de=K(Y,[["__scopeId","data-v-e5d916c1"]]);export{de as default};
