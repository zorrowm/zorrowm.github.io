import{F as o,f as E}from"./xframelib-exp-DUbArU78.js";import{T as c,M as T}from"./xgis-ol-exp-B_x7d6gL.js";import{a6 as y,$ as m}from"./vendor-DEnSXaZk.js";import{G as h}from"./ol-exp-DNVUl0aT.js";import{d as O,r as S,b,B as L,O as N,P as j,_ as C,c as w,C as f}from"./@vue-exp-DhuHfG86.js";import"./axios-exp-C7rfqWEd.js";import"./@iconify/vue-exp-DcFsj1aI.js";const J=O({__name:"MapLayerTreeWidget",setup(G){const{importGeoJSON:d}=m.internal,v=y();function x(e){e.id}function g(e){a.value&&(a.value.mapMenuState.layerTree=!1)}const M=[{},{name:"导出矢量",icon:"typcn:export",value:"exportdata"},{name:"Test2",icon:"gis:layer-down",value:"downMove2"}];function _(e){v.dialog({title:"导出矢量数据",message:"选择导出格式:",options:{type:"radio",model:"geojson",items:[{label:"Shapefile",value:"shapefile",color:"secondary"},{label:"GeoJSON",value:"geojson"},{label:"TopoJSON",value:"topojson"},{label:"KML",value:"kml"},{label:"SVG",value:"svg"}]},cancel:!0,persistent:!0}).onOk(t=>{const r=a.value.MapView.getProjection(),l=e.getSource()?.getFeatures(),i=new h().writeFeatures(l,{dataProjection:"EPSG:4326",featureProjection:r}),n=d(i,{});m.saveDataset(n,t,t==="shapefile")})}function p(e){if(!a.value||e.mapID!=a.value.target)return;const{item:t,id:s,name:r,label:l}=e.data,i=a.value;if(t.value==="exportdata"){const n=i.LayerManager.getLayer(s);if(n){const u=n.get("lyrType");if(u!="vector"&&u!="json"){o.Message.warn("只支持矢量图层导出");return}_(n)}}o.Message.info(`右键菜单：${t.name},图层ID：${s},图层名：${r},图层Label:${l}`)}const a=S();return b(()=>{if(o.XMap){const e=o.XMap;a.value=e,e.mapEventBus.eventOn(c.LAYER_TREE_CONTEXT_MENU,p)}}),L(()=>{o.XMap&&o.XMap.mapEventBus.eventOff(c.LAYER_TREE_CONTEXT_MENU,p)}),(e,t)=>(N(),j(f(E),{isDark:!1,top:"30px",left:"10px",nWidth:"350px",hHeight:"400px",title:"图层管理",hasMin:!1,icon:"img/basicimage/arcgis_img.png",onLoaded:x,onClose:g},{default:C(()=>[w(f(T),{xmap:a.value,moreContextMenu:M},null,8,["xmap"])]),_:1}))}});export{J as default};
