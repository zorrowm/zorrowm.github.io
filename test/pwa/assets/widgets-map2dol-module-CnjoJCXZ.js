import{d as e,m as a,g as t,o,r as n,j as s,u as r,w as i,t as l,p as u,H as p,C as c,a4 as d,a as m,e as g,f,A as y,k as v,v as M,F as _,B as S,N as E,z as L}from"./@vue-exp-DqB3u2UM.js";import{c as b,s as j,g as h,y as x,C as T,U as w,R as O,P,B as C,Q as D}from"./xframelib-exp-Di_VXkdF.js";import{I as W,p as A,K as X,a as I,G as V,F as R,T as F,b as z,z as B,v as G}from"./xgis-ol-exp-BJzQ5rLz.js";import{G as k,V as N,g as U,a as J}from"./ol-exp-DShAjIt1.js";import{bx as H}from"./vendor-Cf1_rMTi.js";import{u as $,a as Y,F as Z,H as q}from"./quasar-exp-v4VmEynb.js";import{l as K}from"./xgis-cesium-exp-CJ9YBkJI.js";import{i as Q}from"./Cesium-DDfh73kC-C1FDnl4T.js";import{_ as ee,e as ae}from"./pages-back-module-D2M2S2qP.js";import{S as te}from"./pages-system-module-DyY1LPFW.js";import{j as oe}from"./pages-product-module-DM-QxG3Z.js";const ne=e({__name:"MapproxyWidget",setup:e=>(e,o)=>(t(),a("div"))}),se=Object.freeze(Object.defineProperty({__proto__:null,default:ne},Symbol.toStringTag,{value:"Module"})),re=e({__name:"MapZoomFullWidget",setup(e){const i=n(),l=n(!1);return o((()=>{b.XMap&&(i.value=b.XMap,l.value=!!i.value.LayerManager)})),(e,o)=>(t(),a("div",null,[s(r(W),{xmap:i.value,hasLayerTree:l.value,class:"q-gutter-y-sm"},null,8,["xmap","hasLayerTree"])]))}}),ie=Object.freeze(Object.defineProperty({__proto__:null,default:re},Symbol.toStringTag,{value:"Module"})),le={class:"tool-container zoomFullList"},ue={title:"地图工具栏"},pe="map2dMenuWidget",ce=e({__name:"MapToolAppendWidget",setup(e){const o=c((()=>{let e="";return b.XMap?.mapMenuState.otherTool&&(e="background-color:#ccc"),e})),n=d();function r(){b.XMap&&(b.XMap.mapMenuState.otherTool=!b.XMap.mapMenuState.otherTool)}return i((()=>b.XMap?.mapMenuState.otherTool),(e=>{const a=n?.proxy?.$options.layoutID,t=b.LayoutMap.get(a);null!=e&&(e?t?.loadWidget(pe):t?.unloadWidget(pe))})),(e,n)=>{const i=l("Icon");return t(),a("ul",le,[u("li",{onClick:r,style:p(o.value)},[u("span",ue,[s(i,{icon:"ant-design:menu-outlined"})])],4)])}}}),de=Object.freeze(Object.defineProperty({__proto__:null,default:ce},Symbol.toStringTag,{value:"Module"})),me=e({__name:"DragFileLoadLayerWidget",setup(e){const{importContent:n,exportDatasetAsGeoJSON:s,setDatasetCrsInfo:r,exportFileContent:i,importGeoJSON:l}=H.internal;let u;async function p(e){if(e&&0!==e.length){e.length;const a=Array.from(e),t=await H.import2DFiles(a);if(t&&t.length>0){const e=b.XMap,a=e.MapView.getProjection();t.forEach((t=>{const o=s(t.dataset,{}),n=(new k).readFeatures(o,{dataProjection:"EPSG:4326",featureProjection:a}),r=new N({features:n}),i=r.getExtent(),l=A.getExtentFromTransform(i,a,"EPSG:4326"),p=U(l),c=t.dataset.layers[0]?.name,d=c??h();if(u=new J({source:r,properties:{center:p,bounds:l,lyrID:d,lyrName:d,lyrType:"vector",lyrGroup:d}}),u){e.map.addLayer(u);const a={id:d,name:d,alias:"",group:d,minZoom:1,maxZoom:24,visible:!0,opacity:1,type:"vector"};e.registerLayer(u,a)}}))}}}async function c(e){if(x(e))b.Message.info(e);else if(Array.isArray(e)){const a=e;if(0===a.length)return;const t=await H.import2DFiles(a);if(t&&t.length>0){const e=b.XMap,a=e.MapView.getProjection();t.forEach((t=>{const o=s(t.dataset,{}),n=(new k).readFeatures(o,{dataProjection:"EPSG:4326",featureProjection:a}),r=new N({features:n}),i=new J({source:r});i&&e.map.addLayer(i)}))}}}return o((()=>{b.XMap&&(j.bindDropFileHanlder("map",p),j.onPasteHandler(c))})),(e,o)=>(t(),a("div"))}}),ge=Object.freeze(Object.defineProperty({__proto__:null,default:me},Symbol.toStringTag,{value:"Module"})),fe=e({__name:"MapLayerTreeWidget",setup(e){const{importGeoJSON:a}=H.internal,i=$();function l(e){e.id}function u(e){d.value&&(d.value.mapMenuState.layerTree=!1)}const p=[{},{name:"导出矢量",icon:"typcn:export",value:"exportdata"},{name:"Test2",icon:"gis:layer-down",value:"downMove2"}];function c(e){if(!d.value)return;if(e.mapID!=d.value.target)return;const{item:t,id:o,name:n,label:s}=e.data,r=d.value;if("exportdata"===t.value){const e=r.LayerManager.getLayer(o);if(e){const t=e.get("lyrType");if("vector"!=t&&"json"!=t)return void b.Message.warn("只支持矢量图层导出");!function(e){i.dialog({title:"导出矢量数据",message:"选择导出格式:",options:{type:"radio",model:"geojson",items:[{label:"Shapefile",value:"shapefile",color:"secondary"},{label:"GeoJSON",value:"geojson"},{label:"TopoJSON",value:"topojson"},{label:"KML",value:"kml"},{label:"SVG",value:"svg"}]},cancel:!0,persistent:!0}).onOk((t=>{const o=d.value.MapView.getProjection(),n=e.getSource()?.getFeatures(),s=(new k).writeFeatures(n,{dataProjection:"EPSG:4326",featureProjection:o}),r=a(s,{});H.saveDataset(r,t,"shapefile"===t)}))}(e)}}b.Message.info(`右键菜单：${t.name},图层ID：${o},图层名：${n},图层Label:${s}`)}const d=n();return o((()=>{if(b.XMap){const e=b.XMap;d.value=e,e.mapEventBus.eventOn(X.LAYER_TREE_CONTEXT_MENU,c)}})),m((()=>{if(b.XMap){b.XMap.mapEventBus.eventOff(X.LAYER_TREE_CONTEXT_MENU,c)}})),(e,a)=>(t(),g(r(T),{isDark:!1,top:"30px",left:"10px",nWidth:"350px",hHeight:"400px",title:"图层管理",hasMin:!1,icon:"img/basicimage/arcgis_img.png",onLoaded:l,onClose:u},{default:f((()=>[s(r(I),{xmap:d.value,moreContextMenu:p},null,8,["xmap"])])),_:1}))}}),ye=Object.freeze(Object.defineProperty({__proto__:null,default:fe},Symbol.toStringTag,{value:"Module"})),ve=e({__name:"Sync2D3DWidget",setup(e){let n,s;function r(){try{if(s&&s.map){s.map.un("moveend",p),s.MapView.un("change:resolution",p)}}catch(e){}try{n&&(n.off(K.WHEEL,u),n.off(K.LEFT_UP,u))}catch(e){}}function i(){r(),n&&(n.on(K.WHEEL,u),n.on(K.LEFT_UP,u))}function l(){if(r(),s&&s.map){s.map.on("moveend",p),s.MapView.on("change:resolution",p)}}function u(){if(n){const e=n.camera.computeViewRectangle(),a=e.west/Math.PI*180,t=e.north/Math.PI*180,o=e.east/Math.PI*180,r=[a,e.south/Math.PI*180,o,t],i=A.getExtentFromTransform(r,"EPSG:4326","EPSG:3857");s.MapView.fit(i)}}function p(){if(s&&s.map){const e=s.MapView.calculateExtent(),a=A.getExtentFromTransform(e,"EPSG:3857","EPSG:4326");n&&n.camera.setView({destination:Q.Rectangle.fromDegrees(a[0],a[1],a[2],a[3]),orientation:{heading:.049106700935120706,pitch:-1.560509974137843,roll:0}})}}return o((()=>{n=b.CesiumViewer,n&&n.on(K.MOUSE_MOVE,i),s=b.XMap,s&&s.map&&s.map.on("pointermove",l)})),m((()=>{n&&n.off(K.MOUSE_MOVE,i),s&&s.map&&s.map.un("pointermove",l)})),(e,o)=>(t(),a("div"))}}),Me=Object.freeze(Object.defineProperty({__proto__:null,default:ve},Symbol.toStringTag,{value:"Module"})),_e=ee(e({__name:"MapContextMenuWidget",setup(e){const a=n(b.XMap),s=[{},{id:"basicLayerManagerWidget",label:"在线底图管理",icon:"ic:baseline-layers",tag:"widget"},{},{id:"pasteLoad",label:"粘贴（加载影像或矢量图层）",icon:"ic:round-content-paste-go"}],i=n("map"),l=d(),u=$();async function p(e){if("widget"===e.tag&&e.id){const a=l?.proxy?.$options.layoutID,t=b.LayoutMap.get(a);t?.loadWidget(e.id)}else"pasteLoad"===e.id&&u.dialog({title:"粘贴确认",message:'<ul style="margin-left:10px;">\n            <li>影像服务名（例如：m:GuLangYu、s:test1）;</li>\n            <li>矢量切片服务tileJson元数据或URL;</li>\n            <li>电子地图styleJson元数据或URL;</li>\n          </ul> ',html:!0,cancel:!0,persistent:!0}).onOk((async()=>{try{const e=await navigator.clipboard.readText();if(!e)return;const t=a.value;if(":"===e[1])t.mapEventBus.eventEmit(X.PASTE_LAYER_LOAD_WMTS,t.newEvtArgs({layer:e}));else if(w(e))e.indexOf("/tile.json")>0?t.mapEventBus.eventEmit(X.PASTE_LAYER_LOAD_MVT,t.newEvtArgs({mvtURL:e})):e.indexOf("/style.json")>0?t.mapEventBus.eventEmit(X.PASTE_LAYER_LOAD_MVT,t.newEvtArgs({mapURL:e})):b.Message.warn("不是正确的矢量元数据URL!");else if(O(e)){const a=JSON.parse(e);a&&(a.version&&a.sources&&Array.isArray(a.layers)&&a.layers.length>0?t.mapEventBus.eventEmit(X.PASTE_LAYER_LOAD_MVT,t.newEvtArgs({mapJSON:a})):a.tilejson&&a.tileSchema&&a.prjInfo&&Array.isArray(a.vector_layers)?t.mapEventBus.eventEmit(X.PASTE_LAYER_LOAD_MVT,t.newEvtArgs({mvtJSON:a})):b.Message.warn("不是正确的矢量或地图元数据!"))}}catch(e){b.Message.err("读取拷贝数据错误:"+e.Message)}})).onCancel((()=>{}))}return o((()=>{a.value=b.XMap,i.value=b.XMap.target})),(e,o)=>a.value?(t(),g(r(V),{key:0,xmap:a.value,target:i.value,moreMenuList:s,onItemClicked:p},null,8,["xmap","target"])):y("",!0)}}),[["__scopeId","data-v-abac5870"]]),Se=Object.freeze(Object.defineProperty({__proto__:null,default:_e},Symbol.toStringTag,{value:"Module"})),Ee={class:"row q-col-gutter-sm"},Le={class:"text-center textContent"},be=ee(e({__name:"BasicLayerManagerWidget",setup(e,{expose:i}){const l=n("");let p="";function c(e){p=e.id}const m=d();function y(e){const a=m?.proxy?.$options.id,t=m?.proxy?.$options.layoutID;a&&b.LayoutMap.get(t)?.unloadWidget(a)}function j(e){let a="";return l.value&&e.id===l.value&&(a="cardSelected"),a}o((()=>{b.XMap&&(l.value="TDT_VEC")}));const h=n(!0);return i({changeVisible:function(e=!1){h.value=e,p&&e&&P.openWindowPanel(p)},isShow:h}),(e,o)=>v((t(),g(r(T),{isDark:!0,top:"10px",left:"10px",nWidth:"280px",hHeight:"350px",title:"在线影像底图",icon:"img/basicimage/arcgis_img.png",pid:"imageBaseLayerWidget",onLoaded:c,onClose:y},{default:f((()=>[s(Y,{style:{height:"100%"}},{default:f((()=>[u("div",Ee,[(t(!0),a(_,null,S(r(R),((e,o)=>(t(),a("div",{class:"col-4",key:o},[s(Z,{class:E(["cardContent",j(e)]),onClick:a=>function(e){const a=l.value;if(l.value=e.id,b.XMap){const t=b.XMap;if(a){const o=R.find((e=>e.id===a));o&&o.layers?.length>0&&o.layers.forEach((e=>{t.LayerManager.deleteLayerByID(e)})),e.layers.forEach((e=>{t.addOnlineLayer(e)}))}}}(e)},{default:f((()=>[s(q,{src:e.img,height:"75px"},null,8,["src"]),u("div",Le,L(e.label),1)])),_:2},1032,["class","onClick"])])))),128))])])),_:1})])),_:1},512)),[[M,h.value]])}}),[["__scopeId","data-v-7dde4c73"]]),je=Object.freeze(Object.defineProperty({__proto__:null,default:be},Symbol.toStringTag,{value:"Module"})),he={class:"measureToolBar"},xe=e({__name:"MeasureToolBarWidget",setup(e){const i=n();return o((()=>{b.XMap&&(i.value=b.XMap)})),(e,o)=>(t(),a("div",he,[s(r(F),{xmap:i.value},null,8,["xmap"])]))}}),Te=Object.freeze(Object.defineProperty({__proto__:null,default:xe},Symbol.toStringTag,{value:"Module"})),we=e({__name:"DrawToolBarWidget",setup(e){const i=n();return o((()=>{b.XMap&&(i.value=b.XMap)})),(e,o)=>(t(),a("div",null,[s(r(z),{xmap:i.value},null,8,["xmap"])]))}}),Oe=Object.freeze(Object.defineProperty({__proto__:null,default:we},Symbol.toStringTag,{value:"Module"})),Pe={class:"MainMapContainerWidget"},Ce={id:"map",class:"mapstyle"},De=ee(e({__name:"XMapContainerWidget-ol",setup(e){const l=n(),p=n(!1),c=oe(),d=n(c?.get("mapLayout")),g=n("mapLayout");function f(e){const a=e.layoutManager;a&&a.loadWidget("MapproxyWidget-ol")}return o((async()=>{ae(te.System_WindowHalfSize,!0);const e=(await C("DefaultMapConfig.json").catch((e=>{b.Message.warn("加载地图初始化配置DefaultMapConfig.json失败！"+e.Message)}))).data;e.projInfo&&(e.viewOptions.Projection=A.getProjection(e.projInfo));const a=B.initByMapConfig(e);l.value=a,b.XMap=a,p.value=!!a.LayerManager,i((()=>l.value?.mapMenuState.layerTree),(e=>{const a=g.value,t=b.LayoutMap.get(a);null!=e&&(e?t?.loadWidget("mapLayerTreeWidget"):t?.unloadWidget("mapLayerTreeWidget"))}));const t=b.Config.ServiceURL.MapStyleJsonURL;t&&async function(e){try{const a=await fetch(e);if(!a.ok)throw new Error(`Response status: ${a.status}`);return await a.json()}catch(a){}}(t).then((e=>{e&&function(e){const a=b.XMap;G(a.map,e).then((t=>{const o=a.MapView.getProjection();e.zoom,a.MapView.setZoom(e.zoom),e.center&&a.MapView.setCenter(A.fromLonLatCoordinate(e.center,o))}))}(e)}))})),m((()=>{ae(te.System_WindowHalfSize,!1)})),(e,o)=>(t(),a("div",Pe,[u("div",Ce,[s(r(D),{widgetConfig:d.value,layoutID:g.value,onContainerLoaded:f},null,8,["widgetConfig","layoutID"])])]))}}),[["__scopeId","data-v-fe47bfc9"]]),We=Object.freeze(Object.defineProperty({__proto__:null,default:De},Symbol.toStringTag,{value:"Module"}));export{je as B,ge as D,se as M,Me as S,We as X,ie as a,de as b,ye as c,Se as d,Te as e,Oe as f};
