import{bm as e,bw as t}from"./vendor-Cf1_rMTi.js";import{e as a,_ as o,O as l,a as n}from"./pages-back-module-D2M2S2qP.js";import{S as i}from"./pages-system-module-DyY1LPFW.js";import{j as r}from"./pages-product-module-DM-QxG3Z.js";import{c as s,B as u,Q as c,C as d,P as p}from"./xframelib-exp-Di_VXkdF.js";import{d as f,o as m,a as g,m as v,g as y,j as b,f as _,p as M,r as h,u as C,t as S,O as w,z as x,e as P,F as j,B as X,k,q as O,x as F,N as L,a4 as W,w as V,v as z}from"./@vue-exp-DqB3u2UM.js";import{e as I,f as E,R as U,v as D,a as T,F as q,D as B,l as A,b as R,I as Z,h as $}from"./quasar-exp-v4VmEynb.js";import{l as H}from"./xgis-cesium-exp-CJ9YBkJI.js";import{i as N}from"./Cesium-DDfh73kC-C1FDnl4T.js";import{P as Y}from"./widgets-cesium-module-DGAswshf.js";const G="MainMapWidgetLoaded",J={class:"MainMapContainerWidget"},K=o(f({__name:"XMapContainerWidget",setup(t){const o=r(),l=h(o),n=h("mapLayout");let d;function p(e){d=e.layoutManager,d&&(s.MapLayoutManager=d,S())}let f=!1;function S(){f||d&&s.XMap&&(f=!0,d.loadWidget("MapproxyWidget"))}const w={"ScaleControl.Meters":"米","ScaleControl.Kilometers":"千米","NavigationControl.ZoomIn":"放大","NavigationControl.ZoomOut":"缩小","NavigationControl.Compass":"罗盘","FullscreenControl.Enter":"地图全屏","FullscreenControl.Exit":"退出全屏"};function x(t){if(s.XMap)a(G,s.XMap);else{const o=new e.Map({container:"map",style:t,attributionControl:!1,locale:w});s.XMap=o,s.XMapStyle=t,a(G,o),setTimeout((()=>{o.resize(),function(e){if(!s.Config.MapExtent||!e)return;const t=s.Config.MapExtent;e.fitBounds(t)}(o)}),100)}}return m((async()=>{if(s.Config.ServiceURL.Map2dStyleURL){const e=await u(s.Config.ServiceURL.Map2dStyleURL);if(e&&e.data){x(e.data),S()}else s.Message.warn("请求二维地图失败！")}})),g((()=>{a(i.System_WindowHalfSize,0),s.XMap&&(s.XMap.remove(),s.XMap=void 0)})),(e,t)=>(y(),v("div",J,[b(C(c),{widgetConfig:l.value,layoutID:n.value,onContainerLoaded:p},{main:_((()=>[...t[0]||(t[0]=[M("div",{id:"map",class:"mapstyle"},null,-1)])])),_:1},8,["widgetConfig","layoutID"])]))}}),[["__scopeId","data-v-3525379b"]]),Q=Object.freeze(Object.defineProperty({__proto__:null,default:K},Symbol.toStringTag,{value:"Module"})),ee=o(f({__name:"MapproxyWidget",setup(e){let t=!1;return(e,o)=>{const l=S("Icon");return y(),v("div",{class:"mapproxyPanel",title:"打开关闭二维地图",onClick:o[0]||(o[0]=w((e=>(t=!t,void a(i.System_WindowHalfSize,t?1:2))),["prevent"]))},[b(l,{icon:"ant-design:split-cells-outlined",class:"splitIcon"})])}}}),[["__scopeId","data-v-8f07c7a8"]]),te=Object.freeze(Object.defineProperty({__proto__:null,default:ee},Symbol.toStringTag,{value:"Module"})),ae=f({__name:"MapControlWidget",setup(t){let a,o,l;return m((()=>{if(s.XMap){const t=s.XMap;o=new e.ScaleControl({unit:"metric"}),t.addControl(o,"bottom-left"),a=new e.NavigationControl,t.addControl(a,"bottom-left"),l=new e.FullscreenControl,t.addControl(l,"bottom-left")}})),g((()=>{if(s.XMap){const e=s.XMap;l&&e.removeControl(l),a&&e.removeControl(a),o&&e.removeControl(o)}})),(e,t)=>(y(),v("div"))}}),oe=Object.freeze(Object.defineProperty({__proto__:null,default:ae},Symbol.toStringTag,{value:"Module"})),le={class:"statusPanel"},ne={class:"q-mr-md"},ie={class:"q-mr-md"},re={class:"q-mr-md"},se=o(f({__name:"MapStatusWidget",setup(e){const t=h({lat:0,lon:0,zoom:0});function a(e){t.value.lon=e.lngLat.lng.toFixed(8),t.value.lat=e.lngLat.lat.toFixed(8)}function o(e){t.value.zoom=Math.floor(e.target.getZoom())}return m((()=>{if(s.XMap){const{lng:e,lat:l}=s.XMap.getCenter();t.value.lat=l.toFixed(8),t.value.lon=e.toFixed(8),t.value.zoom=Math.floor(s.XMap.getZoom()),s.XMap.on("mousemove",a),s.XMap.on("zoom",o)}})),g((()=>{s.XMap&&(s.XMap.off("mousemove",a),s.XMap.off("zoom",o))})),(e,a)=>(y(),v("div",le,[M("span",ne," 经度: "+x(t.value.lon),1),M("span",ie," 纬度:"+x(t.value.lat),1),M("span",re," 层级: "+x(t.value.zoom),1)]))}}),[["__scopeId","data-v-6b7e0199"]]),ue=Object.freeze(Object.defineProperty({__proto__:null,default:se},Symbol.toStringTag,{value:"Module"})),ce={style:{"min-width":"150px"}},de=f({__name:"MapDefaultMenuWidget",setup(e){const t=h([{label:"查看此处坐标",value:-1},{label:"放大",value:0},{label:"缩小",value:1},{label:"全屏",value:2},{label:"复原",value:3}]),a=h(!1);let o,l,n=!1;function i(e){l=e.lngLat}return m((()=>{s.XMap&&(o=s.XMap,o.on("contextmenu",i))})),g((()=>{o&&o.off("contextmenu",i)})),(e,i)=>(y(),P(D,{modelValue:a.value,"onUpdate:modelValue":i[0]||(i[0]=e=>a.value=e),target:"#map","context-menu":""},{default:_((()=>[M("div",ce,[b(I,{bordered:"",separator:"",dense:""},{default:_((()=>[(y(!0),v(j,null,X(t.value,((e,t)=>k((y(),P(E,{class:"items-center",clickable:"",key:t,onClick:t=>function(e){switch(a.value=!1,e){case-1:s.Message.info(`当前点击坐标为:${l.lng},${l.lat}`,5);break;case 0:o.setZoom(o.getZoom()+1);break;case 1:o.setZoom(o.getZoom()-1);break;case 2:n?document.exitFullscreen():document.documentElement.requestFullscreen(),n=!n;break;case 3:o.setPitch(0),o.setBearing(0);break;default:return}}(e.value)},{default:_((()=>[O(x(e.label),1)])),_:2},1032,["onClick"])),[[U]]))),128))])),_:1})])])),_:1},8,["modelValue"]))}}),pe=Object.freeze(Object.defineProperty({__proto__:null,default:de},Symbol.toStringTag,{value:"Module"})),fe=f({__name:"Sync2D3DWidget",setup(e){let t,a;function o(){try{a&&(a.off("moveend",r),a.off("zoomend",r))}catch(e){}try{t&&(t.off(H.WHEEL,i),t.off(H.LEFT_UP,i))}catch(e){}}function l(){o(),t&&(t.on(H.WHEEL,i),t.on(H.LEFT_UP,i))}function n(){o(),a&&(a.on("moveend",r),a.on("zoomend",r))}function i(){if(t&&a){const e=t.camera.computeViewRectangle();if(e){const t=e.west/Math.PI*180,o=e.north/Math.PI*180,l=e.east/Math.PI*180,n=[t,e.south/Math.PI*180,l,o];a.fitBounds(n)}}}function r(){if(a){const e=a.getBounds();t&&e&&t.camera.setView({destination:N.Rectangle.fromDegrees(e.getWest(),e.getSouth(),e.getEast(),e.getNorth()),orientation:{heading:.049106700935120706,pitch:-1.560509974137843,roll:0}})}}return m((()=>{t=s.CesiumViewer,t&&t.on(H.MOUSE_MOVE,l),a=s.XMap,a&&a.on("mousemove",n)})),g((()=>{t&&t.off(H.MOUSE_MOVE,l),a&&a.off("mousemove",n)})),(e,t)=>(y(),v("div"))}}),me=Object.freeze(Object.defineProperty({__proto__:null,default:fe},Symbol.toStringTag,{value:"Module"})),ge={class:"column btn-group2"},ve=["onClick"],ye=["src"],be=o(f({__name:"MapRightButtonGroup",setup(e){const t=h([]);function a(e,t=!0){const a=s.XMap;if(!a)return;const o=new Array;a.getStyle().layers.forEach((t=>{if(t.id.startsWith(e)){const e=t.id;o.push(e)}}));const l=t?"visible":"none";o.forEach((e=>{a.setLayoutProperty(e,"visibility",l)}))}const o=h([]);return m((async()=>{o.value=await fetch("LayerJson/LayerConfig.json").then((e=>e.json())),s.CesiumViewer?s.CesiumViewer:s.Message.info("未获取到地图")})),(e,l)=>{const n=F("tooltip");return y(),v("div",ge,[(y(!0),v(j,null,X(o.value,(e=>{return k((y(),v("div",{class:L(["btn-item",(o=e,-1!==t.value.indexOf(o.id)?"active":"")]),onClick:o=>function(e){const o=t.value.indexOf(e.id);-1===o?(t.value.push(e.id),a(e.name,!1)):(t.value.splice(o,o+1),a(e.name,!0))}(e)},[M("img",{src:e.icon,alt:""},null,8,ye)],10,ve)),[[n,e.name,void 0,{left:!0}]]);var o})),256))])}}}),[["__scopeId","data-v-02d2e20f"]]),_e=Object.freeze(Object.defineProperty({__proto__:null,default:be},Symbol.toStringTag,{value:"Module"})),Me={style:{"max-width":"300px","max-height":"400px",overflow:"auto"}},he=f({__name:"SelectFeatureWidget",setup(e){let t;const a=h(!1),o=h([]);function l(e){o.value.length=0;const l=t.queryRenderedFeatures(e.point);let n=0;l&&l.length>0&&l.forEach((e=>{if("line"===e.layer.type&&("低空航线"===e.sourceLayer||"低空空域"===e.sourceLayer)){const t=e.sourceLayer,a={...e.properties};n++,o.value.push({layer:t,properties:a})}})),a.value=0!==n}return m((()=>{s.XMap&&(t=s.XMap,t.on("click",l))})),g((()=>{t&&t.off("click",l)})),(e,t)=>(y(),P(D,{"model-value":a.value,target:"#map","touch-position":""},{default:_((()=>[M("div",Me,[(y(!0),v(j,null,X(o.value,((e,t)=>(y(),v("div",{class:"q-pa-sm",key:t},[M("div",null,"图层名称:"+x(e.layer),1),(y(!0),v(j,null,X(e.properties,((e,t)=>(y(),v("div",{key:t},x(t)+":"+x(e),1)))),128))])))),128))])])),_:1},8,["model-value"]))}}),Ce=Object.freeze(Object.defineProperty({__proto__:null,default:he},Symbol.toStringTag,{value:"Module"})),Se={class:"rightBtnList"},we=o(f({__name:"AirportFilterBtnWidget",setup(e){function t(){s.MapLayoutManager&&s.MapLayoutManager.loadWidget("AirportSearchPanelWidget")}function a(){s.MapLayoutManager&&s.MapLayoutManager.loadWidget("PlotObstacleWidget")}return(e,o)=>{const l=S("Icon"),n=F("tooltip");return y(),v("div",Se,[k(b(l,{icon:"icon-park-solid:filter",class:"filterBtn",onClick:t},null,512),[[n,"机场查询"]]),k(b(l,{icon:"mdi-map-marker",class:"filterBtn",onClick:a},null,512),[[n,"绘制障碍物"]])])}}}),[["__scopeId","data-v-a9e10c90"]]),xe=Object.freeze(Object.defineProperty({__proto__:null,default:we},Symbol.toStringTag,{value:"Module"})),Pe={class:"toolbar"},je={class:"row q-mt-sm"},Xe={class:"text-center textContent"},ke={class:"coordatePanel"},Oe={class:"leftXY"},Fe={class:"rightAdd"},Le=o(f({__name:"PlotObstacleWidget",setup(e,{expose:o}){const i=W(),r=i?.proxy?.$options.layoutID,u=[{id:"建筑",label:"建筑",icon:"ps:building"},{id:"通信设施",label:"通信设施",icon:"fluent-mdl2:network-tower"},{id:"电力设施",label:"电力设施",icon:"icon-park:signal-tower-one"},{id:"自然物",label:"自然物",icon:"emojione-monotone:evergreen-tree"},{id:"塔",label:"塔",icon:"icon-park:eiffel-tower"},{id:"其他障碍物",label:"其他障碍物",icon:"ri:error-warning-fill"}];let c,p;const f=h(null),w=h(null),k=h(""),F=h("");function z(){c&&k.value&&(c.trash(),k.value="")}function I(){if(c){const e=c.getAll();e.features.length>0&&(s.CurrentFeature=void 0,a(Y.SyncAddFeatures,e.features))}}function E(){if(f.value&&w.value)if(f.value>116.5&&f.value<116.9)if(w.value>23.9&&w.value<30.7){if(c){const e={type:"Point",coordinates:[f.value,w.value]};k.value=c.add(e)}}else s.Message.warn("Y坐标无效！");else s.Message.warn("X坐标无效！");else s.Message.warn("X或Y坐标不能为空！")}let U;function D(e){e.id}function Z(e){if(e.pid){U=e.pid;const t=s.MapLayoutManager;t&&t.unloadWidget(U)}}function $(e){return F.value&&e.id===F.value?"iconLine iconLine-Active":"iconLine"}function H(e){if("draw.create"===e.type){if(e.features.length>0){const t=e.features[0];k.value=t.id}}else if("draw.selectionchange"===e.type&&e.features.length>0){const t=e.features[0];k.value=t.id,s.CurrentFeature=t}}function N(e){if(e){const t=e.id,a=e.properties;if(c){if(c.get(t)){for(const e in a){const o=a[e];c.setFeatureProperty(t,e,o)}c.get(t)}}}}V((()=>k.value),(e=>{e&&(s.CurrentFeature=c.get(e),s.CurrentFeature.properties["类型"]||(s.CurrentFeature.properties["类型"]=p),function(){const e=s.LayoutMap.get(r);e&&e.loadWidget("AddObstaclePropertyWidget")}(),a(Y.ChangeCurrentFeature,{feature:s.CurrentFeature}))})),m((()=>{if(s.CurrentFeature=void 0,s.XMap){const e=s.XMap;c=new t({displayControlsDefault:!1,controls:{point:!0},styles:[{id:"highlight-active-points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","true"]],paint:{"circle-radius":8,"circle-color":"#ff0"}},{id:"points-are-blue",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","false"]],paint:{"circle-radius":6,"circle-color":"#f00"}}]}),e.addControl(c),e.on("draw.create",H),e.on("draw.selectionchange",H)}l(Y.UpdateFeatureProperty,N)})),g((()=>{if(s.CurrentFeature=void 0,s.XMap){const e=s.XMap;c&&(e.off("draw.create",H),e.off("draw.selectionchange",H),e.removeControl(c))}n(Y.UpdateFeatureProperty,N)}));return o({changeVisible:function(e=!1){},isShow:h(!0)}),(e,t)=>{const a=S("Icon");return y(),P(C(d),{"has-min":!1,isDark:!0,left:"10px",top:"45px",nWidth:"320px",nHeight:"360px",title:"标绘工具",icon:"img/basicimage/arcgis_img.png",pid:"PlotObstacleWidget",onLoaded:D,onClose:Z},{title:_((()=>[t[2]||(t[2]=M("img",{src:"img/bigscreen/Liangce.png",width:"24",height:"24"},null,-1)),t[3]||(t[3]=M("span",{class:"paneltitle"},"标绘工具",-1)),M("div",Pe,[M("span",{title:"删除选中",onClick:z},[b(a,{icon:"ant-design:clear-outlined"})]),M("span",{title:"提交保存",onClick:I},[b(a,{icon:"mdi-light:content-save"})])])])),default:_((()=>[b(T,{style:{height:"100%"}},{default:_((()=>[M("div",je,[(y(),v(j,null,X(u,((e,t)=>M("div",{class:"col-3 q-mb-sm",key:t},[b(q,{flat:"",class:"cardContent column items-center",onClick:t=>function(e){F.value=e.id,p=e.id,c&&c.changeMode("draw_point")}(e)},{default:_((()=>[M("div",{class:L($(e))},[b(a,{icon:e.icon,class:"measureIconStyle"},null,8,["icon"])],2),M("div",Xe,x(e.label),1)])),_:2},1032,["onClick"])]))),64)),b(B,{dark:""},{default:_((()=>[...t[4]||(t[4]=[O("坐标添加",-1)])])),_:1}),M("div",ke,[M("div",Oe,[b(A,{type:"number",outlined:"",modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=e=>f.value=e),label:"X坐标",dense:!0,hint:"请输入(116.5 ~ 116.9)之间数值","lazy-rules":"",rules:[e=>null!==e&&""!==e||"请输入X坐标-经度",e=>e>116.5&&e<116.9||"请输入(116.5 ~ 116.9)之间值"]},null,8,["modelValue","rules"]),b(A,{type:"number",outlined:"",modelValue:w.value,"onUpdate:modelValue":t[1]||(t[1]=e=>w.value=e),label:"Y坐标",dense:!0,hint:"请输入(23.9 ~ 30.7)之间数值","lazy-rules":"",rules:[e=>null!==e&&""!==e||"请输入Y坐标-纬度",e=>e>23.9&&e<30.7||"请输入(23.9 ~ 30.7)之间值"]},null,8,["modelValue","rules"])]),M("div",Fe,[b(R,{color:"white","text-color":"black",label:"添加点",onClick:E})])])])])),_:1})])),_:1})}}}),[["__scopeId","data-v-a4a7bf77"]]),We=Object.freeze(Object.defineProperty({__proto__:null,default:Le},Symbol.toStringTag,{value:"Module"})),Ve=f({__name:"AddObstaclePropertyWidget",setup(e,{expose:t}){const o=W(),i=o?.proxy?.$options.id,r=o?.proxy?.$options.layoutID,u=h(null),c=h(null),f=h(null),v=h(null);let S=0,w=0;const x=h(["建筑","通信设施","电力设施","塔","自然物","其他障碍物"]);function j(){if(!s.CurrentFeature)return void s.Message.warn("当前选中要素为空！");const e=s.CurrentFeature,t={"障碍物":u.value,"类型":c.value,"海拔高":f.value,"自身高":v.value,"机场":"",X:S,Y:w};a(Y.UpdateFeatureProperty,{id:e.id,properties:t}),s.Message.info("更新障碍物属性成功！")}function X(){u.value=null,c.value=null,f.value=null,v.value=null}function O(e){if(e){F(e.feature)}}function F(e){if(e&&e.properties){X();const t=e.properties;Object.keys(e.properties).length>0&&(u.value=t["障碍物"],c.value=t["类型"],f.value=t["海拔高"],v.value=t["自身高"]),S=e.geometry.coordinates[0],w=e.geometry.coordinates[1]}}let L;function V(e){L=e.id}function I(e){const t=s.LayoutMap.get(r);t&&t.unloadWidget(i)}m((()=>{const e=s.CurrentFeature;e&&F(e),l(Y.ChangeCurrentFeature,O)})),g((()=>{n(Y.ChangeCurrentFeature,O)}));const E=h(!0);return t({changeVisible:function(e=!1){E.value=e,L&&e&&p.openWindowPanel(L)},isShow:E}),(e,t)=>k((y(),P(C(d),{isDark:!0,"has-min":!1,"has-close":!1,left:"10px",top:"400px",nWidth:"320px",nHeight:"360px",title:"障碍物属性信息",icon:"img/basicimage/arcgis_img.png",pid:"MeasuringWidget",onLoaded:V,onClose:I},{default:_((()=>[b(T,{style:{height:"100%"}},{default:_((()=>[b(Z,{onSubmit:j,onReset:X,class:"q-gutter-sm"},{default:_((()=>[b(A,{filled:"",modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=e=>u.value=e),label:"名称 *",hint:"障碍点名称，方便识别",dense:"","lazy-rules":"",rules:[e=>e&&e.length>0||"请输入障碍点名称"]},null,8,["modelValue","rules"]),b($,{outlined:"",modelValue:c.value,"onUpdate:modelValue":t[1]||(t[1]=e=>c.value=e),options:x.value,dense:""},null,8,["modelValue","options"]),b(A,{filled:"",type:"number",modelValue:f.value,"onUpdate:modelValue":t[2]||(t[2]=e=>f.value=e),label:"顶部海拔 *",dense:"",suffix:"米","lazy-rules":"",rules:[e=>null!==e&&""!==e||"请输入海拔高度",e=>e>0||"请输入大于0的高度值"]},null,8,["modelValue","rules"]),b(A,{filled:"",type:"number",modelValue:v.value,"onUpdate:modelValue":t[3]||(t[3]=e=>v.value=e),label:"离地高度 *",dense:"",suffix:"米","lazy-rules":"",rules:[e=>null!==e&&""!==e||"请输入离地高度",e=>e>0||"请输入大于0的高度值"]},null,8,["modelValue","rules"]),M("div",null,[b(R,{label:"更新属性",type:"submit",color:"primary"}),b(R,{label:"重置",type:"reset",color:"primary",flat:"",class:"q-ml-sm"})])])),_:1})])),_:1})])),_:1},512)),[[z,E.value]])}}),ze=Object.freeze(Object.defineProperty({__proto__:null,default:Ve},Symbol.toStringTag,{value:"Module"}));export{xe as A,te as M,We as P,me as S,Q as X,oe as a,ue as b,pe as c,_e as d,Ce as e,ze as f};
