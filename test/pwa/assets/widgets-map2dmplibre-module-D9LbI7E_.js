import{bU as e,bn as t,bo as a,c0 as o,bE as l,cr as n,bi as i,bR as r,bP as s,bu as u,bj as c,bX as d,bq as p}from"./vendor-f-vxzQBV.js";import{e as f,_ as m,O as g,a as v}from"./pages-back-module-Bp_gdyMV.js";import{S as y}from"./pages-system-module-BC4d09-a.js";import{j as b}from"./pages-product-module-C_u59JGP.js";import{c as _,B as M,Q as h,C,P as S}from"./xframelib-exp-BKAIOAJ1.js";import{d as w,o as x,a as P,m as X,g as j,j as k,f as O,p as F,r as L,u as W,t as V,O as z,z as E,e as I,F as U,B as T,k as D,q,x as B,N as A,a4 as R,w as Z,v as $}from"./@vue-exp-CvWX4Ub_.js";import{l as H}from"./xgis-cesium-exp-9TOOiljh.js";import{i as N}from"./Cesium-DDfh73kC-v2OV8yh9.js";import{P as Y}from"./widgets-cesium-module-ulMsyygA.js";const G="MainMapWidgetLoaded",J={class:"MainMapContainerWidget"},K=m(w({__name:"XMapContainerWidget",setup(t){const a=b(),o=L(a),l=L("mapLayout");let n;function i(e){n=e.layoutManager,n&&(_.MapLayoutManager=n,s())}let r=!1;function s(){r||n&&_.XMap&&(r=!0,n.loadWidget("MapproxyWidget"))}const u={"ScaleControl.Meters":"米","ScaleControl.Kilometers":"千米","NavigationControl.ZoomIn":"放大","NavigationControl.ZoomOut":"缩小","NavigationControl.Compass":"罗盘","FullscreenControl.Enter":"地图全屏","FullscreenControl.Exit":"退出全屏"};function c(t){if(_.XMap)f(G,_.XMap);else{const a=new e.Map({container:"map",style:t,attributionControl:!1,locale:u});_.XMap=a,_.XMapStyle=t,f(G,a),setTimeout((()=>{a.resize(),function(e){if(!_.Config.MapExtent||!e)return;const t=_.Config.MapExtent;e.fitBounds(t)}(a)}),100)}}return x((async()=>{if(_.Config.ServiceURL.Map2dStyleURL){const e=await M(_.Config.ServiceURL.Map2dStyleURL);if(e&&e.data){c(e.data),s()}else _.Message.warn("请求二维地图失败！")}})),P((()=>{f(y.System_WindowHalfSize,0),_.XMap&&(_.XMap.remove(),_.XMap=void 0)})),(e,t)=>(j(),X("div",J,[k(W(h),{widgetConfig:o.value,layoutID:l.value,onContainerLoaded:i},{main:O((()=>[...t[0]||(t[0]=[F("div",{id:"map",class:"mapstyle"},null,-1)])])),_:1},8,["widgetConfig","layoutID"])]))}}),[["__scopeId","data-v-3525379b"]]),Q=Object.freeze(Object.defineProperty({__proto__:null,default:K},Symbol.toStringTag,{value:"Module"})),ee=m(w({__name:"MapproxyWidget",setup(e){let t=!1;return(e,a)=>{const o=V("Icon");return j(),X("div",{class:"mapproxyPanel",title:"打开关闭二维地图",onClick:a[0]||(a[0]=z((e=>(t=!t,void f(y.System_WindowHalfSize,t?1:2))),["prevent"]))},[k(o,{icon:"ant-design:split-cells-outlined",class:"splitIcon"})])}}}),[["__scopeId","data-v-8f07c7a8"]]),te=Object.freeze(Object.defineProperty({__proto__:null,default:ee},Symbol.toStringTag,{value:"Module"})),ae=w({__name:"MapControlWidget",setup(t){let a,o,l;return x((()=>{if(_.XMap){const t=_.XMap;o=new e.ScaleControl({unit:"metric"}),t.addControl(o,"bottom-left"),a=new e.NavigationControl,t.addControl(a,"bottom-left"),l=new e.FullscreenControl,t.addControl(l,"bottom-left")}})),P((()=>{if(_.XMap){const e=_.XMap;l&&e.removeControl(l),a&&e.removeControl(a),o&&e.removeControl(o)}})),(e,t)=>(j(),X("div"))}}),oe=Object.freeze(Object.defineProperty({__proto__:null,default:ae},Symbol.toStringTag,{value:"Module"})),le={class:"statusPanel"},ne={class:"q-mr-md"},ie={class:"q-mr-md"},re={class:"q-mr-md"},se=m(w({__name:"MapStatusWidget",setup(e){const t=L({lat:0,lon:0,zoom:0});function a(e){t.value.lon=e.lngLat.lng.toFixed(8),t.value.lat=e.lngLat.lat.toFixed(8)}function o(e){t.value.zoom=Math.floor(e.target.getZoom())}return x((()=>{if(_.XMap){const{lng:e,lat:l}=_.XMap.getCenter();t.value.lat=l.toFixed(8),t.value.lon=e.toFixed(8),t.value.zoom=Math.floor(_.XMap.getZoom()),_.XMap.on("mousemove",a),_.XMap.on("zoom",o)}})),P((()=>{_.XMap&&(_.XMap.off("mousemove",a),_.XMap.off("zoom",o))})),(e,a)=>(j(),X("div",le,[F("span",ne," 经度: "+E(t.value.lon),1),F("span",ie," 纬度:"+E(t.value.lat),1),F("span",re," 层级: "+E(t.value.zoom),1)]))}}),[["__scopeId","data-v-6b7e0199"]]),ue=Object.freeze(Object.defineProperty({__proto__:null,default:se},Symbol.toStringTag,{value:"Module"})),ce={style:{"min-width":"150px"}},de=w({__name:"MapDefaultMenuWidget",setup(e){const n=L([{label:"查看此处坐标",value:-1},{label:"放大",value:0},{label:"缩小",value:1},{label:"全屏",value:2},{label:"复原",value:3}]),i=L(!1);let r,s,u=!1;function c(e){s=e.lngLat}return x((()=>{_.XMap&&(r=_.XMap,r.on("contextmenu",c))})),P((()=>{r&&r.off("contextmenu",c)})),(e,c)=>(j(),I(l,{modelValue:i.value,"onUpdate:modelValue":c[0]||(c[0]=e=>i.value=e),target:"#map","context-menu":""},{default:O((()=>[F("div",ce,[k(t,{bordered:"",separator:"",dense:""},{default:O((()=>[(j(!0),X(U,null,T(n.value,((e,t)=>D((j(),I(a,{class:"items-center",clickable:"",key:t,onClick:t=>function(e){switch(i.value=!1,e){case-1:_.Message.info(`当前点击坐标为:${s.lng},${s.lat}`,5);break;case 0:r.setZoom(r.getZoom()+1);break;case 1:r.setZoom(r.getZoom()-1);break;case 2:u?document.exitFullscreen():document.documentElement.requestFullscreen(),u=!u;break;case 3:r.setPitch(0),r.setBearing(0);break;default:return}}(e.value)},{default:O((()=>[q(E(e.label),1)])),_:2},1032,["onClick"])),[[o]]))),128))])),_:1})])])),_:1},8,["modelValue"]))}}),pe=Object.freeze(Object.defineProperty({__proto__:null,default:de},Symbol.toStringTag,{value:"Module"})),fe=w({__name:"Sync2D3DWidget",setup(e){let t,a;function o(){try{a&&(a.off("moveend",r),a.off("zoomend",r))}catch(e){}try{t&&(t.off(H.WHEEL,i),t.off(H.LEFT_UP,i))}catch(e){}}function l(){o(),t&&(t.on(H.WHEEL,i),t.on(H.LEFT_UP,i))}function n(){o(),a&&(a.on("moveend",r),a.on("zoomend",r))}function i(){if(t&&a){const e=t.camera.computeViewRectangle();if(e){const t=e.west/Math.PI*180,o=e.north/Math.PI*180,l=e.east/Math.PI*180,n=[t,e.south/Math.PI*180,l,o];a.fitBounds(n)}}}function r(){if(a){const e=a.getBounds();t&&e&&t.camera.setView({destination:N.Rectangle.fromDegrees(e.getWest(),e.getSouth(),e.getEast(),e.getNorth()),orientation:{heading:.049106700935120706,pitch:-1.560509974137843,roll:0}})}}return x((()=>{t=_.CesiumViewer,t&&t.on(H.MOUSE_MOVE,l),a=_.XMap,a&&a.on("mousemove",n)})),P((()=>{t&&t.off(H.MOUSE_MOVE,l),a&&a.off("mousemove",n)})),(e,t)=>(j(),X("div"))}}),me=Object.freeze(Object.defineProperty({__proto__:null,default:fe},Symbol.toStringTag,{value:"Module"})),ge={class:"column btn-group2"},ve=["onClick"],ye=["src"],be=m(w({__name:"MapRightButtonGroup",setup(e){const t=L([]);function a(e,t=!0){const a=_.XMap;if(!a)return;const o=new Array;a.getStyle().layers.forEach((t=>{if(t.id.startsWith(e)){const e=t.id;o.push(e)}}));const l=t?"visible":"none";o.forEach((e=>{a.setLayoutProperty(e,"visibility",l)}))}const o=L([]);return x((async()=>{o.value=await fetch("LayerJson/LayerConfig.json").then((e=>e.json())),_.CesiumViewer?_.CesiumViewer:_.Message.info("未获取到地图")})),(e,l)=>{const n=B("tooltip");return j(),X("div",ge,[(j(!0),X(U,null,T(o.value,(e=>{return D((j(),X("div",{class:A(["btn-item",(o=e,-1!==t.value.indexOf(o.id)?"active":"")]),onClick:o=>function(e){const o=t.value.indexOf(e.id);-1===o?(t.value.push(e.id),a(e.name,!1)):(t.value.splice(o,o+1),a(e.name,!0))}(e)},[F("img",{src:e.icon,alt:""},null,8,ye)],10,ve)),[[n,e.name,void 0,{left:!0}]]);var o})),256))])}}}),[["__scopeId","data-v-02d2e20f"]]),_e=Object.freeze(Object.defineProperty({__proto__:null,default:be},Symbol.toStringTag,{value:"Module"})),Me={style:{"max-width":"300px","max-height":"400px",overflow:"auto"}},he=w({__name:"SelectFeatureWidget",setup(e){let t;const a=L(!1),o=L([]);function n(e){o.value.length=0;const l=t.queryRenderedFeatures(e.point);let n=0;l&&l.length>0&&l.forEach((e=>{if("line"===e.layer.type&&("低空航线"===e.sourceLayer||"低空空域"===e.sourceLayer)){const t=e.sourceLayer,a={...e.properties};n++,o.value.push({layer:t,properties:a})}})),a.value=0!==n}return x((()=>{_.XMap&&(t=_.XMap,t.on("click",n))})),P((()=>{t&&t.off("click",n)})),(e,t)=>(j(),I(l,{"model-value":a.value,target:"#map","touch-position":""},{default:O((()=>[F("div",Me,[(j(!0),X(U,null,T(o.value,((e,t)=>(j(),X("div",{class:"q-pa-sm",key:t},[F("div",null,"图层名称:"+E(e.layer),1),(j(!0),X(U,null,T(e.properties,((e,t)=>(j(),X("div",{key:t},E(t)+":"+E(e),1)))),128))])))),128))])])),_:1},8,["model-value"]))}}),Ce=Object.freeze(Object.defineProperty({__proto__:null,default:he},Symbol.toStringTag,{value:"Module"})),Se={class:"rightBtnList"},we=m(w({__name:"AirportFilterBtnWidget",setup(e){function t(){_.MapLayoutManager&&_.MapLayoutManager.loadWidget("AirportSearchPanelWidget")}function a(){_.MapLayoutManager&&_.MapLayoutManager.loadWidget("PlotObstacleWidget")}return(e,o)=>{const l=V("Icon"),n=B("tooltip");return j(),X("div",Se,[D(k(l,{icon:"icon-park-solid:filter",class:"filterBtn",onClick:t},null,512),[[n,"机场查询"]]),D(k(l,{icon:"mdi-map-marker",class:"filterBtn",onClick:a},null,512),[[n,"绘制障碍物"]])])}}}),[["__scopeId","data-v-a9e10c90"]]),xe=Object.freeze(Object.defineProperty({__proto__:null,default:we},Symbol.toStringTag,{value:"Module"})),Pe={class:"toolbar"},Xe={class:"row q-mt-sm"},je={class:"text-center textContent"},ke={class:"coordatePanel"},Oe={class:"leftXY"},Fe={class:"rightAdd"},Le=m(w({__name:"PlotObstacleWidget",setup(e,{expose:t}){const a=R(),o=a?.proxy?.$options.layoutID,l=[{id:"建筑",label:"建筑",icon:"ps:building"},{id:"通信设施",label:"通信设施",icon:"fluent-mdl2:network-tower"},{id:"电力设施",label:"电力设施",icon:"icon-park:signal-tower-one"},{id:"自然物",label:"自然物",icon:"emojione-monotone:evergreen-tree"},{id:"塔",label:"塔",icon:"icon-park:eiffel-tower"},{id:"其他障碍物",label:"其他障碍物",icon:"ri:error-warning-fill"}];let d,p;const m=L(null),y=L(null),b=L(""),M=L("");function h(){d&&b.value&&(d.trash(),b.value="")}function S(){if(d){const e=d.getAll();e.features.length>0&&(_.CurrentFeature=void 0,f(Y.SyncAddFeatures,e.features))}}function w(){if(m.value&&y.value)if(m.value>116.5&&m.value<116.9)if(y.value>23.9&&y.value<30.7){if(d){const e={type:"Point",coordinates:[m.value,y.value]};b.value=d.add(e)}}else _.Message.warn("Y坐标无效！");else _.Message.warn("X坐标无效！");else _.Message.warn("X或Y坐标不能为空！")}let z;function D(e){e.id}function B(e){if(e.pid){z=e.pid;const t=_.MapLayoutManager;t&&t.unloadWidget(z)}}function $(e){return M.value&&e.id===M.value?"iconLine iconLine-Active":"iconLine"}function H(e){if("draw.create"===e.type){if(e.features.length>0){const t=e.features[0];b.value=t.id}}else if("draw.selectionchange"===e.type&&e.features.length>0){const t=e.features[0];b.value=t.id,_.CurrentFeature=t}}function N(e){if(e){const t=e.id,a=e.properties;if(d){if(d.get(t)){for(const e in a){const o=a[e];d.setFeatureProperty(t,e,o)}d.get(t)}}}}Z((()=>b.value),(e=>{e&&(_.CurrentFeature=d.get(e),_.CurrentFeature.properties["类型"]||(_.CurrentFeature.properties["类型"]=p),function(){const e=_.LayoutMap.get(o);e&&e.loadWidget("AddObstaclePropertyWidget")}(),f(Y.ChangeCurrentFeature,{feature:_.CurrentFeature}))})),x((()=>{if(_.CurrentFeature=void 0,_.XMap){const e=_.XMap;d=new n({displayControlsDefault:!1,controls:{point:!0},styles:[{id:"highlight-active-points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","true"]],paint:{"circle-radius":8,"circle-color":"#ff0"}},{id:"points-are-blue",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","false"]],paint:{"circle-radius":6,"circle-color":"#f00"}}]}),e.addControl(d),e.on("draw.create",H),e.on("draw.selectionchange",H)}g(Y.UpdateFeatureProperty,N)})),P((()=>{if(_.CurrentFeature=void 0,_.XMap){const e=_.XMap;d&&(e.off("draw.create",H),e.off("draw.selectionchange",H),e.removeControl(d))}v(Y.UpdateFeatureProperty,N)}));return t({changeVisible:function(e=!1){},isShow:L(!0)}),(e,t)=>{const a=V("Icon");return j(),I(W(C),{"has-min":!1,isDark:!0,left:"10px",top:"45px",nWidth:"320px",nHeight:"360px",title:"标绘工具",icon:"img/basicimage/arcgis_img.png",pid:"PlotObstacleWidget",onLoaded:D,onClose:B},{title:O((()=>[t[2]||(t[2]=F("img",{src:"img/bigscreen/Liangce.png",width:"24",height:"24"},null,-1)),t[3]||(t[3]=F("span",{class:"paneltitle"},"标绘工具",-1)),F("div",Pe,[F("span",{title:"删除选中",onClick:h},[k(a,{icon:"ant-design:clear-outlined"})]),F("span",{title:"提交保存",onClick:S},[k(a,{icon:"mdi-light:content-save"})])])])),default:O((()=>[k(i,{style:{height:"100%"}},{default:O((()=>[F("div",Xe,[(j(),X(U,null,T(l,((e,t)=>F("div",{class:"col-3 q-mb-sm",key:t},[k(r,{flat:"",class:"cardContent column items-center",onClick:t=>function(e){M.value=e.id,p=e.id,d&&d.changeMode("draw_point")}(e)},{default:O((()=>[F("div",{class:A($(e))},[k(a,{icon:e.icon,class:"measureIconStyle"},null,8,["icon"])],2),F("div",je,E(e.label),1)])),_:2},1032,["onClick"])]))),64)),k(s,{dark:""},{default:O((()=>[...t[4]||(t[4]=[q("坐标添加",-1)])])),_:1}),F("div",ke,[F("div",Oe,[k(u,{type:"number",outlined:"",modelValue:m.value,"onUpdate:modelValue":t[0]||(t[0]=e=>m.value=e),label:"X坐标",dense:!0,hint:"请输入(116.5 ~ 116.9)之间数值","lazy-rules":"",rules:[e=>null!==e&&""!==e||"请输入X坐标-经度",e=>e>116.5&&e<116.9||"请输入(116.5 ~ 116.9)之间值"]},null,8,["modelValue","rules"]),k(u,{type:"number",outlined:"",modelValue:y.value,"onUpdate:modelValue":t[1]||(t[1]=e=>y.value=e),label:"Y坐标",dense:!0,hint:"请输入(23.9 ~ 30.7)之间数值","lazy-rules":"",rules:[e=>null!==e&&""!==e||"请输入Y坐标-纬度",e=>e>23.9&&e<30.7||"请输入(23.9 ~ 30.7)之间值"]},null,8,["modelValue","rules"])]),F("div",Fe,[k(c,{color:"white","text-color":"black",label:"添加点",onClick:w})])])])])),_:1})])),_:1})}}}),[["__scopeId","data-v-a4a7bf77"]]),We=Object.freeze(Object.defineProperty({__proto__:null,default:Le},Symbol.toStringTag,{value:"Module"})),Ve=w({__name:"AddObstaclePropertyWidget",setup(e,{expose:t}){const a=R(),o=a?.proxy?.$options.id,l=a?.proxy?.$options.layoutID,n=L(null),r=L(null),s=L(null),m=L(null);let y=0,b=0;const M=L(["建筑","通信设施","电力设施","塔","自然物","其他障碍物"]);function h(){if(!_.CurrentFeature)return void _.Message.warn("当前选中要素为空！");const e=_.CurrentFeature,t={"障碍物":n.value,"类型":r.value,"海拔高":s.value,"自身高":m.value,"机场":"",X:y,Y:b};f(Y.UpdateFeatureProperty,{id:e.id,properties:t}),_.Message.info("更新障碍物属性成功！")}function w(){n.value=null,r.value=null,s.value=null,m.value=null}function X(e){if(e){V(e.feature)}}function V(e){if(e&&e.properties){w();const t=e.properties;Object.keys(e.properties).length>0&&(n.value=t["障碍物"],r.value=t["类型"],s.value=t["海拔高"],m.value=t["自身高"]),y=e.geometry.coordinates[0],b=e.geometry.coordinates[1]}}let z;function E(e){z=e.id}function U(e){const t=_.LayoutMap.get(l);t&&t.unloadWidget(o)}x((()=>{const e=_.CurrentFeature;e&&V(e),g(Y.ChangeCurrentFeature,X)})),P((()=>{v(Y.ChangeCurrentFeature,X)}));const T=L(!0);return t({changeVisible:function(e=!1){T.value=e,z&&e&&S.openWindowPanel(z)},isShow:T}),(e,t)=>D((j(),I(W(C),{isDark:!0,"has-min":!1,"has-close":!1,left:"10px",top:"400px",nWidth:"320px",nHeight:"360px",title:"障碍物属性信息",icon:"img/basicimage/arcgis_img.png",pid:"MeasuringWidget",onLoaded:E,onClose:U},{default:O((()=>[k(i,{style:{height:"100%"}},{default:O((()=>[k(d,{onSubmit:h,onReset:w,class:"q-gutter-sm"},{default:O((()=>[k(u,{filled:"",modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value=e),label:"名称 *",hint:"障碍点名称，方便识别",dense:"","lazy-rules":"",rules:[e=>e&&e.length>0||"请输入障碍点名称"]},null,8,["modelValue","rules"]),k(p,{outlined:"",modelValue:r.value,"onUpdate:modelValue":t[1]||(t[1]=e=>r.value=e),options:M.value,dense:""},null,8,["modelValue","options"]),k(u,{filled:"",type:"number",modelValue:s.value,"onUpdate:modelValue":t[2]||(t[2]=e=>s.value=e),label:"顶部海拔 *",dense:"",suffix:"米","lazy-rules":"",rules:[e=>null!==e&&""!==e||"请输入海拔高度",e=>e>0||"请输入大于0的高度值"]},null,8,["modelValue","rules"]),k(u,{filled:"",type:"number",modelValue:m.value,"onUpdate:modelValue":t[3]||(t[3]=e=>m.value=e),label:"离地高度 *",dense:"",suffix:"米","lazy-rules":"",rules:[e=>null!==e&&""!==e||"请输入离地高度",e=>e>0||"请输入大于0的高度值"]},null,8,["modelValue","rules"]),F("div",null,[k(c,{label:"更新属性",type:"submit",color:"primary"}),k(c,{label:"重置",type:"reset",color:"primary",flat:"",class:"q-ml-sm"})])])),_:1})])),_:1})])),_:1},512)),[[$,T.value]])}}),ze=Object.freeze(Object.defineProperty({__proto__:null,default:Ve},Symbol.toStringTag,{value:"Module"}));export{xe as A,te as M,We as P,me as S,Q as X,oe as a,ue as b,pe as c,_e as d,Ce as e,ze as f};
