import{d as e,G as s,r as a,I as l,J as n,f as t,Y as o,q as r,n as i,A as u,R as c,i as d,b as m,L as g,j as p,w as f,M as v,t as w,c as y,P as h,X as S,Q as k,T as b,W as x,Z as _,a0 as T}from"./vendor.5af50741.js";import{_ as M}from"./logo.50226ed7.js";import{_ as j}from"./index.d6011a7c.js";import"./expansion-moment.d5a89207.js";import"./expansion-axios.5452c070.js";const I=e({setup(){const e=u.t,d=s({username:"",password:""}),m=a(),g=a(),p=a("统一用户验证服务"),f=l(),v=n();let w,y=k();function k(){let e=document.URL.indexOf("redirect=");if(e>0){return document.URL.substring(e+9)}}return t((async()=>{var s,a,l,n;if(y=k(),y&&(w=null==(a=null==(s=v.query)?void 0:s.tk)?void 0:a.toString()),w){const s=await o(w),a=null==s?void 0:s.data;if(a)if(a.isSuccess){r(a.resultValue),i(a.resultValue.doubleToken),null==(l=u.Message)||l.msg(e("sys.login.loginSuccessTitle"));const s=c();s&&((null==y?void 0:y.indexOf("?"))>0?y+="&tk="+s.token:y+="?tk="+s.token,f.replace(y).then((e=>{"login"==v.name&&f.replace("/")})))}else null==(n=u.Message)||n.warn(e("sys.login.loginTokenFailInfo"))}})),{t:e,formState:d,onblur:function(){m.value&&(m.value.placeholder=e("sys.login.accountPlaceholder")),g.value&&(g.value.placeholder=e("sys.login.passwordPlaceholder"))},nameInput:m,pwdInput:g,systemTitle:p,handleSubmit:async()=>{var s,a,l,n;if(""===d.username.trim()||""==d.password.trim())return null==(s=u.Message)?void 0:s.warn(e("sys.login.loginEmtyWarnInfo"));let t={username:d.username.trim(),pwd:h.MD5(d.password)};const o=await S(t);if(o)if(o.isSuccess){const s=k()||"/";if(f)if(s.startsWith("http://")||s.startsWith("https://")){const e=c();window.open(s+"?tk="+e.token,"_self")}else f.replace(s).then((e=>{"login"==v.name&&f.replace("/")}));null==(l=u.Message)||l.msg(e("sys.login.loginSuccessTitle"))}else null==(n=u.Message)||n.warn(o.ResultDescription||e("sys.login.loginFailTitle"));else null==(a=u.Message)||a.warn(e("sys.login.loginFailTitle"))}}}}),P={class:"bgc-image"},R=v("img",{src:M,alt:"",class:"logo"},null,-1),U={style:{"text-align":"center"}};var L=j(I,[["render",function(e,s,a,l,n,t){const o=d("UserOutlined"),r=k,i=b,u=d("LockOutlined"),c=x,h=_,S=T;return m(),g("div",P,[R,p(S,{class:"login-view",ref:"formRef",model:e.formState,rules:e.rules},{default:f((()=>[v("p",U,w(e.systemTitle),1),p(i,{name:"username",ref:"name"},{default:f((()=>[p(r,{placeholder:e.t("sys.login.accountPlaceholder"),class:"login-input",value:e.formState.username,"onUpdate:value":s[0]||(s[0]=s=>e.formState.username=s)},{prefix:f((()=>[p(o,{style:{color:"rgba(0, 0, 0, 0.5)"}})])),_:1},8,["placeholder","value"])])),_:1},512),p(i,{name:"password"},{default:f((()=>[p(c,{placeholder:e.t("sys.login.passwordPlaceholder"),class:"login-input",value:e.formState.password,"onUpdate:value":s[1]||(s[1]=s=>e.formState.password=s)},{prefix:f((()=>[p(u,{style:{color:"rgba(0, 0, 0, 0.5)"}})])),_:1},8,["placeholder","value"])])),_:1}),p(i,null,{default:f((()=>[p(h,{onClick:e.handleSubmit,class:"login-button"},{default:f((()=>[y(w(e.t("sys.login.loginButton")),1)])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model","rules"])])}]]);export{L as default};
