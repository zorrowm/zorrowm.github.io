import{F as S,G as M,I as R,J as X}from"./vendor-Dka75WDo.js";import{d as x,ac as Y,L as q,H as L,M as O,W as P,V as T,P as W,r as y,u as K,N as Q,O as Z,ad as J}from"./@vue-exp-BMz8X7Pi.js";import{d as G}from"./index-uk12gd3X.js";import{w as j,N as V}from"./xframelib-exp-BYnL-see.js";import"./@hprose-exp-CwcCDL56.js";import"./vue-router-exp-COsaUipG.js";import"./axios-exp-DvxIUWKU.js";const z=x({__name:"PopoverPanel",props:{isShown:S().def(!1),leftX:M().def("0px"),topY:M().def("0px"),autoHide:S().def(!1)},setup(a,{expose:t}){t(),Y(n=>({"02eea6e8":a.leftX,e74a722e:a.topY}));const e={};return Object.defineProperty(e,"__isScriptSetup",{enumerable:!1,value:!0}),e}}),$={class:"popoverInfo"};function ee(a,t,e,n,s,l){const r=q("VDropdown");return L(),O("div",$,[P(r,{placement:"top",distance:10,triggers:[],shown:e.isShown,autohide:e.autoHide},{popper:T(()=>[W(a.$slots,"content",{},void 0,!0)]),_:3},8,["shown","autohide"])])}const te=G(z,[["render",ee],["__scopeId","data-v-c5f4fcb4"],["__file","PopoverPanel.vue"]]);function ne(a){let t=Cesium.Color.STEELBLUE;switch(a){case"给水管":t=Cesium.Color.AQUA;break;case"热力":t=Cesium.Color.TOMATO;break;case"天然气":t=Cesium.Color.ORANGE;break;case"污水管":t=Cesium.Color.BLACK;break;case"雨水管":t=Cesium.Color.SADDLEBROWN;break;case"交通信号":t=Cesium.Color.DARKORCHID;break}return t}function ae(a){const t=[];for(let e=0;e<360;e++){const n=Cesium.Math.toRadians(e),s=new Cesium.Cartesian2(a*Math.cos(n),a*Math.sin(n));t.push(s)}return t}async function re(a,t){return a.features.find(n=>n.properties.管线编===t)}async function ie(a){const t=await j(a).catch(e=>{});if(t&&t.data)return t.data}async function oe(a){const t=new Array;return a.features.forEach(e=>{const n=e.geometry.coordinates,s=n[0],l=n[1],r=e.properties,b=r.管线编,h=r.起点高,p=r.终点高,_=parseFloat(r.管径)/1e3,C=r.图层,u=ne(C),v=new Cesium.PolylineVolumeGeometry({polylinePositions:Cesium.Cartesian3.fromDegreesArrayHeights([s[0],s[1],h,l[0],l[1],p]),shapePositions:ae(_)}),g=Cesium.PolylineVolumeGeometry.createGeometry(v),w=new Cesium.GeometryInstance({geometry:g,id:b,attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(u)}}),F=new Cesium.PerInstanceColorAppearance({flat:!0,translucent:!1}),A=new Cesium.Primitive({geometryInstances:w,appearance:F,asynchronous:!1});t.push(A)}),t}async function se(a){const t=await j(a).catch(e=>{});if(t&&t.data)return t.data}async function le(a,t){return a.features.find(n=>n.properties.ID===t)}async function ce(a){const t=new Cesium.PrimitiveCollection,e=new Cesium.Material({fabric:{type:"Image",uniforms:{image:"/img/jing2.png"}}}),n=new Cesium.MaterialAppearance({material:e,faceForward:!1});return a.features.forEach(s=>{const l=s.geometry.coordinates,r=s.properties,b=r.ID;r.图层,r.埋深;const h=r.井底高,p=r.height,_=new Cesium.GeometryInstance({id:b,geometry:new Cesium.CircleGeometry({center:Cesium.Cartesian3.fromDegrees(l[0],l[1]),radius:1,height:p+1,extrudedHeight:h})}),C=new Cesium.Primitive({geometryInstances:_,appearance:n});C.disableDepthTestDistance=99e3,t.add(C)}),t}const ue=x({__name:"PipelineWidget",setup(a,{expose:t}){t();let e;const n=y(!1),s=y(!1),l=y(!1),r=y("0px"),b=y("0px"),h=[{name:"name",label:"属性名",align:"left",field:"name"},{name:"value",align:"center",label:"值",field:"value"}],p=y([]),_=y({rowsPerPage:0});function C(){return V.CesiumViewer&&(e||(e=V.CesiumViewer)),e}let u,v=!0,g,w;const F=new Cesium.Material({fabric:{type:"Image",uniforms:{image:"/img/jing2.png"}}}),A=new Cesium.Material({fabric:{type:"Image",uniforms:{image:"/img/red.png"}}}),D=new Cesium.MaterialAppearance({material:A,faceForward:!1}),N=new Cesium.MaterialAppearance({material:F,faceForward:!1});function I(){u&&(u.primitive&&(v?u.primitive.appearance=new Cesium.PerInstanceColorAppearance({flat:!0,translucent:!1}):u.primitive.appearance=new Cesium.MaterialAppearance({material:F,faceForward:!1})),e.scene.requestRender(),u=void 0)}K(()=>{C(),new Cesium.ScreenSpaceEventHandler(e.scene.canvas).setInputAction(async function(f){const m=f.position;var c=e.scene.pick(f.position);if(c)if(l.value=!1,b.value=m.y+"px",r.value=m.x+"px",u&&I(),u=c,setTimeout(()=>{l.value=!0},50),c.id.length>10){v=!0,c.primitive.appearance=new Cesium.MaterialAppearance({material:Cesium.Material.fromType("Color"),faceForward:!0}),c.primitive.appearance.material.uniforms.color=new Cesium.Color(1,0,0,1),e.scene.requestRender();const d=await re(g,c.id);if(p.value.length=0,d){const i=d.properties;p.value=[{name:"管线编号",value:i.管线编},{name:"类型",value:i.图层},{name:"材质",value:i.材质},{name:"长度",value:i.长度},{name:"位置",value:i.所在道},{name:"起点埋",value:i.起点埋},{name:"终点埋",value:i.终点埋},{name:"管径",value:i.管径}]}}else{c.primitive.appearance=D,e.scene.requestRender(),v=!1;const d=await le(w,c.id);if(p.value.length=0,d){const i=d.properties;p.value=[{name:"编号",value:i.ID},{name:"类型",value:i.图层},{name:"特征",value:i.特征},{name:"地面高程",value:i.地面高},{name:"井底高程",value:i.井底高},{name:"埋设方法",value:i.埋设方}]}}else l.value=!1,I()},Cesium.ScreenSpaceEventType.LEFT_CLICK),ie("data/line_4490.json").then(async f=>{g=f;const m=await oe(g);m&&m.forEach(c=>{e.scene.primitives.add(c)})}),se("data/point_4490.json").then(async f=>{w=f;const m=await ce(w);if(m){const c=m.length;for(let d=0;d<c;++d){const i=m.get(d);e.scene.primitives.add(i)}}})});function H(o,f){e&&(e.scene.globe.depthTestAgainstTerrain=o,e.scene.requestRender())}function U(o,f){e&&(o?E():k(),e.scene.requestRender())}function E(){e.scene.screenSpaceCameraController.enableCollisionDetection=!1,e.scene.globe.translucency.enabled=!0,e.scene.globe.translucency.frontFaceAlphaByDistance=new Cesium.NearFarScalar(400,.5,8e3,.9)}function k(){e.scene.screenSpaceCameraController.enableCollisionDetection=!0,e.scene.globe.translucency.enabled=!1}const B={get viewer(){return e},set viewer(o){e=o},depthRef:n,subwayRef:s,isOpen:l,leftX:r,topY:b,columns:h,rows:p,pagination:_,getViewer:C,get lastPick(){return u},set lastPick(o){u=o},get lastIsLine(){return v},set lastIsLine(o){v=o},get line4490(){return g},set line4490(o){g=o},get point4490(){return w},set point4490(o){w=o},imgMaterial:F,imgMaterial2:A,appearanceSelected:D,appearanceIntance:N,rebackAppearance:I,depthChanged:H,subwayChanged:U,OpenUnderGroup:E,CloseUnderGroud:k,PopoverPanel:te};return Object.defineProperty(B,"__isScriptSetup",{enumerable:!1,value:!0}),B}}),pe={class:"toolbarLine"},me=J('<div class="legendPanel" data-v-13136449><b data-v-13136449>管线图例：</b><ul data-v-13136449><li style="background-color:#00FFFF;" data-v-13136449>给水管：#00FFFF </li><li style="background-color:#FF6347;" data-v-13136449>热力 : #FF6347</li><li style="background-color:#FFA500;" data-v-13136449>天然气 :#FFA500</li><li style="background-color:#000000;color:#fff;" data-v-13136449>污水管 :#000000 </li><li style="background-color:#8B4513;" data-v-13136449>雨水管 :#8B4513</li><li style="background-color:#9932CC;" data-v-13136449>交通信号 :#9932CC</li><li style="background-color:#4682B4;" data-v-13136449>其他 :#4682B4 </li></ul></div>',1);function de(a,t,e,n,s,l){return L(),O(Z,null,[P(n.PopoverPanel,{isShown:n.isOpen,leftX:n.leftX,topY:n.topY},{content:T(()=>[P(X,{pagination:n.pagination,"onUpdate:pagination":t[0]||(t[0]=r=>n.pagination=r),title:"属性表",rows:n.rows,columns:n.columns,"row-key":"name",dense:!0},null,8,["pagination","rows"])]),_:1},8,["isShown","leftX","topY"]),Q("div",pe,[P(R,{modelValue:n.depthRef,"onUpdate:modelValue":[t[1]||(t[1]=r=>n.depthRef=r),n.depthChanged],label:"地形深度检测"},null,8,["modelValue"]),P(R,{modelValue:n.subwayRef,"onUpdate:modelValue":[t[2]||(t[2]=r=>n.subwayRef=r),n.subwayChanged],label:"地下模式"},null,8,["modelValue"])]),me],64)}const he=G(ue,[["render",de],["__scopeId","data-v-13136449"],["__file","PipelineWidget.vue"]]);export{he as default};
