var Rr=Object.defineProperty;var Pr=(n,e,t)=>e in n?Rr(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var L=(n,e,t)=>Pr(n,typeof e!="symbol"?e+"":e,t);import{a as no,M as ce,P as Q,R as Ne,N as re,Q as Ee,W as at,V as ke,z as Qt,S as Mr,a2 as Ln,L as Zt,I as de,a3 as Lr,O as xe,a4 as $e,d as De,r as le,H as G,l as Ie,u as en,E as Ar,n as tn,q as Dr,w as Ue,p as Br,y as $r,a5 as Nr,a6 as Wt,_ as oo,a7 as jr,K as Hr,a8 as Ce,k as Or,m as Ur}from"./@vue-exp-BMz8X7Pi.js";import{a as Wr}from"./axios-exp-DvxIUWKU.js";import{P as qr}from"./vendor-09XKH5X6.js";import{C as xt,B as An,H as Fr,b as zr}from"./@hprose-exp-zVZHOVCF.js";const Xr=Object.prototype.toString;function nn(n,e){return Xr.call(n)===`[object ${e}]`}function Gr(n){return nn(n,"Function")}const on=n=>n!=null&&n!==null&&nn(n,"Object");function ro(n){return nn(n,"String")}var Te=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function gt(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Tt=gt(function(n){var e=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function t(b,h){var g=b[0],p=b[1],l=b[2],v=b[3];p=((p+=((l=((l+=((v=((v+=((g=((g+=(p&l|~p&v)+h[0]-680876936|0)<<7|g>>>25)+p|0)&p|~g&l)+h[1]-389564586|0)<<12|v>>>20)+g|0)&g|~v&p)+h[2]+606105819|0)<<17|l>>>15)+v|0)&v|~l&g)+h[3]-1044525330|0)<<22|p>>>10)+l|0,p=((p+=((l=((l+=((v=((v+=((g=((g+=(p&l|~p&v)+h[4]-176418897|0)<<7|g>>>25)+p|0)&p|~g&l)+h[5]+1200080426|0)<<12|v>>>20)+g|0)&g|~v&p)+h[6]-1473231341|0)<<17|l>>>15)+v|0)&v|~l&g)+h[7]-45705983|0)<<22|p>>>10)+l|0,p=((p+=((l=((l+=((v=((v+=((g=((g+=(p&l|~p&v)+h[8]+1770035416|0)<<7|g>>>25)+p|0)&p|~g&l)+h[9]-1958414417|0)<<12|v>>>20)+g|0)&g|~v&p)+h[10]-42063|0)<<17|l>>>15)+v|0)&v|~l&g)+h[11]-1990404162|0)<<22|p>>>10)+l|0,p=((p+=((l=((l+=((v=((v+=((g=((g+=(p&l|~p&v)+h[12]+1804603682|0)<<7|g>>>25)+p|0)&p|~g&l)+h[13]-40341101|0)<<12|v>>>20)+g|0)&g|~v&p)+h[14]-1502002290|0)<<17|l>>>15)+v|0)&v|~l&g)+h[15]+1236535329|0)<<22|p>>>10)+l|0,p=((p+=((l=((l+=((v=((v+=((g=((g+=(p&v|l&~v)+h[1]-165796510|0)<<5|g>>>27)+p|0)&l|p&~l)+h[6]-1069501632|0)<<9|v>>>23)+g|0)&p|g&~p)+h[11]+643717713|0)<<14|l>>>18)+v|0)&g|v&~g)+h[0]-373897302|0)<<20|p>>>12)+l|0,p=((p+=((l=((l+=((v=((v+=((g=((g+=(p&v|l&~v)+h[5]-701558691|0)<<5|g>>>27)+p|0)&l|p&~l)+h[10]+38016083|0)<<9|v>>>23)+g|0)&p|g&~p)+h[15]-660478335|0)<<14|l>>>18)+v|0)&g|v&~g)+h[4]-405537848|0)<<20|p>>>12)+l|0,p=((p+=((l=((l+=((v=((v+=((g=((g+=(p&v|l&~v)+h[9]+568446438|0)<<5|g>>>27)+p|0)&l|p&~l)+h[14]-1019803690|0)<<9|v>>>23)+g|0)&p|g&~p)+h[3]-187363961|0)<<14|l>>>18)+v|0)&g|v&~g)+h[8]+1163531501|0)<<20|p>>>12)+l|0,p=((p+=((l=((l+=((v=((v+=((g=((g+=(p&v|l&~v)+h[13]-1444681467|0)<<5|g>>>27)+p|0)&l|p&~l)+h[2]-51403784|0)<<9|v>>>23)+g|0)&p|g&~p)+h[7]+1735328473|0)<<14|l>>>18)+v|0)&g|v&~g)+h[12]-1926607734|0)<<20|p>>>12)+l|0,p=((p+=((l=((l+=((v=((v+=((g=((g+=(p^l^v)+h[5]-378558|0)<<4|g>>>28)+p|0)^p^l)+h[8]-2022574463|0)<<11|v>>>21)+g|0)^g^p)+h[11]+1839030562|0)<<16|l>>>16)+v|0)^v^g)+h[14]-35309556|0)<<23|p>>>9)+l|0,p=((p+=((l=((l+=((v=((v+=((g=((g+=(p^l^v)+h[1]-1530992060|0)<<4|g>>>28)+p|0)^p^l)+h[4]+1272893353|0)<<11|v>>>21)+g|0)^g^p)+h[7]-155497632|0)<<16|l>>>16)+v|0)^v^g)+h[10]-1094730640|0)<<23|p>>>9)+l|0,p=((p+=((l=((l+=((v=((v+=((g=((g+=(p^l^v)+h[13]+681279174|0)<<4|g>>>28)+p|0)^p^l)+h[0]-358537222|0)<<11|v>>>21)+g|0)^g^p)+h[3]-722521979|0)<<16|l>>>16)+v|0)^v^g)+h[6]+76029189|0)<<23|p>>>9)+l|0,p=((p+=((l=((l+=((v=((v+=((g=((g+=(p^l^v)+h[9]-640364487|0)<<4|g>>>28)+p|0)^p^l)+h[12]-421815835|0)<<11|v>>>21)+g|0)^g^p)+h[15]+530742520|0)<<16|l>>>16)+v|0)^v^g)+h[2]-995338651|0)<<23|p>>>9)+l|0,p=((p+=((v=((v+=(p^((g=((g+=(l^(p|~v))+h[0]-198630844|0)<<6|g>>>26)+p|0)|~l))+h[7]+1126891415|0)<<10|v>>>22)+g|0)^((l=((l+=(g^(v|~p))+h[14]-1416354905|0)<<15|l>>>17)+v|0)|~g))+h[5]-57434055|0)<<21|p>>>11)+l|0,p=((p+=((v=((v+=(p^((g=((g+=(l^(p|~v))+h[12]+1700485571|0)<<6|g>>>26)+p|0)|~l))+h[3]-1894986606|0)<<10|v>>>22)+g|0)^((l=((l+=(g^(v|~p))+h[10]-1051523|0)<<15|l>>>17)+v|0)|~g))+h[1]-2054922799|0)<<21|p>>>11)+l|0,p=((p+=((v=((v+=(p^((g=((g+=(l^(p|~v))+h[8]+1873313359|0)<<6|g>>>26)+p|0)|~l))+h[15]-30611744|0)<<10|v>>>22)+g|0)^((l=((l+=(g^(v|~p))+h[6]-1560198380|0)<<15|l>>>17)+v|0)|~g))+h[13]+1309151649|0)<<21|p>>>11)+l|0,p=((p+=((v=((v+=(p^((g=((g+=(l^(p|~v))+h[4]-145523070|0)<<6|g>>>26)+p|0)|~l))+h[11]-1120210379|0)<<10|v>>>22)+g|0)^((l=((l+=(g^(v|~p))+h[2]+718787259|0)<<15|l>>>17)+v|0)|~g))+h[9]-343485551|0)<<21|p>>>11)+l|0,b[0]=g+b[0]|0,b[1]=p+b[1]|0,b[2]=l+b[2]|0,b[3]=v+b[3]|0}function o(b){var h,g=[];for(h=0;h<64;h+=4)g[h>>2]=b.charCodeAt(h)+(b.charCodeAt(h+1)<<8)+(b.charCodeAt(h+2)<<16)+(b.charCodeAt(h+3)<<24);return g}function r(b){var h,g=[];for(h=0;h<64;h+=4)g[h>>2]=b[h]+(b[h+1]<<8)+(b[h+2]<<16)+(b[h+3]<<24);return g}function i(b){var h,g,p,l,v,B,P=b.length,A=[1732584193,-271733879,-1732584194,271733878];for(h=64;h<=P;h+=64)t(A,o(b.substring(h-64,h)));for(g=(b=b.substring(h-64)).length,p=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],h=0;h<g;h+=1)p[h>>2]|=b.charCodeAt(h)<<(h%4<<3);if(p[h>>2]|=128<<(h%4<<3),h>55)for(t(A,p),h=0;h<16;h+=1)p[h]=0;return l=(l=8*P).toString(16).match(/(.*?)(.{0,8})$/),v=parseInt(l[2],16),B=parseInt(l[1],16)||0,p[14]=v,p[15]=B,t(A,p),A}function s(b){var h,g,p,l,v,B,P=b.length,A=[1732584193,-271733879,-1732584194,271733878];for(h=64;h<=P;h+=64)t(A,r(b.subarray(h-64,h)));for(g=(b=h-64<P?b.subarray(h-64):new Uint8Array(0)).length,p=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],h=0;h<g;h+=1)p[h>>2]|=b[h]<<(h%4<<3);if(p[h>>2]|=128<<(h%4<<3),h>55)for(t(A,p),h=0;h<16;h+=1)p[h]=0;return l=(l=8*P).toString(16).match(/(.*?)(.{0,8})$/),v=parseInt(l[2],16),B=parseInt(l[1],16)||0,p[14]=v,p[15]=B,t(A,p),A}function d(b){var h,g="";for(h=0;h<4;h+=1)g+=e[b>>8*h+4&15]+e[b>>8*h&15];return g}function f(b){var h;for(h=0;h<b.length;h+=1)b[h]=d(b[h]);return b.join("")}function m(b){return/[\u0080-\uFFFF]/.test(b)&&(b=unescape(encodeURIComponent(b))),b}function S(b,h){var g,p=b.length,l=new ArrayBuffer(p),v=new Uint8Array(l);for(g=0;g<p;g+=1)v[g]=b.charCodeAt(g);return h?v:l}function k(b){return String.fromCharCode.apply(null,new Uint8Array(b))}function D(b,h,g){var p=new Uint8Array(b.byteLength+h.byteLength);return p.set(new Uint8Array(b)),p.set(new Uint8Array(h),b.byteLength),p}function j(b){var h,g=[],p=b.length;for(h=0;h<p-1;h+=2)g.push(parseInt(b.substr(h,2),16));return String.fromCharCode.apply(String,g)}function T(){this.reset()}return f(i("hello")),typeof ArrayBuffer>"u"||ArrayBuffer.prototype.slice||function(){function b(h,g){return(h=0|h||0)<0?Math.max(h+g,0):Math.min(h,g)}ArrayBuffer.prototype.slice=function(h,g){var p,l,v,B,P=this.byteLength,A=b(h,P),$=P;return g!==n&&($=b(g,P)),A>$?new ArrayBuffer(0):(p=$-A,l=new ArrayBuffer(p),v=new Uint8Array(l),B=new Uint8Array(this,A,p),v.set(B),l)}}(),T.prototype.append=function(b){return this.appendBinary(m(b)),this},T.prototype.appendBinary=function(b){this._buff+=b,this._length+=b.length;var h,g=this._buff.length;for(h=64;h<=g;h+=64)t(this._hash,o(this._buff.substring(h-64,h)));return this._buff=this._buff.substring(h-64),this},T.prototype.end=function(b){var h,g,p=this._buff,l=p.length,v=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(h=0;h<l;h+=1)v[h>>2]|=p.charCodeAt(h)<<(h%4<<3);return this._finish(v,l),g=f(this._hash),b&&(g=j(g)),this.reset(),g},T.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},T.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},T.prototype.setState=function(b){return this._buff=b.buff,this._length=b.length,this._hash=b.hash,this},T.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},T.prototype._finish=function(b,h){var g,p,l,v=h;if(b[v>>2]|=128<<(v%4<<3),v>55)for(t(this._hash,b),v=0;v<16;v+=1)b[v]=0;g=(g=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),p=parseInt(g[2],16),l=parseInt(g[1],16)||0,b[14]=p,b[15]=l,t(this._hash,b)},T.hash=function(b,h){return T.hashBinary(m(b),h)},T.hashBinary=function(b,h){var g=f(i(b));return h?j(g):g},T.ArrayBuffer=function(){this.reset()},T.ArrayBuffer.prototype.append=function(b){var h,g=D(this._buff.buffer,b),p=g.length;for(this._length+=b.byteLength,h=64;h<=p;h+=64)t(this._hash,r(g.subarray(h-64,h)));return this._buff=h-64<p?new Uint8Array(g.buffer.slice(h-64)):new Uint8Array(0),this},T.ArrayBuffer.prototype.end=function(b){var h,g,p=this._buff,l=p.length,v=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(h=0;h<l;h+=1)v[h>>2]|=p[h]<<(h%4<<3);return this._finish(v,l),g=f(this._hash),b&&(g=j(g)),this.reset(),g},T.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},T.ArrayBuffer.prototype.getState=function(){var b=T.prototype.getState.call(this);return b.buff=k(b.buff),b},T.ArrayBuffer.prototype.setState=function(b){return b.buff=S(b.buff,!0),T.prototype.setState.call(this,b)},T.ArrayBuffer.prototype.destroy=T.prototype.destroy,T.ArrayBuffer.prototype._finish=T.prototype._finish,T.ArrayBuffer.hash=function(b,h){var g=f(s(new Uint8Array(b)));return h?j(g):g},T}());const Rt=[],he=class he{static addHandler(e,t,o){e.addEventListener?e.addEventListener(t,o,!1):e.attachEvent?e.attachEvent("on"+t,o):e["on"+t]=o}static removeHandler(e,t,o){e.removeEventListener?e.removeEventListener(t,o,!1):e.detachEvent?e.detachEvent("on"+t,o):delete e["on"+t]}static windowResizeHandler(e){he.addHandler(window,"resize",e)}static offWindowResizeHandler(e){he.removeHandler(window,"resize",e)}static fullscreenEnabled(){const e=window.document;return document.fullscreenEnabled||window.fullScreen||e.mozFullscreenEnabled||e.webkitIsFullScreen}static fullScreen(e,t){var o,r;if(t){const i=window.document;let s=window.document.exitFullscreen||i.msExitFullscreen||i.mozCancelFullScreen||i.webkitCancelFullScreen;typeof s<"u"&&s?s.call(window.document):typeof window.ActiveXObject<"u"&&((o=new window.ActiveXObject("WScript.Shell"))==null||o.SendKeys("{F11}"))}else{let i=e;i||(i=window.document.documentElement);let s=i.requestFullScreen||i.webkitRequestFullScreen||i.mozRequestFullScreen||i.msRequestFullScreen;typeof s<"u"&&s?s.call(i):typeof window.ActiveXObject<"u"&&((r=new window.ActiveXObject("WScript.Shell"))==null||r.SendKeys("{F11}"))}}static requestFullScreen(e=window.document.documentElement){let t=e;var o=t.requestFullScreen||t.webkitRequestFullScreen||t.mozRequestFullScreen||t.msRequestFullScreen;if(o)o.call(t);else if(typeof window.ActiveXObject<"u"){var r=new window.ActiveXObject("WScript.Shell");r!==null&&r.SendKeys("{F11}")}}static exitFullScreen(){const e=window.document;var t=document.exitFullscreen||e.mozCancelFullScreen||e.webkitExitFullscreen||e.webkitExitFullscreen;if(t)t.call(document);else if(typeof window.ActiveXObject<"u"){var o=new window.ActiveXObject("WScript.Shell");o!==null&&o.SendKeys("{F11}")}}static fullScreenElement(){return window.document.fullscreenElement||window.document.webkitFullscreenElement||window.document.mozFullscreenElement||window.document.msFullscreenElement}static isFullScreen(){return!!he.fullScreenElement()}static onFullScreenChanged(e){let t;"onfullscreenchange"in window.document?t="fullscreenchange":"onwebkitfullscreenchange"in window.document?t="webkitfullscreenchange":"onmozfullscreenchange"in window.document&&(t="mozfullscreenchange"),t?document.addEventListener(t,function(){const o=he.isFullScreen();e(o)}):document.addEventListener("MSFullscreenChange",function(){const o=he.isFullScreen();e(o)})}static stringifyCircularHandler(e,t){if(typeof t=="object"&&t!==null){if(Rt.indexOf(t)!==-1)return;Rt.push(t)}return t}static jsonStringify(e){if(!e)return"";const t=JSON.stringify(e,he.stringifyCircularHandler);return Rt.length=0,t}static jsonParse(e){const t=he.jsonStringify(e);if(t.length>1)return JSON.parse(t)}static getObjectURL(e){let t;const o=window;return o.createObjcectURL!=null?t=o.createOjcectURL(e):window.URL!=null?t=window.URL.createObjectURL(e):window.webkitURL!=null&&(t=window.webkitURL.createObjectURL(e)),t}static getFileShortMD5(e,t){const o=File.prototype,r=o.slice||o.mozSlice||o.webkitSlice,i=e,s=2097152,d=new Tt.ArrayBuffer,f=new FileReader;f.onload=function(m){var k;d.append((k=m.target)==null?void 0:k.result);const S=d.end();t({isOK:!0,data:S})},f.onerror=function(){t({isOK:!1,data:"计算文件简单摘要错误！"})},function(){const m=0+s>=i.size?i.size:0+s;f.readAsArrayBuffer(r.call(i,0,m))}()}static getFileMD5(e,t){const o=File.prototype,r=o.slice||o.mozSlice||o.webkitSlice,i=e,s=2097152,d=Math.ceil(i.size/s);let f=0;const m=new Tt.ArrayBuffer,S=new FileReader;function k(){const D=f*s,j=D+s>=i.size?i.size:D+s;S.readAsArrayBuffer(r.call(i,D,j))}S.onload=function(D){var j;if(m.append((j=D.target)==null?void 0:j.result),f++,f<d)k();else{const T=m.end();t({isOK:!0,data:T})}},S.onerror=function(){const D=`${i.name}:计算文件简单摘要错误！`;t({isOK:!1,data:D})},k()}static MD5(e,t=!1){return Tt.hash(e,t)}static copyTextByCommand(e){return new Promise((t,o)=>{const r=document.createElement("input");r.value=e,document.body.appendChild(r),r.select(),document.execCommand("copy"),r.remove(),t(!0)})}static copyElementTextByCommand(e){const t=document.createRange();t.selectNode(document.getElementById(e));const o=window.getSelection();o.rangeCount>0&&o.removeAllRanges(),o.addRange(t);try{return document.execCommand("copy"),o.removeRange(t),!0}catch{return o.removeRange(t),!1}}static copyElementText(e){if(!navigator.clipboard)return he.copyElementTextByCommand(e);const t=document.createRange();t.selectNode(document.getElementById(e));const o=window.getSelection();return o.rangeCount>0&&o.removeAllRanges(),o.addRange(t),navigator.clipboard.writeText(o).then(function(){return o.removeRange(t),!0},function(r){return o.removeRange(t),!1})}static setGrayMode(e){he.toggleClass(e,"grayMode",document.documentElement)}static toggleClass(e,t,o){const r=o||document.body;let{className:i}=r;i=i.replace(t,""),r.className=e?`${i} ${t} `:i}static setCssVar(e,t,o=document.documentElement){o.style.setProperty(e,t)}static dispatchWindowResize(){const e=new Event("resize");window.dispatchEvent(e)}static dispatchElementEvent(e,t="click",o){let r;if(r=ro(e)?document.getElementById(e):e,r){const i=new Event(t,{bubbles:!0,cancelable:!0});o&&r.addEventListener("ev",s=>{o(s)},!1),r.dispatchEvent(i)}}};L(he,"copyText",e=>navigator.clipboard?navigator.clipboard.writeText(e).then(function(){return!0},function(t){return!1}):he.copyTextByCommand(e));let ct=he;class lt{static toHump(e){return e.replace(/[\-\/\_](\w)/g,(t,o)=>o.toUpperCase()).replace("views","")}}L(lt,"isNullOrEmpty",e=>e===null||e===""||e===void 0||e.length===0),L(lt,"isNotEmpty",e=>!(e===null||e===""||e===void 0||e.length===0));class io{constructor(e="",t=localStorage){L(this,"prefixKey");L(this,"storage");this.prefixKey=e,this.storage=t}getKey(e){return`${this.prefixKey}${e}`.toUpperCase()}set(e,t,o=604800){const r=JSON.stringify({value:t,expire:o!==null?new Date().getTime()+1e3*o:null});this.storage.setItem(this.getKey(e),r)}get(e,t=null){const o=this.storage.getItem(this.getKey(e));if(o)try{const r=JSON.parse(o),{value:i,expire:s}=r;if(s===null||s>=Date.now())return i;this.remove(this.getKey(e))}catch{return t}return t}getJsonObject(e){const t=this.storage.getItem(this.getKey(e));if(t)try{const o=JSON.parse(t);if(o.expire===null||o.expire>=Date.now())return o;this.remove(this.getKey(e))}catch{return}}remove(e){this.storage.removeItem(this.getKey(e))}clear(){this.storage.clear()}setCookie(e,t,o=604800){document.cookie=`${this.getKey(e)}=${t}; Max-Age=${o}`}getCookie(e){const t=document.cookie.split("; ");for(let o=0,r=t.length;o<r;o++){const i=t[o].split("=");if(i[0]===this.getKey(e))return i[1]}return""}removeCookie(e){this.setCookie(e,1,-1)}clearCookie(){const e=document.cookie.match(/[^ =;]+(?==)/g);if(e)for(let t=e.length;t--;)document.cookie=e[t]+"=0;expire="+new Date(0).toUTCString()}}function qt(){let n=[];const e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";for(var t=0;t<36;t++){const r=Math.floor(16*Math.random());n[t]=e.substring(r,r+1)}n[14]="4";const o=3&Number(n[19])|8;return n[19]=e.substring(o,o+1),n[8]=n[13]=n[18]=n[23]="-",n.join("")}var Dn;function Kr(n){return{all:n=n||new Map,on(e,t){const o=n==null?void 0:n.get(e);o&&o.push(t)||(n==null||n.set(e,[t]))},off(e,t){const o=n==null?void 0:n.get(e);o&&o.splice(o.indexOf(t)>>>0,1)},emit(e,t){((n==null?void 0:n.get(e))||[]).slice().map(o=>{o(t)}),((n==null?void 0:n.get("*"))||[]).slice().map(o=>{o(e,t)})}}}(function(n){n[n.RGBA=0]="RGBA",n[n.Hex=1]="Hex",n[n.Hsla=2]="Hsla"})(Dn||(Dn={}));const ut=Kr(),ge={HproseServiceErrorEvent:"HproseServiceError",WebAPIErrorEvent:"WebAPIError",AlertInfoEvent:"AlertInfoEvent",CommonWarnEvent:"CommonWarnEvent",WidgetLoadedEvent:"WidgetLoaded",WidgetUnLoadedEvent:"WidgetUnLoaded",WidgetLoadedErrorEvent:"WidgetLoadedError",WidgetVisibleChanged:"WidgetVisibleChanged",AxiosRequestErrorEvent:"AxiosRequestErrorEvent"},Vr=(n,e)=>{const t=document.createElement("a");t.download=e,t.style.display="none";const o=new Blob([n],{type:"application/octet-stream"});t.href=URL.createObjectURL(o),document.body.appendChild(t),t.click(),document.body.removeChild(t)},Jr=(n,e)=>{const t=JSON.stringify(n,null,2);Vr(t,e+".json")};var Bn,$n,Pt,so={exports:{}};$n=Te,Pt=function(){var n=function(){},e="undefined",t=typeof window!==e&&typeof window.navigator!==e&&/Trident\/|MSIE /.test(window.navigator.userAgent),o=["trace","debug","info","warn","error"],r={},i=null;function s(T,b){var h=T[b];if(typeof h.bind=="function")return h.bind(T);try{return Function.prototype.bind.call(h,T)}catch{return function(){return Function.prototype.apply.apply(h,[T,arguments])}}}function d(){console.log&&(console.log.apply||Function.prototype.apply.apply(console.log,[console,arguments]))}function f(T){return T==="debug"&&(T="log"),typeof console!==e&&(T==="trace"&&t?d:console[T]!==void 0?s(console,T):console.log!==void 0?s(console,"log"):n)}function m(){for(var T=this.getLevel(),b=0;b<o.length;b++){var h=o[b];this[h]=b<T?n:this.methodFactory(h,T,this.name)}if(this.log=this.debug,typeof console===e&&T<this.levels.SILENT)return"No console available for logging"}function S(T){return function(){typeof console!==e&&(m.call(this),this[T].apply(this,arguments))}}function k(T,b,h){return f(T)||S.apply(this,arguments)}function D(T,b){var h,g,p,l=this,v="loglevel";function B(){var $;if(typeof window!==e&&v){try{$=window.localStorage[v]}catch{}if(typeof $===e)try{var O=window.document.cookie,W=encodeURIComponent(v),F=O.indexOf(W+"=");F!==-1&&($=/^([^;]+)/.exec(O.slice(F+W.length+1))[1])}catch{}return l.levels[$]===void 0&&($=void 0),$}}function P($){var O=$;if(typeof O=="string"&&l.levels[O.toUpperCase()]!==void 0&&(O=l.levels[O.toUpperCase()]),typeof O=="number"&&O>=0&&O<=l.levels.SILENT)return O;throw new TypeError("log.setLevel() called with invalid level: "+$)}typeof T=="string"?v+=":"+T:typeof T=="symbol"&&(v=void 0),l.name=T,l.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},l.methodFactory=b||k,l.getLevel=function(){var $;return($=p!=null?p:g)!=null?$:h},l.setLevel=function($,O){return p=P($),O!==!1&&function(W){var F=(o[W]||"silent").toUpperCase();if(typeof window!==e&&v){try{return void(window.localStorage[v]=F)}catch{}try{window.document.cookie=encodeURIComponent(v)+"="+F+";"}catch{}}}(p),m.call(l)},l.setDefaultLevel=function($){g=P($),B()||l.setLevel($,!1)},l.resetLevel=function(){p=null,function(){if(typeof window!==e&&v){try{window.localStorage.removeItem(v)}catch{}try{window.document.cookie=encodeURIComponent(v)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}(),m.call(l)},l.enableAll=function($){l.setLevel(l.levels.TRACE,$)},l.disableAll=function($){l.setLevel(l.levels.SILENT,$)},l.rebuild=function(){if(i!==l&&(h=P(i.getLevel())),m.call(l),i===l)for(var $ in r)r[$].rebuild()},h=P(i?i.getLevel():"WARN");var A=B();A!=null&&(p=P(A)),m.call(l)}(i=new D).getLogger=function(T){if(typeof T!="symbol"&&typeof T!="string"||T==="")throw new TypeError("You must supply a name when creating a logger.");var b=r[T];return b||(b=r[T]=new D(T,i.methodFactory)),b};var j=typeof window!==e?window.log:void 0;return i.noConflict=function(){return typeof window!==e&&window.log===i&&(window.log=j),i},i.getLoggers=function(){return r},i.default=i,i},(Bn=so).exports?Bn.exports=Pt():$n.log=Pt();var Mt=so.exports;class ao{constructor(e,t){L(this,"message");L(this,"eventBus");e&&(this.message=e),t&&(this.eventBus=t)}msg(e,t=3,o="success"){if(this.message)if(typeof this.message=="function")this.message({type:o,message:e,duration:t});else switch(o){case"info":this.message.info(e,t);break;case"success":this.message.success(e,t);break;case"warning":this.message.warn?this.message.warn(e,t):this.message.warning&&this.message.warning(e,t);break;case"error":this.message.error(e,t)}else{switch(o){case"info":case"success":break;case"warning":break;case"error":o="dark"}this.eventBus&&this.eventBus.emit(ge.AlertInfoEvent,{type:o,info:e})}}info(e,t=3){this.msg(e,t,"info")}warn(e,t=3){this.msg(e,t,"warning")}err(e,t=3){this.msg(e,t,"error")}success(e,t=3){this.msg(e,t,"success")}}let Nn=!1;const H={Config:SysConfig,EventBus:ut,DefaultProxyClient:null,Axios:Wr,Message:new ao(void 0,ut),LayoutMap:new Map,Logger:n=>{Nn||(SysConfig.UI.ProductLog?Mt.enableAll():Mt.setDefaultLevel("warn"),Nn=!0);const e=n||"default";return Mt.getLogger(e)}},co="access_token",Le=new io("user",localStorage);function je(){return Le.get(co)}function lo(){Le.remove(co)}function Yr(){var n;return(n=je())==null?void 0:n.refresh}function uo(n,e,t,o="json",r){var s;const i={baseURL:H.Config.ServiceURL.DefaultWebAPI,timeout:6e4,params:n,paramsSerializer:{serialize:function(d){return qr.stringify(d,{indices:!1,arrayFormat:"repeat"})}},headers:{"Content-Type":"application/json",Authorization:"bearer "+((s=je())==null?void 0:s.token)},responseType:o,cancelToken:r};return H.SystemID&&(i.headers.sysid=H.SystemID,H.SystemGroup&&(i.headers.sysgroup=H.SystemGroup)),e&&(i.baseURL=e),i}function Ge(n,e,t,o,r="json",i,s){var f;const d=uo(t,e,o,r,i);return(f=H.Axios)==null?void 0:f.get(n,d).catch(function(m){ho(m,e,n,"Get")})}function ho(n,e,t,o="Get"){const r=`${e}${t}`;if(n&&n.response){let i=!1;const s=n.response.status;switch(s){case 400:n.message="错误请求";break;case 401:n.message="未授权，请重新登录";break;case 403:n.message="拒绝访问";break;case 404:n.message="请求错误,未找到该资源";break;case 405:n.message="请求方法未允许";break;case 408:n.message="请求超时";break;case 500:const f=n.response.data;if(f){const m=f.indexOf(":"),S=f.indexOf(`
`);if(m>0&&S-m>2){const k=f.substring(m+2,S);k.indexOf("System.Exception")>0?n.message="后台服务内部出错！":(i=!0,n.message=k)}else i=!0,n.message=f}else n.message="服务器端出错";break;case 501:n.message="网络未实现";break;case 502:n.message="网络错误";break;case 503:n.message="服务不可用";break;case 504:n.message="网络超时";break;case 505:n.message="http版本不支持该请求";break;default:n.message=`连接错误${n.response.status}`}let d={address:r,code:s,isExceptionInfo:i,message:n.message,result:n.response.data};if(H.EventBus.emit(ge.AxiosRequestErrorEvent,d),i)throw new Error(n.message)}else if(n!=null&&n.message)throw new Error(n.message)}function Qr(n,e,t,o,r,i="json",s){var f;const d=uo(o,e,r,i);return(f=H.Axios)==null?void 0:f.post(n,t,d).catch(function(m){ho(m,e,n,"Post")})}function vs(n,e){return Ge(n,void 0,e)}var Ft={exports:{}},Zr=typeof window<"u"?window:Te!==void 0?Te:typeof self<"u"?self:{},ei=function(n){if(!n)return!1;var e=ti.call(n);return e==="[object Function]"||typeof n=="function"&&e!=="[object RegExp]"||typeof window<"u"&&(n===window.setTimeout||n===window.alert||n===window.confirm||n===window.prompt)},ti=Object.prototype.toString,Lt=function(n){return n.replace(/^\s+|\s+$/g,"")},ni=function(){for(var n={},e=0;e<arguments.length;e++){var t=arguments[e];for(var o in t)oi.call(t,o)&&(n[o]=t[o])}return n},oi=Object.prototype.hasOwnProperty,jn=Zr,ri=ei,ii=function(n){if(!n)return{};for(var e,t={},o=Lt(n).split(`
`),r=0;r<o.length;r++){var i=o[r],s=i.indexOf(":"),d=Lt(i.slice(0,s)).toLowerCase(),f=Lt(i.slice(s+1));t[d]===void 0?t[d]=f:(e=t[d],Object.prototype.toString.call(e)==="[object Array]"?t[d].push(f):t[d]=[t[d],f])}return t},si=ni;function fo(n,e,t){var o=n;return ri(e)?(t=e,typeof n=="string"&&(o={uri:n})):o=si(e,{uri:n}),o.callback=t,o}function we(n,e,t){return po(e=fo(n,e,t))}function po(n){if(n.callback===void 0)throw new Error("callback argument missing");var e=!1,t=function(g,p,l){e||(e=!0,n.callback(g,p,l))};function o(){var g=void 0;if(g=f.response?f.response:f.responseText||function(p){try{if(p.responseType==="document")return p.responseXML;var l=p.responseXML&&p.responseXML.documentElement.nodeName==="parsererror";if(p.responseType===""&&!l)return p.responseXML}catch{}return null}(f),b)try{g=JSON.parse(g)}catch{}return g}function r(g){return clearTimeout(m),g instanceof Error||(g=new Error(""+(g||"Unknown XMLHttpRequest Error"))),g.statusCode=0,t(g,h)}function i(){if(!d){var g;clearTimeout(m),g=n.useXDR&&f.status===void 0?200:f.status===1223?204:f.status;var p=h,l=null;return g!==0?(p={body:o(),statusCode:g,method:k,headers:{},url:S,rawRequest:f},f.getAllResponseHeaders&&(p.headers=ii(f.getAllResponseHeaders()))):l=new Error("Internal XMLHttpRequest Error"),t(l,p,p.body)}}var s,d,f=n.xhr||null;f||(f=n.cors||n.useXDR?new we.XDomainRequest:new we.XMLHttpRequest);var m,S=f.url=n.uri||n.url,k=f.method=n.method||"GET",D=n.body||n.data,j=f.headers=n.headers||{},T=!!n.sync,b=!1,h={body:void 0,headers:{},statusCode:0,method:k,url:S,rawRequest:f};if("json"in n&&n.json!==!1&&(b=!0,j.accept||j.Accept||(j.Accept="application/json"),k!=="GET"&&k!=="HEAD"&&(j["content-type"]||j["Content-Type"]||(j["Content-Type"]="application/json"),D=JSON.stringify(n.json===!0?D:n.json))),f.onreadystatechange=function(){f.readyState===4&&setTimeout(i,0)},f.onload=i,f.onerror=r,f.onprogress=function(){},f.onabort=function(){d=!0},f.ontimeout=r,f.open(k,S,!T,n.username,n.password),T||(f.withCredentials=!!n.withCredentials),!T&&n.timeout>0&&(m=setTimeout(function(){if(!d){d=!0,f.abort("timeout");var g=new Error("XMLHttpRequest timeout");g.code="ETIMEDOUT",r(g)}},n.timeout)),f.setRequestHeader)for(s in j)j.hasOwnProperty(s)&&f.setRequestHeader(s,j[s]);else if(n.headers&&!function(g){for(var p in g)if(g.hasOwnProperty(p))return!1;return!0}(n.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in n&&(f.responseType=n.responseType),"beforeSend"in n&&typeof n.beforeSend=="function"&&n.beforeSend(f),f.send(D||null),f}Ft.exports=we,Ft.exports.default=we,we.XMLHttpRequest=jn.XMLHttpRequest||function(){},we.XDomainRequest="withCredentials"in new we.XMLHttpRequest?we.XMLHttpRequest:jn.XDomainRequest,function(n,e){for(var t=0;t<n.length;t++)e(n[t])}(["get","put","post","patch","head","delete"],function(n){we[n==="delete"?"del":n]=function(e,t,o){return(t=fo(e,t,o)).method=n.toUpperCase(),po(t)}});gt(Ft.exports);const Fe=class Fe{constructor(e){L(this,"hproseURL");L(this,"client");L(this,"hproseProxy");if(e&&!lt.isNullOrEmpty(e)){if(Fe.httpTransport||(Fe.httpTransport=new Fr),this.client=new zr(e),!this.client)throw Error("Hprose Client初始化错误");this.hproseURL=e,this.init()}}init(){this.client&&this.client.useServiceAsync().then(e=>{this.hproseProxy=e}).catch(e=>{var t;String(e).indexOf("find this method ~")>0?this.hproseProxy=(t=this.client)==null?void 0:t.useService():ut.emit(ge.HproseServiceErrorEvent,"初始化默认Hprose!")})}async getProxy(){var e;if(!this.hproseProxy)try{this.client&&(this.hproseProxy=await this.client.useServiceAsync())}catch{this.hproseProxy=(e=this.client)==null?void 0:e.useService()}return this.hproseProxy}async invoke(e,t,o){if(this.client)return await this.client.invoke(e,t,o)}encode(e,t,o){if(this.client)return this.client.codec.encode(e,t,o)}decode(e,t){if(this.client)return this.client.codec.decode(e,t)}};L(Fe,"httpTransport");let zt=Fe;class ai{constructor(e){L(this,"hproseClient");L(this,"hpProxyObj");L(this,"defaultContext",new xt);this.hproseClient=new zt(e),this.hpProxyObj=null}getClientContext(e,t){const o={};t&&(o.requestHeaders=t);const r=je();o.httpRequestHeaders=e||{};const i=o.httpRequestHeaders;return r&&(i.token=r.token),H.SystemID&&(i.sysid=H.SystemID,H.SystemGroup&&(i.sysgroup=H.SystemGroup)),new xt(o)}async getHproseProxy(){if(!this.hproseClient)throw new Error("HproseClient对象为构建，无法调用Hprose方法");if(!this.hpProxyObj){const e=await this.hproseClient.getProxy();this.hpProxyObj=e}return this.hpProxyObj||ut.emit(ge.HproseServiceErrorEvent,"HproseProxy对象为空，无法调用Hprose方法！"),this.hpProxyObj}async hproseInvoke(e,t,o){if(!this.hproseClient)throw new Error("HproseClient对象为构建，无法调用Hprose方法");return await this.hproseClient.invoke(e,t,o)}async hproseInvokeContext(e,t,...o){if(!this.hproseClient)throw new Error("HproseClient对象为构建，无法调用Hprose方法");const r=je();return r&&(t||(t=new xt({httpRequestHeaders:{token:r.token}}))),await this.hproseClient.invoke(e,o,t)}async hproseInvokeEncode(e){var r,i;const t=new An(e).toBytes(),o=await((r=this.hproseClient.client)==null?void 0:r.request(t,this.defaultContext));return o&&((i=this.hproseClient.client)==null?void 0:i.codec.decode(o,this.defaultContext))}encodeRequest(e,...t){var r,i;const o=(i=(r=this.hproseClient.client)==null?void 0:r.codec)==null?void 0:i.encode(e,t,this.defaultContext);return An.toString(o)}}const ys=function(n,e,t){!H.Config.DefaultHproseAPI&&H.Config.ServiceURL&&(H.Config.DefaultHproseAPI=H.Config.ServiceURL.DefaultHproseAPI),H.Config.DefaultHproseAPI&&lt.isNotEmpty(H.Config.DefaultHproseAPI)&&(H.DefaultProxyClient=new ai(H.Config.DefaultHproseAPI));const o=H.Config.UI.GrayMode;o&&ct.setGrayMode(o);const r=new ao(n,H.EventBus);H.Message=r,H.SystemID=e,H.SystemGroup=t,H.EventBus.on(ge.HproseServiceErrorEvent,i=>{const s=`当前后台业务服务不可用!${i}`}),H.EventBus.on(ge.WebAPIErrorEvent,i=>{const s=`WebAPI后台服务不可用!${i}`}),H.EventBus.on(ge.AxiosRequestErrorEvent,i=>{const s=`Http请求'${i.code}'错误: ${i.message}`}),H.EventBus.on(ge.CommonWarnEvent,i=>{r.warn(i)})},go="is_LockScreen",Hn=Le.get(go,!1),We={isLock:Hn,lockTime:Hn=="true"?mo():0};function On(n){We.isLock=n,Le.set(go,n,10),n&&lo()}function mo(){var e,t;let n=3600;return(e=H.Config.UI)!=null&&e.LockTime&&((t=H.Config.UI)==null?void 0:t.LockTime)>=10&&(n=H.Config.UI.LockTime),n}let At;function Xt(){clearInterval(At),!(window.location.href.indexOf("/login")>0||We.isLock)&&(On(!1),We.lockTime=mo(),At=setInterval(()=>{if(We.lockTime--,We.lockTime<=0)return On(!0),clearInterval(At)},1e3))}function ws(){Xt(),document.addEventListener("mousedown",Xt)}function _s(){document.removeEventListener("mousedown",Xt)}function Dt(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}gt(function n(e,t,o){function r(d,f){if(!t[d]){if(!e[d]){if(!f&&Dt)return Dt(d);if(i)return i(d,!0);var m=new Error("Cannot find module '"+d+"'");throw m.code="MODULE_NOT_FOUND",m}var S=t[d]={exports:{}};e[d][0].call(S.exports,function(k){var D=e[d][1][k];return r(D||k)},S,S.exports,n,e,t,o)}return t[d].exports}for(var i=Dt,s=0;s<o.length;s++)r(o[s]);return r}({1:[function(n,e,t){(function(o){var r,i,s=o.MutationObserver||o.WebKitMutationObserver;if(s){var d=0,f=new s(D),m=o.document.createTextNode("");f.observe(m,{characterData:!0}),r=function(){m.data=d=++d%2}}else if(o.setImmediate||o.MessageChannel===void 0)r="document"in o&&"onreadystatechange"in o.document.createElement("script")?function(){var T=o.document.createElement("script");T.onreadystatechange=function(){D(),T.onreadystatechange=null,T.parentNode.removeChild(T),T=null},o.document.documentElement.appendChild(T)}:function(){setTimeout(D,0)};else{var S=new o.MessageChannel;S.port1.onmessage=D,r=function(){S.port2.postMessage(0)}}var k=[];function D(){var T,b;i=!0;for(var h=k.length;h;){for(b=k,k=[],T=-1;++T<h;)b[T]();h=k.length}i=!1}function j(T){k.push(T)!==1||i||r()}e.exports=j}).call(this,Te!==void 0?Te:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(n,e,t){var o=n(1);function r(){}var i={},s=["REJECTED"],d=["FULFILLED"],f=["PENDING"];function m(l){if(typeof l!="function")throw new TypeError("resolver must be a function");this.state=f,this.queue=[],this.outcome=void 0,l!==r&&j(this,l)}function S(l,v,B){this.promise=l,typeof v=="function"&&(this.onFulfilled=v,this.callFulfilled=this.otherCallFulfilled),typeof B=="function"&&(this.onRejected=B,this.callRejected=this.otherCallRejected)}function k(l,v,B){o(function(){var P;try{P=v(B)}catch(A){return i.reject(l,A)}P===l?i.reject(l,new TypeError("Cannot resolve promise with itself")):i.resolve(l,P)})}function D(l){var v=l&&l.then;if(l&&(typeof l=="object"||typeof l=="function")&&typeof v=="function")return function(){v.apply(l,arguments)}}function j(l,v){var B=!1;function P(W){B||(B=!0,i.reject(l,W))}function A(W){B||(B=!0,i.resolve(l,W))}function $(){v(A,P)}var O=T($);O.status==="error"&&P(O.value)}function T(l,v){var B={};try{B.value=l(v),B.status="success"}catch(P){B.status="error",B.value=P}return B}function b(l){return l instanceof this?l:i.resolve(new this(r),l)}function h(l){var v=new this(r);return i.reject(v,l)}function g(l){var v=this;if(Object.prototype.toString.call(l)!=="[object Array]")return this.reject(new TypeError("must be an array"));var B=l.length,P=!1;if(!B)return this.resolve([]);for(var A=new Array(B),$=0,O=-1,W=new this(r);++O<B;)F(l[O],O);return W;function F(ae,te){function oe(Z){A[te]=Z,++$!==B||P||(P=!0,i.resolve(W,A))}v.resolve(ae).then(oe,function(Z){P||(P=!0,i.reject(W,Z))})}}function p(l){var v=this;if(Object.prototype.toString.call(l)!=="[object Array]")return this.reject(new TypeError("must be an array"));var B=l.length,P=!1;if(!B)return this.resolve([]);for(var A=-1,$=new this(r);++A<B;)O(l[A]);return $;function O(W){v.resolve(W).then(function(F){P||(P=!0,i.resolve($,F))},function(F){P||(P=!0,i.reject($,F))})}}e.exports=m,m.prototype.catch=function(l){return this.then(null,l)},m.prototype.then=function(l,v){if(typeof l!="function"&&this.state===d||typeof v!="function"&&this.state===s)return this;var B=new this.constructor(r);return this.state!==f?k(B,this.state===d?l:v,this.outcome):this.queue.push(new S(B,l,v)),B},S.prototype.callFulfilled=function(l){i.resolve(this.promise,l)},S.prototype.otherCallFulfilled=function(l){k(this.promise,this.onFulfilled,l)},S.prototype.callRejected=function(l){i.reject(this.promise,l)},S.prototype.otherCallRejected=function(l){k(this.promise,this.onRejected,l)},i.resolve=function(l,v){var B=T(D,v);if(B.status==="error")return i.reject(l,B.value);var P=B.value;if(P)j(l,P);else{l.state=d,l.outcome=v;for(var A=-1,$=l.queue.length;++A<$;)l.queue[A].callFulfilled(v)}return l},i.reject=function(l,v){l.state=s,l.outcome=v;for(var B=-1,P=l.queue.length;++B<P;)l.queue[B].callRejected(v);return l},m.resolve=b,m.reject=h,m.all=g,m.race=p},{1:1}],3:[function(n,e,t){(function(o){typeof o.Promise!="function"&&(o.Promise=n(2))}).call(this,Te!==void 0?Te:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(n,e,t){var o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};function r(a,c){if(!(a instanceof c))throw new TypeError("Cannot call a class as a function")}function i(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var s=i();function d(){try{if(!s||!s.open)return!1;var a=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),c=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!a||c)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function f(a,c){a=a||[],c=c||{};try{return new Blob(a,c)}catch(y){if(y.name!=="TypeError")throw y;for(var u=new(typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder),w=0;w<a.length;w+=1)u.append(a[w]);return u.getBlob(c.type)}}typeof Promise>"u"&&n(3);var m=Promise;function S(a,c){c&&a.then(function(u){c(null,u)},function(u){c(u)})}function k(a,c,u){typeof c=="function"&&a.then(c),typeof u=="function"&&a.catch(u)}function D(a){return typeof a!="string"&&(a=String(a)),a}function j(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var T="local-forage-detect-blob-support",b=void 0,h={},g=Object.prototype.toString,p="readonly",l="readwrite";function v(a){for(var c=a.length,u=new ArrayBuffer(c),w=new Uint8Array(u),y=0;y<c;y++)w[y]=a.charCodeAt(y);return u}function B(a){return new m(function(c){var u=a.transaction(T,l),w=f([""]);u.objectStore(T).put(w,"key"),u.onabort=function(y){y.preventDefault(),y.stopPropagation(),c(!1)},u.oncomplete=function(){var y=navigator.userAgent.match(/Chrome\/(\d+)/),_=navigator.userAgent.match(/Edge\//);c(_||!y||parseInt(y[1],10)>=43)}}).catch(function(){return!1})}function P(a){return typeof b=="boolean"?m.resolve(b):B(a).then(function(c){return b=c})}function A(a){var c=h[a.name],u={};u.promise=new m(function(w,y){u.resolve=w,u.reject=y}),c.deferredOperations.push(u),c.dbReady?c.dbReady=c.dbReady.then(function(){return u.promise}):c.dbReady=u.promise}function $(a){var c=h[a.name].deferredOperations.pop();if(c)return c.resolve(),c.promise}function O(a,c){var u=h[a.name].deferredOperations.pop();if(u)return u.reject(c),u.promise}function W(a,c){return new m(function(u,w){if(h[a.name]=h[a.name]||dn(),a.db){if(!c)return u(a.db);A(a),a.db.close()}var y=[a.name];c&&y.push(a.version);var _=s.open.apply(s,y);c&&(_.onupgradeneeded=function(C){var I=_.result;try{I.createObjectStore(a.storeName),C.oldVersion<=1&&I.createObjectStore(T)}catch(x){if(x.name!=="ConstraintError")throw x}}),_.onerror=function(C){C.preventDefault(),w(_.error)},_.onsuccess=function(){var C=_.result;C.onversionchange=function(I){I.target.close()},u(C),$(a)}})}function F(a){return W(a,!1)}function ae(a){return W(a,!0)}function te(a,c){if(!a.db)return!0;var u=!a.db.objectStoreNames.contains(a.storeName),w=a.version<a.db.version,y=a.version>a.db.version;if(w&&(a.version,a.version=a.db.version),y||u){if(u){var _=a.db.version+1;_>a.version&&(a.version=_)}return!0}return!1}function oe(a){return new m(function(c,u){var w=new FileReader;w.onerror=u,w.onloadend=function(y){var _=btoa(y.target.result||"");c({__local_forage_encoded_blob:!0,data:_,type:a.type})},w.readAsBinaryString(a)})}function Z(a){return f([v(atob(a.data))],{type:a.type})}function ve(a){return a&&a.__local_forage_encoded_blob}function Ve(a){var c=this,u=c._initReady().then(function(){var w=h[c._dbInfo.name];if(w&&w.dbReady)return w.dbReady});return k(u,a,a),u}function vt(a){A(a);for(var c=h[a.name],u=c.forages,w=0;w<u.length;w++){var y=u[w];y._dbInfo.db&&(y._dbInfo.db.close(),y._dbInfo.db=null)}return a.db=null,F(a).then(function(_){return a.db=_,te(a)?ae(a):_}).then(function(_){a.db=c.db=_;for(var C=0;C<u.length;C++)u[C]._dbInfo.db=_}).catch(function(_){throw O(a,_),_})}function pe(a,c,u,w){w===void 0&&(w=1);try{var y=a.db.transaction(a.storeName,c);u(null,y)}catch(_){if(w>0&&(!a.db||_.name==="InvalidStateError"||_.name==="NotFoundError"))return m.resolve().then(function(){if(!a.db||_.name==="NotFoundError"&&!a.db.objectStoreNames.contains(a.storeName)&&a.version<=a.db.version)return a.db&&(a.version=a.db.version+1),ae(a)}).then(function(){return vt(a).then(function(){pe(a,c,u,w-1)})}).catch(u);u(_)}}function dn(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function Ao(a){var c=this,u={db:null};if(a)for(var w in a)u[w]=a[w];var y=h[u.name];y||(y=dn(),h[u.name]=y),y.forages.push(c),c._initReady||(c._initReady=c.ready,c.ready=Ve);var _=[];function C(){return m.resolve()}for(var I=0;I<y.forages.length;I++){var x=y.forages[I];x!==c&&_.push(x._initReady().catch(C))}var R=y.forages.slice(0);return m.all(_).then(function(){return u.db=y.db,F(u)}).then(function(M){return u.db=M,te(u,c._defaultConfig.version)?ae(u):M}).then(function(M){u.db=y.db=M,c._dbInfo=u;for(var N=0;N<R.length;N++){var q=R[N];q!==c&&(q._dbInfo.db=u.db,q._dbInfo.version=u.version)}})}function Do(a,c){var u=this;a=D(a);var w=new m(function(y,_){u.ready().then(function(){pe(u._dbInfo,p,function(C,I){if(C)return _(C);try{var x=I.objectStore(u._dbInfo.storeName).get(a);x.onsuccess=function(){var R=x.result;R===void 0&&(R=null),ve(R)&&(R=Z(R)),y(R)},x.onerror=function(){_(x.error)}}catch(R){_(R)}})}).catch(_)});return S(w,c),w}function Bo(a,c){var u=this,w=new m(function(y,_){u.ready().then(function(){pe(u._dbInfo,p,function(C,I){if(C)return _(C);try{var x=I.objectStore(u._dbInfo.storeName).openCursor(),R=1;x.onsuccess=function(){var M=x.result;if(M){var N=M.value;ve(N)&&(N=Z(N));var q=a(N,M.key,R++);q!==void 0?y(q):M.continue()}else y()},x.onerror=function(){_(x.error)}}catch(M){_(M)}})}).catch(_)});return S(w,c),w}function $o(a,c,u){var w=this;a=D(a);var y=new m(function(_,C){var I;w.ready().then(function(){return I=w._dbInfo,g.call(c)==="[object Blob]"?P(I.db).then(function(x){return x?c:oe(c)}):c}).then(function(x){pe(w._dbInfo,l,function(R,M){if(R)return C(R);try{var N=M.objectStore(w._dbInfo.storeName);x===null&&(x=void 0);var q=N.put(x,a);M.oncomplete=function(){x===void 0&&(x=null),_(x)},M.onabort=M.onerror=function(){var z=q.error?q.error:q.transaction.error;C(z)}}catch(z){C(z)}})}).catch(C)});return S(y,u),y}function No(a,c){var u=this;a=D(a);var w=new m(function(y,_){u.ready().then(function(){pe(u._dbInfo,l,function(C,I){if(C)return _(C);try{var x=I.objectStore(u._dbInfo.storeName).delete(a);I.oncomplete=function(){y()},I.onerror=function(){_(x.error)},I.onabort=function(){var R=x.error?x.error:x.transaction.error;_(R)}}catch(R){_(R)}})}).catch(_)});return S(w,c),w}function jo(a){var c=this,u=new m(function(w,y){c.ready().then(function(){pe(c._dbInfo,l,function(_,C){if(_)return y(_);try{var I=C.objectStore(c._dbInfo.storeName).clear();C.oncomplete=function(){w()},C.onabort=C.onerror=function(){var x=I.error?I.error:I.transaction.error;y(x)}}catch(x){y(x)}})}).catch(y)});return S(u,a),u}function Ho(a){var c=this,u=new m(function(w,y){c.ready().then(function(){pe(c._dbInfo,p,function(_,C){if(_)return y(_);try{var I=C.objectStore(c._dbInfo.storeName).count();I.onsuccess=function(){w(I.result)},I.onerror=function(){y(I.error)}}catch(x){y(x)}})}).catch(y)});return S(u,a),u}function Oo(a,c){var u=this,w=new m(function(y,_){a<0?y(null):u.ready().then(function(){pe(u._dbInfo,p,function(C,I){if(C)return _(C);try{var x=I.objectStore(u._dbInfo.storeName),R=!1,M=x.openKeyCursor();M.onsuccess=function(){var N=M.result;N?a===0||R?y(N.key):(R=!0,N.advance(a)):y(null)},M.onerror=function(){_(M.error)}}catch(N){_(N)}})}).catch(_)});return S(w,c),w}function Uo(a){var c=this,u=new m(function(w,y){c.ready().then(function(){pe(c._dbInfo,p,function(_,C){if(_)return y(_);try{var I=C.objectStore(c._dbInfo.storeName).openKeyCursor(),x=[];I.onsuccess=function(){var R=I.result;R?(x.push(R.key),R.continue()):w(x)},I.onerror=function(){y(I.error)}}catch(R){y(R)}})}).catch(y)});return S(u,a),u}function Wo(a,c){c=j.apply(this,arguments);var u=this.config();(a=typeof a!="function"&&a||{}).name||(a.name=a.name||u.name,a.storeName=a.storeName||u.storeName);var w,y=this;if(a.name){var _=a.name===u.name&&y._dbInfo.db?m.resolve(y._dbInfo.db):F(a).then(function(C){var I=h[a.name],x=I.forages;I.db=C;for(var R=0;R<x.length;R++)x[R]._dbInfo.db=C;return C});w=a.storeName?_.then(function(C){if(C.objectStoreNames.contains(a.storeName)){var I=C.version+1;A(a);var x=h[a.name],R=x.forages;C.close();for(var M=0;M<R.length;M++){var N=R[M];N._dbInfo.db=null,N._dbInfo.version=I}var q=new m(function(z,X){var ee=s.open(a.name,I);ee.onerror=function(ye){ee.result.close(),X(ye)},ee.onupgradeneeded=function(){ee.result.deleteObjectStore(a.storeName)},ee.onsuccess=function(){var ye=ee.result;ye.close(),z(ye)}});return q.then(function(z){x.db=z;for(var X=0;X<R.length;X++){var ee=R[X];ee._dbInfo.db=z,$(ee._dbInfo)}}).catch(function(z){throw(O(a,z)||m.resolve()).catch(function(){}),z})}}):_.then(function(C){A(a);var I=h[a.name],x=I.forages;C.close();for(var R=0;R<x.length;R++)x[R]._dbInfo.db=null;var M=new m(function(N,q){var z=s.deleteDatabase(a.name);z.onerror=function(){var X=z.result;X&&X.close(),q(z.error)},z.onblocked=function(){},z.onsuccess=function(){var X=z.result;X&&X.close(),N(X)}});return M.then(function(N){I.db=N;for(var q=0;q<x.length;q++)$(x[q]._dbInfo)}).catch(function(N){throw(O(a,N)||m.resolve()).catch(function(){}),N})})}else w=m.reject("Invalid arguments");return S(w,c),w}var qo={_driver:"asyncStorage",_initStorage:Ao,_support:d(),iterate:Bo,getItem:Do,setItem:$o,removeItem:No,clear:jo,length:Ho,key:Oo,keys:Uo,dropInstance:Wo};function Fo(){return typeof openDatabase=="function"}var _e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",zo="~~local_forage_type~",fn=/^~~local_forage_type~([^~]+)~/,Je="__lfsc__:",yt=Je.length,wt="arbf",_t="blob",pn="si08",gn="ui08",mn="uic8",vn="si16",yn="si32",wn="ur16",_n="ui32",bn="fl32",Sn="fl64",Cn=yt+wt.length,En=Object.prototype.toString;function kn(a){var c,u,w,y,_,C=.75*a.length,I=a.length,x=0;a[a.length-1]==="="&&(C--,a[a.length-2]==="="&&C--);var R=new ArrayBuffer(C),M=new Uint8Array(R);for(c=0;c<I;c+=4)u=_e.indexOf(a[c]),w=_e.indexOf(a[c+1]),y=_e.indexOf(a[c+2]),_=_e.indexOf(a[c+3]),M[x++]=u<<2|w>>4,M[x++]=(15&w)<<4|y>>2,M[x++]=(3&y)<<6|63&_;return R}function bt(a){var c,u=new Uint8Array(a),w="";for(c=0;c<u.length;c+=3)w+=_e[u[c]>>2],w+=_e[(3&u[c])<<4|u[c+1]>>4],w+=_e[(15&u[c+1])<<2|u[c+2]>>6],w+=_e[63&u[c+2]];return u.length%3==2?w=w.substring(0,w.length-1)+"=":u.length%3==1&&(w=w.substring(0,w.length-2)+"=="),w}function Xo(a,c){var u="";if(a&&(u=En.call(a)),a&&(u==="[object ArrayBuffer]"||a.buffer&&En.call(a.buffer)==="[object ArrayBuffer]")){var w,y=Je;a instanceof ArrayBuffer?(w=a,y+=wt):(w=a.buffer,u==="[object Int8Array]"?y+=pn:u==="[object Uint8Array]"?y+=gn:u==="[object Uint8ClampedArray]"?y+=mn:u==="[object Int16Array]"?y+=vn:u==="[object Uint16Array]"?y+=wn:u==="[object Int32Array]"?y+=yn:u==="[object Uint32Array]"?y+=_n:u==="[object Float32Array]"?y+=bn:u==="[object Float64Array]"?y+=Sn:c(new Error("Failed to get type for BinaryArray"))),c(y+bt(w))}else if(u==="[object Blob]"){var _=new FileReader;_.onload=function(){var C=zo+a.type+"~"+bt(this.result);c(Je+_t+C)},_.readAsArrayBuffer(a)}else try{c(JSON.stringify(a))}catch(C){c(null,C)}}function Go(a){if(a.substring(0,yt)!==Je)return JSON.parse(a);var c,u=a.substring(Cn),w=a.substring(yt,Cn);if(w===_t&&fn.test(u)){var y=u.match(fn);c=y[1],u=u.substring(y[0].length)}var _=kn(u);switch(w){case wt:return _;case _t:return f([_],{type:c});case pn:return new Int8Array(_);case gn:return new Uint8Array(_);case mn:return new Uint8ClampedArray(_);case vn:return new Int16Array(_);case wn:return new Uint16Array(_);case yn:return new Int32Array(_);case _n:return new Uint32Array(_);case bn:return new Float32Array(_);case Sn:return new Float64Array(_);default:throw new Error("Unkown type: "+w)}}var St={serialize:Xo,deserialize:Go,stringToBuffer:kn,bufferToString:bt};function In(a,c,u,w){a.executeSql("CREATE TABLE IF NOT EXISTS "+c.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],u,w)}function Ko(a){var c=this,u={db:null};if(a)for(var w in a)u[w]=typeof a[w]!="string"?a[w].toString():a[w];var y=new m(function(_,C){try{u.db=openDatabase(u.name,String(u.version),u.description,u.size)}catch(I){return C(I)}u.db.transaction(function(I){In(I,u,function(){c._dbInfo=u,_()},function(x,R){C(R)})},C)});return u.serializer=St,y}function be(a,c,u,w,y,_){a.executeSql(u,w,y,function(C,I){I.code===I.SYNTAX_ERR?C.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[c.storeName],function(x,R){R.rows.length?_(x,I):In(x,c,function(){x.executeSql(u,w,y,_)},_)},_):_(C,I)},_)}function Vo(a,c){var u=this;a=D(a);var w=new m(function(y,_){u.ready().then(function(){var C=u._dbInfo;C.db.transaction(function(I){be(I,C,"SELECT * FROM "+C.storeName+" WHERE key = ? LIMIT 1",[a],function(x,R){var M=R.rows.length?R.rows.item(0).value:null;M&&(M=C.serializer.deserialize(M)),y(M)},function(x,R){_(R)})})}).catch(_)});return S(w,c),w}function Jo(a,c){var u=this,w=new m(function(y,_){u.ready().then(function(){var C=u._dbInfo;C.db.transaction(function(I){be(I,C,"SELECT * FROM "+C.storeName,[],function(x,R){for(var M=R.rows,N=M.length,q=0;q<N;q++){var z=M.item(q),X=z.value;if(X&&(X=C.serializer.deserialize(X)),(X=a(X,z.key,q+1))!==void 0)return void y(X)}y()},function(x,R){_(R)})})}).catch(_)});return S(w,c),w}function xn(a,c,u,w){var y=this;a=D(a);var _=new m(function(C,I){y.ready().then(function(){c===void 0&&(c=null);var x=c,R=y._dbInfo;R.serializer.serialize(c,function(M,N){N?I(N):R.db.transaction(function(q){be(q,R,"INSERT OR REPLACE INTO "+R.storeName+" (key, value) VALUES (?, ?)",[a,M],function(){C(x)},function(z,X){I(X)})},function(q){if(q.code===q.QUOTA_ERR){if(w>0)return void C(xn.apply(y,[a,x,u,w-1]));I(q)}})})}).catch(I)});return S(_,u),_}function Yo(a,c,u){return xn.apply(this,[a,c,u,1])}function Qo(a,c){var u=this;a=D(a);var w=new m(function(y,_){u.ready().then(function(){var C=u._dbInfo;C.db.transaction(function(I){be(I,C,"DELETE FROM "+C.storeName+" WHERE key = ?",[a],function(){y()},function(x,R){_(R)})})}).catch(_)});return S(w,c),w}function Zo(a){var c=this,u=new m(function(w,y){c.ready().then(function(){var _=c._dbInfo;_.db.transaction(function(C){be(C,_,"DELETE FROM "+_.storeName,[],function(){w()},function(I,x){y(x)})})}).catch(y)});return S(u,a),u}function er(a){var c=this,u=new m(function(w,y){c.ready().then(function(){var _=c._dbInfo;_.db.transaction(function(C){be(C,_,"SELECT COUNT(key) as c FROM "+_.storeName,[],function(I,x){var R=x.rows.item(0).c;w(R)},function(I,x){y(x)})})}).catch(y)});return S(u,a),u}function tr(a,c){var u=this,w=new m(function(y,_){u.ready().then(function(){var C=u._dbInfo;C.db.transaction(function(I){be(I,C,"SELECT key FROM "+C.storeName+" WHERE id = ? LIMIT 1",[a+1],function(x,R){var M=R.rows.length?R.rows.item(0).key:null;y(M)},function(x,R){_(R)})})}).catch(_)});return S(w,c),w}function nr(a){var c=this,u=new m(function(w,y){c.ready().then(function(){var _=c._dbInfo;_.db.transaction(function(C){be(C,_,"SELECT key FROM "+_.storeName,[],function(I,x){for(var R=[],M=0;M<x.rows.length;M++)R.push(x.rows.item(M).key);w(R)},function(I,x){y(x)})})}).catch(y)});return S(u,a),u}function or(a){return new m(function(c,u){a.transaction(function(w){w.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(y,_){for(var C=[],I=0;I<_.rows.length;I++)C.push(_.rows.item(I).name);c({db:a,storeNames:C})},function(y,_){u(_)})},function(w){u(w)})})}function rr(a,c){c=j.apply(this,arguments);var u=this.config();(a=typeof a!="function"&&a||{}).name||(a.name=a.name||u.name,a.storeName=a.storeName||u.storeName);var w,y=this;return w=a.name?new m(function(_){var C;C=a.name===u.name?y._dbInfo.db:openDatabase(a.name,"","",0),a.storeName?_({db:C,storeNames:[a.storeName]}):_(or(C))}).then(function(_){return new m(function(C,I){_.db.transaction(function(x){function R(z){return new m(function(X,ee){x.executeSql("DROP TABLE IF EXISTS "+z,[],function(){X()},function(ye,kt){ee(kt)})})}for(var M=[],N=0,q=_.storeNames.length;N<q;N++)M.push(R(_.storeNames[N]));m.all(M).then(function(){C()}).catch(function(z){I(z)})},function(x){I(x)})})}):m.reject("Invalid arguments"),S(w,c),w}var ir={_driver:"webSQLStorage",_initStorage:Ko,_support:Fo(),iterate:Jo,getItem:Vo,setItem:Yo,removeItem:Qo,clear:Zo,length:er,key:tr,keys:nr,dropInstance:rr};function sr(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function Tn(a,c){var u=a.name+"/";return a.storeName!==c.storeName&&(u+=a.storeName+"/"),u}function ar(){var a="_localforage_support_test";try{return localStorage.setItem(a,!0),localStorage.removeItem(a),!1}catch{return!0}}function cr(){return!ar()||localStorage.length>0}function lr(a){var c=this,u={};if(a)for(var w in a)u[w]=a[w];return u.keyPrefix=Tn(a,c._defaultConfig),cr()?(c._dbInfo=u,u.serializer=St,m.resolve()):m.reject()}function ur(a){var c=this,u=c.ready().then(function(){for(var w=c._dbInfo.keyPrefix,y=localStorage.length-1;y>=0;y--){var _=localStorage.key(y);_.indexOf(w)===0&&localStorage.removeItem(_)}});return S(u,a),u}function hr(a,c){var u=this;a=D(a);var w=u.ready().then(function(){var y=u._dbInfo,_=localStorage.getItem(y.keyPrefix+a);return _&&(_=y.serializer.deserialize(_)),_});return S(w,c),w}function dr(a,c){var u=this,w=u.ready().then(function(){for(var y=u._dbInfo,_=y.keyPrefix,C=_.length,I=localStorage.length,x=1,R=0;R<I;R++){var M=localStorage.key(R);if(M.indexOf(_)===0){var N=localStorage.getItem(M);if(N&&(N=y.serializer.deserialize(N)),(N=a(N,M.substring(C),x++))!==void 0)return N}}});return S(w,c),w}function fr(a,c){var u=this,w=u.ready().then(function(){var y,_=u._dbInfo;try{y=localStorage.key(a)}catch{y=null}return y&&(y=y.substring(_.keyPrefix.length)),y});return S(w,c),w}function pr(a){var c=this,u=c.ready().then(function(){for(var w=c._dbInfo,y=localStorage.length,_=[],C=0;C<y;C++){var I=localStorage.key(C);I.indexOf(w.keyPrefix)===0&&_.push(I.substring(w.keyPrefix.length))}return _});return S(u,a),u}function gr(a){var c=this.keys().then(function(u){return u.length});return S(c,a),c}function mr(a,c){var u=this;a=D(a);var w=u.ready().then(function(){var y=u._dbInfo;localStorage.removeItem(y.keyPrefix+a)});return S(w,c),w}function vr(a,c,u){var w=this;a=D(a);var y=w.ready().then(function(){c===void 0&&(c=null);var _=c;return new m(function(C,I){var x=w._dbInfo;x.serializer.serialize(c,function(R,M){if(M)I(M);else try{localStorage.setItem(x.keyPrefix+a,R),C(_)}catch(N){N.name!=="QuotaExceededError"&&N.name!=="NS_ERROR_DOM_QUOTA_REACHED"||I(N),I(N)}})})});return S(y,u),y}function yr(a,c){if(c=j.apply(this,arguments),!(a=typeof a!="function"&&a||{}).name){var u=this.config();a.name=a.name||u.name,a.storeName=a.storeName||u.storeName}var w,y=this;return w=a.name?new m(function(_){a.storeName?_(Tn(a,y._defaultConfig)):_(a.name+"/")}).then(function(_){for(var C=localStorage.length-1;C>=0;C--){var I=localStorage.key(C);I.indexOf(_)===0&&localStorage.removeItem(I)}}):m.reject("Invalid arguments"),S(w,c),w}var wr={_driver:"localStorageWrapper",_initStorage:lr,_support:sr(),iterate:dr,getItem:hr,setItem:vr,removeItem:mr,clear:ur,length:gr,key:fr,keys:pr,dropInstance:yr},_r=function(a,c){return a===c||typeof a=="number"&&typeof c=="number"&&isNaN(a)&&isNaN(c)},br=function(a,c){for(var u=a.length,w=0;w<u;){if(_r(a[w],c))return!0;w++}return!1},Rn=Array.isArray||function(a){return Object.prototype.toString.call(a)==="[object Array]"},Oe={},Pn={},Be={INDEXEDDB:qo,WEBSQL:ir,LOCALSTORAGE:wr},Sr=[Be.INDEXEDDB._driver,Be.WEBSQL._driver,Be.LOCALSTORAGE._driver],Ye=["dropInstance"],Ct=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(Ye),Cr={description:"",driver:Sr.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function Er(a,c){a[c]=function(){var u=arguments;return a.ready().then(function(){return a[c].apply(a,u)})}}function Et(){for(var a=1;a<arguments.length;a++){var c=arguments[a];if(c)for(var u in c)c.hasOwnProperty(u)&&(Rn(c[u])?arguments[0][u]=c[u].slice():arguments[0][u]=c[u])}return arguments[0]}var kr=function(){function a(c){for(var u in r(this,a),Be)if(Be.hasOwnProperty(u)){var w=Be[u],y=w._driver;this[u]=y,Oe[y]||this.defineDriver(w)}this._defaultConfig=Et({},Cr),this._config=Et({},this._defaultConfig,c),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return a.prototype.config=function(c){if((c===void 0?"undefined":o(c))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var u in c){if(u==="storeName"&&(c[u]=c[u].replace(/\W/g,"_")),u==="version"&&typeof c[u]!="number")return new Error("Database version must be a number.");this._config[u]=c[u]}return!("driver"in c)||!c.driver||this.setDriver(this._config.driver)}return typeof c=="string"?this._config[c]:this._config},a.prototype.defineDriver=function(c,u,w){var y=new m(function(_,C){try{var I=c._driver,x=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!c._driver)return void C(x);for(var R=Ct.concat("_initStorage"),M=0,N=R.length;M<N;M++){var q=R[M];if((!br(Ye,q)||c[q])&&typeof c[q]!="function")return void C(x)}var z=function(){for(var ee=function(xr){return function(){var Tr=new Error("Method "+xr+" is not implemented by the current driver"),Mn=m.reject(Tr);return S(Mn,arguments[arguments.length-1]),Mn}},ye=0,kt=Ye.length;ye<kt;ye++){var It=Ye[ye];c[It]||(c[It]=ee(It))}};z();var X=function(ee){Oe[I],Oe[I]=c,Pn[I]=ee,_()};"_support"in c?c._support&&typeof c._support=="function"?c._support().then(X,C):X(!!c._support):X(!0)}catch(ee){C(ee)}});return k(y,u,w),y},a.prototype.driver=function(){return this._driver||null},a.prototype.getDriver=function(c,u,w){var y=Oe[c]?m.resolve(Oe[c]):m.reject(new Error("Driver not found."));return k(y,u,w),y},a.prototype.getSerializer=function(c){var u=m.resolve(St);return k(u,c),u},a.prototype.ready=function(c){var u=this,w=u._driverSet.then(function(){return u._ready===null&&(u._ready=u._initDriver()),u._ready});return k(w,c,c),w},a.prototype.setDriver=function(c,u,w){var y=this;Rn(c)||(c=[c]);var _=this._getSupportedDrivers(c);function C(){y._config.driver=y.driver()}function I(M){return y._extend(M),C(),y._ready=y._initStorage(y._config),y._ready}function x(M){return function(){var N=0;function q(){for(;N<M.length;){var z=M[N];return N++,y._dbInfo=null,y._ready=null,y.getDriver(z).then(I).catch(q)}C();var X=new Error("No available storage method found.");return y._driverSet=m.reject(X),y._driverSet}return q()}}var R=this._driverSet!==null?this._driverSet.catch(function(){return m.resolve()}):m.resolve();return this._driverSet=R.then(function(){var M=_[0];return y._dbInfo=null,y._ready=null,y.getDriver(M).then(function(N){y._driver=N._driver,C(),y._wrapLibraryMethodsWithReady(),y._initDriver=x(_)})}).catch(function(){C();var M=new Error("No available storage method found.");return y._driverSet=m.reject(M),y._driverSet}),k(this._driverSet,u,w),this._driverSet},a.prototype.supports=function(c){return!!Pn[c]},a.prototype._extend=function(c){Et(this,c)},a.prototype._getSupportedDrivers=function(c){for(var u=[],w=0,y=c.length;w<y;w++){var _=c[w];this.supports(_)&&u.push(_)}return u},a.prototype._wrapLibraryMethodsWithReady=function(){for(var c=0,u=Ct.length;c<u;c++)Er(this,Ct[c])},a.prototype.createInstance=function(c){return new a(c)},a}(),Ir=new kr;e.exports=Ir},{3:3}]},{},[4])(4));var vo={exports:{}};/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/(function(n){((e,t)=>{n.exports=t()})(0,()=>{const e=typeof window=="object"?window:this;e.HTMLElement;let t=null,o=!1;const r=e.WebStreamsPolyfill||{},i=e.isSecureContext;let s=/constructor/i.test(e.HTMLElement)||!!e.safari||!!e.WebKitPoint;const d=i||"MozAppearance"in document.documentElement.style?"iframe":"navigate",f={createWriteStream:function(S,k,D){let j={size:null,pathname:null,writableStrategy:void 0,readableStrategy:void 0},T=0,b=null,h=null,g=null;if(Number.isFinite(k)?([D,k]=[k,D],j.size=D,j.writableStrategy=k):k&&k.highWaterMark?(j.size=D,j.writableStrategy=k):j=k||{},!s){t||(t=i?m(f.mitm):function(B){const P="width=200,height=100",A=document.createDocumentFragment(),$={frame:e.open(B,"popup",P),loaded:!1,isIframe:!1,isPopup:!0,remove(){$.frame.close()},addEventListener(...W){A.addEventListener(...W)},dispatchEvent(...W){A.dispatchEvent(...W)},removeEventListener(...W){A.removeEventListener(...W)},postMessage(...W){$.frame.postMessage(...W)}},O=W=>{W.source===$.frame&&($.loaded=!0,e.removeEventListener("message",O),$.dispatchEvent(new Event("load")))};return e.addEventListener("message",O),$}(f.mitm)),h=new MessageChannel,S=encodeURIComponent(S.replace(/\//g,":")).replace(/['()]/g,escape).replace(/\*/g,"%2A");const l={transferringReadable:o,pathname:j.pathname||Math.random().toString().slice(-6)+"/"+S,headers:{"Content-Type":"application/octet-stream; charset=utf-8","Content-Disposition":"attachment; filename*=UTF-8''"+S}};j.size&&(l.headers["Content-Length"]=j.size);const v=[l,"*",[h.port2]];if(o){const B=d==="iframe"?void 0:{transform(A,$){if(!(A instanceof Uint8Array))throw new TypeError("Can only write Uint8Arrays");T+=A.length,$.enqueue(A),b&&(location.href=b,b=null)},flush(){b&&(location.href=b)}};g=new f.TransformStream(B,j.writableStrategy,j.readableStrategy);const P=g.readable;h.port1.postMessage({readableStream:P},[P])}h.port1.onmessage=B=>{B.data.download?d==="navigate"?(t.remove(),t=null,T?location.href=B.data.download:b=B.data.download):(t.isPopup&&(t.remove(),t=null,d==="iframe"&&m(f.mitm)),m(B.data.download)):B.data.abort&&(p=[],h.port1.postMessage("abort"),h.port1.onmessage=null,h.port1.close(),h.port2.close(),h=null)},t.loaded?t.postMessage(...v):t.addEventListener("load",()=>{t.postMessage(...v)},{once:!0})}let p=[];return!s&&g&&g.writable||new f.WritableStream({write(l){if(!(l instanceof Uint8Array))throw new TypeError("Can only write Uint8Arrays");s?p.push(l):(h.port1.postMessage(l),T+=l.length,b&&(location.href=b,b=null))},close(){if(s){const l=new Blob(p,{type:"application/octet-stream; charset=utf-8"}),v=document.createElement("a");v.href=URL.createObjectURL(l),v.download=S,v.click()}else h.port1.postMessage("end")},abort(){p=[],h.port1.postMessage("abort"),h.port1.onmessage=null,h.port1.close(),h.port2.close(),h=null}},j.writableStrategy)},WritableStream:e.WritableStream||r.WritableStream,supported:!0,version:{full:"2.0.5",major:2,minor:0,dot:5},mitm:"https://jimmywarting.github.io/StreamSaver.js/mitm.html?version=2.0.0"};function m(S){if(!S)throw new Error("meh");const k=document.createElement("iframe");return k.hidden=!0,k.src=S,k.loaded=!1,k.name="iframe",k.isIframe=!0,k.postMessage=(...D)=>k.contentWindow.postMessage(...D),k.addEventListener("load",()=>{k.loaded=!0},{once:!0}),document.body.appendChild(k),k}try{new Response(new ReadableStream),i&&!("serviceWorker"in navigator)&&(s=!0)}catch{s=!0}return(S=>{try{S()}catch{}})(()=>{const{readable:S}=new TransformStream,k=new MessageChannel;k.port1.postMessage(S,[S]),k.port1.close(),k.port2.close(),o=!0,Object.defineProperty(f,"TransformStream",{configurable:!1,writable:!1,value:TransformStream})}),f})})(vo);gt(vo.exports);function ci(n={},e={}){let t;for(t in e)on(e[t])?n[t]=ci(n[t],e[t]):n[t]=e[t];return n}function li(n,e){const t=`${n}_${e}`;return ct.MD5(t)}function ui(n){const e=function(d){if(!d)return;const f=d,m=[];if(f)for(let S of f){const k=yo(S);k&&m.push(k)}return m}(n.bussinessRoutes),t=function(d){if(!d)return;const f=d;if(f&&f.length>0){const m=[];return f.forEach(S=>{const k=wo(S);k&&m.push(k)}),m}}(n.widgetMenuConfig),o=function(d){if(d&&d.length>0){const f=[];return d.forEach(m=>{const S=function(k){return k?{id:k.id,label:k.label,container:k.container,preload:k.preload,afterid:k.afterid,bindid:k.bindid,group:k.group}:void 0}(m);S&&f.push(S)}),f}}(n.widgetConfig),r=function(d){if(d&&d.length>0)return d}(n.functionList),i=n.pkgObject.version,s=n.pkgObject.name;return{id:li(s,i),name:H.Config.UI.SiteTitle,group:H.Config.UI.Group,product:s,version:i,routes:e,widgetMenu:t,widgets:o,functions:r}}function yo(n){var e,t,o;if(n){let r=0;(e=n.meta)!=null&&e.hidden&&(r=1);let i={path:n.path,name:n.name,title:(t=n.meta)==null?void 0:t.title,type:r,index:(o=n.meta)==null?void 0:o.index};if(n.children){const s=[];for(let d of n.children){const f=yo(d);f&&s.push(f)}s.length>0&&(i.children=s)}return i}}function wo(n){if(!n)return;const e={name:n.name,index:n.index,path:n.path,type:n.type};return n.children&&n.children.length>0&&(e.children=[],n.children.forEach(t=>{var r;const o=wo(t);o&&((r=e.children)==null||r.push(o))})),e}function bs(n,e){var o;const t=ui(n);Jr(t,e),(o=H.Message)==null||o.msg("导出系统功能权限文件成功！")}let _o=!0;try{String.fromCharCode.apply(String,[1,2])}catch{_o=!1,Object.defineProperty(Array.prototype,"subarray",{value:Array.prototype.slice})}var Gt=2654435769;function bo(n,e){var t=n.length,o=t<<2;if(e){var r=n[t-1];if(r<(o-=4)-3||r>o)return null;o=r}for(var i=new Uint8Array(o),s=0;s<o;++s)i[s]=n[s>>2]>>((3&s)<<3);return i}function ht(n,e){var t,o=n.length,r=o>>2;3&o&&++r,e?(t=new Uint32Array(r+1))[r]=o:t=new Uint32Array(r);for(var i=0;i<o;++i)t[i>>2]|=n[i]<<((3&i)<<3);return t}function Re(n){return 4294967295&n}function dt(n,e,t,o,r,i){return(t>>>5^e<<2)+(e>>>3^t<<4)^(n^e)+(i[3&o^r]^t)}function So(n){if(n.length<16){var e=new Uint8Array(16);e.set(n),n=e}return n}function ft(n){for(var e=n.length,t=new Uint8Array(3*e),o=0,r=0;r<e;r++){var i=n.charCodeAt(r);if(i<128)t[o++]=i;else if(i<2048)t[o++]=192|i>>6,t[o++]=128|63&i;else{if(!(i<55296||i>57343)){if(r+1<e){var s=n.charCodeAt(r+1);if(i<56320&&56320<=s&&s<=57343){var d=65536+((1023&i)<<10|1023&s);t[o++]=240|d>>18,t[o++]=128|d>>12&63,t[o++]=128|d>>6&63,t[o++]=128|63&d,r++;continue}}throw new Error("Malformed string")}t[o++]=224|i>>12,t[o++]=128|i>>6&63,t[o++]=128|63&i}}return t.subarray(0,o)}function Un(n){var e=n.length;return e===0?"":e<32767?function(t,o){for(var r=new Array(o),i=0,s=0,d=t.length;i<o&&s<d;i++){var f=t[s++];switch(f>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:r[i]=f;break;case 12:case 13:if(!(s<d))throw new Error("Unfinished UTF-8 octet sequence");r[i]=(31&f)<<6|63&t[s++];break;case 14:if(!(s+1<d))throw new Error("Unfinished UTF-8 octet sequence");r[i]=(15&f)<<12|(63&t[s++])<<6|63&t[s++];break;case 15:if(!(s+2<d))throw new Error("Unfinished UTF-8 octet sequence");var m=((7&f)<<18|(63&t[s++])<<12|(63&t[s++])<<6|63&t[s++])-65536;if(!(0<=m&&m<=1048575))throw new Error("Character outside valid Unicode range: 0x"+m.toString(16));r[i++]=m>>10&1023|55296,r[i]=1023&m|56320;break;default:throw new Error("Bad UTF-8 encoding 0x"+f.toString(16))}}return i<o&&(r.length=i),String.fromCharCode.apply(String,r)}(n,e):function(t,o){for(var r=[],i=new Array(32768),s=0,d=0,f=t.length;s<o&&d<f;s++){var m=t[d++];switch(m>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:i[s]=m;break;case 12:case 13:if(!(d<f))throw new Error("Unfinished UTF-8 octet sequence");i[s]=(31&m)<<6|63&t[d++];break;case 14:if(!(d+1<f))throw new Error("Unfinished UTF-8 octet sequence");i[s]=(15&m)<<12|(63&t[d++])<<6|63&t[d++];break;case 15:if(!(d+2<f))throw new Error("Unfinished UTF-8 octet sequence");var S=((7&m)<<18|(63&t[d++])<<12|(63&t[d++])<<6|63&t[d++])-65536;if(!(0<=S&&S<=1048575))throw new Error("Character outside valid Unicode range: 0x"+S.toString(16));i[s++]=S>>10&1023|55296,i[s]=1023&S|56320;break;default:throw new Error("Bad UTF-8 encoding 0x"+m.toString(16))}if(s>=32766){var k=s+1;i.length=k,r.push(String.fromCharCode.apply(String,i)),o-=k,s=-1}}return s>0&&(i.length=s,r.push(String.fromCharCode.apply(String,i))),r.join("")}(n,e)}function hi(n){var e=n.length;if(e===0)return"";var t=_o?n:function(d){for(var f=d.length,m=new Array(d.length),S=0;S<f;++S)m[S]=d[S];return m}(n);if(e<65535)return String.fromCharCode.apply(String,t);for(var o=32767&e,r=e>>15,i=new Array(o?r+1:r),s=0;s<r;++s)i[s]=String.fromCharCode.apply(String,t.subarray(s<<15,s+1<<15));return o&&(i[r]=String.fromCharCode.apply(String,t.subarray(r<<15,e))),i.join("")}function Wn(n,e){return typeof n=="string"&&(n=ft(n)),typeof e=="string"&&(e=ft(e)),n==null||n.length===0?n:bo(function(t,o){var r,i,s,d,f,m,S=t.length,k=S-1;for(i=t[k],s=0,m=0|Math.floor(6+52/S);m>0;--m){for(d=(s=Re(s+Gt))>>>2&3,f=0;f<k;++f)r=t[f+1],i=t[f]=Re(t[f]+dt(s,r,i,f,d,o));r=t[0],i=t[k]=Re(t[k]+dt(s,r,i,k,d,o))}return t}(ht(n,!0),ht(So(e),!1)),!1)}function qn(n,e){return typeof n=="string"&&(n=function(t){for(var o=window.atob(t),r=o.length,i=new Uint8Array(r),s=0;s<r;s++)i[s]=o.charCodeAt(s);return i}(n)),typeof e=="string"&&(e=ft(e)),n==null||n.length===0?n:bo(function(t,o){var r,i,s,d,f,m=t.length,S=m-1;for(r=t[0],s=Re(Math.floor(6+52/m)*Gt);s!==0;s=Re(s-Gt)){for(d=s>>>2&3,f=S;f>0;--f)i=t[f-1],r=t[f]=Re(t[f]-dt(s,r,i,f,d,o));i=t[S],r=t[0]=Re(t[0]-dt(s,r,i,0,d,o))}return t}(ht(n,!1),ht(So(e),!1)),!0)}const di={toBytes:ft,toString:Un,encrypt:Wn,encryptToString:function(n,e){return window.btoa(hi(Wn(n,e)))},decrypt:qn,decryptToString:function(n,e){return Un(qn(n,e))}};class Pe extends Error{constructor(e,t){const o=new.target.prototype;super(`${e}: Status code '${t}'`),this.statusCode=t,this.__proto__=o}}class rn extends Error{constructor(e="A timeout occurred."){const t=new.target.prototype;super(e),this.__proto__=t}}class me extends Error{constructor(e="An abort occurred."){const t=new.target.prototype;super(e),this.__proto__=t}}class fi extends Error{constructor(e,t){const o=new.target.prototype;super(e),this.transport=t,this.errorType="UnsupportedTransportError",this.__proto__=o}}class pi extends Error{constructor(e,t){const o=new.target.prototype;super(e),this.transport=t,this.errorType="DisabledTransportError",this.__proto__=o}}class gi extends Error{constructor(e,t){const o=new.target.prototype;super(e),this.transport=t,this.errorType="FailedToStartTransportError",this.__proto__=o}}class Fn extends Error{constructor(e){const t=new.target.prototype;super(e),this.errorType="FailedToNegotiateWithServerError",this.__proto__=t}}class mi extends Error{constructor(e,t){const o=new.target.prototype;super(e),this.innerErrors=t,this.__proto__=o}}class Co{constructor(e,t,o){this.statusCode=e,this.statusText=t,this.content=o}}class mt{get(e,t){return this.send({...t,method:"GET",url:e})}post(e,t){return this.send({...t,method:"POST",url:e})}delete(e,t){return this.send({...t,method:"DELETE",url:e})}getCookieString(e){return""}}var E;(function(n){n[n.Trace=0]="Trace",n[n.Debug=1]="Debug",n[n.Information=2]="Information",n[n.Warning=3]="Warning",n[n.Error=4]="Error",n[n.Critical=5]="Critical",n[n.None=6]="None"})(E||(E={}));class ze{constructor(){}log(e,t){}}ze.instance=new ze;class J{static isRequired(e,t){if(e==null)throw new Error(`The '${t}' argument is required.`)}static isNotEmpty(e,t){if(!e||e.match(/^\s*$/))throw new Error(`The '${t}' argument should not be empty.`)}static isIn(e,t,o){if(!(e in t))throw new Error(`Unknown ${o} value: ${e}.`)}}class V{static get isBrowser(){return!V.isNode&&typeof window=="object"&&typeof window.document=="object"}static get isWebWorker(){return!V.isNode&&typeof self=="object"&&"importScripts"in self}static get isReactNative(){return!V.isNode&&typeof window=="object"&&window.document===void 0}static get isNode(){return typeof process<"u"&&process.release&&process.release.name==="node"}}function Xe(n,e){let t="";return Ae(n)?(t=`Binary data of length ${n.byteLength}`,e&&(t+=`. Content: '${function(o){const r=new Uint8Array(o);let i="";return r.forEach(s=>{i+=`0x${s<16?"0":""}${s.toString(16)} `}),i.substr(0,i.length-1)}(n)}'`)):typeof n=="string"&&(t=`String data of length ${n.length}`,e&&(t+=`. Content: '${n}'`)),t}function Ae(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}async function Eo(n,e,t,o,r,i){const s={},[d,f]=He();s[d]=f,n.log(E.Trace,`(${e} transport) sending data. ${Xe(r,i.logMessageContent)}.`);const m=Ae(r)?"arraybuffer":"text",S=await t.post(o,{content:r,headers:{...s,...i.headers},responseType:m,timeout:i.timeout,withCredentials:i.withCredentials});n.log(E.Trace,`(${e} transport) request complete. Response status: ${S.statusCode}.`)}class vi{constructor(e,t){this._subject=e,this._observer=t}dispose(){const e=this._subject.observers.indexOf(this._observer);e>-1&&this._subject.observers.splice(e,1),this._subject.observers.length===0&&this._subject.cancelCallback&&this._subject.cancelCallback().catch(t=>{})}}class pt{constructor(e){this._minLevel=e,this.out=console}log(e,t){if(e>=this._minLevel){const o=`[${new Date().toISOString()}] ${E[e]}: ${t}`;switch(e){case E.Critical:case E.Error:this.out.error(o);break;case E.Warning:this.out.warn(o);break;case E.Information:this.out.info(o);break;default:this.out.log(o)}}}}function He(){let n="X-SignalR-User-Agent";return V.isNode&&(n="User-Agent"),[n,yi("8.0.0",wi(),bi(),_i())]}function yi(n,e,t,o){let r="Microsoft SignalR/";const i=n.split(".");return r+=`${i[0]}.${i[1]}`,r+=` (${n}; `,r+=e&&e!==""?`${e}; `:"Unknown OS; ",r+=`${t}`,r+=o?`; ${o}`:"; Unknown Runtime Version",r+=")",r}function wi(){if(!V.isNode)return"";switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}}function _i(){if(V.isNode)return process.versions.node}function bi(){return V.isNode?"NodeJS":"Browser"}function zn(n){return n.stack?n.stack:n.message?n.message:`${n}`}class Si extends mt{constructor(e){super(),this._logger=e;const t={_fetchType:void 0,_jar:void 0};var o;o=t,(typeof fetch>"u"||V.isNode)&&(o._jar=new(require("tough-cookie")).CookieJar,typeof fetch>"u"?o._fetchType=require("node-fetch"):o._fetchType=fetch,o._fetchType=require("fetch-cookie")(o._fetchType,o._jar),1)?(this._fetchType=t._fetchType,this._jar=t._jar):this._fetchType=fetch.bind(function(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("could not find global")}()),this._abortControllerType=AbortController;const r={_abortControllerType:this._abortControllerType};(function(i){return typeof AbortController>"u"&&(i._abortControllerType=require("abort-controller"),!0)})(r)&&(this._abortControllerType=r._abortControllerType)}async send(e){if(e.abortSignal&&e.abortSignal.aborted)throw new me;if(!e.method)throw new Error("No method defined.");if(!e.url)throw new Error("No url defined.");const t=new this._abortControllerType;let o;e.abortSignal&&(e.abortSignal.onabort=()=>{t.abort(),o=new me});let r,i=null;if(e.timeout){const f=e.timeout;i=setTimeout(()=>{t.abort(),this._logger.log(E.Warning,"Timeout from HTTP request."),o=new rn},f)}e.content===""&&(e.content=void 0),e.content&&(e.headers=e.headers||{},Ae(e.content)?e.headers["Content-Type"]="application/octet-stream":e.headers["Content-Type"]="text/plain;charset=UTF-8");try{r=await this._fetchType(e.url,{body:e.content,cache:"no-cache",credentials:e.withCredentials===!0?"include":"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",...e.headers},method:e.method,mode:"cors",redirect:"follow",signal:t.signal})}catch(f){throw o||(this._logger.log(E.Warning,`Error from HTTP request. ${f}.`),f)}finally{i&&clearTimeout(i),e.abortSignal&&(e.abortSignal.onabort=null)}if(!r.ok){const f=await Xn(r,"text");throw new Pe(f||r.statusText,r.status)}const s=Xn(r,e.responseType),d=await s;return new Co(r.status,r.statusText,d)}getCookieString(e){let t="";return V.isNode&&this._jar&&this._jar.getCookies(e,(o,r)=>t=r.join("; ")),t}}function Xn(n,e){let t;switch(e){case"arraybuffer":t=n.arrayBuffer();break;case"text":default:t=n.text();break;case"blob":case"document":case"json":throw new Error(`${e} is not supported.`)}return t}class Ci extends mt{constructor(e){super(),this._logger=e}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new me):e.method?e.url?new Promise((t,o)=>{const r=new XMLHttpRequest;r.open(e.method,e.url,!0),r.withCredentials=e.withCredentials===void 0||e.withCredentials,r.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.content===""&&(e.content=void 0),e.content&&(Ae(e.content)?r.setRequestHeader("Content-Type","application/octet-stream"):r.setRequestHeader("Content-Type","text/plain;charset=UTF-8"));const i=e.headers;i&&Object.keys(i).forEach(s=>{r.setRequestHeader(s,i[s])}),e.responseType&&(r.responseType=e.responseType),e.abortSignal&&(e.abortSignal.onabort=()=>{r.abort(),o(new me)}),e.timeout&&(r.timeout=e.timeout),r.onload=()=>{e.abortSignal&&(e.abortSignal.onabort=null),r.status>=200&&r.status<300?t(new Co(r.status,r.statusText,r.response||r.responseText)):o(new Pe(r.response||r.responseText||r.statusText,r.status))},r.onerror=()=>{this._logger.log(E.Warning,`Error from HTTP request. ${r.status}: ${r.statusText}.`),o(new Pe(r.statusText,r.status))},r.ontimeout=()=>{this._logger.log(E.Warning,"Timeout from HTTP request."),o(new rn)},r.send(e.content)}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}}class Ei extends mt{constructor(e){if(super(),typeof fetch<"u"||V.isNode)this._httpClient=new Si(e);else{if(typeof XMLHttpRequest>"u")throw new Error("No usable HttpClient found.");this._httpClient=new Ci(e)}}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new me):e.method?e.url?this._httpClient.send(e):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(e){return this._httpClient.getCookieString(e)}}class fe{static write(e){return`${e}${fe.RecordSeparator}`}static parse(e){if(e[e.length-1]!==fe.RecordSeparator)throw new Error("Message is incomplete.");const t=e.split(fe.RecordSeparator);return t.pop(),t}}fe.RecordSeparatorCode=30,fe.RecordSeparator=String.fromCharCode(fe.RecordSeparatorCode);class ki{writeHandshakeRequest(e){return fe.write(JSON.stringify(e))}parseHandshakeResponse(e){let t,o;if(Ae(e)){const s=new Uint8Array(e),d=s.indexOf(fe.RecordSeparatorCode);if(d===-1)throw new Error("Message is incomplete.");const f=d+1;t=String.fromCharCode.apply(null,Array.prototype.slice.call(s.slice(0,f))),o=s.byteLength>f?s.slice(f).buffer:null}else{const s=e,d=s.indexOf(fe.RecordSeparator);if(d===-1)throw new Error("Message is incomplete.");const f=d+1;t=s.substring(0,f),o=s.length>f?s.substring(f):null}const r=fe.parse(t),i=JSON.parse(r[0]);if(i.type)throw new Error("Expected a handshake response from the server.");return[o,i]}}var U;(function(n){n[n.Invocation=1]="Invocation",n[n.StreamItem=2]="StreamItem",n[n.Completion=3]="Completion",n[n.StreamInvocation=4]="StreamInvocation",n[n.CancelInvocation=5]="CancelInvocation",n[n.Ping=6]="Ping",n[n.Close=7]="Close",n[n.Ack=8]="Ack",n[n.Sequence=9]="Sequence"})(U||(U={}));class Ii{constructor(){this.observers=[]}next(e){for(const t of this.observers)t.next(e)}error(e){for(const t of this.observers)t.error&&t.error(e)}complete(){for(const e of this.observers)e.complete&&e.complete()}subscribe(e){return this.observers.push(e),new vi(this,e)}}class xi{constructor(e,t,o){this._bufferSize=1e5,this._messages=[],this._totalMessageCount=0,this._waitForSequenceMessage=!1,this._nextReceivingSequenceId=1,this._latestReceivedSequenceId=0,this._bufferedByteCount=0,this._reconnectInProgress=!1,this._protocol=e,this._connection=t,this._bufferSize=o}async _send(e){const t=this._protocol.writeMessage(e);let o=Promise.resolve();if(this._isInvocationMessage(e)){this._totalMessageCount++;let r=()=>{},i=()=>{};Ae(t)?this._bufferedByteCount+=t.byteLength:this._bufferedByteCount+=t.length,this._bufferedByteCount>=this._bufferSize&&(o=new Promise((s,d)=>{r=s,i=d})),this._messages.push(new Ti(t,this._totalMessageCount,r,i))}try{this._reconnectInProgress||await this._connection.send(t)}catch{this._disconnected()}await o}_ack(e){let t=-1;for(let o=0;o<this._messages.length;o++){const r=this._messages[o];if(r._id<=e.sequenceId)t=o,Ae(r._message)?this._bufferedByteCount-=r._message.byteLength:this._bufferedByteCount-=r._message.length,r._resolver();else{if(!(this._bufferedByteCount<this._bufferSize))break;r._resolver()}}t!==-1&&(this._messages=this._messages.slice(t+1))}_shouldProcessMessage(e){if(this._waitForSequenceMessage)return e.type===U.Sequence&&(this._waitForSequenceMessage=!1,!0);if(!this._isInvocationMessage(e))return!0;const t=this._nextReceivingSequenceId;return this._nextReceivingSequenceId++,t<=this._latestReceivedSequenceId?(t===this._latestReceivedSequenceId&&this._ackTimer(),!1):(this._latestReceivedSequenceId=t,this._ackTimer(),!0)}_resetSequence(e){e.sequenceId>this._nextReceivingSequenceId?this._connection.stop(new Error("Sequence ID greater than amount of messages we've received.")):this._nextReceivingSequenceId=e.sequenceId}_disconnected(){this._reconnectInProgress=!0,this._waitForSequenceMessage=!0}async _resend(){const e=this._messages.length!==0?this._messages[0]._id:this._totalMessageCount+1;await this._connection.send(this._protocol.writeMessage({type:U.Sequence,sequenceId:e}));const t=this._messages;for(const o of t)await this._connection.send(o._message);this._reconnectInProgress=!1}_dispose(e){e!=null||(e=new Error("Unable to reconnect to server."));for(const t of this._messages)t._rejector(e)}_isInvocationMessage(e){switch(e.type){case U.Invocation:case U.StreamItem:case U.Completion:case U.StreamInvocation:case U.CancelInvocation:return!0;case U.Close:case U.Sequence:case U.Ping:case U.Ack:return!1}}_ackTimer(){this._ackTimerHandle===void 0&&(this._ackTimerHandle=setTimeout(async()=>{try{this._reconnectInProgress||await this._connection.send(this._protocol.writeMessage({type:U.Ack,sequenceId:this._latestReceivedSequenceId}))}catch{}clearTimeout(this._ackTimerHandle),this._ackTimerHandle=void 0},1e3))}}class Ti{constructor(e,t,o,r){this._message=e,this._id=t,this._resolver=o,this._rejector=r}}var K;(function(n){n.Disconnected="Disconnected",n.Connecting="Connecting",n.Connected="Connected",n.Disconnecting="Disconnecting",n.Reconnecting="Reconnecting"})(K||(K={}));class sn{static create(e,t,o,r,i,s,d){return new sn(e,t,o,r,i,s,d)}constructor(e,t,o,r,i,s,d){this._nextKeepAlive=0,this._freezeEventListener=()=>{this._logger.log(E.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://learn.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},J.isRequired(e,"connection"),J.isRequired(t,"logger"),J.isRequired(o,"protocol"),this.serverTimeoutInMilliseconds=i!=null?i:3e4,this.keepAliveIntervalInMilliseconds=s!=null?s:15e3,this._statefulReconnectBufferSize=d!=null?d:1e5,this._logger=t,this._protocol=o,this.connection=e,this._reconnectPolicy=r,this._handshakeProtocol=new ki,this.connection.onreceive=f=>this._processIncomingData(f),this.connection.onclose=f=>this._connectionClosed(f),this._callbacks={},this._methods={},this._closedCallbacks=[],this._reconnectingCallbacks=[],this._reconnectedCallbacks=[],this._invocationId=0,this._receivedHandshakeResponse=!1,this._connectionState=K.Disconnected,this._connectionStarted=!1,this._cachedPingMessage=this._protocol.writeMessage({type:U.Ping})}get state(){return this._connectionState}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(e){if(this._connectionState!==K.Disconnected&&this._connectionState!==K.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!e)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=e}start(){return this._startPromise=this._startWithStateTransitions(),this._startPromise}async _startWithStateTransitions(){if(this._connectionState!==K.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));this._connectionState=K.Connecting,this._logger.log(E.Debug,"Starting HubConnection.");try{await this._startInternal(),V.isBrowser&&window.document.addEventListener("freeze",this._freezeEventListener),this._connectionState=K.Connected,this._connectionStarted=!0,this._logger.log(E.Debug,"HubConnection connected successfully.")}catch(e){return this._connectionState=K.Disconnected,this._logger.log(E.Debug,`HubConnection failed to start successfully because of error '${e}'.`),Promise.reject(e)}}async _startInternal(){this._stopDuringStartError=void 0,this._receivedHandshakeResponse=!1;const e=new Promise((t,o)=>{this._handshakeResolver=t,this._handshakeRejecter=o});await this.connection.start(this._protocol.transferFormat);try{let t=this._protocol.version;this.connection.features.reconnect||(t=1);const o={protocol:this._protocol.name,version:t};if(this._logger.log(E.Debug,"Sending handshake request."),await this._sendMessage(this._handshakeProtocol.writeHandshakeRequest(o)),this._logger.log(E.Information,`Using HubProtocol '${this._protocol.name}'.`),this._cleanupTimeout(),this._resetTimeoutPeriod(),this._resetKeepAliveInterval(),await e,this._stopDuringStartError)throw this._stopDuringStartError;this.connection.features.reconnect&&(this._messageBuffer=new xi(this._protocol,this.connection,this._statefulReconnectBufferSize),this.connection.features.disconnected=this._messageBuffer._disconnected.bind(this._messageBuffer),this.connection.features.resend=()=>{if(this._messageBuffer)return this._messageBuffer._resend()}),this.connection.features.inherentKeepAlive||await this._sendMessage(this._cachedPingMessage)}catch(t){throw this._logger.log(E.Debug,`Hub handshake failed with error '${t}' during start(). Stopping HubConnection.`),this._cleanupTimeout(),this._cleanupPingTimer(),await this.connection.stop(t),t}}async stop(){const e=this._startPromise;this.connection.features.reconnect=!1,this._stopPromise=this._stopInternal(),await this._stopPromise;try{await e}catch{}}_stopInternal(e){if(this._connectionState===K.Disconnected)return this._logger.log(E.Debug,`Call to HubConnection.stop(${e}) ignored because it is already in the disconnected state.`),Promise.resolve();if(this._connectionState===K.Disconnecting)return this._logger.log(E.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;const t=this._connectionState;return this._connectionState=K.Disconnecting,this._logger.log(E.Debug,"Stopping HubConnection."),this._reconnectDelayHandle?(this._logger.log(E.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this._reconnectDelayHandle),this._reconnectDelayHandle=void 0,this._completeClose(),Promise.resolve()):(t===K.Connected&&this._sendCloseMessage(),this._cleanupTimeout(),this._cleanupPingTimer(),this._stopDuringStartError=e||new me("The connection was stopped before the hub handshake could complete."),this.connection.stop(e))}async _sendCloseMessage(){try{await this._sendWithProtocol(this._createCloseMessage())}catch{}}stream(e,...t){const[o,r]=this._replaceStreamingParams(t),i=this._createStreamInvocation(e,t,r);let s;const d=new Ii;return d.cancelCallback=()=>{const f=this._createCancelInvocation(i.invocationId);return delete this._callbacks[i.invocationId],s.then(()=>this._sendWithProtocol(f))},this._callbacks[i.invocationId]=(f,m)=>{m?d.error(m):f&&(f.type===U.Completion?f.error?d.error(new Error(f.error)):d.complete():d.next(f.item))},s=this._sendWithProtocol(i).catch(f=>{d.error(f),delete this._callbacks[i.invocationId]}),this._launchStreams(o,s),d}_sendMessage(e){return this._resetKeepAliveInterval(),this.connection.send(e)}_sendWithProtocol(e){return this._messageBuffer?this._messageBuffer._send(e):this._sendMessage(this._protocol.writeMessage(e))}send(e,...t){const[o,r]=this._replaceStreamingParams(t),i=this._sendWithProtocol(this._createInvocation(e,t,!0,r));return this._launchStreams(o,i),i}invoke(e,...t){const[o,r]=this._replaceStreamingParams(t),i=this._createInvocation(e,t,!1,r);return new Promise((s,d)=>{this._callbacks[i.invocationId]=(m,S)=>{S?d(S):m&&(m.type===U.Completion?m.error?d(new Error(m.error)):s(m.result):d(new Error(`Unexpected message type: ${m.type}`)))};const f=this._sendWithProtocol(i).catch(m=>{d(m),delete this._callbacks[i.invocationId]});this._launchStreams(o,f)})}on(e,t){e&&t&&(e=e.toLowerCase(),this._methods[e]||(this._methods[e]=[]),this._methods[e].indexOf(t)===-1&&this._methods[e].push(t))}off(e,t){if(!e)return;e=e.toLowerCase();const o=this._methods[e];if(o)if(t){const r=o.indexOf(t);r!==-1&&(o.splice(r,1),o.length===0&&delete this._methods[e])}else delete this._methods[e]}onclose(e){e&&this._closedCallbacks.push(e)}onreconnecting(e){e&&this._reconnectingCallbacks.push(e)}onreconnected(e){e&&this._reconnectedCallbacks.push(e)}_processIncomingData(e){if(this._cleanupTimeout(),this._receivedHandshakeResponse||(e=this._processHandshakeResponse(e),this._receivedHandshakeResponse=!0),e){const t=this._protocol.parseMessages(e,this._logger);for(const o of t)if(!this._messageBuffer||this._messageBuffer._shouldProcessMessage(o))switch(o.type){case U.Invocation:this._invokeClientMethod(o);break;case U.StreamItem:case U.Completion:{const r=this._callbacks[o.invocationId];if(r){o.type===U.Completion&&delete this._callbacks[o.invocationId];try{r(o)}catch(i){this._logger.log(E.Error,`Stream callback threw error: ${zn(i)}`)}}break}case U.Ping:break;case U.Close:{this._logger.log(E.Information,"Close message received from server.");const r=o.error?new Error("Server returned an error on close: "+o.error):void 0;o.allowReconnect===!0?this.connection.stop(r):this._stopPromise=this._stopInternal(r);break}case U.Ack:this._messageBuffer&&this._messageBuffer._ack(o);break;case U.Sequence:this._messageBuffer&&this._messageBuffer._resetSequence(o);break;default:this._logger.log(E.Warning,`Invalid message type: ${o.type}.`)}}this._resetTimeoutPeriod()}_processHandshakeResponse(e){let t,o;try{[o,t]=this._handshakeProtocol.parseHandshakeResponse(e)}catch(r){const i="Error parsing handshake response: "+r;this._logger.log(E.Error,i);const s=new Error(i);throw this._handshakeRejecter(s),s}if(t.error){const r="Server returned handshake error: "+t.error;this._logger.log(E.Error,r);const i=new Error(r);throw this._handshakeRejecter(i),i}return this._logger.log(E.Debug,"Server handshake complete."),this._handshakeResolver(),o}_resetKeepAliveInterval(){this.connection.features.inherentKeepAlive||(this._nextKeepAlive=new Date().getTime()+this.keepAliveIntervalInMilliseconds,this._cleanupPingTimer())}_resetTimeoutPeriod(){if(!(this.connection.features&&this.connection.features.inherentKeepAlive||(this._timeoutHandle=setTimeout(()=>this.serverTimeout(),this.serverTimeoutInMilliseconds),this._pingServerHandle!==void 0))){let e=this._nextKeepAlive-new Date().getTime();e<0&&(e=0),this._pingServerHandle=setTimeout(async()=>{if(this._connectionState===K.Connected)try{await this._sendMessage(this._cachedPingMessage)}catch{this._cleanupPingTimer()}},e)}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}async _invokeClientMethod(e){const t=e.target.toLowerCase(),o=this._methods[t];if(!o)return this._logger.log(E.Warning,`No client method with the name '${t}' found.`),void(e.invocationId&&(this._logger.log(E.Warning,`No result given for '${t}' method and invocation ID '${e.invocationId}'.`),await this._sendWithProtocol(this._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null))));const r=o.slice(),i=!!e.invocationId;let s,d,f;for(const m of r)try{const S=s;s=await m.apply(this,e.arguments),i&&s&&S&&(this._logger.log(E.Error,`Multiple results provided for '${t}'. Sending error to server.`),f=this._createCompletionMessage(e.invocationId,"Client provided multiple results.",null)),d=void 0}catch(S){d=S,this._logger.log(E.Error,`A callback for the method '${t}' threw error '${S}'.`)}f?await this._sendWithProtocol(f):i?(d?f=this._createCompletionMessage(e.invocationId,`${d}`,null):s!==void 0?f=this._createCompletionMessage(e.invocationId,null,s):(this._logger.log(E.Warning,`No result given for '${t}' method and invocation ID '${e.invocationId}'.`),f=this._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null)),await this._sendWithProtocol(f)):s&&this._logger.log(E.Error,`Result given for '${t}' method but server is not expecting a result.`)}_connectionClosed(e){this._logger.log(E.Debug,`HubConnection.connectionClosed(${e}) called while in state ${this._connectionState}.`),this._stopDuringStartError=this._stopDuringStartError||e||new me("The underlying connection was closed before the hub handshake could complete."),this._handshakeResolver&&this._handshakeResolver(),this._cancelCallbacksWithError(e||new Error("Invocation canceled due to the underlying connection being closed.")),this._cleanupTimeout(),this._cleanupPingTimer(),this._connectionState===K.Disconnecting?this._completeClose(e):this._connectionState===K.Connected&&this._reconnectPolicy?this._reconnect(e):this._connectionState===K.Connected&&this._completeClose(e)}_completeClose(e){if(this._connectionStarted){this._connectionState=K.Disconnected,this._connectionStarted=!1,this._messageBuffer&&(this._messageBuffer._dispose(e!=null?e:new Error("Connection closed.")),this._messageBuffer=void 0),V.isBrowser&&window.document.removeEventListener("freeze",this._freezeEventListener);try{this._closedCallbacks.forEach(t=>t.apply(this,[e]))}catch(t){this._logger.log(E.Error,`An onclose callback called with error '${e}' threw error '${t}'.`)}}}async _reconnect(e){const t=Date.now();let o=0,r=e!==void 0?e:new Error("Attempting to reconnect due to a unknown error."),i=this._getNextRetryDelay(o++,0,r);if(i===null)return this._logger.log(E.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),void this._completeClose(e);if(this._connectionState=K.Reconnecting,e?this._logger.log(E.Information,`Connection reconnecting because of error '${e}'.`):this._logger.log(E.Information,"Connection reconnecting."),this._reconnectingCallbacks.length!==0){try{this._reconnectingCallbacks.forEach(s=>s.apply(this,[e]))}catch(s){this._logger.log(E.Error,`An onreconnecting callback called with error '${e}' threw error '${s}'.`)}if(this._connectionState!==K.Reconnecting)return void this._logger.log(E.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.")}for(;i!==null;){if(this._logger.log(E.Information,`Reconnect attempt number ${o} will start in ${i} ms.`),await new Promise(s=>{this._reconnectDelayHandle=setTimeout(s,i)}),this._reconnectDelayHandle=void 0,this._connectionState!==K.Reconnecting)return void this._logger.log(E.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");try{if(await this._startInternal(),this._connectionState=K.Connected,this._logger.log(E.Information,"HubConnection reconnected successfully."),this._reconnectedCallbacks.length!==0)try{this._reconnectedCallbacks.forEach(s=>s.apply(this,[this.connection.connectionId]))}catch(s){this._logger.log(E.Error,`An onreconnected callback called with connectionId '${this.connection.connectionId}; threw error '${s}'.`)}return}catch(s){if(this._logger.log(E.Information,`Reconnect attempt failed because of error '${s}'.`),this._connectionState!==K.Reconnecting)return this._logger.log(E.Debug,`Connection moved to the '${this._connectionState}' from the reconnecting state during reconnect attempt. Done reconnecting.`),void(this._connectionState===K.Disconnecting&&this._completeClose());r=s instanceof Error?s:new Error(s.toString()),i=this._getNextRetryDelay(o++,Date.now()-t,r)}}this._logger.log(E.Information,`Reconnect retries have been exhausted after ${Date.now()-t} ms and ${o} failed attempts. Connection disconnecting.`),this._completeClose()}_getNextRetryDelay(e,t,o){try{return this._reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:t,previousRetryCount:e,retryReason:o})}catch(r){return this._logger.log(E.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${e}, ${t}) threw error '${r}'.`),null}}_cancelCallbacksWithError(e){const t=this._callbacks;this._callbacks={},Object.keys(t).forEach(o=>{const r=t[o];try{r(null,e)}catch(i){this._logger.log(E.Error,`Stream 'error' callback called with '${e}' threw error: ${zn(i)}`)}})}_cleanupPingTimer(){this._pingServerHandle&&(clearTimeout(this._pingServerHandle),this._pingServerHandle=void 0)}_cleanupTimeout(){this._timeoutHandle&&clearTimeout(this._timeoutHandle)}_createInvocation(e,t,o,r){if(o)return r.length!==0?{arguments:t,streamIds:r,target:e,type:U.Invocation}:{arguments:t,target:e,type:U.Invocation};{const i=this._invocationId;return this._invocationId++,r.length!==0?{arguments:t,invocationId:i.toString(),streamIds:r,target:e,type:U.Invocation}:{arguments:t,invocationId:i.toString(),target:e,type:U.Invocation}}}_launchStreams(e,t){if(e.length!==0){t||(t=Promise.resolve());for(const o in e)e[o].subscribe({complete:()=>{t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(o)))},error:r=>{let i;i=r instanceof Error?r.message:r&&r.toString?r.toString():"Unknown error",t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(o,i)))},next:r=>{t=t.then(()=>this._sendWithProtocol(this._createStreamItemMessage(o,r)))}})}}_replaceStreamingParams(e){const t=[],o=[];for(let r=0;r<e.length;r++){const i=e[r];if(this._isObservable(i)){const s=this._invocationId;this._invocationId++,t[s]=i,o.push(s.toString()),e.splice(r,1)}}return[t,o]}_isObservable(e){return e&&e.subscribe&&typeof e.subscribe=="function"}_createStreamInvocation(e,t,o){const r=this._invocationId;return this._invocationId++,o.length!==0?{arguments:t,invocationId:r.toString(),streamIds:o,target:e,type:U.StreamInvocation}:{arguments:t,invocationId:r.toString(),target:e,type:U.StreamInvocation}}_createCancelInvocation(e){return{invocationId:e,type:U.CancelInvocation}}_createStreamItemMessage(e,t){return{invocationId:e,item:t,type:U.StreamItem}}_createCompletionMessage(e,t,o){return t?{error:t,invocationId:e,type:U.Completion}:{invocationId:e,result:o,type:U.Completion}}_createCloseMessage(){return{type:U.Close}}}const Ri=[0,2e3,1e4,3e4,null];class Gn{constructor(e){this._retryDelays=e!==void 0?[...e,null]:Ri}nextRetryDelayInMilliseconds(e){return this._retryDelays[e.previousRetryCount]}}class Me{}Me.Authorization="Authorization",Me.Cookie="Cookie";class Pi extends mt{constructor(e,t){super(),this._innerClient=e,this._accessTokenFactory=t}async send(e){let t=!0;this._accessTokenFactory&&(!this._accessToken||e.url&&e.url.indexOf("/negotiate?")>0)&&(t=!1,this._accessToken=await this._accessTokenFactory()),this._setAuthorizationHeader(e);const o=await this._innerClient.send(e);return t&&o.statusCode===401&&this._accessTokenFactory?(this._accessToken=await this._accessTokenFactory(),this._setAuthorizationHeader(e),await this._innerClient.send(e)):o}_setAuthorizationHeader(e){e.headers||(e.headers={}),this._accessToken?e.headers[Me.Authorization]=`Bearer ${this._accessToken}`:this._accessTokenFactory&&e.headers[Me.Authorization]&&delete e.headers[Me.Authorization]}getCookieString(e){return this._innerClient.getCookieString(e)}}var Y,ne;(function(n){n[n.None=0]="None",n[n.WebSockets=1]="WebSockets",n[n.ServerSentEvents=2]="ServerSentEvents",n[n.LongPolling=4]="LongPolling"})(Y||(Y={})),function(n){n[n.Text=1]="Text",n[n.Binary=2]="Binary"}(ne||(ne={}));class Mi{constructor(){this._isAborted=!1,this.onabort=null}abort(){this._isAborted||(this._isAborted=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this._isAborted}}class Kn{get pollAborted(){return this._pollAbort.aborted}constructor(e,t,o){this._httpClient=e,this._logger=t,this._pollAbort=new Mi,this._options=o,this._running=!1,this.onreceive=null,this.onclose=null}async connect(e,t){if(J.isRequired(e,"url"),J.isRequired(t,"transferFormat"),J.isIn(t,ne,"transferFormat"),this._url=e,this._logger.log(E.Trace,"(LongPolling transport) Connecting."),t===ne.Binary&&typeof XMLHttpRequest<"u"&&typeof new XMLHttpRequest().responseType!="string")throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");const[o,r]=He(),i={[o]:r,...this._options.headers},s={abortSignal:this._pollAbort.signal,headers:i,timeout:1e5,withCredentials:this._options.withCredentials};t===ne.Binary&&(s.responseType="arraybuffer");const d=`${e}&_=${Date.now()}`;this._logger.log(E.Trace,`(LongPolling transport) polling: ${d}.`);const f=await this._httpClient.get(d,s);f.statusCode!==200?(this._logger.log(E.Error,`(LongPolling transport) Unexpected response code: ${f.statusCode}.`),this._closeError=new Pe(f.statusText||"",f.statusCode),this._running=!1):this._running=!0,this._receiving=this._poll(this._url,s)}async _poll(e,t){try{for(;this._running;)try{const o=`${e}&_=${Date.now()}`;this._logger.log(E.Trace,`(LongPolling transport) polling: ${o}.`);const r=await this._httpClient.get(o,t);r.statusCode===204?(this._logger.log(E.Information,"(LongPolling transport) Poll terminated by server."),this._running=!1):r.statusCode!==200?(this._logger.log(E.Error,`(LongPolling transport) Unexpected response code: ${r.statusCode}.`),this._closeError=new Pe(r.statusText||"",r.statusCode),this._running=!1):r.content?(this._logger.log(E.Trace,`(LongPolling transport) data received. ${Xe(r.content,this._options.logMessageContent)}.`),this.onreceive&&this.onreceive(r.content)):this._logger.log(E.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(o){this._running?o instanceof rn?this._logger.log(E.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this._closeError=o,this._running=!1):this._logger.log(E.Trace,`(LongPolling transport) Poll errored after shutdown: ${o.message}`)}}finally{this._logger.log(E.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this._raiseOnClose()}}async send(e){return this._running?Eo(this._logger,"LongPolling",this._httpClient,this._url,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}async stop(){this._logger.log(E.Trace,"(LongPolling transport) Stopping polling."),this._running=!1,this._pollAbort.abort();try{await this._receiving,this._logger.log(E.Trace,`(LongPolling transport) sending DELETE request to ${this._url}.`);const e={},[t,o]=He();e[t]=o;const r={headers:{...e,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials};let i;try{await this._httpClient.delete(this._url,r)}catch(s){i=s}i?i instanceof Pe&&(i.statusCode===404?this._logger.log(E.Trace,"(LongPolling transport) A 404 response was returned from sending a DELETE request."):this._logger.log(E.Trace,`(LongPolling transport) Error sending a DELETE request: ${i}`)):this._logger.log(E.Trace,"(LongPolling transport) DELETE request accepted.")}finally{this._logger.log(E.Trace,"(LongPolling transport) Stop finished."),this._raiseOnClose()}}_raiseOnClose(){if(this.onclose){let e="(LongPolling transport) Firing onclose event.";this._closeError&&(e+=" Error: "+this._closeError),this._logger.log(E.Trace,e),this.onclose(this._closeError)}}}class Li{constructor(e,t,o,r){this._httpClient=e,this._accessToken=t,this._logger=o,this._options=r,this.onreceive=null,this.onclose=null}async connect(e,t){return J.isRequired(e,"url"),J.isRequired(t,"transferFormat"),J.isIn(t,ne,"transferFormat"),this._logger.log(E.Trace,"(SSE transport) Connecting."),this._url=e,this._accessToken&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(this._accessToken)}`),new Promise((o,r)=>{let i,s=!1;if(t===ne.Text){if(V.isBrowser||V.isWebWorker)i=new this._options.EventSource(e,{withCredentials:this._options.withCredentials});else{const d=this._httpClient.getCookieString(e),f={};f.Cookie=d;const[m,S]=He();f[m]=S,i=new this._options.EventSource(e,{withCredentials:this._options.withCredentials,headers:{...f,...this._options.headers}})}try{i.onmessage=d=>{if(this.onreceive)try{this._logger.log(E.Trace,`(SSE transport) data received. ${Xe(d.data,this._options.logMessageContent)}.`),this.onreceive(d.data)}catch(f){return void this._close(f)}},i.onerror=d=>{s?this._close():r(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},i.onopen=()=>{this._logger.log(E.Information,`SSE connected to ${this._url}`),this._eventSource=i,s=!0,o()}}catch(d){return void r(d)}}else r(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"))})}async send(e){return this._eventSource?Eo(this._logger,"SSE",this._httpClient,this._url,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}stop(){return this._close(),Promise.resolve()}_close(e){this._eventSource&&(this._eventSource.close(),this._eventSource=void 0,this.onclose&&this.onclose(e))}}class Ai{constructor(e,t,o,r,i,s){this._logger=o,this._accessTokenFactory=t,this._logMessageContent=r,this._webSocketConstructor=i,this._httpClient=e,this.onreceive=null,this.onclose=null,this._headers=s}async connect(e,t){let o;return J.isRequired(e,"url"),J.isRequired(t,"transferFormat"),J.isIn(t,ne,"transferFormat"),this._logger.log(E.Trace,"(WebSockets transport) Connecting."),this._accessTokenFactory&&(o=await this._accessTokenFactory()),new Promise((r,i)=>{let s;e=e.replace(/^http/,"ws");const d=this._httpClient.getCookieString(e);let f=!1;if(V.isNode||V.isReactNative){const m={},[S,k]=He();m[S]=k,o&&(m[Me.Authorization]=`Bearer ${o}`),d&&(m[Me.Cookie]=d),s=new this._webSocketConstructor(e,void 0,{headers:{...m,...this._headers}})}else o&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(o)}`);s||(s=new this._webSocketConstructor(e)),t===ne.Binary&&(s.binaryType="arraybuffer"),s.onopen=m=>{this._logger.log(E.Information,`WebSocket connected to ${e}.`),this._webSocket=s,f=!0,r()},s.onerror=m=>{let S=null;S=typeof ErrorEvent<"u"&&m instanceof ErrorEvent?m.error:"There was an error with the transport",this._logger.log(E.Information,`(WebSockets transport) ${S}.`)},s.onmessage=m=>{if(this._logger.log(E.Trace,`(WebSockets transport) data received. ${Xe(m.data,this._logMessageContent)}.`),this.onreceive)try{this.onreceive(m.data)}catch(S){return void this._close(S)}},s.onclose=m=>{if(f)this._close(m);else{let S=null;S=typeof ErrorEvent<"u"&&m instanceof ErrorEvent?m.error:"WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",i(new Error(S))}}})}send(e){return this._webSocket&&this._webSocket.readyState===this._webSocketConstructor.OPEN?(this._logger.log(E.Trace,`(WebSockets transport) sending data. ${Xe(e,this._logMessageContent)}.`),this._webSocket.send(e),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this._webSocket&&this._close(void 0),Promise.resolve()}_close(e){this._webSocket&&(this._webSocket.onclose=()=>{},this._webSocket.onmessage=()=>{},this._webSocket.onerror=()=>{},this._webSocket.close(),this._webSocket=void 0),this._logger.log(E.Trace,"(WebSockets transport) socket closed."),this.onclose&&(!this._isCloseEvent(e)||e.wasClean!==!1&&e.code===1e3?e instanceof Error?this.onclose(e):this.onclose():this.onclose(new Error(`WebSocket closed with status code: ${e.code} (${e.reason||"no reason given"}).`)))}_isCloseEvent(e){return e&&typeof e.wasClean=="boolean"&&typeof e.code=="number"}}class Di{constructor(e,t={}){var o;if(this._stopPromiseResolver=()=>{},this.features={},this._negotiateVersion=1,J.isRequired(e,"url"),this._logger=(o=t.logger)===void 0?new pt(E.Information):o===null?ze.instance:o.log!==void 0?o:new pt(o),this.baseUrl=this._resolveUrl(e),(t=t||{}).logMessageContent=t.logMessageContent!==void 0&&t.logMessageContent,typeof t.withCredentials!="boolean"&&t.withCredentials!==void 0)throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");t.withCredentials=t.withCredentials===void 0||t.withCredentials,t.timeout=t.timeout===void 0?1e5:t.timeout;let r=null,i=null;V.isNode&&typeof require<"u"&&(r=require("ws"),i=require("eventsource")),V.isNode||typeof WebSocket>"u"||t.WebSocket?V.isNode&&!t.WebSocket&&r&&(t.WebSocket=r):t.WebSocket=WebSocket,V.isNode||typeof EventSource>"u"||t.EventSource?V.isNode&&!t.EventSource&&i!==void 0&&(t.EventSource=i):t.EventSource=EventSource,this._httpClient=new Pi(t.httpClient||new Ei(this._logger),t.accessTokenFactory),this._connectionState="Disconnected",this._connectionStarted=!1,this._options=t,this.onreceive=null,this.onclose=null}async start(e){if(e=e||ne.Binary,J.isIn(e,ne,"transferFormat"),this._logger.log(E.Debug,`Starting connection with transfer format '${ne[e]}'.`),this._connectionState!=="Disconnected")return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(this._connectionState="Connecting",this._startInternalPromise=this._startInternal(e),await this._startInternalPromise,this._connectionState==="Disconnecting"){const t="Failed to start the HttpConnection before stop() was called.";return this._logger.log(E.Error,t),await this._stopPromise,Promise.reject(new me(t))}if(this._connectionState!=="Connected"){const t="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return this._logger.log(E.Error,t),Promise.reject(new me(t))}this._connectionStarted=!0}send(e){return this._connectionState!=="Connected"?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this._sendQueue||(this._sendQueue=new an(this.transport)),this._sendQueue.send(e))}async stop(e){return this._connectionState==="Disconnected"?(this._logger.log(E.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnected state.`),Promise.resolve()):this._connectionState==="Disconnecting"?(this._logger.log(E.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise):(this._connectionState="Disconnecting",this._stopPromise=new Promise(t=>{this._stopPromiseResolver=t}),await this._stopInternal(e),void await this._stopPromise)}async _stopInternal(e){this._stopError=e;try{await this._startInternalPromise}catch{}if(this.transport){try{await this.transport.stop()}catch(t){this._logger.log(E.Error,`HttpConnection.transport.stop() threw error '${t}'.`),this._stopConnection()}this.transport=void 0}else this._logger.log(E.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")}async _startInternal(e){let t=this.baseUrl;this._accessTokenFactory=this._options.accessTokenFactory,this._httpClient._accessTokenFactory=this._accessTokenFactory;try{if(this._options.skipNegotiation){if(this._options.transport!==Y.WebSockets)throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");this.transport=this._constructTransport(Y.WebSockets),await this._startTransport(t,e)}else{let o=null,r=0;do{if(o=await this._getNegotiationResponse(t),this._connectionState==="Disconnecting"||this._connectionState==="Disconnected")throw new me("The connection was stopped during negotiation.");if(o.error)throw new Error(o.error);if(o.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(o.url&&(t=o.url),o.accessToken){const i=o.accessToken;this._accessTokenFactory=()=>i,this._httpClient._accessToken=i,this._httpClient._accessTokenFactory=void 0}r++}while(o.url&&r<100);if(r===100&&o.url)throw new Error("Negotiate redirection limit exceeded.");await this._createTransport(t,this._options.transport,o,e)}this.transport instanceof Kn&&(this.features.inherentKeepAlive=!0),this._connectionState==="Connecting"&&(this._logger.log(E.Debug,"The HttpConnection connected successfully."),this._connectionState="Connected")}catch(o){return this._logger.log(E.Error,"Failed to start the connection: "+o),this._connectionState="Disconnected",this.transport=void 0,this._stopPromiseResolver(),Promise.reject(o)}}async _getNegotiationResponse(e){const t={},[o,r]=He();t[o]=r;const i=this._resolveNegotiateUrl(e);this._logger.log(E.Debug,`Sending negotiation request: ${i}.`);try{const s=await this._httpClient.post(i,{content:"",headers:{...t,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials});if(s.statusCode!==200)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${s.statusCode}'`));const d=JSON.parse(s.content);return(!d.negotiateVersion||d.negotiateVersion<1)&&(d.connectionToken=d.connectionId),d.useStatefulReconnect&&this._options._useStatefulReconnect!==!0?Promise.reject(new Fn("Client didn't negotiate Stateful Reconnect but the server did.")):d}catch(s){let d="Failed to complete negotiation with the server: "+s;return s instanceof Pe&&s.statusCode===404&&(d+=" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),this._logger.log(E.Error,d),Promise.reject(new Fn(d))}}_createConnectUrl(e,t){return t?e+(e.indexOf("?")===-1?"?":"&")+`id=${t}`:e}async _createTransport(e,t,o,r){let i=this._createConnectUrl(e,o.connectionToken);if(this._isITransport(t))return this._logger.log(E.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=t,await this._startTransport(i,r),void(this.connectionId=o.connectionId);const s=[],d=o.availableTransports||[];let f=o;for(const m of d){const S=this._resolveTransportOrError(m,t,r,(f==null?void 0:f.useStatefulReconnect)===!0);if(S instanceof Error)s.push(`${m.transport} failed:`),s.push(S);else if(this._isITransport(S)){if(this.transport=S,!f){try{f=await this._getNegotiationResponse(e)}catch(k){return Promise.reject(k)}i=this._createConnectUrl(e,f.connectionToken)}try{return await this._startTransport(i,r),void(this.connectionId=f.connectionId)}catch(k){if(this._logger.log(E.Error,`Failed to start the transport '${m.transport}': ${k}`),f=void 0,s.push(new gi(`${m.transport} failed: ${k}`,Y[m.transport])),this._connectionState!=="Connecting"){const D="Failed to select transport before stop() was called.";return this._logger.log(E.Debug,D),Promise.reject(new me(D))}}}}return s.length>0?Promise.reject(new mi(`Unable to connect to the server with any of the available transports. ${s.join(" ")}`,s)):Promise.reject(new Error("None of the transports supported by the client are supported by the server."))}_constructTransport(e){switch(e){case Y.WebSockets:if(!this._options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new Ai(this._httpClient,this._accessTokenFactory,this._logger,this._options.logMessageContent,this._options.WebSocket,this._options.headers||{});case Y.ServerSentEvents:if(!this._options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new Li(this._httpClient,this._httpClient._accessToken,this._logger,this._options);case Y.LongPolling:return new Kn(this._httpClient,this._logger,this._options);default:throw new Error(`Unknown transport: ${e}.`)}}_startTransport(e,t){return this.transport.onreceive=this.onreceive,this.features.reconnect?this.transport.onclose=async o=>{let r=!1;if(this.features.reconnect){try{this.features.disconnected(),await this.transport.connect(e,t),await this.features.resend()}catch{r=!0}r&&this._stopConnection(o)}else this._stopConnection(o)}:this.transport.onclose=o=>this._stopConnection(o),this.transport.connect(e,t)}_resolveTransportOrError(e,t,o,r){const i=Y[e.transport];if(i==null)return this._logger.log(E.Debug,`Skipping transport '${e.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${e.transport}' because it is not supported by this client.`);if(!function(s,d){return!s||(d&s)!=0}(t,i))return this._logger.log(E.Debug,`Skipping transport '${Y[i]}' because it was disabled by the client.`),new pi(`'${Y[i]}' is disabled by the client.`,i);{if(!(e.transferFormats.map(s=>ne[s]).indexOf(o)>=0))return this._logger.log(E.Debug,`Skipping transport '${Y[i]}' because it does not support the requested transfer format '${ne[o]}'.`),new Error(`'${Y[i]}' does not support ${ne[o]}.`);if(i===Y.WebSockets&&!this._options.WebSocket||i===Y.ServerSentEvents&&!this._options.EventSource)return this._logger.log(E.Debug,`Skipping transport '${Y[i]}' because it is not supported in your environment.'`),new fi(`'${Y[i]}' is not supported in your environment.`,i);this._logger.log(E.Debug,`Selecting transport '${Y[i]}'.`);try{return this.features.reconnect=i===Y.WebSockets?r:void 0,this._constructTransport(i)}catch(s){return s}}}_isITransport(e){return e&&typeof e=="object"&&"connect"in e}_stopConnection(e){if(this._logger.log(E.Debug,`HttpConnection.stopConnection(${e}) called while in state ${this._connectionState}.`),this.transport=void 0,e=this._stopError||e,this._stopError=void 0,this._connectionState!=="Disconnected"){if(this._connectionState==="Connecting")throw this._logger.log(E.Warning,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${e}) was called while the connection is still in the connecting state.`);if(this._connectionState==="Disconnecting"&&this._stopPromiseResolver(),e?this._logger.log(E.Error,`Connection disconnected with error '${e}'.`):this._logger.log(E.Information,"Connection disconnected."),this._sendQueue&&(this._sendQueue.stop().catch(t=>{this._logger.log(E.Error,`TransportSendQueue.stop() threw error '${t}'.`)}),this._sendQueue=void 0),this.connectionId=void 0,this._connectionState="Disconnected",this._connectionStarted){this._connectionStarted=!1;try{this.onclose&&this.onclose(e)}catch(t){this._logger.log(E.Error,`HttpConnection.onclose(${e}) threw error '${t}'.`)}}}else this._logger.log(E.Debug,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is already in the disconnected state.`)}_resolveUrl(e){if(e.lastIndexOf("https://",0)===0||e.lastIndexOf("http://",0)===0)return e;if(!V.isBrowser)throw new Error(`Cannot resolve '${e}'.`);const t=window.document.createElement("a");return t.href=e,this._logger.log(E.Information,`Normalizing '${e}' to '${t.href}'.`),t.href}_resolveNegotiateUrl(e){const t=new URL(e);t.pathname.endsWith("/")?t.pathname+="negotiate":t.pathname+="/negotiate";const o=new URLSearchParams(t.searchParams);return o.has("negotiateVersion")||o.append("negotiateVersion",this._negotiateVersion.toString()),o.has("useStatefulReconnect")?o.get("useStatefulReconnect")==="true"&&(this._options._useStatefulReconnect=!0):this._options._useStatefulReconnect===!0&&o.append("useStatefulReconnect","true"),t.search=o.toString(),t.toString()}}class an{constructor(e){this._transport=e,this._buffer=[],this._executing=!0,this._sendBufferedData=new Qe,this._transportResult=new Qe,this._sendLoopPromise=this._sendLoop()}send(e){return this._bufferData(e),this._transportResult||(this._transportResult=new Qe),this._transportResult.promise}stop(){return this._executing=!1,this._sendBufferedData.resolve(),this._sendLoopPromise}_bufferData(e){if(this._buffer.length&&typeof this._buffer[0]!=typeof e)throw new Error(`Expected data to be of type ${typeof this._buffer} but was of type ${typeof e}`);this._buffer.push(e),this._sendBufferedData.resolve()}async _sendLoop(){for(;;){if(await this._sendBufferedData.promise,!this._executing){this._transportResult&&this._transportResult.reject("Connection stopped.");break}this._sendBufferedData=new Qe;const e=this._transportResult;this._transportResult=void 0;const t=typeof this._buffer[0]=="string"?this._buffer.join(""):an._concatBuffers(this._buffer);this._buffer.length=0;try{await this._transport.send(t),e.resolve()}catch(o){e.reject(o)}}}static _concatBuffers(e){const t=e.map(i=>i.byteLength).reduce((i,s)=>i+s),o=new Uint8Array(t);let r=0;for(const i of e)o.set(new Uint8Array(i),r),r+=i.byteLength;return o.buffer}}class Qe{constructor(){this.promise=new Promise((e,t)=>[this._resolver,this._rejecter]=[e,t])}resolve(){this._resolver()}reject(e){this._rejecter(e)}}class Bi{constructor(){this.name="json",this.version=2,this.transferFormat=ne.Text}parseMessages(e,t){if(typeof e!="string")throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!e)return[];t===null&&(t=ze.instance);const o=fe.parse(e),r=[];for(const i of o){const s=JSON.parse(i);if(typeof s.type!="number")throw new Error("Invalid payload.");switch(s.type){case U.Invocation:this._isInvocationMessage(s);break;case U.StreamItem:this._isStreamItemMessage(s);break;case U.Completion:this._isCompletionMessage(s);break;case U.Ping:case U.Close:break;case U.Ack:this._isAckMessage(s);break;case U.Sequence:this._isSequenceMessage(s);break;default:t.log(E.Information,"Unknown message type '"+s.type+"' ignored.");continue}r.push(s)}return r}writeMessage(e){return fe.write(JSON.stringify(e))}_isInvocationMessage(e){this._assertNotEmptyString(e.target,"Invalid payload for Invocation message."),e.invocationId!==void 0&&this._assertNotEmptyString(e.invocationId,"Invalid payload for Invocation message.")}_isStreamItemMessage(e){if(this._assertNotEmptyString(e.invocationId,"Invalid payload for StreamItem message."),e.item===void 0)throw new Error("Invalid payload for StreamItem message.")}_isCompletionMessage(e){if(e.result&&e.error)throw new Error("Invalid payload for Completion message.");!e.result&&e.error&&this._assertNotEmptyString(e.error,"Invalid payload for Completion message."),this._assertNotEmptyString(e.invocationId,"Invalid payload for Completion message.")}_isAckMessage(e){if(typeof e.sequenceId!="number")throw new Error("Invalid SequenceId for Ack message.")}_isSequenceMessage(e){if(typeof e.sequenceId!="number")throw new Error("Invalid SequenceId for Sequence message.")}_assertNotEmptyString(e,t){if(typeof e!="string"||e==="")throw new Error(t)}}const $i={trace:E.Trace,debug:E.Debug,info:E.Information,information:E.Information,warn:E.Warning,warning:E.Warning,error:E.Error,critical:E.Critical,none:E.None};class Ni{configureLogging(e){if(J.isRequired(e,"logging"),e.log!==void 0)this.logger=e;else if(typeof e=="string"){const t=function(o){const r=$i[o.toLowerCase()];if(r!==void 0)return r;throw new Error(`Unknown log level: ${o}`)}(e);this.logger=new pt(t)}else this.logger=new pt(e);return this}withUrl(e,t){return J.isRequired(e,"url"),J.isNotEmpty(e,"url"),this.url=e,this.httpConnectionOptions=typeof t=="object"?{...this.httpConnectionOptions,...t}:{...this.httpConnectionOptions,transport:t},this}withHubProtocol(e){return J.isRequired(e,"protocol"),this.protocol=e,this}withAutomaticReconnect(e){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return e?Array.isArray(e)?this.reconnectPolicy=new Gn(e):this.reconnectPolicy=e:this.reconnectPolicy=new Gn,this}withServerTimeout(e){return J.isRequired(e,"milliseconds"),this._serverTimeoutInMilliseconds=e,this}withKeepAliveInterval(e){return J.isRequired(e,"milliseconds"),this._keepAliveIntervalInMilliseconds=e,this}withStatefulReconnect(e){return this.httpConnectionOptions===void 0&&(this.httpConnectionOptions={}),this.httpConnectionOptions._useStatefulReconnect=!0,this._statefulReconnectBufferSize=e==null?void 0:e.bufferSize,this}build(){const e=this.httpConnectionOptions||{};if(e.logger===void 0&&(e.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");const t=new Di(this.url,e);return sn.create(t,this.logger||ze.instance,this.protocol||new Bi,this.reconnectPolicy,this._serverTimeoutInMilliseconds,this._keepAliveIntervalInMilliseconds,this._statefulReconnectBufferSize)}}function Ss(n){const e=new Ni().configureLogging(E.Information).withUrl(n).withAutomaticReconnect({nextRetryDelayInMilliseconds:()=>5e3}).build();return e.keepAliveIntervalInMilliseconds=15e3,e.serverTimeoutInMilliseconds=18e5,e.start().then(()=>{H.Logger().info("启动SignalR连接！")}),e.onclose(async()=>{H.Logger().info("断开SignalR连接!")}),e.onreconnecting(()=>{H.Logger().warn("SignalR服务已断线，重连中...！")}),e.onreconnected(()=>{H.Logger().warn("SignalR重连成功!")}),e}const ue=no({panelGroups:{}}),ko=()=>({useGroupAccordion:n=>Ie(()=>ue.panelGroups[n].accordion),setGroupAccordionStatus:(n,e)=>{ue.panelGroups[n]={...ue.panelGroups[n],accordion:e}},panelExpanded:(n,e)=>Ie(()=>{var t,o;return((o=(t=ue.panelGroups[n])==null?void 0:t.panelExpandStatus)==null?void 0:o[e])||!1}),setPanelExpandedStatus:(n,e,t)=>{var o;ue.panelGroups[n]={...ue.panelGroups[n],panelExpandStatus:{...((o=ue.panelGroups[n])==null?void 0:o.panelExpandStatus)||{},[e]:t}}},togglePanelExpandedStatus:(n,e)=>{ue.panelGroups[n].accordion&&(ue.panelGroups[n].panelExpandStatus[e]||Object.keys(ue.panelGroups[n].panelExpandStatus).forEach(t=>{ue.panelGroups[n].panelExpandStatus[t]=!1})),ue.panelGroups[n].panelExpandStatus[e]=!ue.panelGroups[n].panelExpandStatus[e]}}),Bt=n=>n>255?255:n<0?0:n,Ze=(n,e)=>{const t=n.replace("#",""),o=parseInt(t,16),r=Bt((o>>16)+e),i=Bt((o>>8&255)+e);return"#"+(Bt((255&o)+e)|i<<8|r<<16).toString(16)};var $t=De({name:"VueCollapsiblePanelGroup",props:{accordion:{type:Boolean,default:!1},baseColor:{type:String,default:"#333333"}},setup(n){const e=le(`group-${qt()}`),{setGroupAccordionStatus:t}=ko(),o={"--base-color":n.baseColor,"--border-color":Ze(n.baseColor,180),"--bg-color-header":Ze(n.baseColor,140),"--bg-color-header-hover":Ze(n.baseColor,190),"--bg-color-header-active":Ze(n.baseColor,200),"--bg-color-body":"#fff"};return t(e.value,n.accordion),{idGroup:e,cssColorVars:o}}});const ji=["data-id-group"];$t.render=function(n,e,t,o,r,i){return G(),ce("div",{"data-id-group":n.idGroup,style:Ne(n.cssColorVars),class:"vcpg"},[Q(n.$slots,"default")],12,ji)},$t.__scopeId="data-v-23ab5317",$t.__file="src/controls/collapsepanel/VCollapsiblePanelGroup.vue";var Nt=De({name:"VueCollapsiblePanel",props:{expanded:{type:Boolean,default:!0}},setup(n,e){const t=`panel-${qt()}`,o=le(),r=le(),i=le(),{panelExpanded:s,togglePanelExpandedStatus:d,setPanelExpandedStatus:f}=ko(),m=Ie(()=>({hasContent:e.slots.content&&e.slots.content()[0].children.length>0,dataKey:qt()})),S=Ie(()=>{var D,j;return((j=(D=o.value)==null?void 0:D.parentElement)==null?void 0:j.getAttribute("data-id-group"))||""}),k=Ie(()=>s(S.value,t).value&&m.value.hasContent);return en(()=>{f(S.value,t,n.expanded)}),Ar(()=>{(async()=>(await tn(),r.value&&i.value&&(r.value.style.height=`${Math.min(i.value.scrollHeight,r.value.scrollHeight)}px`)))()}),{body:m,panelRef:o,bodyRef:r,bodyContentRef:i,isExpanded:k,collapse:D=>{D.style.height="0"},expand:D=>{D.style.height=`${D.scrollHeight}px`},toggle:()=>{m.value.hasContent&&d(S.value,t)},toggleIcon:`
    <svg
        width="24px"
        height="24px"
        viewBox="0 0 24 24"
        fill="currentColor"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path d="M6.34292 7.75734L4.92871 9.17155L11.9998 16.2426L19.0708 9.17158L17.6566 7.75737L11.9998 13.4142L6.34292 7.75734Z"/>
    </svg>
`}}});const Hi={class:"vcp__header-title"},Oi={key:0,class:"vcp__header-icon"},Ui=["innerHTML"],Wi={key:0,ref:"bodyRef",class:"vcp__body"},qi={ref:"bodyContentRef",class:"vcp__body-content"};function jt(n){return window.TouchEvent&&n instanceof TouchEvent}Nt.render=function(n,e,t,o,r,i){return G(),ce("section",{ref:"panelRef",class:Mr(["vcp",{"vcp--expanded":n.isExpanded,"vcp--expandable":n.body.hasContent}])},[re("header",{class:"vcp__header",onClick:e[0]||(e[0]=(...s)=>n.toggle&&n.toggle(...s))},[re("div",Hi,[Q(n.$slots,"title")]),n.body.hasContent?(G(),ce("div",Oi,[Q(n.$slots,"icon",{},()=>[re("span",{innerHTML:n.toggleIcon},null,8,Ui)])])):Ee("v-if",!0)]),at(Qt,{"data-key":n.body.dataKey,name:"slide",onBeforeEnter:n.collapse,onEnter:n.expand,onBeforeLeave:n.expand,onLeave:n.collapse},{default:ke(()=>[n.isExpanded?(G(),ce("div",Wi,[re("div",qi,[Q(n.$slots,"content")],512)],512)):Ee("v-if",!0)]),_:3},8,["data-key","onBeforeEnter","onEnter","onBeforeLeave","onLeave"])],2)},Nt.__scopeId="data-v-08c94cf8",Nt.__file="src/controls/collapsepanel/VCollapsiblePanel.vue";class ie{constructor(e){L(this,"e");this.e=e}stopPropagation(){this.e.stopPropagation()}preventDefault(){this.e.preventDefault()}get clientX(){return jt(this.e)?(this.e.type==="touchend"?this.e.changedTouches:this.e.touches).item(0).clientX:this.e.clientX}get clientY(){return jt(this.e)?(this.e.type==="touchend"?this.e.changedTouches:this.e.touches).item(0).clientY:this.e.clientY}get clientCoord(){return new cn(this.clientX,this.clientY)}static bindDown(e,t,o,r=!1){const i=d=>{t(new ie(d))},s=d=>{d.touches.length===1&&t(new ie(d)),d.touches.length>1&&o&&o(new ie(d))};return e.addEventListener("mousedown",i,r),e.addEventListener("touchstart",s,r),()=>{e.removeEventListener("mousedown",i,r),e.removeEventListener("touchstart",s,r)}}static bindMove(e,t,o=!1){const r=s=>{t(new ie(s))},i=s=>{s.touches.length===1&&t(new ie(s))};return e.addEventListener("mousemove",r,o),e.addEventListener("touchmove",i,o),()=>{e.removeEventListener("mousemove",r,o),e.removeEventListener("touchmove",i,o)}}static bindUp(e,t,o=!1){const r=s=>{t(new ie(s))},i=s=>{s.touches.length===0&&t(new ie(s))};return e.addEventListener("mouseup",r,o),e.addEventListener("touchend",i,o),()=>{e.removeEventListener("mouseup",r,o),e.removeEventListener("touchend",i,o)}}originalEvent({mouse:e,touch:t}){jt(this.e)?t&&t(this.e):e&&e(this.e)}}class cn{constructor(e,t){L(this,"x");L(this,"y");this.x=e,this.y=t}clone(){return new cn(this.x,this.y)}}class Fi{constructor(e,t,o={}){L(this,"handle");L(this,"container");L(this,"options");L(this,"unbindDown");L(this,"unbindMove");L(this,"unbindUp");L(this,"offsetX");L(this,"offsetY");L(this,"mousedown",e=>{if(e.preventDefault(),this.handle){const{left:t,top:o}=this.handle.getBoundingClientRect();this.offsetX=e.clientX-t,this.offsetY=e.clientY-o}this.options.onMoveStart&&this.options.onMoveStart(),this.unbindMove=ie.bindMove(document,this.mousemove),this.unbindUp=ie.bindUp(document,this.mouseup)});L(this,"mousemove",e=>{this.container&&(this.container.style.left=e.clientX-this.offsetX+"px",this.container.style.top=e.clientY-this.offsetY+"px"),this.options.onMove&&this.options.onMove()});L(this,"mouseup",e=>{this.options.onMoveEnd&&this.options.onMoveEnd(),this.unbindUp(),this.unbindMove(),this.unbindUp=this.unbindMove=void 0});this.handle=e,this.container=t,this.options=o,e&&(this.unbindDown=ie.bindDown(e,this.mousedown),e.classList.add("draggable-handle"))}teardown(){var e;(e=this.handle)==null||e.classList.remove("draggable-handle"),this.unbindDown&&this.unbindDown(),this.unbindUp&&this.unbindUp(),this.unbindMove&&this.unbindMove()}}class zi{constructor(e,t){L(this,"_group");L(this,"onChange");L(this,"zIndex");this._group=e,this.onChange=t,this.a(o=>o.push(this))}set group(e){this._group=e;const t=rt(this._group),o=rt(e);t.splice(t.indexOf(this),1),o.push(this),Vn()}get group(){return this._group}unregister(){this.a(e=>e.splice(e.indexOf(this),1))}raise(){this.a(e=>{e.splice(e.indexOf(this),1),e.push(this)})}a(e){e(rt(this._group)),Vn()}}const ot=new Map;function rt(n){return ot.has(n)||ot.set(n,[]),ot.get(n)}function Io(n,e){return n>e?-Io(e,n):n<0&&e>=0?1:n-e}function Vn(){let n=0;for(const e of function(t){const o=[];return t.forEach((r,i)=>o.push(i)),o}(ot).sort(Io))for(const t of rt(e))n!=t.zIndex&&(t.zIndex=n,t.onChange(n)),n++}function Kt(n){if(n){const{width:e,height:t}=n.style;n.style.width="auto",n.style.height="auto";const o=it(n);return n.style.width=e,n.style.height=t,o}return{width:0,height:0,top:0,left:0,bottom:0,right:0}}function it(n){const e=n.getBoundingClientRect(),t=e.width,o=e.height,r=e.top,i=e.left;return{width:t,height:o,top:r,left:i,bottom:r+o,right:i+t}}class Xi{constructor(e,t){L(this,"container");L(this,"options");L(this,"handles");if(this.container=e,this.options=t,e&&t){this.handles=xo.map(f=>new f(e,this));const{width:o,height:r}=Kt(e),i=t.maxWidth||window.innerWidth,s=t.maxHeight||window.innerHeight;let d=!1;(o<t.minWidth||o>i)&&(e.style.width=`${Jn(o,t.minWidth,i)}px`,d=!0),(r<t.minHeight||r>s)&&(e.style.height=`${Jn(r,t.minHeight,s)}px`,d=!0),d&&t.onResize&&t.onResize()}}teardown(){var e;(e=this.handles)==null||e.forEach(t=>t.teardown())}}const xo=[];class Se{constructor(e,t){L(this,"container");L(this,"helper");L(this,"handle");L(this,"handleSize",8);L(this,"unbindDown");L(this,"unbindMove");L(this,"unbindUp");L(this,"x0");L(this,"y0");L(this,"left0");L(this,"top0");L(this,"width0");L(this,"height0");L(this,"mousedown",e=>{e.preventDefault(),e.stopPropagation();const{left:t,top:o,width:r,height:i}=it(this.container);this.x0=e.clientX,this.y0=e.clientY,this.left0=t,this.top0=o,this.width0=r,this.height0=i,this.calcSafeBoundaries(),this.helper.options&&this.helper.options.onResizeStart&&this.helper.options.onResizeStart(),this.unbindMove=ie.bindMove(document,this.mousemove),this.unbindUp=ie.bindUp(document,this.mouseup)});L(this,"minLeft");L(this,"maxLeft");L(this,"minRight");L(this,"maxRight");L(this,"minTop");L(this,"maxTop");L(this,"minBottom");L(this,"maxBottom");L(this,"mousemove",e=>{e.preventDefault(),e.stopPropagation(),this.setPosition(e),this.fixPosition(),this.helper.options&&this.helper.options.onResize&&this.helper.options.onResize()});L(this,"mouseup",e=>{e.preventDefault(),e.stopPropagation(),this.helper.options&&this.helper.options.onResizeEnd&&this.helper.options.onResizeEnd(),this.unbindUp(),this.unbindMove(),this.unbindUp=this.unbindMove=void 0});this.container=e,this.helper=t,this.handle=this.createHandleElement(),this.unbindDown=ie.bindDown(this.handle,this.mousedown)}teardown(){this.unbindDown(),this.unbindUp&&this.unbindUp(),this.unbindMove&&this.unbindMove(),this.handle.parentElement.removeChild(this.handle)}calcSafeBoundaries(){if(!this.helper.options)return;const{left:e,top:t,right:o,bottom:r}=it(this.container),i=this.helper.options,s=i.maxWidth||window.innerWidth,d=i.maxHeight||window.innerHeight;this.minLeft=Math.max(o-s,0),this.maxLeft=o-i.minWidth,this.minRight=e+i.minWidth,this.maxRight=Math.min(e+s,window.innerWidth),this.minTop=Math.max(r-d,0),this.maxTop=r-i.minHeight,this.minBottom=t+i.minHeight,this.maxBottom=Math.min(t+d,window.innerHeight)}fixPosition(){const{width:e,height:t,left:o,top:r,right:i,bottom:s}=it(this.container),d=this.helper.options;d&&(o<this.minLeft?(this.container.style.width=e+o-this.minLeft+"px",this.container.style.left=`${this.minLeft}px`):o>this.maxLeft?(this.container.style.width=`${d.minWidth}px`,this.container.style.left=`${this.maxLeft}px`):i<this.minRight?this.container.style.width=`${d.minWidth}px`:i>this.maxRight&&(this.container.style.width=this.maxRight-o+"px"),r<this.minTop?(this.container.style.height=t+r-this.minTop+"px",this.container.style.top=`${this.minTop}px`):r>this.maxTop?(this.container.style.height=`${d.minHeight}px`,this.container.style.top=`${this.maxTop}px`):s<this.minBottom?this.container.style.height=`${d.minHeight}px`:s>this.maxBottom&&(this.container.style.height=this.maxBottom-r+"px"))}createHandleElement(){const e=document.createElement("div"),t=e.style;return t.position="absolute",this.applyStyle(t),this.container.appendChild(e),e}}function Jn(n,e,t){return n<e?e:n>t?t:n}xo.push(class extends Se{setPosition(n){this.container.style.width=this.width0+n.clientX-this.x0+"px",this.container.style.height=this.height0+n.clientY-this.y0+"px"}applyStyle(n){n.width=2*this.handleSize+"px",n.height=2*this.handleSize+"px",n.right=-this.handleSize+"px",n.bottom=-this.handleSize+"px",n.cursor="nwse-resize"}},class extends Se{setPosition(n){this.container.style.height=this.height0+n.clientY-this.y0+"px"}applyStyle(n){n.right=`${this.handleSize}px`,n.left=`${this.handleSize}px`,n.height=2*this.handleSize+"px",n.bottom=-this.handleSize+"px",n.cursor="ns-resize"}},class extends Se{setPosition(n){this.container.style.left=this.left0+n.clientX-this.x0+"px",this.container.style.width=this.width0-(n.clientX-this.x0)+"px",this.container.style.height=this.height0+n.clientY-this.y0+"px"}applyStyle(n){n.left=-this.handleSize+"px",n.bottom=-this.handleSize+"px",n.width=2*this.handleSize+"px",n.height=2*this.handleSize+"px",n.cursor="nesw-resize"}},class extends Se{setPosition(n){this.container.style.left=this.left0+n.clientX-this.x0+"px",this.container.style.width=this.width0-(n.clientX-this.x0)+"px"}applyStyle(n){n.left=-this.handleSize+"px",n.bottom=`${this.handleSize}px`,n.width=2*this.handleSize+"px",n.top=`${this.handleSize}px`,n.cursor="ew-resize"}},class extends Se{setPosition(n){this.container.style.left=this.left0+n.clientX-this.x0+"px",this.container.style.width=this.width0-(n.clientX-this.x0)+"px",this.container.style.top=this.top0+n.clientY-this.y0+"px",this.container.style.height=this.height0-(n.clientY-this.y0)+"px"}applyStyle(n){n.left=-this.handleSize+"px",n.top=-this.handleSize+"px",n.width=2*this.handleSize+"px",n.height=2*this.handleSize+"px",n.cursor="nwse-resize"}},class extends Se{setPosition(n){this.container.style.top=this.top0+n.clientY-this.y0+"px",this.container.style.height=this.height0-(n.clientY-this.y0)+"px"}applyStyle(n){n.left=`${this.handleSize}px`,n.right=`${this.handleSize}px`,n.height=2*this.handleSize+"px",n.top=-this.handleSize+"px",n.cursor="ns-resize"}},class extends Se{setPosition(n){this.container.style.top=this.top0+n.clientY-this.y0+"px",this.container.style.height=this.height0-(n.clientY-this.y0)+"px",this.container.style.width=this.width0+n.clientX-this.x0+"px"}applyStyle(n){n.right=-this.handleSize+"px",n.top=-this.handleSize+"px",n.height=2*this.handleSize+"px",n.width=2*this.handleSize+"px",n.cursor="nesw-resize"}},class extends Se{setPosition(n){this.container.style.width=this.width0+n.clientX-this.x0+"px"}applyStyle(n){n.right=-this.handleSize+"px",n.top=`${this.handleSize}px`,n.bottom=`${this.handleSize}px`,n.width=2*this.handleSize+"px",n.cursor="ew-resize"}});var st=De({name:"",props:{disabled:{type:Boolean,default:!1},windowStyle:{type:Object,required:!0}},components:{},setup(n){const e=le(!1),t=le(!1);return{hover:e,active:t,style:function(){let o=n.windowStyle.button;return e.value&&(o={...o,...this.windowStyle.buttonHover}),t.value&&(o={...o,...this.windowStyle.buttonActive}),o},mouseup:function(o){this.active&&this.$emit("click")},mousedown:function(o){o.preventDefault(),t.value=!0;const r=ie.bindUp(document,()=>{t.value=!1,r()})}}}});const Gi=["disabled"];st.render=function(n,e,t,o,r,i){return G(),ce("div",{class:"btn",style:Ne(n.style()),onMouseenter:e[0]||(e[0]=s=>n.hover=!0),onMouseleave:e[1]||(e[1]=s=>n.hover=!1),onMousedown:e[2]||(e[2]=Ln((...s)=>n.mousedown&&n.mousedown(...s),["stop"])),onTouchstart:e[3]||(e[3]=Ln((...s)=>n.mousedown&&n.mousedown(...s),["stop"])),onMouseup:e[4]||(e[4]=(...s)=>n.mouseup&&n.mouseup(...s)),onTouchend:e[5]||(e[5]=(...s)=>n.mouseup&&n.mouseup(...s)),disabled:n.disabled},[Q(n.$slots,"default")],44,Gi)},st.__scopeId="data-v-71662210",st.__file="src/controls/vuewindow/window/Button.vue";const Vt=new Set;function Yn(n){return n!==null?parseFloat(n):0}function et(n){const e=window.getComputedStyle(n),t=Math.ceil([e.paddingLeft,e.width,e.paddingRight].map(Yn).reduce((r,i)=>r+i)),o=Math.ceil([e.paddingTop,e.height,e.paddingBottom].map(Yn).reduce((r,i)=>r+i));return{width:t,height:o}}class Ki{constructor(e,t){L(this,"width");L(this,"height");this.width=e,this.height=t}}function Vi(n){const e=n.windowEl;if(e){const t=parseFloat(e.style.left||"NaN"),o=parseFloat(e.style.top||"NaN");if(!isNaN(t)&&!isNaN(o))return{left:t,top:o}}return null}function Ji(n,e,t,o){const r=n-t,i=e-o;return r*r+i*i}window.addEventListener("resize",n=>{Vt.forEach(e=>{e&&Gr(e.fixPosition)&&e.fixPosition()})});const tt=[];var Qn=De({name:"Window",props:{windowStyle:{type:Object,required:!0},isOpen:{type:Boolean,required:!1,default:!0},title:{type:String,required:!0,default:""},closeButton:{type:Boolean,required:!1,default:!0},resizable:{type:Boolean,required:!1,default:!1},isScrollable:{type:Boolean,required:!1,default:!1},padding:{type:Number,required:!1,default:8},activateWhenOpen:{type:Boolean,required:!1,default:!0},positionHint:{type:String,required:!1,default:""},zGroup:{type:Number,required:!1,default:1},overflow:{type:String,required:!1,default:"visible"},minWidth:{type:Number,required:!1,default:1},minHeight:{type:Number,required:!1,default:0},maxWidth:{type:Number,required:!1,default:0},maxHeight:{type:Number,required:!1,default:0},height:{type:Number,required:!1},width:{type:Number,required:!1},top:{type:Number,required:!1},left:{type:Number,required:!1}},components:{myButton:st},setup(n,{emit:e}){const t=Dr();if(!t)return;const{proxy:o}=t;let r=0,i,s,d;const f=le(n.isOpen),m=()=>{tt.push(o),d=new zi(n.zGroup,S),n.isOpen&&function(P){tn(()=>{r++==0&&(p(o),function(){const A=k.value,{width:$,height:O}=Kt(A);let W,F;if(n.left!==void 0!=(n.top!==void 0))throw new Error("Either of left or top is specified. Both must be set or not set.");if(typeof n.left=="number")W=n.left,F=n.top;else{const ae=n.positionHint||"auto";switch(ae){case"auto":{let te=20,oe=50,Z=0;do{if(tt.every(ve=>{if(!ve.isOpen||o==ve)return!0;const Ve=Vi(ve);if(Ve==null)return!0;const{left:vt,top:pe}=Ve;return Ji(vt,pe,te,oe)>16}))break;te=(te+40)%(window.innerWidth-200),oe=(oe+40)%(window.innerHeight-200)}while(++Z<100);W=te,F=oe}break;case"center":W=(window.innerWidth-$)/2,F=(window.innerHeight-O)/2;break;default:try{const te=ae.split("/").map(Number);if(te.length!=2)throw null;const[oe,Z]=te;if(!isFinite(oe)||!isFinite(Z))throw null;W=oe>=0?oe:window.innerWidth-$+oe,F=Z>=0?Z:window.innerHeight-O+Z}catch{throw new Error(`invalid position string: ${ae}`)}}}A&&(A.style.left=`${W}px`,A.style.top=`${F}px`)}()),n.resizable&&l(),B(),i=new Fi(D.value,k.value,{onMove:()=>B(),onMoveStart:()=>e("move-start"),onMoveEnd:()=>e("move-end")}),n.resizable&&function(){const{height:A}=Kt(D.value);s=new Xi(k.value,{onResize:()=>l(),onResizeStart:()=>e("resize-start"),onResizeEnd:()=>e("resize-end"),minWidth:n.minWidth,minHeight:n.minHeight+A,maxWidth:n.maxWidth,maxHeight:n.maxHeight?n.maxHeight+A:void 0})}()}),n.activateWhenOpen&&T()}(),Vt.add(o)};function S(P){b.value.zIndex=`${P}`}const k=le(null),D=le(null),j=le(null);function T(){d.raise(),e("activate")}const b=le({...n.windowStyle.window,zIndex:"auto",overflow:n.overflow}),h=Ie(()=>n.windowStyle.titlebar),g=Ie(()=>{const P={...n.windowStyle.content};return n.resizable?P.padding="0":n.padding!=null&&(P.padding=`${n.padding}px`),n.isScrollable&&(P.overflow="auto"),P});function p(P){const{width:A,height:$,top:O,left:W}=P,F=k;if(F&&A!=null&&(F.value.style.width=`${A}px`),$!=null){const ae=D.value;if(ae){const te=et(ae).height;F.value.style.height=`${$+te}px`}}F&&W!=null&&(F.value.style.left=`${W}px`),F&&O!=null&&(F.value.style.top=`${O}px`)}function l(P=!0){const A=k.value,$=D.value,O=j.value;if(O&&A&&$){const{width:W,height:F}=et(O),{width:ae,height:te}=et(A),oe=et($).height,Z=ae-(O.offsetWidth-W),ve=te-oe-(O.offsetHeight-F);O.style.width=`${Z}px`,O.style.height=`${ve}px`,v(),e("resize",new Ki(Z,ve)),P&&(e("update:width",Z),e("update:height",ve))}}function v(){const P=k.value;if(P){const A=P.getBoundingClientRect();A.left<0&&(b.value.left="0px"),A.top<0&&(b.value.top="0px"),A.right>window.innerWidth&&(b.value.left=window.innerWidth-A.width+"px"),A.bottom>window.innerHeight&&(b.value.top=window.innerHeight-A.height+"px")}}function B(P=!0){v();const A=k.value;if(A){const{left:$,top:O}=A.getBoundingClientRect();P&&(e("update:left",$),e("update:top",O))}}return Ue(()=>n.isOpen,P=>{f.value=P}),Ue(()=>n.zGroup,P=>{d.group=P}),Ue(()=>n.width,P=>{p({width:P}),l(!1)}),Ue(()=>n.height,P=>{p({height:P}),l(!1)}),en(()=>{m()}),Br(()=>{Vt.delete(this),d.unregister(),s&&s.teardown(),i&&i.teardown(),tt.splice(tt.indexOf(o),1)}),{isOpen:f,windowEl:k,titlebar:D,content:j,activate:T,styleWindow:b,styleTitlebar:h,styleContent:g,closeButtonClick:function(){f.value=!1,e("closebuttonclick")},fixPosition:v}}});const Yi={class:"title"};var Zn;Qn.render=function(n,e,t,o,r,i){const s=Zt("myButton");return G(),de(Qt,{name:"fade",onAfterLeave:e[2]||(e[2]=d=>n.$emit("close")),onAfterEnter:e[3]||(e[3]=d=>n.$emit("open")),persisted:""},{default:ke(()=>[$r(re("div",{class:"window",style:Ne(n.styleWindow),ref:"windowEl",onMousedown:e[0]||(e[0]=(...d)=>n.activate&&n.activate(...d)),onTouchstart:e[1]||(e[1]=(...d)=>n.activate&&n.activate(...d))},[re("div",{class:"titlebar",style:Ne(n.styleTitlebar),ref:"titlebar"},[re("div",Yi,[n.$slots.title?Q(n.$slots,"title",{key:0}):(G(),ce(xe,{key:1},[Wt(oo(n.title),1)],64))]),n.closeButton?(G(),de(s,{key:0,windowStyle:n.windowStyle,onClick:n.closeButtonClick},{default:ke(()=>[Wt("×")]),_:1},8,["windowStyle","onClick"])):Ee("v-if",!0)],4),re("div",{class:"content",style:Ne(n.styleContent),ref:"content"},[Q(n.$slots,"default")],4)],36),[[Nr,n.isOpen]])]),_:3})},Qn.__file="src/controls/vuewindow/window/index.vue",function(n){n[n.StyleBlack=0]="StyleBlack",n[n.StyleWhite=1]="StyleWhite",n[n.StyleMetal=2]="StyleMetal",n[n.StyleGrayblue=3]="StyleGrayblue"}(Zn||(Zn={}));var se;(function(n){n[n.top=0]="top",n[n.bottom=1]="bottom",n[n.centerBack=2]="centerBack",n[n.centerMain=3]="centerMain",n[n.centerFront=4]="centerFront",n[n.left=5]="left",n[n.right=6]="right"})(se||(se={}));class Qi{constructor(e,t,o,r){L(this,"layoutState");L(this,"layoutMap",new Map);L(this,"preConditionMap",new Map);L(this,"widgetsLoadedSet",new Set);L(this,"widgetConfig",new Array);L(this,"_LayoutID");L(this,"_mapItemRefs");this.layoutState=e,this._LayoutID=o,this._mapItemRefs=r,t.forEach(i=>{var s;if(i.layoutID===o&&(this.widgetConfig.push(i),i.afterid))if(this.preConditionMap.has(i.afterid))(s=this.preConditionMap.get(i.afterid))==null||s.add(i);else{const d=new Set;d.add(i),this.preConditionMap.set(i.afterid,d)}})}getLayoutID(){return this._LayoutID}getWidgetConfig(){return this.widgetConfig}preloadWidgets(){this.widgetConfig.filter(e=>e.preload&&!e.afterid).forEach(e=>{this._loadWidget(e)})}async loadWidget(e){if(!e)return;let t;return on(e)?t=e:ro(e)&&(t=this.widgetConfig.find(o=>o.id===e)),t?t.afterid?(this.isWidgetLoaded(t.afterid)||await this.loadWidget(t.afterid),this._loadWidget(t)):this._loadWidget(t):void 0}loadOtherDependenceWidgets(e){var t;this.preConditionMap.has(e)&&((t=this.preConditionMap.get(e))==null||t.forEach(o=>{o.preload&&this._loadWidget(o)}))}_loadWidget(e){if(!this.widgetsLoadedSet.has(e.id))return e.component().then(t=>{if(t.default){const o=Ur(t.default);this.getContainerComponents(e.container).value.set(e.id,o),this.widgetsLoadedSet.add(e.id),tn().then(()=>{H.EventBus.emit(ge.WidgetLoadedEvent,{layoutID:this._LayoutID,widgetID:e.id}),this.loadOtherDependenceWidgets(e.id)})}}).catch(t=>{H.Logger().error("加载Widget失败！",e),H.EventBus.emit(ge.WidgetLoadedErrorEvent,e)})}hasDependentWidgets(e){let t=!1;if(this.preConditionMap.has(e)){const o=this.preConditionMap.get(e);if(o){for(const r of o)if(this.isWidgetLoaded(r.id)){t=!0;break}}}return t}unloadWidget(e){if(!e||!this.isWidgetLoaded(e))return;const t=this.widgetConfig.find(o=>o.id===e);if(t){if(this.preConditionMap.has(e)){const o=this.preConditionMap.get(e);if(o)for(const r of o)this.unloadWidget(r.id)}this.getContainerComponents(t.container).value.delete(e),this.widgetsLoadedSet.delete(e),this._mapItemRefs&&this._mapItemRefs.delete(e),H.EventBus.emit(ge.WidgetUnLoadedEvent,{layoutID:this._LayoutID,widgetID:e})}}isWidgetLoaded(e){return this.widgetsLoadedSet.has(e)}splitTwoContainer(e=!1){const t=this.layoutState.centerMainContainer,o=this.layoutState.centerBackContainer;e?(t&&(t.style.left="0",t.style.width="100%"),o&&(o.style.width="100%")):(t&&(t.style.left="50%",t.style.width="50%"),o&&(o.style.width="50%"))}getLayoutContainer(e){switch(e){case se.top:return this.layoutState.topContainer;case se.bottom:return this.layoutState.bottomContainer;case se.left:return this.layoutState.leftContainer;case se.right:return this.layoutState.rightContainer;case se.centerBack:return this.layoutState.centerBackContainer;case se.centerMain:return this.layoutState.centerMainContainer;case se.centerFront:return this.layoutState.centerFrontContainer}}changeContainerVisible(e,t=!1){const o=this.getLayoutContainer(e);o&&(o.style.visibility=t?"visible":"hidden")}changeWidgetVisible(e,t=!1){const o=this.getWidgetComponent(e);o&&o.changeVisible&&o.changeVisible(t)}isWidgetVisible(e){const t=this.getWidgetComponent(e);return!!t&&(!t.isShow||t.isShow.value)}getWidgetComponent(e){if(this.widgetsLoadedSet.has(e)&&this._mapItemRefs)return this._mapItemRefs.get(e)}getWigetItem(e){return this.widgetConfig.find(t=>t.id===e)}getGroupWigetItems(e){return this.widgetConfig.filter(t=>t.group===e)}getContainerComponents(e){if(this.layoutMap.has(e))return this.layoutMap.get(e);{const t=le(new Map);return this.layoutMap.set(e,t),t}}getWidgetLoadedIDList(){const e=[];return this.widgetsLoadedSet.forEach(t=>{e.push(t)}),e}unloadAllWidgets(e){const t=[];this.widgetsLoadedSet.forEach(o=>{e&&e.length>0?e.findIndex(r=>r===o)<0&&t.push(o):t.push(o)}),t.forEach(o=>this.unloadWidget(o))}unloadWidgets(e){e&&e.length>0&&e.forEach(t=>{this.unloadWidget(t)})}static getLayoutManager(e,t){if(t){const o=t.find(r=>r.id===e);if(o&&o.layoutID)return H.LayoutMap.get(o.layoutID)}}}var Jt=De({name:"SuspenseWithError",setup(){const n=le(null);return jr(e=>(n.value="当前页面存在问题，无法渲染……",!0)),{error:n}}});Jt.render=function(n,e,t,o,r,i){return n.error?Q(n.$slots,"error",{key:0},()=>[Wt(oo(n.error),1)]):(G(),de(Lr,{key:1},{default:ke(()=>[Q(n.$slots,"default")]),fallback:ke(()=>[Q(n.$slots,"fallback")]),_:3}))},Jt.__file="src/controls/routertransition/SuspenseWithError.vue";var To=De({name:"RouterTransition",__name:"RouterTransition",setup:n=>(e,t)=>{const o=Zt("router-view");return G(),de(Jt,null,{default:ke(()=>[at(o,null,{default:ke(({Component:r,route:i})=>[at(Qt,null,{default:ke(()=>[i.meta.keepAlive?(G(),de(Hr,{key:0},[(G(),de(Ce(r),{key:i.name}))],1024)):(G(),de(Ce(r),{key:i.name}))]),_:2},1024)]),_:1})]),_:1})}});To.__file="src/controls/routertransition/RouterTransition.vue";var Ht=De({name:"LayoutContainer",props:{widgetConfig:{type:Array,required:!0,default:()=>[]},layoutID:{type:String,default:void 0},layoutStyle:{type:Object},enableRouterView:{type:Boolean,default:!0}},emits:["containerLoaded"],components:{RouterTransition:To},setup(n,{attrs:e,slots:t,emit:o}){const r=n.layoutID,i=le(n.enableRouterView);Ue(()=>n.enableRouterView,()=>{i.value=n.enableRouterView});const s=no({topContainer:void 0,centerBackContainer:void 0,centerMainContainer:void 0,centerFrontContainer:void 0,bottomContainer:void 0,leftContainer:void 0,rightContainer:void 0}),d=new Map,f=new Qi(s,n.widgetConfig,r,d),m=b(se.top),S=b(se.centerBack),k=b(se.centerFront),D=b(se.left),j=b(se.right),T=b(se.bottom);function b(g){return f==null?void 0:f.getContainerComponents(g)}const h=Ie(()=>n.layoutStyle);return en(()=>{f&&(f.preloadWidgets(),r===void 0&&(H.LayoutManager=f),o("containerLoaded",{layoutID:r,layoutManager:f}))}),{...Or(s),topContainerComponents:m,centerbackComponents:S,centerfrontComponents:k,leftContainerComponents:D,rightContainerComponents:j,bottomContainerComponents:T,containerStyle:h,isEnableRouterView:i,setItemRef:(g,p)=>{g&&d.set(p,g)}}}});const Zi={ref:"topContainer",class:"topContainer"},es={key:0,ref:"centerMainContainer",class:"centerdiv mainContainer"},ts={ref:"centerBackContainer",class:"centerdiv backContainer"},ns={ref:"centerFrontContainer",class:"centerdiv centerFrontContainer"},os={ref:"leftContainer",class:"leftContainer"},rs={ref:"rightContainer",class:"rightContainer"},is={ref:"bottomContainer",class:"bottomContainer"};Ht.render=function(n,e,t,o,r,i){const s=Zt("router-transition");return G(),ce("div",{class:"layoutContainer",style:Ne(n.containerStyle)},[re("div",Zi,[Q(n.$slots,"top"),(G(!0),ce(xe,null,$e(n.topContainerComponents,([d,f])=>(G(),de(Ce(f),{ref_for:!0,ref:m=>n.setItemRef(m,d),key:d}))),128))],512),re("div",null,[Ee(" 主要容器-底部 "),n.isEnableRouterView?(G(),ce("div",es,[Q(n.$slots,"main",{},()=>[at(s)])],512)):Ee("v-if",!0),Ee(" 上一层-主容器 "),re("div",ts,[Q(n.$slots,"back"),(G(!0),ce(xe,null,$e(n.centerbackComponents,([d,f])=>(G(),de(Ce(f),{ref_for:!0,ref:m=>n.setItemRef(m,d),key:d}))),128))],512),Ee(" 最上浮动-主容器 "),re("div",ns,[Q(n.$slots,"front"),(G(!0),ce(xe,null,$e(n.centerfrontComponents,([d,f])=>(G(),de(Ce(f),{ref_for:!0,ref:m=>n.setItemRef(m,d),key:d}))),128))],512),re("div",os,[Q(n.$slots,"left"),(G(!0),ce(xe,null,$e(n.leftContainerComponents,([d,f])=>(G(),de(Ce(f),{ref_for:!0,ref:m=>n.setItemRef(m,d),key:d}))),128))],512),re("div",rs,[Q(n.$slots,"right"),(G(!0),ce(xe,null,$e(n.rightContainerComponents,([d,f])=>(G(),de(Ce(f),{ref_for:!0,ref:m=>n.setItemRef(m,d),key:d}))),128))],512)]),re("div",is,[Q(n.$slots,"bottom"),(G(!0),ce(xe,null,$e(n.bottomContainerComponents,([d,f])=>(G(),de(Ce(f),{ref_for:!0,ref:m=>n.setItemRef(m,d),key:d}))),128))],512),Ee(" 增加默认插槽 "),Q(n.$slots,"default")],4)},Ht.__scopeId="data-v-4d081e5c",Ht.__file="src/controls/layoutcontainer/layout.vue";const Ke={Login:"/api/User/Login",ChangeMyPwd:"/api/User/ChangeMyPwd",Logout:"/api/Check/ExitLogin",RefreshToken:"/api/Check/RefreshToken",CheckToken:"/api/Check/CheckToken",GetSystemRights:"/api/System/GetSystem"},Yt="access_token",ss=H.Config.ServiceURL.LoginAuthURL;function eo(){const n=Yr();n&&Ge(Ke.RefreshToken,ss,{refreshToken:n}).then(e=>{Ro(e.data)})}function as(){const n=Le.getJsonObject(Yt);if(!n)return;const e=new Date().getTime(),t=new Date(n.expire).getTime()-e;t>0&&(t<=5e3?eo():setTimeout(eo,t-5e3))}function Ro(n){const e=new Date().getTime();let t=new Date(n.accessToken.expires).getTime()-e;if((t>=36e5||t<-6e5)&&(t=18e5),t>0){let o=je();o?(o.token=n.accessToken.tokenContent,o.expire=n.accessToken.expires,o.refresh=n.refreshToken.tokenContent):o={token:n.accessToken.tokenContent,expire:n.accessToken.expires,refresh:n.refreshToken.tokenContent},Le.set(Yt,o,t/1e3),as()}else Le.remove(Yt)}const cs="Wm314243",ln=H.Config.ServiceURL.LoginAuthURL;async function Cs(n){var o;const e={username:n.username,pwd:di.encryptToString(n.pwd,cs)},t=(o=await Ge(Ke.Login,ln,e))==null?void 0:o.data;return t&&Ro(t.doubletoken),t}function Es(){const n=je();n&&(Qr(Ke.Logout,ln,{token:n.token,reftoken:n.refresh}),lo())}function ks(n){return Ge(Ke.CheckToken,ln,{token:n})}const un="ROLE_SYSTEM_RIGHT",hn=new io("",sessionStorage);function ls(){return hn.get(un)}function to(n){hn.set(un,n)}function us(){hn.remove(un)}function qe(n){if(n)for(let e=0;e<n.length;e++){const t=n[e];t.children&&t.children.length>0?(qe(t.children),t.children.length===0&&(n.splice(e,1),e--)):t.selected||(n.splice(e,1),e--)}}function Po(n,e,t="name"){n&&e&&n.forEach(o=>{const r=e.find(i=>i[t]===o[t]);r&&(o.children?r.children&&Po(o.children,r.children,t):(!r.children||r.children.length===0)&&r.selected&&(o.selected=r.selected))})}function nt(n,e,t,o="name"){const r=n[t],i=e[t];r?i&&Po(r,i,o):i&&(n[t]=i)}function hs(n){if(n&&n.length>0){const e=n.length;let t,o=!1;if(e>0){o=on(n[0]);const r=o?n[0]:JSON.parse(n[0]);if(e>1)for(let i=1;i<n.length;i++){const s=n[i],d=o?s:JSON.parse(s);nt(r,d,"routes","name"),nt(r,d,"widgetMenu","name"),nt(r,d,"widgets","id"),nt(r,d,"functions","id")}t=r}return t&&(qe(t.routes),qe(t.widgetMenu),qe(t.widgets),qe(t.functions)),t}}const Ot=[],Ut=[];function Mo(){return ls()}async function Is(n,e=!1){var s;us();const t=Ke.GetSystemRights,o=H.Config.ServiceURL.LoginAuthURL,r=await Ge(t,o,{systemid:n});if(!r||!r.data)return void((s=H.Message)==null?void 0:s.warn("无法获取功能授权列表！"));const i=r.data;if(i&&i.length>0){if(e){const d=JSON.parse(i[0]);return to(d),d}{const d=hs(i);return to(d),d}}}function Lo(n,e){const t={...n};return t.meta||(t.meta={}),e.index!=null&&(t.meta.index=e.index),e.title!=null&&(t.meta.title=e.title),n.children&&(t.children=[],e.children&&e.children.forEach(o=>{var i,s;const r=(i=n.children)==null?void 0:i.find(d=>d.path===o.path);if(r){const d=Lo(r,o);d&&((s=t.children)==null||s.push(d))}})),t}function xs(n,e=2){if(e===0)return n;const t=Mo();return t&&t.routes?(Ut.length>0||n.forEach(o=>{var i;const r=(i=t.routes)==null?void 0:i.find(s=>s.name===o.name);if(r){const s=Lo(o,r);s&&Ut.push(s)}}),Ut):void 0}function Ts(n,e=2){if(e===0)return n;const t=Mo();return t&&t.widgets?(Ot.length>0||(n==null||n.forEach(o=>{var r;(r=t.widgets)!=null&&r.find(i=>i.id===o.id)&&Ot.push(o)})),Ot):void 0}export{ws as B,Es as C,ys as D,ks as E,bs as G,Ro as L,To as M,H as N,Ts as T,_s as U,Ss as W,io as a,je as b,Ht as c,ct as d,Mo as e,as as f,us as g,Cs as h,Ge as i,ci as j,Is as k,Gr as l,se as o,ge as u,vs as w,xs as x};
