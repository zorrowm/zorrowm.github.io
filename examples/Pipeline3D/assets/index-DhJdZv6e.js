import{m as Q,i as N,n as F,o as O}from"./vendor-Dka75WDo.js";import{N as u,h as A,W as P,i as K}from"./xframelib-exp-BYnL-see.js";import{B as W}from"./rotate-ShLujV4O.js";import{u as T,b as V}from"./vue-router-exp-COsaUipG.js";import{d as w,a as j,r as p,H as b,M as B,N as t,y as k,a9 as x,U as q,W as m,O as z,u as G,v as H,_ as D,Q as J,F as M,G as $,l as X,S as Y,V as U}from"./@vue-exp-BMz8X7Pi.js";import{d as L}from"./index-uk12gd3X.js";import"./@hprose-exp-CwcCDL56.js";import"./axios-exp-DvxIUWKU.js";import"./domTool-Dunoo3KF.js";function E(i){let o=i;if(i.endsWith("/")){if(i.endsWith("/#/"))return o;o=i+"#/"}else o=i+"/#/";return o}const Z=w({__name:"AccountLogin",setup(i,{expose:o}){o();const r=j({username:"",password:""}),e=p(),a=p(),_=T(),n=_.query.sysid;let d=!0,f=!1;const h=async()=>{if(!d){u.Logger().debug("频繁点击登录******");return}if(d=!1,r.username.trim()===""||r.password.trim()=="")return setTimeout(()=>{d=!0},2e3),u.Message.warn("用户名或密码不能为空！");let l={username:r.username.trim(),pwd:r.password.trim()};const s=await A(l).catch(C=>{u.Message.warn(`登录失败:${C.message}!`),d=!0});if(s){const C=s.Userinfo.Doubletoken.AccessToken.TokenContent;if(n){u.Logger().info("当前登录id",s.System);const S=E("");window.open(S+"?tk="+C,"_self")}else u.OneUserInfo=s.Userinfo,V().push("onelogin-portal")}};function v(){e.value&&(e.value.placeholder="请输入账号"),a.value&&(a.value.placeholder="请输入密码")}function g(l){f=!0;const{time:s}=l;u.Message.info(`校验成功,耗时${s}秒`)}const c={formState:r,nameInput:e,pwdInput:a,currentRoute:_,systemID:n,get canLoginClicked(){return d},set canLoginClicked(l){d=l},get isPassVerify(){return f},set isPassVerify(l){f=l},handleSubmit:h,onblur:v,handleSuccess:g,get BasicDragVerify(){return W}};return Object.defineProperty(c,"__isScriptSetup",{enumerable:!1,value:!0}),c}}),ee=t("div",{class:"login-top-center"},"用户登录",-1),te={class:"login-center clearfix"},oe=t("div",{class:"login-center-img"},[t("img",{src:"/img/login/name.png"})],-1),ne={class:"login-center-input"},se=t("div",{class:"login-center-input-text"},"账号",-1),ie={class:"login-center clearfix"},re=t("div",{class:"login-center-img"},[t("img",{src:"/img/login/password.png"})],-1),ae={class:"login-center-input"},le=t("div",{class:"login-center-input-text"},"密码",-1),ue={class:"login-center clearfix",style:{"margin-bottom":"5px"}},ce={class:"login-bottom-line"},de=t("span",null,"忘记密码",-1),ge=t("span",null,"注册新账号",-1);function _e(i,o,r,e,a,_){return b(),B(z,null,[ee,t("div",te,[oe,t("div",ne,[k(t("input",{ref:"nameInput","onUpdate:modelValue":o[0]||(o[0]=n=>e.formState.username=n),type:"text",placeholder:"请输入账号",onfocus:"this.placeholder=''",onBlur:o[1]||(o[1]=n=>e.onblur())},null,544),[[x,e.formState.username]]),se])]),t("div",ie,[re,t("div",ae,[k(t("input",{ref:"pwdInput","onUpdate:modelValue":o[2]||(o[2]=n=>e.formState.password=n),type:"password",placeholder:"请输入密码",onfocus:"this.placeholder=''",onBlur:o[3]||(o[3]=n=>e.onblur()),onKeyup:q(e.handleSubmit,["enter"])},null,544),[[x,e.formState.password]]),le])]),t("div",ue,[m(e.BasicDragVerify,{width:270,barStyle:{backgroundColor:"#018ffb"},onSuccess:e.handleSuccess})]),t("div",{class:"login-button",onClick:e.handleSubmit},"登录"),t("div",ce,[de,m(Q,{vertical:""}),ge])],64)}const fe=L(Z,[["render",_e],["__file","AccountLogin.vue"]]),I=1e3*60,me=w({__name:"QRCodeLogin",setup(i,{expose:o}){o();let r,e=p(""),a=p(!1),_=p(""),n;function d(){if(!n&&!n.connectionId)return;const c=T().query.sysid,l=n.connectionId;K("/api/getqrcode","https://gis-auth.digsur.com",{connId:l,sys:c!=null?c:""},void 0,"blob").then(y=>{u.Logger().log("axios调用结果",y),a.value=!1,f();let S=URL.createObjectURL(y.data);e.value=S})}function f(){u.Logger().log("重新开始计时……"),r&&clearTimeout(r),r=setTimeout(()=>{a.value=!0},I)}function h(){const c=P("http://192.168.1.123:5000/chathub");c&&(n=c,c.start().then(()=>{c.state==="Connected"&&(n=c,d())}).catch(l=>{u.Logger().error("连接SignalR服务出错了！",l)}),c.on("QRCodeCheckMessage",function(l,s){s&&l&&(_.value=l),u.Logger().log("QRCodeCheckMessage",l,s)}),c.on("QRCodeSendMessage",function(l){let s=JSON.parse(l);if(u.Logger().log("QRCodeSendMessage",s),s!=null&&s.Success){let C=s==null?void 0:s.Userinfo.Doubletoken.AccessToken.TokenContent;if(s.System){u.Logger().info("当前登录id",s.System);const S=E("");window.open(S+"?tk="+C,"_self")}else u.OneUserInfo=s.Userinfo,V().push("onelogin-portal")}else _.value="",d(),u.Message.warn("登录失败！请重新扫码登录")}))}h(),G(()=>{f()}),H(()=>{clearTimeout(r),n&&(n.off("QRCodeCheckMessage"),n.off("QRCodeSendMessage"),n.stop())});const v={get timerId(){return r},set timerId(g){r=g},timeout:I,get imgUrl(){return e},set imgUrl(g){e=g},get needRefresh(){return a},set needRefresh(g){a=g},get codeName(){return _},set codeName(g){_=g},get signalRConnection(){return n},set signalRConnection(g){n=g},getLoginQRCode:d,resetTimeOut:f,init:h};return Object.defineProperty(v,"__isScriptSetup",{enumerable:!1,value:!0}),v}}),R=i=>(M("data-v-7eade1b9"),i=i(),$(),i),pe=R(()=>t("div",{class:"login-top-center"},"扫码登录",-1)),he={class:"login-center"},ve={key:0,class:"box"},Ce=R(()=>t("div",{class:"scaninfo"},"请打开微信小程序【帝测授权宝】扫码登录",-1)),ye={class:"imgInfo"},be={key:0,class:"mask"},Be=["src"],Se={class:"login-bottom-line"},Re=R(()=>t("span",null,"密码登录",-1)),Ue=R(()=>t("span",null,"注册新账号",-1));function we(i,o,r,e,a,_){return b(),B("div",null,[pe,t("div",he,[e.codeName?(b(),B("div",ve,[t("span",null,D(e.codeName)+"正在登录...",1)])):(b(),B("div",{key:1,class:"box",onClick:e.getLoginQRCode},[Ce,t("div",ye,[e.needRefresh&&e.imgUrl?(b(),B("div",be,[m(N,{flat:"",color:"primary",label:"点我刷新"})])):J("",!0),t("img",{src:e.imgUrl,alt:"用户登录二维码",style:{width:"100%"}},null,8,Be)])])),t("div",Se,[Re,m(Q,{dark:"",vertical:""}),Ue])])])}const Le=L(me,[["render",we],["__scopeId","data-v-7eade1b9"],["__file","QRCodeLogin.vue"]]),Fe=w({__name:"index",setup(i,{expose:o}){var f,h;o(),u.Loading("end");const r=p("");r.value=(f=u.Config.UI)==null?void 0:f.SiteTitle;const e=p("");e.value=(h=u.Config.UI)==null?void 0:h.CopyRight;const a=p("2"),_=X(()=>{let v="right-login-switch right-login-qrcode";return a.value==="2"&&(v="right-login-switch right-login-account"),v});function n(){a.value==="1"?a.value="2":a.value="1"}const d={systemTitle:r,copyRightInfo:e,activeKey:a,getRightStyle:_,changeLoginType:n,AccountLogin:fe,QRCodeLogin:Le};return Object.defineProperty(d,"__isScriptSetup",{enumerable:!1,value:!0}),d}}),ke=i=>(M("data-v-3aed3409"),i=i(),$(),i),xe={class:"container"},Ie=ke(()=>t("div",{class:"login-logo"},[t("img",{src:"/img/logo.png",alt:""}),t("span",{class:"login-title"},"统一用户登录")],-1)),Qe={class:"login"},Te={class:"login-copyright"};function Ve(i,o,r,e,a,_){return b(),B("div",xe,[Ie,t("div",Qe,[t("div",{class:Y(e.getRightStyle),onClick:o[0]||(o[0]=n=>e.changeLoginType())},null,2),m(O,{modelValue:e.activeKey,"onUpdate:modelValue":o[1]||(o[1]=n=>e.activeKey=n),animated:"",class:"shadow-2 rounded-borders"},{default:U(()=>[m(F,{name:"1"},{default:U(()=>[m(e.AccountLogin)]),_:1}),m(F,{name:"2"},{default:U(()=>[m(e.QRCodeLogin)]),_:1})]),_:1},8,["modelValue"])]),t("div",Te,D(e.copyRightInfo),1)])}const We=L(Fe,[["render",Ve],["__scopeId","data-v-3aed3409"],["__file","index.vue"]]);export{We as default};
