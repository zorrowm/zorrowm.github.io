import{ae as g,aa as D,ab as V}from"./vendor-qEPl7M71.js";import{B as s}from"./xframelib-exp-CBRV2soX.js";import{d as _,a as U,o as L,C as S,M as b,e as F,N as j,a4 as d,F as x,L as P}from"./@vue-exp-Cbz_CXqa.js";import{_ as h}from"./index-XTFg7KW3.js";import"./axios-exp-B_zfNCMU.js";import"./@iconify/vue-exp-BeT9ZUzB.js";import"./monaco-editor-exp-B01XOe8A.js";import"./vue-router-exp-U1sBIDGE.js";const M=_({__name:"UploadVectorWidget",setup(p,{expose:l}){l();const i=g(),a=U();let e;function n(){if(a){const o=new FileReader;o.onload=function(t){if(o.result)if(a.value.name.toString().indexOf(".kml")==-1)r(JSON.parse(o.result.toString()));else{const y=new DOMParser().parseFromString(o.result.toString(),"text/xml"),v=D(y);r(v)}},o.readAsText(a.value)}}function r(o){if(!e)return;const t=e.getSource("UploadVectorData");t?t.setData(o):(e.addSource("UploadVectorData",{type:"geojson",data:o}),e.addLayer({id:"UploadVectorDataLayerFill",type:"fill",source:"UploadVectorData",layout:{visibility:"visible"},filter:["==","$type","Polygon"],paint:{"fill-color":"#ff0000","fill-opacity":.5}}),e.addLayer({id:"UploadVectorDataLayerLine",type:"line",source:"UploadVectorData",layout:{visibility:"visible"},filter:["==","$type","LineString"],paint:{"line-color":"#ff0000","line-opacity":.5,"line-width":3}}),e.addLayer({id:"UploadVectorDataLayerPoint",type:"circle",source:"UploadVectorData",layout:{visibility:"visible"},filter:["==","$type","Point"],paint:{"circle-color":"#ff0000","circle-opacity":.5}}))}function f(o){i.notify({type:"negative",message:`${o.length} file(s) did not pass validation constraints`})}function u(o){}function m(o){const t=o.dataTransfer.files;t&&t.length>0&&(a.value=t[0],n())}L(()=>{s.map&&(e=s.map)}),S(()=>{e&&e.getSource("UploadVectorData")&&(e.removeLayer("UploadVectorDataFull"),e.removeLayer("UploadVectorDataLine"),e.removeLayer("UploadVectorDataPoint"),e.removeSource("UploadVectorData"))});const c={$q:i,fileModel:a,get map(){return e},set map(o){e=o},LoadVectorData:n,LoadDataSource:r,onRejected:f,handleDragOver:u,handleDrop:m};return Object.defineProperty(c,"__isScriptSetup",{enumerable:!1,value:!0}),c}});function k(p,l,i,a,e,n){return P(),b(x,null,[F(V,{class:"filePanel",modelValue:a.fileModel,"onUpdate:modelValue":[l[0]||(l[0]=r=>a.fileModel=r),a.LoadVectorData],filled:"",accept:".geojson,.kml",label:"选择矢量文件(.geojson,.kml)",onRejected:a.onRejected},null,8,["modelValue"]),j("div",{class:"mainPanel",onDragover:d(a.handleDragOver,["prevent"]),onDrop:d(a.handleDrop,["prevent"])},null,32)],64)}const $=h(M,[["render",k],["__scopeId","data-v-e607dbab"],["__file","UploadVectorWidget.vue"]]);export{$ as default};
