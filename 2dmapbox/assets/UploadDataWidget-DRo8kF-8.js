import{aa as V,ab as S}from"./vendor-qEPl7M71.js";import{d as h,_ as x}from"./index-8yyKnfk0.js";import{B as p,f as j,n as W}from"./xframelib-exp-CBRV2soX.js";import{W as b}from"./WidgetsEvent-e0lOKT5_.js";import{d as F,a as D,o as P,C as E,D as k,K as C,S as I,_ as M,L as O,e as B,N,a4 as g}from"./@vue-exp-Cbz_CXqa.js";import"./monaco-editor-exp-B01XOe8A.js";import"./vue-router-exp-U1sBIDGE.js";import"./axios-exp-B_zfNCMU.js";import"./@iconify/vue-exp-BeT9ZUzB.js";const R=F({__name:"UploadDataWidget",setup(y,{expose:n}){const a=D();let o;function c(){if(a){const e=new FileReader;e.onload=function(t){if(e.result)if(a.value.name.toString().indexOf(".kml")==-1)l(JSON.parse(e.result.toString()));else{const r=new DOMParser().parseFromString(e.result.toString(),"text/xml"),U=V(r);l(U)}},e.readAsText(a.value)}}function l(e){if(!o)return;const t=o.getSource("UploadVectorData");t?t.setData(e):(o.addSource("UploadVectorData",{type:"geojson",data:e}),o.addLayer({id:"UploadVectorDataLayerFill",type:"fill",source:"UploadVectorData",layout:{visibility:"visible"},filter:["==","$type","Polygon"],paint:{"fill-color":"#ff0000","fill-opacity":.5}}),o.addLayer({id:"UploadVectorDataLayerLine",type:"line",source:"UploadVectorData",layout:{visibility:"visible"},filter:["==","$type","LineString"],paint:{"line-color":"#ff0000","line-opacity":.5,"line-width":3}}),o.addLayer({id:"UploadVectorDataLayerPoint",type:"circle",source:"UploadVectorData",layout:{visibility:"visible"},filter:["==","$type","Point"],paint:{"circle-color":"#ff0000","circle-opacity":.5}}))}function d(e){p.Message.info("暂不支持改格式,仅支持.geojson和.kml")}function v(e){}function _(e){const t=e.dataTransfer.files;if(t&&t.length>0){const r=t[0];r.name.indexOf(".kml")>-1||r.name.indexOf(".geojson")>-1?(a.value=r,c()):d()}}P(()=>{p.map&&(o=p.map)}),E(()=>{o&&o.getSource("UploadVectorData")&&(o.removeLayer("UploadVectorDataLayerFill"),o.removeLayer("UploadVectorDataLayerLine"),o.removeLayer("UploadVectorDataLayerPoint"),o.removeSource("UploadVectorData"))});let s="UploadDataWidget",i="";function w(e){i=e.id}function L(e){s=e.pid,e.pid&&h(b.WidgetClosed,s)}const f=D(!0);function u(e=!1){f.value=e,i&&e&&W.openWindowPanel(i)}n({changeVisible:u,isShow:f});const m={fileModel:a,get map(){return o},set map(e){o=e},LoadVectorData:c,LoadDataSource:l,onRejected:d,handleDragOver:v,handleDrop:_,get widgetID(){return s},set widgetID(e){s=e},get windowID(){return i},set windowID(e){i=e},loadedHandle:w,doClosePanel:L,isShow:f,changeVisible:u,get XWindow(){return j}};return Object.defineProperty(m,"__isScriptSetup",{enumerable:!1,value:!0}),m}});function H(y,n,a,o,c,l){return k((O(),I(o.XWindow,{isDark:!1,top:"10px",left:"10px",nWidth:"280px",hHeight:"350px",title:"数据上传",pid:"UploadDataWidget",onLoaded:o.loadedHandle,onClose:o.doClosePanel},{default:M(()=>[B(S,{class:"filePanel",modelValue:o.fileModel,"onUpdate:modelValue":[n[0]||(n[0]=d=>o.fileModel=d),o.LoadVectorData],filled:"",accept:".geojson,.kml",label:"选择矢量文件(.geojson,.kml)",onRejected:o.onRejected},null,8,["modelValue"]),N("div",{class:"mainPanel row justify-center items-center",onDragover:g(o.handleDragOver,["prevent"]),onDrop:g(o.handleDrop,["prevent"])}," 可将文件拖至此处 ",32)]),_:1},512)),[[C,o.isShow]])}const Y=x(R,[["render",H],["__scopeId","data-v-fbd2d4ea"],["__file","UploadDataWidget.vue"]]);export{Y as default};
