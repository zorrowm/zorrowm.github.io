import{O as R,f as k,u as D,g as F,k as O,d as U,_ as E}from"./index-8yyKnfk0.js";import{B as o,P as I,b as j}from"./xframelib-exp-CBRV2soX.js";import{u as H}from"./vue-router-exp-U1sBIDGE.js";import{am as N,aj as P}from"./vendor-qEPl7M71.js";import{d as x,r as V,a as L,o as A,C as K,L as T,M as W,N as t,D as w,ac as b,Z as q}from"./@vue-exp-Cbz_CXqa.js";import"./monaco-editor-exp-B01XOe8A.js";import"./axios-exp-B_zfNCMU.js";import"./@iconify/vue-exp-BeT9ZUzB.js";const Z={System_RefreshList:"System_RefreshList",System_Search:"System_Search",System_Detail:"System_Detail",System_ReListAside:"System_ReListAside",CesiumWidgetLoaded:"CesiumWidgetLoaded",UserLoginSuccess:"UserLoginSuccess"},z=x({name:"loginModal"}),G=x({...z,props:{data:N([Object]).def({}),extra:P().isRequired},setup(f,{expose:e}){e();const u="loginModal",s=f,d=H(),r=V({username:"",password:""}),n=L(),c=L();function B(){n.value&&(n.value.placeholder="请输入账号"),c.value&&(c.value.placeholder="请输入密码")}let i=!0;const h=async()=>{if(!i){o.Logger().debug("频繁点击登录******");return}if(i=!1,r.username.trim()===""||r.password.trim()=="")return setTimeout(()=>{i=!0},2e3),o.Message?.warn("用户名或密码不能为空！");let a={username:r.username.trim(),pwd:r.password.trim()};const l=await I(a).catch(g=>{o.Message?.warn(`登录失败:${g.message}!`),i=!0});l&&await v(l)};async function v(a){const l=D();l.init(a),o.User=l.id;const g=F(),M=l.DefaultMaxRoleLevel===0;let _=!0;const y=await j(g,M).catch(p=>{_=!1,o.Message?.err("该系统未注册！")});if(i=!0,!!_){if(o.Logger().debug(y,"登录后的系统权限"),y){const p=O();o.Logger().debug(p,"系统路由权限"),p?.forEach(C=>{d.addRoute(C)})}else{o.Message?.warn(r.username+"无系统权限，无法登录！");return}U(Z.UserLoginSuccess,void 0)}}function m(a){}A(()=>{R(u,m)}),K(()=>{k(u,m)});const S={name:u,props:s,router:d,formState:r,nameInput:n,pwdInput:c,onblur:B,get canLoginClicked(){return i},set canLoginClicked(a){i=a},handleSubmit:h,loginSuccess:v,OkCancelHandler:m};return Object.defineProperty(S,"__isScriptSetup",{enumerable:!1,value:!0}),S}}),J={class:"container",style:{height:"500px"}},Q={class:"login"},X={class:"login-center clearfix"},Y={class:"login-center-input"},$={class:"login-center clearfix"},ee={class:"login-center-input"};function te(f,e,u,s,d,r){return T(),W("div",J,[t("div",Q,[e[8]||(e[8]=t("div",{class:"login-top"},"用户登录",-1)),t("div",X,[e[5]||(e[5]=t("div",{class:"login-center-img"},[t("img",{src:"img/login/name.png"})],-1)),t("div",Y,[w(t("input",{ref:"nameInput","onUpdate:modelValue":e[0]||(e[0]=n=>s.formState.username=n),type:"text",placeholder:"请输入账号",onfocus:"this.placeholder=''",onBlur:e[1]||(e[1]=n=>s.onblur())},null,544),[[b,s.formState.username]]),e[4]||(e[4]=t("div",{class:"login-center-input-text"},"账号",-1))])]),t("div",$,[e[7]||(e[7]=t("div",{class:"login-center-img"},[t("img",{src:"img/login/password.png"})],-1)),t("div",ee,[w(t("input",{ref:"pwdInput","onUpdate:modelValue":e[2]||(e[2]=n=>s.formState.password=n),type:"password",placeholder:"请输入密码",onfocus:"this.placeholder=''",onBlur:e[3]||(e[3]=n=>s.onblur()),onKeyup:q(s.handleSubmit,["enter"])},null,544),[[b,s.formState.password]]),e[6]||(e[6]=t("div",{class:"login-center-input-text"},"密码",-1))])]),t("div",{class:"login-button",onClick:s.handleSubmit},"登录")])])}const de=E(G,[["render",te],["__file","loginModal.vue"]]);export{de as default};
